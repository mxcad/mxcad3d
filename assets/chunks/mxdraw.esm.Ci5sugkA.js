class PubSub{constructor(){this.events={}}on(n,o){let a=this;a.events||(a.events={}),a.events.hasOwnProperty(n)||(a.events[n]=[]),a.events[n].push(o)}emit(n,...o){let a=this;a.events||(a.events={}),a.events.hasOwnProperty(n)&&a.events[n].map(m=>m(...o))}off(n,o){if(this.events[n])if(o===void 0)this.events[n]=[];else{const a=this.events[n].indexOf(o);this.events[n].splice(a,1)}}}class Store{constructor(n){let o=this;o.actions={},o.mutations={},o.state=n.state,o.status="resting",o.events=new PubSub,n.hasOwnProperty("actions")&&(o.actions=n.actions),n.hasOwnProperty("mutations")&&(o.mutations=n.mutations)}dispatch(n,o){let a=this;return typeof a.actions[n]=="function"&&(console.groupCollapsed(`ACTION: ${n}`),a.status="action",a.actions[n](a,o),console.groupEnd(),!0)}commit(n,o){let a=this;if(typeof a.mutations[n]!="function")return console.log(`Mutation "${n}" doesn't exist`),!1;a.status="mutation";let m=a.mutations[n](a.state,o);return a.state=Object.assign(a.state,m),!0}}const options={state:{MxFun:null,Mxassembly:null,isCreateDrawObj:!1},actions:{},mutations:{}};for(let b in options.state){const n=b.charAt(0).toUpperCase()+b.slice(1);options.mutations["set"+n]=(o,a)=>{o[b]=a}}const store=new Store(options);function mxfun(){(function b(n,o,a){function m(A,H){if(!o[A]){if(!n[A]){var F=typeof require=="function"&&require;if(!H&&F)return F(A,!0);if(c)return c(A,!0);var P=new Error("Cannot find module '"+A+"'");throw P.code="MODULE_NOT_FOUND",P}var g=o[A]={exports:{}};n[A][0].call(g.exports,function(E){return m(n[A][1][E]||E)},g,g.exports,b,n,o,a)}return o[A].exports}for(var c=typeof require=="function"&&require,x=0;x<a.length;x++)m(a[x]);return m})({1:[function(b,n,o){var a={};(0,b("./lib/utils/common").assign)(a,b("./lib/deflate"),b("./lib/inflate"),b("./lib/zlib/constants")),n.exports=a},{"./lib/deflate":2,"./lib/inflate":3,"./lib/utils/common":4,"./lib/zlib/constants":7}],2:[function(b,n,o){var a=b("./zlib/deflate"),m=b("./utils/common"),c=b("./utils/strings"),x=b("./zlib/messages"),A=b("./zlib/zstream"),H=Object.prototype.toString,F=0,P=-1,g=0,E=8;function _(U){if(!(this instanceof _))return new _(U);this.options=m.assign({level:P,method:E,chunkSize:16384,windowBits:15,memLevel:8,strategy:g,to:""},U||{});var C=this.options;C.raw&&0<C.windowBits?C.windowBits=-C.windowBits:C.gzip&&0<C.windowBits&&C.windowBits<16&&(C.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new A,this.strm.avail_out=0;var S=a.deflateInit2(this.strm,C.level,C.method,C.windowBits,C.memLevel,C.strategy);if(S!==F)throw new Error(x[S]);if(C.header&&a.deflateSetHeader(this.strm,C.header),C.dictionary){var Y;if(Y=typeof C.dictionary=="string"?c.string2buf(C.dictionary):H.call(C.dictionary)==="[object ArrayBuffer]"?new Uint8Array(C.dictionary):C.dictionary,(S=a.deflateSetDictionary(this.strm,Y))!==F)throw new Error(x[S]);this._dict_set=!0}}function k(U,C){var S=new _(C);if(S.push(U,!0),S.err)throw S.msg||x[S.err];return S.result}_.prototype.push=function(U,C){var S,Y,G=this.strm,T=this.options.chunkSize;if(this.ended)return!1;Y=C===~~C?C:C===!0?4:0,typeof U=="string"?G.input=c.string2buf(U):H.call(U)==="[object ArrayBuffer]"?G.input=new Uint8Array(U):G.input=U,G.next_in=0,G.avail_in=G.input.length;do{if(G.avail_out===0&&(G.output=new m.Buf8(T),G.next_out=0,G.avail_out=T),(S=a.deflate(G,Y))!==1&&S!==F)return this.onEnd(S),!(this.ended=!0);G.avail_out!==0&&(G.avail_in!==0||Y!==4&&Y!==2)||(this.options.to==="string"?this.onData(c.buf2binstring(m.shrinkBuf(G.output,G.next_out))):this.onData(m.shrinkBuf(G.output,G.next_out)))}while((0<G.avail_in||G.avail_out===0)&&S!==1);return Y===4?(S=a.deflateEnd(this.strm),this.onEnd(S),this.ended=!0,S===F):Y!==2||(this.onEnd(F),!(G.avail_out=0))},_.prototype.onData=function(U){this.chunks.push(U)},_.prototype.onEnd=function(U){U===F&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=m.flattenChunks(this.chunks)),this.chunks=[],this.err=U,this.msg=this.strm.msg},o.Deflate=_,o.deflate=k,o.deflateRaw=function(U,C){return(C=C||{}).raw=!0,k(U,C)},o.gzip=function(U,C){return(C=C||{}).gzip=!0,k(U,C)}},{"./utils/common":4,"./utils/strings":5,"./zlib/deflate":9,"./zlib/messages":14,"./zlib/zstream":16}],3:[function(b,n,o){var a=b("./zlib/inflate"),m=b("./utils/common"),c=b("./utils/strings"),x=b("./zlib/constants"),A=b("./zlib/messages"),H=b("./zlib/zstream"),F=b("./zlib/gzheader"),P=Object.prototype.toString;function g(_){if(!(this instanceof g))return new g(_);this.options=m.assign({chunkSize:16384,windowBits:0,to:""},_||{});var k=this.options;k.raw&&0<=k.windowBits&&k.windowBits<16&&(k.windowBits=-k.windowBits,k.windowBits===0&&(k.windowBits=-15)),!(0<=k.windowBits&&k.windowBits<16)||_&&_.windowBits||(k.windowBits+=32),15<k.windowBits&&k.windowBits<48&&!(15&k.windowBits)&&(k.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new H,this.strm.avail_out=0;var U=a.inflateInit2(this.strm,k.windowBits);if(U!==x.Z_OK)throw new Error(A[U]);if(this.header=new F,a.inflateGetHeader(this.strm,this.header),k.dictionary&&(typeof k.dictionary=="string"?k.dictionary=c.string2buf(k.dictionary):P.call(k.dictionary)==="[object ArrayBuffer]"&&(k.dictionary=new Uint8Array(k.dictionary)),k.raw&&(U=a.inflateSetDictionary(this.strm,k.dictionary))!==x.Z_OK))throw new Error(A[U])}function E(_,k){var U=new g(k);if(U.push(_,!0),U.err)throw U.msg||A[U.err];return U.result}g.prototype.push=function(_,k){var U,C,S,Y,G,T=this.strm,B=this.options.chunkSize,D=this.options.dictionary,N=!1;if(this.ended)return!1;C=k===~~k?k:k===!0?x.Z_FINISH:x.Z_NO_FLUSH,typeof _=="string"?T.input=c.binstring2buf(_):P.call(_)==="[object ArrayBuffer]"?T.input=new Uint8Array(_):T.input=_,T.next_in=0,T.avail_in=T.input.length;do{if(T.avail_out===0&&(T.output=new m.Buf8(B),T.next_out=0,T.avail_out=B),(U=a.inflate(T,x.Z_NO_FLUSH))===x.Z_NEED_DICT&&D&&(U=a.inflateSetDictionary(this.strm,D)),U===x.Z_BUF_ERROR&&N===!0&&(U=x.Z_OK,N=!1),U!==x.Z_STREAM_END&&U!==x.Z_OK)return this.onEnd(U),!(this.ended=!0);T.next_out&&(T.avail_out!==0&&U!==x.Z_STREAM_END&&(T.avail_in!==0||C!==x.Z_FINISH&&C!==x.Z_SYNC_FLUSH)||(this.options.to==="string"?(S=c.utf8border(T.output,T.next_out),Y=T.next_out-S,G=c.buf2string(T.output,S),T.next_out=Y,T.avail_out=B-Y,Y&&m.arraySet(T.output,T.output,S,Y,0),this.onData(G)):this.onData(m.shrinkBuf(T.output,T.next_out)))),T.avail_in===0&&T.avail_out===0&&(N=!0)}while((0<T.avail_in||T.avail_out===0)&&U!==x.Z_STREAM_END);return U===x.Z_STREAM_END&&(C=x.Z_FINISH),C===x.Z_FINISH?(U=a.inflateEnd(this.strm),this.onEnd(U),this.ended=!0,U===x.Z_OK):C!==x.Z_SYNC_FLUSH||(this.onEnd(x.Z_OK),!(T.avail_out=0))},g.prototype.onData=function(_){this.chunks.push(_)},g.prototype.onEnd=function(_){_===x.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=m.flattenChunks(this.chunks)),this.chunks=[],this.err=_,this.msg=this.strm.msg},o.Inflate=g,o.inflate=E,o.inflateRaw=function(_,k){return(k=k||{}).raw=!0,E(_,k)},o.ungzip=E},{"./utils/common":4,"./utils/strings":5,"./zlib/constants":7,"./zlib/gzheader":10,"./zlib/inflate":12,"./zlib/messages":14,"./zlib/zstream":16}],4:[function(b,n,o){var a=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";o.assign=function(x){for(var A,H,F=Array.prototype.slice.call(arguments,1);F.length;){var P=F.shift();if(P){if(typeof P!="object")throw new TypeError(P+"must be non-object");for(var g in P)A=P,H=g,Object.prototype.hasOwnProperty.call(A,H)&&(x[g]=P[g])}}return x},o.shrinkBuf=function(x,A){return x.length===A?x:x.subarray?x.subarray(0,A):(x.length=A,x)};var m={arraySet:function(x,A,H,F,P){if(A.subarray&&x.subarray)x.set(A.subarray(H,H+F),P);else for(var g=0;g<F;g++)x[P+g]=A[H+g]},flattenChunks:function(x){var A,H,F,P,g,E;for(A=F=0,H=x.length;A<H;A++)F+=x[A].length;for(E=new Uint8Array(F),A=P=0,H=x.length;A<H;A++)g=x[A],E.set(g,P),P+=g.length;return E}},c={arraySet:function(x,A,H,F,P){for(var g=0;g<F;g++)x[P+g]=A[H+g]},flattenChunks:function(x){return[].concat.apply([],x)}};o.setTyped=function(x){x?(o.Buf8=Uint8Array,o.Buf16=Uint16Array,o.Buf32=Int32Array,o.assign(o,m)):(o.Buf8=Array,o.Buf16=Array,o.Buf32=Array,o.assign(o,c))},o.setTyped(a)},{}],5:[function(b,n,o){var a=b("./common"),m=!0,c=!0;try{String.fromCharCode.apply(null,[0])}catch{m=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{c=!1}for(var x=new a.Buf8(256),A=0;A<256;A++)x[A]=252<=A?6:248<=A?5:240<=A?4:224<=A?3:192<=A?2:1;function H(F,P){if(P<65534&&(F.subarray&&c||!F.subarray&&m))return String.fromCharCode.apply(null,a.shrinkBuf(F,P));for(var g="",E=0;E<P;E++)g+=String.fromCharCode(F[E]);return g}x[254]=x[254]=1,o.string2buf=function(F){var P,g,E,_,k,U=F.length,C=0;for(_=0;_<U;_++)(64512&(g=F.charCodeAt(_)))==55296&&_+1<U&&(64512&(E=F.charCodeAt(_+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),_++),C+=g<128?1:g<2048?2:g<65536?3:4;for(P=new a.Buf8(C),_=k=0;k<C;_++)(64512&(g=F.charCodeAt(_)))==55296&&_+1<U&&(64512&(E=F.charCodeAt(_+1)))==56320&&(g=65536+(g-55296<<10)+(E-56320),_++),g<128?P[k++]=g:(g<2048?P[k++]=192|g>>>6:(g<65536?P[k++]=224|g>>>12:(P[k++]=240|g>>>18,P[k++]=128|g>>>12&63),P[k++]=128|g>>>6&63),P[k++]=128|63&g);return P},o.buf2binstring=function(F){return H(F,F.length)},o.binstring2buf=function(F){for(var P=new a.Buf8(F.length),g=0,E=P.length;g<E;g++)P[g]=F.charCodeAt(g);return P},o.buf2string=function(F,P){var g,E,_,k,U=P||F.length,C=new Array(2*U);for(g=E=0;g<U;)if((_=F[g++])<128)C[E++]=_;else if(4<(k=x[_]))C[E++]=65533,g+=k-1;else{for(_&=k===2?31:k===3?15:7;1<k&&g<U;)_=_<<6|63&F[g++],k--;1<k?C[E++]=65533:_<65536?C[E++]=_:(_-=65536,C[E++]=55296|_>>10&1023,C[E++]=56320|1023&_)}return H(C,E)},o.utf8border=function(F,P){var g;for((P=P||F.length)>F.length&&(P=F.length),g=P-1;0<=g&&(192&F[g])==128;)g--;return!(g<0)&&g!==0&&g+x[F[g]]>P?g:P}},{"./common":4}],6:[function(b,n,o){n.exports=function(a,m,c,x){for(var A=65535&a|0,H=a>>>16&65535|0,F=0;c!==0;){for(c-=F=2e3<c?2e3:c;H=H+(A=A+m[x++]|0)|0,--F;);A%=65521,H%=65521}return A|H<<16|0}},{}],7:[function(b,n,o){n.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],8:[function(b,n,o){var a=function(){for(var m,c=[],x=0;x<256;x++){m=x;for(var A=0;A<8;A++)m=1&m?3988292384^m>>>1:m>>>1;c[x]=m}return c}();n.exports=function(m,c,x,A){var H=a,F=A+x;m^=-1;for(var P=A;P<F;P++)m=m>>>8^H[255&(m^c[P])];return-1^m}},{}],9:[function(b,n,o){var a,m=b("../utils/common"),c=b("./trees"),x=b("./adler32"),A=b("./crc32"),H=b("./messages"),F=0,P=0,g=-2,E=2,_=8,k=286,U=30,C=19,S=2*k+1,Y=15,G=3,T=258,B=T+G+1,D=42,N=113;function I(re,fe){return re.msg=H[fe],fe}function h(re){return(re<<1)-(4<re?9:0)}function u(re){for(var fe=re.length;0<=--fe;)re[fe]=0}function v(re){var fe=re.state,ne=fe.pending;ne>re.avail_out&&(ne=re.avail_out),ne!==0&&(m.arraySet(re.output,fe.pending_buf,fe.pending_out,ne,re.next_out),re.next_out+=ne,fe.pending_out+=ne,re.total_out+=ne,re.avail_out-=ne,fe.pending-=ne,fe.pending===0&&(fe.pending_out=0))}function M(re,fe){c._tr_flush_block(re,0<=re.block_start?re.block_start:-1,re.strstart-re.block_start,fe),re.block_start=re.strstart,v(re.strm)}function j(re,fe){re.pending_buf[re.pending++]=fe}function z(re,fe){re.pending_buf[re.pending++]=fe>>>8&255,re.pending_buf[re.pending++]=255&fe}function J(re,fe){var ne,le,Re=re.max_chain_length,at=re.strstart,ze=re.prev_length,Ie=re.nice_match,ue=re.strstart>re.w_size-B?re.strstart-(re.w_size-B):0,Me=re.window,Je=re.w_mask,$e=re.prev,ft=re.strstart+T,Pt=Me[at+ze-1],_t=Me[at+ze];re.prev_length>=re.good_match&&(Re>>=2),Ie>re.lookahead&&(Ie=re.lookahead);do if(Me[(ne=fe)+ze]===_t&&Me[ne+ze-1]===Pt&&Me[ne]===Me[at]&&Me[++ne]===Me[at+1]){at+=2,ne++;do;while(Me[++at]===Me[++ne]&&Me[++at]===Me[++ne]&&Me[++at]===Me[++ne]&&Me[++at]===Me[++ne]&&Me[++at]===Me[++ne]&&Me[++at]===Me[++ne]&&Me[++at]===Me[++ne]&&Me[++at]===Me[++ne]&&at<ft);if(le=T-(ft-at),at=ft-T,ze<le){if(re.match_start=fe,Ie<=(ze=le))break;Pt=Me[at+ze-1],_t=Me[at+ze]}}while((fe=$e[fe&Je])>ue&&--Re!=0);return ze<=re.lookahead?ze:re.lookahead}function te(re){var fe,ne,le,Re,at,ze,Ie,ue,Me,Je,$e=re.w_size;do{if(Re=re.window_size-re.lookahead-re.strstart,re.strstart>=$e+($e-B)){for(m.arraySet(re.window,re.window,$e,$e,0),re.match_start-=$e,re.strstart-=$e,re.block_start-=$e,fe=ne=re.hash_size;le=re.head[--fe],re.head[fe]=$e<=le?le-$e:0,--ne;);for(fe=ne=$e;le=re.prev[--fe],re.prev[fe]=$e<=le?le-$e:0,--ne;);Re+=$e}if(re.strm.avail_in===0)break;if(ze=re.strm,Ie=re.window,ue=re.strstart+re.lookahead,Je=void 0,(Me=Re)<(Je=ze.avail_in)&&(Je=Me),ne=Je===0?0:(ze.avail_in-=Je,m.arraySet(Ie,ze.input,ze.next_in,Je,ue),ze.state.wrap===1?ze.adler=x(ze.adler,Ie,Je,ue):ze.state.wrap===2&&(ze.adler=A(ze.adler,Ie,Je,ue)),ze.next_in+=Je,ze.total_in+=Je,Je),re.lookahead+=ne,re.lookahead+re.insert>=G)for(at=re.strstart-re.insert,re.ins_h=re.window[at],re.ins_h=(re.ins_h<<re.hash_shift^re.window[at+1])&re.hash_mask;re.insert&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[at+G-1])&re.hash_mask,re.prev[at&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=at,at++,re.insert--,!(re.lookahead+re.insert<G)););}while(re.lookahead<B&&re.strm.avail_in!==0)}function X(re,fe){for(var ne,le;;){if(re.lookahead<B){if(te(re),re.lookahead<B&&fe===F)return 1;if(re.lookahead===0)break}if(ne=0,re.lookahead>=G&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+G-1])&re.hash_mask,ne=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),ne!==0&&re.strstart-ne<=re.w_size-B&&(re.match_length=J(re,ne)),re.match_length>=G)if(le=c._tr_tally(re,re.strstart-re.match_start,re.match_length-G),re.lookahead-=re.match_length,re.match_length<=re.max_lazy_match&&re.lookahead>=G){for(re.match_length--;re.strstart++,re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+G-1])&re.hash_mask,ne=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart,--re.match_length!=0;);re.strstart++}else re.strstart+=re.match_length,re.match_length=0,re.ins_h=re.window[re.strstart],re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+1])&re.hash_mask;else le=c._tr_tally(re,0,re.window[re.strstart]),re.lookahead--,re.strstart++;if(le&&(M(re,!1),re.strm.avail_out===0))return 1}return re.insert=re.strstart<G-1?re.strstart:G-1,fe===4?(M(re,!0),re.strm.avail_out===0?3:4):re.last_lit&&(M(re,!1),re.strm.avail_out===0)?1:2}function se(re,fe){for(var ne,le,Re;;){if(re.lookahead<B){if(te(re),re.lookahead<B&&fe===F)return 1;if(re.lookahead===0)break}if(ne=0,re.lookahead>=G&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+G-1])&re.hash_mask,ne=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),re.prev_length=re.match_length,re.prev_match=re.match_start,re.match_length=G-1,ne!==0&&re.prev_length<re.max_lazy_match&&re.strstart-ne<=re.w_size-B&&(re.match_length=J(re,ne),re.match_length<=5&&(re.strategy===1||re.match_length===G&&4096<re.strstart-re.match_start)&&(re.match_length=G-1)),re.prev_length>=G&&re.match_length<=re.prev_length){for(Re=re.strstart+re.lookahead-G,le=c._tr_tally(re,re.strstart-1-re.prev_match,re.prev_length-G),re.lookahead-=re.prev_length-1,re.prev_length-=2;++re.strstart<=Re&&(re.ins_h=(re.ins_h<<re.hash_shift^re.window[re.strstart+G-1])&re.hash_mask,ne=re.prev[re.strstart&re.w_mask]=re.head[re.ins_h],re.head[re.ins_h]=re.strstart),--re.prev_length!=0;);if(re.match_available=0,re.match_length=G-1,re.strstart++,le&&(M(re,!1),re.strm.avail_out===0))return 1}else if(re.match_available){if((le=c._tr_tally(re,0,re.window[re.strstart-1]))&&M(re,!1),re.strstart++,re.lookahead--,re.strm.avail_out===0)return 1}else re.match_available=1,re.strstart++,re.lookahead--}return re.match_available&&(le=c._tr_tally(re,0,re.window[re.strstart-1]),re.match_available=0),re.insert=re.strstart<G-1?re.strstart:G-1,fe===4?(M(re,!0),re.strm.avail_out===0?3:4):re.last_lit&&(M(re,!1),re.strm.avail_out===0)?1:2}function ve(re,fe,ne,le,Re){this.good_length=re,this.max_lazy=fe,this.nice_length=ne,this.max_chain=le,this.func=Re}function Ee(re){var fe;return re&&re.state?(re.total_in=re.total_out=0,re.data_type=E,(fe=re.state).pending=0,fe.pending_out=0,fe.wrap<0&&(fe.wrap=-fe.wrap),fe.status=fe.wrap?D:N,re.adler=fe.wrap===2?0:1,fe.last_flush=F,c._tr_init(fe),P):I(re,g)}function we(re){var fe,ne=Ee(re);return ne===P&&((fe=re.state).window_size=2*fe.w_size,u(fe.head),fe.max_lazy_match=a[fe.level].max_lazy,fe.good_match=a[fe.level].good_length,fe.nice_match=a[fe.level].nice_length,fe.max_chain_length=a[fe.level].max_chain,fe.strstart=0,fe.block_start=0,fe.lookahead=0,fe.insert=0,fe.match_length=fe.prev_length=G-1,fe.match_available=0,fe.ins_h=0),ne}function Be(re,fe,ne,le,Re,at){if(!re)return g;var ze=1;if(fe===-1&&(fe=6),le<0?(ze=0,le=-le):15<le&&(ze=2,le-=16),Re<1||9<Re||ne!==_||le<8||15<le||fe<0||9<fe||at<0||4<at)return I(re,g);le===8&&(le=9);var Ie=new function(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=_,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new m.Buf16(2*S),this.dyn_dtree=new m.Buf16(2*(2*U+1)),this.bl_tree=new m.Buf16(2*(2*C+1)),u(this.dyn_ltree),u(this.dyn_dtree),u(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new m.Buf16(Y+1),this.heap=new m.Buf16(2*k+1),u(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new m.Buf16(2*k+1),u(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0};return(re.state=Ie).strm=re,Ie.wrap=ze,Ie.gzhead=null,Ie.w_bits=le,Ie.w_size=1<<Ie.w_bits,Ie.w_mask=Ie.w_size-1,Ie.hash_bits=Re+7,Ie.hash_size=1<<Ie.hash_bits,Ie.hash_mask=Ie.hash_size-1,Ie.hash_shift=~~((Ie.hash_bits+G-1)/G),Ie.window=new m.Buf8(2*Ie.w_size),Ie.head=new m.Buf16(Ie.hash_size),Ie.prev=new m.Buf16(Ie.w_size),Ie.lit_bufsize=1<<Re+6,Ie.pending_buf_size=4*Ie.lit_bufsize,Ie.pending_buf=new m.Buf8(Ie.pending_buf_size),Ie.d_buf=+Ie.lit_bufsize,Ie.l_buf=3*Ie.lit_bufsize,Ie.level=fe,Ie.strategy=at,Ie.method=ne,we(re)}a=[new ve(0,0,0,0,function(re,fe){var ne=65535;for(ne>re.pending_buf_size-5&&(ne=re.pending_buf_size-5);;){if(re.lookahead<=1){if(te(re),re.lookahead===0&&fe===F)return 1;if(re.lookahead===0)break}re.strstart+=re.lookahead,re.lookahead=0;var le=re.block_start+ne;if((re.strstart===0||re.strstart>=le)&&(re.lookahead=re.strstart-le,re.strstart=le,M(re,!1),re.strm.avail_out===0)||re.strstart-re.block_start>=re.w_size-B&&(M(re,!1),re.strm.avail_out===0))return 1}return re.insert=0,fe===4?(M(re,!0),re.strm.avail_out===0?3:4):(re.strstart>re.block_start&&(M(re,!1),re.strm.avail_out),1)}),new ve(4,4,8,4,X),new ve(4,5,16,8,X),new ve(4,6,32,32,X),new ve(4,4,16,16,se),new ve(8,16,32,32,se),new ve(8,16,128,128,se),new ve(8,32,128,256,se),new ve(32,128,258,1024,se),new ve(32,258,258,4096,se)],o.deflateInit=function(re,fe){return Be(re,fe,_,15,8,0)},o.deflateInit2=Be,o.deflateReset=we,o.deflateResetKeep=Ee,o.deflateSetHeader=function(re,fe){return re&&re.state&&re.state.wrap===2?(re.state.gzhead=fe,P):g},o.deflate=function(re,fe){var ne,le,Re,at;if(!re||!re.state||5<fe||fe<0)return re?I(re,g):g;if(le=re.state,!re.output||!re.input&&re.avail_in!==0||le.status===666&&fe!==4)return I(re,re.avail_out===0?-5:g);if(le.strm=re,ne=le.last_flush,le.last_flush=fe,le.status===D)if(le.wrap===2)re.adler=0,j(le,31),j(le,139),j(le,8),le.gzhead?(j(le,(le.gzhead.text?1:0)+(le.gzhead.hcrc?2:0)+(le.gzhead.extra?4:0)+(le.gzhead.name?8:0)+(le.gzhead.comment?16:0)),j(le,255&le.gzhead.time),j(le,le.gzhead.time>>8&255),j(le,le.gzhead.time>>16&255),j(le,le.gzhead.time>>24&255),j(le,le.level===9?2:2<=le.strategy||le.level<2?4:0),j(le,255&le.gzhead.os),le.gzhead.extra&&le.gzhead.extra.length&&(j(le,255&le.gzhead.extra.length),j(le,le.gzhead.extra.length>>8&255)),le.gzhead.hcrc&&(re.adler=A(re.adler,le.pending_buf,le.pending,0)),le.gzindex=0,le.status=69):(j(le,0),j(le,0),j(le,0),j(le,0),j(le,0),j(le,le.level===9?2:2<=le.strategy||le.level<2?4:0),j(le,3),le.status=N);else{var ze=_+(le.w_bits-8<<4)<<8;ze|=(2<=le.strategy||le.level<2?0:le.level<6?1:le.level===6?2:3)<<6,le.strstart!==0&&(ze|=32),ze+=31-ze%31,le.status=N,z(le,ze),le.strstart!==0&&(z(le,re.adler>>>16),z(le,65535&re.adler)),re.adler=1}if(le.status===69)if(le.gzhead.extra){for(Re=le.pending;le.gzindex<(65535&le.gzhead.extra.length)&&(le.pending!==le.pending_buf_size||(le.gzhead.hcrc&&le.pending>Re&&(re.adler=A(re.adler,le.pending_buf,le.pending-Re,Re)),v(re),Re=le.pending,le.pending!==le.pending_buf_size));)j(le,255&le.gzhead.extra[le.gzindex]),le.gzindex++;le.gzhead.hcrc&&le.pending>Re&&(re.adler=A(re.adler,le.pending_buf,le.pending-Re,Re)),le.gzindex===le.gzhead.extra.length&&(le.gzindex=0,le.status=73)}else le.status=73;if(le.status===73)if(le.gzhead.name){Re=le.pending;do{if(le.pending===le.pending_buf_size&&(le.gzhead.hcrc&&le.pending>Re&&(re.adler=A(re.adler,le.pending_buf,le.pending-Re,Re)),v(re),Re=le.pending,le.pending===le.pending_buf_size)){at=1;break}at=le.gzindex<le.gzhead.name.length?255&le.gzhead.name.charCodeAt(le.gzindex++):0,j(le,at)}while(at!==0);le.gzhead.hcrc&&le.pending>Re&&(re.adler=A(re.adler,le.pending_buf,le.pending-Re,Re)),at===0&&(le.gzindex=0,le.status=91)}else le.status=91;if(le.status===91)if(le.gzhead.comment){Re=le.pending;do{if(le.pending===le.pending_buf_size&&(le.gzhead.hcrc&&le.pending>Re&&(re.adler=A(re.adler,le.pending_buf,le.pending-Re,Re)),v(re),Re=le.pending,le.pending===le.pending_buf_size)){at=1;break}at=le.gzindex<le.gzhead.comment.length?255&le.gzhead.comment.charCodeAt(le.gzindex++):0,j(le,at)}while(at!==0);le.gzhead.hcrc&&le.pending>Re&&(re.adler=A(re.adler,le.pending_buf,le.pending-Re,Re)),at===0&&(le.status=103)}else le.status=103;if(le.status===103&&(le.gzhead.hcrc?(le.pending+2>le.pending_buf_size&&v(re),le.pending+2<=le.pending_buf_size&&(j(le,255&re.adler),j(le,re.adler>>8&255),re.adler=0,le.status=N)):le.status=N),le.pending!==0){if(v(re),re.avail_out===0)return le.last_flush=-1,P}else if(re.avail_in===0&&h(fe)<=h(ne)&&fe!==4)return I(re,-5);if(le.status===666&&re.avail_in!==0)return I(re,-5);if(re.avail_in!==0||le.lookahead!==0||fe!==F&&le.status!==666){var Ie=le.strategy===2?function(ue,Me){for(var Je;;){if(ue.lookahead===0&&(te(ue),ue.lookahead===0)){if(Me===F)return 1;break}if(ue.match_length=0,Je=c._tr_tally(ue,0,ue.window[ue.strstart]),ue.lookahead--,ue.strstart++,Je&&(M(ue,!1),ue.strm.avail_out===0))return 1}return ue.insert=0,Me===4?(M(ue,!0),ue.strm.avail_out===0?3:4):ue.last_lit&&(M(ue,!1),ue.strm.avail_out===0)?1:2}(le,fe):le.strategy===3?function(ue,Me){for(var Je,$e,ft,Pt,_t=ue.window;;){if(ue.lookahead<=T){if(te(ue),ue.lookahead<=T&&Me===F)return 1;if(ue.lookahead===0)break}if(ue.match_length=0,ue.lookahead>=G&&0<ue.strstart&&($e=_t[ft=ue.strstart-1])===_t[++ft]&&$e===_t[++ft]&&$e===_t[++ft]){Pt=ue.strstart+T;do;while($e===_t[++ft]&&$e===_t[++ft]&&$e===_t[++ft]&&$e===_t[++ft]&&$e===_t[++ft]&&$e===_t[++ft]&&$e===_t[++ft]&&$e===_t[++ft]&&ft<Pt);ue.match_length=T-(Pt-ft),ue.match_length>ue.lookahead&&(ue.match_length=ue.lookahead)}if(ue.match_length>=G?(Je=c._tr_tally(ue,1,ue.match_length-G),ue.lookahead-=ue.match_length,ue.strstart+=ue.match_length,ue.match_length=0):(Je=c._tr_tally(ue,0,ue.window[ue.strstart]),ue.lookahead--,ue.strstart++),Je&&(M(ue,!1),ue.strm.avail_out===0))return 1}return ue.insert=0,Me===4?(M(ue,!0),ue.strm.avail_out===0?3:4):ue.last_lit&&(M(ue,!1),ue.strm.avail_out===0)?1:2}(le,fe):a[le.level].func(le,fe);if(Ie!==3&&Ie!==4||(le.status=666),Ie===1||Ie===3)return re.avail_out===0&&(le.last_flush=-1),P;if(Ie===2&&(fe===1?c._tr_align(le):fe!==5&&(c._tr_stored_block(le,0,0,!1),fe===3&&(u(le.head),le.lookahead===0&&(le.strstart=0,le.block_start=0,le.insert=0))),v(re),re.avail_out===0))return le.last_flush=-1,P}return fe!==4?P:le.wrap<=0?1:(le.wrap===2?(j(le,255&re.adler),j(le,re.adler>>8&255),j(le,re.adler>>16&255),j(le,re.adler>>24&255),j(le,255&re.total_in),j(le,re.total_in>>8&255),j(le,re.total_in>>16&255),j(le,re.total_in>>24&255)):(z(le,re.adler>>>16),z(le,65535&re.adler)),v(re),0<le.wrap&&(le.wrap=-le.wrap),le.pending!==0?P:1)},o.deflateEnd=function(re){var fe;return re&&re.state?(fe=re.state.status)!==D&&fe!==69&&fe!==73&&fe!==91&&fe!==103&&fe!==N&&fe!==666?I(re,g):(re.state=null,fe===N?I(re,-3):P):g},o.deflateSetDictionary=function(re,fe){var ne,le,Re,at,ze,Ie,ue,Me,Je=fe.length;if(!re||!re.state||(at=(ne=re.state).wrap)===2||at===1&&ne.status!==D||ne.lookahead)return g;for(at===1&&(re.adler=x(re.adler,fe,Je,0)),ne.wrap=0,Je>=ne.w_size&&(at===0&&(u(ne.head),ne.strstart=0,ne.block_start=0,ne.insert=0),Me=new m.Buf8(ne.w_size),m.arraySet(Me,fe,Je-ne.w_size,ne.w_size,0),fe=Me,Je=ne.w_size),ze=re.avail_in,Ie=re.next_in,ue=re.input,re.avail_in=Je,re.next_in=0,re.input=fe,te(ne);ne.lookahead>=G;){for(le=ne.strstart,Re=ne.lookahead-(G-1);ne.ins_h=(ne.ins_h<<ne.hash_shift^ne.window[le+G-1])&ne.hash_mask,ne.prev[le&ne.w_mask]=ne.head[ne.ins_h],ne.head[ne.ins_h]=le,le++,--Re;);ne.strstart=le,ne.lookahead=G-1,te(ne)}return ne.strstart+=ne.lookahead,ne.block_start=ne.strstart,ne.insert=ne.lookahead,ne.lookahead=0,ne.match_length=ne.prev_length=G-1,ne.match_available=0,re.next_in=Ie,re.input=ue,re.avail_in=ze,ne.wrap=at,P},o.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":4,"./adler32":6,"./crc32":8,"./messages":14,"./trees":15}],10:[function(b,n,o){n.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],11:[function(b,n,o){n.exports=function(a,m){var c,x,A,H,F,P,g,E,_,k,U,C,S,Y,G,T,B,D,N,I,h,u,v,M,j;c=a.state,x=a.next_in,M=a.input,A=x+(a.avail_in-5),H=a.next_out,j=a.output,F=H-(m-a.avail_out),P=H+(a.avail_out-257),g=c.dmax,E=c.wsize,_=c.whave,k=c.wnext,U=c.window,C=c.hold,S=c.bits,Y=c.lencode,G=c.distcode,T=(1<<c.lenbits)-1,B=(1<<c.distbits)-1;e:do{S<15&&(C+=M[x++]<<S,S+=8,C+=M[x++]<<S,S+=8),D=Y[C&T];t:for(;;){if(C>>>=N=D>>>24,S-=N,(N=D>>>16&255)==0)j[H++]=65535&D;else{if(!(16&N)){if(!(64&N)){D=Y[(65535&D)+(C&(1<<N)-1)];continue t}if(32&N){c.mode=12;break e}a.msg="invalid literal/length code",c.mode=30;break e}I=65535&D,(N&=15)&&(S<N&&(C+=M[x++]<<S,S+=8),I+=C&(1<<N)-1,C>>>=N,S-=N),S<15&&(C+=M[x++]<<S,S+=8,C+=M[x++]<<S,S+=8),D=G[C&B];r:for(;;){if(C>>>=N=D>>>24,S-=N,!(16&(N=D>>>16&255))){if(!(64&N)){D=G[(65535&D)+(C&(1<<N)-1)];continue r}a.msg="invalid distance code",c.mode=30;break e}if(h=65535&D,S<(N&=15)&&(C+=M[x++]<<S,(S+=8)<N&&(C+=M[x++]<<S,S+=8)),g<(h+=C&(1<<N)-1)){a.msg="invalid distance too far back",c.mode=30;break e}if(C>>>=N,S-=N,(N=H-F)<h){if(_<(N=h-N)&&c.sane){a.msg="invalid distance too far back",c.mode=30;break e}if(v=U,(u=0)===k){if(u+=E-N,N<I){for(I-=N;j[H++]=U[u++],--N;);u=H-h,v=j}}else if(k<N){if(u+=E+k-N,(N-=k)<I){for(I-=N;j[H++]=U[u++],--N;);if(u=0,k<I){for(I-=N=k;j[H++]=U[u++],--N;);u=H-h,v=j}}}else if(u+=k-N,N<I){for(I-=N;j[H++]=U[u++],--N;);u=H-h,v=j}for(;2<I;)j[H++]=v[u++],j[H++]=v[u++],j[H++]=v[u++],I-=3;I&&(j[H++]=v[u++],1<I&&(j[H++]=v[u++]))}else{for(u=H-h;j[H++]=j[u++],j[H++]=j[u++],j[H++]=j[u++],2<(I-=3););I&&(j[H++]=j[u++],1<I&&(j[H++]=j[u++]))}break}}break}}while(x<A&&H<P);x-=I=S>>3,C&=(1<<(S-=I<<3))-1,a.next_in=x,a.next_out=H,a.avail_in=x<A?A-x+5:5-(x-A),a.avail_out=H<P?P-H+257:257-(H-P),c.hold=C,c.bits=S}},{}],12:[function(b,n,o){var a=b("../utils/common"),m=b("./adler32"),c=b("./crc32"),x=b("./inffast"),A=b("./inftrees"),H=0,F=-2,P=1,g=852,E=592;function _(I){return(I>>>24&255)+(I>>>8&65280)+((65280&I)<<8)+((255&I)<<24)}function k(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new a.Buf16(320),this.work=new a.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function U(I){var h;return I&&I.state?(h=I.state,I.total_in=I.total_out=h.total=0,I.msg="",h.wrap&&(I.adler=1&h.wrap),h.mode=P,h.last=0,h.havedict=0,h.dmax=32768,h.head=null,h.hold=0,h.bits=0,h.lencode=h.lendyn=new a.Buf32(g),h.distcode=h.distdyn=new a.Buf32(E),h.sane=1,h.back=-1,H):F}function C(I){var h;return I&&I.state?((h=I.state).wsize=0,h.whave=0,h.wnext=0,U(I)):F}function S(I,h){var u,v;return I&&I.state?(v=I.state,h<0?(u=0,h=-h):(u=1+(h>>4),h<48&&(h&=15)),h&&(h<8||15<h)?F:(v.window!==null&&v.wbits!==h&&(v.window=null),v.wrap=u,v.wbits=h,C(I))):F}function Y(I,h){var u,v;return I?(v=new k,(I.state=v).window=null,(u=S(I,h))!==H&&(I.state=null),u):F}var G,T,B=!0;function D(I){if(B){var h;for(G=new a.Buf32(512),T=new a.Buf32(32),h=0;h<144;)I.lens[h++]=8;for(;h<256;)I.lens[h++]=9;for(;h<280;)I.lens[h++]=7;for(;h<288;)I.lens[h++]=8;for(A(1,I.lens,0,288,G,0,I.work,{bits:9}),h=0;h<32;)I.lens[h++]=5;A(2,I.lens,0,32,T,0,I.work,{bits:5}),B=!1}I.lencode=G,I.lenbits=9,I.distcode=T,I.distbits=5}function N(I,h,u,v){var M,j=I.state;return j.window===null&&(j.wsize=1<<j.wbits,j.wnext=0,j.whave=0,j.window=new a.Buf8(j.wsize)),v>=j.wsize?(a.arraySet(j.window,h,u-j.wsize,j.wsize,0),j.wnext=0,j.whave=j.wsize):(v<(M=j.wsize-j.wnext)&&(M=v),a.arraySet(j.window,h,u-v,M,j.wnext),(v-=M)?(a.arraySet(j.window,h,u-v,v,0),j.wnext=v,j.whave=j.wsize):(j.wnext+=M,j.wnext===j.wsize&&(j.wnext=0),j.whave<j.wsize&&(j.whave+=M))),0}o.inflateReset=C,o.inflateReset2=S,o.inflateResetKeep=U,o.inflateInit=function(I){return Y(I,15)},o.inflateInit2=Y,o.inflate=function(I,h){var u,v,M,j,z,J,te,X,se,ve,Ee,we,Be,re,fe,ne,le,Re,at,ze,Ie,ue,Me,Je,$e=0,ft=new a.Buf8(4),Pt=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!I||!I.state||!I.output||!I.input&&I.avail_in!==0)return F;(u=I.state).mode===12&&(u.mode=13),z=I.next_out,M=I.output,te=I.avail_out,j=I.next_in,v=I.input,J=I.avail_in,X=u.hold,se=u.bits,ve=J,Ee=te,ue=H;e:for(;;)switch(u.mode){case P:if(u.wrap===0){u.mode=13;break}for(;se<16;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(2&u.wrap&&X===35615){ft[u.check=0]=255&X,ft[1]=X>>>8&255,u.check=c(u.check,ft,2,0),se=X=0,u.mode=2;break}if(u.flags=0,u.head&&(u.head.done=!1),!(1&u.wrap)||(((255&X)<<8)+(X>>8))%31){I.msg="incorrect header check",u.mode=30;break}if((15&X)!=8){I.msg="unknown compression method",u.mode=30;break}if(se-=4,Ie=8+(15&(X>>>=4)),u.wbits===0)u.wbits=Ie;else if(Ie>u.wbits){I.msg="invalid window size",u.mode=30;break}u.dmax=1<<Ie,I.adler=u.check=1,u.mode=512&X?10:12,se=X=0;break;case 2:for(;se<16;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(u.flags=X,(255&u.flags)!=8){I.msg="unknown compression method",u.mode=30;break}if(57344&u.flags){I.msg="unknown header flags set",u.mode=30;break}u.head&&(u.head.text=X>>8&1),512&u.flags&&(ft[0]=255&X,ft[1]=X>>>8&255,u.check=c(u.check,ft,2,0)),se=X=0,u.mode=3;case 3:for(;se<32;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}u.head&&(u.head.time=X),512&u.flags&&(ft[0]=255&X,ft[1]=X>>>8&255,ft[2]=X>>>16&255,ft[3]=X>>>24&255,u.check=c(u.check,ft,4,0)),se=X=0,u.mode=4;case 4:for(;se<16;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}u.head&&(u.head.xflags=255&X,u.head.os=X>>8),512&u.flags&&(ft[0]=255&X,ft[1]=X>>>8&255,u.check=c(u.check,ft,2,0)),se=X=0,u.mode=5;case 5:if(1024&u.flags){for(;se<16;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}u.length=X,u.head&&(u.head.extra_len=X),512&u.flags&&(ft[0]=255&X,ft[1]=X>>>8&255,u.check=c(u.check,ft,2,0)),se=X=0}else u.head&&(u.head.extra=null);u.mode=6;case 6:if(1024&u.flags&&(J<(we=u.length)&&(we=J),we&&(u.head&&(Ie=u.head.extra_len-u.length,u.head.extra||(u.head.extra=new Array(u.head.extra_len)),a.arraySet(u.head.extra,v,j,we,Ie)),512&u.flags&&(u.check=c(u.check,v,we,j)),J-=we,j+=we,u.length-=we),u.length))break e;u.length=0,u.mode=7;case 7:if(2048&u.flags){if(J===0)break e;for(we=0;Ie=v[j+we++],u.head&&Ie&&u.length<65536&&(u.head.name+=String.fromCharCode(Ie)),Ie&&we<J;);if(512&u.flags&&(u.check=c(u.check,v,we,j)),J-=we,j+=we,Ie)break e}else u.head&&(u.head.name=null);u.length=0,u.mode=8;case 8:if(4096&u.flags){if(J===0)break e;for(we=0;Ie=v[j+we++],u.head&&Ie&&u.length<65536&&(u.head.comment+=String.fromCharCode(Ie)),Ie&&we<J;);if(512&u.flags&&(u.check=c(u.check,v,we,j)),J-=we,j+=we,Ie)break e}else u.head&&(u.head.comment=null);u.mode=9;case 9:if(512&u.flags){for(;se<16;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(X!==(65535&u.check)){I.msg="header crc mismatch",u.mode=30;break}se=X=0}u.head&&(u.head.hcrc=u.flags>>9&1,u.head.done=!0),I.adler=u.check=0,u.mode=12;break;case 10:for(;se<32;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}I.adler=u.check=_(X),se=X=0,u.mode=11;case 11:if(u.havedict===0)return I.next_out=z,I.avail_out=te,I.next_in=j,I.avail_in=J,u.hold=X,u.bits=se,2;I.adler=u.check=1,u.mode=12;case 12:if(h===5||h===6)break e;case 13:if(u.last){X>>>=7&se,se-=7&se,u.mode=27;break}for(;se<3;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}switch(u.last=1&X,--se,3&(X>>>=1)){case 0:u.mode=14;break;case 1:if(D(u),u.mode=20,h!==6)break;X>>>=2,se-=2;break e;case 2:u.mode=17;break;case 3:I.msg="invalid block type",u.mode=30}X>>>=2,se-=2;break;case 14:for(X>>>=7&se,se-=7&se;se<32;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if((65535&X)!=(X>>>16^65535)){I.msg="invalid stored block lengths",u.mode=30;break}if(u.length=65535&X,se=X=0,u.mode=15,h===6)break e;case 15:u.mode=16;case 16:if(we=u.length){if(J<we&&(we=J),te<we&&(we=te),we===0)break e;a.arraySet(M,v,j,we,z),J-=we,j+=we,te-=we,z+=we,u.length-=we;break}u.mode=12;break;case 17:for(;se<14;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(u.nlen=257+(31&X),X>>>=5,se-=5,u.ndist=1+(31&X),X>>>=5,se-=5,u.ncode=4+(15&X),X>>>=4,se-=4,286<u.nlen||30<u.ndist){I.msg="too many length or distance symbols",u.mode=30;break}u.have=0,u.mode=18;case 18:for(;u.have<u.ncode;){for(;se<3;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}u.lens[Pt[u.have++]]=7&X,X>>>=3,se-=3}for(;u.have<19;)u.lens[Pt[u.have++]]=0;if(u.lencode=u.lendyn,u.lenbits=7,Me={bits:u.lenbits},ue=A(0,u.lens,0,19,u.lencode,0,u.work,Me),u.lenbits=Me.bits,ue){I.msg="invalid code lengths set",u.mode=30;break}u.have=0,u.mode=19;case 19:for(;u.have<u.nlen+u.ndist;){for(;ne=($e=u.lencode[X&(1<<u.lenbits)-1])>>>16&255,le=65535&$e,!((fe=$e>>>24)<=se);){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(le<16)X>>>=fe,se-=fe,u.lens[u.have++]=le;else{if(le===16){for(Je=fe+2;se<Je;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(X>>>=fe,se-=fe,u.have===0){I.msg="invalid bit length repeat",u.mode=30;break}Ie=u.lens[u.have-1],we=3+(3&X),X>>>=2,se-=2}else if(le===17){for(Je=fe+3;se<Je;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}se-=fe,Ie=0,we=3+(7&(X>>>=fe)),X>>>=3,se-=3}else{for(Je=fe+7;se<Je;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}se-=fe,Ie=0,we=11+(127&(X>>>=fe)),X>>>=7,se-=7}if(u.have+we>u.nlen+u.ndist){I.msg="invalid bit length repeat",u.mode=30;break}for(;we--;)u.lens[u.have++]=Ie}}if(u.mode===30)break;if(u.lens[256]===0){I.msg="invalid code -- missing end-of-block",u.mode=30;break}if(u.lenbits=9,Me={bits:u.lenbits},ue=A(1,u.lens,0,u.nlen,u.lencode,0,u.work,Me),u.lenbits=Me.bits,ue){I.msg="invalid literal/lengths set",u.mode=30;break}if(u.distbits=6,u.distcode=u.distdyn,Me={bits:u.distbits},ue=A(2,u.lens,u.nlen,u.ndist,u.distcode,0,u.work,Me),u.distbits=Me.bits,ue){I.msg="invalid distances set",u.mode=30;break}if(u.mode=20,h===6)break e;case 20:u.mode=21;case 21:if(6<=J&&258<=te){I.next_out=z,I.avail_out=te,I.next_in=j,I.avail_in=J,u.hold=X,u.bits=se,x(I,Ee),z=I.next_out,M=I.output,te=I.avail_out,j=I.next_in,v=I.input,J=I.avail_in,X=u.hold,se=u.bits,u.mode===12&&(u.back=-1);break}for(u.back=0;ne=($e=u.lencode[X&(1<<u.lenbits)-1])>>>16&255,le=65535&$e,!((fe=$e>>>24)<=se);){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(ne&&!(240&ne)){for(Re=fe,at=ne,ze=le;ne=($e=u.lencode[ze+((X&(1<<Re+at)-1)>>Re)])>>>16&255,le=65535&$e,!(Re+(fe=$e>>>24)<=se);){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}X>>>=Re,se-=Re,u.back+=Re}if(X>>>=fe,se-=fe,u.back+=fe,u.length=le,ne===0){u.mode=26;break}if(32&ne){u.back=-1,u.mode=12;break}if(64&ne){I.msg="invalid literal/length code",u.mode=30;break}u.extra=15&ne,u.mode=22;case 22:if(u.extra){for(Je=u.extra;se<Je;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}u.length+=X&(1<<u.extra)-1,X>>>=u.extra,se-=u.extra,u.back+=u.extra}u.was=u.length,u.mode=23;case 23:for(;ne=($e=u.distcode[X&(1<<u.distbits)-1])>>>16&255,le=65535&$e,!((fe=$e>>>24)<=se);){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(!(240&ne)){for(Re=fe,at=ne,ze=le;ne=($e=u.distcode[ze+((X&(1<<Re+at)-1)>>Re)])>>>16&255,le=65535&$e,!(Re+(fe=$e>>>24)<=se);){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}X>>>=Re,se-=Re,u.back+=Re}if(X>>>=fe,se-=fe,u.back+=fe,64&ne){I.msg="invalid distance code",u.mode=30;break}u.offset=le,u.extra=15&ne,u.mode=24;case 24:if(u.extra){for(Je=u.extra;se<Je;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}u.offset+=X&(1<<u.extra)-1,X>>>=u.extra,se-=u.extra,u.back+=u.extra}if(u.offset>u.dmax){I.msg="invalid distance too far back",u.mode=30;break}u.mode=25;case 25:if(te===0)break e;if(we=Ee-te,u.offset>we){if((we=u.offset-we)>u.whave&&u.sane){I.msg="invalid distance too far back",u.mode=30;break}Be=we>u.wnext?(we-=u.wnext,u.wsize-we):u.wnext-we,we>u.length&&(we=u.length),re=u.window}else re=M,Be=z-u.offset,we=u.length;for(te<we&&(we=te),te-=we,u.length-=we;M[z++]=re[Be++],--we;);u.length===0&&(u.mode=21);break;case 26:if(te===0)break e;M[z++]=u.length,te--,u.mode=21;break;case 27:if(u.wrap){for(;se<32;){if(J===0)break e;J--,X|=v[j++]<<se,se+=8}if(Ee-=te,I.total_out+=Ee,u.total+=Ee,Ee&&(I.adler=u.check=(u.flags?c:m)(u.check,M,Ee,z-Ee)),Ee=te,(u.flags?X:_(X))!==u.check){I.msg="incorrect data check",u.mode=30;break}se=X=0}u.mode=28;case 28:if(u.wrap&&u.flags){for(;se<32;){if(J===0)break e;J--,X+=v[j++]<<se,se+=8}if(X!==(4294967295&u.total)){I.msg="incorrect length check",u.mode=30;break}se=X=0}u.mode=29;case 29:ue=1;break e;case 30:ue=-3;break e;case 31:return-4;default:return F}return I.next_out=z,I.avail_out=te,I.next_in=j,I.avail_in=J,u.hold=X,u.bits=se,(u.wsize||Ee!==I.avail_out&&u.mode<30&&(u.mode<27||h!==4))&&N(I,I.output,I.next_out,Ee-I.avail_out)?(u.mode=31,-4):(ve-=I.avail_in,Ee-=I.avail_out,I.total_in+=ve,I.total_out+=Ee,u.total+=Ee,u.wrap&&Ee&&(I.adler=u.check=(u.flags?c:m)(u.check,M,Ee,I.next_out-Ee)),I.data_type=u.bits+(u.last?64:0)+(u.mode===12?128:0)+(u.mode===20||u.mode===15?256:0),(ve==0&&Ee===0||h===4)&&ue===H&&(ue=-5),ue)},o.inflateEnd=function(I){if(!I||!I.state)return F;var h=I.state;return h.window&&(h.window=null),I.state=null,H},o.inflateGetHeader=function(I,h){var u;return I&&I.state&&2&(u=I.state).wrap?((u.head=h).done=!1,H):F},o.inflateSetDictionary=function(I,h){var u,v=h.length;return!I||!I.state||(u=I.state).wrap!==0&&u.mode!==11?F:u.mode===11&&m(1,h,v,0)!==u.check?-3:N(I,h,v,v)?(u.mode=31,-4):(u.havedict=1,H)},o.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":4,"./adler32":6,"./crc32":8,"./inffast":11,"./inftrees":13}],13:[function(b,n,o){var a=b("../utils/common"),m=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],c=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],x=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],A=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];n.exports=function(H,F,P,g,E,_,k,U){var C,S,Y,G,T,B,D,N,I,h=U.bits,u=0,v=0,M=0,j=0,z=0,J=0,te=0,X=0,se=0,ve=0,Ee=null,we=0,Be=new a.Buf16(16),re=new a.Buf16(16),fe=null,ne=0;for(u=0;u<=15;u++)Be[u]=0;for(v=0;v<g;v++)Be[F[P+v]]++;for(z=h,j=15;1<=j&&Be[j]===0;j--);if(j<z&&(z=j),j===0)return E[_++]=20971520,E[_++]=20971520,U.bits=1,0;for(M=1;M<j&&Be[M]===0;M++);for(z<M&&(z=M),u=X=1;u<=15;u++)if(X<<=1,(X-=Be[u])<0)return-1;if(0<X&&(H===0||j!==1))return-1;for(re[1]=0,u=1;u<15;u++)re[u+1]=re[u]+Be[u];for(v=0;v<g;v++)F[P+v]!==0&&(k[re[F[P+v]]++]=v);if(B=H===0?(Ee=fe=k,19):H===1?(Ee=m,we-=257,fe=c,ne-=257,256):(Ee=x,fe=A,-1),u=M,T=_,te=v=ve=0,Y=-1,G=(se=1<<(J=z))-1,H===1&&852<se||H===2&&592<se)return 1;for(;;){for(D=u-te,I=k[v]<B?(N=0,k[v]):k[v]>B?(N=fe[ne+k[v]],Ee[we+k[v]]):(N=96,0),C=1<<u-te,M=S=1<<J;E[T+(ve>>te)+(S-=C)]=D<<24|N<<16|I|0,S!==0;);for(C=1<<u-1;ve&C;)C>>=1;if(C!==0?(ve&=C-1,ve+=C):ve=0,v++,--Be[u]==0){if(u===j)break;u=F[P+k[v]]}if(z<u&&(ve&G)!==Y){for(te===0&&(te=z),T+=M,X=1<<(J=u-te);J+te<j&&!((X-=Be[J+te])<=0);)J++,X<<=1;if(se+=1<<J,H===1&&852<se||H===2&&592<se)return 1;E[Y=ve&G]=z<<24|J<<16|T-_|0}}return ve!==0&&(E[T+ve]=u-te<<24|64<<16|0),U.bits=z,0}},{"../utils/common":4}],14:[function(b,n,o){n.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],15:[function(b,n,o){var a=b("../utils/common");function m(ne){for(var le=ne.length;0<=--le;)ne[le]=0}var c=256,x=286,A=30,H=15,F=16,P=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],g=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],E=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],_=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],k=new Array(576);m(k);var U=new Array(60);m(U);var C=new Array(512);m(C);var S=new Array(256);m(S);var Y=new Array(29);m(Y);var G,T,B,D=new Array(A);function N(ne,le,Re,at,ze){this.static_tree=ne,this.extra_bits=le,this.extra_base=Re,this.elems=at,this.max_length=ze,this.has_stree=ne&&ne.length}function I(ne,le){this.dyn_tree=ne,this.max_code=0,this.stat_desc=le}function h(ne){return ne<256?C[ne]:C[256+(ne>>>7)]}function u(ne,le){ne.pending_buf[ne.pending++]=255&le,ne.pending_buf[ne.pending++]=le>>>8&255}function v(ne,le,Re){ne.bi_valid>F-Re?(ne.bi_buf|=le<<ne.bi_valid&65535,u(ne,ne.bi_buf),ne.bi_buf=le>>F-ne.bi_valid,ne.bi_valid+=Re-F):(ne.bi_buf|=le<<ne.bi_valid&65535,ne.bi_valid+=Re)}function M(ne,le,Re){v(ne,Re[2*le],Re[2*le+1])}function j(ne,le){for(var Re=0;Re|=1&ne,ne>>>=1,Re<<=1,0<--le;);return Re>>>1}function z(ne,le,Re){var at,ze,Ie=new Array(H+1),ue=0;for(at=1;at<=H;at++)Ie[at]=ue=ue+Re[at-1]<<1;for(ze=0;ze<=le;ze++){var Me=ne[2*ze+1];Me!==0&&(ne[2*ze]=j(Ie[Me]++,Me))}}function J(ne){var le;for(le=0;le<x;le++)ne.dyn_ltree[2*le]=0;for(le=0;le<A;le++)ne.dyn_dtree[2*le]=0;for(le=0;le<19;le++)ne.bl_tree[2*le]=0;ne.dyn_ltree[512]=1,ne.opt_len=ne.static_len=0,ne.last_lit=ne.matches=0}function te(ne){8<ne.bi_valid?u(ne,ne.bi_buf):0<ne.bi_valid&&(ne.pending_buf[ne.pending++]=ne.bi_buf),ne.bi_buf=0,ne.bi_valid=0}function X(ne,le,Re,at){var ze=2*le,Ie=2*Re;return ne[ze]<ne[Ie]||ne[ze]===ne[Ie]&&at[le]<=at[Re]}function se(ne,le,Re){for(var at=ne.heap[Re],ze=Re<<1;ze<=ne.heap_len&&(ze<ne.heap_len&&X(le,ne.heap[ze+1],ne.heap[ze],ne.depth)&&ze++,!X(le,at,ne.heap[ze],ne.depth));)ne.heap[Re]=ne.heap[ze],Re=ze,ze<<=1;ne.heap[Re]=at}function ve(ne,le,Re){var at,ze,Ie,ue,Me=0;if(ne.last_lit!==0)for(;at=ne.pending_buf[ne.d_buf+2*Me]<<8|ne.pending_buf[ne.d_buf+2*Me+1],ze=ne.pending_buf[ne.l_buf+Me],Me++,at===0?M(ne,ze,le):(M(ne,(Ie=S[ze])+c+1,le),(ue=P[Ie])!==0&&v(ne,ze-=Y[Ie],ue),M(ne,Ie=h(--at),Re),(ue=g[Ie])!==0&&v(ne,at-=D[Ie],ue)),Me<ne.last_lit;);M(ne,256,le)}function Ee(ne,le){var Re,at,ze,Ie=le.dyn_tree,ue=le.stat_desc.static_tree,Me=le.stat_desc.has_stree,Je=le.stat_desc.elems,$e=-1;for(ne.heap_len=0,ne.heap_max=573,Re=0;Re<Je;Re++)Ie[2*Re]!==0?(ne.heap[++ne.heap_len]=$e=Re,ne.depth[Re]=0):Ie[2*Re+1]=0;for(;ne.heap_len<2;)Ie[2*(ze=ne.heap[++ne.heap_len]=$e<2?++$e:0)]=1,ne.depth[ze]=0,ne.opt_len--,Me&&(ne.static_len-=ue[2*ze+1]);for(le.max_code=$e,Re=ne.heap_len>>1;1<=Re;Re--)se(ne,Ie,Re);for(ze=Je;Re=ne.heap[1],ne.heap[1]=ne.heap[ne.heap_len--],se(ne,Ie,1),at=ne.heap[1],ne.heap[--ne.heap_max]=Re,ne.heap[--ne.heap_max]=at,Ie[2*ze]=Ie[2*Re]+Ie[2*at],ne.depth[ze]=(ne.depth[Re]>=ne.depth[at]?ne.depth[Re]:ne.depth[at])+1,Ie[2*Re+1]=Ie[2*at+1]=ze,ne.heap[1]=ze++,se(ne,Ie,1),2<=ne.heap_len;);ne.heap[--ne.heap_max]=ne.heap[1],function(ft,Pt){var _t,Ue,Rt,It,Nr,Qt,Ur=Pt.dyn_tree,gt=Pt.max_code,We=Pt.stat_desc.static_tree,Yt=Pt.stat_desc.has_stree,Or=Pt.stat_desc.extra_bits,Yr=Pt.stat_desc.extra_base,ct=Pt.stat_desc.max_length,st=0;for(It=0;It<=H;It++)ft.bl_count[It]=0;for(Ur[2*ft.heap[ft.heap_max]+1]=0,_t=ft.heap_max+1;_t<573;_t++)ct<(It=Ur[2*Ur[2*(Ue=ft.heap[_t])+1]+1]+1)&&(It=ct,st++),Ur[2*Ue+1]=It,gt<Ue||(ft.bl_count[It]++,Nr=0,Yr<=Ue&&(Nr=Or[Ue-Yr]),Qt=Ur[2*Ue],ft.opt_len+=Qt*(It+Nr),Yt&&(ft.static_len+=Qt*(We[2*Ue+1]+Nr)));if(st!==0){do{for(It=ct-1;ft.bl_count[It]===0;)It--;ft.bl_count[It]--,ft.bl_count[It+1]+=2,ft.bl_count[ct]--,st-=2}while(0<st);for(It=ct;It!==0;It--)for(Ue=ft.bl_count[It];Ue!==0;)gt<(Rt=ft.heap[--_t])||(Ur[2*Rt+1]!==It&&(ft.opt_len+=(It-Ur[2*Rt+1])*Ur[2*Rt],Ur[2*Rt+1]=It),Ue--)}}(ne,le),z(Ie,$e,ne.bl_count)}function we(ne,le,Re){var at,ze,Ie=-1,ue=le[1],Me=0,Je=7,$e=4;for(ue===0&&(Je=138,$e=3),le[2*(Re+1)+1]=65535,at=0;at<=Re;at++)ze=ue,ue=le[2*(at+1)+1],++Me<Je&&ze===ue||(Me<$e?ne.bl_tree[2*ze]+=Me:ze!==0?(ze!==Ie&&ne.bl_tree[2*ze]++,ne.bl_tree[32]++):Me<=10?ne.bl_tree[34]++:ne.bl_tree[36]++,Ie=ze,$e=(Me=0)===ue?(Je=138,3):ze===ue?(Je=6,3):(Je=7,4))}function Be(ne,le,Re){var at,ze,Ie=-1,ue=le[1],Me=0,Je=7,$e=4;for(ue===0&&(Je=138,$e=3),at=0;at<=Re;at++)if(ze=ue,ue=le[2*(at+1)+1],!(++Me<Je&&ze===ue)){if(Me<$e)for(;M(ne,ze,ne.bl_tree),--Me!=0;);else ze!==0?(ze!==Ie&&(M(ne,ze,ne.bl_tree),Me--),M(ne,16,ne.bl_tree),v(ne,Me-3,2)):Me<=10?(M(ne,17,ne.bl_tree),v(ne,Me-3,3)):(M(ne,18,ne.bl_tree),v(ne,Me-11,7));Ie=ze,$e=(Me=0)===ue?(Je=138,3):ze===ue?(Je=6,3):(Je=7,4)}}m(D);var re=!1;function fe(ne,le,Re,at){var ze,Ie,ue;v(ne,0+(at?1:0),3),Ie=le,ue=Re,te(ze=ne),u(ze,ue),u(ze,~ue),a.arraySet(ze.pending_buf,ze.window,Ie,ue,ze.pending),ze.pending+=ue}o._tr_init=function(ne){re||(function(){var le,Re,at,ze,Ie,ue=new Array(H+1);for(ze=at=0;ze<28;ze++)for(Y[ze]=at,le=0;le<1<<P[ze];le++)S[at++]=ze;for(S[at-1]=ze,ze=Ie=0;ze<16;ze++)for(D[ze]=Ie,le=0;le<1<<g[ze];le++)C[Ie++]=ze;for(Ie>>=7;ze<A;ze++)for(D[ze]=Ie<<7,le=0;le<1<<g[ze]-7;le++)C[256+Ie++]=ze;for(Re=0;Re<=H;Re++)ue[Re]=0;for(le=0;le<=143;)k[2*le+1]=8,le++,ue[8]++;for(;le<=255;)k[2*le+1]=9,le++,ue[9]++;for(;le<=279;)k[2*le+1]=7,le++,ue[7]++;for(;le<=287;)k[2*le+1]=8,le++,ue[8]++;for(z(k,287,ue),le=0;le<A;le++)U[2*le+1]=5,U[2*le]=j(le,5);G=new N(k,P,257,x,H),T=new N(U,g,0,A,H),B=new N(new Array(0),E,0,19,7)}(),re=!0),ne.l_desc=new I(ne.dyn_ltree,G),ne.d_desc=new I(ne.dyn_dtree,T),ne.bl_desc=new I(ne.bl_tree,B),ne.bi_buf=0,ne.bi_valid=0,J(ne)},o._tr_stored_block=fe,o._tr_flush_block=function(ne,le,Re,at){var ze,Ie,ue=0;0<ne.level?(ne.strm.data_type===2&&(ne.strm.data_type=function(Me){var Je,$e=4093624447;for(Je=0;Je<=31;Je++,$e>>>=1)if(1&$e&&Me.dyn_ltree[2*Je]!==0)return 0;if(Me.dyn_ltree[18]!==0||Me.dyn_ltree[20]!==0||Me.dyn_ltree[26]!==0)return 1;for(Je=32;Je<c;Je++)if(Me.dyn_ltree[2*Je]!==0)return 1;return 0}(ne)),Ee(ne,ne.l_desc),Ee(ne,ne.d_desc),ue=function(Me){var Je;for(we(Me,Me.dyn_ltree,Me.l_desc.max_code),we(Me,Me.dyn_dtree,Me.d_desc.max_code),Ee(Me,Me.bl_desc),Je=18;3<=Je&&Me.bl_tree[2*_[Je]+1]===0;Je--);return Me.opt_len+=3*(Je+1)+5+5+4,Je}(ne),ze=ne.opt_len+3+7>>>3,(Ie=ne.static_len+3+7>>>3)<=ze&&(ze=Ie)):ze=Ie=Re+5,Re+4<=ze&&le!==-1?fe(ne,le,Re,at):ne.strategy===4||Ie===ze?(v(ne,2+(at?1:0),3),ve(ne,k,U)):(v(ne,4+(at?1:0),3),function(Me,Je,$e,ft){var Pt;for(v(Me,Je-257,5),v(Me,$e-1,5),v(Me,ft-4,4),Pt=0;Pt<ft;Pt++)v(Me,Me.bl_tree[2*_[Pt]+1],3);Be(Me,Me.dyn_ltree,Je-1),Be(Me,Me.dyn_dtree,$e-1)}(ne,ne.l_desc.max_code+1,ne.d_desc.max_code+1,ue+1),ve(ne,ne.dyn_ltree,ne.dyn_dtree)),J(ne),at&&te(ne)},o._tr_tally=function(ne,le,Re){return ne.pending_buf[ne.d_buf+2*ne.last_lit]=le>>>8&255,ne.pending_buf[ne.d_buf+2*ne.last_lit+1]=255&le,ne.pending_buf[ne.l_buf+ne.last_lit]=255&Re,ne.last_lit++,le===0?ne.dyn_ltree[2*Re]++:(ne.matches++,le--,ne.dyn_ltree[2*(S[Re]+c+1)]++,ne.dyn_dtree[2*h(le)]++),ne.last_lit===ne.lit_bufsize-1},o._tr_align=function(ne){var le;v(ne,2,3),M(ne,256,k),(le=ne).bi_valid===16?(u(le,le.bi_buf),le.bi_buf=0,le.bi_valid=0):8<=le.bi_valid&&(le.pending_buf[le.pending++]=255&le.bi_buf,le.bi_buf>>=8,le.bi_valid-=8)}},{"../utils/common":4}],16:[function(b,n,o){n.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],17:[function(b,n,o){var a=b("three");a.OrbitControls=function(m,c){var x,A,H,F,P;c===void 0&&console.warn('THREE.OrbitControls: The second parameter "domElement" is now mandatory.'),c===document&&console.error('THREE.OrbitControls: "document" should not be used as the target "domElement". Please use "renderer.domElement" instead.'),this.object=m,this.domElement=c,this.enabled=!0,this.target=new a.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!1,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.enableKeys=!0,this.keys={LEFT:37,UP:38,RIGHT:39,BOTTOM:40},this.mouseButtons={LEFT:a.MOUSE.ROTATE,MIDDLE:a.MOUSE.DOLLY,RIGHT:a.MOUSE.PAN},this.touches={ONE:a.TOUCH.ROTATE,TWO:a.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this.getPolarAngle=function(){return Y.phi},this.getAzimuthalAngle=function(){return Y.theta},this.saveState=function(){g.target0.copy(g.target),g.position0.copy(g.object.position),g.zoom0=g.object.zoom},this.resetStatusValue=function(){C=U.NONE},this.reset=function(){g.target.copy(g.target0),g.object.position.copy(g.position0),g.object.zoom=g.zoom0,g.object.updateProjectionMatrix(),g.dispatchEvent(E),g.update(),C=U.NONE},this.update=(x=new a.Vector3,A=new a.Quaternion().setFromUnitVectors(m.up,new a.Vector3(0,1,0)),H=A.clone().inverse(),F=new a.Vector3,P=new a.Quaternion,function(){var gt=g.object.position;return x.copy(gt).sub(g.target),x.applyQuaternion(A),Y.setFromVector3(x),g.autoRotate&&C===U.NONE&&X(2*Math.PI/60/60*g.autoRotateSpeed),g.enableDamping?(Y.theta+=G.theta*g.dampingFactor,Y.phi+=G.phi*g.dampingFactor):(Y.theta+=G.theta,Y.phi+=G.phi),Y.theta=Math.max(g.minAzimuthAngle,Math.min(g.maxAzimuthAngle,Y.theta)),Y.phi=Math.max(g.minPolarAngle,Math.min(g.maxPolarAngle,Y.phi)),Y.makeSafe(),Y.radius*=T,Y.radius=Math.max(g.minDistance,Math.min(g.maxDistance,Y.radius)),g.enableDamping===!0?g.target.addScaledVector(B,g.dampingFactor):g.target.add(B),x.setFromSpherical(Y),x.applyQuaternion(H),gt.copy(g.target).add(x),g.object.lookAt(g.target),g.enableDamping===!0?(G.theta*=1-g.dampingFactor,G.phi*=1-g.dampingFactor,B.multiplyScalar(1-g.dampingFactor)):(G.set(0,0,0),B.set(0,0,0)),T=1,!(!(D||F.distanceToSquared(g.object.position)>S||8*(1-P.dot(g.object.quaternion))>S)||(g.dispatchEvent(E),F.copy(g.object.position),P.copy(g.object.quaternion),D=!1))}),this.dispose=function(){g.domElement.removeEventListener("contextmenu",Ur,!1),g.domElement.removeEventListener("mousedown",$e,!1),g.domElement.removeEventListener("wheel",_t,!1),g.domElement.removeEventListener("touchstart",It,!1),g.domElement.removeEventListener("touchend",Qt,!1),g.domElement.removeEventListener("touchmove",Nr,!1),document.removeEventListener("mousemove",ft,!1),document.removeEventListener("mouseup",Pt,!1),g.domElement.removeEventListener("keydown",Ue,!1)};var g=this,E={type:"change"},_={type:"start"},k={type:"end"},U={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6},C=U.NONE,S=1e-6,Y=new a.Spherical,G=new a.Spherical,T=1,B=new a.Vector3,D=!1,N=new a.Vector2,I=new a.Vector2,h=new a.Vector2,u=new a.Vector2,v=new a.Vector2,M=new a.Vector2,j=new a.Vector2,z=new a.Vector2,J=new a.Vector2;function te(){return Math.pow(.95,g.zoomSpeed)}function X(gt){G.theta-=gt}function se(gt){G.phi-=gt}var ve,Ee,we,Be=(ve=new a.Vector3,function(gt,We){ve.setFromMatrixColumn(We,0),ve.multiplyScalar(-gt),B.add(ve)}),re=(Ee=new a.Vector3,function(gt,We){g.screenSpacePanning===!0?Ee.setFromMatrixColumn(We,1):(Ee.setFromMatrixColumn(We,0),Ee.crossVectors(g.object.up,Ee)),Ee.multiplyScalar(gt),B.add(Ee)}),fe=(we=new a.Vector3,function(gt,We){var Yt=g.domElement;if(g.object.isPerspectiveCamera){var Or=g.object.position;we.copy(Or).sub(g.target);var Yr=we.length();Yr*=Math.tan(g.object.fov/2*Math.PI/180),Be(2*gt*Yr/Yt.clientHeight,g.object.matrix),re(2*We*Yr/Yt.clientHeight,g.object.matrix)}else g.object.isOrthographicCamera?(Be(gt*(g.object.right-g.object.left)/g.object.zoom/Yt.clientWidth,g.object.matrix),re(We*(g.object.top-g.object.bottom)/g.object.zoom/Yt.clientHeight,g.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),g.enablePan=!1)});function ne(gt){g.object.isPerspectiveCamera?T/=gt:g.object.isOrthographicCamera?(g.object.zoom=Math.max(g.minZoom,Math.min(g.maxZoom,g.object.zoom*gt)),g.object.updateProjectionMatrix(),D=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),g.enableZoom=!1)}function le(gt){N.set(gt.clientX,gt.clientY)}function Re(gt){u.set(gt.clientX,gt.clientY)}function at(gt){if(gt.touches.length==1)N.set(gt.touches[0].pageX,gt.touches[0].pageY);else{var We=.5*(gt.touches[0].pageX+gt.touches[1].pageX),Yt=.5*(gt.touches[0].pageY+gt.touches[1].pageY);N.set(We,Yt)}}function ze(gt){if(gt.touches.length==1)u.set(gt.touches[0].pageX,gt.touches[0].pageY);else{var We=.5*(gt.touches[0].pageX+gt.touches[1].pageX),Yt=.5*(gt.touches[0].pageY+gt.touches[1].pageY);u.set(We,Yt)}}function Ie(gt){var We=gt.touches[0].pageX-gt.touches[1].pageX,Yt=gt.touches[0].pageY-gt.touches[1].pageY,Or=Math.sqrt(We*We+Yt*Yt);j.set(0,Or)}function ue(gt){if(gt.touches.length==1)I.set(gt.touches[0].pageX,gt.touches[0].pageY);else{var We=.5*(gt.touches[0].pageX+gt.touches[1].pageX),Yt=.5*(gt.touches[0].pageY+gt.touches[1].pageY);I.set(We,Yt)}h.subVectors(I,N).multiplyScalar(g.rotateSpeed);var Or=g.domElement;X(2*Math.PI*h.x/Or.clientHeight),se(2*Math.PI*h.y/Or.clientHeight),N.copy(I)}function Me(gt){if(gt.touches.length==1)v.set(gt.touches[0].pageX,gt.touches[0].pageY);else{var We=.5*(gt.touches[0].pageX+gt.touches[1].pageX),Yt=.5*(gt.touches[0].pageY+gt.touches[1].pageY);v.set(We,Yt)}M.subVectors(v,u).multiplyScalar(g.panSpeed),fe(M.x,M.y),u.copy(v)}function Je(gt){var We=gt.touches[0].pageX-gt.touches[1].pageX,Yt=gt.touches[0].pageY-gt.touches[1].pageY,Or=Math.sqrt(We*We+Yt*Yt);z.set(0,Or),J.set(0,Math.pow(z.y/j.y,g.zoomSpeed)),ne(J.y),j.copy(z)}function $e(gt){if(g.enabled!==!1){switch(gt.preventDefault(),g.domElement.focus?g.domElement.focus():window.focus(),gt.button){case 0:switch(g.mouseButtons.LEFT){case a.MOUSE.ROTATE:if(gt.ctrlKey||gt.metaKey||gt.shiftKey){if(g.enablePan===!1)return;Re(gt),C=U.PAN}else{if(g.enableRotate===!1)return;le(gt),C=U.ROTATE}break;case a.MOUSE.PAN:if(gt.ctrlKey||gt.metaKey||gt.shiftKey){if(g.enableRotate===!1)return;le(gt),C=U.ROTATE}else{if(g.enablePan===!1)return;Re(gt),C=U.PAN}break;default:C=U.NONE}break;case 1:switch(g.mouseButtons.MIDDLE){case a.MOUSE.DOLLY:if(g.enableZoom===!1)return;We=gt,j.set(We.clientX,We.clientY),C=U.DOLLY;break;case a.MOUSE.PAN:if(g.enablePan===!1)return;Re(gt),C=U.PAN;break;default:C=U.NONE}break;case 2:switch(g.mouseButtons.RIGHT){case a.MOUSE.ROTATE:if(g.enableRotate===!1)return;le(gt),C=U.ROTATE;break;case a.MOUSE.PAN:if(g.enablePan===!1)return;Re(gt),C=U.PAN;break;default:C=U.NONE}}var We;C!==U.NONE&&(document.addEventListener("mousemove",ft,!1),document.addEventListener("mouseup",Pt,!1),g.dispatchEvent(_))}}function ft(gt){var We;if(g.enabled!==!1)switch(gt.preventDefault(),C){case U.ROTATE:if(g.enableRotate===!1)return;(function(Yt){I.set(Yt.clientX,Yt.clientY),h.subVectors(I,N).multiplyScalar(g.rotateSpeed);var Or=g.domElement;X(2*Math.PI*h.x/Or.clientHeight),se(2*Math.PI*h.y/Or.clientHeight),N.copy(I),g.update()})(gt);break;case U.DOLLY:if(g.enableZoom===!1)return;(function(Yt){var Or;z.set(Yt.clientX,Yt.clientY),J.subVectors(z,j),0<J.y?ne(te()):J.y<0&&(Or=te(),g.object.isPerspectiveCamera?T*=Or:g.object.isOrthographicCamera?(g.object.zoom=Math.max(g.minZoom,Math.min(g.maxZoom,g.object.zoom/Or)),g.object.updateProjectionMatrix(),D=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),g.enableZoom=!1)),j.copy(z),g.update()})(gt);break;case U.PAN:if(g.enablePan===!1)return;We=gt,v.set(We.clientX,We.clientY),M.subVectors(v,u).multiplyScalar(g.panSpeed),fe(M.x,M.y),u.copy(v),g.update()}}function Pt(gt){g.enabled!==!1&&(document.removeEventListener("mousemove",ft,!1),document.removeEventListener("mouseup",Pt,!1),g.dispatchEvent(k),C=U.NONE)}function _t(gt){g.enabled===!1||g.enableZoom===!1||C!==U.NONE&&C!==U.ROTATE||(gt.preventDefault(),gt.stopPropagation(),g.dispatchEvent(_),function(We){We.deltaY<0?function(Yt,Or){if(g.object.isPerspectiveCamera)Gn*=Yt;else if(g.object.isOrthographicCamera){var Yr=g.domElement.clientWidth,ct=g.domElement.clientHeight,st=(g.object.near+g.object.far)/(g.object.near-g.object.far),qt=Or.offsetX,Tr=Or.offsetY,ir=new a.Vector3(qt/Yr*2-1,-Tr/ct*2+1,st);ir.applyMatrix4(g.object.projectionMatrixInverse);var Hr=new a.Vector3(-1,-1,st),vn=new a.Vector3(1,1,st);Hr.applyMatrix4(g.object.projectionMatrixInverse),vn.applyMatrix4(g.object.projectionMatrixInverse);var In=Math.max(g.minZoom,Math.min(g.maxZoom,1/Yt)),Zr=new a.Matrix4;Zr.makeTranslation(-ir.x,-ir.y,0);var Gn=new a.Matrix4().scale(new a.Vector3(1/In,1/In,1/In)),lt=new a.Matrix4;lt.makeTranslation(ir.x,ir.y,0);var xe=new a.Matrix4().multiply(lt).multiply(Gn).multiply(Zr);Hr.applyMatrix4(xe),vn.applyMatrix4(xe),g.object.left=Hr.x,g.object.right=vn.x,g.object.top=vn.y,g.object.bottom=Hr.y,g.object.zoom=1,g.object.updateProjectionMatrix(),D=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),g.enableZoom=!1}(te(),We):0<We.deltaY&&function(Yt,Or){if(g.object.isPerspectiveCamera)Gn/=Yt;else if(g.object.isOrthographicCamera){var Yr=g.domElement.clientWidth,ct=g.domElement.clientHeight,st=(g.object.near+g.object.far)/(g.object.near-g.object.far),qt=Or.offsetX,Tr=Or.offsetY,ir=new a.Vector3(qt/Yr*2-1,-Tr/ct*2+1,st);ir.applyMatrix4(g.object.projectionMatrixInverse);var Hr=new a.Vector3(-1,-1,st),vn=new a.Vector3(1,1,st);Hr.applyMatrix4(g.object.projectionMatrixInverse),vn.applyMatrix4(g.object.projectionMatrixInverse);var In=Math.max(g.minZoom,Math.min(g.maxZoom,Yt)),Zr=new a.Matrix4;Zr.makeTranslation(-ir.x,-ir.y,0);var Gn=new a.Matrix4().scale(new a.Vector3(1/In,1/In,1/In)),lt=new a.Matrix4;lt.makeTranslation(ir.x,ir.y,0);var xe=new a.Matrix4().multiply(lt).multiply(Gn).multiply(Zr);Hr.applyMatrix4(xe),vn.applyMatrix4(xe),g.object.left=Hr.x,g.object.right=vn.x,g.object.top=vn.y,g.object.bottom=Hr.y,g.object.zoom=1,g.object.updateProjectionMatrix(),D=!0}else console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),g.enableZoom=!1}(te(),We),g.update()}(gt),g.dispatchEvent(k))}function Ue(gt){g.enabled!==!1&&g.enableKeys!==!1&&g.enablePan!==!1&&function(We){var Yt=!1;switch(We.keyCode){case g.keys.UP:fe(0,g.keyPanSpeed),Yt=!0;break;case g.keys.BOTTOM:fe(0,-g.keyPanSpeed),Yt=!0;break;case g.keys.LEFT:fe(g.keyPanSpeed,0),Yt=!0;break;case g.keys.RIGHT:fe(-g.keyPanSpeed,0),Yt=!0}Yt&&(We.preventDefault(),g.update())}(gt)}function Rt(gt){switch(gt.touches.length){case 1:switch(g.touches.ONE){case a.TOUCH.ROTATE:if(g.enableRotate===!1)return;at(gt),C=U.TOUCH_ROTATE;break;case a.TOUCH.PAN:if(g.enablePan===!1)return;ze(gt),C=U.TOUCH_PAN;break;default:C=U.NONE}break;case 2:switch(g.touches.TWO){case a.TOUCH.DOLLY_PAN:if(g.enableZoom===!1&&g.enablePan===!1)return;Yt=gt,g.enableZoom&&Ie(Yt),g.enablePan&&ze(Yt),C=U.TOUCH_DOLLY_PAN;break;case a.TOUCH.DOLLY_ROTATE:if(g.enableZoom===!1&&g.enableRotate===!1)return;We=gt,g.enableZoom&&Ie(We),g.enableRotate&&at(We),C=U.TOUCH_DOLLY_ROTATE;break;default:C=U.NONE}break;default:C=U.NONE}var We,Yt}function It(gt){g.enabled!==!1&&(gt.preventDefault(),Rt(gt),C!==U.NONE&&g.dispatchEvent(_))}function Nr(gt){var We,Yt;if(g.enabled!==!1)switch(gt.preventDefault(),gt.stopPropagation(),C){case U.TOUCH_ROTATE:if(g.enableRotate===!1)return;ue(gt),g.update();break;case U.TOUCH_PAN:if(g.enablePan===!1)return;Me(gt),g.update();break;case U.TOUCH_DOLLY_PAN:if(g.enableZoom===!1&&g.enablePan===!1)return;Yt=gt,g.enableZoom&&Je(Yt),g.enablePan&&Me(Yt),g.update();break;case U.TOUCH_DOLLY_ROTATE:if(g.enableZoom===!1&&g.enableRotate===!1)return;We=gt,g.enableZoom&&Je(We),g.enableRotate&&ue(We),g.update();break;default:Rt(gt)}}function Qt(gt){g.enabled!==!1&&(g.dispatchEvent(k),C=U.NONE)}function Ur(gt){g.enabled!==!1&&gt.preventDefault()}g.domElement.addEventListener("contextmenu",Ur,!1),g.domElement.addEventListener("mousedown",$e,!1),g.domElement.addEventListener("wheel",_t,!1),g.domElement.addEventListener("touchstart",It,!1),g.domElement.addEventListener("touchend",Qt,!1),g.domElement.addEventListener("touchmove",Nr,!1),g.domElement.addEventListener("keydown",Ue,!1),g.domElement.tabIndex===-1&&(g.domElement.tabIndex=0),this.update()},a.OrbitControls.prototype=Object.create(a.EventDispatcher.prototype),a.OrbitControls.prototype.constructor=a.OrbitControls,a.MapControls=function(m,c){a.OrbitControls.call(this,m,c),this.mouseButtons.LEFT=a.MOUSE.PAN,this.mouseButtons.RIGHT=a.MOUSE.ROTATE,this.touches.ONE=a.TOUCH.PAN,this.touches.TWO=a.TOUCH.DOLLY_ROTATE},a.MapControls.prototype=Object.create(a.EventDispatcher.prototype),a.MapControls.prototype.constructor=a.MapControls,o!==void 0&&(n!==void 0&&n.exports&&(o=n.exports={OrbitControls:a.OrbitControls,MapControls:a.MapControls}),o.OrbitControls=a.OrbitControls,o.MapControls=a.MapControls)},{three:19}],18:[function(b,n,o){(function(){var a,m,c,x=b!==void 0,A=this.THREE||x&&b("three");if(!A)throw new Error("MeshLine requires three.js");function H(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new A.BufferGeometry,this.widthCallback=null,this.matrixWorld=new A.Matrix4}function F(g,E,_,k,U){var C;if(g=g.subarray||g.slice?g:g.buffer,_=_.subarray||_.slice?_:_.buffer,g=E?g.subarray?g.subarray(E,U&&E+U):g.slice(E,U&&E+U):g,_.set)_.set(g,k);else for(C=0;C<g.length;C++)_[C+k]=g[C];return _}function P(g){A.ShaderMaterial.call(this,{uniforms:Object.assign({},A.UniformsLib.fog,{lineWidth:{value:1},map:{value:null},useMap:{value:0},alphaMap:{value:null},useAlphaMap:{value:0},color:{value:new A.Color(16777215)},opacity:{value:1},resolution:{value:new A.Vector2(1,1)},sizeAttenuation:{value:1},near:{value:1},far:{value:1},dashArray:{value:0},dashOffset:{value:0},dashRatio:{value:.5},useDash:{value:0},visibility:{value:1},alphaTest:{value:0},repeat:{value:new A.Vector2(1,1)}}),vertexShader:A.ShaderChunk.meshline_vert,fragmentShader:A.ShaderChunk.meshline_frag}),this.type="MeshLineMaterial",Object.defineProperties(this,{lineWidth:{enumerable:!0,get:function(){return this.uniforms.lineWidth.value},set:function(E){this.uniforms.lineWidth.value=E}},map:{enumerable:!0,get:function(){return this.uniforms.map.value},set:function(E){this.uniforms.map.value=E}},useMap:{enumerable:!0,get:function(){return this.uniforms.useMap.value},set:function(E){this.uniforms.useMap.value=E}},alphaMap:{enumerable:!0,get:function(){return this.uniforms.alphaMap.value},set:function(E){this.uniforms.alphaMap.value=E}},useAlphaMap:{enumerable:!0,get:function(){return this.uniforms.useAlphaMap.value},set:function(E){this.uniforms.useAlphaMap.value=E}},color:{enumerable:!0,get:function(){return this.uniforms.color.value},set:function(E){this.uniforms.color.value=E}},opacity:{enumerable:!0,get:function(){return this.uniforms.opacity.value},set:function(E){this.uniforms.opacity.value=E}},resolution:{enumerable:!0,get:function(){return this.uniforms.resolution.value},set:function(E){this.uniforms.resolution.value.copy(E)}},sizeAttenuation:{enumerable:!0,get:function(){return this.uniforms.sizeAttenuation.value},set:function(E){this.uniforms.sizeAttenuation.value=E}},near:{enumerable:!0,get:function(){return this.uniforms.near.value},set:function(E){this.uniforms.near.value=E}},far:{enumerable:!0,get:function(){return this.uniforms.far.value},set:function(E){this.uniforms.far.value=E}},dashArray:{enumerable:!0,get:function(){return this.uniforms.dashArray.value},set:function(E){this.uniforms.dashArray.value=E,this.useDash=E!==0?1:0}},dashOffset:{enumerable:!0,get:function(){return this.uniforms.dashOffset.value},set:function(E){this.uniforms.dashOffset.value=E}},dashRatio:{enumerable:!0,get:function(){return this.uniforms.dashRatio.value},set:function(E){this.uniforms.dashRatio.value=E}},useDash:{enumerable:!0,get:function(){return this.uniforms.useDash.value},set:function(E){this.uniforms.useDash.value=E}},visibility:{enumerable:!0,get:function(){return this.uniforms.visibility.value},set:function(E){this.uniforms.visibility.value=E}},alphaTest:{enumerable:!0,get:function(){return this.uniforms.alphaTest.value},set:function(E){this.uniforms.alphaTest.value=E}},repeat:{enumerable:!0,get:function(){return this.uniforms.repeat.value},set:function(E){this.uniforms.repeat.value.copy(E)}}}),this.setValues(g)}H.prototype.setMatrixWorld=function(g){this.matrixWorld=g},H.prototype.setGeometry=function(g,E){if(this.widthCallback=E,this.positions=[],this.counters=[],g instanceof A.Geometry)for(var _=0;_<g.vertices.length;_++){var k=g.vertices[_];E=_/g.vertices.length,this.positions.push(k.x,k.y,k.z),this.positions.push(k.x,k.y,k.z),this.counters.push(E),this.counters.push(E)}if(A.BufferGeometry,g instanceof Float32Array||g instanceof Array)for(_=0;_<g.length;_+=3)E=_/g.length,this.positions.push(g[_],g[_+1],g[_+2]),this.positions.push(g[_],g[_+1],g[_+2]),this.counters.push(E),this.counters.push(E);this.process()},H.prototype.raycast=(a=new A.Matrix4,m=new A.Ray,c=new A.Sphere,function(g,E){var _=g.linePrecision,k=_*_,U=this.geometry;if(U.boundingSphere===null&&U.computeBoundingSphere(),c.copy(U.boundingSphere),c.applyMatrix4(this.matrixWorld),g.ray.intersectSphere(c)!==!1){a.getInverse(this.matrixWorld),m.copy(g.ray).applyMatrix4(a);var C=new A.Vector3,S=new A.Vector3,Y=new A.Vector3,G=new A.Vector3,T=this instanceof A.LineSegments?2:1;if(U instanceof A.BufferGeometry){var B=U.index,D=U.attributes;if(B!==null)for(var N=B.array,I=D.position.array,h=0,u=N.length-1;h<u;h+=T){var v=N[h],M=N[h+1];C.fromArray(I,3*v),S.fromArray(I,3*M),k<m.distanceSqToSegment(C,S,G,Y)||(G.applyMatrix4(this.matrixWorld),(J=g.ray.origin.distanceTo(G))<g.near||J>g.far||E.push({distance:J,point:Y.clone().applyMatrix4(this.matrixWorld),index:h,face:null,faceIndex:null,object:this}))}else for(h=0,u=(I=D.position.array).length/3-1;h<u;h+=T)C.fromArray(I,3*h),S.fromArray(I,3*h+3),k<m.distanceSqToSegment(C,S,G,Y)||(G.applyMatrix4(this.matrixWorld),(J=g.ray.origin.distanceTo(G))<g.near||J>g.far||E.push({distance:J,point:Y.clone().applyMatrix4(this.matrixWorld),index:h,face:null,faceIndex:null,object:this}))}else if(U instanceof A.Geometry){var j=U.vertices,z=j.length;for(h=0;h<z-1;h+=T){var J;k<m.distanceSqToSegment(j[h],j[h+1],G,Y)||(G.applyMatrix4(this.matrixWorld),(J=g.ray.origin.distanceTo(G))<g.near||J>g.far||E.push({distance:J,point:Y.clone().applyMatrix4(this.matrixWorld),index:h,face:null,faceIndex:null,object:this}))}}}}),H.prototype.compareV3=function(g,E){var _=6*g,k=6*E;return this.positions[_]===this.positions[k]&&this.positions[1+_]===this.positions[1+k]&&this.positions[2+_]===this.positions[2+k]},H.prototype.copyV3=function(g){var E=6*g;return[this.positions[E],this.positions[1+E],this.positions[2+E]]},H.prototype.process=function(){var g,E,_=this.positions.length/6;this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[];for(var k=0;k<_;k++)this.side.push(1),this.side.push(-1);for(k=0;k<_;k++)g=this.widthCallback?this.widthCallback(k/(_-1)):1,this.width.push(g),this.width.push(g);for(k=0;k<_;k++)this.uvs.push(k/(_-1),0),this.uvs.push(k/(_-1),1);for(E=this.compareV3(0,_-1)?this.copyV3(_-2):this.copyV3(0),this.previous.push(E[0],E[1],E[2]),this.previous.push(E[0],E[1],E[2]),k=0;k<_-1;k++)E=this.copyV3(k),this.previous.push(E[0],E[1],E[2]),this.previous.push(E[0],E[1],E[2]);for(k=1;k<_;k++)E=this.copyV3(k),this.next.push(E[0],E[1],E[2]),this.next.push(E[0],E[1],E[2]);for(E=this.compareV3(_-1,0)?this.copyV3(1):this.copyV3(_-1),this.next.push(E[0],E[1],E[2]),this.next.push(E[0],E[1],E[2]),k=0;k<_-1;k++){var U=2*k;this.indices_array.push(U,1+U,2+U),this.indices_array.push(2+U,1+U,3+U)}this.attributes?(this.attributes.position.copyArray(new Float32Array(this.positions)),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(new Float32Array(this.previous)),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(new Float32Array(this.next)),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(new Float32Array(this.side)),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(new Float32Array(this.width)),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(new Float32Array(this.uvs)),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(new Uint16Array(this.indices_array)),this.attributes.index.needsUpdate=!0):this.attributes={position:new A.BufferAttribute(new Float32Array(this.positions),3),previous:new A.BufferAttribute(new Float32Array(this.previous),3),next:new A.BufferAttribute(new Float32Array(this.next),3),side:new A.BufferAttribute(new Float32Array(this.side),1),width:new A.BufferAttribute(new Float32Array(this.width),1),uv:new A.BufferAttribute(new Float32Array(this.uvs),2),index:new A.BufferAttribute(new Uint16Array(this.indices_array),1),counters:new A.BufferAttribute(new Float32Array(this.counters),1)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setIndex(this.attributes.index)},H.prototype.advance=function(g){var E=this.attributes.position.array,_=this.attributes.previous.array,k=this.attributes.next.array,U=E.length;F(E,0,_,0,U),F(E,6,E,0,U-6),E[U-6]=g.x,E[U-5]=g.y,E[U-4]=g.z,E[U-3]=g.x,E[U-2]=g.y,E[U-1]=g.z,F(E,6,k,0,U-6),k[U-6]=g.x,k[U-5]=g.y,k[U-4]=g.z,k[U-3]=g.x,k[U-2]=g.y,k[U-1]=g.z,this.attributes.position.needsUpdate=!0,this.attributes.previous.needsUpdate=!0,this.attributes.next.needsUpdate=!0},A.ShaderChunk.meshline_vert=["",A.ShaderChunk.logdepthbuf_pars_vertex,A.ShaderChunk.fog_pars_vertex,"","attribute vec3 previous;","attribute vec3 next;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","	 vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","","    vColor = vec4( color, opacity );","    vUV = uv;","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float w = lineWidth * width;","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec4 normal = vec4( -dir.y, dir.x, 0., 1. );","    normal.xy *= .5 * w;","    normal *= projectionMatrix;","    if( sizeAttenuation == 0. ) {","        normal.xy *= finalPosition.w;","        normal.xy /= ( vec4( resolution, 0., 1. ) * projectionMatrix ).xy;","    }","","    finalPosition.xy += normal.xy * side;","","    gl_Position = finalPosition;","",A.ShaderChunk.logdepthbuf_vertex,A.ShaderChunk.fog_vertex&&"    vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );",A.ShaderChunk.fog_vertex,"}"].join(`
`),A.ShaderChunk.meshline_frag=["",A.ShaderChunk.fog_pars_fragment,A.ShaderChunk.logdepthbuf_pars_fragment,"","uniform sampler2D map;","uniform sampler2D alphaMap;","uniform float useMap;","uniform float useAlphaMap;","uniform float useDash;","uniform float dashArray;","uniform float dashOffset;","uniform float dashRatio;","uniform float visibility;","uniform float alphaTest;","uniform vec2 repeat;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","void main() {","",A.ShaderChunk.logdepthbuf_fragment,"","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV * repeat );","    if( useAlphaMap == 1. ) c.a *= texture2D( alphaMap, vUV * repeat ).a;","    if( c.a < alphaTest ) discard;","    if( useDash == 1. ){","        c.a *= ceil(mod(vCounters + dashOffset, dashArray) - (dashArray * dashRatio));","    }","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","",A.ShaderChunk.fog_fragment,"}"].join(`
`),((P.prototype=Object.create(A.ShaderMaterial.prototype)).constructor=P).prototype.isMeshLineMaterial=!0,P.prototype.copy=function(g){return A.ShaderMaterial.prototype.copy.call(this,g),this.lineWidth=g.lineWidth,this.map=g.map,this.useMap=g.useMap,this.alphaMap=g.alphaMap,this.useAlphaMap=g.useAlphaMap,this.color.copy(g.color),this.opacity=g.opacity,this.resolution.copy(g.resolution),this.sizeAttenuation=g.sizeAttenuation,this.near=g.near,this.far=g.far,this.dashArray.copy(g.dashArray),this.dashOffset.copy(g.dashOffset),this.dashRatio.copy(g.dashRatio),this.useDash=g.useDash,this.visibility=g.visibility,this.alphaTest=g.alphaTest,this.repeat.copy(g.repeat),this},o!==void 0?(n!==void 0&&n.exports&&(o=n.exports={MeshLine:H,MeshLineMaterial:P}),o.MeshLine=H,o.MeshLineMaterial=P):(this.MeshLine=H,this.MeshLineMaterial=P)}).call(this)},{three:19}],19:[function(b,n,o){var a,m;a=this,m=function(c){Number.EPSILON===void 0&&(Number.EPSILON=Math.pow(2,-52)),Number.isInteger===void 0&&(Number.isInteger=function(e){return typeof e=="number"&&isFinite(e)&&Math.floor(e)===e}),Math.sign===void 0&&(Math.sign=function(e){return e<0?-1:0<e?1:+e}),"name"in Function.prototype==0&&Object.defineProperty(Function.prototype,"name",{get:function(){return this.toString().match(/^\s*function\s*([^\(\s]*)/)[1]}}),Object.assign===void 0&&(Object.assign=function(e){if(e==null)throw new TypeError("Cannot convert undefined or null to object");for(var t=Object(e),r=1;r<arguments.length;r++){var i=arguments[r];if(i!=null)for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&(t[l]=i[l])}return t});var x=0,A=1,H=2,F=1,P=2,g=3,E=0,_=1,k=2,U=0,C=0,S=1,Y=2,G=3,T=4,B=5,D=100,N=101,I=102,h=103,u=104,v=200,M=201,j=202,z=203,J=204,te=205,X=206,se=207,ve=208,Ee=209,we=210,Be=0,re=1,fe=2,ne=3,le=4,Re=5,at=6,ze=7,Ie=0,ue=1,Me=2,Je=0,$e=1,ft=2,Pt=3,_t=4,Ue=5,Rt=301,It=302,Nr=303,Qt=304,Ur=305,gt=306,We=307,Yt=1e3,Or=1001,Yr=1002,ct=1003,st=1004,qt=1005,Tr=1006,ir=1007,Hr=1008,vn=1009,In=1010,Zr=1011,Gn=1012,lt=1013,xe=1014,ke=1015,bt=1016,er=1017,Ar=1018,Cr=1019,Kr=1020,_n=1021,Sn=1022,Tn=1023,Sa=1024,hi=1025,ri=Tn,an=1026,Mi=1027,q=1028,Cn=1029,pi=1030,Fr=1031,Ei=1032,vo=1033,ts=33776,Do=33777,ms=33778,to=33779,rs=35840,sa=35841,Fo=35842,Ea=35843,gs=36196,Bs=37808,ro=37809,ys=37810,Oa=37811,vs=37812,no=37813,io=37814,Xn=37815,An=37816,ns=37817,xs=37818,is=37819,Bo=37820,Xi=37821,Fn=2300,Q=2301,De=2400,ce=2401,Ce=2402,Ke=3e3,yt=3001,Vt=3007,Wt=3002,Pr=3003,Br=3004,ln=3005,di=3006,ao=3200,Oi=3201,xo=0,So=1,oo=7680,Gs=519,Jn=35044,wa=35048;function Ia(){}Object.assign(Ia.prototype,{addEventListener:function(e,t){this._listeners===void 0&&(this._listeners={});var r=this._listeners;r[e]===void 0&&(r[e]=[]),r[e].indexOf(t)===-1&&r[e].push(t)},hasEventListener:function(e,t){if(this._listeners===void 0)return!1;var r=this._listeners;return r[e]!==void 0&&r[e].indexOf(t)!==-1},removeEventListener:function(e,t){if(this._listeners!==void 0){var r=this._listeners[e];if(r!==void 0){var i=r.indexOf(t);i!==-1&&r.splice(i,1)}}},dispatchEvent:function(e){if(this._listeners!==void 0){var t=this._listeners[e.type];if(t!==void 0){e.target=this;for(var r=t.slice(0),i=0,l=r.length;i<l;i++)r[i].call(this,e)}}}});for(var ta=[],Go=0;Go<256;Go++)ta[Go]=(Go<16?"0":"")+Go.toString(16);var ws,xn={DEG2RAD:Math.PI/180,RAD2DEG:180/Math.PI,generateUUID:function(){var e=4294967295*Math.random()|0,t=4294967295*Math.random()|0,r=4294967295*Math.random()|0,i=4294967295*Math.random()|0;return(ta[255&e]+ta[e>>8&255]+ta[e>>16&255]+ta[e>>24&255]+"-"+ta[255&t]+ta[t>>8&255]+"-"+ta[t>>16&15|64]+ta[t>>24&255]+"-"+ta[63&r|128]+ta[r>>8&255]+"-"+ta[r>>16&255]+ta[r>>24&255]+ta[255&i]+ta[i>>8&255]+ta[i>>16&255]+ta[i>>24&255]).toUpperCase()},clamp:function(e,t,r){return Math.max(t,Math.min(r,e))},euclideanModulo:function(e,t){return(e%t+t)%t},mapLinear:function(e,t,r,i,l){return i+(e-t)*(l-i)/(r-t)},lerp:function(e,t,r){return(1-r)*e+r*t},smoothstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*(3-2*e)},smootherstep:function(e,t,r){return e<=t?0:r<=e?1:(e=(e-t)/(r-t))*e*e*(e*(6*e-15)+10)},randInt:function(e,t){return e+Math.floor(Math.random()*(t-e+1))},randFloat:function(e,t){return e+Math.random()*(t-e)},randFloatSpread:function(e){return e*(.5-Math.random())},degToRad:function(e){return e*xn.DEG2RAD},radToDeg:function(e){return e*xn.RAD2DEG},isPowerOfTwo:function(e){return(e&e-1)==0&&e!==0},ceilPowerOfTwo:function(e){return Math.pow(2,Math.ceil(Math.log(e)/Math.LN2))},floorPowerOfTwo:function(e){return Math.pow(2,Math.floor(Math.log(e)/Math.LN2))},setQuaternionFromProperEuler:function(e,t,r,i,l){var p=Math.cos,f=Math.sin,w=p(r/2),L=f(r/2),V=p((t+i)/2),Z=f((t+i)/2),ee=p((t-i)/2),ae=f((t-i)/2),W=p((i-t)/2),he=f((i-t)/2);l==="XYX"?e.set(w*Z,L*ee,L*ae,w*V):l==="YZY"?e.set(L*ae,w*Z,L*ee,w*V):l==="ZXZ"?e.set(L*ee,L*ae,w*Z,w*V):l==="XZX"?e.set(w*Z,L*he,L*W,w*V):l==="YXY"?e.set(L*W,w*Z,L*he,w*V):l==="ZYZ"?e.set(L*he,L*W,w*Z,w*V):console.warn("THREE.MathUtils: .setQuaternionFromProperEuler() encountered an unknown order.")}};function Gt(e,t){this.x=e||0,this.y=t||0}function Ai(){this.elements=[1,0,0,0,1,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix3: the constructor no longer reads arguments. use .set() instead.")}Object.defineProperties(Gt.prototype,{width:{get:function(){return this.x},set:function(e){this.x=e}},height:{get:function(){return this.y},set:function(e){this.y=e}}}),Object.assign(Gt.prototype,{isVector2:!0,set:function(e,t){return this.x=e,this.y=t,this},setScalar:function(e){return this.x=e,this.y=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y)},copy:function(e){return this.x=e.x,this.y=e.y,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this)},addScalar:function(e){return this.x+=e,this.y+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector2: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this)},subScalar:function(e){return this.x-=e,this.y-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this},multiply:function(e){return this.x*=e.x,this.y*=e.y,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this},divide:function(e){return this.x/=e.x,this.y/=e.y,this},divideScalar:function(e){return this.multiplyScalar(1/e)},applyMatrix3:function(e){var t=this.x,r=this.y,i=e.elements;return this.x=i[0]*t+i[3]*r+i[6],this.y=i[1]*t+i[4]*r+i[7],this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this},negate:function(){return this.x=-this.x,this.y=-this.y,this},dot:function(e){return this.x*e.x+this.y*e.y},cross:function(e){return this.x*e.y-this.y*e.x},lengthSq:function(){return this.x*this.x+this.y*this.y},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)},normalize:function(){return this.divideScalar(this.length()||1)},angle:function(){var e=Math.atan2(this.y,this.x);return e<0&&(e+=2*Math.PI),e},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y;return t*t+r*r},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector2: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this},rotateAround:function(e,t){var r=Math.cos(t),i=Math.sin(t),l=this.x-e.x,p=this.y-e.y;return this.x=l*r-p*i+e.x,this.y=l*i+p*r+e.y,this}}),Object.assign(Ai.prototype,{isMatrix3:!0,set:function(e,t,r,i,l,p,f,w,L){var V=this.elements;return V[0]=e,V[1]=i,V[2]=f,V[3]=t,V[4]=l,V[5]=w,V[6]=r,V[7]=p,V[8]=L,this},identity:function(){return this.set(1,0,0,0,1,0,0,0,1),this},clone:function(){return new this.constructor().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],this},setFromMatrix4:function(e){var t=e.elements;return this.set(t[0],t[4],t[8],t[1],t[5],t[9],t[2],t[6],t[10]),this},multiply:function(e){return this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,l=this.elements,p=r[0],f=r[3],w=r[6],L=r[1],V=r[4],Z=r[7],ee=r[2],ae=r[5],W=r[8],he=i[0],ge=i[3],ye=i[6],Ae=i[1],je=i[4],He=i[7],et=i[2],Ge=i[5],it=i[8];return l[0]=p*he+f*Ae+w*et,l[3]=p*ge+f*je+w*Ge,l[6]=p*ye+f*He+w*it,l[1]=L*he+V*Ae+Z*et,l[4]=L*ge+V*je+Z*Ge,l[7]=L*ye+V*He+Z*it,l[2]=ee*he+ae*Ae+W*et,l[5]=ee*ge+ae*je+W*Ge,l[8]=ee*ye+ae*He+W*it,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[3]*=e,t[6]*=e,t[1]*=e,t[4]*=e,t[7]*=e,t[2]*=e,t[5]*=e,t[8]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[1],i=e[2],l=e[3],p=e[4],f=e[5],w=e[6],L=e[7],V=e[8];return t*p*V-t*f*L-r*l*V+r*f*w+i*l*L-i*p*w},getInverse:function(e,t){e&&e.isMatrix4&&console.error("THREE.Matrix3: .getInverse() no longer takes a Matrix4 argument.");var r=e.elements,i=this.elements,l=r[0],p=r[1],f=r[2],w=r[3],L=r[4],V=r[5],Z=r[6],ee=r[7],ae=r[8],W=ae*L-V*ee,he=V*Z-ae*w,ge=ee*w-L*Z,ye=l*W+p*he+f*ge;if(ye==0){var Ae="THREE.Matrix3: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(Ae);return console.warn(Ae),this.identity()}var je=1/ye;return i[0]=W*je,i[1]=(f*ee-ae*p)*je,i[2]=(V*p-f*L)*je,i[3]=he*je,i[4]=(ae*l-f*Z)*je,i[5]=(f*w-V*l)*je,i[6]=ge*je,i[7]=(p*Z-ee*l)*je,i[8]=(L*l-p*w)*je,this},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[3],t[3]=e,e=t[2],t[2]=t[6],t[6]=e,e=t[5],t[5]=t[7],t[7]=e,this},getNormalMatrix:function(e){return this.setFromMatrix4(e).getInverse(this).transpose()},transposeIntoArray:function(e){var t=this.elements;return e[0]=t[0],e[1]=t[3],e[2]=t[6],e[3]=t[1],e[4]=t[4],e[5]=t[7],e[6]=t[2],e[7]=t[5],e[8]=t[8],this},setUvTransform:function(e,t,r,i,l,p,f){var w=Math.cos(l),L=Math.sin(l);this.set(r*w,r*L,-r*(w*p+L*f)+p+e,-i*L,i*w,-i*(-L*p+w*f)+f+t,0,0,1)},scale:function(e,t){var r=this.elements;return r[0]*=e,r[3]*=e,r[6]*=e,r[1]*=t,r[4]*=t,r[7]*=t,this},rotate:function(e){var t=Math.cos(e),r=Math.sin(e),i=this.elements,l=i[0],p=i[3],f=i[6],w=i[1],L=i[4],V=i[7];return i[0]=t*l+r*w,i[3]=t*p+r*L,i[6]=t*f+r*V,i[1]=-r*l+t*w,i[4]=-r*p+t*L,i[7]=-r*f+t*V,this},translate:function(e,t){var r=this.elements;return r[0]+=e*r[2],r[3]+=e*r[5],r[6]+=e*r[8],r[1]+=t*r[2],r[4]+=t*r[5],r[7]+=t*r[8],this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<9;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var r=0;r<9;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e}});var zo={getDataURL:function(e){var t;if(typeof HTMLCanvasElement>"u")return e.src;if(e instanceof HTMLCanvasElement)t=e;else{ws===void 0&&(ws=document.createElementNS("http://www.w3.org/1999/xhtml","canvas")),ws.width=e.width,ws.height=e.height;var r=ws.getContext("2d");e instanceof ImageData?r.putImageData(e,0,0):r.drawImage(e,0,0,e.width,e.height),t=ws}return 2048<t.width||2048<t.height?t.toDataURL("image/jpeg",.6):t.toDataURL("image/png")}},lc=0;function Yn(e,t,r,i,l,p,f,w,L,V){Object.defineProperty(this,"id",{value:lc++}),this.uuid=xn.generateUUID(),this.name="",this.image=e!==void 0?e:Yn.DEFAULT_IMAGE,this.mipmaps=[],this.mapping=t!==void 0?t:Yn.DEFAULT_MAPPING,this.wrapS=r!==void 0?r:Or,this.wrapT=i!==void 0?i:Or,this.magFilter=l!==void 0?l:Tr,this.minFilter=p!==void 0?p:Hr,this.anisotropy=L!==void 0?L:1,this.format=f!==void 0?f:Tn,this.internalFormat=null,this.type=w!==void 0?w:vn,this.offset=new Gt(0,0),this.repeat=new Gt(1,1),this.center=new Gt(0,0),this.rotation=0,this.matrixAutoUpdate=!0,this.matrix=new Ai,this.generateMipmaps=!0,this.premultiplyAlpha=!1,this.flipY=!0,this.unpackAlignment=4,this.encoding=V!==void 0?V:Ke,this.version=0,this.onUpdate=null}function qn(e,t,r,i){this.x=e||0,this.y=t||0,this.z=r||0,this.w=i!==void 0?i:1}function Yi(e,t,r){this.width=e,this.height=t,this.scissor=new qn(0,0,e,t),this.scissorTest=!1,this.viewport=new qn(0,0,e,t),r=r||{},this.texture=new Yn(void 0,r.mapping,r.wrapS,r.wrapT,r.magFilter,r.minFilter,r.format,r.type,r.anisotropy,r.encoding),this.texture.image={},this.texture.image.width=e,this.texture.image.height=t,this.texture.generateMipmaps=r.generateMipmaps!==void 0&&r.generateMipmaps,this.texture.minFilter=r.minFilter!==void 0?r.minFilter:Tr,this.depthBuffer=r.depthBuffer===void 0||r.depthBuffer,this.stencilBuffer=r.stencilBuffer===void 0||r.stencilBuffer,this.depthTexture=r.depthTexture!==void 0?r.depthTexture:null}function zs(e,t,r){Yi.call(this,e,t,r),this.samples=4}function Gi(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._w=i!==void 0?i:1}Yn.DEFAULT_IMAGE=void 0,Yn.DEFAULT_MAPPING=300,Yn.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Yn,isTexture:!0,updateMatrix:function(){this.matrix.setUvTransform(this.offset.x,this.offset.y,this.repeat.x,this.repeat.y,this.rotation,this.center.x,this.center.y)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.name=e.name,this.image=e.image,this.mipmaps=e.mipmaps.slice(0),this.mapping=e.mapping,this.wrapS=e.wrapS,this.wrapT=e.wrapT,this.magFilter=e.magFilter,this.minFilter=e.minFilter,this.anisotropy=e.anisotropy,this.format=e.format,this.internalFormat=e.internalFormat,this.type=e.type,this.offset.copy(e.offset),this.repeat.copy(e.repeat),this.center.copy(e.center),this.rotation=e.rotation,this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrix.copy(e.matrix),this.generateMipmaps=e.generateMipmaps,this.premultiplyAlpha=e.premultiplyAlpha,this.flipY=e.flipY,this.unpackAlignment=e.unpackAlignment,this.encoding=e.encoding,this},toJSON:function(e){var t=e===void 0||typeof e=="string";if(!t&&e.textures[this.uuid]!==void 0)return e.textures[this.uuid];var r={metadata:{version:4.5,type:"Texture",generator:"Texture.toJSON"},uuid:this.uuid,name:this.name,mapping:this.mapping,repeat:[this.repeat.x,this.repeat.y],offset:[this.offset.x,this.offset.y],center:[this.center.x,this.center.y],rotation:this.rotation,wrap:[this.wrapS,this.wrapT],format:this.format,type:this.type,encoding:this.encoding,minFilter:this.minFilter,magFilter:this.magFilter,anisotropy:this.anisotropy,flipY:this.flipY,premultiplyAlpha:this.premultiplyAlpha,unpackAlignment:this.unpackAlignment};if(this.image!==void 0){var i=this.image;if(i.uuid===void 0&&(i.uuid=xn.generateUUID()),!t&&e.images[i.uuid]===void 0){var l;if(Array.isArray(i)){l=[];for(var p=0,f=i.length;p<f;p++)l.push(zo.getDataURL(i[p]))}else l=zo.getDataURL(i);e.images[i.uuid]={uuid:i.uuid,url:l}}r.image=i.uuid}return t||(e.textures[this.uuid]=r),r},dispose:function(){this.dispatchEvent({type:"dispose"})},transformUv:function(e){if(this.mapping!==300)return e;if(e.applyMatrix3(this.matrix),e.x<0||1<e.x)switch(this.wrapS){case Yt:e.x=e.x-Math.floor(e.x);break;case Or:e.x=e.x<0?0:1;break;case Yr:Math.abs(Math.floor(e.x)%2)===1?e.x=Math.ceil(e.x)-e.x:e.x=e.x-Math.floor(e.x)}if(e.y<0||1<e.y)switch(this.wrapT){case Yt:e.y=e.y-Math.floor(e.y);break;case Or:e.y=e.y<0?0:1;break;case Yr:Math.abs(Math.floor(e.y)%2)===1?e.y=Math.ceil(e.y)-e.y:e.y=e.y-Math.floor(e.y)}return this.flipY&&(e.y=1-e.y),e}}),Object.defineProperty(Yn.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.defineProperties(qn.prototype,{width:{get:function(){return this.z},set:function(e){this.z=e}},height:{get:function(){return this.w},set:function(e){this.w=e}}}),Object.assign(qn.prototype,{isVector4:!0,set:function(e,t,r,i){return this.x=e,this.y=t,this.z=r,this.w=i,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this.w=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setW:function(e){return this.w=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;case 3:this.w=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;case 3:return this.w;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z,this.w)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this.w=e.w!==void 0?e.w:1,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this.w+=e.w,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this.w+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this.w=e.w+t.w,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this.w+=e.w*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector4: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this.w-=e.w,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this.w-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this.w=e.w-t.w,this},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this.w*=e,this},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,l=this.w,p=e.elements;return this.x=p[0]*t+p[4]*r+p[8]*i+p[12]*l,this.y=p[1]*t+p[5]*r+p[9]*i+p[13]*l,this.z=p[2]*t+p[6]*r+p[10]*i+p[14]*l,this.w=p[3]*t+p[7]*r+p[11]*i+p[15]*l,this},divideScalar:function(e){return this.multiplyScalar(1/e)},setAxisAngleFromQuaternion:function(e){this.w=2*Math.acos(e.w);var t=Math.sqrt(1-e.w*e.w);return t<1e-4?(this.x=1,this.y=0,this.z=0):(this.x=e.x/t,this.y=e.y/t,this.z=e.z/t),this},setAxisAngleFromRotationMatrix:function(e){var t,r,i,l,p=e.elements,f=p[0],w=p[4],L=p[8],V=p[1],Z=p[5],ee=p[9],ae=p[2],W=p[6],he=p[10];if(Math.abs(w-V)<.01&&Math.abs(L-ae)<.01&&Math.abs(ee-W)<.01){if(Math.abs(w+V)<.1&&Math.abs(L+ae)<.1&&Math.abs(ee+W)<.1&&Math.abs(f+Z+he-3)<.1)return this.set(1,0,0,0),this;t=Math.PI;var ge=(f+1)/2,ye=(Z+1)/2,Ae=(he+1)/2,je=(w+V)/4,He=(L+ae)/4,et=(ee+W)/4;return ye<ge&&Ae<ge?l=ge<.01?(r=0,i=.707106781):(i=je/(r=Math.sqrt(ge)),He/r):Ae<ye?l=ye<.01?(i=0,r=.707106781):(r=je/(i=Math.sqrt(ye)),et/i):Ae<.01?(i=r=.707106781,l=0):(r=He/(l=Math.sqrt(Ae)),i=et/l),this.set(r,i,l,t),this}var Ge=Math.sqrt((W-ee)*(W-ee)+(L-ae)*(L-ae)+(V-w)*(V-w));return Math.abs(Ge)<.001&&(Ge=1),this.x=(W-ee)/Ge,this.y=(L-ae)/Ge,this.z=(V-w)/Ge,this.w=Math.acos((f+Z+he-1)/2),this},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this.w=Math.min(this.w,e.w),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this.w=Math.max(this.w,e.w),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this.w=Math.max(e.w,Math.min(t.w,this.w)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this.w=Math.max(e,Math.min(t,this.w)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this.w=Math.floor(this.w),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this.w=Math.ceil(this.w),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this.w=Math.round(this.w),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this.w=this.w<0?Math.ceil(this.w):Math.floor(this.w),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this.w=-this.w,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z+this.w*e.w},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z+this.w*this.w)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)+Math.abs(this.w)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this.w+=(e.w-this.w)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z&&e.w===this.w},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this.w=e[t+3],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e[t+3]=this.w,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector4: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this.w=e.getW(t),this}}),Yi.prototype=Object.assign(Object.create(Ia.prototype),{constructor:Yi,isWebGLRenderTarget:!0,setSize:function(e,t){this.width===e&&this.height===t||(this.width=e,this.height=t,this.texture.image.width=e,this.texture.image.height=t,this.dispose()),this.viewport.set(0,0,e,t),this.scissor.set(0,0,e,t)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.width=e.width,this.height=e.height,this.viewport.copy(e.viewport),this.texture=e.texture.clone(),this.depthBuffer=e.depthBuffer,this.stencilBuffer=e.stencilBuffer,this.depthTexture=e.depthTexture,this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),zs.prototype=Object.assign(Object.create(Yi.prototype),{constructor:zs,isWebGLMultisampleRenderTarget:!0,copy:function(e){return Yi.prototype.copy.call(this,e),this.samples=e.samples,this}}),Object.assign(Gi,{slerp:function(e,t,r,i){return r.copy(e).slerp(t,i)},slerpFlat:function(e,t,r,i,l,p,f){var w=r[i+0],L=r[i+1],V=r[i+2],Z=r[i+3],ee=l[p+0],ae=l[p+1],W=l[p+2],he=l[p+3];if(Z!==he||w!==ee||L!==ae||V!==W){var ge=1-f,ye=w*ee+L*ae+V*W+Z*he,Ae=0<=ye?1:-1,je=1-ye*ye;if(je>Number.EPSILON){var He=Math.sqrt(je),et=Math.atan2(He,ye*Ae);ge=Math.sin(ge*et)/He,f=Math.sin(f*et)/He}var Ge=f*Ae;if(w=w*ge+ee*Ge,L=L*ge+ae*Ge,V=V*ge+W*Ge,Z=Z*ge+he*Ge,ge===1-f){var it=1/Math.sqrt(w*w+L*L+V*V+Z*Z);w*=it,L*=it,V*=it,Z*=it}}e[t]=w,e[t+1]=L,e[t+2]=V,e[t+3]=Z}}),Object.defineProperties(Gi.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},w:{get:function(){return this._w},set:function(e){this._w=e,this._onChangeCallback()}}}),Object.assign(Gi.prototype,{isQuaternion:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._w=i,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._w)},copy:function(e){return this._x=e.x,this._y=e.y,this._z=e.z,this._w=e.w,this._onChangeCallback(),this},setFromEuler:function(e,t){if(!e||!e.isEuler)throw new Error("THREE.Quaternion: .setFromEuler() now expects an Euler rotation rather than a Vector3 and order.");var r=e._x,i=e._y,l=e._z,p=e.order,f=Math.cos,w=Math.sin,L=f(r/2),V=f(i/2),Z=f(l/2),ee=w(r/2),ae=w(i/2),W=w(l/2);return p==="XYZ"?(this._x=ee*V*Z+L*ae*W,this._y=L*ae*Z-ee*V*W,this._z=L*V*W+ee*ae*Z,this._w=L*V*Z-ee*ae*W):p==="YXZ"?(this._x=ee*V*Z+L*ae*W,this._y=L*ae*Z-ee*V*W,this._z=L*V*W-ee*ae*Z,this._w=L*V*Z+ee*ae*W):p==="ZXY"?(this._x=ee*V*Z-L*ae*W,this._y=L*ae*Z+ee*V*W,this._z=L*V*W+ee*ae*Z,this._w=L*V*Z-ee*ae*W):p==="ZYX"?(this._x=ee*V*Z-L*ae*W,this._y=L*ae*Z+ee*V*W,this._z=L*V*W-ee*ae*Z,this._w=L*V*Z+ee*ae*W):p==="YZX"?(this._x=ee*V*Z+L*ae*W,this._y=L*ae*Z+ee*V*W,this._z=L*V*W-ee*ae*Z,this._w=L*V*Z-ee*ae*W):p==="XZY"&&(this._x=ee*V*Z-L*ae*W,this._y=L*ae*Z-ee*V*W,this._z=L*V*W+ee*ae*Z,this._w=L*V*Z+ee*ae*W),t!==!1&&this._onChangeCallback(),this},setFromAxisAngle:function(e,t){var r=t/2,i=Math.sin(r);return this._x=e.x*i,this._y=e.y*i,this._z=e.z*i,this._w=Math.cos(r),this._onChangeCallback(),this},setFromRotationMatrix:function(e){var t,r=e.elements,i=r[0],l=r[4],p=r[8],f=r[1],w=r[5],L=r[9],V=r[2],Z=r[6],ee=r[10],ae=i+w+ee;return 0<ae?(t=.5/Math.sqrt(ae+1),this._w=.25/t,this._x=(Z-L)*t,this._y=(p-V)*t,this._z=(f-l)*t):w<i&&ee<i?(t=2*Math.sqrt(1+i-w-ee),this._w=(Z-L)/t,this._x=.25*t,this._y=(l+f)/t,this._z=(p+V)/t):ee<w?(t=2*Math.sqrt(1+w-i-ee),this._w=(p-V)/t,this._x=(l+f)/t,this._y=.25*t,this._z=(L+Z)/t):(t=2*Math.sqrt(1+ee-i-w),this._w=(f-l)/t,this._x=(p+V)/t,this._y=(L+Z)/t,this._z=.25*t),this._onChangeCallback(),this},setFromUnitVectors:function(e,t){var r=e.dot(t)+1;return r<1e-6?(r=0,Math.abs(e.x)>Math.abs(e.z)?(this._x=-e.y,this._y=e.x,this._z=0):(this._x=0,this._y=-e.z,this._z=e.y)):(this._x=e.y*t.z-e.z*t.y,this._y=e.z*t.x-e.x*t.z,this._z=e.x*t.y-e.y*t.x),this._w=r,this.normalize()},angleTo:function(e){return 2*Math.acos(Math.abs(xn.clamp(this.dot(e),-1,1)))},rotateTowards:function(e,t){var r=this.angleTo(e);if(r===0)return this;var i=Math.min(1,t/r);return this.slerp(e,i),this},inverse:function(){return this.conjugate()},conjugate:function(){return this._x*=-1,this._y*=-1,this._z*=-1,this._onChangeCallback(),this},dot:function(e){return this._x*e._x+this._y*e._y+this._z*e._z+this._w*e._w},lengthSq:function(){return this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w},length:function(){return Math.sqrt(this._x*this._x+this._y*this._y+this._z*this._z+this._w*this._w)},normalize:function(){var e=this.length();return e===0?(this._x=0,this._y=0,this._z=0,this._w=1):(e=1/e,this._x=this._x*e,this._y=this._y*e,this._z=this._z*e,this._w=this._w*e),this._onChangeCallback(),this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Quaternion: .multiply() now only accepts one argument. Use .multiplyQuaternions( a, b ) instead."),this.multiplyQuaternions(e,t)):this.multiplyQuaternions(this,e)},premultiply:function(e){return this.multiplyQuaternions(e,this)},multiplyQuaternions:function(e,t){var r=e._x,i=e._y,l=e._z,p=e._w,f=t._x,w=t._y,L=t._z,V=t._w;return this._x=r*V+p*f+i*L-l*w,this._y=i*V+p*w+l*f-r*L,this._z=l*V+p*L+r*w-i*f,this._w=p*V-r*f-i*w-l*L,this._onChangeCallback(),this},slerp:function(e,t){if(t===0)return this;if(t===1)return this.copy(e);var r=this._x,i=this._y,l=this._z,p=this._w,f=p*e._w+r*e._x+i*e._y+l*e._z;if(f<0?(this._w=-e._w,this._x=-e._x,this._y=-e._y,this._z=-e._z,f=-f):this.copy(e),1<=f)return this._w=p,this._x=r,this._y=i,this._z=l,this;var w=1-f*f;if(w<=Number.EPSILON){var L=1-t;return this._w=L*p+t*this._w,this._x=L*r+t*this._x,this._y=L*i+t*this._y,this._z=L*l+t*this._z,this.normalize(),this._onChangeCallback(),this}var V=Math.sqrt(w),Z=Math.atan2(V,f),ee=Math.sin((1-t)*Z)/V,ae=Math.sin(t*Z)/V;return this._w=p*ee+this._w*ae,this._x=r*ee+this._x*ae,this._y=i*ee+this._y*ae,this._z=l*ee+this._z*ae,this._onChangeCallback(),this},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._w===this._w},fromArray:function(e,t){return t===void 0&&(t=0),this._x=e[t],this._y=e[t+1],this._z=e[t+2],this._w=e[t+3],this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._w,e},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}});var bs=new Le,Us=new Gi;function Le(e,t,r){this.x=e||0,this.y=t||0,this.z=r||0}Object.assign(Le.prototype,{isVector3:!0,set:function(e,t,r){return this.x=e,this.y=t,this.z=r,this},setScalar:function(e){return this.x=e,this.y=e,this.z=e,this},setX:function(e){return this.x=e,this},setY:function(e){return this.y=e,this},setZ:function(e){return this.z=e,this},setComponent:function(e,t){switch(e){case 0:this.x=t;break;case 1:this.y=t;break;case 2:this.z=t;break;default:throw new Error("index is out of range: "+e)}return this},getComponent:function(e){switch(e){case 0:return this.x;case 1:return this.y;case 2:return this.z;default:throw new Error("index is out of range: "+e)}},clone:function(){return new this.constructor(this.x,this.y,this.z)},copy:function(e){return this.x=e.x,this.y=e.y,this.z=e.z,this},add:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .add() now only accepts one argument. Use .addVectors( a, b ) instead."),this.addVectors(e,t)):(this.x+=e.x,this.y+=e.y,this.z+=e.z,this)},addScalar:function(e){return this.x+=e,this.y+=e,this.z+=e,this},addVectors:function(e,t){return this.x=e.x+t.x,this.y=e.y+t.y,this.z=e.z+t.z,this},addScaledVector:function(e,t){return this.x+=e.x*t,this.y+=e.y*t,this.z+=e.z*t,this},sub:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .sub() now only accepts one argument. Use .subVectors( a, b ) instead."),this.subVectors(e,t)):(this.x-=e.x,this.y-=e.y,this.z-=e.z,this)},subScalar:function(e){return this.x-=e,this.y-=e,this.z-=e,this},subVectors:function(e,t){return this.x=e.x-t.x,this.y=e.y-t.y,this.z=e.z-t.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .multiply() now only accepts one argument. Use .multiplyVectors( a, b ) instead."),this.multiplyVectors(e,t)):(this.x*=e.x,this.y*=e.y,this.z*=e.z,this)},multiplyScalar:function(e){return this.x*=e,this.y*=e,this.z*=e,this},multiplyVectors:function(e,t){return this.x=e.x*t.x,this.y=e.y*t.y,this.z=e.z*t.z,this},applyEuler:function(e){return e&&e.isEuler||console.error("THREE.Vector3: .applyEuler() now expects an Euler rotation rather than a Vector3 and order."),this.applyQuaternion(Us.setFromEuler(e))},applyAxisAngle:function(e,t){return this.applyQuaternion(Us.setFromAxisAngle(e,t))},applyMatrix3:function(e){var t=this.x,r=this.y,i=this.z,l=e.elements;return this.x=l[0]*t+l[3]*r+l[6]*i,this.y=l[1]*t+l[4]*r+l[7]*i,this.z=l[2]*t+l[5]*r+l[8]*i,this},applyNormalMatrix:function(e){return this.applyMatrix3(e).normalize()},applyMatrix4:function(e){var t=this.x,r=this.y,i=this.z,l=e.elements,p=1/(l[3]*t+l[7]*r+l[11]*i+l[15]);return this.x=(l[0]*t+l[4]*r+l[8]*i+l[12])*p,this.y=(l[1]*t+l[5]*r+l[9]*i+l[13])*p,this.z=(l[2]*t+l[6]*r+l[10]*i+l[14])*p,this},applyQuaternion:function(e){var t=this.x,r=this.y,i=this.z,l=e.x,p=e.y,f=e.z,w=e.w,L=w*t+p*i-f*r,V=w*r+f*t-l*i,Z=w*i+l*r-p*t,ee=-l*t-p*r-f*i;return this.x=L*w+ee*-l+V*-f-Z*-p,this.y=V*w+ee*-p+Z*-l-L*-f,this.z=Z*w+ee*-f+L*-p-V*-l,this},project:function(e){return this.applyMatrix4(e.matrixWorldInverse).applyMatrix4(e.projectionMatrix)},unproject:function(e){return this.applyMatrix4(e.projectionMatrixInverse).applyMatrix4(e.matrixWorld)},transformDirection:function(e){var t=this.x,r=this.y,i=this.z,l=e.elements;return this.x=l[0]*t+l[4]*r+l[8]*i,this.y=l[1]*t+l[5]*r+l[9]*i,this.z=l[2]*t+l[6]*r+l[10]*i,this.normalize()},divide:function(e){return this.x/=e.x,this.y/=e.y,this.z/=e.z,this},divideScalar:function(e){return this.multiplyScalar(1/e)},min:function(e){return this.x=Math.min(this.x,e.x),this.y=Math.min(this.y,e.y),this.z=Math.min(this.z,e.z),this},max:function(e){return this.x=Math.max(this.x,e.x),this.y=Math.max(this.y,e.y),this.z=Math.max(this.z,e.z),this},clamp:function(e,t){return this.x=Math.max(e.x,Math.min(t.x,this.x)),this.y=Math.max(e.y,Math.min(t.y,this.y)),this.z=Math.max(e.z,Math.min(t.z,this.z)),this},clampScalar:function(e,t){return this.x=Math.max(e,Math.min(t,this.x)),this.y=Math.max(e,Math.min(t,this.y)),this.z=Math.max(e,Math.min(t,this.z)),this},clampLength:function(e,t){var r=this.length();return this.divideScalar(r||1).multiplyScalar(Math.max(e,Math.min(t,r)))},floor:function(){return this.x=Math.floor(this.x),this.y=Math.floor(this.y),this.z=Math.floor(this.z),this},ceil:function(){return this.x=Math.ceil(this.x),this.y=Math.ceil(this.y),this.z=Math.ceil(this.z),this},round:function(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this.z=Math.round(this.z),this},roundToZero:function(){return this.x=this.x<0?Math.ceil(this.x):Math.floor(this.x),this.y=this.y<0?Math.ceil(this.y):Math.floor(this.y),this.z=this.z<0?Math.ceil(this.z):Math.floor(this.z),this},negate:function(){return this.x=-this.x,this.y=-this.y,this.z=-this.z,this},dot:function(e){return this.x*e.x+this.y*e.y+this.z*e.z},lengthSq:function(){return this.x*this.x+this.y*this.y+this.z*this.z},length:function(){return Math.sqrt(this.x*this.x+this.y*this.y+this.z*this.z)},manhattanLength:function(){return Math.abs(this.x)+Math.abs(this.y)+Math.abs(this.z)},normalize:function(){return this.divideScalar(this.length()||1)},setLength:function(e){return this.normalize().multiplyScalar(e)},lerp:function(e,t){return this.x+=(e.x-this.x)*t,this.y+=(e.y-this.y)*t,this.z+=(e.z-this.z)*t,this},lerpVectors:function(e,t,r){return this.subVectors(t,e).multiplyScalar(r).add(e)},cross:function(e,t){return t!==void 0?(console.warn("THREE.Vector3: .cross() now only accepts one argument. Use .crossVectors( a, b ) instead."),this.crossVectors(e,t)):this.crossVectors(this,e)},crossVectors:function(e,t){var r=e.x,i=e.y,l=e.z,p=t.x,f=t.y,w=t.z;return this.x=i*w-l*f,this.y=l*p-r*w,this.z=r*f-i*p,this},projectOnVector:function(e){var t=e.lengthSq();if(t===0)return this.set(0,0,0);var r=e.dot(this)/t;return this.copy(e).multiplyScalar(r)},projectOnPlane:function(e){return bs.copy(this).projectOnVector(e),this.sub(bs)},reflect:function(e){return this.sub(bs.copy(e).multiplyScalar(2*this.dot(e)))},angleTo:function(e){var t=Math.sqrt(this.lengthSq()*e.lengthSq());if(t===0)return Math.PI/2;var r=this.dot(e)/t;return Math.acos(xn.clamp(r,-1,1))},distanceTo:function(e){return Math.sqrt(this.distanceToSquared(e))},distanceToSquared:function(e){var t=this.x-e.x,r=this.y-e.y,i=this.z-e.z;return t*t+r*r+i*i},manhattanDistanceTo:function(e){return Math.abs(this.x-e.x)+Math.abs(this.y-e.y)+Math.abs(this.z-e.z)},setFromSpherical:function(e){return this.setFromSphericalCoords(e.radius,e.phi,e.theta)},setFromSphericalCoords:function(e,t,r){var i=Math.sin(t)*e;return this.x=i*Math.sin(r),this.y=Math.cos(t)*e,this.z=i*Math.cos(r),this},setFromCylindrical:function(e){return this.setFromCylindricalCoords(e.radius,e.theta,e.y)},setFromCylindricalCoords:function(e,t,r){return this.x=e*Math.sin(t),this.y=r,this.z=e*Math.cos(t),this},setFromMatrixPosition:function(e){var t=e.elements;return this.x=t[12],this.y=t[13],this.z=t[14],this},setFromMatrixScale:function(e){var t=this.setFromMatrixColumn(e,0).length(),r=this.setFromMatrixColumn(e,1).length(),i=this.setFromMatrixColumn(e,2).length();return this.x=t,this.y=r,this.z=i,this},setFromMatrixColumn:function(e,t){return this.fromArray(e.elements,4*t)},setFromMatrix3Column:function(e,t){return this.fromArray(e.elements,3*t)},equals:function(e){return e.x===this.x&&e.y===this.y&&e.z===this.z},fromArray:function(e,t){return t===void 0&&(t=0),this.x=e[t],this.y=e[t+1],this.z=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.x,e[t+1]=this.y,e[t+2]=this.z,e},fromBufferAttribute:function(e,t,r){return r!==void 0&&console.warn("THREE.Vector3: offset has been removed from .fromBufferAttribute()."),this.x=e.getX(t),this.y=e.getY(t),this.z=e.getZ(t),this}});var Eo=new Le,ra=new mn,uc=new Le(0,0,0),Ms=new Le(1,1,1),Oo=new Le,Hs=new Le,ba=new Le;function mn(){this.elements=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1],0<arguments.length&&console.error("THREE.Matrix4: the constructor no longer reads arguments. use .set() instead.")}Object.assign(mn.prototype,{isMatrix4:!0,set:function(e,t,r,i,l,p,f,w,L,V,Z,ee,ae,W,he,ge){var ye=this.elements;return ye[0]=e,ye[4]=t,ye[8]=r,ye[12]=i,ye[1]=l,ye[5]=p,ye[9]=f,ye[13]=w,ye[2]=L,ye[6]=V,ye[10]=Z,ye[14]=ee,ye[3]=ae,ye[7]=W,ye[11]=he,ye[15]=ge,this},identity:function(){return this.set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1),this},clone:function(){return new mn().fromArray(this.elements)},copy:function(e){var t=this.elements,r=e.elements;return t[0]=r[0],t[1]=r[1],t[2]=r[2],t[3]=r[3],t[4]=r[4],t[5]=r[5],t[6]=r[6],t[7]=r[7],t[8]=r[8],t[9]=r[9],t[10]=r[10],t[11]=r[11],t[12]=r[12],t[13]=r[13],t[14]=r[14],t[15]=r[15],this},copyPosition:function(e){var t=this.elements,r=e.elements;return t[12]=r[12],t[13]=r[13],t[14]=r[14],this},extractBasis:function(e,t,r){return e.setFromMatrixColumn(this,0),t.setFromMatrixColumn(this,1),r.setFromMatrixColumn(this,2),this},makeBasis:function(e,t,r){return this.set(e.x,t.x,r.x,0,e.y,t.y,r.y,0,e.z,t.z,r.z,0,0,0,0,1),this},extractRotation:function(e){var t=this.elements,r=e.elements,i=1/Eo.setFromMatrixColumn(e,0).length(),l=1/Eo.setFromMatrixColumn(e,1).length(),p=1/Eo.setFromMatrixColumn(e,2).length();return t[0]=r[0]*i,t[1]=r[1]*i,t[2]=r[2]*i,t[3]=0,t[4]=r[4]*l,t[5]=r[5]*l,t[6]=r[6]*l,t[7]=0,t[8]=r[8]*p,t[9]=r[9]*p,t[10]=r[10]*p,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromEuler:function(e){e&&e.isEuler||console.error("THREE.Matrix4: .makeRotationFromEuler() now expects a Euler rotation rather than a Vector3 and order.");var t=this.elements,r=e.x,i=e.y,l=e.z,p=Math.cos(r),f=Math.sin(r),w=Math.cos(i),L=Math.sin(i),V=Math.cos(l),Z=Math.sin(l);if(e.order==="XYZ"){var ee=p*V,ae=p*Z,W=f*V,he=f*Z;t[0]=w*V,t[4]=-w*Z,t[8]=L,t[1]=ae+W*L,t[5]=ee-he*L,t[9]=-f*w,t[2]=he-ee*L,t[6]=W+ae*L,t[10]=p*w}else if(e.order==="YXZ"){var ge=w*V,ye=w*Z,Ae=L*V,je=L*Z;t[0]=ge+je*f,t[4]=Ae*f-ye,t[8]=p*L,t[1]=p*Z,t[5]=p*V,t[9]=-f,t[2]=ye*f-Ae,t[6]=je+ge*f,t[10]=p*w}else if(e.order==="ZXY")ge=w*V,ye=w*Z,Ae=L*V,je=L*Z,t[0]=ge-je*f,t[4]=-p*Z,t[8]=Ae+ye*f,t[1]=ye+Ae*f,t[5]=p*V,t[9]=je-ge*f,t[2]=-p*L,t[6]=f,t[10]=p*w;else if(e.order==="ZYX")ee=p*V,ae=p*Z,W=f*V,he=f*Z,t[0]=w*V,t[4]=W*L-ae,t[8]=ee*L+he,t[1]=w*Z,t[5]=he*L+ee,t[9]=ae*L-W,t[2]=-L,t[6]=f*w,t[10]=p*w;else if(e.order==="YZX"){var He=p*w,et=p*L,Ge=f*w,it=f*L;t[0]=w*V,t[4]=it-He*Z,t[8]=Ge*Z+et,t[1]=Z,t[5]=p*V,t[9]=-f*V,t[2]=-L*V,t[6]=et*Z+Ge,t[10]=He-it*Z}else e.order==="XZY"&&(He=p*w,et=p*L,Ge=f*w,it=f*L,t[0]=w*V,t[4]=-Z,t[8]=L*V,t[1]=He*Z+it,t[5]=p*V,t[9]=et*Z-Ge,t[2]=Ge*Z-et,t[6]=f*V,t[10]=it*Z+He);return t[3]=0,t[7]=0,t[11]=0,t[12]=0,t[13]=0,t[14]=0,t[15]=1,this},makeRotationFromQuaternion:function(e){return this.compose(uc,e,Ms)},lookAt:function(e,t,r){var i=this.elements;return ba.subVectors(e,t),ba.lengthSq()===0&&(ba.z=1),ba.normalize(),Oo.crossVectors(r,ba),Oo.lengthSq()===0&&(Math.abs(r.z)===1?ba.x+=1e-4:ba.z+=1e-4,ba.normalize(),Oo.crossVectors(r,ba)),Oo.normalize(),Hs.crossVectors(ba,Oo),i[0]=Oo.x,i[4]=Hs.x,i[8]=ba.x,i[1]=Oo.y,i[5]=Hs.y,i[9]=ba.y,i[2]=Oo.z,i[6]=Hs.z,i[10]=ba.z,this},multiply:function(e,t){return t!==void 0?(console.warn("THREE.Matrix4: .multiply() now only accepts one argument. Use .multiplyMatrices( a, b ) instead."),this.multiplyMatrices(e,t)):this.multiplyMatrices(this,e)},premultiply:function(e){return this.multiplyMatrices(e,this)},multiplyMatrices:function(e,t){var r=e.elements,i=t.elements,l=this.elements,p=r[0],f=r[4],w=r[8],L=r[12],V=r[1],Z=r[5],ee=r[9],ae=r[13],W=r[2],he=r[6],ge=r[10],ye=r[14],Ae=r[3],je=r[7],He=r[11],et=r[15],Ge=i[0],it=i[4],qe=i[8],vt=i[12],Tt=i[1],Et=i[5],Ot=i[9],Bt=i[13],Xt=i[2],Dt=i[6],Mt=i[10],lr=i[14],yr=i[3],$r=i[7],Xr=i[11],Vr=i[15];return l[0]=p*Ge+f*Tt+w*Xt+L*yr,l[4]=p*it+f*Et+w*Dt+L*$r,l[8]=p*qe+f*Ot+w*Mt+L*Xr,l[12]=p*vt+f*Bt+w*lr+L*Vr,l[1]=V*Ge+Z*Tt+ee*Xt+ae*yr,l[5]=V*it+Z*Et+ee*Dt+ae*$r,l[9]=V*qe+Z*Ot+ee*Mt+ae*Xr,l[13]=V*vt+Z*Bt+ee*lr+ae*Vr,l[2]=W*Ge+he*Tt+ge*Xt+ye*yr,l[6]=W*it+he*Et+ge*Dt+ye*$r,l[10]=W*qe+he*Ot+ge*Mt+ye*Xr,l[14]=W*vt+he*Bt+ge*lr+ye*Vr,l[3]=Ae*Ge+je*Tt+He*Xt+et*yr,l[7]=Ae*it+je*Et+He*Dt+et*$r,l[11]=Ae*qe+je*Ot+He*Mt+et*Xr,l[15]=Ae*vt+je*Bt+He*lr+et*Vr,this},multiplyScalar:function(e){var t=this.elements;return t[0]*=e,t[4]*=e,t[8]*=e,t[12]*=e,t[1]*=e,t[5]*=e,t[9]*=e,t[13]*=e,t[2]*=e,t[6]*=e,t[10]*=e,t[14]*=e,t[3]*=e,t[7]*=e,t[11]*=e,t[15]*=e,this},determinant:function(){var e=this.elements,t=e[0],r=e[4],i=e[8],l=e[12],p=e[1],f=e[5],w=e[9],L=e[13],V=e[2],Z=e[6],ee=e[10],ae=e[14];return e[3]*(l*w*Z-i*L*Z-l*f*ee+r*L*ee+i*f*ae-r*w*ae)+e[7]*(t*w*ae-t*L*ee+l*p*ee-i*p*ae+i*L*V-l*w*V)+e[11]*(t*L*Z-t*f*ae-l*p*Z+r*p*ae+l*f*V-r*L*V)+e[15]*(-i*f*V-t*w*Z+t*f*ee+i*p*Z-r*p*ee+r*w*V)},transpose:function(){var e,t=this.elements;return e=t[1],t[1]=t[4],t[4]=e,e=t[2],t[2]=t[8],t[8]=e,e=t[6],t[6]=t[9],t[9]=e,e=t[3],t[3]=t[12],t[12]=e,e=t[7],t[7]=t[13],t[13]=e,e=t[11],t[11]=t[14],t[14]=e,this},setPosition:function(e,t,r){var i=this.elements;return e.isVector3?(i[12]=e.x,i[13]=e.y,i[14]=e.z):(i[12]=e,i[13]=t,i[14]=r),this},getInverse:function(e,t){var r=this.elements,i=e.elements,l=i[0],p=i[1],f=i[2],w=i[3],L=i[4],V=i[5],Z=i[6],ee=i[7],ae=i[8],W=i[9],he=i[10],ge=i[11],ye=i[12],Ae=i[13],je=i[14],He=i[15],et=W*je*ee-Ae*he*ee+Ae*Z*ge-V*je*ge-W*Z*He+V*he*He,Ge=ye*he*ee-ae*je*ee-ye*Z*ge+L*je*ge+ae*Z*He-L*he*He,it=ae*Ae*ee-ye*W*ee+ye*V*ge-L*Ae*ge-ae*V*He+L*W*He,qe=ye*W*Z-ae*Ae*Z-ye*V*he+L*Ae*he+ae*V*je-L*W*je,vt=l*et+p*Ge+f*it+w*qe;if(vt==0){var Tt="THREE.Matrix4: .getInverse() can't invert matrix, determinant is 0";if(t===!0)throw new Error(Tt);return console.warn(Tt),this.identity()}var Et=1/vt;return r[0]=et*Et,r[1]=(Ae*he*w-W*je*w-Ae*f*ge+p*je*ge+W*f*He-p*he*He)*Et,r[2]=(V*je*w-Ae*Z*w+Ae*f*ee-p*je*ee-V*f*He+p*Z*He)*Et,r[3]=(W*Z*w-V*he*w-W*f*ee+p*he*ee+V*f*ge-p*Z*ge)*Et,r[4]=Ge*Et,r[5]=(ae*je*w-ye*he*w+ye*f*ge-l*je*ge-ae*f*He+l*he*He)*Et,r[6]=(ye*Z*w-L*je*w-ye*f*ee+l*je*ee+L*f*He-l*Z*He)*Et,r[7]=(L*he*w-ae*Z*w+ae*f*ee-l*he*ee-L*f*ge+l*Z*ge)*Et,r[8]=it*Et,r[9]=(ye*W*w-ae*Ae*w-ye*p*ge+l*Ae*ge+ae*p*He-l*W*He)*Et,r[10]=(L*Ae*w-ye*V*w+ye*p*ee-l*Ae*ee-L*p*He+l*V*He)*Et,r[11]=(ae*V*w-L*W*w-ae*p*ee+l*W*ee+L*p*ge-l*V*ge)*Et,r[12]=qe*Et,r[13]=(ae*Ae*f-ye*W*f+ye*p*he-l*Ae*he-ae*p*je+l*W*je)*Et,r[14]=(ye*V*f-L*Ae*f-ye*p*Z+l*Ae*Z+L*p*je-l*V*je)*Et,r[15]=(L*W*f-ae*V*f+ae*p*Z-l*W*Z-L*p*he+l*V*he)*Et,this},scale:function(e){var t=this.elements,r=e.x,i=e.y,l=e.z;return t[0]*=r,t[4]*=i,t[8]*=l,t[1]*=r,t[5]*=i,t[9]*=l,t[2]*=r,t[6]*=i,t[10]*=l,t[3]*=r,t[7]*=i,t[11]*=l,this},getMaxScaleOnAxis:function(){var e=this.elements,t=e[0]*e[0]+e[1]*e[1]+e[2]*e[2],r=e[4]*e[4]+e[5]*e[5]+e[6]*e[6],i=e[8]*e[8]+e[9]*e[9]+e[10]*e[10];return Math.sqrt(Math.max(t,r,i))},makeTranslation:function(e,t,r){return this.set(1,0,0,e,0,1,0,t,0,0,1,r,0,0,0,1),this},makeRotationX:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(1,0,0,0,0,t,-r,0,0,r,t,0,0,0,0,1),this},makeRotationY:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,0,r,0,0,1,0,0,-r,0,t,0,0,0,0,1),this},makeRotationZ:function(e){var t=Math.cos(e),r=Math.sin(e);return this.set(t,-r,0,0,r,t,0,0,0,0,1,0,0,0,0,1),this},makeRotationAxis:function(e,t){var r=Math.cos(t),i=Math.sin(t),l=1-r,p=e.x,f=e.y,w=e.z,L=l*p,V=l*f;return this.set(L*p+r,L*f-i*w,L*w+i*f,0,L*f+i*w,V*f+r,V*w-i*p,0,L*w-i*f,V*w+i*p,l*w*w+r,0,0,0,0,1),this},makeScale:function(e,t,r){return this.set(e,0,0,0,0,t,0,0,0,0,r,0,0,0,0,1),this},makeShear:function(e,t,r){return this.set(1,t,r,0,e,1,r,0,e,t,1,0,0,0,0,1),this},compose:function(e,t,r){var i=this.elements,l=t._x,p=t._y,f=t._z,w=t._w,L=l+l,V=p+p,Z=f+f,ee=l*L,ae=l*V,W=l*Z,he=p*V,ge=p*Z,ye=f*Z,Ae=w*L,je=w*V,He=w*Z,et=r.x,Ge=r.y,it=r.z;return i[0]=(1-(he+ye))*et,i[1]=(ae+He)*et,i[2]=(W-je)*et,i[3]=0,i[4]=(ae-He)*Ge,i[5]=(1-(ee+ye))*Ge,i[6]=(ge+Ae)*Ge,i[7]=0,i[8]=(W+je)*it,i[9]=(ge-Ae)*it,i[10]=(1-(ee+he))*it,i[11]=0,i[12]=e.x,i[13]=e.y,i[14]=e.z,i[15]=1,this},decompose:function(e,t,r){var i=this.elements,l=Eo.set(i[0],i[1],i[2]).length(),p=Eo.set(i[4],i[5],i[6]).length(),f=Eo.set(i[8],i[9],i[10]).length();this.determinant()<0&&(l=-l),e.x=i[12],e.y=i[13],e.z=i[14],ra.copy(this);var w=1/l,L=1/p,V=1/f;return ra.elements[0]*=w,ra.elements[1]*=w,ra.elements[2]*=w,ra.elements[4]*=L,ra.elements[5]*=L,ra.elements[6]*=L,ra.elements[8]*=V,ra.elements[9]*=V,ra.elements[10]*=V,t.setFromRotationMatrix(ra),r.x=l,r.y=p,r.z=f,this},makePerspective:function(e,t,r,i,l,p){p===void 0&&console.warn("THREE.Matrix4: .makePerspective() has been redefined and has a new signature. Please check the docs.");var f=this.elements,w=2*l/(t-e),L=2*l/(r-i),V=(t+e)/(t-e),Z=(r+i)/(r-i),ee=-(p+l)/(p-l),ae=-2*p*l/(p-l);return f[0]=w,f[4]=0,f[8]=V,f[12]=0,f[1]=0,f[5]=L,f[9]=Z,f[13]=0,f[2]=0,f[6]=0,f[10]=ee,f[14]=ae,f[3]=0,f[7]=0,f[11]=-1,f[15]=0,this},makeOrthographic:function(e,t,r,i,l,p){var f=this.elements,w=1/(t-e),L=1/(r-i),V=1/(p-l),Z=(t+e)*w,ee=(r+i)*L,ae=(p+l)*V;return f[0]=2*w,f[4]=0,f[8]=0,f[12]=-Z,f[1]=0,f[5]=2*L,f[9]=0,f[13]=-ee,f[2]=0,f[6]=0,f[10]=-2*V,f[14]=-ae,f[3]=0,f[7]=0,f[11]=0,f[15]=1,this},equals:function(e){for(var t=this.elements,r=e.elements,i=0;i<16;i++)if(t[i]!==r[i])return!1;return!0},fromArray:function(e,t){t===void 0&&(t=0);for(var r=0;r<16;r++)this.elements[r]=e[r+t];return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);var r=this.elements;return e[t]=r[0],e[t+1]=r[1],e[t+2]=r[2],e[t+3]=r[3],e[t+4]=r[4],e[t+5]=r[5],e[t+6]=r[6],e[t+7]=r[7],e[t+8]=r[8],e[t+9]=r[9],e[t+10]=r[10],e[t+11]=r[11],e[t+12]=r[12],e[t+13]=r[13],e[t+14]=r[14],e[t+15]=r[15],e}});var _l=new mn,au=new Gi;function y(e,t,r,i){this._x=e||0,this._y=t||0,this._z=r||0,this._order=i||y.DefaultOrder}function O(){this.mask=1}y.RotationOrders=["XYZ","YZX","ZXY","XZY","YXZ","ZYX"],y.DefaultOrder="XYZ",Object.defineProperties(y.prototype,{x:{get:function(){return this._x},set:function(e){this._x=e,this._onChangeCallback()}},y:{get:function(){return this._y},set:function(e){this._y=e,this._onChangeCallback()}},z:{get:function(){return this._z},set:function(e){this._z=e,this._onChangeCallback()}},order:{get:function(){return this._order},set:function(e){this._order=e,this._onChangeCallback()}}}),Object.assign(y.prototype,{isEuler:!0,set:function(e,t,r,i){return this._x=e,this._y=t,this._z=r,this._order=i||this._order,this._onChangeCallback(),this},clone:function(){return new this.constructor(this._x,this._y,this._z,this._order)},copy:function(e){return this._x=e._x,this._y=e._y,this._z=e._z,this._order=e._order,this._onChangeCallback(),this},setFromRotationMatrix:function(e,t,r){var i=xn.clamp,l=e.elements,p=l[0],f=l[4],w=l[8],L=l[1],V=l[5],Z=l[9],ee=l[2],ae=l[6],W=l[10];return(t=t||this._order)==="XYZ"?(this._y=Math.asin(i(w,-1,1)),Math.abs(w)<.9999999?(this._x=Math.atan2(-Z,W),this._z=Math.atan2(-f,p)):(this._x=Math.atan2(ae,V),this._z=0)):t==="YXZ"?(this._x=Math.asin(-i(Z,-1,1)),Math.abs(Z)<.9999999?(this._y=Math.atan2(w,W),this._z=Math.atan2(L,V)):(this._y=Math.atan2(-ee,p),this._z=0)):t==="ZXY"?(this._x=Math.asin(i(ae,-1,1)),Math.abs(ae)<.9999999?(this._y=Math.atan2(-ee,W),this._z=Math.atan2(-f,V)):(this._y=0,this._z=Math.atan2(L,p))):t==="ZYX"?(this._y=Math.asin(-i(ee,-1,1)),Math.abs(ee)<.9999999?(this._x=Math.atan2(ae,W),this._z=Math.atan2(L,p)):(this._x=0,this._z=Math.atan2(-f,V))):t==="YZX"?(this._z=Math.asin(i(L,-1,1)),Math.abs(L)<.9999999?(this._x=Math.atan2(-Z,V),this._y=Math.atan2(-ee,p)):(this._x=0,this._y=Math.atan2(w,W))):t==="XZY"?(this._z=Math.asin(-i(f,-1,1)),Math.abs(f)<.9999999?(this._x=Math.atan2(ae,V),this._y=Math.atan2(w,p)):(this._x=Math.atan2(-Z,W),this._y=0)):console.warn("THREE.Euler: .setFromRotationMatrix() given unsupported order: "+t),this._order=t,r!==!1&&this._onChangeCallback(),this},setFromQuaternion:function(e,t,r){return _l.makeRotationFromQuaternion(e),this.setFromRotationMatrix(_l,t,r)},setFromVector3:function(e,t){return this.set(e.x,e.y,e.z,t||this._order)},reorder:function(e){return au.setFromEuler(this),this.setFromQuaternion(au,e)},equals:function(e){return e._x===this._x&&e._y===this._y&&e._z===this._z&&e._order===this._order},fromArray:function(e){return this._x=e[0],this._y=e[1],this._z=e[2],e[3]!==void 0&&(this._order=e[3]),this._onChangeCallback(),this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this._x,e[t+1]=this._y,e[t+2]=this._z,e[t+3]=this._order,e},toVector3:function(e){return e?e.set(this._x,this._y,this._z):new Le(this._x,this._y,this._z)},_onChange:function(e){return this._onChangeCallback=e,this},_onChangeCallback:function(){}}),Object.assign(O.prototype,{set:function(e){this.mask=1<<e|0},enable:function(e){this.mask|=1<<e|0},enableAll:function(){this.mask=-1},toggle:function(e){this.mask^=1<<e|0},disable:function(e){this.mask&=~(1<<e|0)},disableAll:function(){this.mask=0},test:function(e){return(this.mask&e.mask)!=0}});var K=0,ie=new Le,pe=new Gi,me=new mn,Te=new Le,_e=new Le,Se=new Le,Fe=new Gi,rt=new Le(1,0,0),dt=new Le(0,1,0),ut=new Le(0,0,1),Lt={type:"added"},Rr={type:"removed"};function At(){Object.defineProperty(this,"id",{value:K++}),this.uuid=xn.generateUUID(),this.name="",this.type="Object3D",this.parent=null,this.children=[],this.up=At.DefaultUp.clone();var e=new Le,t=new y,r=new Gi,i=new Le(1,1,1);t._onChange(function(){r.setFromEuler(t,!1)}),r._onChange(function(){t.setFromQuaternion(r,void 0,!1)}),Object.defineProperties(this,{position:{configurable:!0,enumerable:!0,value:e},rotation:{configurable:!0,enumerable:!0,value:t},quaternion:{configurable:!0,enumerable:!0,value:r},scale:{configurable:!0,enumerable:!0,value:i},modelViewMatrix:{value:new mn},normalMatrix:{value:new Ai}}),this.matrix=new mn,this.matrixWorld=new mn,this.matrixAutoUpdate=At.DefaultMatrixAutoUpdate,this.matrixWorldNeedsUpdate=!1,this.layers=new O,this.visible=!0,this.castShadow=!1,this.receiveShadow=!1,this.frustumCulled=!0,this.renderOrder=0,this.userData={}}function Wr(){At.call(this),this.type="Scene",this.background=null,this.environment=null,this.fog=null,this.overrideMaterial=null,this.autoUpdate=!0,typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}At.DefaultUp=new Le(0,1,0),At.DefaultMatrixAutoUpdate=!0,At.prototype=Object.assign(Object.create(Ia.prototype),{constructor:At,isObject3D:!0,onBeforeRender:function(){},onAfterRender:function(){},applyMatrix4:function(e){this.matrixAutoUpdate&&this.updateMatrix(),this.matrix.premultiply(e),this.matrix.decompose(this.position,this.quaternion,this.scale)},applyQuaternion:function(e){return this.quaternion.premultiply(e),this},setRotationFromAxisAngle:function(e,t){this.quaternion.setFromAxisAngle(e,t)},setRotationFromEuler:function(e){this.quaternion.setFromEuler(e,!0)},setRotationFromMatrix:function(e){this.quaternion.setFromRotationMatrix(e)},setRotationFromQuaternion:function(e){this.quaternion.copy(e)},rotateOnAxis:function(e,t){return pe.setFromAxisAngle(e,t),this.quaternion.multiply(pe),this},rotateOnWorldAxis:function(e,t){return pe.setFromAxisAngle(e,t),this.quaternion.premultiply(pe),this},rotateX:function(e){return this.rotateOnAxis(rt,e)},rotateY:function(e){return this.rotateOnAxis(dt,e)},rotateZ:function(e){return this.rotateOnAxis(ut,e)},translateOnAxis:function(e,t){return ie.copy(e).applyQuaternion(this.quaternion),this.position.add(ie.multiplyScalar(t)),this},translateX:function(e){return this.translateOnAxis(rt,e)},translateY:function(e){return this.translateOnAxis(dt,e)},translateZ:function(e){return this.translateOnAxis(ut,e)},localToWorld:function(e){return e.applyMatrix4(this.matrixWorld)},worldToLocal:function(e){return e.applyMatrix4(me.getInverse(this.matrixWorld))},lookAt:function(e,t,r){e.isVector3?Te.copy(e):Te.set(e,t,r);var i=this.parent;this.updateWorldMatrix(!0,!1),_e.setFromMatrixPosition(this.matrixWorld),this.isCamera||this.isLight?me.lookAt(_e,Te,this.up):me.lookAt(Te,_e,this.up),this.quaternion.setFromRotationMatrix(me),i&&(me.extractRotation(i.matrixWorld),pe.setFromRotationMatrix(me),this.quaternion.premultiply(pe.inverse()))},add:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.add(arguments[t]);return this}return e===this?console.error("THREE.Object3D.add: object can't be added as a child of itself.",e):e&&e.isObject3D?(e.parent!==null&&e.parent.remove(e),(e.parent=this).children.push(e),e.dispatchEvent(Lt)):console.error("THREE.Object3D.add: object not an instance of THREE.Object3D.",e),this},remove:function(e){if(1<arguments.length){for(var t=0;t<arguments.length;t++)this.remove(arguments[t]);return this}var r=this.children.indexOf(e);return r!==-1&&(e.parent=null,this.children.splice(r,1),e.dispatchEvent(Rr)),this},attach:function(e){return this.updateWorldMatrix(!0,!1),me.getInverse(this.matrixWorld),e.parent!==null&&(e.parent.updateWorldMatrix(!0,!1),me.multiply(e.parent.matrixWorld)),e.applyMatrix4(me),e.updateWorldMatrix(!1,!1),this.add(e),this},getObjectById:function(e){return this.getObjectByProperty("id",e)},getObjectByName:function(e){return this.getObjectByProperty("name",e)},getObjectByProperty:function(e,t){if(this[e]===t)return this;for(var r=0,i=this.children.length;r<i;r++){var l=this.children[r].getObjectByProperty(e,t);if(l!==void 0)return l}},getWorldPosition:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldPosition() target is now required"),e=new Le),this.updateMatrixWorld(!0),e.setFromMatrixPosition(this.matrixWorld)},getWorldQuaternion:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldQuaternion() target is now required"),e=new Gi),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_e,e,Se),e},getWorldScale:function(e){return e===void 0&&(console.warn("THREE.Object3D: .getWorldScale() target is now required"),e=new Le),this.updateMatrixWorld(!0),this.matrixWorld.decompose(_e,Fe,e),e},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Object3D: .getWorldDirection() target is now required"),e=new Le),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(t[8],t[9],t[10]).normalize()},raycast:function(){},traverse:function(e){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverse(e)},traverseVisible:function(e){if(this.visible!==!1){e(this);for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].traverseVisible(e)}},traverseAncestors:function(e){var t=this.parent;t!==null&&(e(t),t.traverseAncestors(e))},updateMatrix:function(){this.matrix.compose(this.position,this.quaternion,this.scale),this.matrixWorldNeedsUpdate=!0},updateMatrixWorld:function(e){this.matrixAutoUpdate&&this.updateMatrix(),(this.matrixWorldNeedsUpdate||e)&&(this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),e=!(this.matrixWorldNeedsUpdate=!1));for(var t=this.children,r=0,i=t.length;r<i;r++)t[r].updateMatrixWorld(e)},updateWorldMatrix:function(e,t){var r=this.parent;if(e===!0&&r!==null&&r.updateWorldMatrix(!0,!1),this.matrixAutoUpdate&&this.updateMatrix(),this.parent===null?this.matrixWorld.copy(this.matrix):this.matrixWorld.multiplyMatrices(this.parent.matrixWorld,this.matrix),t===!0)for(var i=this.children,l=0,p=i.length;l<p;l++)i[l].updateWorldMatrix(!1,!0)},toJSON:function(e){var t=e===void 0||typeof e=="string",r={};t&&(e={geometries:{},materials:{},textures:{},images:{},shapes:{}},r.metadata={version:4.5,type:"Object",generator:"Object3D.toJSON"});var i={};function l(ye,Ae){return ye[Ae.uuid]===void 0&&(ye[Ae.uuid]=Ae.toJSON(e)),Ae.uuid}if(i.uuid=this.uuid,i.type=this.type,this.name!==""&&(i.name=this.name),this.castShadow===!0&&(i.castShadow=!0),this.receiveShadow===!0&&(i.receiveShadow=!0),this.visible===!1&&(i.visible=!1),this.frustumCulled===!1&&(i.frustumCulled=!1),this.renderOrder!==0&&(i.renderOrder=this.renderOrder),JSON.stringify(this.userData)!=="{}"&&(i.userData=this.userData),i.layers=this.layers.mask,i.matrix=this.matrix.toArray(),this.matrixAutoUpdate===!1&&(i.matrixAutoUpdate=!1),this.isInstancedMesh&&(i.type="InstancedMesh",i.count=this.count,i.instanceMatrix=this.instanceMatrix.toJSON()),this.isMesh||this.isLine||this.isPoints){i.geometry=l(e.geometries,this.geometry);var p=this.geometry.parameters;if(p!==void 0&&p.shapes!==void 0){var f=p.shapes;if(Array.isArray(f))for(var w=0,L=f.length;w<L;w++){var V=f[w];l(e.shapes,V)}else l(e.shapes,f)}}if(this.material!==void 0)if(Array.isArray(this.material)){var Z=[];for(w=0,L=this.material.length;w<L;w++)Z.push(l(e.materials,this.material[w]));i.material=Z}else i.material=l(e.materials,this.material);if(0<this.children.length)for(i.children=[],w=0;w<this.children.length;w++)i.children.push(this.children[w].toJSON(e).object);if(t){var ee=ge(e.geometries),ae=ge(e.materials),W=ge(e.textures),he=ge(e.images);f=ge(e.shapes),0<ee.length&&(r.geometries=ee),0<ae.length&&(r.materials=ae),0<W.length&&(r.textures=W),0<he.length&&(r.images=he),0<f.length&&(r.shapes=f)}return r.object=i,r;function ge(ye){var Ae=[];for(var je in ye){var He=ye[je];delete He.metadata,Ae.push(He)}return Ae}},clone:function(e){return new this.constructor().copy(this,e)},copy:function(e,t){if(t===void 0&&(t=!0),this.name=e.name,this.up.copy(e.up),this.position.copy(e.position),this.quaternion.copy(e.quaternion),this.scale.copy(e.scale),this.matrix.copy(e.matrix),this.matrixWorld.copy(e.matrixWorld),this.matrixAutoUpdate=e.matrixAutoUpdate,this.matrixWorldNeedsUpdate=e.matrixWorldNeedsUpdate,this.layers.mask=e.layers.mask,this.visible=e.visible,this.castShadow=e.castShadow,this.receiveShadow=e.receiveShadow,this.frustumCulled=e.frustumCulled,this.renderOrder=e.renderOrder,this.userData=JSON.parse(JSON.stringify(e.userData)),t===!0)for(var r=0;r<e.children.length;r++){var i=e.children[r];this.add(i.clone())}return this}}),Wr.prototype=Object.assign(Object.create(At.prototype),{constructor:Wr,isScene:!0,copy:function(e,t){return At.prototype.copy.call(this,e,t),e.background!==null&&(this.background=e.background.clone()),e.environment!==null&&(this.environment=e.environment.clone()),e.fog!==null&&(this.fog=e.fog.clone()),e.overrideMaterial!==null&&(this.overrideMaterial=e.overrideMaterial.clone()),this.autoUpdate=e.autoUpdate,this.matrixAutoUpdate=e.matrixAutoUpdate,this},toJSON:function(e){var t=At.prototype.toJSON.call(this,e);return this.background!==null&&(t.object.background=this.background.toJSON(e)),this.environment!==null&&(t.object.environment=this.environment.toJSON(e)),this.fog!==null&&(t.object.fog=this.fog.toJSON()),t},dispose:function(){this.dispatchEvent({type:"dispose"})}});var Zn=[new Le,new Le,new Le,new Le,new Le,new Le,new Le,new Le],Un=new Le,la=new Zi,Ma=new Le,dn=new Le,_a=new Le,wn=new Le,Jr=new Le,so=new Le,Uo=new Le,ua=new Le,Ho=new Le,Ta=new Le;function Zi(e,t){this.min=e!==void 0?e:new Le(1/0,1/0,1/0),this.max=t!==void 0?t:new Le(-1/0,-1/0,-1/0)}function lo(e,t,r,i,l){var p,f;for(p=0,f=e.length-3;p<=f;p+=3){Ta.fromArray(e,p);var w=l.x*Math.abs(Ta.x)+l.y*Math.abs(Ta.y)+l.z*Math.abs(Ta.z),L=t.dot(Ta),V=r.dot(Ta),Z=i.dot(Ta);if(Math.max(-Math.max(L,V,Z),Math.min(L,V,Z))>w)return!1}return!0}Object.assign(Zi.prototype,{isBox3:!0,set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromArray:function(e){for(var t=1/0,r=1/0,i=1/0,l=-1/0,p=-1/0,f=-1/0,w=0,L=e.length;w<L;w+=3){var V=e[w],Z=e[w+1],ee=e[w+2];V<t&&(t=V),Z<r&&(r=Z),ee<i&&(i=ee),l<V&&(l=V),p<Z&&(p=Z),f<ee&&(f=ee)}return this.min.set(t,r,i),this.max.set(l,p,f),this},setFromBufferAttribute:function(e){for(var t=1/0,r=1/0,i=1/0,l=-1/0,p=-1/0,f=-1/0,w=0,L=e.count;w<L;w++){var V=e.getX(w),Z=e.getY(w),ee=e.getZ(w);V<t&&(t=V),Z<r&&(r=Z),ee<i&&(i=ee),l<V&&(l=V),p<Z&&(p=Z),f<ee&&(f=ee)}return this.min.set(t,r,i),this.max.set(l,p,f),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=Un.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},setFromObject:function(e){return this.makeEmpty(),this.expandByObject(e)},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=this.min.z=1/0,this.max.x=this.max.y=this.max.z=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y||this.max.z<this.min.z},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box3: .getCenter() target is now required"),e=new Le),this.isEmpty()?e.set(0,0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box3: .getSize() target is now required"),e=new Le),this.isEmpty()?e.set(0,0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},expandByObject:function(e){e.updateWorldMatrix(!1,!1);var t=e.geometry;t!==void 0&&(t.boundingBox===null&&t.computeBoundingBox(),la.copy(t.boundingBox),la.applyMatrix4(e.matrixWorld),this.expandByPoint(la.min),this.expandByPoint(la.max));for(var r=e.children,i=0,l=r.length;i<l;i++)this.expandByObject(r[i]);return this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y||e.z<this.min.z||e.z>this.max.z)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y&&this.min.z<=e.min.z&&e.max.z<=this.max.z},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .getParameter() target is now required"),t=new Le),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y),(e.z-this.min.z)/(this.max.z-this.min.z))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y||e.max.z<this.min.z||e.min.z>this.max.z)},intersectsSphere:function(e){return this.clampPoint(e.center,Un),Un.distanceToSquared(e.center)<=e.radius*e.radius},intersectsPlane:function(e){var t,r;return r=0<e.normal.x?(t=e.normal.x*this.min.x,e.normal.x*this.max.x):(t=e.normal.x*this.max.x,e.normal.x*this.min.x),0<e.normal.y?(t+=e.normal.y*this.min.y,r+=e.normal.y*this.max.y):(t+=e.normal.y*this.max.y,r+=e.normal.y*this.min.y),0<e.normal.z?(t+=e.normal.z*this.min.z,r+=e.normal.z*this.max.z):(t+=e.normal.z*this.max.z,r+=e.normal.z*this.min.z),t<=-e.constant&&r>=-e.constant},intersectsTriangle:function(e){if(this.isEmpty())return!1;this.getCenter(Uo),ua.subVectors(this.max,Uo),Ma.subVectors(e.a,Uo),dn.subVectors(e.b,Uo),_a.subVectors(e.c,Uo),wn.subVectors(dn,Ma),Jr.subVectors(_a,dn),so.subVectors(Ma,_a);var t=[0,-wn.z,wn.y,0,-Jr.z,Jr.y,0,-so.z,so.y,wn.z,0,-wn.x,Jr.z,0,-Jr.x,so.z,0,-so.x,-wn.y,wn.x,0,-Jr.y,Jr.x,0,-so.y,so.x,0];return!!lo(t,Ma,dn,_a,ua)&&!!lo(t=[1,0,0,0,1,0,0,0,1],Ma,dn,_a,ua)&&(Ho.crossVectors(wn,Jr),lo(t=[Ho.x,Ho.y,Ho.z],Ma,dn,_a,ua))},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box3: .clampPoint() target is now required"),t=new Le),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Un.copy(e).clamp(this.min,this.max).sub(e).length()},getBoundingSphere:function(e){return e===void 0&&console.error("THREE.Box3: .getBoundingSphere() target is now required"),this.getCenter(e.center),e.radius=.5*this.getSize(Un).length(),e},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this.isEmpty()&&this.makeEmpty(),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},applyMatrix4:function(e){return this.isEmpty()||(Zn[0].set(this.min.x,this.min.y,this.min.z).applyMatrix4(e),Zn[1].set(this.min.x,this.min.y,this.max.z).applyMatrix4(e),Zn[2].set(this.min.x,this.max.y,this.min.z).applyMatrix4(e),Zn[3].set(this.min.x,this.max.y,this.max.z).applyMatrix4(e),Zn[4].set(this.max.x,this.min.y,this.min.z).applyMatrix4(e),Zn[5].set(this.max.x,this.min.y,this.max.z).applyMatrix4(e),Zn[6].set(this.max.x,this.max.y,this.min.z).applyMatrix4(e),Zn[7].set(this.max.x,this.max.y,this.max.z).applyMatrix4(e),this.setFromPoints(Zn)),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var zi=new Zi;function Kn(e,t){this.center=e!==void 0?e:new Le,this.radius=t!==void 0?t:0}Object.assign(Kn.prototype,{set:function(e,t){return this.center.copy(e),this.radius=t,this},setFromPoints:function(e,t){var r=this.center;t!==void 0?r.copy(t):zi.setFromPoints(e).getCenter(r);for(var i=0,l=0,p=e.length;l<p;l++)i=Math.max(i,r.distanceToSquared(e[l]));return this.radius=Math.sqrt(i),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.center.copy(e.center),this.radius=e.radius,this},empty:function(){return this.radius<=0},containsPoint:function(e){return e.distanceToSquared(this.center)<=this.radius*this.radius},distanceToPoint:function(e){return e.distanceTo(this.center)-this.radius},intersectsSphere:function(e){var t=this.radius+e.radius;return e.center.distanceToSquared(this.center)<=t*t},intersectsBox:function(e){return e.intersectsSphere(this)},intersectsPlane:function(e){return Math.abs(e.distanceToPoint(this.center))<=this.radius},clampPoint:function(e,t){var r=this.center.distanceToSquared(e);return t===void 0&&(console.warn("THREE.Sphere: .clampPoint() target is now required"),t=new Le),t.copy(e),r>this.radius*this.radius&&(t.sub(this.center).normalize(),t.multiplyScalar(this.radius).add(this.center)),t},getBoundingBox:function(e){return e===void 0&&(console.warn("THREE.Sphere: .getBoundingBox() target is now required"),e=new Zi),e.set(this.center,this.center),e.expandByScalar(this.radius),e},applyMatrix4:function(e){return this.center.applyMatrix4(e),this.radius=this.radius*e.getMaxScaleOnAxis(),this},translate:function(e){return this.center.add(e),this},equals:function(e){return e.center.equals(this.center)&&e.radius===this.radius}});var $n=new Le,Li=new Le,Ua=new Le,_i=new Le,qr=new Le,li=new Le,ni=new Le;function kn(e,t){this.origin=e!==void 0?e:new Le,this.direction=t!==void 0?t:new Le(0,0,-1)}Object.assign(kn.prototype,{set:function(e,t){return this.origin.copy(e),this.direction.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.origin.copy(e.origin),this.direction.copy(e.direction),this},at:function(e,t){return t===void 0&&(console.warn("THREE.Ray: .at() target is now required"),t=new Le),t.copy(this.direction).multiplyScalar(e).add(this.origin)},lookAt:function(e){return this.direction.copy(e).sub(this.origin).normalize(),this},recast:function(e){return this.origin.copy(this.at(e,$n)),this},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Ray: .closestPointToPoint() target is now required"),t=new Le),t.subVectors(e,this.origin);var r=t.dot(this.direction);return r<0?t.copy(this.origin):t.copy(this.direction).multiplyScalar(r).add(this.origin)},distanceToPoint:function(e){return Math.sqrt(this.distanceSqToPoint(e))},distanceSqToPoint:function(e){var t=$n.subVectors(e,this.origin).dot(this.direction);return t<0?this.origin.distanceToSquared(e):($n.copy(this.direction).multiplyScalar(t).add(this.origin),$n.distanceToSquared(e))},distanceSqToSegment:function(e,t,r,i){Li.copy(e).add(t).multiplyScalar(.5),Ua.copy(t).sub(e).normalize(),_i.copy(this.origin).sub(Li);var l,p,f,w,L=.5*e.distanceTo(t),V=-this.direction.dot(Ua),Z=_i.dot(this.direction),ee=-_i.dot(Ua),ae=_i.lengthSq(),W=Math.abs(1-V*V);if(0<W)if(p=V*Z-ee,w=L*W,0<=(l=V*ee-Z))if(-w<=p)if(p<=w){var he=1/W;f=(l*=he)*(l+V*(p*=he)+2*Z)+p*(V*l+p+2*ee)+ae}else p=L,f=-(l=Math.max(0,-(V*p+Z)))*l+p*(p+2*ee)+ae;else p=-L,f=-(l=Math.max(0,-(V*p+Z)))*l+p*(p+2*ee)+ae;else f=p<=-w?-(l=Math.max(0,-(-V*L+Z)))*l+(p=0<l?-L:Math.min(Math.max(-L,-ee),L))*(p+2*ee)+ae:p<=w?(l=0,(p=Math.min(Math.max(-L,-ee),L))*(p+2*ee)+ae):-(l=Math.max(0,-(V*L+Z)))*l+(p=0<l?L:Math.min(Math.max(-L,-ee),L))*(p+2*ee)+ae;else p=0<V?-L:L,f=-(l=Math.max(0,-(V*p+Z)))*l+p*(p+2*ee)+ae;return r&&r.copy(this.direction).multiplyScalar(l).add(this.origin),i&&i.copy(Ua).multiplyScalar(p).add(Li),f},intersectSphere:function(e,t){$n.subVectors(e.center,this.origin);var r=$n.dot(this.direction),i=$n.dot($n)-r*r,l=e.radius*e.radius;if(l<i)return null;var p=Math.sqrt(l-i),f=r-p,w=r+p;return f<0&&w<0?null:f<0?this.at(w,t):this.at(f,t)},intersectsSphere:function(e){return this.distanceSqToPoint(e.center)<=e.radius*e.radius},distanceToPlane:function(e){var t=e.normal.dot(this.direction);if(t===0)return e.distanceToPoint(this.origin)===0?0:null;var r=-(this.origin.dot(e.normal)+e.constant)/t;return 0<=r?r:null},intersectPlane:function(e,t){var r=this.distanceToPlane(e);return r===null?null:this.at(r,t)},intersectsPlane:function(e){var t=e.distanceToPoint(this.origin);return t===0||e.normal.dot(this.direction)*t<0},intersectBox:function(e,t){var r,i,l,p,f,w,L=1/this.direction.x,V=1/this.direction.y,Z=1/this.direction.z,ee=this.origin;return i=0<=L?(r=(e.min.x-ee.x)*L,(e.max.x-ee.x)*L):(r=(e.max.x-ee.x)*L,(e.min.x-ee.x)*L),(p=0<=V?(l=(e.min.y-ee.y)*V,(e.max.y-ee.y)*V):(l=(e.max.y-ee.y)*V,(e.min.y-ee.y)*V))<r||i<l?null:((r<l||r!=r)&&(r=l),(p<i||i!=i)&&(i=p),(w=0<=Z?(f=(e.min.z-ee.z)*Z,(e.max.z-ee.z)*Z):(f=(e.max.z-ee.z)*Z,(e.min.z-ee.z)*Z))<r||i<f?null:((r<f||r!=r)&&(r=f),(w<i||i!=i)&&(i=w),i<0?null:this.at(0<=r?r:i,t)))},intersectsBox:function(e){return this.intersectBox(e,$n)!==null},intersectTriangle:function(e,t,r,i,l){qr.subVectors(t,e),li.subVectors(r,e),ni.crossVectors(qr,li);var p,f=this.direction.dot(ni);if(0<f){if(i)return null;p=1}else{if(!(f<0))return null;p=-1,f=-f}_i.subVectors(this.origin,e);var w=p*this.direction.dot(li.crossVectors(_i,li));if(w<0)return null;var L=p*this.direction.dot(qr.cross(_i));if(L<0||f<w+L)return null;var V=-p*_i.dot(ni);return V<0?null:this.at(V/f,l)},applyMatrix4:function(e){return this.origin.applyMatrix4(e),this.direction.transformDirection(e),this},equals:function(e){return e.origin.equals(this.origin)&&e.direction.equals(this.direction)}});var Ca=new Le,_s=new Le,Tl=new Ai;function na(e,t){this.normal=e!==void 0?e:new Le(1,0,0),this.constant=t!==void 0?t:0}Object.assign(na.prototype,{isPlane:!0,set:function(e,t){return this.normal.copy(e),this.constant=t,this},setComponents:function(e,t,r,i){return this.normal.set(e,t,r),this.constant=i,this},setFromNormalAndCoplanarPoint:function(e,t){return this.normal.copy(e),this.constant=-t.dot(this.normal),this},setFromCoplanarPoints:function(e,t,r){var i=Ca.subVectors(r,t).cross(_s.subVectors(e,t)).normalize();return this.setFromNormalAndCoplanarPoint(i,e),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.normal.copy(e.normal),this.constant=e.constant,this},normalize:function(){var e=1/this.normal.length();return this.normal.multiplyScalar(e),this.constant*=e,this},negate:function(){return this.constant*=-1,this.normal.negate(),this},distanceToPoint:function(e){return this.normal.dot(e)+this.constant},distanceToSphere:function(e){return this.distanceToPoint(e.center)-e.radius},projectPoint:function(e,t){return t===void 0&&(console.warn("THREE.Plane: .projectPoint() target is now required"),t=new Le),t.copy(this.normal).multiplyScalar(-this.distanceToPoint(e)).add(e)},intersectLine:function(e,t){t===void 0&&(console.warn("THREE.Plane: .intersectLine() target is now required"),t=new Le);var r=e.delta(Ca),i=this.normal.dot(r);if(i===0)return this.distanceToPoint(e.start)===0?t.copy(e.start):void 0;var l=-(e.start.dot(this.normal)+this.constant)/i;return l<0||1<l?void 0:t.copy(r).multiplyScalar(l).add(e.start)},intersectsLine:function(e){var t=this.distanceToPoint(e.start),r=this.distanceToPoint(e.end);return t<0&&0<r||r<0&&0<t},intersectsBox:function(e){return e.intersectsPlane(this)},intersectsSphere:function(e){return e.intersectsPlane(this)},coplanarPoint:function(e){return e===void 0&&(console.warn("THREE.Plane: .coplanarPoint() target is now required"),e=new Le),e.copy(this.normal).multiplyScalar(-this.constant)},applyMatrix4:function(e,t){var r=t||Tl.getNormalMatrix(e),i=this.coplanarPoint(Ca).applyMatrix4(e),l=this.normal.applyMatrix3(r).normalize();return this.constant=-i.dot(l),this},translate:function(e){return this.constant-=e.dot(this.normal),this},equals:function(e){return e.normal.equals(this.normal)&&e.constant===this.constant}});var ca=new Le,Ui=new Le,Ts=new Le,Ha=new Le,wo=new Le,Ao=new Le,Cl=new Le,fi=new Le,Ii=new Le,Ws=new Le;function ki(e,t,r){this.a=e!==void 0?e:new Le,this.b=t!==void 0?t:new Le,this.c=r!==void 0?r:new Le}Object.assign(ki,{getNormal:function(e,t,r,i){i===void 0&&(console.warn("THREE.Triangle: .getNormal() target is now required"),i=new Le),i.subVectors(r,t),ca.subVectors(e,t),i.cross(ca);var l=i.lengthSq();return 0<l?i.multiplyScalar(1/Math.sqrt(l)):i.set(0,0,0)},getBarycoord:function(e,t,r,i,l){ca.subVectors(i,t),Ui.subVectors(r,t),Ts.subVectors(e,t);var p=ca.dot(ca),f=ca.dot(Ui),w=ca.dot(Ts),L=Ui.dot(Ui),V=Ui.dot(Ts),Z=p*L-f*f;if(l===void 0&&(console.warn("THREE.Triangle: .getBarycoord() target is now required"),l=new Le),Z==0)return l.set(-2,-1,-1);var ee=1/Z,ae=(L*w-f*V)*ee,W=(p*V-f*w)*ee;return l.set(1-ae-W,W,ae)},containsPoint:function(e,t,r,i){return ki.getBarycoord(e,t,r,i,Ha),0<=Ha.x&&0<=Ha.y&&Ha.x+Ha.y<=1},getUV:function(e,t,r,i,l,p,f,w){return this.getBarycoord(e,t,r,i,Ha),w.set(0,0),w.addScaledVector(l,Ha.x),w.addScaledVector(p,Ha.y),w.addScaledVector(f,Ha.z),w},isFrontFacing:function(e,t,r,i){return ca.subVectors(r,t),Ui.subVectors(e,t),ca.cross(Ui).dot(i)<0}}),Object.assign(ki.prototype,{set:function(e,t,r){return this.a.copy(e),this.b.copy(t),this.c.copy(r),this},setFromPointsAndIndices:function(e,t,r,i){return this.a.copy(e[t]),this.b.copy(e[r]),this.c.copy(e[i]),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.a.copy(e.a),this.b.copy(e.b),this.c.copy(e.c),this},getArea:function(){return ca.subVectors(this.c,this.b),Ui.subVectors(this.a,this.b),.5*ca.cross(Ui).length()},getMidpoint:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getMidpoint() target is now required"),e=new Le),e.addVectors(this.a,this.b).add(this.c).multiplyScalar(1/3)},getNormal:function(e){return ki.getNormal(this.a,this.b,this.c,e)},getPlane:function(e){return e===void 0&&(console.warn("THREE.Triangle: .getPlane() target is now required"),e=new na),e.setFromCoplanarPoints(this.a,this.b,this.c)},getBarycoord:function(e,t){return ki.getBarycoord(e,this.a,this.b,this.c,t)},getUV:function(e,t,r,i,l){return ki.getUV(e,this.a,this.b,this.c,t,r,i,l)},containsPoint:function(e){return ki.containsPoint(e,this.a,this.b,this.c)},isFrontFacing:function(e){return ki.isFrontFacing(this.a,this.b,this.c,e)},intersectsBox:function(e){return e.intersectsTriangle(this)},closestPointToPoint:function(e,t){t===void 0&&(console.warn("THREE.Triangle: .closestPointToPoint() target is now required"),t=new Le);var r,i,l=this.a,p=this.b,f=this.c;wo.subVectors(p,l),Ao.subVectors(f,l),fi.subVectors(e,l);var w=wo.dot(fi),L=Ao.dot(fi);if(w<=0&&L<=0)return t.copy(l);Ii.subVectors(e,p);var V=wo.dot(Ii),Z=Ao.dot(Ii);if(0<=V&&Z<=V)return t.copy(p);var ee=w*Z-V*L;if(ee<=0&&0<=w&&V<=0)return r=w/(w-V),t.copy(l).addScaledVector(wo,r);Ws.subVectors(e,f);var ae=wo.dot(Ws),W=Ao.dot(Ws);if(0<=W&&ae<=W)return t.copy(f);var he=ae*L-w*W;if(he<=0&&0<=L&&W<=0)return i=L/(L-W),t.copy(l).addScaledVector(Ao,i);var ge=V*W-ae*Z;if(ge<=0&&0<=Z-V&&0<=ae-W)return Cl.subVectors(f,p),i=(Z-V)/(Z-V+(ae-W)),t.copy(p).addScaledVector(Cl,i);var ye=1/(ge+he+ee);return r=he*ye,i=ee*ye,t.copy(l).addScaledVector(wo,r).addScaledVector(Ao,i)},equals:function(e){return e.a.equals(this.a)&&e.b.equals(this.b)&&e.c.equals(this.c)}});var Dl={aliceblue:15792383,antiquewhite:16444375,aqua:65535,aquamarine:8388564,azure:15794175,beige:16119260,bisque:16770244,black:0,blanchedalmond:16772045,blue:255,blueviolet:9055202,brown:10824234,burlywood:14596231,cadetblue:6266528,chartreuse:8388352,chocolate:13789470,coral:16744272,cornflowerblue:6591981,cornsilk:16775388,crimson:14423100,cyan:65535,darkblue:139,darkcyan:35723,darkgoldenrod:12092939,darkgray:11119017,darkgreen:25600,darkgrey:11119017,darkkhaki:12433259,darkmagenta:9109643,darkolivegreen:5597999,darkorange:16747520,darkorchid:10040012,darkred:9109504,darksalmon:15308410,darkseagreen:9419919,darkslateblue:4734347,darkslategray:3100495,darkslategrey:3100495,darkturquoise:52945,darkviolet:9699539,deeppink:16716947,deepskyblue:49151,dimgray:6908265,dimgrey:6908265,dodgerblue:2003199,firebrick:11674146,floralwhite:16775920,forestgreen:2263842,fuchsia:16711935,gainsboro:14474460,ghostwhite:16316671,gold:16766720,goldenrod:14329120,gray:8421504,green:32768,greenyellow:11403055,grey:8421504,honeydew:15794160,hotpink:16738740,indianred:13458524,indigo:4915330,ivory:16777200,khaki:15787660,lavender:15132410,lavenderblush:16773365,lawngreen:8190976,lemonchiffon:16775885,lightblue:11393254,lightcoral:15761536,lightcyan:14745599,lightgoldenrodyellow:16448210,lightgray:13882323,lightgreen:9498256,lightgrey:13882323,lightpink:16758465,lightsalmon:16752762,lightseagreen:2142890,lightskyblue:8900346,lightslategray:7833753,lightslategrey:7833753,lightsteelblue:11584734,lightyellow:16777184,lime:65280,limegreen:3329330,linen:16445670,magenta:16711935,maroon:8388608,mediumaquamarine:6737322,mediumblue:205,mediumorchid:12211667,mediumpurple:9662683,mediumseagreen:3978097,mediumslateblue:8087790,mediumspringgreen:64154,mediumturquoise:4772300,mediumvioletred:13047173,midnightblue:1644912,mintcream:16121850,mistyrose:16770273,moccasin:16770229,navajowhite:16768685,navy:128,oldlace:16643558,olive:8421376,olivedrab:7048739,orange:16753920,orangered:16729344,orchid:14315734,palegoldenrod:15657130,palegreen:10025880,paleturquoise:11529966,palevioletred:14381203,papayawhip:16773077,peachpuff:16767673,peru:13468991,pink:16761035,plum:14524637,powderblue:11591910,purple:8388736,rebeccapurple:6697881,red:16711680,rosybrown:12357519,royalblue:4286945,saddlebrown:9127187,salmon:16416882,sandybrown:16032864,seagreen:3050327,seashell:16774638,sienna:10506797,silver:12632256,skyblue:8900331,slateblue:6970061,slategray:7372944,slategrey:7372944,snow:16775930,springgreen:65407,steelblue:4620980,tan:13808780,teal:32896,thistle:14204888,tomato:16737095,turquoise:4251856,violet:15631086,wheat:16113331,white:16777215,whitesmoke:16119285,yellow:16776960,yellowgreen:10145074},Ne={h:0,s:0,l:0},ot={h:0,s:0,l:0};function Qe(e,t,r){return t===void 0&&r===void 0?this.set(e):this.setRGB(e,t,r)}function Ct(e,t,r){return r<0&&(r+=1),1<r&&--r,r<1/6?e+6*(t-e)*r:r<.5?t:r<2/3?e+6*(t-e)*(2/3-r):e}function jt(e){return e<.04045?.0773993808*e:Math.pow(.9478672986*e+.0521327014,2.4)}function pr(e){return e<.0031308?12.92*e:1.055*Math.pow(e,.41666)-.055}function dr(e,t,r,i,l,p){this.a=e,this.b=t,this.c=r,this.normal=i&&i.isVector3?i:new Le,this.vertexNormals=Array.isArray(i)?i:[],this.color=l&&l.isColor?l:new Qe,this.vertexColors=Array.isArray(l)?l:[],this.materialIndex=p!==void 0?p:0}Object.assign(Qe.prototype,{isColor:!0,r:1,g:1,b:1,set:function(e){return e&&e.isColor?this.copy(e):typeof e=="number"?this.setHex(e):typeof e=="string"&&this.setStyle(e),this},setScalar:function(e){return this.r=e,this.g=e,this.b=e,this},setHex:function(e){return e=Math.floor(e),this.r=(e>>16&255)/255,this.g=(e>>8&255)/255,this.b=(255&e)/255,this},setRGB:function(e,t,r){return this.r=e,this.g=t,this.b=r,this},setHSL:function(e,t,r){if(e=xn.euclideanModulo(e,1),t=xn.clamp(t,0,1),r=xn.clamp(r,0,1),t===0)this.r=this.g=this.b=r;else{var i=r<=.5?r*(1+t):r+t-r*t,l=2*r-i;this.r=Ct(l,i,e+1/3),this.g=Ct(l,i,e),this.b=Ct(l,i,e-1/3)}return this},setStyle:function(e){function t(ee){ee!==void 0&&parseFloat(ee)<1&&console.warn("THREE.Color: Alpha component of "+e+" will be ignored.")}var r;if(r=/^((?:rgb|hsl)a?)\(\s*([^\)]*)\)/.exec(e)){var i,l=r[1],p=r[2];switch(l){case"rgb":case"rgba":if(i=/^(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(p))return this.r=Math.min(255,parseInt(i[1],10))/255,this.g=Math.min(255,parseInt(i[2],10))/255,this.b=Math.min(255,parseInt(i[3],10))/255,t(i[5]),this;if(i=/^(\d+)\%\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(p))return this.r=Math.min(100,parseInt(i[1],10))/100,this.g=Math.min(100,parseInt(i[2],10))/100,this.b=Math.min(100,parseInt(i[3],10))/100,t(i[5]),this;break;case"hsl":case"hsla":if(i=/^([0-9]*\.?[0-9]+)\s*,\s*(\d+)\%\s*,\s*(\d+)\%\s*(,\s*([0-9]*\.?[0-9]+)\s*)?$/.exec(p)){var f=parseFloat(i[1])/360,w=parseInt(i[2],10)/100,L=parseInt(i[3],10)/100;return t(i[5]),this.setHSL(f,w,L)}}}else if(r=/^\#([A-Fa-f0-9]+)$/.exec(e)){var V=r[1],Z=V.length;if(Z===3)return this.r=parseInt(V.charAt(0)+V.charAt(0),16)/255,this.g=parseInt(V.charAt(1)+V.charAt(1),16)/255,this.b=parseInt(V.charAt(2)+V.charAt(2),16)/255,this;if(Z===6)return this.r=parseInt(V.charAt(0)+V.charAt(1),16)/255,this.g=parseInt(V.charAt(2)+V.charAt(3),16)/255,this.b=parseInt(V.charAt(4)+V.charAt(5),16)/255,this}return e&&0<e.length?this.setColorName(e):this},setColorName:function(e){var t=Dl[e];return t!==void 0?this.setHex(t):console.warn("THREE.Color: Unknown color "+e),this},clone:function(){return new this.constructor(this.r,this.g,this.b)},copy:function(e){return this.r=e.r,this.g=e.g,this.b=e.b,this},copyGammaToLinear:function(e,t){return t===void 0&&(t=2),this.r=Math.pow(e.r,t),this.g=Math.pow(e.g,t),this.b=Math.pow(e.b,t),this},copyLinearToGamma:function(e,t){t===void 0&&(t=2);var r=0<t?1/t:1;return this.r=Math.pow(e.r,r),this.g=Math.pow(e.g,r),this.b=Math.pow(e.b,r),this},convertGammaToLinear:function(e){return this.copyGammaToLinear(this,e),this},convertLinearToGamma:function(e){return this.copyLinearToGamma(this,e),this},copySRGBToLinear:function(e){return this.r=jt(e.r),this.g=jt(e.g),this.b=jt(e.b),this},copyLinearToSRGB:function(e){return this.r=pr(e.r),this.g=pr(e.g),this.b=pr(e.b),this},convertSRGBToLinear:function(){return this.copySRGBToLinear(this),this},convertLinearToSRGB:function(){return this.copyLinearToSRGB(this),this},getHex:function(){return 255*this.r<<16^255*this.g<<8^255*this.b<<0},getHexString:function(){return("000000"+this.getHex().toString(16)).slice(-6)},getHSL:function(e){e===void 0&&(console.warn("THREE.Color: .getHSL() target is now required"),e={h:0,s:0,l:0});var t,r,i=this.r,l=this.g,p=this.b,f=Math.max(i,l,p),w=Math.min(i,l,p),L=(w+f)/2;if(w===f)r=t=0;else{var V=f-w;switch(r=L<=.5?V/(f+w):V/(2-f-w),f){case i:t=(l-p)/V+(l<p?6:0);break;case l:t=(p-i)/V+2;break;case p:t=(i-l)/V+4}t/=6}return e.h=t,e.s=r,e.l=L,e},getStyle:function(){return"rgb("+(255*this.r|0)+","+(255*this.g|0)+","+(255*this.b|0)+")"},offsetHSL:function(e,t,r){return this.getHSL(Ne),Ne.h+=e,Ne.s+=t,Ne.l+=r,this.setHSL(Ne.h,Ne.s,Ne.l),this},add:function(e){return this.r+=e.r,this.g+=e.g,this.b+=e.b,this},addColors:function(e,t){return this.r=e.r+t.r,this.g=e.g+t.g,this.b=e.b+t.b,this},addScalar:function(e){return this.r+=e,this.g+=e,this.b+=e,this},sub:function(e){return this.r=Math.max(0,this.r-e.r),this.g=Math.max(0,this.g-e.g),this.b=Math.max(0,this.b-e.b),this},multiply:function(e){return this.r*=e.r,this.g*=e.g,this.b*=e.b,this},multiplyScalar:function(e){return this.r*=e,this.g*=e,this.b*=e,this},lerp:function(e,t){return this.r+=(e.r-this.r)*t,this.g+=(e.g-this.g)*t,this.b+=(e.b-this.b)*t,this},lerpHSL:function(e,t){this.getHSL(Ne),e.getHSL(ot);var r=xn.lerp(Ne.h,ot.h,t),i=xn.lerp(Ne.s,ot.s,t),l=xn.lerp(Ne.l,ot.l,t);return this.setHSL(r,i,l),this},equals:function(e){return e.r===this.r&&e.g===this.g&&e.b===this.b},fromArray:function(e,t){return t===void 0&&(t=0),this.r=e[t],this.g=e[t+1],this.b=e[t+2],this},toArray:function(e,t){return e===void 0&&(e=[]),t===void 0&&(t=0),e[t]=this.r,e[t+1]=this.g,e[t+2]=this.b,e},toJSON:function(){return this.getHex()}}),Qe.NAMES=Dl,Object.assign(dr.prototype,{clone:function(){return new this.constructor().copy(this)},copy:function(e){this.a=e.a,this.b=e.b,this.c=e.c,this.normal.copy(e.normal),this.color.copy(e.color),this.materialIndex=e.materialIndex;for(var t=0,r=e.vertexNormals.length;t<r;t++)this.vertexNormals[t]=e.vertexNormals[t].clone();for(t=0,r=e.vertexColors.length;t<r;t++)this.vertexColors[t]=e.vertexColors[t].clone();return this}});var Er=0;function kt(){Object.defineProperty(this,"id",{value:Er++}),this.uuid=xn.generateUUID(),this.name="",this.type="Material",this.fog=!0,this.blending=S,this.side=E,this.flatShading=!1,this.vertexTangents=!1,this.vertexColors=U,this.opacity=1,this.transparent=!1,this.blendSrc=J,this.blendDst=te,this.blendEquation=D,this.blendSrcAlpha=null,this.blendDstAlpha=null,this.blendEquationAlpha=null,this.depthFunc=ne,this.depthTest=!0,this.depthWrite=!0,this.stencilWriteMask=255,this.stencilFunc=Gs,this.stencilRef=0,this.stencilFuncMask=255,this.stencilFail=oo,this.stencilZFail=oo,this.stencilZPass=oo,this.stencilWrite=!1,this.clippingPlanes=null,this.clipIntersection=!1,this.clipShadows=!1,this.shadowSide=null,this.colorWrite=!0,this.precision=null,this.polygonOffset=!1,this.polygonOffsetFactor=0,this.polygonOffsetUnits=0,this.dithering=!1,this.alphaTest=0,this.premultipliedAlpha=!1,this.visible=!0,this.toneMapped=!0,this.userData={},this.version=0}function Dn(e){kt.call(this),this.type="MeshBasicMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ie,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.setValues(e)}kt.prototype=Object.assign(Object.create(Ia.prototype),{constructor:kt,isMaterial:!0,onBeforeCompile:function(){},setValues:function(e){if(e!==void 0)for(var t in e){var r=e[t];if(r!==void 0)if(t!=="shading"){var i=this[t];i!==void 0?i&&i.isColor?i.set(r):i&&i.isVector3&&r&&r.isVector3?i.copy(r):this[t]=r:console.warn("THREE."+this.type+": '"+t+"' is not a property of this material.")}else console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=r===1;else console.warn("THREE.Material: '"+t+"' parameter is undefined.")}},toJSON:function(e){var t=e===void 0||typeof e=="string";t&&(e={textures:{},images:{}});var r={metadata:{version:4.5,type:"Material",generator:"Material.toJSON"}};function i(f){var w=[];for(var L in f){var V=f[L];delete V.metadata,w.push(V)}return w}if(r.uuid=this.uuid,r.type=this.type,this.name!==""&&(r.name=this.name),this.color&&this.color.isColor&&(r.color=this.color.getHex()),this.roughness!==void 0&&(r.roughness=this.roughness),this.metalness!==void 0&&(r.metalness=this.metalness),this.sheen&&this.sheen.isColor&&(r.sheen=this.sheen.getHex()),this.emissive&&this.emissive.isColor&&(r.emissive=this.emissive.getHex()),this.emissiveIntensity&&this.emissiveIntensity!==1&&(r.emissiveIntensity=this.emissiveIntensity),this.specular&&this.specular.isColor&&(r.specular=this.specular.getHex()),this.shininess!==void 0&&(r.shininess=this.shininess),this.clearcoat!==void 0&&(r.clearcoat=this.clearcoat),this.clearcoatRoughness!==void 0&&(r.clearcoatRoughness=this.clearcoatRoughness),this.clearcoatNormalMap&&this.clearcoatNormalMap.isTexture&&(r.clearcoatNormalMap=this.clearcoatNormalMap.toJSON(e).uuid,r.clearcoatNormalScale=this.clearcoatNormalScale.toArray()),this.map&&this.map.isTexture&&(r.map=this.map.toJSON(e).uuid),this.matcap&&this.matcap.isTexture&&(r.matcap=this.matcap.toJSON(e).uuid),this.alphaMap&&this.alphaMap.isTexture&&(r.alphaMap=this.alphaMap.toJSON(e).uuid),this.lightMap&&this.lightMap.isTexture&&(r.lightMap=this.lightMap.toJSON(e).uuid),this.aoMap&&this.aoMap.isTexture&&(r.aoMap=this.aoMap.toJSON(e).uuid,r.aoMapIntensity=this.aoMapIntensity),this.bumpMap&&this.bumpMap.isTexture&&(r.bumpMap=this.bumpMap.toJSON(e).uuid,r.bumpScale=this.bumpScale),this.normalMap&&this.normalMap.isTexture&&(r.normalMap=this.normalMap.toJSON(e).uuid,r.normalMapType=this.normalMapType,r.normalScale=this.normalScale.toArray()),this.displacementMap&&this.displacementMap.isTexture&&(r.displacementMap=this.displacementMap.toJSON(e).uuid,r.displacementScale=this.displacementScale,r.displacementBias=this.displacementBias),this.roughnessMap&&this.roughnessMap.isTexture&&(r.roughnessMap=this.roughnessMap.toJSON(e).uuid),this.metalnessMap&&this.metalnessMap.isTexture&&(r.metalnessMap=this.metalnessMap.toJSON(e).uuid),this.emissiveMap&&this.emissiveMap.isTexture&&(r.emissiveMap=this.emissiveMap.toJSON(e).uuid),this.specularMap&&this.specularMap.isTexture&&(r.specularMap=this.specularMap.toJSON(e).uuid),this.envMap&&this.envMap.isTexture&&(r.envMap=this.envMap.toJSON(e).uuid,r.reflectivity=this.reflectivity,r.refractionRatio=this.refractionRatio,this.combine!==void 0&&(r.combine=this.combine),this.envMapIntensity!==void 0&&(r.envMapIntensity=this.envMapIntensity)),this.gradientMap&&this.gradientMap.isTexture&&(r.gradientMap=this.gradientMap.toJSON(e).uuid),this.size!==void 0&&(r.size=this.size),this.sizeAttenuation!==void 0&&(r.sizeAttenuation=this.sizeAttenuation),this.blending!==S&&(r.blending=this.blending),this.flatShading===!0&&(r.flatShading=this.flatShading),this.side!==E&&(r.side=this.side),this.vertexColors!==U&&(r.vertexColors=this.vertexColors),this.opacity<1&&(r.opacity=this.opacity),this.transparent===!0&&(r.transparent=this.transparent),r.depthFunc=this.depthFunc,r.depthTest=this.depthTest,r.depthWrite=this.depthWrite,r.stencilWrite=this.stencilWrite,r.stencilWriteMask=this.stencilWriteMask,r.stencilFunc=this.stencilFunc,r.stencilRef=this.stencilRef,r.stencilFuncMask=this.stencilFuncMask,r.stencilFail=this.stencilFail,r.stencilZFail=this.stencilZFail,r.stencilZPass=this.stencilZPass,this.rotation&&this.rotation!==0&&(r.rotation=this.rotation),this.polygonOffset===!0&&(r.polygonOffset=!0),this.polygonOffsetFactor!==0&&(r.polygonOffsetFactor=this.polygonOffsetFactor),this.polygonOffsetUnits!==0&&(r.polygonOffsetUnits=this.polygonOffsetUnits),this.linewidth&&this.linewidth!==1&&(r.linewidth=this.linewidth),this.dashSize!==void 0&&(r.dashSize=this.dashSize),this.gapSize!==void 0&&(r.gapSize=this.gapSize),this.scale!==void 0&&(r.scale=this.scale),this.dithering===!0&&(r.dithering=!0),0<this.alphaTest&&(r.alphaTest=this.alphaTest),this.premultipliedAlpha===!0&&(r.premultipliedAlpha=this.premultipliedAlpha),this.wireframe===!0&&(r.wireframe=this.wireframe),1<this.wireframeLinewidth&&(r.wireframeLinewidth=this.wireframeLinewidth),this.wireframeLinecap!=="round"&&(r.wireframeLinecap=this.wireframeLinecap),this.wireframeLinejoin!=="round"&&(r.wireframeLinejoin=this.wireframeLinejoin),this.morphTargets===!0&&(r.morphTargets=!0),this.morphNormals===!0&&(r.morphNormals=!0),this.skinning===!0&&(r.skinning=!0),this.visible===!1&&(r.visible=!1),this.toneMapped===!1&&(r.toneMapped=!1),JSON.stringify(this.userData)!=="{}"&&(r.userData=this.userData),t){var l=i(e.textures),p=i(e.images);0<l.length&&(r.textures=l),0<p.length&&(r.images=p)}return r},clone:function(){return new this.constructor().copy(this)},copy:function(e){this.name=e.name,this.fog=e.fog,this.blending=e.blending,this.side=e.side,this.flatShading=e.flatShading,this.vertexTangents=e.vertexTangents,this.vertexColors=e.vertexColors,this.opacity=e.opacity,this.transparent=e.transparent,this.blendSrc=e.blendSrc,this.blendDst=e.blendDst,this.blendEquation=e.blendEquation,this.blendSrcAlpha=e.blendSrcAlpha,this.blendDstAlpha=e.blendDstAlpha,this.blendEquationAlpha=e.blendEquationAlpha,this.depthFunc=e.depthFunc,this.depthTest=e.depthTest,this.depthWrite=e.depthWrite,this.stencilWriteMask=e.stencilWriteMask,this.stencilFunc=e.stencilFunc,this.stencilRef=e.stencilRef,this.stencilFuncMask=e.stencilFuncMask,this.stencilFail=e.stencilFail,this.stencilZFail=e.stencilZFail,this.stencilZPass=e.stencilZPass,this.stencilWrite=e.stencilWrite;var t=e.clippingPlanes,r=null;if(t!==null){var i=t.length;r=new Array(i);for(var l=0;l!==i;++l)r[l]=t[l].clone()}return this.clippingPlanes=r,this.clipIntersection=e.clipIntersection,this.clipShadows=e.clipShadows,this.shadowSide=e.shadowSide,this.colorWrite=e.colorWrite,this.precision=e.precision,this.polygonOffset=e.polygonOffset,this.polygonOffsetFactor=e.polygonOffsetFactor,this.polygonOffsetUnits=e.polygonOffsetUnits,this.dithering=e.dithering,this.alphaTest=e.alphaTest,this.premultipliedAlpha=e.premultipliedAlpha,this.visible=e.visible,this.toneMapped=e.toneMapped,this.userData=JSON.parse(JSON.stringify(e.userData)),this},dispose:function(){this.dispatchEvent({type:"dispose"})}}),Object.defineProperty(kt.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),((Dn.prototype=Object.create(kt.prototype)).constructor=Dn).prototype.isMeshBasicMaterial=!0,Dn.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this};var wr=new Le;function Kt(e,t,r){if(Array.isArray(e))throw new TypeError("THREE.BufferAttribute: array should be a Typed Array.");this.name="",this.array=e,this.itemSize=t,this.count=e!==void 0?e.length/t:0,this.normalized=r===!0,this.usage=Jn,this.updateRange={offset:0,count:-1},this.version=0}function jn(e,t,r){Kt.call(this,new Int8Array(e),t,r)}function tn(e,t,r){Kt.call(this,new Uint8Array(e),t,r)}function ui(e,t,r){Kt.call(this,new Uint8ClampedArray(e),t,r)}function Ti(e,t,r){Kt.call(this,new Int16Array(e),t,r)}function mi(e,t,r){Kt.call(this,new Uint16Array(e),t,r)}function be(e,t,r){Kt.call(this,new Int32Array(e),t,r)}function Ci(e,t,r){Kt.call(this,new Uint32Array(e),t,r)}function tr(e,t,r){Kt.call(this,new Float32Array(e),t,r)}function En(e,t,r){Kt.call(this,new Float64Array(e),t,r)}function bn(){this.vertices=[],this.normals=[],this.colors=[],this.uvs=[],this.uvs2=[],this.groups=[],this.morphTargets={},this.skinWeights=[],this.skinIndices=[],this.boundingBox=null,this.boundingSphere=null,this.verticesNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.uvsNeedUpdate=!1,this.groupsNeedUpdate=!1}function Ki(e){if(e.length===0)return-1/0;for(var t=e[0],r=1,i=e.length;r<i;++r)e[r]>t&&(t=e[r]);return t}Object.defineProperty(Kt.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(Kt.prototype,{isBufferAttribute:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.name=e.name,this.array=new e.array.constructor(e.array),this.itemSize=e.itemSize,this.count=e.count,this.normalized=e.normalized,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.itemSize,r*=t.itemSize;for(var i=0,l=this.itemSize;i<l;i++)this.array[e+i]=t.array[r+i];return this},copyArray:function(e){return this.array.set(e),this},copyColorsArray:function(e){for(var t=this.array,r=0,i=0,l=e.length;i<l;i++){var p=e[i];p===void 0&&(console.warn("THREE.BufferAttribute.copyColorsArray(): color is undefined",i),p=new Qe),t[r++]=p.r,t[r++]=p.g,t[r++]=p.b}return this},copyVector2sArray:function(e){for(var t=this.array,r=0,i=0,l=e.length;i<l;i++){var p=e[i];p===void 0&&(console.warn("THREE.BufferAttribute.copyVector2sArray(): vector is undefined",i),p=new Gt),t[r++]=p.x,t[r++]=p.y}return this},copyVector3sArray:function(e){for(var t=this.array,r=0,i=0,l=e.length;i<l;i++){var p=e[i];p===void 0&&(console.warn("THREE.BufferAttribute.copyVector3sArray(): vector is undefined",i),p=new Le),t[r++]=p.x,t[r++]=p.y,t[r++]=p.z}return this},copyVector4sArray:function(e){for(var t=this.array,r=0,i=0,l=e.length;i<l;i++){var p=e[i];p===void 0&&(console.warn("THREE.BufferAttribute.copyVector4sArray(): vector is undefined",i),p=new qn),t[r++]=p.x,t[r++]=p.y,t[r++]=p.z,t[r++]=p.w}return this},applyMatrix3:function(e){for(var t=0,r=this.count;t<r;t++)wr.x=this.getX(t),wr.y=this.getY(t),wr.z=this.getZ(t),wr.applyMatrix3(e),this.setXYZ(t,wr.x,wr.y,wr.z);return this},applyMatrix4:function(e){for(var t=0,r=this.count;t<r;t++)wr.x=this.getX(t),wr.y=this.getY(t),wr.z=this.getZ(t),wr.applyMatrix4(e),this.setXYZ(t,wr.x,wr.y,wr.z);return this},applyNormalMatrix:function(e){for(var t=0,r=this.count;t<r;t++)wr.x=this.getX(t),wr.y=this.getY(t),wr.z=this.getZ(t),wr.applyNormalMatrix(e),this.setXYZ(t,wr.x,wr.y,wr.z);return this},transformDirection:function(e){for(var t=0,r=this.count;t<r;t++)wr.x=this.getX(t),wr.y=this.getY(t),wr.z=this.getZ(t),wr.transformDirection(e),this.setXYZ(t,wr.x,wr.y,wr.z);return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},getX:function(e){return this.array[e*this.itemSize]},setX:function(e,t){return this.array[e*this.itemSize]=t,this},getY:function(e){return this.array[e*this.itemSize+1]},setY:function(e,t){return this.array[e*this.itemSize+1]=t,this},getZ:function(e){return this.itemSize<3?0:this.array[e*this.itemSize+2]},setZ:function(e,t){return this.array[e*this.itemSize+2]=t,this},getW:function(e){return this.array[e*this.itemSize+3]},setW:function(e,t){return this.array[e*this.itemSize+3]=t,this},setXY:function(e,t,r){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this},setXYZW:function(e,t,r,i,l){return e*=this.itemSize,this.array[e+0]=t,this.array[e+1]=r,this.array[e+2]=i,this.array[e+3]=l,this},onUpload:function(e){return this.onUploadCallback=e,this},clone:function(){return new this.constructor(this.array,this.itemSize).copy(this)},toJSON:function(){return{itemSize:this.itemSize,type:this.array.constructor.name,array:Array.prototype.slice.call(this.array),normalized:this.normalized}}}),(jn.prototype=Object.create(Kt.prototype)).constructor=jn,(tn.prototype=Object.create(Kt.prototype)).constructor=tn,(ui.prototype=Object.create(Kt.prototype)).constructor=ui,(Ti.prototype=Object.create(Kt.prototype)).constructor=Ti,(mi.prototype=Object.create(Kt.prototype)).constructor=mi,(be.prototype=Object.create(Kt.prototype)).constructor=be,(Ci.prototype=Object.create(Kt.prototype)).constructor=Ci,(tr.prototype=Object.create(Kt.prototype)).constructor=tr,(En.prototype=Object.create(Kt.prototype)).constructor=En,Object.assign(bn.prototype,{computeGroups:function(e){for(var t,r=[],i=void 0,l=e.faces,p=0;p<l.length;p++){var f=l[p];f.materialIndex!==i&&(i=f.materialIndex,t!==void 0&&(t.count=3*p-t.start,r.push(t)),t={start:3*p,materialIndex:i})}t!==void 0&&(t.count=3*p-t.start,r.push(t)),this.groups=r},fromGeometry:function(e){var t,r=e.faces,i=e.vertices,l=e.faceVertexUvs,p=l[0]&&0<l[0].length,f=l[1]&&0<l[1].length,w=e.morphTargets,L=w.length;if(0<L){t=[];for(var V=0;V<L;V++)t[V]={name:w[V].name,data:[]};this.morphTargets.position=t}var Z,ee=e.morphNormals,ae=ee.length;if(0<ae){for(Z=[],V=0;V<ae;V++)Z[V]={name:ee[V].name,data:[]};this.morphTargets.normal=Z}var W=e.skinIndices,he=e.skinWeights,ge=W.length===i.length,ye=he.length===i.length;for(0<i.length&&r.length===0&&console.error("THREE.DirectGeometry: Faceless geometries are not supported."),V=0;V<r.length;V++){var Ae=r[V];this.vertices.push(i[Ae.a],i[Ae.b],i[Ae.c]);var je=Ae.vertexNormals;if(je.length===3)this.normals.push(je[0],je[1],je[2]);else{var He=Ae.normal;this.normals.push(He,He,He)}var et,Ge=Ae.vertexColors;if(Ge.length===3)this.colors.push(Ge[0],Ge[1],Ge[2]);else{var it=Ae.color;this.colors.push(it,it,it)}p===!0&&((et=l[0][V])!==void 0?this.uvs.push(et[0],et[1],et[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv ",V),this.uvs.push(new Gt,new Gt,new Gt))),f===!0&&((et=l[1][V])!==void 0?this.uvs2.push(et[0],et[1],et[2]):(console.warn("THREE.DirectGeometry.fromGeometry(): Undefined vertexUv2 ",V),this.uvs2.push(new Gt,new Gt,new Gt)));for(var qe=0;qe<L;qe++){var vt=w[qe].vertices;t[qe].data.push(vt[Ae.a],vt[Ae.b],vt[Ae.c])}for(qe=0;qe<ae;qe++){var Tt=ee[qe].vertexNormals[V];Z[qe].data.push(Tt.a,Tt.b,Tt.c)}ge&&this.skinIndices.push(W[Ae.a],W[Ae.b],W[Ae.c]),ye&&this.skinWeights.push(he[Ae.a],he[Ae.b],he[Ae.c])}return this.computeGroups(e),this.verticesNeedUpdate=e.verticesNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this}});var Wa=2147483647,Hi=new mn,bo=new At,ha=new Le,Ja=new Zi,Sl=new Zi,ji=new Le;function br(){Object.defineProperty(this,"id",{value:Wa+=2}),this.uuid=xn.generateUUID(),this.name="",this.type="BufferGeometry",this.index=null,this.attributes={},this.morphAttributes={},this.morphTargetsRelative=!1,this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.drawRange={start:0,count:1/0},this.userData={}}br.prototype=Object.assign(Object.create(Ia.prototype),{constructor:br,isBufferGeometry:!0,getIndex:function(){return this.index},setIndex:function(e){Array.isArray(e)?this.index=new(65535<Ki(e)?Ci:mi)(e,1):this.index=e},getAttribute:function(e){return this.attributes[e]},setAttribute:function(e,t){return this.attributes[e]=t,this},deleteAttribute:function(e){return delete this.attributes[e],this},addGroup:function(e,t,r){this.groups.push({start:e,count:t,materialIndex:r!==void 0?r:0})},clearGroups:function(){this.groups=[]},setDrawRange:function(e,t){this.drawRange.start=e,this.drawRange.count=t},applyMatrix4:function(e){var t=this.attributes.position;t!==void 0&&(t.applyMatrix4(e),t.needsUpdate=!0);var r=this.attributes.normal;if(r!==void 0){var i=new Ai().getNormalMatrix(e);r.applyNormalMatrix(i),r.needsUpdate=!0}var l=this.attributes.tangent;return l!==void 0&&(l.transformDirection(e),l.needsUpdate=!0),this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this},rotateX:function(e){return Hi.makeRotationX(e),this.applyMatrix4(Hi),this},rotateY:function(e){return Hi.makeRotationY(e),this.applyMatrix4(Hi),this},rotateZ:function(e){return Hi.makeRotationZ(e),this.applyMatrix4(Hi),this},translate:function(e,t,r){return Hi.makeTranslation(e,t,r),this.applyMatrix4(Hi),this},scale:function(e,t,r){return Hi.makeScale(e,t,r),this.applyMatrix4(Hi),this},lookAt:function(e){return bo.lookAt(e),bo.updateMatrix(),this.applyMatrix4(bo.matrix),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(ha).negate(),this.translate(ha.x,ha.y,ha.z),this},setFromObject:function(e){var t=e.geometry;if(e.isPoints||e.isLine){var r=new tr(3*t.vertices.length,3),i=new tr(3*t.colors.length,3);if(this.setAttribute("position",r.copyVector3sArray(t.vertices)),this.setAttribute("color",i.copyColorsArray(t.colors)),t.lineDistances&&t.lineDistances.length===t.vertices.length){var l=new tr(t.lineDistances.length,1);this.setAttribute("lineDistance",l.copyArray(t.lineDistances))}t.boundingSphere!==null&&(this.boundingSphere=t.boundingSphere.clone()),t.boundingBox!==null&&(this.boundingBox=t.boundingBox.clone())}else e.isMesh&&t&&t.isGeometry&&this.fromGeometry(t);return this},setFromPoints:function(e){for(var t=[],r=0,i=e.length;r<i;r++){var l=e[r];t.push(l.x,l.y,l.z||0)}return this.setAttribute("position",new tr(t,3)),this},updateFromObject:function(e){var t,r=e.geometry;if(e.isMesh){var i=r.__directGeometry;if(r.elementsNeedUpdate===!0&&(i=void 0,r.elementsNeedUpdate=!1),i===void 0)return this.fromGeometry(r);i.verticesNeedUpdate=r.verticesNeedUpdate,i.normalsNeedUpdate=r.normalsNeedUpdate,i.colorsNeedUpdate=r.colorsNeedUpdate,i.uvsNeedUpdate=r.uvsNeedUpdate,i.groupsNeedUpdate=r.groupsNeedUpdate,r.verticesNeedUpdate=!1,r.normalsNeedUpdate=!1,r.colorsNeedUpdate=!1,r.uvsNeedUpdate=!1,r.groupsNeedUpdate=!1,r=i}return r.verticesNeedUpdate===!0&&((t=this.attributes.position)!==void 0&&(t.copyVector3sArray(r.vertices),t.needsUpdate=!0),r.verticesNeedUpdate=!1),r.normalsNeedUpdate===!0&&((t=this.attributes.normal)!==void 0&&(t.copyVector3sArray(r.normals),t.needsUpdate=!0),r.normalsNeedUpdate=!1),r.colorsNeedUpdate===!0&&((t=this.attributes.color)!==void 0&&(t.copyColorsArray(r.colors),t.needsUpdate=!0),r.colorsNeedUpdate=!1),r.uvsNeedUpdate&&((t=this.attributes.uv)!==void 0&&(t.copyVector2sArray(r.uvs),t.needsUpdate=!0),r.uvsNeedUpdate=!1),r.lineDistancesNeedUpdate&&((t=this.attributes.lineDistance)!==void 0&&(t.copyArray(r.lineDistances),t.needsUpdate=!0),r.lineDistancesNeedUpdate=!1),r.groupsNeedUpdate&&(r.computeGroups(e.geometry),this.groups=r.groups,r.groupsNeedUpdate=!1),this},fromGeometry:function(e){return e.__directGeometry=new bn().fromGeometry(e),this.fromDirectGeometry(e.__directGeometry)},fromDirectGeometry:function(e){var t=new Float32Array(3*e.vertices.length);if(this.setAttribute("position",new Kt(t,3).copyVector3sArray(e.vertices)),0<e.normals.length){var r=new Float32Array(3*e.normals.length);this.setAttribute("normal",new Kt(r,3).copyVector3sArray(e.normals))}if(0<e.colors.length){var i=new Float32Array(3*e.colors.length);this.setAttribute("color",new Kt(i,3).copyColorsArray(e.colors))}if(0<e.uvs.length){var l=new Float32Array(2*e.uvs.length);this.setAttribute("uv",new Kt(l,2).copyVector2sArray(e.uvs))}if(0<e.uvs2.length){var p=new Float32Array(2*e.uvs2.length);this.setAttribute("uv2",new Kt(p,2).copyVector2sArray(e.uvs2))}for(var f in this.groups=e.groups,e.morphTargets){for(var w=[],L=e.morphTargets[f],V=0,Z=L.length;V<Z;V++){var ee=L[V],ae=new tr(3*ee.data.length,3);ae.name=ee.name,w.push(ae.copyVector3sArray(ee.data))}this.morphAttributes[f]=w}if(0<e.skinIndices.length){var W=new tr(4*e.skinIndices.length,4);this.setAttribute("skinIndex",W.copyVector4sArray(e.skinIndices))}if(0<e.skinWeights.length){var he=new tr(4*e.skinWeights.length,4);this.setAttribute("skinWeight",he.copyVector4sArray(e.skinWeights))}return e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),this},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Zi);var e=this.attributes.position,t=this.morphAttributes.position;if(e!==void 0){if(this.boundingBox.setFromBufferAttribute(e),t)for(var r=0,i=t.length;r<i;r++){var l=t[r];Ja.setFromBufferAttribute(l),this.morphTargetsRelative?(ji.addVectors(this.boundingBox.min,Ja.min),this.boundingBox.expandByPoint(ji),ji.addVectors(this.boundingBox.max,Ja.max),this.boundingBox.expandByPoint(ji)):(this.boundingBox.expandByPoint(Ja.min),this.boundingBox.expandByPoint(Ja.max))}}else this.boundingBox.makeEmpty();(isNaN(this.boundingBox.min.x)||isNaN(this.boundingBox.min.y)||isNaN(this.boundingBox.min.z))&&console.error('THREE.BufferGeometry.computeBoundingBox: Computed min/max have NaN values. The "position" attribute is likely to have NaN values.',this)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Kn);var e=this.attributes.position,t=this.morphAttributes.position;if(e){var r=this.boundingSphere.center;if(Ja.setFromBufferAttribute(e),t)for(var i=0,l=t.length;i<l;i++){var p=t[i];Sl.setFromBufferAttribute(p),this.morphTargetsRelative?(ji.addVectors(Ja.min,Sl.min),Ja.expandByPoint(ji),ji.addVectors(Ja.max,Sl.max),Ja.expandByPoint(ji)):(Ja.expandByPoint(Sl.min),Ja.expandByPoint(Sl.max))}Ja.getCenter(r);var f=0;for(i=0,l=e.count;i<l;i++)ji.fromBufferAttribute(e,i),f=Math.max(f,r.distanceToSquared(ji));if(t)for(i=0,l=t.length;i<l;i++){p=t[i];for(var w=this.morphTargetsRelative,L=0,V=p.count;L<V;L++)ji.fromBufferAttribute(p,L),w&&(ha.fromBufferAttribute(e,L),ji.add(ha)),f=Math.max(f,r.distanceToSquared(ji))}this.boundingSphere.radius=Math.sqrt(f),isNaN(this.boundingSphere.radius)&&console.error('THREE.BufferGeometry.computeBoundingSphere(): Computed radius is NaN. The "position" attribute is likely to have NaN values.',this)}},computeFaceNormals:function(){},computeVertexNormals:function(){var e=this.index,t=this.attributes;if(t.position){var r=t.position.array;if(t.normal===void 0)this.setAttribute("normal",new Kt(new Float32Array(r.length),3));else for(var i=t.normal.array,l=0,p=i.length;l<p;l++)i[l]=0;var f,w,L,V=t.normal.array,Z=new Le,ee=new Le,ae=new Le,W=new Le,he=new Le;if(e){var ge=e.array;for(l=0,p=e.count;l<p;l+=3)f=3*ge[l+0],w=3*ge[l+1],L=3*ge[l+2],Z.fromArray(r,f),ee.fromArray(r,w),ae.fromArray(r,L),W.subVectors(ae,ee),he.subVectors(Z,ee),W.cross(he),V[f]+=W.x,V[1+f]+=W.y,V[2+f]+=W.z,V[w]+=W.x,V[1+w]+=W.y,V[2+w]+=W.z,V[L]+=W.x,V[1+L]+=W.y,V[2+L]+=W.z}else for(l=0,p=r.length;l<p;l+=9)Z.fromArray(r,l),ee.fromArray(r,l+3),ae.fromArray(r,l+6),W.subVectors(ae,ee),he.subVectors(Z,ee),W.cross(he),V[l]=W.x,V[l+1]=W.y,V[l+2]=W.z,V[l+3]=W.x,V[l+4]=W.y,V[l+5]=W.z,V[l+6]=W.x,V[l+7]=W.y,V[l+8]=W.z;this.normalizeNormals(),t.normal.needsUpdate=!0}},merge:function(e,t){if(e&&e.isBufferGeometry){t===void 0&&(t=0,console.warn("THREE.BufferGeometry.merge(): Overwriting original geometry, starting at offset=0. Use BufferGeometryUtils.mergeBufferGeometries() for lossless merge."));var r=this.attributes;for(var i in r)if(e.attributes[i]!==void 0)for(var l=r[i].array,p=e.attributes[i],f=p.array,w=p.itemSize*t,L=Math.min(f.length,l.length-w),V=0,Z=w;V<L;V++,Z++)l[Z]=f[V];return this}console.error("THREE.BufferGeometry.merge(): geometry not an instance of THREE.BufferGeometry.",e)},normalizeNormals:function(){for(var e=this.attributes.normal,t=0,r=e.count;t<r;t++)ji.x=e.getX(t),ji.y=e.getY(t),ji.z=e.getZ(t),ji.normalize(),e.setXYZ(t,ji.x,ji.y,ji.z)},toNonIndexed:function(){function e(he,ge){for(var ye=he.array,Ae=he.itemSize,je=new ye.constructor(ge.length*Ae),He=0,et=0,Ge=0,it=ge.length;Ge<it;Ge++){He=ge[Ge]*Ae;for(var qe=0;qe<Ae;qe++)je[et++]=ye[He++]}return new Kt(je,Ae)}if(this.index===null)return console.warn("THREE.BufferGeometry.toNonIndexed(): Geometry is already non-indexed."),this;var t=new br,r=this.index.array,i=this.attributes;for(var l in i){var p=e(i[l],r);t.setAttribute(l,p)}var f=this.morphAttributes;for(l in f){for(var w=[],L=f[l],V=0,Z=L.length;V<Z;V++)p=e(L[V],r),w.push(p);t.morphAttributes[l]=w}t.morphTargetsRelative=this.morphTargetsRelative;for(var ee=this.groups,ae=(V=0,ee.length);V<ae;V++){var W=ee[V];t.addGroup(W.start,W.count,W.materialIndex)}return t},toJSON:function(){var e={metadata:{version:4.5,type:"BufferGeometry",generator:"BufferGeometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),0<Object.keys(this.userData).length&&(e.userData=this.userData),this.parameters!==void 0){var t=this.parameters;for(var r in t)t[r]!==void 0&&(e[r]=t[r]);return e}e.data={attributes:{}};var i=this.index;i!==null&&(e.data.index={type:i.array.constructor.name,array:Array.prototype.slice.call(i.array)});var l=this.attributes;for(var r in l){var p=(ae=l[r]).toJSON();ae.name!==""&&(p.name=ae.name),e.data.attributes[r]=p}var f={},w=!1;for(var r in this.morphAttributes){for(var L=this.morphAttributes[r],V=[],Z=0,ee=L.length;Z<ee;Z++){var ae;p=(ae=L[Z]).toJSON(),ae.name!==""&&(p.name=ae.name),V.push(p)}0<V.length&&(f[r]=V,w=!0)}w&&(e.data.morphAttributes=f,e.data.morphTargetsRelative=this.morphTargetsRelative);var W=this.groups;0<W.length&&(e.data.groups=JSON.parse(JSON.stringify(W)));var he=this.boundingSphere;return he!==null&&(e.data.boundingSphere={center:he.center.toArray(),radius:he.radius}),e},clone:function(){return new br().copy(this)},copy:function(e){var t,r,i;this.index=null,this.attributes={},this.morphAttributes={},this.groups=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var l=e.index;l!==null&&this.setIndex(l.clone());var p=e.attributes;for(t in p){var f=p[t];this.setAttribute(t,f.clone())}var w=e.morphAttributes;for(t in w){var L=[],V=w[t];for(r=0,i=V.length;r<i;r++)L.push(V[r].clone());this.morphAttributes[t]=L}this.morphTargetsRelative=e.morphTargetsRelative;var Z=e.groups;for(r=0,i=Z.length;r<i;r++){var ee=Z[r];this.addGroup(ee.start,ee.count,ee.materialIndex)}var ae=e.boundingBox;ae!==null&&(this.boundingBox=ae.clone());var W=e.boundingSphere;return W!==null&&(this.boundingSphere=W.clone()),this.drawRange.start=e.drawRange.start,this.drawRange.count=e.drawRange.count,this.userData=e.userData,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var ou=new mn,Js=new kn,cc=new Kn,ka=new Le,as=new Le,uo=new Le,qa=new Le,hc=new Le,pc=new Le,Cs=new Le,Po=new Le,su=new Le,El=new Gt,os=new Gt,qs=new Gt,Wi=new Le,Ol=new Le;function Di(e,t){At.call(this),this.type="Mesh",this.geometry=e!==void 0?e:new br,this.material=t!==void 0?t:new Dn,this.updateMorphTargets()}function Ro(e,t,r,i,l,p,f,w){if((t.side===_?i.intersectTriangle(f,p,l,!0,w):i.intersectTriangle(l,p,f,t.side!==k,w))===null)return null;Ol.copy(w),Ol.applyMatrix4(e.matrixWorld);var L=r.ray.origin.distanceTo(Ol);return L<r.near||L>r.far?null:{distance:L,point:Ol.clone(),object:e}}function Al(e,t,r,i,l,p,f,w,L,V,Z,ee){ka.fromBufferAttribute(l,V),as.fromBufferAttribute(l,Z),uo.fromBufferAttribute(l,ee);var ae=e.morphTargetInfluences;if(t.morphTargets&&p&&ae){Cs.set(0,0,0),Po.set(0,0,0),su.set(0,0,0);for(var W=0,he=p.length;W<he;W++){var ge=ae[W],ye=p[W];ge!==0&&(qa.fromBufferAttribute(ye,V),hc.fromBufferAttribute(ye,Z),pc.fromBufferAttribute(ye,ee),f?(Cs.addScaledVector(qa,ge),Po.addScaledVector(hc,ge),su.addScaledVector(pc,ge)):(Cs.addScaledVector(qa.sub(ka),ge),Po.addScaledVector(hc.sub(as),ge),su.addScaledVector(pc.sub(uo),ge)))}ka.add(Cs),as.add(Po),uo.add(su)}var Ae=Ro(e,t,r,i,ka,as,uo,Wi);if(Ae){w&&(El.fromBufferAttribute(w,V),os.fromBufferAttribute(w,Z),qs.fromBufferAttribute(w,ee),Ae.uv=ki.getUV(Wi,ka,as,uo,El,os,qs,new Gt)),L&&(El.fromBufferAttribute(L,V),os.fromBufferAttribute(L,Z),qs.fromBufferAttribute(L,ee),Ae.uv2=ki.getUV(Wi,ka,as,uo,El,os,qs,new Gt));var je=new dr(V,Z,ee);ki.getNormal(ka,as,uo,je.normal),Ae.face=je}return Ae}Di.prototype=Object.assign(Object.create(At.prototype),{constructor:Di,isMesh:!0,copy:function(e){return At.prototype.copy.call(this,e),e.morphTargetInfluences!==void 0&&(this.morphTargetInfluences=e.morphTargetInfluences.slice()),e.morphTargetDictionary!==void 0&&(this.morphTargetDictionary=Object.assign({},e.morphTargetDictionary)),this},updateMorphTargets:function(){var e,t,r,i=this.geometry;if(i.isBufferGeometry){var l=i.morphAttributes,p=Object.keys(l);if(0<p.length){var f=l[p[0]];if(f!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=f.length;e<t;e++)r=f[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var w=i.morphTargets;w!==void 0&&0<w.length&&console.error("THREE.Mesh.updateMorphTargets() no longer supports THREE.Geometry. Use THREE.BufferGeometry instead.")}},raycast:function(e,t){var r,i=this.geometry,l=this.material,p=this.matrixWorld;if(l!==void 0&&(i.boundingSphere===null&&i.computeBoundingSphere(),cc.copy(i.boundingSphere),cc.applyMatrix4(p),e.ray.intersectsSphere(cc)!==!1&&(ou.getInverse(p),Js.copy(e.ray).applyMatrix4(ou),i.boundingBox===null||Js.intersectsBox(i.boundingBox)!==!1))){if(i.isBufferGeometry){var f,w,L,V,Z,ee,ae,W,he,ge=i.index,ye=i.attributes.position,Ae=i.morphAttributes.position,je=i.morphTargetsRelative,He=i.attributes.uv,et=i.attributes.uv2,Ge=i.groups,it=i.drawRange;if(ge!==null)if(Array.isArray(l))for(V=0,ee=Ge.length;V<ee;V++)for(he=l[(W=Ge[V]).materialIndex],Z=Math.max(W.start,it.start),ae=Math.min(W.start+W.count,it.start+it.count);Z<ae;Z+=3)f=ge.getX(Z),w=ge.getX(Z+1),L=ge.getX(Z+2),(r=Al(this,he,e,Js,ye,Ae,je,He,et,f,w,L))&&(r.faceIndex=Math.floor(Z/3),r.face.materialIndex=W.materialIndex,t.push(r));else for(V=Math.max(0,it.start),ee=Math.min(ge.count,it.start+it.count);V<ee;V+=3)f=ge.getX(V),w=ge.getX(V+1),L=ge.getX(V+2),(r=Al(this,l,e,Js,ye,Ae,je,He,et,f,w,L))&&(r.faceIndex=Math.floor(V/3),t.push(r));else if(ye!==void 0)if(Array.isArray(l))for(V=0,ee=Ge.length;V<ee;V++)for(he=l[(W=Ge[V]).materialIndex],Z=Math.max(W.start,it.start),ae=Math.min(W.start+W.count,it.start+it.count);Z<ae;Z+=3)(r=Al(this,he,e,Js,ye,Ae,je,He,et,f=Z,w=Z+1,L=Z+2))&&(r.faceIndex=Math.floor(Z/3),r.face.materialIndex=W.materialIndex,t.push(r));else for(V=Math.max(0,it.start),ee=Math.min(ye.count,it.start+it.count);V<ee;V+=3)(r=Al(this,l,e,Js,ye,Ae,je,He,et,f=V,w=V+1,L=V+2))&&(r.faceIndex=Math.floor(V/3),t.push(r))}else if(i.isGeometry){var qe,vt,Tt,Et,Ot=Array.isArray(l),Bt=i.vertices,Xt=i.faces,Dt=i.faceVertexUvs[0];0<Dt.length&&(Et=Dt);for(var Mt=0,lr=Xt.length;Mt<lr;Mt++){var yr=Xt[Mt],$r=Ot?l[yr.materialIndex]:l;if($r!==void 0&&(qe=Bt[yr.a],vt=Bt[yr.b],Tt=Bt[yr.c],r=Ro(this,$r,e,Js,qe,vt,Tt,Wi))){if(Et&&Et[Mt]){var Xr=Et[Mt];El.copy(Xr[0]),os.copy(Xr[1]),qs.copy(Xr[2]),r.uv=ki.getUV(Wi,qe,vt,Tt,El,os,qs,new Gt)}r.face=yr,r.faceIndex=Mt,t.push(r)}}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var dc=0,Aa=new mn,fc=new At,pa=new Le;function un(){Object.defineProperty(this,"id",{value:dc+=2}),this.uuid=xn.generateUUID(),this.name="",this.type="Geometry",this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.elementsNeedUpdate=!1,this.verticesNeedUpdate=!1,this.uvsNeedUpdate=!1,this.normalsNeedUpdate=!1,this.colorsNeedUpdate=!1,this.lineDistancesNeedUpdate=!1,this.groupsNeedUpdate=!1}un.prototype=Object.assign(Object.create(Ia.prototype),{constructor:un,isGeometry:!0,applyMatrix4:function(e){for(var t=new Ai().getNormalMatrix(e),r=0,i=this.vertices.length;r<i;r++)this.vertices[r].applyMatrix4(e);for(r=0,i=this.faces.length;r<i;r++){var l=this.faces[r];l.normal.applyMatrix3(t).normalize();for(var p=0,f=l.vertexNormals.length;p<f;p++)l.vertexNormals[p].applyMatrix3(t).normalize()}return this.boundingBox!==null&&this.computeBoundingBox(),this.boundingSphere!==null&&this.computeBoundingSphere(),this.verticesNeedUpdate=!0,this.normalsNeedUpdate=!0,this},rotateX:function(e){return Aa.makeRotationX(e),this.applyMatrix4(Aa),this},rotateY:function(e){return Aa.makeRotationY(e),this.applyMatrix4(Aa),this},rotateZ:function(e){return Aa.makeRotationZ(e),this.applyMatrix4(Aa),this},translate:function(e,t,r){return Aa.makeTranslation(e,t,r),this.applyMatrix4(Aa),this},scale:function(e,t,r){return Aa.makeScale(e,t,r),this.applyMatrix4(Aa),this},lookAt:function(e){return fc.lookAt(e),fc.updateMatrix(),this.applyMatrix4(fc.matrix),this},fromBufferGeometry:function(e){var t=this,r=e.index!==null?e.index.array:void 0,i=e.attributes;if(i.position===void 0)return console.error("THREE.Geometry.fromBufferGeometry(): Position attribute required for conversion."),this;var l=i.position.array,p=i.normal!==void 0?i.normal.array:void 0,f=i.color!==void 0?i.color.array:void 0,w=i.uv!==void 0?i.uv.array:void 0,L=i.uv2!==void 0?i.uv2.array:void 0;L!==void 0&&(this.faceVertexUvs[1]=[]);for(var V=0;V<l.length;V+=3)t.vertices.push(new Le().fromArray(l,V)),f!==void 0&&t.colors.push(new Qe().fromArray(f,V));function Z(ye,Ae,je,He){var et=f===void 0?[]:[t.colors[ye].clone(),t.colors[Ae].clone(),t.colors[je].clone()],Ge=new dr(ye,Ae,je,p===void 0?[]:[new Le().fromArray(p,3*ye),new Le().fromArray(p,3*Ae),new Le().fromArray(p,3*je)],et,He);t.faces.push(Ge),w!==void 0&&t.faceVertexUvs[0].push([new Gt().fromArray(w,2*ye),new Gt().fromArray(w,2*Ae),new Gt().fromArray(w,2*je)]),L!==void 0&&t.faceVertexUvs[1].push([new Gt().fromArray(L,2*ye),new Gt().fromArray(L,2*Ae),new Gt().fromArray(L,2*je)])}var ee=e.groups;if(0<ee.length)for(V=0;V<ee.length;V++)for(var ae=ee[V],W=ae.start,he=W,ge=W+ae.count;he<ge;he+=3)r!==void 0?Z(r[he],r[he+1],r[he+2],ae.materialIndex):Z(he,he+1,he+2,ae.materialIndex);else if(r!==void 0)for(V=0;V<r.length;V+=3)Z(r[V],r[V+1],r[V+2]);else for(V=0;V<l.length/3;V+=3)Z(V,V+1,V+2);return this.computeFaceNormals(),e.boundingBox!==null&&(this.boundingBox=e.boundingBox.clone()),e.boundingSphere!==null&&(this.boundingSphere=e.boundingSphere.clone()),this},center:function(){return this.computeBoundingBox(),this.boundingBox.getCenter(pa).negate(),this.translate(pa.x,pa.y,pa.z),this},normalize:function(){this.computeBoundingSphere();var e=this.boundingSphere.center,t=this.boundingSphere.radius,r=t===0?1:1/t,i=new mn;return i.set(r,0,0,-r*e.x,0,r,0,-r*e.y,0,0,r,-r*e.z,0,0,0,1),this.applyMatrix4(i),this},computeFaceNormals:function(){for(var e=new Le,t=new Le,r=0,i=this.faces.length;r<i;r++){var l=this.faces[r],p=this.vertices[l.a],f=this.vertices[l.b],w=this.vertices[l.c];e.subVectors(w,f),t.subVectors(p,f),e.cross(t),e.normalize(),l.normal.copy(e)}},computeVertexNormals:function(e){var t,r,i,l,p,f;for(e===void 0&&(e=!0),f=new Array(this.vertices.length),t=0,r=this.vertices.length;t<r;t++)f[t]=new Le;if(e){var w,L,V,Z=new Le,ee=new Le;for(i=0,l=this.faces.length;i<l;i++)p=this.faces[i],w=this.vertices[p.a],L=this.vertices[p.b],V=this.vertices[p.c],Z.subVectors(V,L),ee.subVectors(w,L),Z.cross(ee),f[p.a].add(Z),f[p.b].add(Z),f[p.c].add(Z)}else for(this.computeFaceNormals(),i=0,l=this.faces.length;i<l;i++)f[(p=this.faces[i]).a].add(p.normal),f[p.b].add(p.normal),f[p.c].add(p.normal);for(t=0,r=this.vertices.length;t<r;t++)f[t].normalize();for(i=0,l=this.faces.length;i<l;i++){var ae=(p=this.faces[i]).vertexNormals;ae.length===3?(ae[0].copy(f[p.a]),ae[1].copy(f[p.b]),ae[2].copy(f[p.c])):(ae[0]=f[p.a].clone(),ae[1]=f[p.b].clone(),ae[2]=f[p.c].clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeFlatVertexNormals:function(){var e,t,r;for(this.computeFaceNormals(),e=0,t=this.faces.length;e<t;e++){var i=(r=this.faces[e]).vertexNormals;i.length===3?(i[0].copy(r.normal),i[1].copy(r.normal),i[2].copy(r.normal)):(i[0]=r.normal.clone(),i[1]=r.normal.clone(),i[2]=r.normal.clone())}0<this.faces.length&&(this.normalsNeedUpdate=!0)},computeMorphNormals:function(){var e,t,r,i,l;for(r=0,i=this.faces.length;r<i;r++)for((l=this.faces[r]).__originalFaceNormal?l.__originalFaceNormal.copy(l.normal):l.__originalFaceNormal=l.normal.clone(),l.__originalVertexNormals||(l.__originalVertexNormals=[]),e=0,t=l.vertexNormals.length;e<t;e++)l.__originalVertexNormals[e]?l.__originalVertexNormals[e].copy(l.vertexNormals[e]):l.__originalVertexNormals[e]=l.vertexNormals[e].clone();var p=new un;for(p.faces=this.faces,e=0,t=this.morphTargets.length;e<t;e++){if(!this.morphNormals[e]){this.morphNormals[e]={},this.morphNormals[e].faceNormals=[],this.morphNormals[e].vertexNormals=[];var f=this.morphNormals[e].faceNormals,w=this.morphNormals[e].vertexNormals;for(r=0,i=this.faces.length;r<i;r++)L=new Le,V={a:new Le,b:new Le,c:new Le},f.push(L),w.push(V)}var L,V,Z=this.morphNormals[e];for(p.vertices=this.morphTargets[e].vertices,p.computeFaceNormals(),p.computeVertexNormals(),r=0,i=this.faces.length;r<i;r++)l=this.faces[r],L=Z.faceNormals[r],V=Z.vertexNormals[r],L.copy(l.normal),V.a.copy(l.vertexNormals[0]),V.b.copy(l.vertexNormals[1]),V.c.copy(l.vertexNormals[2])}for(r=0,i=this.faces.length;r<i;r++)(l=this.faces[r]).normal=l.__originalFaceNormal,l.vertexNormals=l.__originalVertexNormals},computeBoundingBox:function(){this.boundingBox===null&&(this.boundingBox=new Zi),this.boundingBox.setFromPoints(this.vertices)},computeBoundingSphere:function(){this.boundingSphere===null&&(this.boundingSphere=new Kn),this.boundingSphere.setFromPoints(this.vertices)},merge:function(e,t,r){if(e&&e.isGeometry){var i,l=this.vertices.length,p=this.vertices,f=e.vertices,w=this.faces,L=e.faces,V=this.colors,Z=e.colors;r===void 0&&(r=0),t!==void 0&&(i=new Ai().getNormalMatrix(t));for(var ee=0,ae=f.length;ee<ae;ee++){var W=f[ee].clone();t!==void 0&&W.applyMatrix4(t),p.push(W)}for(ee=0,ae=Z.length;ee<ae;ee++)V.push(Z[ee].clone());for(ee=0,ae=L.length;ee<ae;ee++){var he,ge,ye,Ae=L[ee],je=Ae.vertexNormals,He=Ae.vertexColors;(he=new dr(Ae.a+l,Ae.b+l,Ae.c+l)).normal.copy(Ae.normal),i!==void 0&&he.normal.applyMatrix3(i).normalize();for(var et=0,Ge=je.length;et<Ge;et++)ge=je[et].clone(),i!==void 0&&ge.applyMatrix3(i).normalize(),he.vertexNormals.push(ge);for(he.color.copy(Ae.color),et=0,Ge=He.length;et<Ge;et++)ye=He[et],he.vertexColors.push(ye.clone());he.materialIndex=Ae.materialIndex+r,w.push(he)}for(ee=0,ae=e.faceVertexUvs.length;ee<ae;ee++){var it=e.faceVertexUvs[ee];for(this.faceVertexUvs[ee]===void 0&&(this.faceVertexUvs[ee]=[]),et=0,Ge=it.length;et<Ge;et++){for(var qe=it[et],vt=[],Tt=0,Et=qe.length;Tt<Et;Tt++)vt.push(qe[Tt].clone());this.faceVertexUvs[ee].push(vt)}}}else console.error("THREE.Geometry.merge(): geometry not an instance of THREE.Geometry.",e)},mergeMesh:function(e){e&&e.isMesh?(e.matrixAutoUpdate&&e.updateMatrix(),this.merge(e.geometry,e.matrix)):console.error("THREE.Geometry.mergeMesh(): mesh not an instance of THREE.Mesh.",e)},mergeVertices:function(){var e,t,r,i,l,p,f,w,L={},V=[],Z=[],ee=Math.pow(10,4);for(r=0,i=this.vertices.length;r<i;r++)e=this.vertices[r],L[t=Math.round(e.x*ee)+"_"+Math.round(e.y*ee)+"_"+Math.round(e.z*ee)]===void 0?(L[t]=r,V.push(this.vertices[r]),Z[r]=V.length-1):Z[r]=Z[L[t]];var ae=[];for(r=0,i=this.faces.length;r<i;r++){(l=this.faces[r]).a=Z[l.a],l.b=Z[l.b],l.c=Z[l.c],p=[l.a,l.b,l.c];for(var W=0;W<3;W++)if(p[W]===p[(W+1)%3]){ae.push(r);break}}for(r=ae.length-1;0<=r;r--){var he=ae[r];for(this.faces.splice(he,1),f=0,w=this.faceVertexUvs.length;f<w;f++)this.faceVertexUvs[f].splice(he,1)}var ge=this.vertices.length-V.length;return this.vertices=V,ge},setFromPoints:function(e){this.vertices=[];for(var t=0,r=e.length;t<r;t++){var i=e[t];this.vertices.push(new Le(i.x,i.y,i.z||0))}return this},sortFacesByMaterialIndex:function(){for(var e=this.faces,t=e.length,r=0;r<t;r++)e[r]._id=r;e.sort(function(L,V){return L.materialIndex-V.materialIndex});var i,l,p=this.faceVertexUvs[0],f=this.faceVertexUvs[1];for(p&&p.length===t&&(i=[]),f&&f.length===t&&(l=[]),r=0;r<t;r++){var w=e[r]._id;i&&i.push(p[w]),l&&l.push(f[w])}i&&(this.faceVertexUvs[0]=i),l&&(this.faceVertexUvs[1]=l)},toJSON:function(){var e={metadata:{version:4.5,type:"Geometry",generator:"Geometry.toJSON"}};if(e.uuid=this.uuid,e.type=this.type,this.name!==""&&(e.name=this.name),this.parameters!==void 0){var t=this.parameters;for(var r in t)t[r]!==void 0&&(e[r]=t[r]);return e}for(var i=[],l=0;l<this.vertices.length;l++){var p=this.vertices[l];i.push(p.x,p.y,p.z)}var f=[],w=[],L={},V=[],Z={},ee=[],ae={};for(l=0;l<this.faces.length;l++){var W=this.faces[l],he=this.faceVertexUvs[0][l]!==void 0,ge=0<W.normal.length(),ye=0<W.vertexNormals.length,Ae=W.color.r!==1||W.color.g!==1||W.color.b!==1,je=0<W.vertexColors.length,He=0;if(He=qe(He=qe(He=qe(He=qe(He=qe(He=qe(He=qe(He=qe(He,0,0),1,!0),2,!1),3,he),4,ge),5,ye),6,Ae),7,je),f.push(He),f.push(W.a,W.b,W.c),f.push(W.materialIndex),he){var et=this.faceVertexUvs[0][l];f.push(Et(et[0]),Et(et[1]),Et(et[2]))}if(ge&&f.push(vt(W.normal)),ye){var Ge=W.vertexNormals;f.push(vt(Ge[0]),vt(Ge[1]),vt(Ge[2]))}if(Ae&&f.push(Tt(W.color)),je){var it=W.vertexColors;f.push(Tt(it[0]),Tt(it[1]),Tt(it[2]))}}function qe(Ot,Bt,Xt){return Xt?Ot|1<<Bt:Ot&~(1<<Bt)}function vt(Ot){var Bt=Ot.x.toString()+Ot.y.toString()+Ot.z.toString();return L[Bt]!==void 0||(L[Bt]=w.length/3,w.push(Ot.x,Ot.y,Ot.z)),L[Bt]}function Tt(Ot){var Bt=Ot.r.toString()+Ot.g.toString()+Ot.b.toString();return Z[Bt]!==void 0||(Z[Bt]=V.length,V.push(Ot.getHex())),Z[Bt]}function Et(Ot){var Bt=Ot.x.toString()+Ot.y.toString();return ae[Bt]!==void 0||(ae[Bt]=ee.length/2,ee.push(Ot.x,Ot.y)),ae[Bt]}return e.data={},e.data.vertices=i,e.data.normals=w,0<V.length&&(e.data.colors=V),0<ee.length&&(e.data.uvs=[ee]),e.data.faces=f,e},clone:function(){return new un().copy(this)},copy:function(e){var t,r,i,l,p,f;this.vertices=[],this.colors=[],this.faces=[],this.faceVertexUvs=[[]],this.morphTargets=[],this.morphNormals=[],this.skinWeights=[],this.skinIndices=[],this.lineDistances=[],this.boundingBox=null,this.boundingSphere=null,this.name=e.name;var w=e.vertices;for(t=0,r=w.length;t<r;t++)this.vertices.push(w[t].clone());var L=e.colors;for(t=0,r=L.length;t<r;t++)this.colors.push(L[t].clone());var V=e.faces;for(t=0,r=V.length;t<r;t++)this.faces.push(V[t].clone());for(t=0,r=e.faceVertexUvs.length;t<r;t++){var Z=e.faceVertexUvs[t];for(this.faceVertexUvs[t]===void 0&&(this.faceVertexUvs[t]=[]),i=0,l=Z.length;i<l;i++){var ee=Z[i],ae=[];for(p=0,f=ee.length;p<f;p++){var W=ee[p];ae.push(W.clone())}this.faceVertexUvs[t].push(ae)}}var he=e.morphTargets;for(t=0,r=he.length;t<r;t++){var ge={};if(ge.name=he[t].name,he[t].vertices!==void 0)for(ge.vertices=[],i=0,l=he[t].vertices.length;i<l;i++)ge.vertices.push(he[t].vertices[i].clone());if(he[t].normals!==void 0)for(ge.normals=[],i=0,l=he[t].normals.length;i<l;i++)ge.normals.push(he[t].normals[i].clone());this.morphTargets.push(ge)}var ye=e.morphNormals;for(t=0,r=ye.length;t<r;t++){var Ae={};if(ye[t].vertexNormals!==void 0)for(Ae.vertexNormals=[],i=0,l=ye[t].vertexNormals.length;i<l;i++){var je=ye[t].vertexNormals[i],He={};He.a=je.a.clone(),He.b=je.b.clone(),He.c=je.c.clone(),Ae.vertexNormals.push(He)}if(ye[t].faceNormals!==void 0)for(Ae.faceNormals=[],i=0,l=ye[t].faceNormals.length;i<l;i++)Ae.faceNormals.push(ye[t].faceNormals[i].clone());this.morphNormals.push(Ae)}var et=e.skinWeights;for(t=0,r=et.length;t<r;t++)this.skinWeights.push(et[t].clone());var Ge=e.skinIndices;for(t=0,r=Ge.length;t<r;t++)this.skinIndices.push(Ge[t].clone());var it=e.lineDistances;for(t=0,r=it.length;t<r;t++)this.lineDistances.push(it[t]);var qe=e.boundingBox;qe!==null&&(this.boundingBox=qe.clone());var vt=e.boundingSphere;return vt!==null&&(this.boundingSphere=vt.clone()),this.elementsNeedUpdate=e.elementsNeedUpdate,this.verticesNeedUpdate=e.verticesNeedUpdate,this.uvsNeedUpdate=e.uvsNeedUpdate,this.normalsNeedUpdate=e.normalsNeedUpdate,this.colorsNeedUpdate=e.colorsNeedUpdate,this.lineDistancesNeedUpdate=e.lineDistancesNeedUpdate,this.groupsNeedUpdate=e.groupsNeedUpdate,this},dispose:function(){this.dispatchEvent({type:"dispose"})}});var oh=function(e){function t(r,i,l,p,f,w){e.call(this),this.type="BoxGeometry",this.parameters={width:r,height:i,depth:l,widthSegments:p,heightSegments:f,depthSegments:w},this.fromBufferGeometry(new lu(r,i,l,p,f,w)),this.mergeVertices()}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(un),lu=function(e){function t(r,i,l,p,f,w){e.call(this),this.type="BoxBufferGeometry",this.parameters={width:r,height:i,depth:l,widthSegments:p,heightSegments:f,depthSegments:w};var L=this;r=r||1,i=i||1,l=l||1,p=Math.floor(p)||1,f=Math.floor(f)||1;var V=[],Z=[],ee=[],ae=[],W=0,he=0;function ge(ye,Ae,je,He,et,Ge,it,qe,vt,Tt,Et){var Ot,Bt,Xt=Ge/vt,Dt=it/Tt,Mt=Ge/2,lr=it/2,yr=qe/2,$r=vt+1,Xr=Tt+1,Vr=0,hn=0,Mr=new Le;for(Bt=0;Bt<Xr;Bt++){var Ve=Bt*Dt-lr;for(Ot=0;Ot<$r;Ot++){var tt=Ot*Xt-Mt;Mr[ye]=tt*He,Mr[Ae]=Ve*et,Mr[je]=yr,Z.push(Mr.x,Mr.y,Mr.z),Mr[ye]=0,Mr[Ae]=0,Mr[je]=0<qe?1:-1,ee.push(Mr.x,Mr.y,Mr.z),ae.push(Ot/vt),ae.push(1-Bt/Tt),Vr+=1}}for(Bt=0;Bt<Tt;Bt++)for(Ot=0;Ot<vt;Ot++){var Jt=W+Ot+$r*Bt,Ut=W+Ot+$r*(Bt+1),nn=W+(Ot+1)+$r*(Bt+1),_r=W+(Ot+1)+$r*Bt;V.push(Jt,Ut,_r),V.push(Ut,nn,_r),hn+=6}L.addGroup(he,hn,Et),he+=hn,W+=Vr}ge("z","y","x",-1,-1,l,i,r,w=Math.floor(w)||1,f,0),ge("z","y","x",1,-1,l,i,-r,w,f,1),ge("x","z","y",1,1,r,l,i,p,w,2),ge("x","z","y",1,-1,r,l,-i,p,w,3),ge("x","y","z",1,-1,r,i,l,p,f,4),ge("x","y","z",-1,-1,r,i,-l,p,f,5),this.setIndex(V),this.setAttribute("position",new tr(Z,3)),this.setAttribute("normal",new tr(ee,3)),this.setAttribute("uv",new tr(ae,2))}return e&&(t.__proto__=e),(t.prototype=Object.create(e&&e.prototype)).constructor=t}(br);function Ds(e){var t={};for(var r in e)for(var i in t[r]={},e[r]){var l=e[r][i];l&&(l.isColor||l.isMatrix3||l.isMatrix4||l.isVector2||l.isVector3||l.isVector4||l.isTexture)?t[r][i]=l.clone():Array.isArray(l)?t[r][i]=l.slice():t[r][i]=l}return t}function $i(e){for(var t={},r=0;r<e.length;r++){var i=Ds(e[r]);for(var l in i)t[l]=i[l]}return t}var sh={clone:Ds,merge:$i},uu=`void main() {
	gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
}`,lh=`void main() {
	gl_FragColor = vec4( 1.0, 0.0, 0.0, 1.0 );
}`;function Xa(e){kt.call(this),this.type="ShaderMaterial",this.defines={},this.uniforms={},this.vertexShader=uu,this.fragmentShader=lh,this.linewidth=1,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.lights=!1,this.clipping=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.extensions={derivatives:!1,fragDepth:!1,drawBuffers:!1,shaderTextureLOD:!1},this.defaultAttributeValues={color:[1,1,1],uv:[0,0],uv2:[0,0]},this.index0AttributeName=void 0,this.uniformsNeedUpdate=!1,e!==void 0&&(e.attributes!==void 0&&console.error("THREE.ShaderMaterial: attributes should now be defined in THREE.BufferGeometry instead."),this.setValues(e))}function Lo(){At.call(this),this.type="Camera",this.matrixWorldInverse=new mn,this.projectionMatrix=new mn,this.projectionMatrixInverse=new mn}function Ni(e,t,r,i){Lo.call(this),this.type="PerspectiveCamera",this.fov=e!==void 0?e:50,this.zoom=1,this.near=r!==void 0?r:.1,this.far=i!==void 0?i:2e3,this.focus=10,this.aspect=t!==void 0?t:1,this.view=null,this.filmGauge=35,this.filmOffset=0,this.updateProjectionMatrix()}function Xs(e,t,r,i){At.call(this),this.type="CubeCamera";var l=new Ni(90,1,e,t);l.up.set(0,-1,0),l.lookAt(new Le(1,0,0)),this.add(l);var p=new Ni(90,1,e,t);p.up.set(0,-1,0),p.lookAt(new Le(-1,0,0)),this.add(p);var f=new Ni(90,1,e,t);f.up.set(0,0,1),f.lookAt(new Le(0,1,0)),this.add(f);var w=new Ni(90,1,e,t);w.up.set(0,0,-1),w.lookAt(new Le(0,-1,0)),this.add(w);var L=new Ni(90,1,e,t);L.up.set(0,-1,0),L.lookAt(new Le(0,0,1)),this.add(L);var V=new Ni(90,1,e,t);V.up.set(0,-1,0),V.lookAt(new Le(0,0,-1)),this.add(V),i=i||{format:Sn,magFilter:Tr,minFilter:Tr},this.renderTarget=new Ys(r,i),this.renderTarget.texture.name="CubeCamera",this.update=function(Z,ee){this.parent===null&&this.updateMatrixWorld();var ae=Z.getRenderTarget(),W=this.renderTarget,he=W.texture.generateMipmaps;W.texture.generateMipmaps=!1,Z.setRenderTarget(W,0),Z.render(ee,l),Z.setRenderTarget(W,1),Z.render(ee,p),Z.setRenderTarget(W,2),Z.render(ee,f),Z.setRenderTarget(W,3),Z.render(ee,w),Z.setRenderTarget(W,4),Z.render(ee,L),W.texture.generateMipmaps=he,Z.setRenderTarget(W,5),Z.render(ee,V),Z.setRenderTarget(ae)},this.clear=function(Z,ee,ae,W){for(var he=Z.getRenderTarget(),ge=this.renderTarget,ye=0;ye<6;ye++)Z.setRenderTarget(ge,ye),Z.clear(ee,ae,W);Z.setRenderTarget(he)}}function Ys(e,t,r){Number.isInteger(t)&&(console.warn("THREE.WebGLCubeRenderTarget: constructor signature is now WebGLCubeRenderTarget( size, options )"),t=r),Yi.call(this,e,e,t)}function Pl(e,t,r,i,l,p,f,w,L,V,Z,ee){Yn.call(this,null,p,f,w,L,V,i,l,Z,ee),this.image={data:e||null,width:t||1,height:r||1},this.magFilter=L!==void 0?L:ct,this.minFilter=V!==void 0?V:ct,this.generateMipmaps=!1,this.flipY=!1,this.unpackAlignment=1,this.needsUpdate=!0}((Xa.prototype=Object.create(kt.prototype)).constructor=Xa).prototype.isShaderMaterial=!0,Xa.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.fragmentShader=e.fragmentShader,this.vertexShader=e.vertexShader,this.uniforms=Ds(e.uniforms),this.defines=Object.assign({},e.defines),this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.lights=e.lights,this.clipping=e.clipping,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this.extensions=e.extensions,this},Xa.prototype.toJSON=function(e){var t=kt.prototype.toJSON.call(this,e);for(var r in t.uniforms={},this.uniforms){var i=this.uniforms[r].value;i&&i.isTexture?t.uniforms[r]={type:"t",value:i.toJSON(e).uuid}:i&&i.isColor?t.uniforms[r]={type:"c",value:i.getHex()}:i&&i.isVector2?t.uniforms[r]={type:"v2",value:i.toArray()}:i&&i.isVector3?t.uniforms[r]={type:"v3",value:i.toArray()}:i&&i.isVector4?t.uniforms[r]={type:"v4",value:i.toArray()}:i&&i.isMatrix3?t.uniforms[r]={type:"m3",value:i.toArray()}:i&&i.isMatrix4?t.uniforms[r]={type:"m4",value:i.toArray()}:t.uniforms[r]={value:i}}0<Object.keys(this.defines).length&&(t.defines=this.defines),t.vertexShader=this.vertexShader,t.fragmentShader=this.fragmentShader;var l={};for(var p in this.extensions)this.extensions[p]===!0&&(l[p]=!0);return 0<Object.keys(l).length&&(t.extensions=l),t},Lo.prototype=Object.assign(Object.create(At.prototype),{constructor:Lo,isCamera:!0,copy:function(e,t){return At.prototype.copy.call(this,e,t),this.matrixWorldInverse.copy(e.matrixWorldInverse),this.projectionMatrix.copy(e.projectionMatrix),this.projectionMatrixInverse.copy(e.projectionMatrixInverse),this},getWorldDirection:function(e){e===void 0&&(console.warn("THREE.Camera: .getWorldDirection() target is now required"),e=new Le),this.updateMatrixWorld(!0);var t=this.matrixWorld.elements;return e.set(-t[8],-t[9],-t[10]).normalize()},updateMatrixWorld:function(e){At.prototype.updateMatrixWorld.call(this,e),this.matrixWorldInverse.getInverse(this.matrixWorld)},updateWorldMatrix:function(e,t){At.prototype.updateWorldMatrix.call(this,e,t),this.matrixWorldInverse.getInverse(this.matrixWorld)},clone:function(){return new this.constructor().copy(this)}}),Ni.prototype=Object.assign(Object.create(Lo.prototype),{constructor:Ni,isPerspectiveCamera:!0,copy:function(e,t){return Lo.prototype.copy.call(this,e,t),this.fov=e.fov,this.zoom=e.zoom,this.near=e.near,this.far=e.far,this.focus=e.focus,this.aspect=e.aspect,this.view=e.view===null?null:Object.assign({},e.view),this.filmGauge=e.filmGauge,this.filmOffset=e.filmOffset,this},setFocalLength:function(e){var t=.5*this.getFilmHeight()/e;this.fov=2*xn.RAD2DEG*Math.atan(t),this.updateProjectionMatrix()},getFocalLength:function(){var e=Math.tan(.5*xn.DEG2RAD*this.fov);return .5*this.getFilmHeight()/e},getEffectiveFOV:function(){return 2*xn.RAD2DEG*Math.atan(Math.tan(.5*xn.DEG2RAD*this.fov)/this.zoom)},getFilmWidth:function(){return this.filmGauge*Math.min(this.aspect,1)},getFilmHeight:function(){return this.filmGauge/Math.max(this.aspect,1)},setViewOffset:function(e,t,r,i,l,p){this.aspect=e/t,this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=l,this.view.height=p,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=this.near,t=e*Math.tan(.5*xn.DEG2RAD*this.fov)/this.zoom,r=2*t,i=this.aspect*r,l=-.5*i,p=this.view;if(this.view!==null&&this.view.enabled){var f=p.fullWidth,w=p.fullHeight;l+=p.offsetX*i/f,t-=p.offsetY*r/w,i*=p.width/f,r*=p.height/w}var L=this.filmOffset;L!==0&&(l+=e*L/this.getFilmWidth()),this.projectionMatrix.makePerspective(l,l+i,t,t-r,e,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=At.prototype.toJSON.call(this,e);return t.object.fov=this.fov,t.object.zoom=this.zoom,t.object.near=this.near,t.object.far=this.far,t.object.focus=this.focus,t.object.aspect=this.aspect,this.view!==null&&(t.object.view=Object.assign({},this.view)),t.object.filmGauge=this.filmGauge,t.object.filmOffset=this.filmOffset,t}}),(Xs.prototype=Object.create(At.prototype)).constructor=Xs,((Ys.prototype=Object.create(Yi.prototype)).constructor=Ys).prototype.isWebGLCubeRenderTarget=!0,Ys.prototype.fromEquirectangularTexture=function(e,t){this.texture.type=t.type,this.texture.format=t.format,this.texture.encoding=t.encoding;var r=new Wr,i={uniforms:{tEquirect:{value:null}},vertexShader:["varying vec3 vWorldDirection;","vec3 transformDirection( in vec3 dir, in mat4 matrix ) {","	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );","}","void main() {","	vWorldDirection = transformDirection( position, modelMatrix );","	#include <begin_vertex>","	#include <project_vertex>","}"].join(`
`),fragmentShader:["uniform sampler2D tEquirect;","varying vec3 vWorldDirection;","#define RECIPROCAL_PI 0.31830988618","#define RECIPROCAL_PI2 0.15915494","void main() {","	vec3 direction = normalize( vWorldDirection );","	vec2 sampleUV;","	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;","	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;","	gl_FragColor = texture2D( tEquirect, sampleUV );","}"].join(`
`)},l=new Xa({type:"CubemapFromEquirect",uniforms:Ds(i.uniforms),vertexShader:i.vertexShader,fragmentShader:i.fragmentShader,side:_,blending:C});l.uniforms.tEquirect.value=t;var p=new Di(new lu(5,5,5),l);r.add(p);var f=new Xs(1,10,1);return f.renderTarget=this,f.renderTarget.texture.name="CubeCameraTexture",f.update(e,r),p.geometry.dispose(),p.material.dispose(),this},((Pl.prototype=Object.create(Yn.prototype)).constructor=Pl).prototype.isDataTexture=!0;var Zs=new Kn,Ks=new Le;function $s(e,t,r,i,l,p){this.planes=[e!==void 0?e:new na,t!==void 0?t:new na,r!==void 0?r:new na,i!==void 0?i:new na,l!==void 0?l:new na,p!==void 0?p:new na]}Object.assign($s.prototype,{set:function(e,t,r,i,l,p){var f=this.planes;return f[0].copy(e),f[1].copy(t),f[2].copy(r),f[3].copy(i),f[4].copy(l),f[5].copy(p),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){for(var t=this.planes,r=0;r<6;r++)t[r].copy(e.planes[r]);return this},setFromProjectionMatrix:function(e){var t=this.planes,r=e.elements,i=r[0],l=r[1],p=r[2],f=r[3],w=r[4],L=r[5],V=r[6],Z=r[7],ee=r[8],ae=r[9],W=r[10],he=r[11],ge=r[12],ye=r[13],Ae=r[14],je=r[15];return t[0].setComponents(f-i,Z-w,he-ee,je-ge).normalize(),t[1].setComponents(f+i,Z+w,he+ee,je+ge).normalize(),t[2].setComponents(f+l,Z+L,he+ae,je+ye).normalize(),t[3].setComponents(f-l,Z-L,he-ae,je-ye).normalize(),t[4].setComponents(f-p,Z-V,he-W,je-Ae).normalize(),t[5].setComponents(f+p,Z+V,he+W,je+Ae).normalize(),this},intersectsObject:function(e){var t=e.geometry;return t.boundingSphere===null&&t.computeBoundingSphere(),Zs.copy(t.boundingSphere).applyMatrix4(e.matrixWorld),this.intersectsSphere(Zs)},intersectsSprite:function(e){return Zs.center.set(0,0,0),Zs.radius=.7071067811865476,Zs.applyMatrix4(e.matrixWorld),this.intersectsSphere(Zs)},intersectsSphere:function(e){for(var t=this.planes,r=e.center,i=-e.radius,l=0;l<6;l++)if(t[l].distanceToPoint(r)<i)return!1;return!0},intersectsBox:function(e){for(var t=this.planes,r=0;r<6;r++){var i=t[r];if(Ks.x=0<i.normal.x?e.max.x:e.min.x,Ks.y=0<i.normal.y?e.max.y:e.min.y,Ks.z=0<i.normal.z?e.max.z:e.min.z,i.distanceToPoint(Ks)<0)return!1}return!0},containsPoint:function(e){for(var t=this.planes,r=0;r<6;r++)if(t[r].distanceToPoint(e)<0)return!1;return!0}});var gr={common:{diffuse:{value:new Qe(15658734)},opacity:{value:1},map:{value:null},uvTransform:{value:new Ai},uv2Transform:{value:new Ai},alphaMap:{value:null}},specularmap:{specularMap:{value:null}},envmap:{envMap:{value:null},flipEnvMap:{value:-1},reflectivity:{value:1},refractionRatio:{value:.98},maxMipLevel:{value:0}},aomap:{aoMap:{value:null},aoMapIntensity:{value:1}},lightmap:{lightMap:{value:null},lightMapIntensity:{value:1}},emissivemap:{emissiveMap:{value:null}},bumpmap:{bumpMap:{value:null},bumpScale:{value:1}},normalmap:{normalMap:{value:null},normalScale:{value:new Gt(1,1)}},displacementmap:{displacementMap:{value:null},displacementScale:{value:1},displacementBias:{value:0}},roughnessmap:{roughnessMap:{value:null}},metalnessmap:{metalnessMap:{value:null}},gradientmap:{gradientMap:{value:null}},fog:{fogDensity:{value:25e-5},fogNear:{value:1},fogFar:{value:2e3},fogColor:{value:new Qe(16777215)}},lights:{ambientLightColor:{value:[]},lightProbe:{value:[]},directionalLights:{value:[],properties:{direction:{},color:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},directionalShadowMap:{value:[]},directionalShadowMatrix:{value:[]},spotLights:{value:[],properties:{color:{},position:{},direction:{},distance:{},coneCos:{},penumbraCos:{},decay:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{}}},spotShadowMap:{value:[]},spotShadowMatrix:{value:[]},pointLights:{value:[],properties:{color:{},position:{},decay:{},distance:{},shadow:{},shadowBias:{},shadowRadius:{},shadowMapSize:{},shadowCameraNear:{},shadowCameraFar:{}}},pointShadowMap:{value:[]},pointShadowMatrix:{value:[]},hemisphereLights:{value:[],properties:{direction:{},skyColor:{},groundColor:{}}},rectAreaLights:{value:[],properties:{color:{},position:{},width:{},height:{}}}},points:{diffuse:{value:new Qe(15658734)},opacity:{value:1},size:{value:1},scale:{value:1},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ai}},sprite:{diffuse:{value:new Qe(15658734)},opacity:{value:1},center:{value:new Gt(.5,.5)},rotation:{value:0},map:{value:null},alphaMap:{value:null},uvTransform:{value:new Ai}}};function uh(){var e=null,t=!1,r=null;function i(l,p){t!==!1&&(r(l,p),e.requestAnimationFrame(i))}return{start:function(){t!==!0&&r!==null&&(e.requestAnimationFrame(i),t=!0)},stop:function(){t=!1},setAnimationLoop:function(l){r=l},setContext:function(l){e=l}}}function Rl(e,t,r,i){un.call(this),this.type="PlaneGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i},this.fromBufferGeometry(new Qs(e,t,r,i)),this.mergeVertices()}function Qs(e,t,r,i){br.call(this),this.type="PlaneBufferGeometry",this.parameters={width:e,height:t,widthSegments:r,heightSegments:i};var l,p,f=(e=e||1)/2,w=(t=t||1)/2,L=Math.floor(r)||1,V=Math.floor(i)||1,Z=L+1,ee=V+1,ae=e/L,W=t/V,he=[],ge=[],ye=[],Ae=[];for(p=0;p<ee;p++){var je=p*W-w;for(l=0;l<Z;l++){var He=l*ae-f;ge.push(He,-je,0),ye.push(0,0,1),Ae.push(l/L),Ae.push(1-p/V)}}for(p=0;p<V;p++)for(l=0;l<L;l++){var et=l+Z*p,Ge=l+Z*(p+1),it=l+1+Z*(p+1),qe=l+1+Z*p;he.push(et,Ge,qe),he.push(Ge,it,qe)}this.setIndex(he),this.setAttribute("position",new tr(ge,3)),this.setAttribute("normal",new tr(ye,3)),this.setAttribute("uv",new tr(Ae,2))}(Rl.prototype=Object.create(un.prototype)).constructor=Rl,(Qs.prototype=Object.create(br.prototype)).constructor=Qs;var Pn={alphamap_fragment:`#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, vUv ).g;
#endif`,alphamap_pars_fragment:`#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,alphatest_fragment:`#ifdef ALPHATEST
	if ( diffuseColor.a < ALPHATEST ) discard;
#endif`,aomap_fragment:`#ifdef USE_AOMAP
	float ambientOcclusion = ( texture2D( aoMap, vUv2 ).r - 1.0 ) * aoMapIntensity + 1.0;
	reflectedLight.indirectDiffuse *= ambientOcclusion;
	#if defined( USE_ENVMAP ) && defined( STANDARD )
		float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
		reflectedLight.indirectSpecular *= computeSpecularOcclusion( dotNV, ambientOcclusion, material.specularRoughness );
	#endif
#endif`,aomap_pars_fragment:`#ifdef USE_AOMAP
	uniform sampler2D aoMap;
	uniform float aoMapIntensity;
#endif`,begin_vertex:"vec3 transformed = vec3( position );",beginnormal_vertex:`vec3 objectNormal = vec3( normal );
#ifdef USE_TANGENT
	vec3 objectTangent = vec3( tangent.xyz );
#endif`,bsdfs:`vec2 integrateSpecularBRDF( const in float dotNV, const in float roughness ) {
	const vec4 c0 = vec4( - 1, - 0.0275, - 0.572, 0.022 );
	const vec4 c1 = vec4( 1, 0.0425, 1.04, - 0.04 );
	vec4 r = roughness * c0 + c1;
	float a004 = min( r.x * r.x, exp2( - 9.28 * dotNV ) ) * r.x + r.y;
	return vec2( -1.04, 1.04 ) * a004 + r.zw;
}
float punctualLightIntensityToIrradianceFactor( const in float lightDistance, const in float cutoffDistance, const in float decayExponent ) {
#if defined ( PHYSICALLY_CORRECT_LIGHTS )
	float distanceFalloff = 1.0 / max( pow( lightDistance, decayExponent ), 0.01 );
	if( cutoffDistance > 0.0 ) {
		distanceFalloff *= pow2( saturate( 1.0 - pow4( lightDistance / cutoffDistance ) ) );
	}
	return distanceFalloff;
#else
	if( cutoffDistance > 0.0 && decayExponent > 0.0 ) {
		return pow( saturate( -lightDistance / cutoffDistance + 1.0 ), decayExponent );
	}
	return 1.0;
#endif
}
vec3 BRDF_Diffuse_Lambert( const in vec3 diffuseColor ) {
	return RECIPROCAL_PI * diffuseColor;
}
vec3 F_Schlick( const in vec3 specularColor, const in float dotLH ) {
	float fresnel = exp2( ( -5.55473 * dotLH - 6.98316 ) * dotLH );
	return ( 1.0 - specularColor ) * fresnel + specularColor;
}
vec3 F_Schlick_RoughnessDependent( const in vec3 F0, const in float dotNV, const in float roughness ) {
	float fresnel = exp2( ( -5.55473 * dotNV - 6.98316 ) * dotNV );
	vec3 Fr = max( vec3( 1.0 - roughness ), F0 ) - F0;
	return Fr * fresnel + F0;
}
float G_GGX_Smith( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gl = dotNL + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	float gv = dotNV + sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	return 1.0 / ( gl * gv );
}
float G_GGX_SmithCorrelated( const in float alpha, const in float dotNL, const in float dotNV ) {
	float a2 = pow2( alpha );
	float gv = dotNL * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNV ) );
	float gl = dotNV * sqrt( a2 + ( 1.0 - a2 ) * pow2( dotNL ) );
	return 0.5 / max( gv + gl, EPSILON );
}
float D_GGX( const in float alpha, const in float dotNH ) {
	float a2 = pow2( alpha );
	float denom = pow2( dotNH ) * ( a2 - 1.0 ) + 1.0;
	return RECIPROCAL_PI * a2 / pow2( denom );
}
vec3 BRDF_Specular_GGX( const in IncidentLight incidentLight, const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float alpha = pow2( roughness );
	vec3 halfDir = normalize( incidentLight.direction + viewDir );
	float dotNL = saturate( dot( normal, incidentLight.direction ) );
	float dotNV = saturate( dot( normal, viewDir ) );
	float dotNH = saturate( dot( normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_GGX_SmithCorrelated( alpha, dotNL, dotNV );
	float D = D_GGX( alpha, dotNH );
	return F * ( G * D );
}
vec2 LTC_Uv( const in vec3 N, const in vec3 V, const in float roughness ) {
	const float LUT_SIZE  = 64.0;
	const float LUT_SCALE = ( LUT_SIZE - 1.0 ) / LUT_SIZE;
	const float LUT_BIAS  = 0.5 / LUT_SIZE;
	float dotNV = saturate( dot( N, V ) );
	vec2 uv = vec2( roughness, sqrt( 1.0 - dotNV ) );
	uv = uv * LUT_SCALE + LUT_BIAS;
	return uv;
}
float LTC_ClippedSphereFormFactor( const in vec3 f ) {
	float l = length( f );
	return max( ( l * l + f.z ) / ( l + 1.0 ), 0.0 );
}
vec3 LTC_EdgeVectorFormFactor( const in vec3 v1, const in vec3 v2 ) {
	float x = dot( v1, v2 );
	float y = abs( x );
	float a = 0.8543985 + ( 0.4965155 + 0.0145206 * y ) * y;
	float b = 3.4175940 + ( 4.1616724 + y ) * y;
	float v = a / b;
	float theta_sintheta = ( x > 0.0 ) ? v : 0.5 * inversesqrt( max( 1.0 - x * x, 1e-7 ) ) - v;
	return cross( v1, v2 ) * theta_sintheta;
}
vec3 LTC_Evaluate( const in vec3 N, const in vec3 V, const in vec3 P, const in mat3 mInv, const in vec3 rectCoords[ 4 ] ) {
	vec3 v1 = rectCoords[ 1 ] - rectCoords[ 0 ];
	vec3 v2 = rectCoords[ 3 ] - rectCoords[ 0 ];
	vec3 lightNormal = cross( v1, v2 );
	if( dot( lightNormal, P - rectCoords[ 0 ] ) < 0.0 ) return vec3( 0.0 );
	vec3 T1, T2;
	T1 = normalize( V - N * dot( V, N ) );
	T2 = - cross( N, T1 );
	mat3 mat = mInv * transposeMat3( mat3( T1, T2, N ) );
	vec3 coords[ 4 ];
	coords[ 0 ] = mat * ( rectCoords[ 0 ] - P );
	coords[ 1 ] = mat * ( rectCoords[ 1 ] - P );
	coords[ 2 ] = mat * ( rectCoords[ 2 ] - P );
	coords[ 3 ] = mat * ( rectCoords[ 3 ] - P );
	coords[ 0 ] = normalize( coords[ 0 ] );
	coords[ 1 ] = normalize( coords[ 1 ] );
	coords[ 2 ] = normalize( coords[ 2 ] );
	coords[ 3 ] = normalize( coords[ 3 ] );
	vec3 vectorFormFactor = vec3( 0.0 );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 0 ], coords[ 1 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 1 ], coords[ 2 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 2 ], coords[ 3 ] );
	vectorFormFactor += LTC_EdgeVectorFormFactor( coords[ 3 ], coords[ 0 ] );
	float result = LTC_ClippedSphereFormFactor( vectorFormFactor );
	return vec3( result );
}
vec3 BRDF_Specular_GGX_Environment( const in vec3 viewDir, const in vec3 normal, const in vec3 specularColor, const in float roughness ) {
	float dotNV = saturate( dot( normal, viewDir ) );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	return specularColor * brdf.x + brdf.y;
}
void BRDF_Specular_Multiscattering_Environment( const in GeometricContext geometry, const in vec3 specularColor, const in float roughness, inout vec3 singleScatter, inout vec3 multiScatter ) {
	float dotNV = saturate( dot( geometry.normal, geometry.viewDir ) );
	vec3 F = F_Schlick_RoughnessDependent( specularColor, dotNV, roughness );
	vec2 brdf = integrateSpecularBRDF( dotNV, roughness );
	vec3 FssEss = F * brdf.x + brdf.y;
	float Ess = brdf.x + brdf.y;
	float Ems = 1.0 - Ess;
	vec3 Favg = specularColor + ( 1.0 - specularColor ) * 0.047619;	vec3 Fms = FssEss * Favg / ( 1.0 - Ems * Favg );
	singleScatter += FssEss;
	multiScatter += Fms * Ems;
}
float G_BlinnPhong_Implicit( ) {
	return 0.25;
}
float D_BlinnPhong( const in float shininess, const in float dotNH ) {
	return RECIPROCAL_PI * ( shininess * 0.5 + 1.0 ) * pow( dotNH, shininess );
}
vec3 BRDF_Specular_BlinnPhong( const in IncidentLight incidentLight, const in GeometricContext geometry, const in vec3 specularColor, const in float shininess ) {
	vec3 halfDir = normalize( incidentLight.direction + geometry.viewDir );
	float dotNH = saturate( dot( geometry.normal, halfDir ) );
	float dotLH = saturate( dot( incidentLight.direction, halfDir ) );
	vec3 F = F_Schlick( specularColor, dotLH );
	float G = G_BlinnPhong_Implicit( );
	float D = D_BlinnPhong( shininess, dotNH );
	return F * ( G * D );
}
float GGXRoughnessToBlinnExponent( const in float ggxRoughness ) {
	return ( 2.0 / pow2( ggxRoughness + 0.0001 ) - 2.0 );
}
float BlinnExponentToGGXRoughness( const in float blinnExponent ) {
	return sqrt( 2.0 / ( blinnExponent + 2.0 ) );
}
#if defined( USE_SHEEN )
float D_Charlie(float roughness, float NoH) {
	float invAlpha  = 1.0 / roughness;
	float cos2h = NoH * NoH;
	float sin2h = max(1.0 - cos2h, 0.0078125);	return (2.0 + invAlpha) * pow(sin2h, invAlpha * 0.5) / (2.0 * PI);
}
float V_Neubelt(float NoV, float NoL) {
	return saturate(1.0 / (4.0 * (NoL + NoV - NoL * NoV)));
}
vec3 BRDF_Specular_Sheen( const in float roughness, const in vec3 L, const in GeometricContext geometry, vec3 specularColor ) {
	vec3 N = geometry.normal;
	vec3 V = geometry.viewDir;
	vec3 H = normalize( V + L );
	float dotNH = saturate( dot( N, H ) );
	return specularColor * D_Charlie( roughness, dotNH ) * V_Neubelt( dot(N, V), dot(N, L) );
}
#endif`,bumpmap_pars_fragment:`#ifdef USE_BUMPMAP
	uniform sampler2D bumpMap;
	uniform float bumpScale;
	vec2 dHdxy_fwd() {
		vec2 dSTdx = dFdx( vUv );
		vec2 dSTdy = dFdy( vUv );
		float Hll = bumpScale * texture2D( bumpMap, vUv ).x;
		float dBx = bumpScale * texture2D( bumpMap, vUv + dSTdx ).x - Hll;
		float dBy = bumpScale * texture2D( bumpMap, vUv + dSTdy ).x - Hll;
		return vec2( dBx, dBy );
	}
	vec3 perturbNormalArb( vec3 surf_pos, vec3 surf_norm, vec2 dHdxy ) {
		vec3 vSigmaX = vec3( dFdx( surf_pos.x ), dFdx( surf_pos.y ), dFdx( surf_pos.z ) );
		vec3 vSigmaY = vec3( dFdy( surf_pos.x ), dFdy( surf_pos.y ), dFdy( surf_pos.z ) );
		vec3 vN = surf_norm;
		vec3 R1 = cross( vSigmaY, vN );
		vec3 R2 = cross( vN, vSigmaX );
		float fDet = dot( vSigmaX, R1 );
		fDet *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		vec3 vGrad = sign( fDet ) * ( dHdxy.x * R1 + dHdxy.y * R2 );
		return normalize( abs( fDet ) * surf_norm - vGrad );
	}
#endif`,clipping_planes_fragment:`#if NUM_CLIPPING_PLANES > 0
	vec4 plane;
	#pragma unroll_loop
	for ( int i = 0; i < UNION_CLIPPING_PLANES; i ++ ) {
		plane = clippingPlanes[ i ];
		if ( dot( vViewPosition, plane.xyz ) > plane.w ) discard;
	}
	#if UNION_CLIPPING_PLANES < NUM_CLIPPING_PLANES
		bool clipped = true;
		#pragma unroll_loop
		for ( int i = UNION_CLIPPING_PLANES; i < NUM_CLIPPING_PLANES; i ++ ) {
			plane = clippingPlanes[ i ];
			clipped = ( dot( vViewPosition, plane.xyz ) > plane.w ) && clipped;
		}
		if ( clipped ) discard;
	#endif
#endif`,clipping_planes_pars_fragment:`#if NUM_CLIPPING_PLANES > 0
	#if ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
		varying vec3 vViewPosition;
	#endif
	uniform vec4 clippingPlanes[ NUM_CLIPPING_PLANES ];
#endif`,clipping_planes_pars_vertex:`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	varying vec3 vViewPosition;
#endif`,clipping_planes_vertex:`#if NUM_CLIPPING_PLANES > 0 && ! defined( STANDARD ) && ! defined( PHONG ) && ! defined( MATCAP )
	vViewPosition = - mvPosition.xyz;
#endif`,color_fragment:`#ifdef USE_COLOR
	diffuseColor.rgb *= vColor;
#endif`,color_pars_fragment:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_pars_vertex:`#ifdef USE_COLOR
	varying vec3 vColor;
#endif`,color_vertex:`#ifdef USE_COLOR
	vColor.xyz = color.xyz;
#endif`,common:`#define PI 3.14159265359
#define PI2 6.28318530718
#define PI_HALF 1.5707963267949
#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494
#define LOG2 1.442695
#define EPSILON 1e-6
#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
#define whiteComplement(a) ( 1.0 - saturate( a ) )
float pow2( const in float x ) { return x*x; }
float pow3( const in float x ) { return x*x*x; }
float pow4( const in float x ) { float x2 = x*x; return x2*x2; }
float average( const in vec3 color ) { return dot( color, vec3( 0.3333 ) ); }
highp float rand( const in vec2 uv ) {
	const highp float a = 12.9898, b = 78.233, c = 43758.5453;
	highp float dt = dot( uv.xy, vec2( a,b ) ), sn = mod( dt, PI );
	return fract(sin(sn) * c);
}
#ifdef HIGH_PRECISION
	float precisionSafeLength( vec3 v ) { return length( v ); }
#else
	float max3( vec3 v ) { return max( max( v.x, v.y ), v.z ); }
	float precisionSafeLength( vec3 v ) {
		float maxComponent = max3( abs( v ) );
		return length( v / maxComponent ) * maxComponent;
	}
#endif
struct IncidentLight {
	vec3 color;
	vec3 direction;
	bool visible;
};
struct ReflectedLight {
	vec3 directDiffuse;
	vec3 directSpecular;
	vec3 indirectDiffuse;
	vec3 indirectSpecular;
};
struct GeometricContext {
	vec3 position;
	vec3 normal;
	vec3 viewDir;
#ifdef CLEARCOAT
	vec3 clearcoatNormal;
#endif
};
vec3 transformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( matrix * vec4( dir, 0.0 ) ).xyz );
}
vec3 inverseTransformDirection( in vec3 dir, in mat4 matrix ) {
	return normalize( ( vec4( dir, 0.0 ) * matrix ).xyz );
}
vec3 projectOnPlane(in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	float distance = dot( planeNormal, point - pointOnPlane );
	return - distance * planeNormal + point;
}
float sideOfPlane( in vec3 point, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return sign( dot( point - pointOnPlane, planeNormal ) );
}
vec3 linePlaneIntersect( in vec3 pointOnLine, in vec3 lineDirection, in vec3 pointOnPlane, in vec3 planeNormal ) {
	return lineDirection * ( dot( planeNormal, pointOnPlane - pointOnLine ) / dot( planeNormal, lineDirection ) ) + pointOnLine;
}
mat3 transposeMat3( const in mat3 m ) {
	mat3 tmp;
	tmp[ 0 ] = vec3( m[ 0 ].x, m[ 1 ].x, m[ 2 ].x );
	tmp[ 1 ] = vec3( m[ 0 ].y, m[ 1 ].y, m[ 2 ].y );
	tmp[ 2 ] = vec3( m[ 0 ].z, m[ 1 ].z, m[ 2 ].z );
	return tmp;
}
float linearToRelativeLuminance( const in vec3 color ) {
	vec3 weights = vec3( 0.2126, 0.7152, 0.0722 );
	return dot( weights, color.rgb );
}
bool isPerspectiveMatrix( mat4 m ) {
  return m[ 2 ][ 3 ] == - 1.0;
}`,cube_uv_reflection_fragment:`#ifdef ENVMAP_TYPE_CUBE_UV
#define cubeUV_maxMipLevel 8.0
#define cubeUV_minMipLevel 4.0
#define cubeUV_maxTileSize 256.0
#define cubeUV_minTileSize 16.0
float getFace(vec3 direction) {
    vec3 absDirection = abs(direction);
    float face = -1.0;
    if (absDirection.x > absDirection.z) {
      if (absDirection.x > absDirection.y)
        face = direction.x > 0.0 ? 0.0 : 3.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    } else {
      if (absDirection.z > absDirection.y)
        face = direction.z > 0.0 ? 2.0 : 5.0;
      else
        face = direction.y > 0.0 ? 1.0 : 4.0;
    }
    return face;
}
vec2 getUV(vec3 direction, float face) {
    vec2 uv;
    if (face == 0.0) {
      uv = vec2(-direction.z, direction.y) / abs(direction.x);
    } else if (face == 1.0) {
      uv = vec2(direction.x, -direction.z) / abs(direction.y);
    } else if (face == 2.0) {
      uv = direction.xy / abs(direction.z);
    } else if (face == 3.0) {
      uv = vec2(direction.z, direction.y) / abs(direction.x);
    } else if (face == 4.0) {
      uv = direction.xz / abs(direction.y);
    } else {
      uv = vec2(-direction.x, direction.y) / abs(direction.z);
    }
    return 0.5 * (uv + 1.0);
}
vec3 bilinearCubeUV(sampler2D envMap, vec3 direction, float mipInt) {
  float face = getFace(direction);
  float filterInt = max(cubeUV_minMipLevel - mipInt, 0.0);
  mipInt = max(mipInt, cubeUV_minMipLevel);
  float faceSize = exp2(mipInt);
  float texelSize = 1.0 / (3.0 * cubeUV_maxTileSize);
  vec2 uv = getUV(direction, face) * (faceSize - 1.0);
  vec2 f = fract(uv);
  uv += 0.5 - f;
  if (face > 2.0) {
    uv.y += faceSize;
    face -= 3.0;
  }
  uv.x += face * faceSize;
  if(mipInt < cubeUV_maxMipLevel){
    uv.y += 2.0 * cubeUV_maxTileSize;
  }
  uv.y += filterInt * 2.0 * cubeUV_minTileSize;
  uv.x += 3.0 * max(0.0, cubeUV_maxTileSize - 2.0 * faceSize);
  uv *= texelSize;
  vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x += texelSize;
  vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.y += texelSize;
  vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  uv.x -= texelSize;
  vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
  vec3 tm = mix(tl, tr, f.x);
  vec3 bm = mix(bl, br, f.x);
  return mix(tm, bm, f.y);
}
#define r0 1.0
#define v0 0.339
#define m0 -2.0
#define r1 0.8
#define v1 0.276
#define m1 -1.0
#define r4 0.4
#define v4 0.046
#define m4 2.0
#define r5 0.305
#define v5 0.016
#define m5 3.0
#define r6 0.21
#define v6 0.0038
#define m6 4.0
float roughnessToMip(float roughness) {
  float mip = 0.0;
  if (roughness >= r1) {
    mip = (r0 - roughness) * (m1 - m0) / (r0 - r1) + m0;
  } else if (roughness >= r4) {
    mip = (r1 - roughness) * (m4 - m1) / (r1 - r4) + m1;
  } else if (roughness >= r5) {
    mip = (r4 - roughness) * (m5 - m4) / (r4 - r5) + m4;
  } else if (roughness >= r6) {
    mip = (r5 - roughness) * (m6 - m5) / (r5 - r6) + m5;
  } else {
    mip = -2.0 * log2(1.16 * roughness);  }
  return mip;
}
vec4 textureCubeUV(sampler2D envMap, vec3 sampleDir, float roughness) {
  float mip = clamp(roughnessToMip(roughness), m0, cubeUV_maxMipLevel);
  float mipF = fract(mip);
  float mipInt = floor(mip);
  vec3 color0 = bilinearCubeUV(envMap, sampleDir, mipInt);
  if (mipF == 0.0) {
    return vec4(color0, 1.0);
  } else {
    vec3 color1 = bilinearCubeUV(envMap, sampleDir, mipInt + 1.0);
    return vec4(mix(color0, color1, mipF), 1.0);
  }
}
#endif`,defaultnormal_vertex:`vec3 transformedNormal = objectNormal;
#ifdef USE_INSTANCING
	transformedNormal = mat3( instanceMatrix ) * transformedNormal;
#endif
transformedNormal = normalMatrix * transformedNormal;
#ifdef FLIP_SIDED
	transformedNormal = - transformedNormal;
#endif
#ifdef USE_TANGENT
	vec3 transformedTangent = ( modelViewMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#ifdef FLIP_SIDED
		transformedTangent = - transformedTangent;
	#endif
#endif`,displacementmap_pars_vertex:`#ifdef USE_DISPLACEMENTMAP
	uniform sampler2D displacementMap;
	uniform float displacementScale;
	uniform float displacementBias;
#endif`,displacementmap_vertex:`#ifdef USE_DISPLACEMENTMAP
	transformed += normalize( objectNormal ) * ( texture2D( displacementMap, vUv ).x * displacementScale + displacementBias );
#endif`,emissivemap_fragment:`#ifdef USE_EMISSIVEMAP
	vec4 emissiveColor = texture2D( emissiveMap, vUv );
	emissiveColor.rgb = emissiveMapTexelToLinear( emissiveColor ).rgb;
	totalEmissiveRadiance *= emissiveColor.rgb;
#endif`,emissivemap_pars_fragment:`#ifdef USE_EMISSIVEMAP
	uniform sampler2D emissiveMap;
#endif`,encodings_fragment:"gl_FragColor = linearToOutputTexel( gl_FragColor );",encodings_pars_fragment:`
vec4 LinearToLinear( in vec4 value ) {
	return value;
}
vec4 GammaToLinear( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( gammaFactor ) ), value.a );
}
vec4 LinearToGamma( in vec4 value, in float gammaFactor ) {
	return vec4( pow( value.rgb, vec3( 1.0 / gammaFactor ) ), value.a );
}
vec4 sRGBToLinear( in vec4 value ) {
	return vec4( mix( pow( value.rgb * 0.9478672986 + vec3( 0.0521327014 ), vec3( 2.4 ) ), value.rgb * 0.0773993808, vec3( lessThanEqual( value.rgb, vec3( 0.04045 ) ) ) ), value.a );
}
vec4 LinearTosRGB( in vec4 value ) {
	return vec4( mix( pow( value.rgb, vec3( 0.41666 ) ) * 1.055 - vec3( 0.055 ), value.rgb * 12.92, vec3( lessThanEqual( value.rgb, vec3( 0.0031308 ) ) ) ), value.a );
}
vec4 RGBEToLinear( in vec4 value ) {
	return vec4( value.rgb * exp2( value.a * 255.0 - 128.0 ), 1.0 );
}
vec4 LinearToRGBE( in vec4 value ) {
	float maxComponent = max( max( value.r, value.g ), value.b );
	float fExp = clamp( ceil( log2( maxComponent ) ), -128.0, 127.0 );
	return vec4( value.rgb / exp2( fExp ), ( fExp + 128.0 ) / 255.0 );
}
vec4 RGBMToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * value.a * maxRange, 1.0 );
}
vec4 LinearToRGBM( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float M = clamp( maxRGB / maxRange, 0.0, 1.0 );
	M = ceil( M * 255.0 ) / 255.0;
	return vec4( value.rgb / ( M * maxRange ), M );
}
vec4 RGBDToLinear( in vec4 value, in float maxRange ) {
	return vec4( value.rgb * ( ( maxRange / 255.0 ) / value.a ), 1.0 );
}
vec4 LinearToRGBD( in vec4 value, in float maxRange ) {
	float maxRGB = max( value.r, max( value.g, value.b ) );
	float D = max( maxRange / maxRGB, 1.0 );
	D = clamp( floor( D ) / 255.0, 0.0, 1.0 );
	return vec4( value.rgb * ( D * ( 255.0 / maxRange ) ), D );
}
const mat3 cLogLuvM = mat3( 0.2209, 0.3390, 0.4184, 0.1138, 0.6780, 0.7319, 0.0102, 0.1130, 0.2969 );
vec4 LinearToLogLuv( in vec4 value )  {
	vec3 Xp_Y_XYZp = cLogLuvM * value.rgb;
	Xp_Y_XYZp = max( Xp_Y_XYZp, vec3( 1e-6, 1e-6, 1e-6 ) );
	vec4 vResult;
	vResult.xy = Xp_Y_XYZp.xy / Xp_Y_XYZp.z;
	float Le = 2.0 * log2(Xp_Y_XYZp.y) + 127.0;
	vResult.w = fract( Le );
	vResult.z = ( Le - ( floor( vResult.w * 255.0 ) ) / 255.0 ) / 255.0;
	return vResult;
}
const mat3 cLogLuvInverseM = mat3( 6.0014, -2.7008, -1.7996, -1.3320, 3.1029, -5.7721, 0.3008, -1.0882, 5.6268 );
vec4 LogLuvToLinear( in vec4 value ) {
	float Le = value.z * 255.0 + value.w;
	vec3 Xp_Y_XYZp;
	Xp_Y_XYZp.y = exp2( ( Le - 127.0 ) / 2.0 );
	Xp_Y_XYZp.z = Xp_Y_XYZp.y / value.y;
	Xp_Y_XYZp.x = value.x * Xp_Y_XYZp.z;
	vec3 vRGB = cLogLuvInverseM * Xp_Y_XYZp.rgb;
	return vec4( max( vRGB, 0.0 ), 1.0 );
}`,envmap_fragment:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vec3 cameraToFrag;
		
		if ( isOrthographic ) {
			cameraToFrag = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		}  else {
			cameraToFrag = normalize( vWorldPosition - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( normal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vec3 reflectVec = reflect( cameraToFrag, worldNormal );
		#else
			vec3 reflectVec = refract( cameraToFrag, worldNormal, refractionRatio );
		#endif
	#else
		vec3 reflectVec = vReflect;
	#endif
	#ifdef ENVMAP_TYPE_CUBE
		vec4 envColor = textureCube( envMap, vec3( flipEnvMap * reflectVec.x, reflectVec.yz ) );
	#elif defined( ENVMAP_TYPE_CUBE_UV )
		vec4 envColor = textureCubeUV( envMap, reflectVec, 0.0 );
	#elif defined( ENVMAP_TYPE_EQUIREC )
		vec2 sampleUV;
		reflectVec = normalize( reflectVec );
		sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
		sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
		vec4 envColor = texture2D( envMap, sampleUV );
	#elif defined( ENVMAP_TYPE_SPHERE )
		reflectVec = normalize( reflectVec );
		vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0, 0.0, 1.0 ) );
		vec4 envColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5 );
	#else
		vec4 envColor = vec4( 0.0 );
	#endif
	#ifndef ENVMAP_TYPE_CUBE_UV
		envColor = envMapTexelToLinear( envColor );
	#endif
	#ifdef ENVMAP_BLENDING_MULTIPLY
		outgoingLight = mix( outgoingLight, outgoingLight * envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_MIX )
		outgoingLight = mix( outgoingLight, envColor.xyz, specularStrength * reflectivity );
	#elif defined( ENVMAP_BLENDING_ADD )
		outgoingLight += envColor.xyz * specularStrength * reflectivity;
	#endif
#endif`,envmap_common_pars_fragment:`#ifdef USE_ENVMAP
	uniform float envMapIntensity;
	uniform float flipEnvMap;
	uniform int maxMipLevel;
	#ifdef ENVMAP_TYPE_CUBE
		uniform samplerCube envMap;
	#else
		uniform sampler2D envMap;
	#endif
	
#endif`,envmap_pars_fragment:`#ifdef USE_ENVMAP
	uniform float reflectivity;
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) || defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		varying vec3 vWorldPosition;
		uniform float refractionRatio;
	#else
		varying vec3 vReflect;
	#endif
#endif`,envmap_pars_vertex:`#ifdef USE_ENVMAP
	#if defined( USE_BUMPMAP ) || defined( USE_NORMALMAP ) ||defined( PHONG )
		#define ENV_WORLDPOS
	#endif
	#ifdef ENV_WORLDPOS
		
		varying vec3 vWorldPosition;
	#else
		varying vec3 vReflect;
		uniform float refractionRatio;
	#endif
#endif`,envmap_physical_pars_fragment:`#if defined( USE_ENVMAP )
	#ifdef ENVMAP_MODE_REFRACTION
		uniform float refractionRatio;
	#endif
	vec3 getLightProbeIndirectIrradiance( const in GeometricContext geometry, const in int maxMIPLevel ) {
		vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryVec = vec3( flipEnvMap * worldNormal.x, worldNormal.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryVec, float( maxMIPLevel ) );
			#else
				vec4 envMapColor = textureCube( envMap, queryVec, float( maxMIPLevel ) );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, worldNormal, 1.0 );
		#else
			vec4 envMapColor = vec4( 0.0 );
		#endif
		return PI * envMapColor.rgb * envMapIntensity;
	}
	float getSpecularMIPLevel( const in float roughness, const in int maxMIPLevel ) {
		float maxMIPLevelScalar = float( maxMIPLevel );
		float sigma = PI * roughness * roughness / ( 1.0 + roughness );
		float desiredMIPLevel = maxMIPLevelScalar + log2( sigma );
		return clamp( desiredMIPLevel, 0.0, maxMIPLevelScalar );
	}
	vec3 getLightProbeIndirectRadiance( const in vec3 viewDir, const in vec3 normal, const in float roughness, const in int maxMIPLevel ) {
		#ifdef ENVMAP_MODE_REFLECTION
		  vec3 reflectVec = reflect( -viewDir, normal );
		  reflectVec = normalize( mix( reflectVec, normal, roughness * roughness) );
		#else
		  vec3 reflectVec = refract( -viewDir, normal, refractionRatio );
		#endif
		reflectVec = inverseTransformDirection( reflectVec, viewMatrix );
		float specularMIPLevel = getSpecularMIPLevel( roughness, maxMIPLevel );
		#ifdef ENVMAP_TYPE_CUBE
			vec3 queryReflectVec = vec3( flipEnvMap * reflectVec.x, reflectVec.yz );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = textureCubeLodEXT( envMap, queryReflectVec, specularMIPLevel );
			#else
				vec4 envMapColor = textureCube( envMap, queryReflectVec, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_CUBE_UV )
			vec4 envMapColor = textureCubeUV( envMap, reflectVec, roughness );
		#elif defined( ENVMAP_TYPE_EQUIREC )
			vec2 sampleUV;
			sampleUV.y = asin( clamp( reflectVec.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
			sampleUV.x = atan( reflectVec.z, reflectVec.x ) * RECIPROCAL_PI2 + 0.5;
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, sampleUV, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, sampleUV, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#elif defined( ENVMAP_TYPE_SPHERE )
			vec3 reflectView = normalize( ( viewMatrix * vec4( reflectVec, 0.0 ) ).xyz + vec3( 0.0,0.0,1.0 ) );
			#ifdef TEXTURE_LOD_EXT
				vec4 envMapColor = texture2DLodEXT( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#else
				vec4 envMapColor = texture2D( envMap, reflectView.xy * 0.5 + 0.5, specularMIPLevel );
			#endif
			envMapColor.rgb = envMapTexelToLinear( envMapColor ).rgb;
		#endif
		return envMapColor.rgb * envMapIntensity;
	}
#endif`,envmap_vertex:`#ifdef USE_ENVMAP
	#ifdef ENV_WORLDPOS
		vWorldPosition = worldPosition.xyz;
	#else
		vec3 cameraToVertex;
		if ( isOrthographic ) { 
			cameraToVertex = normalize( vec3( - viewMatrix[ 0 ][ 2 ], - viewMatrix[ 1 ][ 2 ], - viewMatrix[ 2 ][ 2 ] ) );
		} else {
			cameraToVertex = normalize( worldPosition.xyz - cameraPosition );
		}
		vec3 worldNormal = inverseTransformDirection( transformedNormal, viewMatrix );
		#ifdef ENVMAP_MODE_REFLECTION
			vReflect = reflect( cameraToVertex, worldNormal );
		#else
			vReflect = refract( cameraToVertex, worldNormal, refractionRatio );
		#endif
	#endif
#endif`,fog_vertex:`#ifdef USE_FOG
	fogDepth = -mvPosition.z;
#endif`,fog_pars_vertex:`#ifdef USE_FOG
	varying float fogDepth;
#endif`,fog_fragment:`#ifdef USE_FOG
	#ifdef FOG_EXP2
		float fogFactor = 1.0 - exp( - fogDensity * fogDensity * fogDepth * fogDepth );
	#else
		float fogFactor = smoothstep( fogNear, fogFar, fogDepth );
	#endif
	gl_FragColor.rgb = mix( gl_FragColor.rgb, fogColor, fogFactor );
#endif`,fog_pars_fragment:`#ifdef USE_FOG
	uniform vec3 fogColor;
	varying float fogDepth;
	#ifdef FOG_EXP2
		uniform float fogDensity;
	#else
		uniform float fogNear;
		uniform float fogFar;
	#endif
#endif`,gradientmap_pars_fragment:`#ifdef USE_GRADIENTMAP
	uniform sampler2D gradientMap;
#endif
vec3 getGradientIrradiance( vec3 normal, vec3 lightDirection ) {
	float dotNL = dot( normal, lightDirection );
	vec2 coord = vec2( dotNL * 0.5 + 0.5, 0.0 );
	#ifdef USE_GRADIENTMAP
		return texture2D( gradientMap, coord ).rgb;
	#else
		return ( coord.x < 0.7 ) ? vec3( 0.7 ) : vec3( 1.0 );
	#endif
}`,lightmap_fragment:`#ifdef USE_LIGHTMAP
	vec4 lightMapTexel= texture2D( lightMap, vUv2 );
	reflectedLight.indirectDiffuse += PI * lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
#endif`,lightmap_pars_fragment:`#ifdef USE_LIGHTMAP
	uniform sampler2D lightMap;
	uniform float lightMapIntensity;
#endif`,lights_lambert_vertex:`vec3 diffuse = vec3( 1.0 );
GeometricContext geometry;
geometry.position = mvPosition.xyz;
geometry.normal = normalize( transformedNormal );
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( -mvPosition.xyz );
GeometricContext backGeometry;
backGeometry.position = geometry.position;
backGeometry.normal = -geometry.normal;
backGeometry.viewDir = geometry.viewDir;
vLightFront = vec3( 0.0 );
vIndirectFront = vec3( 0.0 );
#ifdef DOUBLE_SIDED
	vLightBack = vec3( 0.0 );
	vIndirectBack = vec3( 0.0 );
#endif
IncidentLight directLight;
float dotNL;
vec3 directLightColor_Diffuse;
#if NUM_POINT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		getPointDirectLightIrradiance( pointLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		getSpotDirectLightIrradiance( spotLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_DIR_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		getDirectionalDirectLightIrradiance( directionalLights[ i ], geometry, directLight );
		dotNL = dot( geometry.normal, directLight.direction );
		directLightColor_Diffuse = PI * directLight.color;
		vLightFront += saturate( dotNL ) * directLightColor_Diffuse;
		#ifdef DOUBLE_SIDED
			vLightBack += saturate( -dotNL ) * directLightColor_Diffuse;
		#endif
	}
#endif
#if NUM_HEMI_LIGHTS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
		vIndirectFront += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		#ifdef DOUBLE_SIDED
			vIndirectBack += getHemisphereLightIrradiance( hemisphereLights[ i ], backGeometry );
		#endif
	}
#endif`,lights_pars_begin:`uniform bool receiveShadow;
uniform vec3 ambientLightColor;
uniform vec3 lightProbe[ 9 ];
vec3 shGetIrradianceAt( in vec3 normal, in vec3 shCoefficients[ 9 ] ) {
	float x = normal.x, y = normal.y, z = normal.z;
	vec3 result = shCoefficients[ 0 ] * 0.886227;
	result += shCoefficients[ 1 ] * 2.0 * 0.511664 * y;
	result += shCoefficients[ 2 ] * 2.0 * 0.511664 * z;
	result += shCoefficients[ 3 ] * 2.0 * 0.511664 * x;
	result += shCoefficients[ 4 ] * 2.0 * 0.429043 * x * y;
	result += shCoefficients[ 5 ] * 2.0 * 0.429043 * y * z;
	result += shCoefficients[ 6 ] * ( 0.743125 * z * z - 0.247708 );
	result += shCoefficients[ 7 ] * 2.0 * 0.429043 * x * z;
	result += shCoefficients[ 8 ] * 0.429043 * ( x * x - y * y );
	return result;
}
vec3 getLightProbeIrradiance( const in vec3 lightProbe[ 9 ], const in GeometricContext geometry ) {
	vec3 worldNormal = inverseTransformDirection( geometry.normal, viewMatrix );
	vec3 irradiance = shGetIrradianceAt( worldNormal, lightProbe );
	return irradiance;
}
vec3 getAmbientLightIrradiance( const in vec3 ambientLightColor ) {
	vec3 irradiance = ambientLightColor;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	return irradiance;
}
#if NUM_DIR_LIGHTS > 0
	struct DirectionalLight {
		vec3 direction;
		vec3 color;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform DirectionalLight directionalLights[ NUM_DIR_LIGHTS ];
	void getDirectionalDirectLightIrradiance( const in DirectionalLight directionalLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		directLight.color = directionalLight.color;
		directLight.direction = directionalLight.direction;
		directLight.visible = true;
	}
#endif
#if NUM_POINT_LIGHTS > 0
	struct PointLight {
		vec3 position;
		vec3 color;
		float distance;
		float decay;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
		float shadowCameraNear;
		float shadowCameraFar;
	};
	uniform PointLight pointLights[ NUM_POINT_LIGHTS ];
	void getPointDirectLightIrradiance( const in PointLight pointLight, const in GeometricContext geometry, out IncidentLight directLight ) {
		vec3 lVector = pointLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		directLight.color = pointLight.color;
		directLight.color *= punctualLightIntensityToIrradianceFactor( lightDistance, pointLight.distance, pointLight.decay );
		directLight.visible = ( directLight.color != vec3( 0.0 ) );
	}
#endif
#if NUM_SPOT_LIGHTS > 0
	struct SpotLight {
		vec3 position;
		vec3 direction;
		vec3 color;
		float distance;
		float decay;
		float coneCos;
		float penumbraCos;
		int shadow;
		float shadowBias;
		float shadowRadius;
		vec2 shadowMapSize;
	};
	uniform SpotLight spotLights[ NUM_SPOT_LIGHTS ];
	void getSpotDirectLightIrradiance( const in SpotLight spotLight, const in GeometricContext geometry, out IncidentLight directLight  ) {
		vec3 lVector = spotLight.position - geometry.position;
		directLight.direction = normalize( lVector );
		float lightDistance = length( lVector );
		float angleCos = dot( directLight.direction, spotLight.direction );
		if ( angleCos > spotLight.coneCos ) {
			float spotEffect = smoothstep( spotLight.coneCos, spotLight.penumbraCos, angleCos );
			directLight.color = spotLight.color;
			directLight.color *= spotEffect * punctualLightIntensityToIrradianceFactor( lightDistance, spotLight.distance, spotLight.decay );
			directLight.visible = true;
		} else {
			directLight.color = vec3( 0.0 );
			directLight.visible = false;
		}
	}
#endif
#if NUM_RECT_AREA_LIGHTS > 0
	struct RectAreaLight {
		vec3 color;
		vec3 position;
		vec3 halfWidth;
		vec3 halfHeight;
	};
	uniform sampler2D ltc_1;	uniform sampler2D ltc_2;
	uniform RectAreaLight rectAreaLights[ NUM_RECT_AREA_LIGHTS ];
#endif
#if NUM_HEMI_LIGHTS > 0
	struct HemisphereLight {
		vec3 direction;
		vec3 skyColor;
		vec3 groundColor;
	};
	uniform HemisphereLight hemisphereLights[ NUM_HEMI_LIGHTS ];
	vec3 getHemisphereLightIrradiance( const in HemisphereLight hemiLight, const in GeometricContext geometry ) {
		float dotNL = dot( geometry.normal, hemiLight.direction );
		float hemiDiffuseWeight = 0.5 * dotNL + 0.5;
		vec3 irradiance = mix( hemiLight.groundColor, hemiLight.skyColor, hemiDiffuseWeight );
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			irradiance *= PI;
		#endif
		return irradiance;
	}
#endif`,lights_toon_fragment:`ToonMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_toon_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct ToonMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_Toon( const in IncidentLight directLight, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	vec3 irradiance = getGradientIrradiance( geometry.normal, directLight.direction ) * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_Toon( const in vec3 irradiance, const in GeometricContext geometry, const in ToonMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_Toon
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Toon
#define Material_LightProbeLOD( material )	(0)`,lights_phong_fragment:`BlinnPhongMaterial material;
material.diffuseColor = diffuseColor.rgb;
material.specularColor = specular;
material.specularShininess = shininess;
material.specularStrength = specularStrength;`,lights_phong_pars_fragment:`varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
struct BlinnPhongMaterial {
	vec3	diffuseColor;
	vec3	specularColor;
	float	specularShininess;
	float	specularStrength;
};
void RE_Direct_BlinnPhong( const in IncidentLight directLight, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	reflectedLight.directDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
	reflectedLight.directSpecular += irradiance * BRDF_Specular_BlinnPhong( directLight, geometry, material.specularColor, material.specularShininess ) * material.specularStrength;
}
void RE_IndirectDiffuse_BlinnPhong( const in vec3 irradiance, const in GeometricContext geometry, const in BlinnPhongMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
#define RE_Direct				RE_Direct_BlinnPhong
#define RE_IndirectDiffuse		RE_IndirectDiffuse_BlinnPhong
#define Material_LightProbeLOD( material )	(0)`,lights_physical_fragment:`PhysicalMaterial material;
material.diffuseColor = diffuseColor.rgb * ( 1.0 - metalnessFactor );
vec3 dxy = max( abs( dFdx( geometryNormal ) ), abs( dFdy( geometryNormal ) ) );
float geometryRoughness = max( max( dxy.x, dxy.y ), dxy.z );
material.specularRoughness = max( roughnessFactor, 0.0525 );material.specularRoughness += geometryRoughness;
material.specularRoughness = min( material.specularRoughness, 1.0 );
#ifdef REFLECTIVITY
	material.specularColor = mix( vec3( MAXIMUM_SPECULAR_COEFFICIENT * pow2( reflectivity ) ), diffuseColor.rgb, metalnessFactor );
#else
	material.specularColor = mix( vec3( DEFAULT_SPECULAR_COEFFICIENT ), diffuseColor.rgb, metalnessFactor );
#endif
#ifdef CLEARCOAT
	material.clearcoat = saturate( clearcoat );	material.clearcoatRoughness = max( clearcoatRoughness, 0.0525 );
	material.clearcoatRoughness += geometryRoughness;
	material.clearcoatRoughness = min( material.clearcoatRoughness, 1.0 );
#endif
#ifdef USE_SHEEN
	material.sheenColor = sheen;
#endif`,lights_physical_pars_fragment:`struct PhysicalMaterial {
	vec3	diffuseColor;
	float	specularRoughness;
	vec3	specularColor;
#ifdef CLEARCOAT
	float clearcoat;
	float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	vec3 sheenColor;
#endif
};
#define MAXIMUM_SPECULAR_COEFFICIENT 0.16
#define DEFAULT_SPECULAR_COEFFICIENT 0.04
float clearcoatDHRApprox( const in float roughness, const in float dotNL ) {
	return DEFAULT_SPECULAR_COEFFICIENT + ( 1.0 - DEFAULT_SPECULAR_COEFFICIENT ) * ( pow( 1.0 - dotNL, 5.0 ) * pow( 1.0 - roughness, 2.0 ) );
}
#if NUM_RECT_AREA_LIGHTS > 0
	void RE_Direct_RectArea_Physical( const in RectAreaLight rectAreaLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
		vec3 normal = geometry.normal;
		vec3 viewDir = geometry.viewDir;
		vec3 position = geometry.position;
		vec3 lightPos = rectAreaLight.position;
		vec3 halfWidth = rectAreaLight.halfWidth;
		vec3 halfHeight = rectAreaLight.halfHeight;
		vec3 lightColor = rectAreaLight.color;
		float roughness = material.specularRoughness;
		vec3 rectCoords[ 4 ];
		rectCoords[ 0 ] = lightPos + halfWidth - halfHeight;		rectCoords[ 1 ] = lightPos - halfWidth - halfHeight;
		rectCoords[ 2 ] = lightPos - halfWidth + halfHeight;
		rectCoords[ 3 ] = lightPos + halfWidth + halfHeight;
		vec2 uv = LTC_Uv( normal, viewDir, roughness );
		vec4 t1 = texture2D( ltc_1, uv );
		vec4 t2 = texture2D( ltc_2, uv );
		mat3 mInv = mat3(
			vec3( t1.x, 0, t1.y ),
			vec3(    0, 1,    0 ),
			vec3( t1.z, 0, t1.w )
		);
		vec3 fresnel = ( material.specularColor * t2.x + ( vec3( 1.0 ) - material.specularColor ) * t2.y );
		reflectedLight.directSpecular += lightColor * fresnel * LTC_Evaluate( normal, viewDir, position, mInv, rectCoords );
		reflectedLight.directDiffuse += lightColor * material.diffuseColor * LTC_Evaluate( normal, viewDir, position, mat3( 1.0 ), rectCoords );
	}
#endif
void RE_Direct_Physical( const in IncidentLight directLight, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	float dotNL = saturate( dot( geometry.normal, directLight.direction ) );
	vec3 irradiance = dotNL * directLight.color;
	#ifndef PHYSICALLY_CORRECT_LIGHTS
		irradiance *= PI;
	#endif
	#ifdef CLEARCOAT
		float ccDotNL = saturate( dot( geometry.clearcoatNormal, directLight.direction ) );
		vec3 ccIrradiance = ccDotNL * directLight.color;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			ccIrradiance *= PI;
		#endif
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
		reflectedLight.directSpecular += ccIrradiance * material.clearcoat * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
	#else
		float clearcoatDHR = 0.0;
	#endif
	#ifdef USE_SHEEN
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_Sheen(
			material.specularRoughness,
			directLight.direction,
			geometry,
			material.sheenColor
		);
	#else
		reflectedLight.directSpecular += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Specular_GGX( directLight, geometry.viewDir, geometry.normal, material.specularColor, material.specularRoughness);
	#endif
	reflectedLight.directDiffuse += ( 1.0 - clearcoatDHR ) * irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectDiffuse_Physical( const in vec3 irradiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight ) {
	reflectedLight.indirectDiffuse += irradiance * BRDF_Diffuse_Lambert( material.diffuseColor );
}
void RE_IndirectSpecular_Physical( const in vec3 radiance, const in vec3 irradiance, const in vec3 clearcoatRadiance, const in GeometricContext geometry, const in PhysicalMaterial material, inout ReflectedLight reflectedLight) {
	#ifdef CLEARCOAT
		float ccDotNV = saturate( dot( geometry.clearcoatNormal, geometry.viewDir ) );
		reflectedLight.indirectSpecular += clearcoatRadiance * material.clearcoat * BRDF_Specular_GGX_Environment( geometry.viewDir, geometry.clearcoatNormal, vec3( DEFAULT_SPECULAR_COEFFICIENT ), material.clearcoatRoughness );
		float ccDotNL = ccDotNV;
		float clearcoatDHR = material.clearcoat * clearcoatDHRApprox( material.clearcoatRoughness, ccDotNL );
	#else
		float clearcoatDHR = 0.0;
	#endif
	float clearcoatInv = 1.0 - clearcoatDHR;
	vec3 singleScattering = vec3( 0.0 );
	vec3 multiScattering = vec3( 0.0 );
	vec3 cosineWeightedIrradiance = irradiance * RECIPROCAL_PI;
	BRDF_Specular_Multiscattering_Environment( geometry, material.specularColor, material.specularRoughness, singleScattering, multiScattering );
	vec3 diffuse = material.diffuseColor * ( 1.0 - ( singleScattering + multiScattering ) );
	reflectedLight.indirectSpecular += clearcoatInv * radiance * singleScattering;
	reflectedLight.indirectSpecular += multiScattering * cosineWeightedIrradiance;
	reflectedLight.indirectDiffuse += diffuse * cosineWeightedIrradiance;
}
#define RE_Direct				RE_Direct_Physical
#define RE_Direct_RectArea		RE_Direct_RectArea_Physical
#define RE_IndirectDiffuse		RE_IndirectDiffuse_Physical
#define RE_IndirectSpecular		RE_IndirectSpecular_Physical
float computeSpecularOcclusion( const in float dotNV, const in float ambientOcclusion, const in float roughness ) {
	return saturate( pow( dotNV + ambientOcclusion, exp2( - 16.0 * roughness - 1.0 ) ) - 1.0 + ambientOcclusion );
}`,lights_fragment_begin:`
GeometricContext geometry;
geometry.position = - vViewPosition;
geometry.normal = normal;
geometry.viewDir = ( isOrthographic ) ? vec3( 0, 0, 1 ) : normalize( vViewPosition );
#ifdef CLEARCOAT
	geometry.clearcoatNormal = clearcoatNormal;
#endif
IncidentLight directLight;
#if ( NUM_POINT_LIGHTS > 0 ) && defined( RE_Direct )
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHTS; i ++ ) {
		pointLight = pointLights[ i ];
		getPointDirectLightIrradiance( pointLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_POINT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( pointLight.shadow, directLight.visible, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_SPOT_LIGHTS > 0 ) && defined( RE_Direct )
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHTS; i ++ ) {
		spotLight = spotLights[ i ];
		getSpotDirectLightIrradiance( spotLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_SPOT_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( spotLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_DIR_LIGHTS > 0 ) && defined( RE_Direct )
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHTS; i ++ ) {
		directionalLight = directionalLights[ i ];
		getDirectionalDirectLightIrradiance( directionalLight, geometry, directLight );
		#if defined( USE_SHADOWMAP ) && ( UNROLLED_LOOP_INDEX < NUM_DIR_LIGHT_SHADOWS )
		directLight.color *= all( bvec3( directionalLight.shadow, directLight.visible, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
		#endif
		RE_Direct( directLight, geometry, material, reflectedLight );
	}
#endif
#if ( NUM_RECT_AREA_LIGHTS > 0 ) && defined( RE_Direct_RectArea )
	RectAreaLight rectAreaLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_RECT_AREA_LIGHTS; i ++ ) {
		rectAreaLight = rectAreaLights[ i ];
		RE_Direct_RectArea( rectAreaLight, geometry, material, reflectedLight );
	}
#endif
#if defined( RE_IndirectDiffuse )
	vec3 iblIrradiance = vec3( 0.0 );
	vec3 irradiance = getAmbientLightIrradiance( ambientLightColor );
	irradiance += getLightProbeIrradiance( lightProbe, geometry );
	#if ( NUM_HEMI_LIGHTS > 0 )
		#pragma unroll_loop
		for ( int i = 0; i < NUM_HEMI_LIGHTS; i ++ ) {
			irradiance += getHemisphereLightIrradiance( hemisphereLights[ i ], geometry );
		}
	#endif
#endif
#if defined( RE_IndirectSpecular )
	vec3 radiance = vec3( 0.0 );
	vec3 clearcoatRadiance = vec3( 0.0 );
#endif`,lights_fragment_maps:`#if defined( RE_IndirectDiffuse )
	#ifdef USE_LIGHTMAP
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		vec3 lightMapIrradiance = lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
		#ifndef PHYSICALLY_CORRECT_LIGHTS
			lightMapIrradiance *= PI;
		#endif
		irradiance += lightMapIrradiance;
	#endif
	#if defined( USE_ENVMAP ) && defined( STANDARD ) && defined( ENVMAP_TYPE_CUBE_UV )
		iblIrradiance += getLightProbeIndirectIrradiance( geometry, maxMipLevel );
	#endif
#endif
#if defined( USE_ENVMAP ) && defined( RE_IndirectSpecular )
	radiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.normal, material.specularRoughness, maxMipLevel );
	#ifdef CLEARCOAT
		clearcoatRadiance += getLightProbeIndirectRadiance( geometry.viewDir, geometry.clearcoatNormal, material.clearcoatRoughness, maxMipLevel );
	#endif
#endif`,lights_fragment_end:`#if defined( RE_IndirectDiffuse )
	RE_IndirectDiffuse( irradiance, geometry, material, reflectedLight );
#endif
#if defined( RE_IndirectSpecular )
	RE_IndirectSpecular( radiance, iblIrradiance, clearcoatRadiance, geometry, material, reflectedLight );
#endif`,logdepthbuf_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	gl_FragDepthEXT = vIsPerspective == 0.0 ? gl_FragCoord.z : log2( vFragDepth ) * logDepthBufFC * 0.5;
#endif`,logdepthbuf_pars_fragment:`#if defined( USE_LOGDEPTHBUF ) && defined( USE_LOGDEPTHBUF_EXT )
	uniform float logDepthBufFC;
	varying float vFragDepth;
	varying float vIsPerspective;
#endif`,logdepthbuf_pars_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		varying float vFragDepth;
		varying float vIsPerspective;
	#else
		uniform float logDepthBufFC;
	#endif
#endif`,logdepthbuf_vertex:`#ifdef USE_LOGDEPTHBUF
	#ifdef USE_LOGDEPTHBUF_EXT
		vFragDepth = 1.0 + gl_Position.w;
		vIsPerspective = float( isPerspectiveMatrix( projectionMatrix ) );
	#else
		if ( isPerspectiveMatrix( projectionMatrix ) ) {
			gl_Position.z = log2( max( EPSILON, gl_Position.w + 1.0 ) ) * logDepthBufFC - 1.0;
			gl_Position.z *= gl_Position.w;
		}
	#endif
#endif`,map_fragment:`#ifdef USE_MAP
	vec4 texelColor = texture2D( map, vUv );
	texelColor = mapTexelToLinear( texelColor );
	diffuseColor *= texelColor;
#endif`,map_pars_fragment:`#ifdef USE_MAP
	uniform sampler2D map;
#endif`,map_particle_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	vec2 uv = ( uvTransform * vec3( gl_PointCoord.x, 1.0 - gl_PointCoord.y, 1 ) ).xy;
#endif
#ifdef USE_MAP
	vec4 mapTexel = texture2D( map, uv );
	diffuseColor *= mapTexelToLinear( mapTexel );
#endif
#ifdef USE_ALPHAMAP
	diffuseColor.a *= texture2D( alphaMap, uv ).g;
#endif`,map_particle_pars_fragment:`#if defined( USE_MAP ) || defined( USE_ALPHAMAP )
	uniform mat3 uvTransform;
#endif
#ifdef USE_MAP
	uniform sampler2D map;
#endif
#ifdef USE_ALPHAMAP
	uniform sampler2D alphaMap;
#endif`,metalnessmap_fragment:`float metalnessFactor = metalness;
#ifdef USE_METALNESSMAP
	vec4 texelMetalness = texture2D( metalnessMap, vUv );
	metalnessFactor *= texelMetalness.b;
#endif`,metalnessmap_pars_fragment:`#ifdef USE_METALNESSMAP
	uniform sampler2D metalnessMap;
#endif`,morphnormal_vertex:`#ifdef USE_MORPHNORMALS
	objectNormal *= morphTargetBaseInfluence;
	objectNormal += morphNormal0 * morphTargetInfluences[ 0 ];
	objectNormal += morphNormal1 * morphTargetInfluences[ 1 ];
	objectNormal += morphNormal2 * morphTargetInfluences[ 2 ];
	objectNormal += morphNormal3 * morphTargetInfluences[ 3 ];
#endif`,morphtarget_pars_vertex:`#ifdef USE_MORPHTARGETS
	uniform float morphTargetBaseInfluence;
	#ifndef USE_MORPHNORMALS
	uniform float morphTargetInfluences[ 8 ];
	#else
	uniform float morphTargetInfluences[ 4 ];
	#endif
#endif`,morphtarget_vertex:`#ifdef USE_MORPHTARGETS
	transformed *= morphTargetBaseInfluence;
	transformed += morphTarget0 * morphTargetInfluences[ 0 ];
	transformed += morphTarget1 * morphTargetInfluences[ 1 ];
	transformed += morphTarget2 * morphTargetInfluences[ 2 ];
	transformed += morphTarget3 * morphTargetInfluences[ 3 ];
	#ifndef USE_MORPHNORMALS
	transformed += morphTarget4 * morphTargetInfluences[ 4 ];
	transformed += morphTarget5 * morphTargetInfluences[ 5 ];
	transformed += morphTarget6 * morphTargetInfluences[ 6 ];
	transformed += morphTarget7 * morphTargetInfluences[ 7 ];
	#endif
#endif`,normal_fragment_begin:`#ifdef FLAT_SHADED
	vec3 fdx = vec3( dFdx( vViewPosition.x ), dFdx( vViewPosition.y ), dFdx( vViewPosition.z ) );
	vec3 fdy = vec3( dFdy( vViewPosition.x ), dFdy( vViewPosition.y ), dFdy( vViewPosition.z ) );
	vec3 normal = normalize( cross( fdx, fdy ) );
#else
	vec3 normal = normalize( vNormal );
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	#ifdef USE_TANGENT
		vec3 tangent = normalize( vTangent );
		vec3 bitangent = normalize( vBitangent );
		#ifdef DOUBLE_SIDED
			tangent = tangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
			bitangent = bitangent * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		#endif
		#if defined( TANGENTSPACE_NORMALMAP ) || defined( USE_CLEARCOAT_NORMALMAP )
			mat3 vTBN = mat3( tangent, bitangent, normal );
		#endif
	#endif
#endif
vec3 geometryNormal = normal;`,normal_fragment_maps:`#ifdef OBJECTSPACE_NORMALMAP
	normal = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	#ifdef FLIP_SIDED
		normal = - normal;
	#endif
	#ifdef DOUBLE_SIDED
		normal = normal * ( float( gl_FrontFacing ) * 2.0 - 1.0 );
	#endif
	normal = normalize( normalMatrix * normal );
#elif defined( TANGENTSPACE_NORMALMAP )
	vec3 mapN = texture2D( normalMap, vUv ).xyz * 2.0 - 1.0;
	mapN.xy *= normalScale;
	#ifdef USE_TANGENT
		normal = normalize( vTBN * mapN );
	#else
		normal = perturbNormal2Arb( -vViewPosition, normal, mapN );
	#endif
#elif defined( USE_BUMPMAP )
	normal = perturbNormalArb( -vViewPosition, normal, dHdxy_fwd() );
#endif`,normalmap_pars_fragment:`#ifdef USE_NORMALMAP
	uniform sampler2D normalMap;
	uniform vec2 normalScale;
#endif
#ifdef OBJECTSPACE_NORMALMAP
	uniform mat3 normalMatrix;
#endif
#if ! defined ( USE_TANGENT ) && ( defined ( TANGENTSPACE_NORMALMAP ) || defined ( USE_CLEARCOAT_NORMALMAP ) )
	vec3 perturbNormal2Arb( vec3 eye_pos, vec3 surf_norm, vec3 mapN ) {
		vec3 q0 = vec3( dFdx( eye_pos.x ), dFdx( eye_pos.y ), dFdx( eye_pos.z ) );
		vec3 q1 = vec3( dFdy( eye_pos.x ), dFdy( eye_pos.y ), dFdy( eye_pos.z ) );
		vec2 st0 = dFdx( vUv.st );
		vec2 st1 = dFdy( vUv.st );
		float scale = sign( st1.t * st0.s - st0.t * st1.s );
		vec3 S = normalize( ( q0 * st1.t - q1 * st0.t ) * scale );
		vec3 T = normalize( ( - q0 * st1.s + q1 * st0.s ) * scale );
		vec3 N = normalize( surf_norm );
		mat3 tsn = mat3( S, T, N );
		mapN.xy *= ( float( gl_FrontFacing ) * 2.0 - 1.0 );
		return normalize( tsn * mapN );
	}
#endif`,clearcoat_normal_fragment_begin:`#ifdef CLEARCOAT
	vec3 clearcoatNormal = geometryNormal;
#endif`,clearcoat_normal_fragment_maps:`#ifdef USE_CLEARCOAT_NORMALMAP
	vec3 clearcoatMapN = texture2D( clearcoatNormalMap, vUv ).xyz * 2.0 - 1.0;
	clearcoatMapN.xy *= clearcoatNormalScale;
	#ifdef USE_TANGENT
		clearcoatNormal = normalize( vTBN * clearcoatMapN );
	#else
		clearcoatNormal = perturbNormal2Arb( - vViewPosition, clearcoatNormal, clearcoatMapN );
	#endif
#endif`,clearcoat_normalmap_pars_fragment:`#ifdef USE_CLEARCOAT_NORMALMAP
	uniform sampler2D clearcoatNormalMap;
	uniform vec2 clearcoatNormalScale;
#endif`,packing:`vec3 packNormalToRGB( const in vec3 normal ) {
	return normalize( normal ) * 0.5 + 0.5;
}
vec3 unpackRGBToNormal( const in vec3 rgb ) {
	return 2.0 * rgb.xyz - 1.0;
}
const float PackUpscale = 256. / 255.;const float UnpackDownscale = 255. / 256.;
const vec3 PackFactors = vec3( 256. * 256. * 256., 256. * 256.,  256. );
const vec4 UnpackFactors = UnpackDownscale / vec4( PackFactors, 1. );
const float ShiftRight8 = 1. / 256.;
vec4 packDepthToRGBA( const in float v ) {
	vec4 r = vec4( fract( v * PackFactors ), v );
	r.yzw -= r.xyz * ShiftRight8;	return r * PackUpscale;
}
float unpackRGBAToDepth( const in vec4 v ) {
	return dot( v, UnpackFactors );
}
vec4 pack2HalfToRGBA( vec2 v ) {
	vec4 r = vec4( v.x, fract( v.x * 255.0 ), v.y, fract( v.y * 255.0 ));
	return vec4( r.x - r.y / 255.0, r.y, r.z - r.w / 255.0, r.w);
}
vec2 unpackRGBATo2Half( vec4 v ) {
	return vec2( v.x + ( v.y / 255.0 ), v.z + ( v.w / 255.0 ) );
}
float viewZToOrthographicDepth( const in float viewZ, const in float near, const in float far ) {
	return ( viewZ + near ) / ( near - far );
}
float orthographicDepthToViewZ( const in float linearClipZ, const in float near, const in float far ) {
	return linearClipZ * ( near - far ) - near;
}
float viewZToPerspectiveDepth( const in float viewZ, const in float near, const in float far ) {
	return (( near + viewZ ) * far ) / (( far - near ) * viewZ );
}
float perspectiveDepthToViewZ( const in float invClipZ, const in float near, const in float far ) {
	return ( near * far ) / ( ( far - near ) * invClipZ - far );
}`,premultiplied_alpha_fragment:`#ifdef PREMULTIPLIED_ALPHA
	gl_FragColor.rgb *= gl_FragColor.a;
#endif`,project_vertex:`vec4 mvPosition = vec4( transformed, 1.0 );
#ifdef USE_INSTANCING
	mvPosition = instanceMatrix * mvPosition;
#endif
mvPosition = modelViewMatrix * mvPosition;
gl_Position = projectionMatrix * mvPosition;`,dithering_fragment:`#ifdef DITHERING
	gl_FragColor.rgb = dithering( gl_FragColor.rgb );
#endif`,dithering_pars_fragment:`#ifdef DITHERING
	vec3 dithering( vec3 color ) {
		float grid_position = rand( gl_FragCoord.xy );
		vec3 dither_shift_RGB = vec3( 0.25 / 255.0, -0.25 / 255.0, 0.25 / 255.0 );
		dither_shift_RGB = mix( 2.0 * dither_shift_RGB, -2.0 * dither_shift_RGB, grid_position );
		return color + dither_shift_RGB;
	}
#endif`,roughnessmap_fragment:`float roughnessFactor = roughness;
#ifdef USE_ROUGHNESSMAP
	vec4 texelRoughness = texture2D( roughnessMap, vUv );
	roughnessFactor *= texelRoughness.g;
#endif`,roughnessmap_pars_fragment:`#ifdef USE_ROUGHNESSMAP
	uniform sampler2D roughnessMap;
#endif`,shadowmap_pars_fragment:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform sampler2D directionalShadowMap[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform sampler2D spotShadowMap[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform sampler2D pointShadowMap[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
	float texture2DCompare( sampler2D depths, vec2 uv, float compare ) {
		return step( compare, unpackRGBAToDepth( texture2D( depths, uv ) ) );
	}
	vec2 texture2DDistribution( sampler2D shadow, vec2 uv ) {
		return unpackRGBATo2Half( texture2D( shadow, uv ) );
	}
	float VSMShadow (sampler2D shadow, vec2 uv, float compare ){
		float occlusion = 1.0;
		vec2 distribution = texture2DDistribution( shadow, uv );
		float hard_shadow = step( compare , distribution.x );
		if (hard_shadow != 1.0 ) {
			float distance = compare - distribution.x ;
			float variance = max( 0.00000, distribution.y * distribution.y );
			float softness_probability = variance / (variance + distance * distance );			softness_probability = clamp( ( softness_probability - 0.3 ) / ( 0.95 - 0.3 ), 0.0, 1.0 );			occlusion = clamp( max( hard_shadow, softness_probability ), 0.0, 1.0 );
		}
		return occlusion;
	}
	float getShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord ) {
		float shadow = 1.0;
		shadowCoord.xyz /= shadowCoord.w;
		shadowCoord.z += shadowBias;
		bvec4 inFrustumVec = bvec4 ( shadowCoord.x >= 0.0, shadowCoord.x <= 1.0, shadowCoord.y >= 0.0, shadowCoord.y <= 1.0 );
		bool inFrustum = all( inFrustumVec );
		bvec2 frustumTestVec = bvec2( inFrustum, shadowCoord.z <= 1.0 );
		bool frustumTest = all( frustumTestVec );
		if ( frustumTest ) {
		#if defined( SHADOWMAP_TYPE_PCF )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx0 = - texelSize.x * shadowRadius;
			float dy0 = - texelSize.y * shadowRadius;
			float dx1 = + texelSize.x * shadowRadius;
			float dy1 = + texelSize.y * shadowRadius;
			float dx2 = dx0 / 2.0;
			float dy2 = dy0 / 2.0;
			float dx3 = dx1 / 2.0;
			float dy3 = dy1 / 2.0;
			shadow = (
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy2 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx2, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx3, dy3 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( 0.0, dy1 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, shadowCoord.xy + vec2( dx1, dy1 ), shadowCoord.z )
			) * ( 1.0 / 17.0 );
		#elif defined( SHADOWMAP_TYPE_PCF_SOFT )
			vec2 texelSize = vec2( 1.0 ) / shadowMapSize;
			float dx = texelSize.x;
			float dy = texelSize.y;
			vec2 uv = shadowCoord.xy;
			vec2 f = fract( uv * shadowMapSize + 0.5 );
			uv -= f * texelSize;
			shadow = (
				texture2DCompare( shadowMap, uv, shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( dx, 0.0 ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + vec2( 0.0, dy ), shadowCoord.z ) +
				texture2DCompare( shadowMap, uv + texelSize, shadowCoord.z ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, 0.0 ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, 0.0 ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( -dx, dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, dy ), shadowCoord.z ),
					 f.x ) +
				mix( texture2DCompare( shadowMap, uv + vec2( 0.0, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( 0.0, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( texture2DCompare( shadowMap, uv + vec2( dx, -dy ), shadowCoord.z ), 
					 texture2DCompare( shadowMap, uv + vec2( dx, 2.0 * dy ), shadowCoord.z ),
					 f.y ) +
				mix( mix( texture2DCompare( shadowMap, uv + vec2( -dx, -dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + vec2( 2.0 * dx, -dy ), shadowCoord.z ),
						  f.x ),
					 mix( texture2DCompare( shadowMap, uv + vec2( -dx, 2.0 * dy ), shadowCoord.z ), 
						  texture2DCompare( shadowMap, uv + + vec2( 2.0 * dx, 2.0 * dy ), shadowCoord.z ),
						  f.x ),
					 f.y )
			) * ( 1.0 / 9.0 );
		#elif defined( SHADOWMAP_TYPE_VSM )
			shadow = VSMShadow( shadowMap, shadowCoord.xy, shadowCoord.z );
		#else
			shadow = texture2DCompare( shadowMap, shadowCoord.xy, shadowCoord.z );
		#endif
		}
		return shadow;
	}
	vec2 cubeToUV( vec3 v, float texelSizeY ) {
		vec3 absV = abs( v );
		float scaleToCube = 1.0 / max( absV.x, max( absV.y, absV.z ) );
		absV *= scaleToCube;
		v *= scaleToCube * ( 1.0 - 2.0 * texelSizeY );
		vec2 planar = v.xy;
		float almostATexel = 1.5 * texelSizeY;
		float almostOne = 1.0 - almostATexel;
		if ( absV.z >= almostOne ) {
			if ( v.z > 0.0 )
				planar.x = 4.0 - v.x;
		} else if ( absV.x >= almostOne ) {
			float signX = sign( v.x );
			planar.x = v.z * signX + 2.0 * signX;
		} else if ( absV.y >= almostOne ) {
			float signY = sign( v.y );
			planar.x = v.x + 2.0 * signY + 2.0;
			planar.y = v.z * signY - 2.0;
		}
		return vec2( 0.125, 0.25 ) * planar + vec2( 0.375, 0.75 );
	}
	float getPointShadow( sampler2D shadowMap, vec2 shadowMapSize, float shadowBias, float shadowRadius, vec4 shadowCoord, float shadowCameraNear, float shadowCameraFar ) {
		vec2 texelSize = vec2( 1.0 ) / ( shadowMapSize * vec2( 4.0, 2.0 ) );
		vec3 lightToPosition = shadowCoord.xyz;
		float dp = ( length( lightToPosition ) - shadowCameraNear ) / ( shadowCameraFar - shadowCameraNear );		dp += shadowBias;
		vec3 bd3D = normalize( lightToPosition );
		#if defined( SHADOWMAP_TYPE_PCF ) || defined( SHADOWMAP_TYPE_PCF_SOFT ) || defined( SHADOWMAP_TYPE_VSM )
			vec2 offset = vec2( - 1, 1 ) * shadowRadius * texelSize.y;
			return (
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yyx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxy, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.xxx, texelSize.y ), dp ) +
				texture2DCompare( shadowMap, cubeToUV( bd3D + offset.yxx, texelSize.y ), dp )
			) * ( 1.0 / 9.0 );
		#else
			return texture2DCompare( shadowMap, cubeToUV( bd3D, texelSize.y ), dp );
		#endif
	}
#endif`,shadowmap_pars_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
		uniform mat4 directionalShadowMatrix[ NUM_DIR_LIGHT_SHADOWS ];
		varying vec4 vDirectionalShadowCoord[ NUM_DIR_LIGHT_SHADOWS ];
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
		uniform mat4 spotShadowMatrix[ NUM_SPOT_LIGHT_SHADOWS ];
		varying vec4 vSpotShadowCoord[ NUM_SPOT_LIGHT_SHADOWS ];
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
		uniform mat4 pointShadowMatrix[ NUM_POINT_LIGHT_SHADOWS ];
		varying vec4 vPointShadowCoord[ NUM_POINT_LIGHT_SHADOWS ];
	#endif
#endif`,shadowmap_vertex:`#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		vDirectionalShadowCoord[ i ] = directionalShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		vSpotShadowCoord[ i ] = spotShadowMatrix[ i ] * worldPosition;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		vPointShadowCoord[ i ] = pointShadowMatrix[ i ] * worldPosition;
	}
	#endif
#endif`,shadowmask_pars_fragment:`float getShadowMask() {
	float shadow = 1.0;
	#ifdef USE_SHADOWMAP
	#if NUM_DIR_LIGHT_SHADOWS > 0
	DirectionalLight directionalLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_DIR_LIGHT_SHADOWS; i ++ ) {
		directionalLight = directionalLights[ i ];
		shadow *= all( bvec2( directionalLight.shadow, receiveShadow ) ) ? getShadow( directionalShadowMap[ i ], directionalLight.shadowMapSize, directionalLight.shadowBias, directionalLight.shadowRadius, vDirectionalShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_SPOT_LIGHT_SHADOWS > 0
	SpotLight spotLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_SPOT_LIGHT_SHADOWS; i ++ ) {
		spotLight = spotLights[ i ];
		shadow *= all( bvec2( spotLight.shadow, receiveShadow ) ) ? getShadow( spotShadowMap[ i ], spotLight.shadowMapSize, spotLight.shadowBias, spotLight.shadowRadius, vSpotShadowCoord[ i ] ) : 1.0;
	}
	#endif
	#if NUM_POINT_LIGHT_SHADOWS > 0
	PointLight pointLight;
	#pragma unroll_loop
	for ( int i = 0; i < NUM_POINT_LIGHT_SHADOWS; i ++ ) {
		pointLight = pointLights[ i ];
		shadow *= all( bvec2( pointLight.shadow, receiveShadow ) ) ? getPointShadow( pointShadowMap[ i ], pointLight.shadowMapSize, pointLight.shadowBias, pointLight.shadowRadius, vPointShadowCoord[ i ], pointLight.shadowCameraNear, pointLight.shadowCameraFar ) : 1.0;
	}
	#endif
	#endif
	return shadow;
}`,skinbase_vertex:`#ifdef USE_SKINNING
	mat4 boneMatX = getBoneMatrix( skinIndex.x );
	mat4 boneMatY = getBoneMatrix( skinIndex.y );
	mat4 boneMatZ = getBoneMatrix( skinIndex.z );
	mat4 boneMatW = getBoneMatrix( skinIndex.w );
#endif`,skinning_pars_vertex:`#ifdef USE_SKINNING
	uniform mat4 bindMatrix;
	uniform mat4 bindMatrixInverse;
	#ifdef BONE_TEXTURE
		uniform highp sampler2D boneTexture;
		uniform int boneTextureSize;
		mat4 getBoneMatrix( const in float i ) {
			float j = i * 4.0;
			float x = mod( j, float( boneTextureSize ) );
			float y = floor( j / float( boneTextureSize ) );
			float dx = 1.0 / float( boneTextureSize );
			float dy = 1.0 / float( boneTextureSize );
			y = dy * ( y + 0.5 );
			vec4 v1 = texture2D( boneTexture, vec2( dx * ( x + 0.5 ), y ) );
			vec4 v2 = texture2D( boneTexture, vec2( dx * ( x + 1.5 ), y ) );
			vec4 v3 = texture2D( boneTexture, vec2( dx * ( x + 2.5 ), y ) );
			vec4 v4 = texture2D( boneTexture, vec2( dx * ( x + 3.5 ), y ) );
			mat4 bone = mat4( v1, v2, v3, v4 );
			return bone;
		}
	#else
		uniform mat4 boneMatrices[ MAX_BONES ];
		mat4 getBoneMatrix( const in float i ) {
			mat4 bone = boneMatrices[ int(i) ];
			return bone;
		}
	#endif
#endif`,skinning_vertex:`#ifdef USE_SKINNING
	vec4 skinVertex = bindMatrix * vec4( transformed, 1.0 );
	vec4 skinned = vec4( 0.0 );
	skinned += boneMatX * skinVertex * skinWeight.x;
	skinned += boneMatY * skinVertex * skinWeight.y;
	skinned += boneMatZ * skinVertex * skinWeight.z;
	skinned += boneMatW * skinVertex * skinWeight.w;
	transformed = ( bindMatrixInverse * skinned ).xyz;
#endif`,skinnormal_vertex:`#ifdef USE_SKINNING
	mat4 skinMatrix = mat4( 0.0 );
	skinMatrix += skinWeight.x * boneMatX;
	skinMatrix += skinWeight.y * boneMatY;
	skinMatrix += skinWeight.z * boneMatZ;
	skinMatrix += skinWeight.w * boneMatW;
	skinMatrix  = bindMatrixInverse * skinMatrix * bindMatrix;
	objectNormal = vec4( skinMatrix * vec4( objectNormal, 0.0 ) ).xyz;
	#ifdef USE_TANGENT
		objectTangent = vec4( skinMatrix * vec4( objectTangent, 0.0 ) ).xyz;
	#endif
#endif`,specularmap_fragment:`float specularStrength;
#ifdef USE_SPECULARMAP
	vec4 texelSpecular = texture2D( specularMap, vUv );
	specularStrength = texelSpecular.r;
#else
	specularStrength = 1.0;
#endif`,specularmap_pars_fragment:`#ifdef USE_SPECULARMAP
	uniform sampler2D specularMap;
#endif`,tonemapping_fragment:`#if defined( TONE_MAPPING )
	gl_FragColor.rgb = toneMapping( gl_FragColor.rgb );
#endif`,tonemapping_pars_fragment:`#ifndef saturate
#define saturate(a) clamp( a, 0.0, 1.0 )
#endif
uniform float toneMappingExposure;
uniform float toneMappingWhitePoint;
vec3 LinearToneMapping( vec3 color ) {
	return toneMappingExposure * color;
}
vec3 ReinhardToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( color / ( vec3( 1.0 ) + color ) );
}
#define Uncharted2Helper( x ) max( ( ( x * ( 0.15 * x + 0.10 * 0.50 ) + 0.20 * 0.02 ) / ( x * ( 0.15 * x + 0.50 ) + 0.20 * 0.30 ) ) - 0.02 / 0.30, vec3( 0.0 ) )
vec3 Uncharted2ToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( Uncharted2Helper( color ) / Uncharted2Helper( vec3( toneMappingWhitePoint ) ) );
}
vec3 OptimizedCineonToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	color = max( vec3( 0.0 ), color - 0.004 );
	return pow( ( color * ( 6.2 * color + 0.5 ) ) / ( color * ( 6.2 * color + 1.7 ) + 0.06 ), vec3( 2.2 ) );
}
vec3 ACESFilmicToneMapping( vec3 color ) {
	color *= toneMappingExposure;
	return saturate( ( color * ( 2.51 * color + 0.03 ) ) / ( color * ( 2.43 * color + 0.59 ) + 0.14 ) );
}`,uv_pars_fragment:`#if ( defined( USE_UV ) && ! defined( UVS_VERTEX_ONLY ) )
	varying vec2 vUv;
#endif`,uv_pars_vertex:`#ifdef USE_UV
	#ifdef UVS_VERTEX_ONLY
		vec2 vUv;
	#else
		varying vec2 vUv;
	#endif
	uniform mat3 uvTransform;
#endif`,uv_vertex:`#ifdef USE_UV
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
#endif`,uv2_pars_fragment:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	varying vec2 vUv2;
#endif`,uv2_pars_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	attribute vec2 uv2;
	varying vec2 vUv2;
	uniform mat3 uv2Transform;
#endif`,uv2_vertex:`#if defined( USE_LIGHTMAP ) || defined( USE_AOMAP )
	vUv2 = ( uv2Transform * vec3( uv2, 1 ) ).xy;
#endif`,worldpos_vertex:`#if defined( USE_ENVMAP ) || defined( DISTANCE ) || defined ( USE_SHADOWMAP )
	vec4 worldPosition = vec4( transformed, 1.0 );
	#ifdef USE_INSTANCING
		worldPosition = instanceMatrix * worldPosition;
	#endif
	worldPosition = modelMatrix * worldPosition;
#endif`,background_frag:`uniform sampler2D t2D;
varying vec2 vUv;
void main() {
	vec4 texColor = texture2D( t2D, vUv );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,background_vert:`varying vec2 vUv;
uniform mat3 uvTransform;
void main() {
	vUv = ( uvTransform * vec3( uv, 1 ) ).xy;
	gl_Position = vec4( position.xy, 1.0, 1.0 );
}`,cube_frag:`#include <envmap_common_pars_fragment>
uniform float opacity;
varying vec3 vWorldDirection;
#include <cube_uv_reflection_fragment>
void main() {
	vec3 vReflect = vWorldDirection;
	#include <envmap_fragment>
	gl_FragColor = envColor;
	gl_FragColor.a *= opacity;
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,cube_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
	gl_Position.z = gl_Position.w;
}`,depth_frag:`#if DEPTH_PACKING == 3200
	uniform float opacity;
#endif
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#if DEPTH_PACKING == 3200
		diffuseColor.a = opacity;
	#endif
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <logdepthbuf_fragment>
	#if DEPTH_PACKING == 3200
		gl_FragColor = vec4( vec3( 1.0 - gl_FragCoord.z ), opacity );
	#elif DEPTH_PACKING == 3201
		gl_FragColor = packDepthToRGBA( gl_FragCoord.z );
	#endif
}`,depth_vert:`#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
}`,distanceRGBA_frag:`#define DISTANCE
uniform vec3 referencePosition;
uniform float nearDistance;
uniform float farDistance;
varying vec3 vWorldPosition;
#include <common>
#include <packing>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <clipping_planes_pars_fragment>
void main () {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( 1.0 );
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	float dist = length( vWorldPosition - referencePosition );
	dist = ( dist - nearDistance ) / ( farDistance - nearDistance );
	dist = saturate( dist );
	gl_FragColor = packDepthToRGBA( dist );
}`,distanceRGBA_vert:`#define DISTANCE
varying vec3 vWorldPosition;
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <skinbase_vertex>
	#ifdef USE_DISPLACEMENTMAP
		#include <beginnormal_vertex>
		#include <morphnormal_vertex>
		#include <skinnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	vWorldPosition = worldPosition.xyz;
}`,equirect_frag:`uniform sampler2D tEquirect;
varying vec3 vWorldDirection;
#include <common>
void main() {
	vec3 direction = normalize( vWorldDirection );
	vec2 sampleUV;
	sampleUV.y = asin( clamp( direction.y, - 1.0, 1.0 ) ) * RECIPROCAL_PI + 0.5;
	sampleUV.x = atan( direction.z, direction.x ) * RECIPROCAL_PI2 + 0.5;
	vec4 texColor = texture2D( tEquirect, sampleUV );
	gl_FragColor = mapTexelToLinear( texColor );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
}`,equirect_vert:`varying vec3 vWorldDirection;
#include <common>
void main() {
	vWorldDirection = transformDirection( position, modelMatrix );
	#include <begin_vertex>
	#include <project_vertex>
}`,linedashed_frag:`uniform vec3 diffuse;
uniform float opacity;
uniform float dashSize;
uniform float totalSize;
varying float vLineDistance;
#include <common>
#include <color_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	if ( mod( vLineDistance, totalSize ) > dashSize ) {
		discard;
	}
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <color_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,linedashed_vert:`uniform float scale;
attribute float lineDistance;
varying float vLineDistance;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	vLineDistance = scale * lineDistance;
	vec4 mvPosition = modelViewMatrix * vec4( position, 1.0 );
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`,meshbasic_frag:`uniform vec3 diffuse;
uniform float opacity;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	#ifdef USE_LIGHTMAP
	
		vec4 lightMapTexel= texture2D( lightMap, vUv2 );
		reflectedLight.indirectDiffuse += lightMapTexelToLinear( lightMapTexel ).rgb * lightMapIntensity;
	#else
		reflectedLight.indirectDiffuse += vec3( 1.0 );
	#endif
	#include <aomap_fragment>
	reflectedLight.indirectDiffuse *= diffuseColor.rgb;
	vec3 outgoingLight = reflectedLight.indirectDiffuse;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshbasic_vert:`#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <skinbase_vertex>
	#ifdef USE_ENVMAP
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <worldpos_vertex>
	#include <clipping_planes_vertex>
	#include <envmap_vertex>
	#include <fog_vertex>
}`,meshlambert_frag:`uniform vec3 diffuse;
uniform vec3 emissive;
uniform float opacity;
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <fog_pars_fragment>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <emissivemap_fragment>
	reflectedLight.indirectDiffuse = getAmbientLightIrradiance( ambientLightColor );
	#ifdef DOUBLE_SIDED
		reflectedLight.indirectDiffuse += ( gl_FrontFacing ) ? vIndirectFront : vIndirectBack;
	#else
		reflectedLight.indirectDiffuse += vIndirectFront;
	#endif
	#include <lightmap_fragment>
	reflectedLight.indirectDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb );
	#ifdef DOUBLE_SIDED
		reflectedLight.directDiffuse = ( gl_FrontFacing ) ? vLightFront : vLightBack;
	#else
		reflectedLight.directDiffuse = vLightFront;
	#endif
	reflectedLight.directDiffuse *= BRDF_Diffuse_Lambert( diffuseColor.rgb ) * getShadowMask();
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshlambert_vert:`#define LAMBERT
varying vec3 vLightFront;
varying vec3 vIndirectFront;
#ifdef DOUBLE_SIDED
	varying vec3 vLightBack;
	varying vec3 vIndirectBack;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <envmap_pars_vertex>
#include <bsdfs>
#include <lights_pars_begin>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <lights_lambert_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshmatcap_frag:`#define MATCAP
uniform vec3 diffuse;
uniform float opacity;
uniform sampler2D matcap;
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	vec3 viewDir = normalize( vViewPosition );
	vec3 x = normalize( vec3( viewDir.z, 0.0, - viewDir.x ) );
	vec3 y = cross( viewDir, x );
	vec2 uv = vec2( dot( x, normal ), dot( y, normal ) ) * 0.495 + 0.5;
	#ifdef USE_MATCAP
		vec4 matcapColor = texture2D( matcap, uv );
		matcapColor = matcapTexelToLinear( matcapColor );
	#else
		vec4 matcapColor = vec4( 1.0 );
	#endif
	vec3 outgoingLight = diffuseColor.rgb * matcapColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,meshmatcap_vert:`#define MATCAP
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
	#ifndef FLAT_SHADED
		vNormal = normalize( transformedNormal );
	#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
	vViewPosition = - mvPosition.xyz;
}`,meshtoon_frag:`#define TOON
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <gradientmap_pars_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_toon_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_toon_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshtoon_vert:`#define TOON
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphong_frag:`#define PHONG
uniform vec3 diffuse;
uniform vec3 emissive;
uniform vec3 specular;
uniform float shininess;
uniform float opacity;
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_pars_fragment>
#include <cube_uv_reflection_fragment>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <lights_phong_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <specularmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <specularmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_phong_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#include <envmap_fragment>
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphong_vert:`#define PHONG
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <envmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <envmap_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,meshphysical_frag:`#define STANDARD
#ifdef PHYSICAL
	#define REFLECTIVITY
	#define CLEARCOAT
	#define TRANSPARENCY
#endif
uniform vec3 diffuse;
uniform vec3 emissive;
uniform float roughness;
uniform float metalness;
uniform float opacity;
#ifdef TRANSPARENCY
	uniform float transparency;
#endif
#ifdef REFLECTIVITY
	uniform float reflectivity;
#endif
#ifdef CLEARCOAT
	uniform float clearcoat;
	uniform float clearcoatRoughness;
#endif
#ifdef USE_SHEEN
	uniform vec3 sheen;
#endif
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <packing>
#include <dithering_pars_fragment>
#include <color_pars_fragment>
#include <uv_pars_fragment>
#include <uv2_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <aomap_pars_fragment>
#include <lightmap_pars_fragment>
#include <emissivemap_pars_fragment>
#include <bsdfs>
#include <cube_uv_reflection_fragment>
#include <envmap_common_pars_fragment>
#include <envmap_physical_pars_fragment>
#include <fog_pars_fragment>
#include <lights_pars_begin>
#include <lights_physical_pars_fragment>
#include <shadowmap_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <clearcoat_normalmap_pars_fragment>
#include <roughnessmap_pars_fragment>
#include <metalnessmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec4 diffuseColor = vec4( diffuse, opacity );
	ReflectedLight reflectedLight = ReflectedLight( vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ), vec3( 0.0 ) );
	vec3 totalEmissiveRadiance = emissive;
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <color_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	#include <roughnessmap_fragment>
	#include <metalnessmap_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	#include <clearcoat_normal_fragment_begin>
	#include <clearcoat_normal_fragment_maps>
	#include <emissivemap_fragment>
	#include <lights_physical_fragment>
	#include <lights_fragment_begin>
	#include <lights_fragment_maps>
	#include <lights_fragment_end>
	#include <aomap_fragment>
	vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;
	#ifdef TRANSPARENCY
		diffuseColor.a *= saturate( 1. - transparency + linearToRelativeLuminance( reflectedLight.directSpecular + reflectedLight.indirectSpecular ) );
	#endif
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
	#include <dithering_fragment>
}`,meshphysical_vert:`#define STANDARD
varying vec3 vViewPosition;
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <uv2_pars_vertex>
#include <displacementmap_pars_vertex>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <shadowmap_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <uv2_vertex>
	#include <color_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	vViewPosition = - mvPosition.xyz;
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,normal_frag:`#define NORMAL
uniform float opacity;
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <packing>
#include <uv_pars_fragment>
#include <bumpmap_pars_fragment>
#include <normalmap_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	#include <logdepthbuf_fragment>
	#include <normal_fragment_begin>
	#include <normal_fragment_maps>
	gl_FragColor = vec4( packNormalToRGB( normal ), opacity );
}`,normal_vert:`#define NORMAL
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	varying vec3 vViewPosition;
#endif
#ifndef FLAT_SHADED
	varying vec3 vNormal;
	#ifdef USE_TANGENT
		varying vec3 vTangent;
		varying vec3 vBitangent;
	#endif
#endif
#include <common>
#include <uv_pars_vertex>
#include <displacementmap_pars_vertex>
#include <morphtarget_pars_vertex>
#include <skinning_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	#include <beginnormal_vertex>
	#include <morphnormal_vertex>
	#include <skinbase_vertex>
	#include <skinnormal_vertex>
	#include <defaultnormal_vertex>
#ifndef FLAT_SHADED
	vNormal = normalize( transformedNormal );
	#ifdef USE_TANGENT
		vTangent = normalize( transformedTangent );
		vBitangent = normalize( cross( vNormal, vTangent ) * tangent.w );
	#endif
#endif
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <skinning_vertex>
	#include <displacementmap_vertex>
	#include <project_vertex>
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
#if defined( FLAT_SHADED ) || defined( USE_BUMPMAP ) || defined( TANGENTSPACE_NORMALMAP )
	vViewPosition = - mvPosition.xyz;
#endif
}`,points_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <color_pars_fragment>
#include <map_particle_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_particle_fragment>
	#include <color_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
	#include <premultiplied_alpha_fragment>
}`,points_vert:`uniform float size;
uniform float scale;
#include <common>
#include <color_pars_vertex>
#include <fog_pars_vertex>
#include <morphtarget_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <color_vertex>
	#include <begin_vertex>
	#include <morphtarget_vertex>
	#include <project_vertex>
	gl_PointSize = size;
	#ifdef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) gl_PointSize *= ( scale / - mvPosition.z );
	#endif
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <worldpos_vertex>
	#include <fog_vertex>
}`,shadow_frag:`uniform vec3 color;
uniform float opacity;
#include <common>
#include <packing>
#include <fog_pars_fragment>
#include <bsdfs>
#include <lights_pars_begin>
#include <shadowmap_pars_fragment>
#include <shadowmask_pars_fragment>
void main() {
	gl_FragColor = vec4( color, opacity * ( 1.0 - getShadowMask() ) );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,shadow_vert:`#include <fog_pars_vertex>
#include <shadowmap_pars_vertex>
void main() {
	#include <begin_vertex>
	#include <project_vertex>
	#include <worldpos_vertex>
	#include <shadowmap_vertex>
	#include <fog_vertex>
}`,sprite_frag:`uniform vec3 diffuse;
uniform float opacity;
#include <common>
#include <uv_pars_fragment>
#include <map_pars_fragment>
#include <alphamap_pars_fragment>
#include <fog_pars_fragment>
#include <logdepthbuf_pars_fragment>
#include <clipping_planes_pars_fragment>
void main() {
	#include <clipping_planes_fragment>
	vec3 outgoingLight = vec3( 0.0 );
	vec4 diffuseColor = vec4( diffuse, opacity );
	#include <logdepthbuf_fragment>
	#include <map_fragment>
	#include <alphamap_fragment>
	#include <alphatest_fragment>
	outgoingLight = diffuseColor.rgb;
	gl_FragColor = vec4( outgoingLight, diffuseColor.a );
	#include <tonemapping_fragment>
	#include <encodings_fragment>
	#include <fog_fragment>
}`,sprite_vert:`uniform float rotation;
uniform vec2 center;
#include <common>
#include <uv_pars_vertex>
#include <fog_pars_vertex>
#include <logdepthbuf_pars_vertex>
#include <clipping_planes_pars_vertex>
void main() {
	#include <uv_vertex>
	vec4 mvPosition = modelViewMatrix * vec4( 0.0, 0.0, 0.0, 1.0 );
	vec2 scale;
	scale.x = length( vec3( modelMatrix[ 0 ].x, modelMatrix[ 0 ].y, modelMatrix[ 0 ].z ) );
	scale.y = length( vec3( modelMatrix[ 1 ].x, modelMatrix[ 1 ].y, modelMatrix[ 1 ].z ) );
	#ifndef USE_SIZEATTENUATION
		bool isPerspective = isPerspectiveMatrix( projectionMatrix );
		if ( isPerspective ) scale *= - mvPosition.z;
	#endif
	vec2 alignedPosition = ( position.xy - ( center - vec2( 0.5 ) ) ) * scale;
	vec2 rotatedPosition;
	rotatedPosition.x = cos( rotation ) * alignedPosition.x - sin( rotation ) * alignedPosition.y;
	rotatedPosition.y = sin( rotation ) * alignedPosition.x + cos( rotation ) * alignedPosition.y;
	mvPosition.xy += rotatedPosition;
	gl_Position = projectionMatrix * mvPosition;
	#include <logdepthbuf_vertex>
	#include <clipping_planes_vertex>
	#include <fog_vertex>
}`},Mo={basic:{uniforms:$i([gr.common,gr.specularmap,gr.envmap,gr.aomap,gr.lightmap,gr.fog]),vertexShader:Pn.meshbasic_vert,fragmentShader:Pn.meshbasic_frag},lambert:{uniforms:$i([gr.common,gr.specularmap,gr.envmap,gr.aomap,gr.lightmap,gr.emissivemap,gr.fog,gr.lights,{emissive:{value:new Qe(0)}}]),vertexShader:Pn.meshlambert_vert,fragmentShader:Pn.meshlambert_frag},phong:{uniforms:$i([gr.common,gr.specularmap,gr.envmap,gr.aomap,gr.lightmap,gr.emissivemap,gr.bumpmap,gr.normalmap,gr.displacementmap,gr.fog,gr.lights,{emissive:{value:new Qe(0)},specular:{value:new Qe(1118481)},shininess:{value:30}}]),vertexShader:Pn.meshphong_vert,fragmentShader:Pn.meshphong_frag},standard:{uniforms:$i([gr.common,gr.envmap,gr.aomap,gr.lightmap,gr.emissivemap,gr.bumpmap,gr.normalmap,gr.displacementmap,gr.roughnessmap,gr.metalnessmap,gr.fog,gr.lights,{emissive:{value:new Qe(0)},roughness:{value:.5},metalness:{value:.5},envMapIntensity:{value:1}}]),vertexShader:Pn.meshphysical_vert,fragmentShader:Pn.meshphysical_frag},toon:{uniforms:$i([gr.common,gr.specularmap,gr.aomap,gr.lightmap,gr.emissivemap,gr.bumpmap,gr.normalmap,gr.displacementmap,gr.gradientmap,gr.fog,gr.lights,{emissive:{value:new Qe(0)},specular:{value:new Qe(1118481)},shininess:{value:30}}]),vertexShader:Pn.meshtoon_vert,fragmentShader:Pn.meshtoon_frag},matcap:{uniforms:$i([gr.common,gr.bumpmap,gr.normalmap,gr.displacementmap,gr.fog,{matcap:{value:null}}]),vertexShader:Pn.meshmatcap_vert,fragmentShader:Pn.meshmatcap_frag},points:{uniforms:$i([gr.points,gr.fog]),vertexShader:Pn.points_vert,fragmentShader:Pn.points_frag},dashed:{uniforms:$i([gr.common,gr.fog,{scale:{value:1},dashSize:{value:1},totalSize:{value:2}}]),vertexShader:Pn.linedashed_vert,fragmentShader:Pn.linedashed_frag},depth:{uniforms:$i([gr.common,gr.displacementmap]),vertexShader:Pn.depth_vert,fragmentShader:Pn.depth_frag},normal:{uniforms:$i([gr.common,gr.bumpmap,gr.normalmap,gr.displacementmap,{opacity:{value:1}}]),vertexShader:Pn.normal_vert,fragmentShader:Pn.normal_frag},sprite:{uniforms:$i([gr.sprite,gr.fog]),vertexShader:Pn.sprite_vert,fragmentShader:Pn.sprite_frag},background:{uniforms:{uvTransform:{value:new Ai},t2D:{value:null}},vertexShader:Pn.background_vert,fragmentShader:Pn.background_frag},cube:{uniforms:$i([gr.envmap,{opacity:{value:1}}]),vertexShader:Pn.cube_vert,fragmentShader:Pn.cube_frag},equirect:{uniforms:{tEquirect:{value:null}},vertexShader:Pn.equirect_vert,fragmentShader:Pn.equirect_frag},distanceRGBA:{uniforms:$i([gr.common,gr.displacementmap,{referencePosition:{value:new Le},nearDistance:{value:1},farDistance:{value:1e3}}]),vertexShader:Pn.distanceRGBA_vert,fragmentShader:Pn.distanceRGBA_frag},shadow:{uniforms:$i([gr.lights,gr.fog,{color:{value:new Qe(0)},opacity:{value:1}}]),vertexShader:Pn.shadow_vert,fragmentShader:Pn.shadow_frag}};function Nn(e,t,r,i){var l,p,f=new Qe(0),w=0,L=null,V=0,Z=null;function ee(ae,W){t.buffers.color.setClear(ae.r,ae.g,ae.b,W,i)}return{getClearColor:function(){return f},setClearColor:function(ae,W){f.set(ae),ee(f,w=W!==void 0?W:1)},getClearAlpha:function(){return w},setClearAlpha:function(ae){ee(f,w=ae)},render:function(ae,W,he,ge){var ye=W.background,Ae=e.xr,je=Ae.getSession&&Ae.getSession();if(je&&je.environmentBlendMode==="additive"&&(ye=null),ye===null?ee(f,w):ye&&ye.isColor&&(ee(ye,1),ge=!0),(e.autoClear||ge)&&e.clear(e.autoClearColor,e.autoClearDepth,e.autoClearStencil),ye&&(ye.isCubeTexture||ye.isWebGLCubeRenderTarget||ye.mapping===gt)){p===void 0&&((p=new Di(new lu(1,1,1),new Xa({type:"BackgroundCubeMaterial",uniforms:Ds(Mo.cube.uniforms),vertexShader:Mo.cube.vertexShader,fragmentShader:Mo.cube.fragmentShader,side:_,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),p.geometry.deleteAttribute("uv"),p.onBeforeRender=function(et,Ge,it){this.matrixWorld.copyPosition(it.matrixWorld)},Object.defineProperty(p.material,"envMap",{get:function(){return this.uniforms.envMap.value}}),r.update(p));var He=ye.isWebGLCubeRenderTarget?ye.texture:ye;p.material.uniforms.envMap.value=He,p.material.uniforms.flipEnvMap.value=He.isCubeTexture?-1:1,L===ye&&V===He.version&&Z===e.toneMapping||(p.material.needsUpdate=!0,L=ye,V=He.version,Z=e.toneMapping),ae.unshift(p,p.geometry,p.material,0,0,null)}else ye&&ye.isTexture&&(l===void 0&&((l=new Di(new Qs(2,2),new Xa({type:"BackgroundMaterial",uniforms:Ds(Mo.background.uniforms),vertexShader:Mo.background.vertexShader,fragmentShader:Mo.background.fragmentShader,side:E,depthTest:!1,depthWrite:!1,fog:!1}))).geometry.deleteAttribute("normal"),Object.defineProperty(l.material,"map",{get:function(){return this.uniforms.t2D.value}}),r.update(l)),(l.material.uniforms.t2D.value=ye).matrixAutoUpdate===!0&&ye.updateMatrix(),l.material.uniforms.uvTransform.value.copy(ye.matrix),L===ye&&V===ye.version&&Z===e.toneMapping||(l.material.needsUpdate=!0,V=(L=ye).version,Z=e.toneMapping),ae.unshift(l,l.geometry,l.material,0,0,null))}}}function cu(e,t){return Math.abs(t[1])-Math.abs(e[1])}function Ss(e,t,r,i,l,p,f,w,L,V){Yn.call(this,e=e!==void 0?e:[],t=t!==void 0?t:Rt,r,i,l,p,f=f!==void 0?f:Sn,w,L,V),this.flipY=!1}function mc(e,t,r,i){Yn.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:i||1},this.magFilter=ct,this.minFilter=ct,this.wrapR=Or,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}function ja(e,t,r,i){Yn.call(this,null),this.image={data:e||null,width:t||1,height:r||1,depth:i||1},this.magFilter=ct,this.minFilter=ct,this.wrapR=Or,this.generateMipmaps=!1,this.flipY=!1,this.needsUpdate=!0}Mo.physical={uniforms:$i([Mo.standard.uniforms,{transparency:{value:0},clearcoat:{value:0},clearcoatRoughness:{value:0},sheen:{value:new Qe(0)},clearcoatNormalScale:{value:new Gt(1,1)},clearcoatNormalMap:{value:null}}]),vertexShader:Pn.meshphysical_vert,fragmentShader:Pn.meshphysical_frag},((Ss.prototype=Object.create(Yn.prototype)).constructor=Ss).prototype.isCubeTexture=!0,Object.defineProperty(Ss.prototype,"images",{get:function(){return this.image},set:function(e){this.image=e}}),((mc.prototype=Object.create(Yn.prototype)).constructor=mc).prototype.isDataTexture2DArray=!0,((ja.prototype=Object.create(Yn.prototype)).constructor=ja).prototype.isDataTexture3D=!0;var Gh=new Yn,gc=new mc,ch=new ja,hh=new Ss,ph=[],Ya=[],ss=new Float32Array(16),yc=new Float32Array(9),dh=new Float32Array(4);function ls(e,t,r){var i=e[0];if(i<=0||0<i)return e;var l=t*r,p=ph[l];if(p===void 0&&(p=new Float32Array(l),ph[l]=p),t!==0){i.toArray(p,0);for(var f=1,w=0;f!==t;++f)w+=r,e[f].toArray(p,w)}return p}function co(e,t){if(e.length===t.length){for(var r=0,i=e.length;r<i;r++)if(e[r]!==t[r])return;return 1}}function Na(e,t){for(var r=0,i=t.length;r<i;r++)e[r]=t[r]}function fh(e,t){var r=Ya[t];r===void 0&&(r=new Int32Array(t),Ya[t]=r);for(var i=0;i!==t;++i)r[i]=e.allocateTextureUnit();return r}function mh(e,t){var r=this.cache;r[0]!==t&&(e.uniform1f(this.addr,t),r[0]=t)}function gh(e,t){var r=this.cache;if(t.x!==void 0)r[0]===t.x&&r[1]===t.y||(e.uniform2f(this.addr,t.x,t.y),r[0]=t.x,r[1]=t.y);else{if(co(r,t))return;e.uniform2fv(this.addr,t),Na(r,t)}}function Es(e,t){var r=this.cache;if(t.x!==void 0)r[0]===t.x&&r[1]===t.y&&r[2]===t.z||(e.uniform3f(this.addr,t.x,t.y,t.z),r[0]=t.x,r[1]=t.y,r[2]=t.z);else if(t.r!==void 0)r[0]===t.r&&r[1]===t.g&&r[2]===t.b||(e.uniform3f(this.addr,t.r,t.g,t.b),r[0]=t.r,r[1]=t.g,r[2]=t.b);else{if(co(r,t))return;e.uniform3fv(this.addr,t),Na(r,t)}}function Wp(e,t){var r=this.cache;if(t.x!==void 0)r[0]===t.x&&r[1]===t.y&&r[2]===t.z&&r[3]===t.w||(e.uniform4f(this.addr,t.x,t.y,t.z,t.w),r[0]=t.x,r[1]=t.y,r[2]=t.z,r[3]=t.w);else{if(co(r,t))return;e.uniform4fv(this.addr,t),Na(r,t)}}function Os(e,t){var r=this.cache,i=t.elements;if(i===void 0){if(co(r,t))return;e.uniformMatrix2fv(this.addr,!1,t),Na(r,t)}else{if(co(r,i))return;dh.set(i),e.uniformMatrix2fv(this.addr,!1,dh),Na(r,i)}}function zh(e,t){var r=this.cache,i=t.elements;if(i===void 0){if(co(r,t))return;e.uniformMatrix3fv(this.addr,!1,t),Na(r,t)}else{if(co(r,i))return;yc.set(i),e.uniformMatrix3fv(this.addr,!1,yc),Na(r,i)}}function Uh(e,t){var r=this.cache,i=t.elements;if(i===void 0){if(co(r,t))return;e.uniformMatrix4fv(this.addr,!1,t),Na(r,t)}else{if(co(r,i))return;ss.set(i),e.uniformMatrix4fv(this.addr,!1,ss),Na(r,i)}}function yh(e,t,r){var i=this.cache,l=r.allocateTextureUnit();i[0]!==l&&(e.uniform1i(this.addr,l),i[0]=l),r.safeSetTexture2D(t||Gh,l)}function Hh(e,t,r){var i=this.cache,l=r.allocateTextureUnit();i[0]!==l&&(e.uniform1i(this.addr,l),i[0]=l),r.setTexture2DArray(t||gc,l)}function Wh(e,t,r){var i=this.cache,l=r.allocateTextureUnit();i[0]!==l&&(e.uniform1i(this.addr,l),i[0]=l),r.setTexture3D(t||ch,l)}function Jh(e,t,r){var i=this.cache,l=r.allocateTextureUnit();i[0]!==l&&(e.uniform1i(this.addr,l),i[0]=l),r.safeSetTextureCube(t||hh,l)}function qh(e,t){var r=this.cache;r[0]!==t&&(e.uniform1i(this.addr,t),r[0]=t)}function Za(e,t){var r=this.cache;co(r,t)||(e.uniform2iv(this.addr,t),Na(r,t))}function Wo(e,t){var r=this.cache;co(r,t)||(e.uniform3iv(this.addr,t),Na(r,t))}function vc(e,t){var r=this.cache;co(r,t)||(e.uniform4iv(this.addr,t),Na(r,t))}function Ll(e,t){var r=this.cache;r[0]!==t&&(e.uniform1ui(this.addr,t),r[0]=t)}function Xh(e,t){e.uniform1fv(this.addr,t)}function Yh(e,t){e.uniform1iv(this.addr,t)}function Zh(e,t){e.uniform2iv(this.addr,t)}function Il(e,t){e.uniform3iv(this.addr,t)}function hu(e,t){e.uniform4iv(this.addr,t)}function Kh(e,t){var r=ls(t,this.size,2);e.uniform2fv(this.addr,r)}function $h(e,t){var r=ls(t,this.size,3);e.uniform3fv(this.addr,r)}function xc(e,t){var r=ls(t,this.size,4);e.uniform4fv(this.addr,r)}function Qh(e,t){var r=ls(t,this.size,4);e.uniformMatrix2fv(this.addr,!1,r)}function wc(e,t){var r=ls(t,this.size,9);e.uniformMatrix3fv(this.addr,!1,r)}function vh(e,t){var r=ls(t,this.size,16);e.uniformMatrix4fv(this.addr,!1,r)}function bc(e,t,r){var i=t.length,l=fh(r,i);e.uniform1iv(this.addr,l);for(var p=0;p!==i;++p)r.safeSetTexture2D(t[p]||Gh,l[p])}function ep(e,t,r){var i=t.length,l=fh(r,i);e.uniform1iv(this.addr,l);for(var p=0;p!==i;++p)r.safeSetTextureCube(t[p]||hh,l[p])}function Mc(e,t,r){this.id=e,this.addr=r,this.cache=[],this.setValue=function(i){switch(t.type){case 5126:return mh;case 35664:return gh;case 35665:return Es;case 35666:return Wp;case 35674:return Os;case 35675:return zh;case 35676:return Uh;case 5124:case 35670:return qh;case 35667:case 35671:return Za;case 35668:case 35672:return Wo;case 35669:case 35673:return vc;case 5125:return Ll;case 35678:case 36198:case 36298:case 36306:case 35682:return yh;case 35679:case 36299:case 36307:return Wh;case 35680:case 36300:case 36308:case 36293:return Jh;case 36289:case 36303:case 36311:case 36292:return Hh}}()}function xh(e,t,r){this.id=e,this.addr=r,this.cache=[],this.size=t.size,this.setValue=function(i){switch(t.type){case 5126:return Xh;case 35664:return Kh;case 35665:return $h;case 35666:return xc;case 35674:return Qh;case 35675:return wc;case 35676:return vh;case 5124:case 35670:return Yh;case 35667:case 35671:return Zh;case 35668:case 35672:return Il;case 35669:case 35673:return hu;case 35678:case 36198:case 36298:case 36306:case 35682:return bc;case 35680:case 36300:case 36308:case 36293:return ep}}()}function _c(e){this.id=e,this.seq=[],this.map={}}xh.prototype.updateCache=function(e){var t=this.cache;e instanceof Float32Array&&t.length!==e.length&&(this.cache=new Float32Array(e.length)),Na(t,e)},_c.prototype.setValue=function(e,t,r){for(var i=this.seq,l=0,p=i.length;l!==p;++l){var f=i[l];f.setValue(e,t[f.id],r)}};var wh=/([\w\d_]+)(\])?(\[|\.)?/g;function bh(e,t){e.seq.push(t),e.map[t.id]=t}function us(e,t,r){var i=e.name,l=i.length;for(wh.lastIndex=0;;){var p=wh.exec(i),f=wh.lastIndex,w=p[1],L=p[2]==="]",V=p[3];if(L&&(w|=0),V===void 0||V==="["&&f+2===l){bh(r,new(V===void 0?Mc:xh)(w,e,t));break}var Z=r.map[w];Z===void 0&&bh(r,Z=new _c(w)),r=Z}}function cs(e,t){this.seq=[],this.map={};for(var r=e.getProgramParameter(t,35718),i=0;i<r;++i){var l=e.getActiveUniform(t,i);us(l,e.getUniformLocation(t,l.name),this)}}function Mh(e,t,r){var i=e.createShader(t);return e.shaderSource(i,r),e.compileShader(i),i}cs.prototype.setValue=function(e,t,r,i){var l=this.map[t];l!==void 0&&l.setValue(e,r,i)},cs.prototype.setOptional=function(e,t,r){var i=t[r];i!==void 0&&this.setValue(e,r,i)},cs.upload=function(e,t,r,i){for(var l=0,p=t.length;l!==p;++l){var f=t[l],w=r[f.id];w.needsUpdate!==!1&&f.setValue(e,w.value,i)}},cs.seqWithValue=function(e,t){for(var r=[],i=0,l=e.length;i!==l;++i){var p=e[i];p.id in t&&r.push(p)}return r};var Jp=0;function _h(e){switch(e){case Ke:return["Linear","( value )"];case yt:return["sRGB","( value )"];case Wt:return["RGBE","( value )"];case Br:return["RGBM","( value, 7.0 )"];case ln:return["RGBM","( value, 16.0 )"];case di:return["RGBD","( value, 256.0 )"];case Vt:return["Gamma","( value, float( GAMMA_FACTOR ) )"];case Pr:return["LogLuv","( value )"];default:throw new Error("unsupported encoding: "+e)}}function Jo(e,t,r){var i=e.getShaderParameter(t,35713),l=e.getShaderInfoLog(t).trim();return i&&l===""?"":"THREE.WebGLShader: gl.getShaderInfoLog() "+r+`
`+l+function(p){for(var f=p.split(`
`),w=0;w<f.length;w++)f[w]=w+1+": "+f[w];return f.join(`
`)}(e.getShaderSource(t))}function el(e,t){var r=_h(t);return"vec4 "+e+"( vec4 value ) { return "+r[0]+"ToLinear"+r[1]+"; }"}function tl(e){return e!==""}function Tc(e,t){return e.replace(/NUM_DIR_LIGHTS/g,t.numDirLights).replace(/NUM_SPOT_LIGHTS/g,t.numSpotLights).replace(/NUM_RECT_AREA_LIGHTS/g,t.numRectAreaLights).replace(/NUM_POINT_LIGHTS/g,t.numPointLights).replace(/NUM_HEMI_LIGHTS/g,t.numHemiLights).replace(/NUM_DIR_LIGHT_SHADOWS/g,t.numDirLightShadows).replace(/NUM_SPOT_LIGHT_SHADOWS/g,t.numSpotLightShadows).replace(/NUM_POINT_LIGHT_SHADOWS/g,t.numPointLightShadows)}function pu(e,t){return e.replace(/NUM_CLIPPING_PLANES/g,t.numClippingPlanes).replace(/UNION_CLIPPING_PLANES/g,t.numClippingPlanes-t.numClipIntersection)}var kl=/^[ \t]*#include +<([\w\d./]+)>/gm;function rn(e){return e.replace(kl,Cc)}function Cc(e,t){var r=Pn[t];if(r===void 0)throw new Error("Can not resolve #include <"+t+">");return rn(r)}var Th=/#pragma unroll_loop[\s]+?for \( int i \= (\d+)\; i < (\d+)\; i \+\+ \) \{([\s\S]+?)(?=\})\}/g;function As(e){return e.replace(Th,Ch)}function Ch(e,t,r,i){for(var l="",p=parseInt(t);p<parseInt(r);p++)l+=i.replace(/\[ i \]/g,"[ "+p+" ]").replace(/UNROLLED_LOOP_INDEX/g,p);return l}function Dh(e){var t="precision "+e.precision+` float;
precision `+e.precision+" int;";return e.precision==="highp"?t+=`
#define HIGH_PRECISION`:e.precision==="mediump"?t+=`
#define MEDIUM_PRECISION`:e.precision==="lowp"&&(t+=`
#define LOW_PRECISION`),t}function Pa(e,t,r){var i,l,p,f,w,L,V,Z=e.getContext(),ee=r.defines,ae=r.vertexShader,W=r.fragmentShader,he=(l="SHADOWMAP_TYPE_BASIC",(i=r).shadowMapType===F?l="SHADOWMAP_TYPE_PCF":i.shadowMapType===P?l="SHADOWMAP_TYPE_PCF_SOFT":i.shadowMapType===g&&(l="SHADOWMAP_TYPE_VSM"),l),ge=function(hn){var Mr="ENVMAP_TYPE_CUBE";if(hn.envMap)switch(hn.envMapMode){case Rt:case It:Mr="ENVMAP_TYPE_CUBE";break;case gt:case We:Mr="ENVMAP_TYPE_CUBE_UV";break;case Nr:case Qt:Mr="ENVMAP_TYPE_EQUIREC";break;case Ur:Mr="ENVMAP_TYPE_SPHERE"}return Mr}(r),ye=function(hn){var Mr="ENVMAP_MODE_REFLECTION";if(hn.envMap)switch(hn.envMapMode){case It:case Qt:Mr="ENVMAP_MODE_REFRACTION"}return Mr}(r),Ae=function(hn){var Mr="ENVMAP_BLENDING_NONE";if(hn.envMap)switch(hn.combine){case Ie:Mr="ENVMAP_BLENDING_MULTIPLY";break;case ue:Mr="ENVMAP_BLENDING_MIX";break;case Me:Mr="ENVMAP_BLENDING_ADD"}return Mr}(r),je=0<e.gammaFactor?e.gammaFactor:1,He=r.isWebGL2?"":[(p=r).extensionDerivatives||p.envMapCubeUV||p.bumpMap||p.tangentSpaceNormalMap||p.clearcoatNormalMap||p.flatShading||p.shaderID==="physical"?"#extension GL_OES_standard_derivatives : enable":"",(p.extensionFragDepth||p.logarithmicDepthBuffer)&&p.rendererExtensionFragDepth?"#extension GL_EXT_frag_depth : enable":"",p.extensionDrawBuffers&&p.rendererExtensionDrawBuffers?"#extension GL_EXT_draw_buffers : require":"",(p.extensionShaderTextureLOD||p.envMap)&&p.rendererExtensionShaderTextureLod?"#extension GL_EXT_shader_texture_lod : enable":""].filter(tl).join(`
`),et=function(hn){var Mr=[];for(var Ve in hn){var tt=hn[Ve];tt!==!1&&Mr.push("#define "+Ve+" "+tt)}return Mr.join(`
`)}(ee),Ge=Z.createProgram(),it=r.numMultiviewViews;if(r.isRawShaderMaterial?(0<(f=[et].filter(tl).join(`
`)).length&&(f+=`
`),0<(w=[He,et].filter(tl).join(`
`)).length&&(w+=`
`)):(f=[Dh(r),"#define SHADER_NAME "+r.shaderName,et,r.instancing?"#define USE_INSTANCING":"",r.supportsVertexTextures?"#define VERTEX_TEXTURES":"","#define GAMMA_FACTOR "+je,"#define MAX_BONES "+r.maxBones,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+ye:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.displacementMap&&r.supportsVertexTextures?"#define USE_DISPLACEMENTMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.flatShading?"#define FLAT_SHADED":"",r.skinning?"#define USE_SKINNING":"",r.useVertexTexture?"#define BONE_TEXTURE":"",r.morphTargets?"#define USE_MORPHTARGETS":"",r.morphNormals&&r.flatShading===!1?"#define USE_MORPHNORMALS":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+he:"",r.sizeAttenuation?"#define USE_SIZEATTENUATION":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"","uniform mat4 modelMatrix;","uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;","#ifdef USE_INSTANCING"," attribute mat4 instanceMatrix;","#endif","attribute vec3 position;","attribute vec3 normal;","attribute vec2 uv;","#ifdef USE_TANGENT","	attribute vec4 tangent;","#endif","#ifdef USE_COLOR","	attribute vec3 color;","#endif","#ifdef USE_MORPHTARGETS","	attribute vec3 morphTarget0;","	attribute vec3 morphTarget1;","	attribute vec3 morphTarget2;","	attribute vec3 morphTarget3;","	#ifdef USE_MORPHNORMALS","		attribute vec3 morphNormal0;","		attribute vec3 morphNormal1;","		attribute vec3 morphNormal2;","		attribute vec3 morphNormal3;","	#else","		attribute vec3 morphTarget4;","		attribute vec3 morphTarget5;","		attribute vec3 morphTarget6;","		attribute vec3 morphTarget7;","	#endif","#endif","#ifdef USE_SKINNING","	attribute vec4 skinIndex;","	attribute vec4 skinWeight;","#endif",`
`].filter(tl).join(`
`),w=[He,Dh(r),"#define SHADER_NAME "+r.shaderName,et,r.alphaTest?"#define ALPHATEST "+r.alphaTest+(r.alphaTest%1?"":".0"):"","#define GAMMA_FACTOR "+je,r.useFog&&r.fog?"#define USE_FOG":"",r.useFog&&r.fogExp2?"#define FOG_EXP2":"",r.map?"#define USE_MAP":"",r.matcap?"#define USE_MATCAP":"",r.envMap?"#define USE_ENVMAP":"",r.envMap?"#define "+ge:"",r.envMap?"#define "+ye:"",r.envMap?"#define "+Ae:"",r.lightMap?"#define USE_LIGHTMAP":"",r.aoMap?"#define USE_AOMAP":"",r.emissiveMap?"#define USE_EMISSIVEMAP":"",r.bumpMap?"#define USE_BUMPMAP":"",r.normalMap?"#define USE_NORMALMAP":"",r.normalMap&&r.objectSpaceNormalMap?"#define OBJECTSPACE_NORMALMAP":"",r.normalMap&&r.tangentSpaceNormalMap?"#define TANGENTSPACE_NORMALMAP":"",r.clearcoatNormalMap?"#define USE_CLEARCOAT_NORMALMAP":"",r.specularMap?"#define USE_SPECULARMAP":"",r.roughnessMap?"#define USE_ROUGHNESSMAP":"",r.metalnessMap?"#define USE_METALNESSMAP":"",r.alphaMap?"#define USE_ALPHAMAP":"",r.sheen?"#define USE_SHEEN":"",r.vertexTangents?"#define USE_TANGENT":"",r.vertexColors?"#define USE_COLOR":"",r.vertexUvs?"#define USE_UV":"",r.uvsVertexOnly?"#define UVS_VERTEX_ONLY":"",r.gradientMap?"#define USE_GRADIENTMAP":"",r.flatShading?"#define FLAT_SHADED":"",r.doubleSided?"#define DOUBLE_SIDED":"",r.flipSided?"#define FLIP_SIDED":"",r.shadowMapEnabled?"#define USE_SHADOWMAP":"",r.shadowMapEnabled?"#define "+he:"",r.premultipliedAlpha?"#define PREMULTIPLIED_ALPHA":"",r.physicallyCorrectLights?"#define PHYSICALLY_CORRECT_LIGHTS":"",r.logarithmicDepthBuffer?"#define USE_LOGDEPTHBUF":"",r.logarithmicDepthBuffer&&r.rendererExtensionFragDepth?"#define USE_LOGDEPTHBUF_EXT":"",(r.extensionShaderTextureLOD||r.envMap)&&r.rendererExtensionShaderTextureLod?"#define TEXTURE_LOD_EXT":"","uniform mat4 viewMatrix;","uniform vec3 cameraPosition;","uniform bool isOrthographic;",r.toneMapping!==Je?"#define TONE_MAPPING":"",r.toneMapping!==Je?Pn.tonemapping_pars_fragment:"",r.toneMapping!==Je?function(hn,Mr){var Ve;switch(Mr){case $e:Ve="Linear";break;case ft:Ve="Reinhard";break;case Pt:Ve="Uncharted2";break;case _t:Ve="OptimizedCineon";break;case Ue:Ve="ACESFilmic";break;default:throw new Error("unsupported toneMapping: "+Mr)}return"vec3 toneMapping( vec3 color ) { return "+Ve+"ToneMapping( color ); }"}(0,r.toneMapping):"",r.dithering?"#define DITHERING":"",r.outputEncoding||r.mapEncoding||r.matcapEncoding||r.envMapEncoding||r.emissiveMapEncoding||r.lightMapEncoding?Pn.encodings_pars_fragment:"",r.mapEncoding?el("mapTexelToLinear",r.mapEncoding):"",r.matcapEncoding?el("matcapTexelToLinear",r.matcapEncoding):"",r.envMapEncoding?el("envMapTexelToLinear",r.envMapEncoding):"",r.emissiveMapEncoding?el("emissiveMapTexelToLinear",r.emissiveMapEncoding):"",r.lightMapEncoding?el("lightMapTexelToLinear",r.lightMapEncoding):"",r.outputEncoding?(L=r.outputEncoding,V=_h(L),"vec4 linearToOutputTexel( vec4 value ) { return LinearTo"+V[0]+V[1]+"; }"):"",r.depthPacking?"#define DEPTH_PACKING "+r.depthPacking:"",`
`].filter(tl).join(`
`)),ae=pu(ae=Tc(ae=rn(ae),r),r),W=pu(W=Tc(W=rn(W),r),r),ae=As(ae),W=As(W),r.isWebGL2&&!r.isRawShaderMaterial){var qe=!1,vt=/^\s*#version\s+300\s+es\s*\n/;r.isShaderMaterial&&ae.match(vt)!==null&&W.match(vt)!==null&&(qe=!0,ae=ae.replace(vt,""),W=W.replace(vt,"")),f=[`#version 300 es
`,"#define attribute in","#define varying out","#define texture2D texture"].join(`
`)+`
`+f,w=[`#version 300 es
`,"#define varying in",qe?"":"out highp vec4 pc_fragColor;",qe?"":"#define gl_FragColor pc_fragColor","#define gl_FragDepthEXT gl_FragDepth","#define texture2D texture","#define textureCube texture","#define texture2DProj textureProj","#define texture2DLodEXT textureLod","#define texture2DProjLodEXT textureProjLod","#define textureCubeLodEXT textureLod","#define texture2DGradEXT textureGrad","#define texture2DProjGradEXT textureProjGrad","#define textureCubeGradEXT textureGrad"].join(`
`)+`
`+w,0<it&&(f=(f=f.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","layout(num_views = "+it+") in;","#define VIEW_ID gl_ViewID_OVR"].join(`
`))).replace(["uniform mat4 modelViewMatrix;","uniform mat4 projectionMatrix;","uniform mat4 viewMatrix;","uniform mat3 normalMatrix;"].join(`
`),["uniform mat4 modelViewMatrices["+it+"];","uniform mat4 projectionMatrices["+it+"];","uniform mat4 viewMatrices["+it+"];","uniform mat3 normalMatrices["+it+"];","#define modelViewMatrix modelViewMatrices[VIEW_ID]","#define projectionMatrix projectionMatrices[VIEW_ID]","#define viewMatrix viewMatrices[VIEW_ID]","#define normalMatrix normalMatrices[VIEW_ID]"].join(`
`)),w=(w=w.replace(`#version 300 es
`,[`#version 300 es
`,"#extension GL_OVR_multiview2 : require","#define VIEW_ID gl_ViewID_OVR"].join(`
`))).replace("uniform mat4 viewMatrix;",["uniform mat4 viewMatrices["+it+"];","#define viewMatrix viewMatrices[VIEW_ID]"].join(`
`)))}var Tt,Et,Ot=w+W,Bt=Mh(Z,35633,f+ae),Xt=Mh(Z,35632,Ot);if(Z.attachShader(Ge,Bt),Z.attachShader(Ge,Xt),r.index0AttributeName!==void 0?Z.bindAttribLocation(Ge,0,r.index0AttributeName):r.morphTargets===!0&&Z.bindAttribLocation(Ge,0,"position"),Z.linkProgram(Ge),e.debug.checkShaderErrors){var Dt=Z.getProgramInfoLog(Ge).trim(),Mt=Z.getShaderInfoLog(Bt).trim(),lr=Z.getShaderInfoLog(Xt).trim(),yr=!0,$r=!0;if(Z.getProgramParameter(Ge,35714)===!1){yr=!1;var Xr=Jo(Z,Bt,"vertex"),Vr=Jo(Z,Xt,"fragment");console.error("THREE.WebGLProgram: shader error: ",Z.getError(),"35715",Z.getProgramParameter(Ge,35715),"gl.getProgramInfoLog",Dt,Xr,Vr)}else Dt!==""?console.warn("THREE.WebGLProgram: gl.getProgramInfoLog()",Dt):Mt!==""&&lr!==""||($r=!1);$r&&(this.diagnostics={runnable:yr,programLog:Dt,vertexShader:{log:Mt,prefix:f},fragmentShader:{log:lr,prefix:w}})}return Z.deleteShader(Bt),Z.deleteShader(Xt),this.getUniforms=function(){return Tt===void 0&&(Tt=new cs(Z,Ge)),Tt},this.getAttributes=function(){return Et===void 0&&(Et=function(hn,Mr){for(var Ve={},tt=hn.getProgramParameter(Mr,35721),Jt=0;Jt<tt;Jt++){var Ut=hn.getActiveAttrib(Mr,Jt).name;Ve[Ut]=hn.getAttribLocation(Mr,Ut)}return Ve}(Z,Ge)),Et},this.destroy=function(){Z.deleteProgram(Ge),this.program=void 0},this.name=r.shaderName,this.id=Jp++,this.cacheKey=t,this.usedTimes=1,this.program=Ge,this.vertexShader=Bt,this.fragmentShader=Xt,this.numMultiviewViews=it,this}function tp(e,t,r){var i=[],l=r.isWebGL2,p=r.logarithmicDepthBuffer,f=r.floatVertexTextures,w=r.precision,L=r.maxVertexUniforms,V=r.vertexTextures,Z={MeshDepthMaterial:"depth",MeshDistanceMaterial:"distanceRGBA",MeshNormalMaterial:"normal",MeshBasicMaterial:"basic",MeshLambertMaterial:"lambert",MeshPhongMaterial:"phong",MeshToonMaterial:"toon",MeshStandardMaterial:"physical",MeshPhysicalMaterial:"physical",MeshMatcapMaterial:"matcap",LineBasicMaterial:"basic",LineDashedMaterial:"dashed",PointsMaterial:"points",ShadowMaterial:"shadow",SpriteMaterial:"sprite"},ee=["precision","isWebGL2","supportsVertexTextures","outputEncoding","instancing","numMultiviewViews","map","mapEncoding","matcap","matcapEncoding","envMap","envMapMode","envMapEncoding","envMapCubeUV","lightMap","lightMapEncoding","aoMap","emissiveMap","emissiveMapEncoding","bumpMap","normalMap","objectSpaceNormalMap","tangentSpaceNormalMap","clearcoatNormalMap","displacementMap","specularMap","roughnessMap","metalnessMap","gradientMap","alphaMap","combine","vertexColors","vertexTangents","vertexUvs","uvsVertexOnly","fog","useFog","fogExp2","flatShading","sizeAttenuation","logarithmicDepthBuffer","skinning","maxBones","useVertexTexture","morphTargets","morphNormals","maxMorphTargets","maxMorphNormals","premultipliedAlpha","numDirLights","numPointLights","numSpotLights","numHemiLights","numRectAreaLights","numDirLightShadows","numPointLightShadows","numSpotLightShadows","shadowMapEnabled","shadowMapType","toneMapping","physicallyCorrectLights","alphaTest","doubleSided","flipSided","numClippingPlanes","numClipIntersection","depthPacking","dithering","sheen"];function ae(W){var he;return W?W.isTexture?he=W.encoding:W.isWebGLRenderTarget&&(console.warn("THREE.WebGLPrograms.getTextureEncodingFromMap: don't use render targets as textures. Use their .texture property instead."),he=W.texture.encoding):he=Ke,he}this.getParameters=function(W,he,ge,ye,Ae,je,He){var et=ye.fog,Ge=W.isMeshStandardMaterial?ye.environment:null,it=W.envMap||Ge,qe=Z[W.type],vt=He.isSkinnedMesh?function(Bt){var Xt=He.skeleton.bones;if(f)return 1024;var Dt=L,Mt=Math.floor((Dt-20)/4),lr=Math.min(Mt,Xt.length);return lr<Xt.length?(console.warn("THREE.WebGLRenderer: Skeleton has "+Xt.length+" bones. This GPU supports "+lr+"."),0):lr}():0;W.precision!==null&&(w=r.getMaxPrecision(W.precision))!==W.precision&&console.warn("THREE.WebGLProgram.getParameters:",W.precision,"not supported, using",w,"instead.");var Tt=function(Bt,Xt){var Dt;if(qe){var Mt=Mo[qe];Dt={name:Bt.type,uniforms:sh.clone(Mt.uniforms),vertexShader:Mt.vertexShader,fragmentShader:Mt.fragmentShader}}else Dt={name:Bt.type,uniforms:Bt.uniforms,vertexShader:Bt.vertexShader,fragmentShader:Bt.fragmentShader};return Dt}(W);W.onBeforeCompile(Tt,e);var Et=e.getRenderTarget(),Ot=Et&&Et.isWebGLMultiviewRenderTarget?Et.numViews:0;return{isWebGL2:l,shaderID:qe,shaderName:Tt.name,uniforms:Tt.uniforms,vertexShader:Tt.vertexShader,fragmentShader:Tt.fragmentShader,defines:W.defines,isRawShaderMaterial:W.isRawShaderMaterial,isShaderMaterial:W.isShaderMaterial,precision:w,instancing:He.isInstancedMesh===!0,supportsVertexTextures:V,numMultiviewViews:Ot,outputEncoding:Et!==null?ae(Et.texture):e.outputEncoding,map:!!W.map,mapEncoding:ae(W.map),matcap:!!W.matcap,matcapEncoding:ae(W.matcap),envMap:!!it,envMapMode:it&&it.mapping,envMapEncoding:ae(it),envMapCubeUV:!!it&&(it.mapping===gt||it.mapping===We),lightMap:!!W.lightMap,lightMapEncoding:ae(W.lightMap),aoMap:!!W.aoMap,emissiveMap:!!W.emissiveMap,emissiveMapEncoding:ae(W.emissiveMap),bumpMap:!!W.bumpMap,normalMap:!!W.normalMap,objectSpaceNormalMap:W.normalMapType===So,tangentSpaceNormalMap:W.normalMapType===xo,clearcoatNormalMap:!!W.clearcoatNormalMap,displacementMap:!!W.displacementMap,roughnessMap:!!W.roughnessMap,metalnessMap:!!W.metalnessMap,specularMap:!!W.specularMap,alphaMap:!!W.alphaMap,gradientMap:!!W.gradientMap,sheen:!!W.sheen,combine:W.combine,vertexTangents:W.normalMap&&W.vertexTangents,vertexColors:W.vertexColors,vertexUvs:!!(W.map||W.bumpMap||W.normalMap||W.specularMap||W.alphaMap||W.emissiveMap||W.roughnessMap||W.metalnessMap||W.clearcoatNormalMap||W.displacementMap),uvsVertexOnly:!(W.map||W.bumpMap||W.normalMap||W.specularMap||W.alphaMap||W.emissiveMap||W.roughnessMap||W.metalnessMap||W.clearcoatNormalMap||!W.displacementMap),fog:!!et,useFog:W.fog,fogExp2:et&&et.isFogExp2,flatShading:W.flatShading,sizeAttenuation:W.sizeAttenuation,logarithmicDepthBuffer:p,skinning:W.skinning&&0<vt,maxBones:vt,useVertexTexture:f,morphTargets:W.morphTargets,morphNormals:W.morphNormals,maxMorphTargets:e.maxMorphTargets,maxMorphNormals:e.maxMorphNormals,numDirLights:he.directional.length,numPointLights:he.point.length,numSpotLights:he.spot.length,numRectAreaLights:he.rectArea.length,numHemiLights:he.hemi.length,numDirLightShadows:he.directionalShadowMap.length,numPointLightShadows:he.pointShadowMap.length,numSpotLightShadows:he.spotShadowMap.length,numClippingPlanes:Ae,numClipIntersection:je,dithering:W.dithering,shadowMapEnabled:e.shadowMap.enabled&&0<ge.length,shadowMapType:e.shadowMap.type,toneMapping:W.toneMapped?e.toneMapping:Je,physicallyCorrectLights:e.physicallyCorrectLights,premultipliedAlpha:W.premultipliedAlpha,alphaTest:W.alphaTest,doubleSided:W.side===k,flipSided:W.side===_,depthPacking:W.depthPacking!==void 0&&W.depthPacking,index0AttributeName:W.index0AttributeName,extensionDerivatives:W.extensions&&W.extensions.derivatives,extensionFragDepth:W.extensions&&W.extensions.frawbuffers,extensionDrawbuffers:W.extensions&&W.extensions.drawbuffers,extensionShaderTextureLOD:W.extensions&&W.extensions.shaderTextureLOD,rendererExtensionFragDepth:l||t.get("EXT_frag_depth")!==null,rendererExtensionDrawBuffers:l||t.get("WEBGL_draw_buffers")!==null,rendererExtensionShaderTextureLod:l||t.get("EXT_shader_texture_lod")!==null,onBeforeCompile:W.onBeforeCompile}},this.getProgramCacheKey=function(W){var he=[];if(W.shaderID?he.push(W.shaderID):(he.push(W.fragmentShader),he.push(W.vertexShader)),W.defines!==void 0)for(var ge in W.defines)he.push(ge),he.push(W.defines[ge]);if(W.isRawShaderMaterial===void 0){for(var ye=0;ye<ee.length;ye++)he.push(W[ee[ye]]);he.push(e.outputEncoding),he.push(e.gammaFactor)}return he.push(W.onBeforeCompile.toString()),he.join()},this.acquireProgram=function(W,he){for(var ge,ye=0,Ae=i.length;ye<Ae;ye++){var je=i[ye];if(je.cacheKey===he){++(ge=je).usedTimes;break}}return ge===void 0&&(ge=new Pa(e,he,W),i.push(ge)),ge},this.releaseProgram=function(W){if(--W.usedTimes==0){var he=i.indexOf(W);i[he]=i[i.length-1],i.pop(),W.destroy()}},this.programs=i}function rp(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.program!==t.program?e.program.id-t.program.id:e.material.id!==t.material.id?e.material.id-t.material.id:e.z!==t.z?e.z-t.z:e.id-t.id}function qp(e,t){return e.groupOrder!==t.groupOrder?e.groupOrder-t.groupOrder:e.renderOrder!==t.renderOrder?e.renderOrder-t.renderOrder:e.z!==t.z?t.z-e.z:e.id-t.id}function qo(){var e=[],t=0,r=[],i=[],l={id:-1};function p(f,w,L,V,Z,ee){var ae=e[t];return ae===void 0?(ae={id:f.id,object:f,geometry:w,material:L,program:L.program||l,groupOrder:V,renderOrder:f.renderOrder,z:Z,group:ee},e[t]=ae):(ae.id=f.id,ae.object=f,ae.geometry=w,ae.material=L,ae.program=L.program||l,ae.groupOrder=V,ae.renderOrder=f.renderOrder,ae.z=Z,ae.group=ee),t++,ae}return{opaque:r,transparent:i,init:function(){t=0,r.length=0,i.length=0},push:function(f,w,L,V,Z,ee){var ae=p(f,w,L,V,Z,ee);(L.transparent===!0?i:r).push(ae)},unshift:function(f,w,L,V,Z,ee){var ae=p(f,w,L,V,Z,ee);(L.transparent===!0?i:r).unshift(ae)},sort:function(f,w){1<r.length&&r.sort(f||rp),1<i.length&&i.sort(w||qp)}}}var Va=0;function Sh(e,t){return(t.castShadow?1:0)-(e.castShadow?1:0)}function Eh(){for(var e=new function(){var f={};return{get:function(w){if(f[w.id]!==void 0)return f[w.id];var L;switch(w.type){case"DirectionalLight":L={direction:new Le,color:new Qe,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Gt};break;case"SpotLight":L={position:new Le,direction:new Le,color:new Qe,distance:0,coneCos:0,penumbraCos:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Gt};break;case"PointLight":L={position:new Le,color:new Qe,distance:0,decay:0,shadow:!1,shadowBias:0,shadowRadius:1,shadowMapSize:new Gt,shadowCameraNear:1,shadowCameraFar:1e3};break;case"HemisphereLight":L={direction:new Le,skyColor:new Qe,groundColor:new Qe};break;case"RectAreaLight":L={color:new Qe,position:new Le,halfWidth:new Le,halfHeight:new Le}}return f[w.id]=L}}},t={version:0,hash:{directionalLength:-1,pointLength:-1,spotLength:-1,rectAreaLength:-1,hemiLength:-1,numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},ambient:[0,0,0],probe:[],directional:[],directionalShadowMap:[],directionalShadowMatrix:[],spot:[],spotShadowMap:[],spotShadowMatrix:[],rectArea:[],point:[],pointShadowMap:[],pointShadowMatrix:[],hemi:[],numDirectionalShadows:-1,numPointShadows:-1,numSpotShadows:-1},r=0;r<9;r++)t.probe.push(new Le);var i=new Le,l=new mn,p=new mn;return{setup:function(f,w,L){for(var V=0,Z=0,ee=0,ae=0;ae<9;ae++)t.probe[ae].set(0,0,0);var W=0,he=0,ge=0,ye=0,Ae=0,je=0,He=0,et=0,Ge=L.matrixWorldInverse;f.sort(Sh),ae=0;for(var it=f.length;ae<it;ae++){var qe=f[ae],vt=qe.color,Tt=qe.intensity,Et=qe.distance,Ot=qe.shadow&&qe.shadow.map?qe.shadow.map.texture:null;if(qe.isAmbientLight)V+=vt.r*Tt,Z+=vt.g*Tt,ee+=vt.b*Tt;else if(qe.isLightProbe)for(var Bt=0;Bt<9;Bt++)t.probe[Bt].addScaledVector(qe.sh.coefficients[Bt],Tt);else if(qe.isDirectionalLight){if((Dt=e.get(qe)).color.copy(qe.color).multiplyScalar(qe.intensity),Dt.direction.setFromMatrixPosition(qe.matrixWorld),i.setFromMatrixPosition(qe.target.matrixWorld),Dt.direction.sub(i),Dt.direction.transformDirection(Ge),Dt.shadow=qe.castShadow,qe.castShadow){var Xt=qe.shadow;Dt.shadowBias=Xt.bias,Dt.shadowRadius=Xt.radius,Dt.shadowMapSize=Xt.mapSize,t.directionalShadowMap[W]=Ot,t.directionalShadowMatrix[W]=qe.shadow.matrix,je++}t.directional[W]=Dt,W++}else if(qe.isSpotLight)(Dt=e.get(qe)).position.setFromMatrixPosition(qe.matrixWorld),Dt.position.applyMatrix4(Ge),Dt.color.copy(vt).multiplyScalar(Tt),Dt.distance=Et,Dt.direction.setFromMatrixPosition(qe.matrixWorld),i.setFromMatrixPosition(qe.target.matrixWorld),Dt.direction.sub(i),Dt.direction.transformDirection(Ge),Dt.coneCos=Math.cos(qe.angle),Dt.penumbraCos=Math.cos(qe.angle*(1-qe.penumbra)),Dt.decay=qe.decay,Dt.shadow=qe.castShadow,qe.castShadow&&(Xt=qe.shadow,Dt.shadowBias=Xt.bias,Dt.shadowRadius=Xt.radius,Dt.shadowMapSize=Xt.mapSize,t.spotShadowMap[ge]=Ot,t.spotShadowMatrix[ge]=qe.shadow.matrix,et++),t.spot[ge]=Dt,ge++;else if(qe.isRectAreaLight)(Dt=e.get(qe)).color.copy(vt).multiplyScalar(Tt),Dt.position.setFromMatrixPosition(qe.matrixWorld),Dt.position.applyMatrix4(Ge),p.identity(),l.copy(qe.matrixWorld),l.premultiply(Ge),p.extractRotation(l),Dt.halfWidth.set(.5*qe.width,0,0),Dt.halfHeight.set(0,.5*qe.height,0),Dt.halfWidth.applyMatrix4(p),Dt.halfHeight.applyMatrix4(p),t.rectArea[ye]=Dt,ye++;else if(qe.isPointLight)(Dt=e.get(qe)).position.setFromMatrixPosition(qe.matrixWorld),Dt.position.applyMatrix4(Ge),Dt.color.copy(qe.color).multiplyScalar(qe.intensity),Dt.distance=qe.distance,Dt.decay=qe.decay,Dt.shadow=qe.castShadow,qe.castShadow&&(Xt=qe.shadow,Dt.shadowBias=Xt.bias,Dt.shadowRadius=Xt.radius,Dt.shadowMapSize=Xt.mapSize,Dt.shadowCameraNear=Xt.camera.near,Dt.shadowCameraFar=Xt.camera.far,t.pointShadowMap[he]=Ot,t.pointShadowMatrix[he]=qe.shadow.matrix,He++),t.point[he]=Dt,he++;else if(qe.isHemisphereLight){var Dt;(Dt=e.get(qe)).direction.setFromMatrixPosition(qe.matrixWorld),Dt.direction.transformDirection(Ge),Dt.direction.normalize(),Dt.skyColor.copy(qe.color).multiplyScalar(Tt),Dt.groundColor.copy(qe.groundColor).multiplyScalar(Tt),t.hemi[Ae]=Dt,Ae++}}t.ambient[0]=V,t.ambient[1]=Z,t.ambient[2]=ee;var Mt=t.hash;Mt.directionalLength===W&&Mt.pointLength===he&&Mt.spotLength===ge&&Mt.rectAreaLength===ye&&Mt.hemiLength===Ae&&Mt.numDirectionalShadows===je&&Mt.numPointShadows===He&&Mt.numSpotShadows===et||(t.directional.length=W,t.spot.length=ge,t.rectArea.length=ye,t.point.length=he,t.hemi.length=Ae,t.directionalShadowMap.length=je,t.pointShadowMap.length=He,t.spotShadowMap.length=et,t.directionalShadowMatrix.length=je,t.pointShadowMatrix.length=He,t.spotShadowMatrix.length=et,Mt.directionalLength=W,Mt.pointLength=he,Mt.spotLength=ge,Mt.rectAreaLength=ye,Mt.hemiLength=Ae,Mt.numDirectionalShadows=je,Mt.numPointShadows=He,Mt.numSpotShadows=et,t.version=Va++)},state:t}}function np(){var e=new Eh,t=[],r=[];return{init:function(){t.length=0,r.length=0},state:{lightsArray:t,shadowsArray:r,lights:e},setupLights:function(i){e.setup(t,r,i)},pushLight:function(i){t.push(i)},pushShadow:function(i){r.push(i)}}}function Xo(e){kt.call(this),this.type="MeshDepthMaterial",this.depthPacking=ao,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.setValues(e)}function rl(e){kt.call(this),this.type="MeshDistanceMaterial",this.referencePosition=new Le,this.nearDistance=1,this.farDistance=1e3,this.skinning=!1,this.morphTargets=!1,this.map=null,this.alphaMap=null,this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.fog=!1,this.setValues(e)}((Xo.prototype=Object.create(kt.prototype)).constructor=Xo).prototype.isMeshDepthMaterial=!0,Xo.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.depthPacking=e.depthPacking,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this},((rl.prototype=Object.create(kt.prototype)).constructor=rl).prototype.isMeshDistanceMaterial=!0,rl.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.referencePosition.copy(e.referencePosition),this.nearDistance=e.nearDistance,this.farDistance=e.farDistance,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.map=e.map,this.alphaMap=e.alphaMap,this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this};var ip=`uniform sampler2D shadow_pass;
uniform vec2 resolution;
uniform float radius;
#include <packing>
void main() {
  float mean = 0.0;
  float squared_mean = 0.0;
	float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy  ) / resolution ) );
  for ( float i = -1.0; i < 1.0 ; i += SAMPLE_RATE) {
    #ifdef HORIZONAL_PASS
      vec2 distribution = unpackRGBATo2Half( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( i, 0.0 ) * radius ) / resolution ) );
      mean += distribution.x;
      squared_mean += distribution.y * distribution.y + distribution.x * distribution.x;
    #else
      float depth = unpackRGBAToDepth( texture2D( shadow_pass, ( gl_FragCoord.xy + vec2( 0.0,  i )  * radius ) / resolution ) );
      mean += depth;
      squared_mean += depth * depth;
    #endif
  }
  mean = mean * HALF_SAMPLE_RATE;
  squared_mean = squared_mean * HALF_SAMPLE_RATE;
  float std_dev = sqrt( squared_mean - mean * mean );
  gl_FragColor = pack2HalfToRGBA( vec2( mean, std_dev ) );
}`,ap=`void main() {
	gl_Position = vec4( position, 1.0 );
}`;function Oh(e,t,r){var i=new $s,l=new Gt,p=new Gt,f=new qn,w=[],L=[],V={},Z={0:_,1:E,2:k},ee=new Xa({defines:{SAMPLE_RATE:.25,HALF_SAMPLE_RATE:1/8},uniforms:{shadow_pass:{value:null},resolution:{value:new Gt},radius:{value:4}},vertexShader:ap,fragmentShader:ip}),ae=ee.clone();ae.defines.HORIZONAL_PASS=1;var W=new br;W.setAttribute("position",new Kt(new Float32Array([-1,-1,.5,3,-1,.5,-1,3,.5]),3));var he=new Di(W,ee),ge=this;function ye(Ge,it){var qe=t.update(he);ee.uniforms.shadow_pass.value=Ge.map.texture,ee.uniforms.resolution.value=Ge.mapSize,ee.uniforms.radius.value=Ge.radius,e.setRenderTarget(Ge.mapPass),e.clear(),e.renderBufferDirect(it,null,qe,ee,he,null),ae.uniforms.shadow_pass.value=Ge.mapPass.texture,ae.uniforms.resolution.value=Ge.mapSize,ae.uniforms.radius.value=Ge.radius,e.setRenderTarget(Ge.map),e.clear(),e.renderBufferDirect(it,null,qe,ae,he,null)}function Ae(Ge,it,qe){var vt=Ge<<0|it<<1|qe<<2,Tt=w[vt];return Tt===void 0&&(Tt=new Xo({depthPacking:Oi,morphTargets:Ge,skinning:it}),w[vt]=Tt),Tt}function je(Ge,it,qe){var vt=Ge<<0|it<<1|qe<<2,Tt=L[vt];return Tt===void 0&&(Tt=new rl({morphTargets:Ge,skinning:it}),L[vt]=Tt),Tt}function He(Ge,it,qe,vt,Tt,Et){var Ot=Ge.geometry,Bt=null,Xt=Ae,Dt=Ge.customDepthMaterial;if(qe.isPointLight===!0&&(Xt=je,Dt=Ge.customDistanceMaterial),Dt===void 0){var Mt=!1;it.morphTargets===!0&&(Ot.isBufferGeometry===!0?Mt=Ot.morphAttributes&&Ot.morphAttributes.position&&0<Ot.morphAttributes.position.length:Ot.isGeometry===!0&&(Mt=Ot.morphTargets&&0<Ot.morphTargets.length));var lr=!1;Ge.isSkinnedMesh===!0&&(it.skinning===!0?lr=!0:console.warn("THREE.WebGLShadowMap: THREE.SkinnedMesh with material.skinning set to false:",Ge)),Bt=Xt(Mt,lr,Ge.isInstancedMesh===!0)}else Bt=Dt;if(e.localClippingEnabled&&it.clipShadows===!0&&it.clippingPlanes.length!==0){var yr=Bt.uuid,$r=it.uuid,Xr=V[yr];Xr===void 0&&(Xr={},V[yr]=Xr);var Vr=Xr[$r];Vr===void 0&&(Vr=Bt.clone(),Xr[$r]=Vr),Bt=Vr}return Bt.visible=it.visible,Bt.wireframe=it.wireframe,Bt.side=Et===g?it.shadowSide!==null?it.shadowSide:it.side:it.shadowSide!==null?it.shadowSide:Z[it.side],Bt.clipShadows=it.clipShadows,Bt.clippingPlanes=it.clippingPlanes,Bt.clipIntersection=it.clipIntersection,Bt.wireframeLinewidth=it.wireframeLinewidth,Bt.linewidth=it.linewidth,qe.isPointLight===!0&&Bt.isMeshDistanceMaterial===!0&&(Bt.referencePosition.setFromMatrixPosition(qe.matrixWorld),Bt.nearDistance=vt,Bt.farDistance=Tt),Bt}function et(Ge,it,qe,vt,Tt){if(Ge.visible!==!1){if(Ge.layers.test(it.layers)&&(Ge.isMesh||Ge.isLine||Ge.isPoints)&&(Ge.castShadow||Ge.receiveShadow&&Tt===g)&&(!Ge.frustumCulled||i.intersectsObject(Ge))){Ge.modelViewMatrix.multiplyMatrices(qe.matrixWorldInverse,Ge.matrixWorld);var Et=t.update(Ge),Ot=Ge.material;if(Array.isArray(Ot))for(var Bt=Et.groups,Xt=0,Dt=Bt.length;Xt<Dt;Xt++){var Mt=Bt[Xt],lr=Ot[Mt.materialIndex];if(lr&&lr.visible){var yr=He(Ge,lr,vt,qe.near,qe.far,Tt);e.renderBufferDirect(qe,null,Et,yr,Ge,Mt)}}else Ot.visible&&(yr=He(Ge,Ot,vt,qe.near,qe.far,Tt),e.renderBufferDirect(qe,null,Et,yr,Ge,null))}for(var $r=Ge.children,Xr=0,Vr=$r.length;Xr<Vr;Xr++)et($r[Xr],it,qe,vt,Tt)}}this.enabled=!1,this.autoUpdate=!0,this.needsUpdate=!1,this.type=F,this.render=function(Ge,it,qe){if(ge.enabled!==!1&&(ge.autoUpdate!==!1||ge.needsUpdate!==!1)&&Ge.length!==0){var vt=e.getRenderTarget(),Tt=e.getActiveCubeFace(),Et=e.getActiveMipmapLevel(),Ot=e.state;Ot.setBlending(C),Ot.buffers.color.setClear(1,1,1,1),Ot.buffers.depth.setTest(!0),Ot.setScissorTest(!1);for(var Bt=0,Xt=Ge.length;Bt<Xt;Bt++){var Dt=Ge[Bt],Mt=Dt.shadow;if(Mt!==void 0){l.copy(Mt.mapSize);var lr=Mt.getFrameExtents();if(l.multiply(lr),p.copy(Mt.mapSize),(l.x>r||l.y>r)&&(console.warn("THREE.WebGLShadowMap:",Dt,"has shadow exceeding max texture size, reducing"),l.x>r&&(p.x=Math.floor(r/lr.x),l.x=p.x*lr.x,Mt.mapSize.x=p.x),l.y>r&&(p.y=Math.floor(r/lr.y),l.y=p.y*lr.y,Mt.mapSize.y=p.y)),Mt.map===null&&!Mt.isPointLightShadow&&this.type===g){var yr={minFilter:Tr,magFilter:Tr,format:Tn};Mt.map=new Yi(l.x,l.y,yr),Mt.map.texture.name=Dt.name+".shadowMap",Mt.mapPass=new Yi(l.x,l.y,yr),Mt.camera.updateProjectionMatrix()}Mt.map===null&&(yr={minFilter:ct,magFilter:ct,format:Tn},Mt.map=new Yi(l.x,l.y,yr),Mt.map.texture.name=Dt.name+".shadowMap",Mt.camera.updateProjectionMatrix()),e.setRenderTarget(Mt.map),e.clear();for(var $r=Mt.getViewportCount(),Xr=0;Xr<$r;Xr++){var Vr=Mt.getViewport(Xr);f.set(p.x*Vr.x,p.y*Vr.y,p.x*Vr.z,p.y*Vr.w),Ot.viewport(f),Mt.updateMatrices(Dt,Xr),i=Mt.getFrustum(),et(it,qe,Mt.camera,Dt,this.type)}Mt.isPointLightShadow||this.type!==g||ye(Mt,qe)}else console.warn("THREE.WebGLShadowMap:",Dt,"has no shadow.")}ge.needsUpdate=!1,e.setRenderTarget(vt,Tt,Et)}}}function Ah(e,t,r){var i=r.isWebGL2,l=new function(){var pt=!1,vr=new qn,xr=null,on=new qn(0,0,0,0);return{setMask:function(or){xr===or||pt||(e.colorMask(or,or,or,or),xr=or)},setLocked:function(or){pt=or},setClear:function(or,Mn,Ln,wi,mo){mo===!0&&(or*=wi,Mn*=wi,Ln*=wi),vr.set(or,Mn,Ln,wi),on.equals(vr)===!1&&(e.clearColor(or,Mn,Ln,wi),on.copy(vr))},reset:function(){pt=!1,xr=null,on.set(-1,0,0,0)}}},p=new function(){var pt=!1,vr=null,xr=null,on=null;return{setTest:function(or){(or?Mr:Ve)(2929)},setMask:function(or){vr===or||pt||(e.depthMask(or),vr=or)},setFunc:function(or){if(xr!==or){if(or)switch(or){case Be:e.depthFunc(512);break;case re:e.depthFunc(519);break;case fe:e.depthFunc(513);break;case ne:e.depthFunc(515);break;case le:e.depthFunc(514);break;case Re:e.depthFunc(518);break;case at:e.depthFunc(516);break;case ze:e.depthFunc(517);break;default:e.depthFunc(515)}else e.depthFunc(515);xr=or}},setLocked:function(or){pt=or},setClear:function(or){on!==or&&(e.clearDepth(or),on=or)},reset:function(){pt=!1,on=xr=vr=null}}},f=new function(){var pt=!1,vr=null,xr=null,on=null,or=null,Mn=null,Ln=null,wi=null,mo=null;return{setTest:function(Bn){pt||(Bn?Mr:Ve)(2960)},setMask:function(Bn){vr===Bn||pt||(e.stencilMask(Bn),vr=Bn)},setFunc:function(Bn,Ri,Vn){xr===Bn&&on===Ri&&or===Vn||(e.stencilFunc(Bn,Ri,Vn),xr=Bn,on=Ri,or=Vn)},setOp:function(Bn,Ri,Vn){Mn===Bn&&Ln===Ri&&wi===Vn||(e.stencilOp(Bn,Ri,Vn),Mn=Bn,Ln=Ri,wi=Vn)},setLocked:function(Bn){pt=Bn},setClear:function(Bn){mo!==Bn&&(e.clearStencil(Bn),mo=Bn)},reset:function(){pt=!1,mo=wi=Ln=Mn=or=on=xr=vr=null}}},w=e.getParameter(34921),L=new Uint8Array(w),V=new Uint8Array(w),Z=new Uint8Array(w),ee={},ae=null,W=null,he=null,ge=null,ye=null,Ae=null,je=null,He=null,et=null,Ge=!1,it=null,qe=null,vt=null,Tt=null,Et=null,Ot=e.getParameter(35661),Bt=!1,Xt=0,Dt=e.getParameter(7938);Dt.indexOf("WebGL")!==-1?(Xt=parseFloat(/^WebGL\ ([0-9])/.exec(Dt)[1]),Bt=1<=Xt):Dt.indexOf("OpenGL ES")!==-1&&(Xt=parseFloat(/^OpenGL\ ES\ ([0-9])/.exec(Dt)[1]),Bt=2<=Xt);var Mt=null,lr={},yr=new qn,$r=new qn;function Xr(pt,vr,xr){var on=new Uint8Array(4),or=e.createTexture();e.bindTexture(pt,or),e.texParameteri(pt,10241,9728),e.texParameteri(pt,10240,9728);for(var Mn=0;Mn<xr;Mn++)e.texImage2D(vr+Mn,0,6408,1,1,0,6408,5121,on);return or}var Vr={};function hn(pt,vr){L[pt]=1,V[pt]===0&&(e.enableVertexAttribArray(pt),V[pt]=1),Z[pt]!==vr&&((i?e:t.get("ANGLE_instanced_arrays"))[i?"vertexAttribDivisor":"vertexAttribDivisorANGLE"](pt,vr),Z[pt]=vr)}function Mr(pt){ee[pt]!==!0&&(e.enable(pt),ee[pt]=!0)}function Ve(pt){ee[pt]!==!1&&(e.disable(pt),ee[pt]=!1)}Vr[3553]=Xr(3553,3553,1),Vr[34067]=Xr(34067,34069,6),l.setClear(0,0,0,1),p.setClear(1),f.setClear(0),Mr(2929),p.setFunc(ne),_r(!1),St(A),Mr(2884),nn(C);var tt={};if(tt[D]=32774,tt[N]=32778,tt[I]=32779,i)tt[h]=32775,tt[u]=32776;else{var Jt=t.get("EXT_blend_minmax");Jt!==null&&(tt[h]=Jt.MIN_EXT,tt[u]=Jt.MAX_EXT)}var Ut={};function nn(pt,vr,xr,on,or,Mn,Ln,wi){if(pt!==C){if(W||(Mr(3042),W=!0),pt===B)or=or||vr,Mn=Mn||xr,Ln=Ln||on,vr===ge&&or===je||(e.blendEquationSeparate(tt[vr],tt[or]),ge=vr,je=or),xr===ye&&on===Ae&&Mn===He&&Ln===et||(e.blendFuncSeparate(Ut[xr],Ut[on],Ut[Mn],Ut[Ln]),ye=xr,Ae=on,He=Mn,et=Ln),he=pt,Ge=null;else if(pt!==he||wi!==Ge){if(ge===D&&je===D||(e.blendEquation(32774),je=ge=D),wi)switch(pt){case S:e.blendFuncSeparate(1,771,1,771);break;case Y:e.blendFunc(1,1);break;case G:e.blendFuncSeparate(0,0,769,771);break;case T:e.blendFuncSeparate(0,768,0,770);break;default:console.error("THREE.WebGLState: Invalid blending: ",pt)}else switch(pt){case S:e.blendFuncSeparate(770,771,1,771);break;case Y:e.blendFunc(770,1);break;case G:e.blendFunc(0,769);break;case T:e.blendFunc(0,768);break;default:console.error("THREE.WebGLState: Invalid blending: ",pt)}et=He=Ae=ye=null,he=pt,Ge=wi}}else W&&(Ve(3042),W=!1)}function _r(pt){it!==pt&&(pt?e.frontFace(2304):e.frontFace(2305),it=pt)}function St(pt){pt!==x?(Mr(2884),pt!==qe&&(pt===A?e.cullFace(1029):pt===H?e.cullFace(1028):e.cullFace(1032))):Ve(2884),qe=pt}function Dr(pt,vr,xr){pt?(Mr(32823),Tt===vr&&Et===xr||(e.polygonOffset(vr,xr),Tt=vr,Et=xr)):Ve(32823)}function pn(pt){pt===void 0&&(pt=33984+Ot-1),Mt!==pt&&(e.activeTexture(pt),Mt=pt)}return Ut[v]=0,Ut[M]=1,Ut[j]=768,Ut[J]=770,Ut[we]=776,Ut[ve]=774,Ut[X]=772,Ut[z]=769,Ut[te]=771,Ut[Ee]=775,Ut[se]=773,{buffers:{color:l,depth:p,stencil:f},initAttributes:function(){for(var pt=0,vr=L.length;pt<vr;pt++)L[pt]=0},enableAttribute:function(pt){hn(pt,0)},enableAttributeAndDivisor:hn,disableUnusedAttributes:function(){for(var pt=0,vr=V.length;pt!==vr;++pt)V[pt]!==L[pt]&&(e.disableVertexAttribArray(pt),V[pt]=0)},enable:Mr,disable:Ve,useProgram:function(pt){return ae!==pt&&(e.useProgram(pt),ae=pt,!0)},setBlending:nn,setMaterial:function(pt,vr){(pt.side===k?Ve:Mr)(2884);var xr=pt.side===_;vr&&(xr=!xr),_r(xr),pt.blending===S&&pt.transparent===!1?nn(C):nn(pt.blending,pt.blendEquation,pt.blendSrc,pt.blendDst,pt.blendEquationAlpha,pt.blendSrcAlpha,pt.blendDstAlpha,pt.premultipliedAlpha),p.setFunc(pt.depthFunc),p.setTest(pt.depthTest),p.setMask(pt.depthWrite),l.setMask(pt.colorWrite);var on=pt.stencilWrite;f.setTest(on),on&&(f.setMask(pt.stencilWriteMask),f.setFunc(pt.stencilFunc,pt.stencilRef,pt.stencilFuncMask),f.setOp(pt.stencilFail,pt.stencilZFail,pt.stencilZPass)),Dr(pt.polygonOffset,pt.polygonOffsetFactor,pt.polygonOffsetUnits)},setFlipSided:_r,setCullFace:St,setLineWidth:function(pt){pt!==vt&&(Bt&&e.lineWidth(pt),vt=pt)},setPolygonOffset:Dr,setScissorTest:function(pt){(pt?Mr:Ve)(3089)},activeTexture:pn,bindTexture:function(pt,vr){Mt===null&&pn();var xr=lr[Mt];xr===void 0&&(xr={type:void 0,texture:void 0},lr[Mt]=xr),xr.type===pt&&xr.texture===vr||(e.bindTexture(pt,vr||Vr[pt]),xr.type=pt,xr.texture=vr)},unbindTexture:function(){var pt=lr[Mt];pt!==void 0&&pt.type!==void 0&&(e.bindTexture(pt.type,null),pt.type=void 0,pt.texture=void 0)},compressedTexImage2D:function(){try{e.compressedTexImage2D.apply(e,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texImage2D:function(){try{e.texImage2D.apply(e,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},texImage3D:function(){try{e.texImage3D.apply(e,arguments)}catch(pt){console.error("THREE.WebGLState:",pt)}},scissor:function(pt){yr.equals(pt)===!1&&(e.scissor(pt.x,pt.y,pt.z,pt.w),yr.copy(pt))},viewport:function(pt){$r.equals(pt)===!1&&(e.viewport(pt.x,pt.y,pt.z,pt.w),$r.copy(pt))},reset:function(){for(var pt=0;pt<V.length;pt++)V[pt]===1&&(e.disableVertexAttribArray(pt),V[pt]=0);ee={},lr={},qe=it=he=ae=Mt=null,l.reset(),p.reset(),f.reset()}}}function op(e,t,r,i,l,p,f){var w,L=l.isWebGL2,V=l.maxTextures,Z=l.maxCubemapSize,ee=l.maxTextureSize,ae=l.maxSamples,W=new WeakMap,he=!1;try{he=typeof OffscreenCanvas<"u"&&new OffscreenCanvas(1,1).getContext("2d")!==null}catch{}function ge(Ve,tt){return he?new OffscreenCanvas(Ve,tt):document.createElementNS("http://www.w3.org/1999/xhtml","canvas")}function ye(Ve,tt,Jt,Ut){var nn=1;if((Ve.width>Ut||Ve.height>Ut)&&(nn=Ut/Math.max(Ve.width,Ve.height)),nn<1||tt===!0){if(typeof HTMLImageElement<"u"&&Ve instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&Ve instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&Ve instanceof ImageBitmap){var _r=tt?xn.floorPowerOfTwo:Math.floor,St=_r(nn*Ve.width),Dr=_r(nn*Ve.height);w===void 0&&(w=ge(St,Dr));var pn=Jt?ge(St,Dr):w;return pn.width=St,pn.height=Dr,pn.getContext("2d").drawImage(Ve,0,0,St,Dr),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+Ve.width+"x"+Ve.height+") to ("+St+"x"+Dr+")."),pn}return"data"in Ve&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+Ve.width+"x"+Ve.height+")."),Ve}return Ve}function Ae(Ve){return xn.isPowerOfTwo(Ve.width)&&xn.isPowerOfTwo(Ve.height)}function je(Ve,tt){return Ve.generateMipmaps&&tt&&Ve.minFilter!==ct&&Ve.minFilter!==Tr}function He(Ve,tt,Jt,Ut){e.generateMipmap(Ve),i.get(tt).__maxMipLevel=Math.log(Math.max(Jt,Ut))*Math.LOG2E}function et(Ve,tt,Jt){if(L===!1)return tt;if(Ve!==null){if(e[Ve]!==void 0)return e[Ve];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+Ve+"'")}var Ut=tt;return tt===6403&&(Jt===5126&&(Ut=33326),Jt===5131&&(Ut=33325),Jt===5121&&(Ut=33321)),tt===6407&&(Jt===5126&&(Ut=34837),Jt===5131&&(Ut=34843),Jt===5121&&(Ut=32849)),tt===6408&&(Jt===5126&&(Ut=34836),Jt===5131&&(Ut=34842),Jt===5121&&(Ut=32856)),Ut===33325||Ut===33326||Ut===34842||Ut===34836?t.get("EXT_color_buffer_float"):Ut!==34843&&Ut!==34837||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),Ut}function Ge(Ve){return Ve===ct||Ve===st||Ve===qt?9728:9729}function it(Ve){var tt=Ve.target;tt.removeEventListener("dispose",it),function(Jt){var Ut=i.get(Jt);Ut.__webglInit!==void 0&&(e.deleteTexture(Ut.__webglTexture),i.remove(Jt))}(tt),tt.isVideoTexture&&W.delete(tt),f.memory.textures--}function qe(Ve){var tt=Ve.target;tt.removeEventListener("dispose",qe),function(Jt){var Ut=i.get(Jt),nn=i.get(Jt.texture);if(Jt){if(nn.__webglTexture!==void 0&&e.deleteTexture(nn.__webglTexture),Jt.depthTexture&&Jt.depthTexture.dispose(),Jt.isWebGLCubeRenderTarget)for(var _r=0;_r<6;_r++)e.deleteFramebuffer(Ut.__webglFramebuffer[_r]),Ut.__webglDepthbuffer&&e.deleteRenderbuffer(Ut.__webglDepthbuffer[_r]);else e.deleteFramebuffer(Ut.__webglFramebuffer),Ut.__webglDepthbuffer&&e.deleteRenderbuffer(Ut.__webglDepthbuffer);if(Jt.isWebGLMultiviewRenderTarget){e.deleteTexture(Ut.__webglColorTexture),e.deleteTexture(Ut.__webglDepthStencilTexture),f.memory.textures-=2,_r=0;for(var St=Ut.__webglViewFramebuffers.length;_r<St;_r++)e.deleteFramebuffer(Ut.__webglViewFramebuffers[_r])}i.remove(Jt.texture),i.remove(Jt)}}(tt),f.memory.textures--}var vt=0;function Tt(Ve,tt){var Jt,Ut,nn=i.get(Ve);if(Ve.isVideoTexture&&(Jt=Ve,Ut=f.render.frame,W.get(Jt)!==Ut&&(W.set(Jt,Ut),Jt.update())),0<Ve.version&&nn.__version!==Ve.version){var _r=Ve.image;if(_r===void 0)console.warn("THREE.WebGLRenderer: Texture marked for update but image is undefined");else{if(_r.complete!==!1)return void lr(nn,Ve,tt);console.warn("THREE.WebGLRenderer: Texture marked for update but image is incomplete")}}r.activeTexture(33984+tt),r.bindTexture(3553,nn.__webglTexture)}function Et(Ve,tt){if(Ve.image.length===6){var Jt=i.get(Ve);if(0<Ve.version&&Jt.__version!==Ve.version){Mt(Jt,Ve),r.activeTexture(33984+tt),r.bindTexture(34067,Jt.__webglTexture),e.pixelStorei(37440,Ve.flipY);for(var Ut=Ve&&(Ve.isCompressedTexture||Ve.image[0].isCompressedTexture),nn=Ve.image[0]&&Ve.image[0].isDataTexture,_r=[],St=0;St<6;St++)_r[St]=Ut||nn?nn?Ve.image[St].image:Ve.image[St]:ye(Ve.image[St],!1,!0,Z);var Dr,pn=_r[0],pt=Ae(pn)||L,vr=p.convert(Ve.format),xr=p.convert(Ve.type),on=et(Ve.internalFormat,vr,xr);if(Dt(34067,Ve,pt),Ut){for(St=0;St<6;St++){Dr=_r[St].mipmaps;for(var or=0;or<Dr.length;or++){var Mn=Dr[or];Ve.format!==Tn&&Ve.format!==Sn?vr!==null?r.compressedTexImage2D(34069+St,or,on,Mn.width,Mn.height,0,Mn.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .setTextureCube()"):r.texImage2D(34069+St,or,on,Mn.width,Mn.height,0,vr,xr,Mn.data)}}Jt.__maxMipLevel=Dr.length-1}else{for(Dr=Ve.mipmaps,St=0;St<6;St++)if(nn)for(r.texImage2D(34069+St,0,on,_r[St].width,_r[St].height,0,vr,xr,_r[St].data),or=0;or<Dr.length;or++){var Ln=(Mn=Dr[or]).image[St].image;r.texImage2D(34069+St,or+1,on,Ln.width,Ln.height,0,vr,xr,Ln.data)}else for(r.texImage2D(34069+St,0,on,vr,xr,_r[St]),or=0;or<Dr.length;or++)Mn=Dr[or],r.texImage2D(34069+St,or+1,on,vr,xr,Mn.image[St]);Jt.__maxMipLevel=Dr.length}je(Ve,pt)&&He(34067,Ve,pn.width,pn.height),Jt.__version=Ve.version,Ve.onUpdate&&Ve.onUpdate(Ve)}else r.activeTexture(33984+tt),r.bindTexture(34067,Jt.__webglTexture)}}function Ot(Ve,tt){r.activeTexture(33984+tt),r.bindTexture(34067,i.get(Ve).__webglTexture)}var Bt={};Bt[Yt]=10497,Bt[Or]=33071,Bt[Yr]=33648;var Xt={};function Dt(Ve,tt,Jt){Jt?(e.texParameteri(Ve,10242,Bt[tt.wrapS]),e.texParameteri(Ve,10243,Bt[tt.wrapT]),Ve!==32879&&Ve!==35866||e.texParameteri(Ve,32882,Bt[tt.wrapR]),e.texParameteri(Ve,10240,Xt[tt.magFilter]),e.texParameteri(Ve,10241,Xt[tt.minFilter])):(e.texParameteri(Ve,10242,33071),e.texParameteri(Ve,10243,33071),Ve!==32879&&Ve!==35866||e.texParameteri(Ve,32882,33071),tt.wrapS===Or&&tt.wrapT===Or||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),e.texParameteri(Ve,10240,Ge(tt.magFilter)),e.texParameteri(Ve,10241,Ge(tt.minFilter)),tt.minFilter!==ct&&tt.minFilter!==Tr&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."));var Ut=t.get("EXT_texture_filter_anisotropic");if(Ut){if(tt.type===ke&&t.get("OES_texture_float_linear")===null||tt.type===bt&&(L||t.get("OES_texture_half_float_linear"))===null)return;(1<tt.anisotropy||i.get(tt).__currentAnisotropy)&&(e.texParameterf(Ve,Ut.TEXTURE_MAX_ANISOTROPY_EXT,Math.min(tt.anisotropy,l.getMaxAnisotropy())),i.get(tt).__currentAnisotropy=tt.anisotropy)}}function Mt(Ve,tt){Ve.__webglInit===void 0&&(Ve.__webglInit=!0,tt.addEventListener("dispose",it),Ve.__webglTexture=e.createTexture(),f.memory.textures++)}function lr(Ve,tt,Jt){var Ut=3553;tt.isDataTexture2DArray&&(Ut=35866),tt.isDataTexture3D&&(Ut=32879),Mt(Ve,tt),r.activeTexture(33984+Jt),r.bindTexture(Ut,Ve.__webglTexture),e.pixelStorei(37440,tt.flipY),e.pixelStorei(37441,tt.premultiplyAlpha),e.pixelStorei(3317,tt.unpackAlignment);var nn,_r=(nn=tt,!L&&(nn.wrapS!==Or||nn.wrapT!==Or||nn.minFilter!==ct&&nn.minFilter!==Tr)&&Ae(tt.image)===!1),St=ye(tt.image,_r,!1,ee),Dr=Ae(St)||L,pn=p.convert(tt.format),pt=p.convert(tt.type),vr=et(tt.internalFormat,pn,pt);Dt(Ut,tt,Dr);var xr,on=tt.mipmaps;if(tt.isDepthTexture){if(vr=6402,tt.type===ke){if(L===!1)throw new Error("Float Depth Texture only supported in WebGL2.0");vr=36012}else L&&(vr=33189);tt.format===an&&vr===6402&&tt.type!==Gn&&tt.type!==xe&&(console.warn("THREE.WebGLRenderer: Use UnsignedShortType or UnsignedIntType for DepthFormat DepthTexture."),tt.type=Gn,pt=p.convert(tt.type)),tt.format===Mi&&(vr=34041,tt.type!==Kr&&(console.warn("THREE.WebGLRenderer: Use UnsignedInt248Type for DepthStencilFormat DepthTexture."),tt.type=Kr,pt=p.convert(tt.type))),r.texImage2D(3553,0,vr,St.width,St.height,0,pn,pt,null)}else if(tt.isDataTexture)if(0<on.length&&Dr){for(var or=0,Mn=on.length;or<Mn;or++)xr=on[or],r.texImage2D(3553,or,vr,xr.width,xr.height,0,pn,pt,xr.data);tt.generateMipmaps=!1,Ve.__maxMipLevel=on.length-1}else r.texImage2D(3553,0,vr,St.width,St.height,0,pn,pt,St.data),Ve.__maxMipLevel=0;else if(tt.isCompressedTexture){for(or=0,Mn=on.length;or<Mn;or++)xr=on[or],tt.format!==Tn&&tt.format!==Sn?pn!==null?r.compressedTexImage2D(3553,or,vr,xr.width,xr.height,0,xr.data):console.warn("THREE.WebGLRenderer: Attempt to load unsupported compressed texture format in .uploadTexture()"):r.texImage2D(3553,or,vr,xr.width,xr.height,0,pn,pt,xr.data);Ve.__maxMipLevel=on.length-1}else if(tt.isDataTexture2DArray)r.texImage3D(35866,0,vr,St.width,St.height,St.depth,0,pn,pt,St.data),Ve.__maxMipLevel=0;else if(tt.isDataTexture3D)r.texImage3D(32879,0,vr,St.width,St.height,St.depth,0,pn,pt,St.data),Ve.__maxMipLevel=0;else if(0<on.length&&Dr){for(or=0,Mn=on.length;or<Mn;or++)xr=on[or],r.texImage2D(3553,or,vr,pn,pt,xr);tt.generateMipmaps=!1,Ve.__maxMipLevel=on.length-1}else r.texImage2D(3553,0,vr,pn,pt,St),Ve.__maxMipLevel=0;je(tt,Dr)&&He(Ut,tt,St.width,St.height),Ve.__version=tt.version,tt.onUpdate&&tt.onUpdate(tt)}function yr(Ve,tt,Jt,Ut){var nn=p.convert(tt.texture.format),_r=p.convert(tt.texture.type),St=et(tt.texture.internalFormat,nn,_r);r.texImage2D(Ut,0,St,tt.width,tt.height,0,nn,_r,null),e.bindFramebuffer(36160,Ve),e.framebufferTexture2D(36160,Jt,Ut,i.get(tt.texture).__webglTexture,0),e.bindFramebuffer(36160,null)}function $r(Ve,tt,Jt){if(e.bindRenderbuffer(36161,Ve),tt.depthBuffer&&!tt.stencilBuffer){if(Jt){var Ut=Vr(tt);e.renderbufferStorageMultisample(36161,Ut,33189,tt.width,tt.height)}else e.renderbufferStorage(36161,33189,tt.width,tt.height);e.framebufferRenderbuffer(36160,36096,36161,Ve)}else if(tt.depthBuffer&&tt.stencilBuffer)Jt?(Ut=Vr(tt),e.renderbufferStorageMultisample(36161,Ut,35056,tt.width,tt.height)):e.renderbufferStorage(36161,34041,tt.width,tt.height),e.framebufferRenderbuffer(36160,33306,36161,Ve);else{var nn=p.convert(tt.texture.format),_r=p.convert(tt.texture.type),St=et(tt.texture.internalFormat,nn,_r);Jt?(Ut=Vr(tt),e.renderbufferStorageMultisample(36161,Ut,St,tt.width,tt.height)):e.renderbufferStorage(36161,St,tt.width,tt.height)}e.bindRenderbuffer(36161,null)}function Xr(Ve){var tt=i.get(Ve),Jt=Ve.isWebGLCubeRenderTarget===!0;if(Ve.depthTexture){if(Jt)throw new Error("target.depthTexture not supported in Cube render targets");(function(nn,_r){if(_r&&_r.isWebGLCubeRenderTarget)throw new Error("Depth Texture with cube render targets is not supported");if(e.bindFramebuffer(36160,nn),!_r.depthTexture||!_r.depthTexture.isDepthTexture)throw new Error("renderTarget.depthTexture must be an instance of THREE.DepthTexture");i.get(_r.depthTexture).__webglTexture&&_r.depthTexture.image.width===_r.width&&_r.depthTexture.image.height===_r.height||(_r.depthTexture.image.width=_r.width,_r.depthTexture.image.height=_r.height,_r.depthTexture.needsUpdate=!0),Tt(_r.depthTexture,0);var St=i.get(_r.depthTexture).__webglTexture;if(_r.depthTexture.format===an)e.framebufferTexture2D(36160,36096,3553,St,0);else{if(_r.depthTexture.format!==Mi)throw new Error("Unknown depthTexture format");e.framebufferTexture2D(36160,33306,3553,St,0)}})(tt.__webglFramebuffer,Ve)}else if(Jt){tt.__webglDepthbuffer=[];for(var Ut=0;Ut<6;Ut++)e.bindFramebuffer(36160,tt.__webglFramebuffer[Ut]),tt.__webglDepthbuffer[Ut]=e.createRenderbuffer(),$r(tt.__webglDepthbuffer[Ut],Ve)}else e.bindFramebuffer(36160,tt.__webglFramebuffer),tt.__webglDepthbuffer=e.createRenderbuffer(),$r(tt.__webglDepthbuffer,Ve);e.bindFramebuffer(36160,null)}function Vr(Ve){return L&&Ve.isWebGLMultisampleRenderTarget?Math.min(ae,Ve.samples):0}Xt[ct]=9728,Xt[st]=9984,Xt[qt]=9986,Xt[Tr]=9729,Xt[ir]=9985;var hn=!(Xt[Hr]=9987),Mr=!1;this.allocateTextureUnit=function(){var Ve=vt;return V<=Ve&&console.warn("THREE.WebGLTextures: Trying to use "+Ve+" texture units while this GPU supports only "+V),vt+=1,Ve},this.resetTextureUnits=function(){vt=0},this.setTexture2D=Tt,this.setTexture2DArray=function(Ve,tt){var Jt=i.get(Ve);0<Ve.version&&Jt.__version!==Ve.version?lr(Jt,Ve,tt):(r.activeTexture(33984+tt),r.bindTexture(35866,Jt.__webglTexture))},this.setTexture3D=function(Ve,tt){var Jt=i.get(Ve);0<Ve.version&&Jt.__version!==Ve.version?lr(Jt,Ve,tt):(r.activeTexture(33984+tt),r.bindTexture(32879,Jt.__webglTexture))},this.setTextureCube=Et,this.setTextureCubeDynamic=Ot,this.setupRenderTarget=function(Ve){var tt=i.get(Ve),Jt=i.get(Ve.texture);Ve.addEventListener("dispose",qe),Jt.__webglTexture=e.createTexture(),f.memory.textures++;var Ut=Ve.isWebGLCubeRenderTarget===!0,nn=Ve.isWebGLMultisampleRenderTarget===!0,_r=Ve.isWebGLMultiviewRenderTarget===!0,St=Ae(Ve)||L;if(Ut){tt.__webglFramebuffer=[];for(var Dr=0;Dr<6;Dr++)tt.__webglFramebuffer[Dr]=e.createFramebuffer()}else if(tt.__webglFramebuffer=e.createFramebuffer(),nn)if(L){tt.__webglMultisampledFramebuffer=e.createFramebuffer(),tt.__webglColorRenderbuffer=e.createRenderbuffer(),e.bindRenderbuffer(36161,tt.__webglColorRenderbuffer);var pn=p.convert(Ve.texture.format),pt=p.convert(Ve.texture.type),vr=et(Ve.texture.internalFormat,pn,pt),xr=Vr(Ve);e.renderbufferStorageMultisample(36161,xr,vr,Ve.width,Ve.height),e.bindFramebuffer(36160,tt.__webglMultisampledFramebuffer),e.framebufferRenderbuffer(36160,36064,36161,tt.__webglColorRenderbuffer),e.bindRenderbuffer(36161,null),Ve.depthBuffer&&(tt.__webglDepthRenderbuffer=e.createRenderbuffer(),$r(tt.__webglDepthRenderbuffer,Ve,!0)),e.bindFramebuffer(36160,null)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.");else if(_r){var on=Ve.width,or=Ve.height,Mn=Ve.numViews;e.bindFramebuffer(36160,tt.__webglFramebuffer);var Ln=t.get("OVR_multiview2");f.memory.textures+=2;var wi=e.createTexture();e.bindTexture(35866,wi),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,32856,on,or,Mn,0,6408,5121,null),Ln.framebufferTextureMultiviewOVR(36160,36064,wi,0,0,Mn);var mo=e.createTexture();e.bindTexture(35866,mo),e.texParameteri(35866,10240,9728),e.texParameteri(35866,10241,9728),e.texImage3D(35866,0,35056,on,or,Mn,0,34041,34042,null),Ln.framebufferTextureMultiviewOVR(36160,33306,mo,0,0,Mn);var Bn=new Array(Mn);for(Dr=0;Dr<Mn;++Dr)Bn[Dr]=e.createFramebuffer(),e.bindFramebuffer(36160,Bn[Dr]),e.framebufferTextureLayer(36160,36064,wi,0,Dr);tt.__webglColorTexture=wi,tt.__webglDepthStencilTexture=mo,tt.__webglViewFramebuffers=Bn,e.bindFramebuffer(36160,null),e.bindTexture(35866,null)}if(Ut){for(r.bindTexture(34067,Jt.__webglTexture),Dt(34067,Ve.texture,St),Dr=0;Dr<6;Dr++)yr(tt.__webglFramebuffer[Dr],Ve,36064,34069+Dr);je(Ve.texture,St)&&He(34067,Ve.texture,Ve.width,Ve.height),r.bindTexture(34067,null)}else _r||(r.bindTexture(3553,Jt.__webglTexture),Dt(3553,Ve.texture,St),yr(tt.__webglFramebuffer,Ve,36064,3553),je(Ve.texture,St)&&He(3553,Ve.texture,Ve.width,Ve.height),r.bindTexture(3553,null));Ve.depthBuffer&&Xr(Ve)},this.updateRenderTargetMipmap=function(Ve){var tt=Ve.texture;if(je(tt,Ae(Ve)||L)){var Jt=Ve.isWebGLCubeRenderTarget?34067:3553,Ut=i.get(tt).__webglTexture;r.bindTexture(Jt,Ut),He(Jt,tt,Ve.width,Ve.height),r.bindTexture(Jt,null)}},this.updateMultisampleRenderTarget=function(Ve){if(Ve.isWebGLMultisampleRenderTarget)if(L){var tt=i.get(Ve);e.bindFramebuffer(36008,tt.__webglMultisampledFramebuffer),e.bindFramebuffer(36009,tt.__webglFramebuffer);var Jt=Ve.width,Ut=Ve.height,nn=16384;Ve.depthBuffer&&(nn|=256),Ve.stencilBuffer&&(nn|=1024),e.blitFramebuffer(0,0,Jt,Ut,0,0,Jt,Ut,nn,9728)}else console.warn("THREE.WebGLRenderer: WebGLMultisampleRenderTarget can only be used with WebGL2.")},this.safeSetTexture2D=function(Ve,tt){Ve&&Ve.isWebGLRenderTarget&&(hn===!1&&(console.warn("THREE.WebGLTextures.safeSetTexture2D: don't use render targets as textures. Use their .texture property instead."),hn=!0),Ve=Ve.texture),Tt(Ve,tt)},this.safeSetTextureCube=function(Ve,tt){Ve&&Ve.isWebGLCubeRenderTarget&&(Mr===!1&&(console.warn("THREE.WebGLTextures.safeSetTextureCube: don't use cube render targets as textures. Use their .texture property instead."),Mr=!0),Ve=Ve.texture),(Ve&&Ve.isCubeTexture||Array.isArray(Ve.image)&&Ve.image.length===6?Et:Ot)(Ve,tt)}}function jl(e,t,r){var i=r.isWebGL2;return{convert:function(l){var p;if(l===vn)return 5121;if(l===er)return 32819;if(l===Ar)return 32820;if(l===Cr)return 33635;if(l===In)return 5120;if(l===Zr)return 5122;if(l===Gn)return 5123;if(l===lt)return 5124;if(l===xe)return 5125;if(l===ke)return 5126;if(l===bt)return i?5131:(p=t.get("OES_texture_half_float"))!==null?p.HALF_FLOAT_OES:null;if(l===_n)return 6406;if(l===Sn)return 6407;if(l===Tn)return 6408;if(l===Sa)return 6409;if(l===hi)return 6410;if(l===an)return 6402;if(l===Mi)return 34041;if(l===q)return 6403;if(l===Cn)return 36244;if(l===pi)return 33319;if(l===Fr)return 33320;if(l===Ei)return 36248;if(l===vo)return 36249;if(l===ts||l===Do||l===ms||l===to){if((p=t.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(l===ts)return p.COMPRESSED_RGB_S3TC_DXT1_EXT;if(l===Do)return p.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(l===ms)return p.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(l===to)return p.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(l===rs||l===sa||l===Fo||l===Ea){if((p=t.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(l===rs)return p.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(l===sa)return p.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(l===Fo)return p.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(l===Ea)return p.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return l===gs?(p=t.get("WEBGL_compressed_texture_etc1"))!==null?p.COMPRESSED_RGB_ETC1_WEBGL:null:l===Bs||l===ro||l===ys||l===Oa||l===vs||l===no||l===io||l===Xn||l===An||l===ns||l===xs||l===is||l===Bo||l===Xi?(p=t.get("WEBGL_compressed_texture_astc"))!==null?l:null:l===Kr?i?34042:(p=t.get("WEBGL_depth_texture"))!==null?p.UNSIGNED_INT_24_8_WEBGL:null:void 0}}}function du(e,t,r,i){Yi.call(this,e,t,i),this.depthBuffer=!1,this.stencilBuffer=!1,this.numViews=r}function fu(e){Ni.call(this),this.cameras=e||[]}function nl(){At.call(this),this.type="Group"}function mu(e,t){var r=this,i=null,l=null,p="local-floor",f=null,w=[],L=new Map,V=new Ni;V.layers.enable(1),V.viewport=new qn;var Z=new Ni;Z.layers.enable(2),Z.viewport=new qn;var ee=new fu([V,Z]);ee.layers.enable(1),ee.layers.enable(2);var ae=null,W=null;function he(qe){var vt=L.get(qe.inputSource);vt&&(vt.targetRay&&vt.targetRay.dispatchEvent({type:qe.type}),vt.grip&&vt.grip.dispatchEvent({type:qe.type}))}function ge(){L.forEach(function(qe,vt){qe.targetRay&&(qe.targetRay.dispatchEvent({type:"disconnected",data:vt}),qe.targetRay.visible=!1),qe.grip&&(qe.grip.dispatchEvent({type:"disconnected",data:vt}),qe.grip.visible=!1)}),L.clear(),e.setFramebuffer(null),e.setRenderTarget(e.getRenderTarget()),it.stop(),r.isPresenting=!1,r.dispatchEvent({type:"sessionend"})}function ye(qe){l=qe,it.setContext(i),it.start(),r.isPresenting=!0,r.dispatchEvent({type:"sessionstart"})}function Ae(qe){for(var vt=i.inputSources,Tt=0;Tt<w.length;Tt++)L.set(vt[Tt],w[Tt]);for(Tt=0;Tt<qe.removed.length;Tt++){var Et=qe.removed[Tt];(Ot=L.get(Et))&&(Ot.targetRay&&Ot.targetRay.dispatchEvent({type:"disconnected",data:Et}),Ot.grip&&Ot.grip.dispatchEvent({type:"disconnected",data:Et}),L.delete(Et))}for(Tt=0;Tt<qe.added.length;Tt++){var Ot;Et=qe.added[Tt],(Ot=L.get(Et))&&(Ot.targetRay&&Ot.targetRay.dispatchEvent({type:"connected",data:Et}),Ot.grip&&Ot.grip.dispatchEvent({type:"connected",data:Et}))}}this.enabled=!1,this.isPresenting=!1,this.getController=function(qe){var vt=w[qe];return vt===void 0&&(vt={},w[qe]=vt),vt.targetRay===void 0&&(vt.targetRay=new nl,vt.targetRay.matrixAutoUpdate=!1,vt.targetRay.visible=!1),vt.targetRay},this.getControllerGrip=function(qe){var vt=w[qe];return vt===void 0&&(vt={},w[qe]=vt),vt.grip===void 0&&(vt.grip=new nl,vt.grip.matrixAutoUpdate=!1,vt.grip.visible=!1),vt.grip},this.setFramebufferScaleFactor=function(){},this.setReferenceSpaceType=function(qe){p=qe},this.getReferenceSpace=function(){return l},this.getSession=function(){return i},this.setSession=function(qe){if((i=qe)!==null){i.addEventListener("select",he),i.addEventListener("selectstart",he),i.addEventListener("selectend",he),i.addEventListener("squeeze",he),i.addEventListener("squeezestart",he),i.addEventListener("squeezeend",he),i.addEventListener("end",ge);var vt=t.getContextAttributes(),Tt={antialias:vt.antialias,alpha:vt.alpha,depth:vt.depth,stencil:vt.stencil},Et=new XRWebGLLayer(i,t,Tt);i.updateRenderState({baseLayer:Et}),i.requestReferenceSpace(p).then(ye),i.addEventListener("inputsourceschange",Ae)}};var je=new Le,He=new Le;function et(qe,vt){vt===null?qe.matrixWorld.copy(qe.matrix):qe.matrixWorld.multiplyMatrices(vt.matrixWorld,qe.matrix),qe.matrixWorldInverse.getInverse(qe.matrixWorld)}this.getCamera=function(qe){ee.near=Z.near=V.near=qe.near,ee.far=Z.far=V.far=qe.far,ae===ee.near&&W===ee.far||(i.updateRenderState({depthNear:ee.near,depthFar:ee.far}),ae=ee.near,W=ee.far);var vt=qe.parent,Tt=ee.cameras;et(ee,vt);for(var Et=0;Et<Tt.length;Et++)et(Tt[Et],vt);qe.matrixWorld.copy(ee.matrixWorld);for(var Ot=qe.children,Bt=(Et=0,Ot.length);Et<Bt;Et++)Ot[Et].updateMatrixWorld(!0);return function(Xt,Dt,Mt){je.setFromMatrixPosition(Dt.matrixWorld),He.setFromMatrixPosition(Mt.matrixWorld);var lr=je.distanceTo(He),yr=Dt.projectionMatrix.elements,$r=Mt.projectionMatrix.elements,Xr=yr[14]/(yr[10]-1),Vr=yr[14]/(yr[10]+1),hn=(yr[9]+1)/yr[5],Mr=(yr[9]-1)/yr[5],Ve=(yr[8]-1)/yr[0],tt=($r[8]+1)/$r[0],Jt=Xr*Ve,Ut=Xr*tt,nn=lr/(tt-Ve),_r=nn*-Ve;Dt.matrixWorld.decompose(Xt.position,Xt.quaternion,Xt.scale),Xt.translateX(_r),Xt.translateZ(nn),Xt.matrixWorld.compose(Xt.position,Xt.quaternion,Xt.scale),Xt.matrixWorldInverse.getInverse(Xt.matrixWorld);var St=Xr+nn,Dr=Vr+nn,pn=Jt-_r,pt=lr-_r+Ut,vr=hn*Vr/Dr*St,xr=Mr*Vr/Dr*St;Xt.projectionMatrix.makePerspective(pn,pt,vr,xr,St,Dr)}(ee,V,Z),ee};var Ge=null,it=new uh;it.setAnimationLoop(function(qe,vt){if((f=vt.getViewerPose(l))!==null){var Tt=f.views,Et=i.renderState.baseLayer;e.setFramebuffer(Et.framebuffer);for(var Ot=0;Ot<Tt.length;Ot++){var Bt=Tt[Ot],Xt=Et.getViewport(Bt),Dt=ee.cameras[Ot];Dt.matrix.fromArray(Bt.transform.matrix),Dt.projectionMatrix.fromArray(Bt.projectionMatrix),Dt.viewport.set(Xt.x,Xt.y,Xt.width,Xt.height),Ot===0&&ee.matrix.copy(Dt.matrix)}}var Mt=i.inputSources;for(Ot=0;Ot<w.length;Ot++){var lr=w[Ot],yr=Mt[Ot],$r=null,Xr=null;yr&&(lr.targetRay&&($r=vt.getPose(yr.targetRaySpace,l))!==null&&(lr.targetRay.matrix.fromArray($r.transform.matrix),lr.targetRay.matrix.decompose(lr.targetRay.position,lr.targetRay.rotation,lr.targetRay.scale)),lr.grip&&yr.gripSpace&&(Xr=vt.getPose(yr.gripSpace,l))!==null&&(lr.grip.matrix.fromArray(Xr.transform.matrix),lr.grip.matrix.decompose(lr.grip.position,lr.grip.rotation,lr.grip.scale))),lr.targetRay&&(lr.targetRay.visible=$r!==null),lr.grip&&(lr.grip.visible=Xr!==null)}Ge&&Ge(qe,vt)}),this.setAnimationLoop=function(qe){Ge=qe},this.dispose=function(){}}function Dc(e){var t=(e=e||{}).canvas!==void 0?e.canvas:document.createElementNS("http://www.w3.org/1999/xhtml","canvas"),r=e.context!==void 0?e.context:null,i=e.alpha!==void 0&&e.alpha,l=e.depth===void 0||e.depth,p=e.stencil===void 0||e.stencil,f=e.antialias!==void 0&&e.antialias,w=e.premultipliedAlpha===void 0||e.premultipliedAlpha,L=e.preserveDrawingBuffer!==void 0&&e.preserveDrawingBuffer,V=e.powerPreference!==void 0?e.powerPreference:"default",Z=e.failIfMajorPerformanceCaveat!==void 0&&e.failIfMajorPerformanceCaveat,ee=null,ae=null;this.domElement=t,this.debug={checkShaderErrors:!0},this.autoClear=!0,this.autoClearColor=!0,this.autoClearDepth=!0,this.autoClearStencil=!0,this.sortObjects=!0,this.clippingPlanes=[],this.localClippingEnabled=!1,this.gammaFactor=2,this.outputEncoding=Ke,this.physicallyCorrectLights=!1,this.toneMapping=$e,this.toneMappingExposure=1,this.toneMappingWhitePoint=1,this.maxMorphTargets=8,this.maxMorphNormals=4;var W,he,ge,ye,Ae,je,He,et,Ge,it,qe,vt,Tt,Et,Ot,Bt,Xt,Dt,Mt=this,lr=!1,yr=null,$r=0,Xr=0,Vr=null,hn=null,Mr=-1,Ve={geometry:null,program:null,wireframe:!1},tt=null,Jt=null,Ut=new qn,nn=new qn,_r=null,St=t.width,Dr=t.height,pn=1,pt=null,vr=null,xr=new qn(0,0,St,Dr),on=new qn(0,0,St,Dr),or=!1,Mn=new $s,Ln=new function(){var Oe=this,Ze=null,Xe=0,ht=!1,wt=!1,cr=new na,hr=new Ai,ar={value:null,needsUpdate:!1};function fr(){ar.value!==Ze&&(ar.value=Ze,ar.needsUpdate=0<Xe),Oe.numPlanes=Xe,Oe.numIntersection=0}function Ft($t,jr,zr,sr){var nr=$t!==null?$t.length:0,Qr=null;if(nr!==0){if(Qr=ar.value,sr!==!0||Qr===null){var sn=zr+4*nr,gn=jr.matrixWorldInverse;hr.getNormalMatrix(gn),(Qr===null||Qr.length<sn)&&(Qr=new Float32Array(sn));for(var ai=0,zn=zr;ai!==nr;++ai,zn+=4)cr.copy($t[ai]).applyMatrix4(gn,hr),cr.normal.toArray(Qr,zn),Qr[zn+3]=cr.constant}ar.value=Qr,ar.needsUpdate=!0}return Oe.numPlanes=nr,Qr}this.uniform=ar,this.numPlanes=0,this.numIntersection=0,this.init=function($t,jr,zr){var sr=$t.length!==0||jr||Xe!==0||ht;return ht=jr,Ze=Ft($t,zr,0),Xe=$t.length,sr},this.beginShadows=function(){wt=!0,Ft(null)},this.endShadows=function(){wt=!1,fr()},this.setState=function($t,jr,zr,sr,nr,Qr){if(!ht||$t===null||$t.length===0||wt&&!zr)wt?Ft(null):fr();else{var sn=wt?0:Xe,gn=4*sn,ai=nr.clippingState||null;ar.value=ai,ai=Ft($t,sr,gn,Qr);for(var zn=0;zn!==gn;++zn)ai[zn]=Ze[zn];nr.clippingState=ai,this.numIntersection=jr?this.numPlanes:0,this.numPlanes+=sn}}},wi=!1,mo=!1,Bn=new mn,Ri=new Le;function Vn(){return Vr===null?pn:1}try{var si={alpha:i,depth:l,stencil:p,antialias:f,premultipliedAlpha:w,preserveDrawingBuffer:L,powerPreference:V,failIfMajorPerformanceCaveat:Z,xrCompatible:!0};t.addEventListener("webglcontextlost",go,!1),t.addEventListener("webglcontextrestored",fs,!1);var bi="webgl";if(e.webgl2===!0&&(bi="webgl2"),(W=r||t.getContext(bi,si)||t.getContext("experimental-webgl",si))===null)throw t.getContext("webgl")!==null?new Error("Error creating WebGL context with your selected attributes."):new Error("Error creating WebGL context.");e.retver=bi,W.getShaderPrecisionFormat===void 0&&(W.getShaderPrecisionFormat=function(){return{rangeMin:1,rangeMax:1,precision:1}})}catch(Oe){throw console.error("THREE.WebGLRenderer: "+Oe.message),Oe}function oa(){he=new function(Oe){var Ze={};return{get:function(Xe){if(Ze[Xe]!==void 0)return Ze[Xe];var ht;switch(Xe){case"WEBGL_depth_texture":ht=Oe.getExtension("WEBGL_depth_texture")||Oe.getExtension("MOZ_WEBGL_depth_texture")||Oe.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":ht=Oe.getExtension("EXT_texture_filter_anisotropic")||Oe.getExtension("MOZ_EXT_texture_filter_anisotropic")||Oe.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":ht=Oe.getExtension("WEBGL_compressed_texture_s3tc")||Oe.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||Oe.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":ht=Oe.getExtension("WEBGL_compressed_texture_pvrtc")||Oe.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:ht=Oe.getExtension(Xe)}return ht===null&&console.warn("THREE.WebGLRenderer: "+Xe+" extension not supported."),Ze[Xe]=ht}}}(W),(ge=new function(Oe,Ze,Xe){var ht;function wt(zn){if(zn==="highp"){if(0<Oe.getShaderPrecisionFormat(35633,36338).precision&&0<Oe.getShaderPrecisionFormat(35632,36338).precision)return"highp";zn="mediump"}return zn==="mediump"&&0<Oe.getShaderPrecisionFormat(35633,36337).precision&&0<Oe.getShaderPrecisionFormat(35632,36337).precision?"mediump":"lowp"}var cr=typeof WebGL2RenderingContext<"u"&&Oe instanceof WebGL2RenderingContext||typeof WebGL2ComputeRenderingContext<"u"&&Oe instanceof WebGL2ComputeRenderingContext,hr=Xe.precision!==void 0?Xe.precision:"highp",ar=wt(hr);ar!==hr&&(console.warn("THREE.WebGLRenderer:",hr,"not supported, using",ar,"instead."),hr=ar);var fr=Xe.logarithmicDepthBuffer===!0,Ft=Oe.getParameter(34930),$t=Oe.getParameter(35660),jr=Oe.getParameter(3379),zr=Oe.getParameter(34076),sr=Oe.getParameter(34921),nr=Oe.getParameter(36347),Qr=Oe.getParameter(36348),sn=Oe.getParameter(36349),gn=0<$t,ai=cr||!!Ze.get("OES_texture_float");return{isWebGL2:cr,getMaxAnisotropy:function(){if(ht!==void 0)return ht;var zn=Ze.get("EXT_texture_filter_anisotropic");return ht=zn!==null?Oe.getParameter(zn.MAX_TEXTURE_MAX_ANISOTROPY_EXT):0},getMaxPrecision:wt,precision:hr,logarithmicDepthBuffer:fr,maxTextures:Ft,maxVertexTextures:$t,maxTextureSize:jr,maxCubemapSize:zr,maxAttributes:sr,maxVertexUniforms:nr,maxVaryings:Qr,maxFragmentUniforms:sn,vertexTextures:gn,floatFragmentTextures:ai,floatVertexTextures:gn&&ai,maxSamples:cr?Oe.getParameter(36183):0}}(W,he,e)).isWebGL2===!1&&(he.get("WEBGL_depth_texture"),he.get("OES_texture_float"),he.get("OES_texture_half_float"),he.get("OES_texture_half_float_linear"),he.get("OES_standard_derivatives"),he.get("OES_element_index_uint"),he.get("ANGLE_instanced_arrays")),he.get("OES_texture_float_linear"),Dt=new jl(0,he,ge),(ye=new Ah(W,he,ge)).scissor(nn.copy(on).multiplyScalar(pn).floor()),ye.viewport(Ut.copy(xr).multiplyScalar(pn).floor()),Ae=new function(Oe){var Ze={frame:0,calls:0,triangles:0,points:0,lines:0};return{memory:{geometries:0,textures:0},render:Ze,programs:null,autoReset:!0,reset:function(){Ze.frame++,Ze.calls=0,Ze.triangles=0,Ze.points=0,Ze.lines=0},update:function(Xe,ht,wt){switch(wt=wt||1,Ze.calls++,ht){case 4:Ze.triangles+=wt*(Xe/3);break;case 1:Ze.lines+=wt*(Xe/2);break;case 3:Ze.lines+=wt*(Xe-1);break;case 2:Ze.lines+=wt*Xe;break;case 0:Ze.points+=wt*Xe;break;default:console.error("THREE.WebGLInfo: Unknown draw mode:",ht)}}}},je=new function(){var Oe=new WeakMap;return{get:function(Ze){var Xe=Oe.get(Ze);return Xe===void 0&&(Xe={},Oe.set(Ze,Xe)),Xe},remove:function(Ze){Oe.delete(Ze)},update:function(Ze,Xe,ht){Oe.get(Ze)[Xe]=ht},dispose:function(){Oe=new WeakMap}}},He=new op(W,he,ye,je,ge,Dt,Ae),et=new function(Oe,Ze){var Xe=Ze.isWebGL2,ht=new WeakMap;return{get:function(wt){return wt.isInterleavedBufferAttribute&&(wt=wt.data),ht.get(wt)},remove:function(wt){wt.isInterleavedBufferAttribute&&(wt=wt.data);var cr=ht.get(wt);cr&&(Oe.deleteBuffer(cr.buffer),ht.delete(wt))},update:function(wt,cr){wt.isInterleavedBufferAttribute&&(wt=wt.data);var hr,ar,fr,Ft,$t,jr=ht.get(wt);jr===void 0?ht.set(wt,function(zr,sr){var nr=zr.array,Qr=zr.usage,sn=Oe.createBuffer();Oe.bindBuffer(sr,sn),Oe.bufferData(sr,nr,Qr),zr.onUploadCallback();var gn=5126;return nr instanceof Float32Array?gn=5126:nr instanceof Float64Array?console.warn("THREE.WebGLAttributes: Unsupported data buffer format: Float64Array."):nr instanceof Uint16Array?gn=5123:nr instanceof Int16Array?gn=5122:nr instanceof Uint32Array?gn=5125:nr instanceof Int32Array?gn=5124:nr instanceof Int8Array?gn=5120:nr instanceof Uint8Array&&(gn=5121),{buffer:sn,type:gn,bytesPerElement:nr.BYTES_PER_ELEMENT,version:zr.version}}(wt,cr)):jr.version<wt.version&&(hr=jr.buffer,fr=cr,Ft=(ar=wt).array,$t=ar.updateRange,Oe.bindBuffer(fr,hr),$t.count===-1?Oe.bufferSubData(fr,0,Ft):(Xe?Oe.bufferSubData(fr,$t.offset*Ft.BYTES_PER_ELEMENT,Ft,$t.offset,$t.count):Oe.bufferSubData(fr,$t.offset*Ft.BYTES_PER_ELEMENT,Ft.subarray($t.offset,$t.offset+$t.count)),$t.count=-1),jr.version=wt.version)}}}(W,ge),Ge=new function(Oe,Ze,Xe){var ht=new WeakMap,wt=new WeakMap;function cr(ar){var fr=ar.target,Ft=ht.get(fr);for(var $t in Ft.index!==null&&Ze.remove(Ft.index),Ft.attributes)Ze.remove(Ft.attributes[$t]);fr.removeEventListener("dispose",cr),ht.delete(fr);var jr=wt.get(Ft);jr&&(Ze.remove(jr),wt.delete(Ft)),Xe.memory.geometries--}function hr(ar){var fr=[],Ft=ar.index,$t=ar.attributes.position,jr=0;if(Ft!==null){var zr=Ft.array;jr=Ft.version;for(var sr=0,nr=zr.length;sr<nr;sr+=3){var Qr=zr[sr+0],sn=zr[sr+1],gn=zr[sr+2];fr.push(Qr,sn,sn,gn,gn,Qr)}}else for(zr=$t.array,jr=$t.version,sr=0,nr=zr.length/3-1;sr<nr;sr+=3)Qr=sr+0,sn=sr+1,gn=sr+2,fr.push(Qr,sn,sn,gn,gn,Qr);var ai=new(65535<Ki(fr)?Ci:mi)(fr,1);ai.version=jr,Ze.update(ai,34963);var zn=wt.get(ar);zn&&Ze.remove(zn),wt.set(ar,ai)}return{get:function(ar,fr){var Ft=ht.get(fr);return Ft||(fr.addEventListener("dispose",cr),fr.isBufferGeometry?Ft=fr:fr.isGeometry&&(fr._bufferGeometry===void 0&&(fr._bufferGeometry=new br().setFromObject(ar)),Ft=fr._bufferGeometry),ht.set(fr,Ft),Xe.memory.geometries++,Ft)},update:function(ar){var fr=ar.index,Ft=ar.attributes;for(var $t in fr!==null&&Ze.update(fr,34963),Ft)Ze.update(Ft[$t],34962);var jr=ar.morphAttributes;for(var $t in jr)for(var zr=jr[$t],sr=0,nr=zr.length;sr<nr;sr++)Ze.update(zr[sr],34962)},getWireframeAttribute:function(ar){var fr=wt.get(ar);if(fr){var Ft=ar.index;Ft!==null&&fr.version<Ft.version&&hr(ar)}else hr(ar);return wt.get(ar)}}}(0,et,Ae),it=new function(Oe,Ze,Xe,ht){var wt={};return{update:function(cr){var hr=ht.render.frame,ar=cr.geometry,fr=Ze.get(cr,ar);return wt[fr.id]!==hr&&(ar.isGeometry&&fr.updateFromObject(cr),Ze.update(fr),wt[fr.id]=hr),cr.isInstancedMesh&&Xe.update(cr.instanceMatrix,34962),fr},dispose:function(){wt={}}}}(0,Ge,et,Ae),Ot=new function(Oe){var Ze={},Xe=new Float32Array(8);return{update:function(ht,wt,cr,hr){var ar=ht.morphTargetInfluences,fr=ar===void 0?0:ar.length,Ft=Ze[wt.id];if(Ft===void 0){Ft=[];for(var $t=0;$t<fr;$t++)Ft[$t]=[$t,0];Ze[wt.id]=Ft}var jr=cr.morphTargets&&wt.morphAttributes.position,zr=cr.morphNormals&&wt.morphAttributes.normal;for($t=0;$t<fr;$t++)(nr=Ft[$t])[1]!==0&&(jr&&wt.deleteAttribute("morphTarget"+$t),zr&&wt.deleteAttribute("morphNormal"+$t));for($t=0;$t<fr;$t++)(nr=Ft[$t])[0]=$t,nr[1]=ar[$t];Ft.sort(cu);var sr=0;for($t=0;$t<8;$t++){var nr;if(nr=Ft[$t]){var Qr=nr[0],sn=nr[1];if(sn){jr&&wt.setAttribute("morphTarget"+$t,jr[Qr]),zr&&wt.setAttribute("morphNormal"+$t,zr[Qr]),sr+=Xe[$t]=sn;continue}}Xe[$t]=0}var gn=wt.morphTargetsRelative?1:1-sr;hr.getUniforms().setValue(Oe,"morphTargetBaseInfluence",gn),hr.getUniforms().setValue(Oe,"morphTargetInfluences",Xe)}}}(W),qe=new tp(Mt,he,ge),vt=new function(){var Oe=new WeakMap;function Ze(Xe){var ht=Xe.target;ht.removeEventListener("dispose",Ze),Oe.delete(ht)}return{get:function(Xe,ht){var wt,cr=Oe.get(Xe);return cr===void 0?(wt=new qo,Oe.set(Xe,new WeakMap),Oe.get(Xe).set(ht,wt),Xe.addEventListener("dispose",Ze)):(wt=cr.get(ht))===void 0&&(wt=new qo,cr.set(ht,wt)),wt},dispose:function(){Oe=new WeakMap}}},Tt=new function(){var Oe=new WeakMap;function Ze(Xe){var ht=Xe.target;ht.removeEventListener("dispose",Ze),Oe.delete(ht)}return{get:function(Xe,ht){var wt;return Oe.has(Xe)===!1?(wt=new np,Oe.set(Xe,new WeakMap),Oe.get(Xe).set(ht,wt),Xe.addEventListener("dispose",Ze)):Oe.get(Xe).has(ht)===!1?(wt=new np,Oe.get(Xe).set(ht,wt)):wt=Oe.get(Xe).get(ht),wt},dispose:function(){Oe=new WeakMap}}},Et=new Nn(Mt,ye,it,w),Bt=new function(Oe,Ze,Xe,ht){var wt,cr=ht.isWebGL2;this.setMode=function(hr){wt=hr},this.render=function(hr,ar){Oe.drawArrays(wt,hr,ar),Xe.update(ar,wt)},this.renderInstances=function(hr,ar,fr,Ft){if(Ft!==0){var $t,jr;if(cr)$t=Oe,jr="drawArraysInstanced";else if(jr="drawArraysInstancedANGLE",($t=Ze.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");$t[jr](wt,ar,fr,Ft),Xe.update(fr,wt,Ft)}}}(W,he,Ae,ge),Xt=new function(Oe,Ze,Xe,ht){var wt,cr,hr,ar=ht.isWebGL2;this.setMode=function(fr){wt=fr},this.setIndex=function(fr){cr=fr.type,hr=fr.bytesPerElement},this.render=function(fr,Ft){Oe.drawElements(wt,Ft,cr,fr*hr),Xe.update(Ft,wt)},this.renderInstances=function(fr,Ft,$t,jr){if(jr!==0){var zr,sr;if(ar)zr=Oe,sr="drawElementsInstanced";else if(sr="drawElementsInstancedANGLE",(zr=Ze.get("ANGLE_instanced_arrays"))===null)return void console.error("THREE.WebGLIndexedBufferRenderer: using THREE.InstancedBufferGeometry but hardware does not support extension ANGLE_instanced_arrays.");zr[sr](wt,$t,cr,Ft*hr,jr),Xe.update($t,wt,jr)}}}(W,he,Ae,ge),Ae.programs=qe.programs,Mt.capabilities=ge,Mt.extensions=he,Mt.properties=je,Mt.renderLists=vt,Mt.state=ye,Mt.info=Ae}oa();var ei=new mu(Mt,W);this.xr=ei;var ea=new function(Oe,Ze){var Xe,ht,wt,cr,hr,ar,fr,Ft=Oe.extensions,$t=Oe.properties,jr=0;function zr(sr){return sr.isArrayCamera?sr.cameras:(hr[0]=sr,hr)}this.isAvailable=function(){if(fr===void 0){var sr=Ft.get("OVR_multiview2");if(fr=sr!==null&&Ze.getContextAttributes().antialias===!1){jr=Ze.getParameter(sr.MAX_VIEWS_OVR),Xe=new du(0,0,2),ar=new Gt,cr=[],wt=[],hr=[];for(var nr=0;nr<jr;nr++)cr[nr]=new mn,wt[nr]=new Ai}}return fr},this.attachCamera=function(sr){(function(nr){if(nr.isArrayCamera===void 0)return!0;var Qr=nr.cameras;if(Qr.length>jr)return!1;for(var sn=1,gn=Qr.length;sn<gn;sn++)if(Qr[0].viewport.z!==Qr[sn].viewport.z||Qr[0].viewport.w!==Qr[sn].viewport.w)return!1;return!0})(sr)!==!1&&(ht=Oe.getRenderTarget(),function(nr){if(ht?ar.set(ht.width,ht.height):Oe.getDrawingBufferSize(ar),nr.isArrayCamera){var Qr=nr.cameras[0].viewport;Xe.setSize(Qr.z,Qr.w),Xe.setNumViews(nr.cameras.length)}else Xe.setSize(ar.x,ar.y),Xe.setNumViews(2)}(sr),Oe.setRenderTarget(Xe))},this.detachCamera=function(sr){Xe===Oe.getRenderTarget()&&(Oe.setRenderTarget(ht),function(nr){var Qr=Xe,sn=Qr.numViews,gn=$t.get(Qr).__webglViewFramebuffers,ai=Qr.width,zn=Qr.height;if(nr.isArrayCamera)for(var La=0;La<sn;La++){var Qo=nr.cameras[La].viewport,es=Qo.x,Ml=Qo.y,yo=es+Qo.z,Bi=Ml+Qo.w;Ze.bindFramebuffer(36008,gn[La]),Ze.blitFramebuffer(0,0,ai,zn,es,Ml,yo,Bi,16384,9728)}else Ze.bindFramebuffer(36008,gn[0]),Ze.blitFramebuffer(0,0,ai,zn,0,0,ar.x,ar.y,16384,9728)}(sr))},this.updateCameraProjectionMatricesUniform=function(sr,nr){for(var Qr=zr(sr),sn=0;sn<Qr.length;sn++)cr[sn].copy(Qr[sn].projectionMatrix);nr.setValue(Ze,"projectionMatrices",cr)},this.updateCameraViewMatricesUniform=function(sr,nr){for(var Qr=zr(sr),sn=0;sn<Qr.length;sn++)cr[sn].copy(Qr[sn].matrixWorldInverse);nr.setValue(Ze,"viewMatrices",cr)},this.updateObjectMatricesUniforms=function(sr,nr,Qr){for(var sn=zr(nr),gn=0;gn<sn.length;gn++)cr[gn].multiplyMatrices(sn[gn].matrixWorldInverse,sr.matrixWorld),wt[gn].getNormalMatrix(cr[gn]);Qr.setValue(Ze,"modelViewMatrices",cr),Qr.setValue(Ze,"normalMatrices",wt)}}(Mt,W),eo=new Oh(Mt,it,ge.maxTextureSize);function go(Oe){Oe.preventDefault(),console.log("THREE.WebGLRenderer: Context Lost."),lr=!0}function fs(){console.log("THREE.WebGLRenderer: Context Restored."),lr=!1,oa()}function Fs(Oe){var Ze,Xe=Oe.target;Xe.removeEventListener("dispose",Fs),rh(Ze=Xe),je.remove(Ze)}function rh(Oe){var Ze=je.get(Oe).program;(Oe.program=void 0)!==Ze&&qe.releaseProgram(Ze)}this.shadowMap=eo,this.getContext=function(){return W},this.getContextAttributes=function(){return W.getContextAttributes()},this.forceContextLoss=function(){var Oe=he.get("WEBGL_lose_context");Oe&&Oe.loseContext()},this.forceContextRestore=function(){var Oe=he.get("WEBGL_lose_context");Oe&&Oe.restoreContext()},this.getPixelRatio=function(){return pn},this.setPixelRatio=function(Oe){Oe!==void 0&&(pn=Oe,this.setSize(St,Dr,!1))},this.getSize=function(Oe){return Oe===void 0&&(console.warn("WebGLRenderer: .getsize() now requires a Vector2 as an argument"),Oe=new Gt),Oe.set(St,Dr)},this.setSize=function(Oe,Ze,Xe){ei.isPresenting?console.warn("THREE.WebGLRenderer: Can't change size while VR device is presenting."):(St=Oe,Dr=Ze,t.width=Math.floor(Oe*pn),t.height=Math.floor(Ze*pn),Xe!==!1&&(t.style.width=Oe+"px",t.style.height=Ze+"px"),this.setViewport(0,0,Oe,Ze))},this.getDrawingBufferSize=function(Oe){return Oe===void 0&&(console.warn("WebGLRenderer: .getdrawingBufferSize() now requires a Vector2 as an argument"),Oe=new Gt),Oe.set(St*pn,Dr*pn).floor()},this.setDrawingBufferSize=function(Oe,Ze,Xe){St=Oe,Dr=Ze,pn=Xe,t.width=Math.floor(Oe*Xe),t.height=Math.floor(Ze*Xe),this.setViewport(0,0,Oe,Ze)},this.getCurrentViewport=function(Oe){return Oe===void 0&&(console.warn("WebGLRenderer: .getCurrentViewport() now requires a Vector4 as an argument"),Oe=new qn),Oe.copy(Ut)},this.getViewport=function(Oe){return Oe.copy(xr)},this.setViewport=function(Oe,Ze,Xe,ht){Oe.isVector4?xr.set(Oe.x,Oe.y,Oe.z,Oe.w):xr.set(Oe,Ze,Xe,ht),ye.viewport(Ut.copy(xr).multiplyScalar(pn).floor())},this.getScissor=function(Oe){return Oe.copy(on)},this.setScissor=function(Oe,Ze,Xe,ht){Oe.isVector4?on.set(Oe.x,Oe.y,Oe.z,Oe.w):on.set(Oe,Ze,Xe,ht),ye.scissor(nn.copy(on).multiplyScalar(pn).floor())},this.getScissorTest=function(){return or},this.setScissorTest=function(Oe){ye.setScissorTest(or=Oe)},this.setOpaqueSort=function(Oe){pt=Oe},this.setTransparentSort=function(Oe){vr=Oe},this.getClearColor=function(){return Et.getClearColor()},this.setClearColor=function(){Et.setClearColor.apply(Et,arguments)},this.getClearAlpha=function(){return Et.getClearAlpha()},this.setClearAlpha=function(){Et.setClearAlpha.apply(Et,arguments)},this.clear=function(Oe,Ze,Xe){var ht=0;Oe!==void 0&&!Oe||(ht|=16384),Ze!==void 0&&!Ze||(ht|=256),Xe!==void 0&&!Xe||(ht|=1024),W.clear(ht)},this.clearColor=function(){this.clear(!0,!1,!1)},this.clearDepth=function(){this.clear(!1,!0,!1)},this.clearStencil=function(){this.clear(!1,!1,!0)},this.dispose=function(){t.removeEventListener("webglcontextlost",go,!1),t.removeEventListener("webglcontextrestored",fs,!1),vt.dispose(),Tt.dispose(),je.dispose(),it.dispose(),ei.dispose(),rc.stop()},this.renderBufferImmediate=function(Oe,Ze){ye.initAttributes();var Xe=je.get(Oe);Oe.hasPositions&&!Xe.position&&(Xe.position=W.createBuffer()),Oe.hasNormals&&!Xe.normal&&(Xe.normal=W.createBuffer()),Oe.hasUvs&&!Xe.uv&&(Xe.uv=W.createBuffer()),Oe.hasColors&&!Xe.color&&(Xe.color=W.createBuffer());var ht=Ze.getAttributes();Oe.hasPositions&&(W.bindBuffer(34962,Xe.position),W.bufferData(34962,Oe.positionArray,35048),ye.enableAttribute(ht.position),W.vertexAttribPointer(ht.position,3,5126,!1,0,0)),Oe.hasNormals&&(W.bindBuffer(34962,Xe.normal),W.bufferData(34962,Oe.normalArray,35048),ye.enableAttribute(ht.normal),W.vertexAttribPointer(ht.normal,3,5126,!1,0,0)),Oe.hasUvs&&(W.bindBuffer(34962,Xe.uv),W.bufferData(34962,Oe.uvArray,35048),ye.enableAttribute(ht.uv),W.vertexAttribPointer(ht.uv,2,5126,!1,0,0)),Oe.hasColors&&(W.bindBuffer(34962,Xe.color),W.bufferData(34962,Oe.colorArray,35048),ye.enableAttribute(ht.color),W.vertexAttribPointer(ht.color,3,5126,!1,0,0)),ye.disableUnusedAttributes(),W.drawArrays(4,0,Oe.count),Oe.count=0};var kd=new Wr;this.renderBufferDirect=function(Oe,Ze,Xe,ht,wt,cr){Ze===null&&(Ze=kd);var hr=wt.isMesh&&wt.matrixWorld.determinant()<0,ar=Bh(Oe,Ze,ht,wt);ye.setMaterial(ht,hr);var fr=!1;Ve.geometry===Xe.id&&Ve.program===ar.id&&Ve.wireframe===(ht.wireframe===!0)||(Ve.geometry=Xe.id,Ve.program=ar.id,Ve.wireframe=ht.wireframe===!0,fr=!0),(ht.morphTargets||ht.morphNormals)&&(Ot.update(wt,Xe,ht,ar),fr=!0);var Ft=Xe.index,$t=Xe.attributes.position;if(Ft===null){if($t===void 0||$t.count===0)return}else if(Ft.count===0)return;var jr,zr=1;ht.wireframe===!0&&(Ft=Ge.getWireframeAttribute(Xe),zr=2);var sr=Bt;Ft!==null&&((jr=et.get(Ft))?(sr=Xt).setIndex(jr):(console.log("mx attribute == null"),Ft=null)),fr&&(function(Ml,yo,Bi,ti){if(ge.isWebGL2!==!1||!Ml.isInstancedMesh&&!yo.isInstancedBufferGeometry||he.get("ANGLE_instanced_arrays")!==null){ye.initAttributes();var Up=yo.attributes,No=ti.getAttributes(),Hp=Bi.defaultAttributeValues;for(var Co in No){var qi=No[Co];if(0<=qi){var Vo=Up[Co];if(Vo!==void 0){var ur=Vo.normalized,Ht=Vo.itemSize;if((sc=et.get(Vo))===void 0)continue;var xa=sc.buffer,oc=sc.type,_f=sc.bytesPerElement;if(Vo.isInterleavedBufferAttribute){var ih=Vo.data,Ff=ih.stride,Bf=Vo.offset;ih&&ih.isInstancedInterleavedBuffer?(ye.enableAttributeAndDivisor(qi,ih.meshPerAttribute),yo.maxInstancedCount===void 0&&(yo.maxInstancedCount=ih.meshPerAttribute*ih.count)):ye.enableAttribute(qi),W.bindBuffer(34962,xa),W.vertexAttribPointer(qi,Ht,oc,ur,Ff*_f,Bf*_f)}else Vo.isInstancedBufferAttribute?(ye.enableAttributeAndDivisor(qi,Vo.meshPerAttribute),yo.maxInstancedCount===void 0&&(yo.maxInstancedCount=Vo.meshPerAttribute*Vo.count)):ye.enableAttribute(qi),W.bindBuffer(34962,xa),W.vertexAttribPointer(qi,Ht,oc,ur,0,0)}else if(Co==="instanceMatrix"){var sc;if((sc=et.get(Ml.instanceMatrix))===void 0)continue;xa=sc.buffer,oc=sc.type,ye.enableAttributeAndDivisor(qi+0,1),ye.enableAttributeAndDivisor(qi+1,1),ye.enableAttributeAndDivisor(qi+2,1),ye.enableAttributeAndDivisor(qi+3,1),W.bindBuffer(34962,xa),W.vertexAttribPointer(qi+0,4,oc,!1,64,0),W.vertexAttribPointer(qi+1,4,oc,!1,64,16),W.vertexAttribPointer(qi+2,4,oc,!1,64,32),W.vertexAttribPointer(qi+3,4,oc,!1,64,48)}else if(Hp!==void 0){var ah=Hp[Co];if(ah!==void 0)switch(ah.length){case 2:W.vertexAttrib2fv(qi,ah);break;case 3:W.vertexAttrib3fv(qi,ah);break;case 4:W.vertexAttrib4fv(qi,ah);break;default:W.vertexAttrib1fv(qi,ah)}}}}ye.disableUnusedAttributes()}}(wt,Xe,ht,ar),Ft!==null&&W.bindBuffer(34963,jr.buffer));var nr=Ft!==null?Ft.count:$t.count,Qr=Xe.drawRange.start*zr,sn=Xe.drawRange.count*zr,gn=cr!==null?cr.start*zr:0,ai=cr!==null?cr.count*zr:1/0,zn=Math.max(Qr,gn),La=Math.min(nr,Qr+sn,gn+ai)-1,Qo=Math.max(0,La-zn+1);if(Qo!==0){if(wt.isMesh)ht.wireframe===!0?(ye.setLineWidth(ht.wireframeLinewidth*Vn()),sr.setMode(1)):sr.setMode(4);else if(wt.isLine){var es=ht.linewidth;es===void 0&&(es=1),ye.setLineWidth(es*Vn()),wt.isLineSegments?sr.setMode(1):wt.isLineLoop?sr.setMode(2):sr.setMode(3)}else wt.isPoints?sr.setMode(0):wt.isSprite&&sr.setMode(4);wt.isInstancedMesh?sr.renderInstances(Xe,zn,Qo,wt.count):Xe.isInstancedBufferGeometry?sr.renderInstances(Xe,zn,Qo,Xe.maxInstancedCount):sr.render(zn,Qo)}},this.compile=function(Oe,Ze){(ae=Tt.get(Oe,Ze)).init(),Oe.traverse(function(ht){ht.isLight&&(ae.pushLight(ht),ht.castShadow&&ae.pushShadow(ht))}),ae.setupLights(Ze);var Xe={};Oe.traverse(function(ht){if(ht.material)if(Array.isArray(ht.material))for(var wt=0;wt<ht.material.length;wt++)ht.material[wt].uuid in Xe==0&&(ac(ht.material[wt],Oe,ht),Xe[ht.material[wt].uuid]=!0);else ht.material.uuid in Xe==0&&(ac(ht.material,Oe,ht),Xe[ht.material.uuid]=!0)})};var nh=null,rc=new uh;function nc(Oe,Ze,Xe,ht){for(var wt=0,cr=Oe.length;wt<cr;wt++){var hr=Oe[wt],ar=hr.object,fr=hr.geometry,Ft=ht===void 0?hr.material:ht,$t=hr.group;if(Xe.isArrayCamera)if(Jt=Xe,ei.enabled&&ea.isAvailable())ic(ar,Ze,Xe,fr,Ft,$t);else for(var jr=Xe.cameras,zr=0,sr=jr.length;zr<sr;zr++){var nr=jr[zr];ar.layers.test(nr.layers)&&(ye.viewport(Ut.copy(nr.viewport)),ae.setupLights(nr),ic(ar,Ze,nr,fr,Ft,$t))}else Jt=null,ic(ar,Ze,Xe,fr,Ft,$t)}}function ic(Oe,Ze,Xe,ht,wt,cr){if(Oe.onBeforeRender(Mt,Ze,Xe,ht,wt,cr),ae=Tt.get(Ze,Jt||Xe),Oe.modelViewMatrix.multiplyMatrices(Xe.matrixWorldInverse,Oe.matrixWorld),Oe.normalMatrix.getNormalMatrix(Oe.modelViewMatrix),Oe.isImmediateRenderObject){var hr=Bh(Xe,Ze,wt,Oe);ye.setMaterial(wt),Ve.geometry=null,Ve.program=null,Ve.wireframe=!1,ar=hr,Oe.render(function(fr){Mt.renderBufferImmediate(fr,ar)})}else Mt.renderBufferDirect(Xe,Ze,ht,wt,Oe,cr);var ar;Oe.onAfterRender(Mt,Ze,Xe,ht,wt,cr),ae=Tt.get(Ze,Jt||Xe)}function ac(Oe,Ze,Xe){var ht=je.get(Oe),wt=ae.state.lights,cr=ae.state.shadowsArray,hr=wt.state.version,ar=qe.getParameters(Oe,wt.state,cr,Ze,Ln.numPlanes,Ln.numIntersection,Xe),fr=qe.getProgramCacheKey(ar),Ft=ht.program,$t=!0;if(Ft===void 0)Oe.addEventListener("dispose",Fs);else if(Ft.cacheKey!==fr)rh(Oe);else if(ht.lightsStateVersion!==hr)ht.lightsStateVersion=hr,$t=!1;else{if(ar.shaderID!==void 0)return;$t=!1}$t&&(Ft=qe.acquireProgram(ar,fr),ht.program=Ft,ht.uniforms=ar.uniforms,ht.environment=Oe.isMeshStandardMaterial?Ze.environment:null,ht.outputEncoding=Mt.outputEncoding,Oe.program=Ft);var jr=Ft.getAttributes();if(Oe.morphTargets)for(var zr=Oe.numSupportedMorphTargets=0;zr<Mt.maxMorphTargets;zr++)0<=jr["morphTarget"+zr]&&Oe.numSupportedMorphTargets++;if(Oe.morphNormals)for(zr=Oe.numSupportedMorphNormals=0;zr<Mt.maxMorphNormals;zr++)0<=jr["morphNormal"+zr]&&Oe.numSupportedMorphNormals++;var sr,nr=ht.uniforms;(Oe.isShaderMaterial||Oe.isRawShaderMaterial)&&Oe.clipping!==!0||(ht.numClippingPlanes=Ln.numPlanes,ht.numIntersection=Ln.numIntersection,nr.clippingPlanes=Ln.uniform),ht.fog=Ze.fog,ht.needsLights=(sr=Oe).isMeshLambertMaterial||sr.isMeshToonMaterial||sr.isMeshPhongMaterial||sr.isMeshStandardMaterial||sr.isShadowMaterial||sr.isShaderMaterial&&sr.lights===!0,ht.lightsStateVersion=hr,ht.needsLights&&(nr.ambientLightColor.value=wt.state.ambient,nr.lightProbe.value=wt.state.probe,nr.directionalLights.value=wt.state.directional,nr.spotLights.value=wt.state.spot,nr.rectAreaLights.value=wt.state.rectArea,nr.pointLights.value=wt.state.point,nr.hemisphereLights.value=wt.state.hemi,nr.directionalShadowMap.value=wt.state.directionalShadowMap,nr.directionalShadowMatrix.value=wt.state.directionalShadowMatrix,nr.spotShadowMap.value=wt.state.spotShadowMap,nr.spotShadowMatrix.value=wt.state.spotShadowMatrix,nr.pointShadowMap.value=wt.state.pointShadowMap,nr.pointShadowMatrix.value=wt.state.pointShadowMatrix);var Qr=ht.program.getUniforms(),sn=cs.seqWithValue(Qr.seq,nr);ht.uniformsList=sn}function Bh(Oe,Ze,Xe,ht){He.resetTextureUnits();var wt=Ze.fog,cr=Xe.isMeshStandardMaterial?Ze.environment:null,hr=je.get(Xe),ar=ae.state.lights;if(wi&&(mo||Oe!==tt)){var fr=Oe===tt&&Xe.id===Mr;Ln.setState(Xe.clippingPlanes,Xe.clipIntersection,Xe.clipShadows,Oe,hr,fr)}Xe.version===hr.__version?(hr.program===void 0||Xe.fog&&hr.fog!==wt||hr.environment!==cr||hr.needsLights&&hr.lightsStateVersion!==ar.state.version||hr.numClippingPlanes!==void 0&&(hr.numClippingPlanes!==Ln.numPlanes||hr.numIntersection!==Ln.numIntersection)||hr.outputEncoding!==Mt.outputEncoding)&&ac(Xe,Ze,ht):(je.update(Xe,"uniforms",Xe.uniforms),ac(Xe,Ze,ht),hr.__version=Xe.version);var Ft,$t,jr,zr,sr,nr,Qr,sn,gn,ai,zn,La,Qo=!1,es=!1,Ml=!1,yo=hr.program,Bi=yo.getUniforms(),ti=hr.uniforms;if(ye.useProgram(yo.program)&&(Ml=es=Qo=!0),Xe.id!==Mr&&(Mr=Xe.id,es=!0),Qo||tt!==Oe){if(0<yo.numMultiviewViews?ea.updateCameraProjectionMatricesUniform(Oe,Bi):Bi.setValue(W,"projectionMatrix",Oe.projectionMatrix),ge.logarithmicDepthBuffer&&Bi.setValue(W,"logDepthBufFC",2/(Math.log(Oe.far+1)/Math.LN2)),tt!==Oe&&(tt=Oe,Ml=es=!0),Xe.isShaderMaterial||Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshStandardMaterial||Xe.envMap){var Up=Bi.map.cameraPosition;Up!==void 0&&Up.setValue(W,Ri.setFromMatrixPosition(Oe.matrixWorld))}(Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshLambertMaterial||Xe.isMeshBasicMaterial||Xe.isMeshStandardMaterial||Xe.isShaderMaterial)&&Bi.setValue(W,"isOrthographic",Oe.isOrthographicCamera===!0),(Xe.isMeshPhongMaterial||Xe.isMeshToonMaterial||Xe.isMeshLambertMaterial||Xe.isMeshBasicMaterial||Xe.isMeshStandardMaterial||Xe.isShaderMaterial||Xe.skinning)&&(0<yo.numMultiviewViews?ea.updateCameraViewMatricesUniform(Oe,Bi):Bi.setValue(W,"viewMatrix",Oe.matrixWorldInverse))}if(Xe.skinning){Bi.setOptional(W,ht,"bindMatrix"),Bi.setOptional(W,ht,"bindMatrixInverse");var No=ht.skeleton;if(No){var Hp=No.bones;if(ge.floatVertexTextures){if(No.boneTexture===void 0){var Co=Math.sqrt(4*Hp.length);Co=xn.ceilPowerOfTwo(Co),Co=Math.max(Co,4);var qi=new Float32Array(Co*Co*4);qi.set(No.boneMatrices);var Vo=new Pl(qi,Co,Co,Tn,ke);No.boneMatrices=qi,No.boneTexture=Vo,No.boneTextureSize=Co}Bi.setValue(W,"boneTexture",No.boneTexture,He),Bi.setValue(W,"boneTextureSize",No.boneTextureSize)}else Bi.setOptional(W,No,"boneMatrices")}}return!es&&hr.receiveShadow===ht.receiveShadow||(hr.receiveShadow=ht.receiveShadow,Bi.setValue(W,"receiveShadow",ht.receiveShadow)),es&&(Bi.setValue(W,"toneMappingExposure",Mt.toneMappingExposure),Bi.setValue(W,"toneMappingWhitePoint",Mt.toneMappingWhitePoint),hr.needsLights&&(La=Ml,(zn=ti).ambientLightColor.needsUpdate=La,zn.lightProbe.needsUpdate=La,zn.directionalLights.needsUpdate=La,zn.pointLights.needsUpdate=La,zn.spotLights.needsUpdate=La,zn.rectAreaLights.needsUpdate=La,zn.hemisphereLights.needsUpdate=La),wt&&Xe.fog&&(ai=wt,(gn=ti).fogColor.value.copy(ai.color),ai.isFog?(gn.fogNear.value=ai.near,gn.fogFar.value=ai.far):ai.isFogExp2&&(gn.fogDensity.value=ai.density)),Xe.isMeshBasicMaterial?To(ti,Xe):Xe.isMeshLambertMaterial?(To(ti,Xe),Qr=ti,(sn=Xe).emissiveMap&&(Qr.emissiveMap.value=sn.emissiveMap)):Xe.isMeshToonMaterial?(To(ti,Xe),function(ur,Ht){ur.specular.value.copy(Ht.specular),ur.shininess.value=Math.max(Ht.shininess,1e-4),Ht.gradientMap&&(ur.gradientMap.value=Ht.gradientMap),Ht.emissiveMap&&(ur.emissiveMap.value=Ht.emissiveMap),Ht.bumpMap&&(ur.bumpMap.value=Ht.bumpMap,ur.bumpScale.value=Ht.bumpScale,Ht.side===_&&(ur.bumpScale.value*=-1)),Ht.normalMap&&(ur.normalMap.value=Ht.normalMap,ur.normalScale.value.copy(Ht.normalScale),Ht.side===_&&ur.normalScale.value.negate()),Ht.displacementMap&&(ur.displacementMap.value=Ht.displacementMap,ur.displacementScale.value=Ht.displacementScale,ur.displacementBias.value=Ht.displacementBias)}(ti,Xe)):Xe.isMeshPhongMaterial?(To(ti,Xe),function(ur,Ht){ur.specular.value.copy(Ht.specular),ur.shininess.value=Math.max(Ht.shininess,1e-4),Ht.emissiveMap&&(ur.emissiveMap.value=Ht.emissiveMap),Ht.bumpMap&&(ur.bumpMap.value=Ht.bumpMap,ur.bumpScale.value=Ht.bumpScale,Ht.side===_&&(ur.bumpScale.value*=-1)),Ht.normalMap&&(ur.normalMap.value=Ht.normalMap,ur.normalScale.value.copy(Ht.normalScale),Ht.side===_&&ur.normalScale.value.negate()),Ht.displacementMap&&(ur.displacementMap.value=Ht.displacementMap,ur.displacementScale.value=Ht.displacementScale,ur.displacementBias.value=Ht.displacementBias)}(ti,Xe)):Xe.isMeshStandardMaterial?(To(ti,Xe,cr),(Xe.isMeshPhysicalMaterial?function(ur,Ht,xa){Mf(ur,Ht,xa),ur.reflectivity.value=Ht.reflectivity,ur.clearcoat.value=Ht.clearcoat,ur.clearcoatRoughness.value=Ht.clearcoatRoughness,Ht.sheen&&ur.sheen.value.copy(Ht.sheen),Ht.clearcoatNormalMap&&(ur.clearcoatNormalScale.value.copy(Ht.clearcoatNormalScale),ur.clearcoatNormalMap.value=Ht.clearcoatNormalMap,Ht.side===_&&ur.clearcoatNormalScale.value.negate()),ur.transparency.value=Ht.transparency}:Mf)(ti,Xe,cr)):Xe.isMeshMatcapMaterial?(To(ti,Xe),function(ur,Ht){Ht.matcap&&(ur.matcap.value=Ht.matcap),Ht.bumpMap&&(ur.bumpMap.value=Ht.bumpMap,ur.bumpScale.value=Ht.bumpScale,Ht.side===_&&(ur.bumpScale.value*=-1)),Ht.normalMap&&(ur.normalMap.value=Ht.normalMap,ur.normalScale.value.copy(Ht.normalScale),Ht.side===_&&ur.normalScale.value.negate()),Ht.displacementMap&&(ur.displacementMap.value=Ht.displacementMap,ur.displacementScale.value=Ht.displacementScale,ur.displacementBias.value=Ht.displacementBias)}(ti,Xe)):Xe.isMeshDepthMaterial?(To(ti,Xe),sr=ti,(nr=Xe).displacementMap&&(sr.displacementMap.value=nr.displacementMap,sr.displacementScale.value=nr.displacementScale,sr.displacementBias.value=nr.displacementBias)):Xe.isMeshDistanceMaterial?(To(ti,Xe),function(ur,Ht){Ht.displacementMap&&(ur.displacementMap.value=Ht.displacementMap,ur.displacementScale.value=Ht.displacementScale,ur.displacementBias.value=Ht.displacementBias),ur.referencePosition.value.copy(Ht.referencePosition),ur.nearDistance.value=Ht.nearDistance,ur.farDistance.value=Ht.farDistance}(ti,Xe)):Xe.isMeshNormalMaterial?(To(ti,Xe),function(ur,Ht){Ht.bumpMap&&(ur.bumpMap.value=Ht.bumpMap,ur.bumpScale.value=Ht.bumpScale,Ht.side===_&&(ur.bumpScale.value*=-1)),Ht.normalMap&&(ur.normalMap.value=Ht.normalMap,ur.normalScale.value.copy(Ht.normalScale),Ht.side===_&&ur.normalScale.value.negate()),Ht.displacementMap&&(ur.displacementMap.value=Ht.displacementMap,ur.displacementScale.value=Ht.displacementScale,ur.displacementBias.value=Ht.displacementBias)}(ti,Xe)):Xe.isLineBasicMaterial?(zr=Xe,(jr=ti).diffuse.value.copy(zr.color),jr.opacity.value=zr.opacity,Xe.isLineDashedMaterial&&($t=Xe,(Ft=ti).dashSize.value=$t.dashSize,Ft.totalSize.value=$t.dashSize+$t.gapSize,Ft.scale.value=$t.scale)):Xe.isPointsMaterial?function(ur,Ht){var xa;ur.diffuse.value.copy(Ht.color),ur.opacity.value=Ht.opacity,ur.size.value=Ht.size*pn,ur.scale.value=.5*Dr,Ht.map&&(ur.map.value=Ht.map),Ht.alphaMap&&(ur.alphaMap.value=Ht.alphaMap),Ht.map?xa=Ht.map:Ht.alphaMap&&(xa=Ht.alphaMap),xa!==void 0&&(xa.matrixAutoUpdate===!0&&xa.updateMatrix(),ur.uvTransform.value.copy(xa.matrix))}(ti,Xe):Xe.isSpriteMaterial?function(ur,Ht){var xa;ur.diffuse.value.copy(Ht.color),ur.opacity.value=Ht.opacity,ur.rotation.value=Ht.rotation,Ht.map&&(ur.map.value=Ht.map),Ht.alphaMap&&(ur.alphaMap.value=Ht.alphaMap),Ht.map?xa=Ht.map:Ht.alphaMap&&(xa=Ht.alphaMap),xa!==void 0&&(xa.matrixAutoUpdate===!0&&xa.updateMatrix(),ur.uvTransform.value.copy(xa.matrix))}(ti,Xe):Xe.isShadowMaterial&&(ti.color.value.copy(Xe.color),ti.opacity.value=Xe.opacity),ti.ltc_1!==void 0&&(ti.ltc_1.value=gr.LTC_1),ti.ltc_2!==void 0&&(ti.ltc_2.value=gr.LTC_2),cs.upload(W,hr.uniformsList,ti,He),Xe.isShaderMaterial&&(Xe.uniformsNeedUpdate=!1)),Xe.isShaderMaterial&&Xe.uniformsNeedUpdate===!0&&(cs.upload(W,hr.uniformsList,ti,He),Xe.uniformsNeedUpdate=!1),Xe.isSpriteMaterial&&Bi.setValue(W,"center",ht.center),0<yo.numMultiviewViews?ea.updateObjectMatricesUniforms(ht,Oe,Bi):(Bi.setValue(W,"modelViewMatrix",ht.modelViewMatrix),Bi.setValue(W,"normalMatrix",ht.normalMatrix)),Bi.setValue(W,"modelMatrix",ht.matrixWorld),yo}function To(Oe,Ze,Xe){Oe.opacity.value=Ze.opacity,Ze.color&&Oe.diffuse.value.copy(Ze.color),Ze.emissive&&Oe.emissive.value.copy(Ze.emissive).multiplyScalar(Ze.emissiveIntensity),Ze.map&&(Oe.map.value=Ze.map),Ze.alphaMap&&(Oe.alphaMap.value=Ze.alphaMap),Ze.specularMap&&(Oe.specularMap.value=Ze.specularMap);var ht,wt,cr=Ze.envMap||Xe;cr&&(Oe.envMap.value=cr,Oe.flipEnvMap.value=cr.isCubeTexture?-1:1,Oe.reflectivity.value=Ze.reflectivity,Oe.refractionRatio.value=Ze.refractionRatio,Oe.maxMipLevel.value=je.get(cr).__maxMipLevel),Ze.lightMap&&(Oe.lightMap.value=Ze.lightMap,Oe.lightMapIntensity.value=Ze.lightMapIntensity),Ze.aoMap&&(Oe.aoMap.value=Ze.aoMap,Oe.aoMapIntensity.value=Ze.aoMapIntensity),Ze.map?ht=Ze.map:Ze.specularMap?ht=Ze.specularMap:Ze.displacementMap?ht=Ze.displacementMap:Ze.normalMap?ht=Ze.normalMap:Ze.bumpMap?ht=Ze.bumpMap:Ze.roughnessMap?ht=Ze.roughnessMap:Ze.metalnessMap?ht=Ze.metalnessMap:Ze.alphaMap?ht=Ze.alphaMap:Ze.emissiveMap&&(ht=Ze.emissiveMap),ht!==void 0&&(ht.isWebGLRenderTarget&&(ht=ht.texture),ht.matrixAutoUpdate===!0&&ht.updateMatrix(),Oe.uvTransform.value.copy(ht.matrix)),Ze.aoMap?wt=Ze.aoMap:Ze.lightMap&&(wt=Ze.lightMap),wt!==void 0&&(wt.isWebGLRenderTarget&&(wt=wt.texture),wt.matrixAutoUpdate===!0&&wt.updateMatrix(),Oe.uv2Transform.value.copy(wt.matrix))}function Mf(Oe,Ze,Xe){Oe.roughness.value=Ze.roughness,Oe.metalness.value=Ze.metalness,Ze.roughnessMap&&(Oe.roughnessMap.value=Ze.roughnessMap),Ze.metalnessMap&&(Oe.metalnessMap.value=Ze.metalnessMap),Ze.emissiveMap&&(Oe.emissiveMap.value=Ze.emissiveMap),Ze.bumpMap&&(Oe.bumpMap.value=Ze.bumpMap,Oe.bumpScale.value=Ze.bumpScale,Ze.side===_&&(Oe.bumpScale.value*=-1)),Ze.normalMap&&(Oe.normalMap.value=Ze.normalMap,Oe.normalScale.value.copy(Ze.normalScale),Ze.side===_&&Oe.normalScale.value.negate()),Ze.displacementMap&&(Oe.displacementMap.value=Ze.displacementMap,Oe.displacementScale.value=Ze.displacementScale,Oe.displacementBias.value=Ze.displacementBias),(Ze.envMap||Xe)&&(Oe.envMapIntensity.value=Ze.envMapIntensity)}rc.setAnimationLoop(function(Oe){ei.isPresenting||nh&&nh(Oe)}),typeof window<"u"&&rc.setContext(window),this.setAnimationLoop=function(Oe){nh=Oe,ei.setAnimationLoop(Oe),rc.start()},this.render=function(Oe,Ze){var Xe,ht;if(arguments[2]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the renderTarget argument has been removed. Use .setRenderTarget() instead."),Xe=arguments[2]),arguments[3]!==void 0&&(console.warn("THREE.WebGLRenderer.render(): the forceClear argument has been removed. Use .clear() instead."),ht=arguments[3]),Ze&&Ze.isCamera){if(!lr){Ve.geometry=null,Ve.program=null,Ve.wireframe=!1,Mr=-1,!(tt=null)===Oe.autoUpdate&&Oe.updateMatrixWorld(),Ze.parent===null&&Ze.updateMatrixWorld(),ei.enabled&&ei.isPresenting&&(Ze=ei.getCamera(Ze)),(ae=Tt.get(Oe,Ze)).init(),Oe.onBeforeRender(Mt,Oe,Ze,Xe||Vr),Bn.multiplyMatrices(Ze.projectionMatrix,Ze.matrixWorldInverse),Mn.setFromProjectionMatrix(Bn),mo=this.localClippingEnabled,wi=Ln.init(this.clippingPlanes,mo,Ze),(ee=vt.get(Oe,Ze)).init(),function fr(Ft,$t,jr,zr){if(Ft.visible!==!1){if(Ft.layers.test($t.layers)){if(Ft.isGroup)jr=Ft.renderOrder;else if(Ft.isLOD)Ft.autoUpdate===!0&&Ft.update($t);else if(Ft.isLight)ae.pushLight(Ft),Ft.castShadow&&ae.pushShadow(Ft);else if(Ft.isSprite){if(!Ft.frustumCulled||Mn.intersectsSprite(Ft)){zr&&Ri.setFromMatrixPosition(Ft.matrixWorld).applyMatrix4(Bn);var sr=it.update(Ft);(nr=Ft.material).visible&&ee.push(Ft,sr,nr,jr,Ri.z,null)}}else if(Ft.isImmediateRenderObject)zr&&Ri.setFromMatrixPosition(Ft.matrixWorld).applyMatrix4(Bn),ee.push(Ft,null,Ft.material,jr,Ri.z,null);else if((Ft.isMesh||Ft.isLine||Ft.isPoints)&&(Ft.isSkinnedMesh&&Ft.skeleton.frame!==Ae.render.frame&&(Ft.skeleton.update(),Ft.skeleton.frame=Ae.render.frame),!Ft.frustumCulled||Mn.intersectsObject(Ft))){zr&&Ri.setFromMatrixPosition(Ft.matrixWorld).applyMatrix4(Bn),sr=it.update(Ft);var nr=Ft.material;if(Array.isArray(nr))for(var Qr=sr.groups,sn=0,gn=Qr.length;sn<gn;sn++){var ai=Qr[sn],zn=nr[ai.materialIndex];zn&&zn.visible&&ee.push(Ft,sr,zn,jr,Ri.z,ai)}else nr.visible&&ee.push(Ft,sr,nr,jr,Ri.z,null)}}var La=Ft.children;for(sn=0,gn=La.length;sn<gn;sn++)fr(La[sn],$t,jr,zr)}}(Oe,Ze,0,Mt.sortObjects),Mt.sortObjects===!0&&ee.sort(pt,vr),wi&&Ln.beginShadows();var wt=ae.state.shadowsArray;eo.render(wt,Oe,Ze),ae.setupLights(Ze),wi&&Ln.endShadows(),this.info.autoReset&&this.info.reset(),Xe!==void 0&&this.setRenderTarget(Xe),ei.enabled&&ea.isAvailable()&&ea.attachCamera(Ze),Et.render(ee,Oe,Ze,ht);var cr=ee.opaque,hr=ee.transparent;if(Oe.overrideMaterial){var ar=Oe.overrideMaterial;cr.length&&nc(cr,Oe,Ze,ar),hr.length&&nc(hr,Oe,Ze,ar)}else cr.length&&nc(cr,Oe,Ze),hr.length&&nc(hr,Oe,Ze);Oe.onAfterRender(Mt,Oe,Ze),Vr!==null&&(He.updateRenderTargetMipmap(Vr),He.updateMultisampleRenderTarget(Vr)),ye.buffers.depth.setTest(!0),ye.buffers.depth.setMask(!0),ye.buffers.color.setMask(!0),ye.setPolygonOffset(!1),ei.enabled&&ea.isAvailable()&&ea.detachCamera(Ze),ae=ee=null}}else console.error("THREE.WebGLRenderer.render: camera is not an instance of THREE.Camera.")},this.mxRenderObject=function(Oe,Ze,Xe,ht,wt){ic(Oe,Ze,Xe,it.update(Oe),ht,wt)},this.setFramebuffer=function(Oe){yr!==Oe&&Vr===null&&W.bindFramebuffer(36160,Oe),yr=Oe},this.getActiveCubeFace=function(){return $r},this.getActiveMipmapLevel=function(){return Xr},this.getRenderTarget=function(){return Vr},this.setRenderTarget=function(Oe,Ze,Xe){$r=Ze,Xr=Xe,(Vr=Oe)&&je.get(Oe).__webglFramebuffer===void 0&&He.setupRenderTarget(Oe);var ht=yr,wt=!1;if(Oe){var cr=je.get(Oe).__webglFramebuffer;Oe.isWebGLCubeRenderTarget?(ht=cr[Ze||0],wt=!0):ht=Oe.isWebGLMultisampleRenderTarget?je.get(Oe).__webglMultisampledFramebuffer:cr,Ut.copy(Oe.viewport),nn.copy(Oe.scissor),_r=Oe.scissorTest}else Ut.copy(xr).multiplyScalar(pn).floor(),nn.copy(on).multiplyScalar(pn).floor(),_r=or;if(hn!==ht&&(W.bindFramebuffer(36160,ht),hn=ht),ye.viewport(Ut),ye.scissor(nn),ye.setScissorTest(_r),wt){var hr=je.get(Oe.texture);W.framebufferTexture2D(36160,36064,34069+(Ze||0),hr.__webglTexture,Xe||0)}},this.readRenderTargetPixels=function(Oe,Ze,Xe,ht,wt,cr,hr){if(Oe&&Oe.isWebGLRenderTarget){var ar=je.get(Oe).__webglFramebuffer;if(Oe.isWebGLCubeRenderTarget&&hr!==void 0&&(ar=ar[hr]),ar){var fr=!1;ar!==hn&&(W.bindFramebuffer(36160,ar),fr=!0);try{var Ft=Oe.texture,$t=Ft.format,jr=Ft.type;if($t!==Tn&&Dt.convert($t)!==W.getParameter(35739))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in RGBA or implementation defined format.");if(!(jr===vn||Dt.convert(jr)===W.getParameter(35738)||jr===ke&&(ge.isWebGL2||he.get("OES_texture_float")||he.get("WEBGL_color_buffer_float"))||jr===bt&&(ge.isWebGL2?he.get("EXT_color_buffer_float"):he.get("EXT_color_buffer_half_float"))))return void console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not in UnsignedByteType or implementation defined type.");W.checkFramebufferStatus(36160)===36053?0<=Ze&&Ze<=Oe.width-ht&&0<=Xe&&Xe<=Oe.height-wt&&W.readPixels(Ze,Xe,ht,wt,Dt.convert($t),Dt.convert(jr),cr):console.error("THREE.WebGLRenderer.readRenderTargetPixels: readPixels from renderTarget failed. Framebuffer not complete.")}finally{fr&&W.bindFramebuffer(36160,hn)}}}else console.error("THREE.WebGLRenderer.readRenderTargetPixels: renderTarget is not THREE.WebGLRenderTarget.")},this.copyFramebufferToTexture=function(Oe,Ze,Xe){Xe===void 0&&(Xe=0);var ht=Math.pow(2,-Xe),wt=Math.floor(Ze.image.width*ht),cr=Math.floor(Ze.image.height*ht),hr=Dt.convert(Ze.format);He.setTexture2D(Ze,0),W.copyTexImage2D(3553,Xe,hr,Oe.x,Oe.y,wt,cr,0),ye.unbindTexture()},this.copyTextureToTexture=function(Oe,Ze,Xe,ht){var wt=Ze.image.width,cr=Ze.image.height,hr=Dt.convert(Xe.format),ar=Dt.convert(Xe.type);He.setTexture2D(Xe,0),Ze.isDataTexture?W.texSubImage2D(3553,ht||0,Oe.x,Oe.y,wt,cr,hr,ar,Ze.image.data):W.texSubImage2D(3553,ht||0,Oe.x,Oe.y,hr,ar,Ze.image),ye.unbindTexture()},this.initTexture=function(Oe){He.setTexture2D(Oe,0),ye.unbindTexture()},typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("observe",{detail:this}))}function ho(e,t){this.name="",this.color=new Qe(e),this.density=t!==void 0?t:25e-5}function Yo(e,t,r){this.name="",this.color=new Qe(e),this.near=t!==void 0?t:1,this.far=r!==void 0?r:1e3}function Zo(e,t){this.array=e,this.stride=t,this.count=e!==void 0?e.length/t:0,this.usage=Jn,this.updateRange={offset:0,count:-1},this.version=0}du.prototype=Object.assign(Object.create(Yi.prototype),{constructor:du,isWebGLMultiviewRenderTarget:!0,copy:function(e){return Yi.prototype.copy.call(this,e),this.numViews=e.numViews,this},setNumViews:function(e){return this.numViews!==e&&(this.numViews=e,this.dispose()),this}}),fu.prototype=Object.assign(Object.create(Ni.prototype),{constructor:fu,isArrayCamera:!0}),nl.prototype=Object.assign(Object.create(At.prototype),{constructor:nl,isGroup:!0}),Object.assign(mu.prototype,Ia.prototype),Object.assign(ho.prototype,{isFogExp2:!0,clone:function(){return new ho(this.color,this.density)},toJSON:function(){return{type:"FogExp2",color:this.color.getHex(),density:this.density}}}),Object.assign(Yo.prototype,{isFog:!0,clone:function(){return new Yo(this.color,this.near,this.far)},toJSON:function(){return{type:"Fog",color:this.color.getHex(),near:this.near,far:this.far}}}),Object.defineProperty(Zo.prototype,"needsUpdate",{set:function(e){e===!0&&this.version++}}),Object.assign(Zo.prototype,{isInterleavedBuffer:!0,onUploadCallback:function(){},setUsage:function(e){return this.usage=e,this},copy:function(e){return this.array=new e.array.constructor(e.array),this.count=e.count,this.stride=e.stride,this.usage=e.usage,this},copyAt:function(e,t,r){e*=this.stride,r*=t.stride;for(var i=0,l=this.stride;i<l;i++)this.array[e+i]=t.array[r+i];return this},set:function(e,t){return t===void 0&&(t=0),this.array.set(e,t),this},clone:function(){return new this.constructor().copy(this)},onUpload:function(e){return this.onUploadCallback=e,this}});var Nl,il=new Le;function gu(e,t,r,i){this.data=e,this.itemSize=t,this.offset=r,this.normalized=i===!0}function al(e){kt.call(this),this.type="SpriteMaterial",this.color=new Qe(16777215),this.map=null,this.alphaMap=null,this.rotation=0,this.sizeAttenuation=!0,this.transparent=!0,this.setValues(e)}Object.defineProperties(gu.prototype,{count:{get:function(){return this.data.count}},array:{get:function(){return this.data.array}}}),Object.assign(gu.prototype,{isInterleavedBufferAttribute:!0,applyMatrix4:function(e){for(var t=0,r=this.data.count;t<r;t++)il.x=this.getX(t),il.y=this.getY(t),il.z=this.getZ(t),il.applyMatrix4(e),this.setXYZ(t,il.x,il.y,il.z);return this},setX:function(e,t){return this.data.array[e*this.data.stride+this.offset]=t,this},setY:function(e,t){return this.data.array[e*this.data.stride+this.offset+1]=t,this},setZ:function(e,t){return this.data.array[e*this.data.stride+this.offset+2]=t,this},setW:function(e,t){return this.data.array[e*this.data.stride+this.offset+3]=t,this},getX:function(e){return this.data.array[e*this.data.stride+this.offset]},getY:function(e){return this.data.array[e*this.data.stride+this.offset+1]},getZ:function(e){return this.data.array[e*this.data.stride+this.offset+2]},getW:function(e){return this.data.array[e*this.data.stride+this.offset+3]},setXY:function(e,t,r){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this},setXYZ:function(e,t,r,i){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this},setXYZW:function(e,t,r,i,l){return e=e*this.data.stride+this.offset,this.data.array[e+0]=t,this.data.array[e+1]=r,this.data.array[e+2]=i,this.data.array[e+3]=l,this}}),((al.prototype=Object.create(kt.prototype)).constructor=al).prototype.isSpriteMaterial=!0,al.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.rotation=e.rotation,this.sizeAttenuation=e.sizeAttenuation,this};var Vl=new Le,ol=new Le,sl=new Le,Fl=new Gt,yu=new Gt,sp=new mn,Fa=new Le,vu=new Le,xu=new Le,lp=new Gt,wu=new Gt,up=new Gt;function bu(e){if(At.call(this),this.type="Sprite",Nl===void 0){Nl=new br;var t=new Zo(new Float32Array([-.5,-.5,0,0,0,.5,-.5,0,1,0,.5,.5,0,1,1,-.5,.5,0,0,1]),5);Nl.setIndex([0,1,2,0,2,3]),Nl.setAttribute("position",new gu(t,3,0,!1)),Nl.setAttribute("uv",new gu(t,2,3,!1))}this.geometry=Nl,this.material=e!==void 0?e:new al,this.center=new Gt(.5,.5)}function Sc(e,t,r,i,l,p){Fl.subVectors(e,r).addScalar(.5).multiply(i),l!==void 0?(yu.x=p*Fl.x-l*Fl.y,yu.y=l*Fl.x+p*Fl.y):yu.copy(Fl),e.copy(t),e.x+=yu.x,e.y+=yu.y,e.applyMatrix4(sp)}bu.prototype=Object.assign(Object.create(At.prototype),{constructor:bu,isSprite:!0,raycast:function(e,t){e.camera===null&&console.error('THREE.Sprite: "Raycaster.camera" needs to be set in order to raycast against sprites.'),ol.setFromMatrixScale(this.matrixWorld),sp.copy(e.camera.matrixWorld),this.modelViewMatrix.multiplyMatrices(e.camera.matrixWorldInverse,this.matrixWorld),sl.setFromMatrixPosition(this.modelViewMatrix),e.camera.isPerspectiveCamera&&this.material.sizeAttenuation===!1&&ol.multiplyScalar(-sl.z);var r,i,l=this.material.rotation;l!==0&&(i=Math.cos(l),r=Math.sin(l));var p=this.center;Sc(Fa.set(-.5,-.5,0),sl,p,ol,r,i),Sc(vu.set(.5,-.5,0),sl,p,ol,r,i),Sc(xu.set(.5,.5,0),sl,p,ol,r,i),lp.set(0,0),wu.set(1,0),up.set(1,1);var f=e.ray.intersectTriangle(Fa,vu,xu,!1,Vl);if(f!==null||(Sc(vu.set(-.5,.5,0),sl,p,ol,r,i),wu.set(0,1),(f=e.ray.intersectTriangle(Fa,xu,vu,!1,Vl))!==null)){var w=e.ray.origin.distanceTo(Vl);w<e.near||w>e.far||t.push({distance:w,point:Vl.clone(),uv:ki.getUV(Vl,Fa,vu,xu,lp,wu,up,new Gt),face:null,object:this})}},clone:function(){return new this.constructor(this.material).copy(this)},copy:function(e){return At.prototype.copy.call(this,e),e.center!==void 0&&this.center.copy(e.center),this}});var Bl=new Le,Ph=new Le;function Mu(){At.call(this),this.type="LOD",Object.defineProperties(this,{levels:{enumerable:!0,value:[]}}),this.autoUpdate=!0}function _u(e,t){e&&e.isGeometry&&console.error("THREE.SkinnedMesh no longer supports THREE.Geometry. Use THREE.BufferGeometry instead."),Di.call(this,e,t),this.type="SkinnedMesh",this.bindMode="attached",this.bindMatrix=new mn,this.bindMatrixInverse=new mn}Mu.prototype=Object.assign(Object.create(At.prototype),{constructor:Mu,isLOD:!0,copy:function(e){At.prototype.copy.call(this,e,!1);for(var t=e.levels,r=0,i=t.length;r<i;r++){var l=t[r];this.addLevel(l.object.clone(),l.distance)}return this.autoUpdate=e.autoUpdate,this},addLevel:function(e,t){t===void 0&&(t=0),t=Math.abs(t);for(var r=this.levels,i=0;i<r.length&&!(t<r[i].distance);i++);return r.splice(i,0,{distance:t,object:e}),this.add(e),this},getObjectForDistance:function(e){var t=this.levels;if(0<t.length){for(var r=1,i=t.length;r<i&&!(e<t[r].distance);r++);return t[r-1].object}return null},raycast:function(e,t){if(0<this.levels.length){Bl.setFromMatrixPosition(this.matrixWorld);var r=e.ray.origin.distanceTo(Bl);this.getObjectForDistance(r).raycast(e,t)}},update:function(e){var t=this.levels;if(1<t.length){Bl.setFromMatrixPosition(e.matrixWorld),Ph.setFromMatrixPosition(this.matrixWorld);var r=Bl.distanceTo(Ph);t[0].object.visible=!0;for(var i=1,l=t.length;i<l&&r>=t[i].distance;i++)t[i-1].object.visible=!1,t[i].object.visible=!0;for(;i<l;i++)t[i].object.visible=!1}},toJSON:function(e){var t=At.prototype.toJSON.call(this,e);this.autoUpdate===!1&&(t.object.autoUpdate=!1),t.object.levels=[];for(var r=this.levels,i=0,l=r.length;i<l;i++){var p=r[i];t.object.levels.push({object:p.object.uuid,distance:p.distance})}return t}}),_u.prototype=Object.assign(Object.create(Di.prototype),{constructor:_u,isSkinnedMesh:!0,bind:function(e,t){this.skeleton=e,t===void 0&&(this.updateMatrixWorld(!0),this.skeleton.calculateInverses(),t=this.matrixWorld),this.bindMatrix.copy(t),this.bindMatrixInverse.getInverse(t)},pose:function(){this.skeleton.pose()},normalizeSkinWeights:function(){for(var e=new qn,t=this.geometry.attributes.skinWeight,r=0,i=t.count;r<i;r++){e.x=t.getX(r),e.y=t.getY(r),e.z=t.getZ(r),e.w=t.getW(r);var l=1/e.manhattanLength();l!=1/0?e.multiplyScalar(l):e.set(1,0,0,0),t.setXYZW(r,e.x,e.y,e.z,e.w)}},updateMatrixWorld:function(e){Di.prototype.updateMatrixWorld.call(this,e),this.bindMode==="attached"?this.bindMatrixInverse.getInverse(this.matrixWorld):this.bindMode==="detached"?this.bindMatrixInverse.getInverse(this.bindMatrix):console.warn("THREE.SkinnedMesh: Unrecognized bindMode: "+this.bindMode)},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var cp=new mn,Xp=new mn;function Ec(e,t){if(e=e||[],this.bones=e.slice(0),this.boneMatrices=new Float32Array(16*this.bones.length),this.frame=-1,t===void 0)this.calculateInverses();else if(this.bones.length===t.length)this.boneInverses=t.slice(0);else{console.warn("THREE.Skeleton boneInverses is the wrong length."),this.boneInverses=[];for(var r=0,i=this.bones.length;r<i;r++)this.boneInverses.push(new mn)}}function Rh(){At.call(this),this.type="Bone"}Object.assign(Ec.prototype,{calculateInverses:function(){this.boneInverses=[];for(var e=0,t=this.bones.length;e<t;e++){var r=new mn;this.bones[e]&&r.getInverse(this.bones[e].matrixWorld),this.boneInverses.push(r)}},pose:function(){var e,t,r;for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&e.matrixWorld.getInverse(this.boneInverses[t]);for(t=0,r=this.bones.length;t<r;t++)(e=this.bones[t])&&(e.parent&&e.parent.isBone?(e.matrix.getInverse(e.parent.matrixWorld),e.matrix.multiply(e.matrixWorld)):e.matrix.copy(e.matrixWorld),e.matrix.decompose(e.position,e.quaternion,e.scale))},update:function(){for(var e=this.bones,t=this.boneInverses,r=this.boneMatrices,i=this.boneTexture,l=0,p=e.length;l<p;l++){var f=e[l]?e[l].matrixWorld:Xp;cp.multiplyMatrices(f,t[l]),cp.toArray(r,16*l)}i!==void 0&&(i.needsUpdate=!0)},clone:function(){return new Ec(this.bones,this.boneInverses)},getBoneByName:function(e){for(var t=0,r=this.bones.length;t<r;t++){var i=this.bones[t];if(i.name===e)return i}}}),Rh.prototype=Object.assign(Object.create(At.prototype),{constructor:Rh,isBone:!0});var Lh=new mn,Tu=new mn,Gl=[],Cu=new Di;function Oc(e,t,r){Di.call(this,e,t),this.instanceMatrix=new Kt(new Float32Array(16*r),16),this.count=r,this.frustumCulled=!1}function Vi(e){kt.call(this),this.type="LineBasicMaterial",this.color=new Qe(16777215),this.linewidth=1,this.linecap="round",this.linejoin="round",this.setValues(e)}Oc.prototype=Object.assign(Object.create(Di.prototype),{constructor:Oc,isInstancedMesh:!0,getMatrixAt:function(e,t){t.fromArray(this.instanceMatrix.array,16*e)},raycast:function(e,t){var r=this.matrixWorld,i=this.count;if(Cu.geometry=this.geometry,Cu.material=this.material,Cu.material!==void 0)for(var l=0;l<i;l++)this.getMatrixAt(l,Lh),Tu.multiplyMatrices(r,Lh),Cu.matrixWorld=Tu,Cu.raycast(e,Gl),0<Gl.length&&(Gl[0].instanceId=l,Gl[0].object=this,t.push(Gl[0]),Gl.length=0)},setMatrixAt:function(e,t){t.toArray(this.instanceMatrix.array,16*e)},updateMorphTargets:function(){}}),((Vi.prototype=Object.create(kt.prototype)).constructor=Vi).prototype.isLineBasicMaterial=!0,Vi.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.color.copy(e.color),this.linewidth=e.linewidth,this.linecap=e.linecap,this.linejoin=e.linejoin,this};var Ih=new Le,kh=new Le,hp=new mn,Ac=new kn,Pc=new Kn;function Ra(e,t,r){r===1&&console.error("THREE.Line: parameter THREE.LinePieces no longer supported. Use THREE.LineSegments instead."),At.call(this),this.type="Line",this.geometry=e!==void 0?e:new br,this.material=t!==void 0?t:new Vi}Ra.prototype=Object.assign(Object.create(At.prototype),{constructor:Ra,isLine:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,r=[0],i=1,l=t.count;i<l;i++)Ih.fromBufferAttribute(t,i-1),kh.fromBufferAttribute(t,i),r[i]=r[i-1],r[i]+=Ih.distanceTo(kh);e.setAttribute("lineDistance",new tr(r,1))}else console.warn("THREE.Line.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var p=e.vertices;for((r=e.lineDistances)[0]=0,i=1,l=p.length;i<l;i++)r[i]=r[i-1],r[i]+=p[i-1].distanceTo(p[i])}return this},raycast:function(e,t){var r=e.linePrecision,i=this.geometry,l=this.matrixWorld;if(i.boundingSphere===null&&i.computeBoundingSphere(),Pc.copy(i.boundingSphere),Pc.applyMatrix4(l),Pc.radius+=r,e.ray.intersectsSphere(Pc)!==!1){hp.getInverse(l),Ac.copy(e.ray).applyMatrix4(hp);var p=r/((this.scale.x+this.scale.y+this.scale.z)/3),f=p*p,w=new Le,L=new Le,V=new Le,Z=new Le,ee=this&&this.isLineSegments?2:1;if(i.isBufferGeometry){var ae=i.index,W=i.attributes.position.array;if(ae!==null)for(var he=ae.array,ge=0,ye=he.length-1;ge<ye;ge+=ee){var Ae=he[ge],je=he[ge+1];w.fromArray(W,3*Ae),L.fromArray(W,3*je),f<Ac.distanceSqToSegment(w,L,Z,V)||(Z.applyMatrix4(this.matrixWorld),(Ge=e.ray.origin.distanceTo(Z))<e.near||Ge>e.far||t.push({distance:Ge,point:V.clone().applyMatrix4(this.matrixWorld),index:ge,face:null,faceIndex:null,object:this}))}else for(ge=0,ye=W.length/3-1;ge<ye;ge+=ee)w.fromArray(W,3*ge),L.fromArray(W,3*ge+3),f<Ac.distanceSqToSegment(w,L,Z,V)||(Z.applyMatrix4(this.matrixWorld),(Ge=e.ray.origin.distanceTo(Z))<e.near||Ge>e.far||t.push({distance:Ge,point:V.clone().applyMatrix4(this.matrixWorld),index:ge,face:null,faceIndex:null,object:this}))}else if(i.isGeometry){var He=i.vertices,et=He.length;for(ge=0;ge<et-1;ge+=ee){var Ge;f<Ac.distanceSqToSegment(He[ge],He[ge+1],Z,V)||(Z.applyMatrix4(this.matrixWorld),(Ge=e.ray.origin.distanceTo(Z))<e.near||Ge>e.far||t.push({distance:Ge,point:V.clone().applyMatrix4(this.matrixWorld),index:ge,face:null,faceIndex:null,object:this}))}}}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}});var Rc=new Le,Lc=new Le;function gi(e,t){Ra.call(this,e,t),this.type="LineSegments"}function Du(e,t){Ra.call(this,e,t),this.type="LineLoop"}function Ko(e){kt.call(this),this.type="PointsMaterial",this.color=new Qe(16777215),this.map=null,this.alphaMap=null,this.size=1,this.sizeAttenuation=!0,this.morphTargets=!1,this.setValues(e)}gi.prototype=Object.assign(Object.create(Ra.prototype),{constructor:gi,isLineSegments:!0,computeLineDistances:function(){var e=this.geometry;if(e.isBufferGeometry)if(e.index===null){for(var t=e.attributes.position,r=[],i=0,l=t.count;i<l;i+=2)Rc.fromBufferAttribute(t,i),Lc.fromBufferAttribute(t,i+1),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+Rc.distanceTo(Lc);e.setAttribute("lineDistance",new tr(r,1))}else console.warn("THREE.LineSegments.computeLineDistances(): Computation only possible with non-indexed BufferGeometry.");else if(e.isGeometry){var p=e.vertices;for(r=e.lineDistances,i=0,l=p.length;i<l;i+=2)Rc.copy(p[i]),Lc.copy(p[i+1]),r[i]=i===0?0:r[i-1],r[i+1]=r[i]+Rc.distanceTo(Lc)}return this}}),Du.prototype=Object.assign(Object.create(Ra.prototype),{constructor:Du,isLineLoop:!0}),((Ko.prototype=Object.create(kt.prototype)).constructor=Ko).prototype.isPointsMaterial=!0,Ko.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.alphaMap=e.alphaMap,this.size=e.size,this.sizeAttenuation=e.sizeAttenuation,this.morphTargets=e.morphTargets,this};var Ic=new mn,kc=new kn,Su=new Kn,jc=new Le;function zl(e,t){At.call(this),this.type="Points",this.geometry=e!==void 0?e:new br,this.material=t!==void 0?t:new Ko,this.updateMorphTargets()}function Ul(e,t,r,i,l,p,f){var w=kc.distanceSqToPoint(e);if(w<r){var L=new Le;kc.closestPointToPoint(e,L),L.applyMatrix4(i);var V=l.ray.origin.distanceTo(L);if(V<l.near||V>l.far)return;p.push({distance:V,distanceToRay:Math.sqrt(w),point:L,index:t,face:null,object:f})}}function Hl(e,t,r,i,l,p,f,w,L){Yn.call(this,e,t,r,i,l,p,f,w,L),this.format=f!==void 0?f:Sn,this.minFilter=p!==void 0?p:Tr,this.magFilter=l!==void 0?l:Tr,this.generateMipmaps=!1}function Nc(e,t,r,i,l,p,f,w,L,V,Z,ee){Yn.call(this,null,p,f,w,L,V,i,l,Z,ee),this.image={width:t,height:r},this.mipmaps=e,this.flipY=!1,this.generateMipmaps=!1}function Eu(e,t,r,i,l,p,f,w,L){Yn.call(this,e,t,r,i,l,p,f,w,L),this.needsUpdate=!0}function Vc(e,t,r,i,l,p,f,w,L,V){if((V=V!==void 0?V:an)!==an&&V!==Mi)throw new Error("DepthTexture format must be either THREE.DepthFormat or THREE.DepthStencilFormat");r===void 0&&V===an&&(r=Gn),r===void 0&&V===Mi&&(r=Kr),Yn.call(this,null,i,l,p,f,w,V,r,L),this.image={width:e,height:t},this.magFilter=f!==void 0?f:ct,this.minFilter=w!==void 0?w:ct,this.flipY=!1,this.generateMipmaps=!1}function Ou(e){br.call(this),this.type="WireframeGeometry";var t,r,i,l,p,f,w,L,V,Z,ee=[],ae=[0,0],W={},he=["a","b","c"];if(e&&e.isGeometry){var ge=e.faces;for(t=0,i=ge.length;t<i;t++){var ye=ge[t];for(r=0;r<3;r++)w=ye[he[r]],L=ye[he[(r+1)%3]],ae[0]=Math.min(w,L),ae[1]=Math.max(w,L),W[V=ae[0]+","+ae[1]]===void 0&&(W[V]={index1:ae[0],index2:ae[1]})}for(V in W)f=W[V],Z=e.vertices[f.index1],ee.push(Z.x,Z.y,Z.z),Z=e.vertices[f.index2],ee.push(Z.x,Z.y,Z.z)}else if(e&&e.isBufferGeometry){var Ae,je,He,et,Ge,it;if(Z=new Le,e.index!==null){for(Ae=e.attributes.position,je=e.index,(He=e.groups).length===0&&(He=[{start:0,count:je.count,materialIndex:0}]),l=0,p=He.length;l<p;++l)for(i=(t=(et=He[l]).start)+et.count;t<i;t+=3)for(r=0;r<3;r++)w=je.getX(t+r),L=je.getX(t+(r+1)%3),ae[0]=Math.min(w,L),ae[1]=Math.max(w,L),W[V=ae[0]+","+ae[1]]===void 0&&(W[V]={index1:ae[0],index2:ae[1]});for(V in W)f=W[V],Z.fromBufferAttribute(Ae,f.index1),ee.push(Z.x,Z.y,Z.z),Z.fromBufferAttribute(Ae,f.index2),ee.push(Z.x,Z.y,Z.z)}else for(t=0,i=(Ae=e.attributes.position).count/3;t<i;t++)for(r=0;r<3;r++)Ge=3*t+r,Z.fromBufferAttribute(Ae,Ge),ee.push(Z.x,Z.y,Z.z),it=3*t+(r+1)%3,Z.fromBufferAttribute(Ae,it),ee.push(Z.x,Z.y,Z.z)}this.setAttribute("position",new tr(ee,3))}function Ka(e,t,r){un.call(this),this.type="ParametricGeometry",this.parameters={func:e,slices:t,stacks:r},this.fromBufferGeometry(new Au(e,t,r)),this.mergeVertices()}function Au(e,t,r){br.call(this),this.type="ParametricBufferGeometry",this.parameters={func:e,slices:t,stacks:r};var i,l,p=[],f=[],w=[],L=[],V=new Le,Z=new Le,ee=new Le,ae=new Le,W=new Le;e.length<3&&console.error("THREE.ParametricGeometry: Function must now modify a Vector3 as third parameter.");var he=t+1;for(i=0;i<=r;i++){var ge=i/r;for(l=0;l<=t;l++){var ye=l/t;e(ye,ge,Z),f.push(Z.x,Z.y,Z.z),0<=ye-1e-5?(e(ye-1e-5,ge,ee),ae.subVectors(Z,ee)):(e(1e-5+ye,ge,ee),ae.subVectors(ee,Z)),0<=ge-1e-5?(e(ye,ge-1e-5,ee),W.subVectors(Z,ee)):(e(ye,1e-5+ge,ee),W.subVectors(ee,Z)),V.crossVectors(ae,W).normalize(),w.push(V.x,V.y,V.z),L.push(ye,ge)}}for(i=0;i<r;i++)for(l=0;l<t;l++){var Ae=i*he+l,je=i*he+l+1,He=(i+1)*he+l+1,et=(i+1)*he+l;p.push(Ae,je,et),p.push(je,He,et)}this.setIndex(p),this.setAttribute("position",new tr(f,3)),this.setAttribute("normal",new tr(w,3)),this.setAttribute("uv",new tr(L,2))}function Fc(e,t,r,i){un.call(this),this.type="PolyhedronGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},this.fromBufferGeometry(new ia(e,t,r,i)),this.mergeVertices()}function ia(e,t,r,i){br.call(this),this.type="PolyhedronBufferGeometry",this.parameters={vertices:e,indices:t,radius:r,detail:i},r=r||1;var l=[],p=[];function f(ee,ae,W,he){var ge,ye,Ae=Math.pow(2,he),je=[];for(ge=0;ge<=Ae;ge++){je[ge]=[];var He=ee.clone().lerp(W,ge/Ae),et=ae.clone().lerp(W,ge/Ae),Ge=Ae-ge;for(ye=0;ye<=Ge;ye++)je[ge][ye]=ye===0&&ge===Ae?He:He.clone().lerp(et,ye/Ge)}for(ge=0;ge<Ae;ge++)for(ye=0;ye<2*(Ae-ge)-1;ye++){var it=Math.floor(ye/2);ye%2==0?(w(je[ge][it+1]),w(je[ge+1][it]),w(je[ge][it])):(w(je[ge][it+1]),w(je[ge+1][it+1]),w(je[ge+1][it]))}}function w(ee){l.push(ee.x,ee.y,ee.z)}function L(ee,ae){var W=3*ee;ae.x=e[0+W],ae.y=e[1+W],ae.z=e[2+W]}function V(ee,ae,W,he){he<0&&ee.x===1&&(p[ae]=ee.x-1),W.x===0&&W.z===0&&(p[ae]=he/2/Math.PI+.5)}function Z(ee){return Math.atan2(ee.z,-ee.x)}(function(ee){for(var ae=new Le,W=new Le,he=new Le,ge=0;ge<t.length;ge+=3)L(t[ge+0],ae),L(t[ge+1],W),L(t[ge+2],he),f(ae,W,he,ee)})(i=i||0),function(ee){for(var ae=new Le,W=0;W<l.length;W+=3)ae.x=l[W+0],ae.y=l[W+1],ae.z=l[W+2],ae.normalize().multiplyScalar(ee),l[W+0]=ae.x,l[W+1]=ae.y,l[W+2]=ae.z}(r),function(){for(var ee=new Le,ae=0;ae<l.length;ae+=3){ee.x=l[ae+0],ee.y=l[ae+1],ee.z=l[ae+2];var W=Z(ee)/2/Math.PI+.5,he=(ge=ee,Math.atan2(-ge.y,Math.sqrt(ge.x*ge.x+ge.z*ge.z))/Math.PI+.5);p.push(W,1-he)}var ge;(function(){for(var ye=new Le,Ae=new Le,je=new Le,He=new Le,et=new Gt,Ge=new Gt,it=new Gt,qe=0,vt=0;qe<l.length;qe+=9,vt+=6){ye.set(l[qe+0],l[qe+1],l[qe+2]),Ae.set(l[qe+3],l[qe+4],l[qe+5]),je.set(l[qe+6],l[qe+7],l[qe+8]),et.set(p[vt+0],p[vt+1]),Ge.set(p[vt+2],p[vt+3]),it.set(p[vt+4],p[vt+5]),He.copy(ye).add(Ae).add(je).divideScalar(3);var Tt=Z(He);V(et,vt+0,ye,Tt),V(Ge,vt+2,Ae,Tt),V(it,vt+4,je,Tt)}})(),function(){for(var ye=0;ye<p.length;ye+=6){var Ae=p[ye+0],je=p[ye+2],He=p[ye+4],et=Math.max(Ae,je,He),Ge=Math.min(Ae,je,He);.9<et&&Ge<.1&&(Ae<.2&&(p[ye+0]+=1),je<.2&&(p[ye+2]+=1),He<.2&&(p[ye+4]+=1))}}()}(),this.setAttribute("position",new tr(l,3)),this.setAttribute("normal",new tr(l.slice(),3)),this.setAttribute("uv",new tr(p,2)),i===0?this.computeVertexNormals():this.normalizeNormals()}function yn(e,t){un.call(this),this.type="TetrahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Pu(e,t)),this.mergeVertices()}function Pu(e,t){ia.call(this,[1,1,1,-1,-1,1,-1,1,-1,1,-1,-1],[2,1,0,0,3,2,1,3,0,2,3,1],e,t),this.type="TetrahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Da(e,t){un.call(this),this.type="OctahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new yi(e,t)),this.mergeVertices()}function yi(e,t){ia.call(this,[1,0,0,-1,0,0,0,1,0,0,-1,0,0,0,1,0,0,-1],[0,2,4,0,4,3,0,3,5,0,5,2,1,2,5,1,5,3,1,3,4,1,4,2],e,t),this.type="OctahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Io(e,t){un.call(this),this.type="IcosahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new Ru(e,t)),this.mergeVertices()}function Ru(e,t){var r=(1+Math.sqrt(5))/2;ia.call(this,[-1,r,0,1,r,0,-1,-r,0,1,-r,0,0,-1,r,0,1,r,0,-1,-r,0,1,-r,r,0,-1,r,0,1,-r,0,-1,-r,0,1],[0,11,5,0,5,1,0,1,7,0,7,10,0,10,11,1,5,9,5,11,4,11,10,2,10,7,6,7,1,8,3,9,4,3,4,2,3,2,6,3,6,8,3,8,9,4,9,5,2,4,11,6,2,10,8,6,7,9,8,1],e,t),this.type="IcosahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Wl(e,t){un.call(this),this.type="DodecahedronGeometry",this.parameters={radius:e,detail:t},this.fromBufferGeometry(new po(e,t)),this.mergeVertices()}function po(e,t){var r=(1+Math.sqrt(5))/2,i=1/r;ia.call(this,[-1,-1,-1,-1,-1,1,-1,1,-1,-1,1,1,1,-1,-1,1,-1,1,1,1,-1,1,1,1,0,-i,-r,0,-i,r,0,i,-r,0,i,r,-i,-r,0,-i,r,0,i,-r,0,i,r,0,-r,0,-i,r,0,-i,-r,0,i,r,0,i],[3,11,7,3,7,15,3,15,13,7,19,17,7,17,6,7,6,15,17,4,8,17,8,10,17,10,6,8,0,16,8,16,2,8,2,10,0,12,1,0,1,18,0,18,16,6,10,2,6,2,13,6,13,15,2,16,18,2,18,3,2,3,13,18,1,9,18,9,11,18,11,3,4,14,12,4,12,0,4,0,8,11,9,5,11,5,19,11,19,7,19,5,14,19,14,4,19,4,17,1,12,14,1,14,5,1,5,9],e,t),this.type="DodecahedronBufferGeometry",this.parameters={radius:e,detail:t}}function Lu(e,t,r,i,l,p){un.call(this),this.type="TubeGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:l},p!==void 0&&console.warn("THREE.TubeGeometry: taper has been removed.");var f=new Ps(e,t,r,i,l);this.tangents=f.tangents,this.normals=f.normals,this.binormals=f.binormals,this.fromBufferGeometry(f),this.mergeVertices()}function Ps(e,t,r,i,l){br.call(this),this.type="TubeBufferGeometry",this.parameters={path:e,tubularSegments:t,radius:r,radialSegments:i,closed:l},t=t||64,r=r||1,i=i||8,l=l||!1;var p=e.computeFrenetFrames(t,l);this.tangents=p.tangents,this.normals=p.normals,this.binormals=p.binormals;var f,w,L=new Le,V=new Le,Z=new Gt,ee=new Le,ae=[],W=[],he=[],ge=[];function ye(Ae){ee=e.getPointAt(Ae/t,ee);var je=p.normals[Ae],He=p.binormals[Ae];for(w=0;w<=i;w++){var et=w/i*Math.PI*2,Ge=Math.sin(et),it=-Math.cos(et);V.x=it*je.x+Ge*He.x,V.y=it*je.y+Ge*He.y,V.z=it*je.z+Ge*He.z,V.normalize(),W.push(V.x,V.y,V.z),L.x=ee.x+r*V.x,L.y=ee.y+r*V.y,L.z=ee.z+r*V.z,ae.push(L.x,L.y,L.z)}}(function(){for(f=0;f<t;f++)ye(f);ye(l===!1?t:0),function(){for(f=0;f<=t;f++)for(w=0;w<=i;w++)Z.x=f/t,Z.y=w/i,he.push(Z.x,Z.y)}(),function(){for(w=1;w<=t;w++)for(f=1;f<=i;f++){var Ae=(i+1)*(w-1)+(f-1),je=(i+1)*w+(f-1),He=(i+1)*w+f,et=(i+1)*(w-1)+f;ge.push(Ae,je,et),ge.push(je,He,et)}}()})(),this.setIndex(ge),this.setAttribute("position",new tr(ae,3)),this.setAttribute("normal",new tr(W,3)),this.setAttribute("uv",new tr(he,2))}function vi(e,t,r,i,l,p,f){un.call(this),this.type="TorusKnotGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:l,q:p},f!==void 0&&console.warn("THREE.TorusKnotGeometry: heightScale has been deprecated. Use .scale( x, y, z ) instead."),this.fromBufferGeometry(new xi(e,t,r,i,l,p)),this.mergeVertices()}function xi(e,t,r,i,l,p){br.call(this),this.type="TorusKnotBufferGeometry",this.parameters={radius:e,tube:t,tubularSegments:r,radialSegments:i,p:l,q:p},e=e||1,t=t||.4,r=Math.floor(r)||64,i=Math.floor(i)||8,l=l||2,p=p||3;var f,w,L=[],V=[],Z=[],ee=[],ae=new Le,W=new Le,he=new Le,ge=new Le,ye=new Le,Ae=new Le,je=new Le;for(f=0;f<=r;++f){var He=f/r*l*Math.PI*2;for(Ot(He,l,p,e,he),Ot(.01+He,l,p,e,ge),Ae.subVectors(ge,he),je.addVectors(ge,he),ye.crossVectors(Ae,je),je.crossVectors(ye,Ae),ye.normalize(),je.normalize(),w=0;w<=i;++w){var et=w/i*Math.PI*2,Ge=-t*Math.cos(et),it=t*Math.sin(et);ae.x=he.x+(Ge*je.x+it*ye.x),ae.y=he.y+(Ge*je.y+it*ye.y),ae.z=he.z+(Ge*je.z+it*ye.z),V.push(ae.x,ae.y,ae.z),W.subVectors(ae,he).normalize(),Z.push(W.x,W.y,W.z),ee.push(f/r),ee.push(w/i)}}for(w=1;w<=r;w++)for(f=1;f<=i;f++){var qe=(i+1)*(w-1)+(f-1),vt=(i+1)*w+(f-1),Tt=(i+1)*w+f,Et=(i+1)*(w-1)+f;L.push(qe,vt,Et),L.push(vt,Tt,Et)}function Ot(Bt,Xt,Dt,Mt,lr){var yr=Math.cos(Bt),$r=Math.sin(Bt),Xr=Dt/Xt*Bt,Vr=Math.cos(Xr);lr.x=Mt*(2+Vr)*.5*yr,lr.y=Mt*(2+Vr)*$r*.5,lr.z=Mt*Math.sin(Xr)*.5}this.setIndex(L),this.setAttribute("position",new tr(V,3)),this.setAttribute("normal",new tr(Z,3)),this.setAttribute("uv",new tr(ee,2))}function Iu(e,t,r,i,l){un.call(this),this.type="TorusGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:l},this.fromBufferGeometry(new Jl(e,t,r,i,l)),this.mergeVertices()}function Jl(e,t,r,i,l){br.call(this),this.type="TorusBufferGeometry",this.parameters={radius:e,tube:t,radialSegments:r,tubularSegments:i,arc:l},e=e||1,t=t||.4,r=Math.floor(r)||8,i=Math.floor(i)||6,l=l||2*Math.PI;var p,f,w=[],L=[],V=[],Z=[],ee=new Le,ae=new Le,W=new Le;for(p=0;p<=r;p++)for(f=0;f<=i;f++){var he=f/i*l,ge=p/r*Math.PI*2;ae.x=(e+t*Math.cos(ge))*Math.cos(he),ae.y=(e+t*Math.cos(ge))*Math.sin(he),ae.z=t*Math.sin(ge),L.push(ae.x,ae.y,ae.z),ee.x=e*Math.cos(he),ee.y=e*Math.sin(he),W.subVectors(ae,ee).normalize(),V.push(W.x,W.y,W.z),Z.push(f/i),Z.push(p/r)}for(p=1;p<=r;p++)for(f=1;f<=i;f++){var ye=(i+1)*p+f-1,Ae=(i+1)*(p-1)+f-1,je=(i+1)*(p-1)+f,He=(i+1)*p+f;w.push(ye,Ae,He),w.push(Ae,je,He)}this.setIndex(w),this.setAttribute("position",new tr(L,3)),this.setAttribute("normal",new tr(V,3)),this.setAttribute("uv",new tr(Z,2))}function ql(e,t,r,i,l){var p,f;if(l===0<function(w,L,V,Z){for(var ee=0,ae=L,W=V-Z;ae<V;ae+=Z)ee+=(w[W]-w[ae])*(w[ae+1]+w[W+1]),W=ae;return ee}(e,t,r,i))for(p=t;p<r;p+=i)f=ju(p,e[p],e[p+1],f);else for(p=r-i;t<=p;p-=i)f=ju(p,e[p],e[p+1],f);return f&&Rs(f,f.next)&&(Nu(f),f=f.next),f}function ll(e,t){if(!e)return e;t=t||e;var r,i=e;do if(r=!1,i.steiner||!Rs(i,i.next)&&oi(i.prev,i,i.next)!==0)i=i.next;else{if(Nu(i),(i=t=i.prev)===i.next)break;r=!0}while(r||i!==t);return t}function Xl(e,t,r,i,l,p,f){if(e){!f&&p&&function(Z,ee,ae,W){for(var he=Z;he.z===null&&(he.z=ko(he.x,he.y,ee,ae,W)),he.prevZ=he.prev,he.nextZ=he.next,(he=he.next)!==Z;);he.prevZ.nextZ=null,he.prevZ=null,function(ge){var ye,Ae,je,He,et,Ge,it,qe,vt=1;do{for(Ae=ge,et=ge=null,Ge=0;Ae;){for(Ge++,je=Ae,ye=it=0;ye<vt&&(it++,je=je.nextZ);ye++);for(qe=vt;0<it||0<qe&&je;)it!==0&&(qe===0||!je||Ae.z<=je.z)?(Ae=(He=Ae).nextZ,it--):(je=(He=je).nextZ,qe--),et?et.nextZ=He:ge=He,He.prevZ=et,et=He;Ae=je}et.nextZ=null,vt*=2}while(1<Ge)}(he)}(e,i,l,p);for(var w,L,V=e;e.prev!==e.next;)if(w=e.prev,L=e.next,p?fo(e,i,l,p):Bc(e))t.push(w.i/r),t.push(e.i/r),t.push(L.i/r),Nu(e),e=L.next,V=L.next;else if((e=L)===V){f?f===1?Xl(e=Yl(e,t,r),t,r,i,l,p,2):f===2&&Yp(e,t,r,i,l,p):Xl(ll(e),t,r,i,l,p,1);break}}}function Bc(e){var t=e.prev,r=e,i=e.next;if(!(0<=oi(t,r,i))){for(var l=e.next.next;l!==e.prev;){if(ul(t.x,t.y,r.x,r.y,i.x,i.y,l.x,l.y)&&0<=oi(l.prev,l,l.next))return;l=l.next}return 1}}function fo(e,t,r,i){var l=e.prev,p=e,f=e.next;if(!(0<=oi(l,p,f))){for(var w=l.x<p.x?l.x<f.x?l.x:f.x:p.x<f.x?p.x:f.x,L=l.y<p.y?l.y<f.y?l.y:f.y:p.y<f.y?p.y:f.y,V=l.x>p.x?l.x>f.x?l.x:f.x:p.x>f.x?p.x:f.x,Z=l.y>p.y?l.y>f.y?l.y:f.y:p.y>f.y?p.y:f.y,ee=ko(w,L,t,r,i),ae=ko(V,Z,t,r,i),W=e.prevZ,he=e.nextZ;W&&W.z>=ee&&he&&he.z<=ae;){if(W!==e.prev&&W!==e.next&&ul(l.x,l.y,p.x,p.y,f.x,f.y,W.x,W.y)&&0<=oi(W.prev,W,W.next)||(W=W.prevZ,he!==e.prev&&he!==e.next&&ul(l.x,l.y,p.x,p.y,f.x,f.y,he.x,he.y)&&0<=oi(he.prev,he,he.next)))return;he=he.nextZ}for(;W&&W.z>=ee;){if(W!==e.prev&&W!==e.next&&ul(l.x,l.y,p.x,p.y,f.x,f.y,W.x,W.y)&&0<=oi(W.prev,W,W.next))return;W=W.prevZ}for(;he&&he.z<=ae;){if(he!==e.prev&&he!==e.next&&ul(l.x,l.y,p.x,p.y,f.x,f.y,he.x,he.y)&&0<=oi(he.prev,he,he.next))return;he=he.nextZ}return 1}}function Yl(e,t,r){var i=e;do{var l=i.prev,p=i.next.next;!Rs(l,p)&&Qn(l,i,i.next,p)&&ku(l,p)&&ku(p,l)&&(t.push(l.i/r),t.push(i.i/r),t.push(p.i/r),Nu(i),Nu(i.next),i=e=p),i=i.next}while(i!==e);return i}function Yp(e,t,r,i,l,p){var f,w,L=e;do{for(var V=L.next.next;V!==L.prev;){if(L.i!==V.i&&(w=V,(f=L).next.i!==w.i&&f.prev.i!==w.i&&!function(ee,ae){var W=ee;do{if(W.i!==ee.i&&W.next.i!==ee.i&&W.i!==ae.i&&W.next.i!==ae.i&&Qn(W,W.next,ee,ae))return 1;W=W.next}while(W!==ee)}(f,w)&&ku(f,w)&&ku(w,f)&&function(ee,ae){for(var W=ee,he=!1,ge=(ee.x+ae.x)/2,ye=(ee.y+ae.y)/2;W.y>ye!=W.next.y>ye&&W.next.y!==W.y&&ge<(W.next.x-W.x)*(ye-W.y)/(W.next.y-W.y)+W.x&&(he=!he),(W=W.next)!==ee;);return he}(f,w))){var Z=jh(L,V);return L=ll(L,L.next),Z=ll(Z,Z.next),Xl(L,t,r,i,l,p),void Xl(Z,t,r,i,l,p)}V=V.next}L=L.next}while(L!==e)}function Zp(e,t){return e.x-t.x}function pp(e,t){if(t=function(i,l){var p,f=l,w=i.x,L=i.y,V=-1/0;do{if(L<=f.y&&L>=f.next.y&&f.next.y!==f.y){var Z=f.x+(L-f.y)*(f.next.x-f.x)/(f.next.y-f.y);if(Z<=w&&V<Z){if((V=Z)===w){if(L===f.y)return f;if(L===f.next.y)return f.next}p=f.x<f.next.x?f:f.next}}f=f.next}while(f!==l);if(!p)return null;if(w===V)return p.prev;var ee,ae=p,W=p.x,he=p.y,ge=1/0;for(f=p.next;f!==ae;)w>=f.x&&f.x>=W&&w!==f.x&&ul(L<he?w:V,L,W,he,L<he?V:w,L,f.x,f.y)&&((ee=Math.abs(L-f.y)/(w-f.x))<ge||ee===ge&&f.x>p.x)&&ku(f,i)&&(p=f,ge=ee),f=f.next;return p}(e,t)){var r=jh(t,e);ll(r,r.next)}}function ko(e,t,r,i,l){return(e=1431655765&((e=858993459&((e=252645135&((e=16711935&((e=32767*(e-r)*l)|e<<8))|e<<4))|e<<2))|e<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=32767*(t-i)*l)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function On(e){for(var t=e,r=e;(t.x<r.x||t.x===r.x&&t.y<r.y)&&(r=t),(t=t.next)!==e;);return r}function ul(e,t,r,i,l,p,f,w){return 0<=(l-f)*(t-w)-(e-f)*(p-w)&&0<=(e-f)*(i-w)-(r-f)*(t-w)&&0<=(r-f)*(p-w)-(l-f)*(i-w)}function oi(e,t,r){return(t.y-e.y)*(r.x-t.x)-(t.x-e.x)*(r.y-t.y)}function Rs(e,t){return e.x===t.x&&e.y===t.y}function Qn(e,t,r,i){return Rs(e,r)&&Rs(t,i)||Rs(e,i)&&Rs(r,t)||0<oi(e,t,r)!=0<oi(e,t,i)&&0<oi(r,i,e)!=0<oi(r,i,t)}function ku(e,t){return oi(e.prev,e,e.next)<0?0<=oi(e,t,e.next)&&0<=oi(e,e.prev,t):oi(e,t,e.prev)<0||oi(e,e.next,t)<0}function jh(e,t){var r=new Nh(e.i,e.x,e.y),i=new Nh(t.i,t.x,t.y),l=e.next,p=t.prev;return(e.next=t).prev=e,(r.next=l).prev=r,(i.next=r).prev=i,(p.next=i).prev=p,i}function ju(e,t,r,i){var l=new Nh(e,t,r);return i?(l.next=i.next,(l.prev=i).next.prev=l,i.next=l):(l.prev=l).next=l,l}function Nu(e){e.next.prev=e.prev,e.prev.next=e.next,e.prevZ&&(e.prevZ.nextZ=e.nextZ),e.nextZ&&(e.nextZ.prevZ=e.prevZ)}function Nh(e,t,r){this.i=e,this.x=t,this.y=r,this.prev=null,this.next=null,this.z=null,this.prevZ=null,this.nextZ=null,this.steiner=!1}zl.prototype=Object.assign(Object.create(At.prototype),{constructor:zl,isPoints:!0,raycast:function(e,t){var r=this.geometry,i=this.matrixWorld,l=e.params.Points.threshold;if(r.boundingSphere===null&&r.computeBoundingSphere(),Su.copy(r.boundingSphere),Su.applyMatrix4(i),Su.radius+=l,e.ray.intersectsSphere(Su)!==!1){Ic.getInverse(i),kc.copy(e.ray).applyMatrix4(Ic);var p=l/((this.scale.x+this.scale.y+this.scale.z)/3),f=p*p;if(r.isBufferGeometry){var w=r.index,L=r.attributes.position.array;if(w!==null)for(var V=w.array,Z=0,ee=V.length;Z<ee;Z++){var ae=V[Z];jc.fromArray(L,3*ae),Ul(jc,ae,f,i,e,t,this)}else{Z=0;for(var W=L.length/3;Z<W;Z++)jc.fromArray(L,3*Z),Ul(jc,Z,f,i,e,t,this)}}else{var he=r.vertices;for(Z=0,W=he.length;Z<W;Z++)Ul(he[Z],Z,f,i,e,t,this)}}},updateMorphTargets:function(){var e,t,r,i=this.geometry;if(i.isBufferGeometry){var l=i.morphAttributes,p=Object.keys(l);if(0<p.length){var f=l[p[0]];if(f!==void 0)for(this.morphTargetInfluences=[],this.morphTargetDictionary={},e=0,t=f.length;e<t;e++)r=f[e].name||String(e),this.morphTargetInfluences.push(0),this.morphTargetDictionary[r]=e}}else{var w=i.morphTargets;w!==void 0&&0<w.length&&console.error("THREE.Points.updateMorphTargets() does not support THREE.Geometry. Use THREE.BufferGeometry instead.")}},clone:function(){return new this.constructor(this.geometry,this.material).copy(this)}}),Hl.prototype=Object.assign(Object.create(Yn.prototype),{constructor:Hl,isVideoTexture:!0,update:function(){var e=this.image;e.readyState>=e.HAVE_CURRENT_DATA&&(this.needsUpdate=!0)}}),((Nc.prototype=Object.create(Yn.prototype)).constructor=Nc).prototype.isCompressedTexture=!0,((Eu.prototype=Object.create(Yn.prototype)).constructor=Eu).prototype.isCanvasTexture=!0,((Vc.prototype=Object.create(Yn.prototype)).constructor=Vc).prototype.isDepthTexture=!0,(Ou.prototype=Object.create(br.prototype)).constructor=Ou,(Ka.prototype=Object.create(un.prototype)).constructor=Ka,(Au.prototype=Object.create(br.prototype)).constructor=Au,(Fc.prototype=Object.create(un.prototype)).constructor=Fc,(ia.prototype=Object.create(br.prototype)).constructor=ia,(yn.prototype=Object.create(un.prototype)).constructor=yn,(Pu.prototype=Object.create(ia.prototype)).constructor=Pu,(Da.prototype=Object.create(un.prototype)).constructor=Da,(yi.prototype=Object.create(ia.prototype)).constructor=yi,(Io.prototype=Object.create(un.prototype)).constructor=Io,(Ru.prototype=Object.create(ia.prototype)).constructor=Ru,(Wl.prototype=Object.create(un.prototype)).constructor=Wl,(po.prototype=Object.create(ia.prototype)).constructor=po,(Lu.prototype=Object.create(un.prototype)).constructor=Lu,((Ps.prototype=Object.create(br.prototype)).constructor=Ps).prototype.toJSON=function(){var e=br.prototype.toJSON.call(this);return e.path=this.parameters.path.toJSON(),e},(vi.prototype=Object.create(un.prototype)).constructor=vi,(xi.prototype=Object.create(br.prototype)).constructor=xi,(Iu.prototype=Object.create(un.prototype)).constructor=Iu,(Jl.prototype=Object.create(br.prototype)).constructor=Jl;var hs={area:function(e){for(var t=e.length,r=0,i=t-1,l=0;l<t;i=l++)r+=e[i].x*e[l].y-e[l].x*e[i].y;return .5*r},isClockWise:function(e){return hs.area(e)<0},triangulateShape:function(e,t){var r=[],i=[],l=[];dp(e),Gc(r,e);var p=e.length;t.forEach(dp);for(var f=0;f<t.length;f++)i.push(p),p+=t[f].length,Gc(r,t[f]);var w=function(L,V,Z){Z=Z||2;var ee,ae,W,he,ge,ye,Ae,je=V&&V.length,He=je?V[0]*Z:L.length,et=ql(L,0,He,Z,!0),Ge=[];if(!et||et.next===et.prev)return Ge;if(je&&(et=function(qe,vt,Tt,Et){var Ot,Bt,Xt,Dt=[];for(Ot=0,Bt=vt.length;Ot<Bt;Ot++)(Xt=ql(qe,vt[Ot]*Et,Ot<Bt-1?vt[Ot+1]*Et:qe.length,Et,!1))===Xt.next&&(Xt.steiner=!0),Dt.push(On(Xt));for(Dt.sort(Zp),Ot=0;Ot<Dt.length;Ot++)pp(Dt[Ot],Tt),Tt=ll(Tt,Tt.next);return Tt}(L,V,et,Z)),L.length>80*Z){ee=W=L[0],ae=he=L[1];for(var it=Z;it<He;it+=Z)(ge=L[it])<ee&&(ee=ge),(ye=L[it+1])<ae&&(ae=ye),W<ge&&(W=ge),he<ye&&(he=ye);Ae=(Ae=Math.max(W-ee,he-ae))!==0?1/Ae:0}return Xl(et,Ge,Z,ee,ae,Ae),Ge}(r,i);for(f=0;f<w.length;f+=3)l.push(w.slice(f,f+3));return l}};function dp(e){var t=e.length;2<t&&e[t-1].equals(e[0])&&e.pop()}function Gc(e,t){for(var r=0;r<t.length;r++)e.push(t[r].x),e.push(t[r].y)}function cl(e,t){un.call(this),this.type="ExtrudeGeometry",this.parameters={shapes:e,options:t},this.fromBufferGeometry(new Ls(e,t)),this.mergeVertices()}function Ls(e,t){br.call(this),this.type="ExtrudeBufferGeometry",this.parameters={shapes:e,options:t};for(var r=this,i=[],l=[],p=0,f=(e=Array.isArray(e)?e:[e]).length;p<f;p++)w(e[p]);function w(L){var V=[],Z=t.curveSegments!==void 0?t.curveSegments:12,ee=t.steps!==void 0?t.steps:1,ae=t.depth!==void 0?t.depth:100,W=t.bevelEnabled===void 0||t.bevelEnabled,he=t.bevelThickness!==void 0?t.bevelThickness:6,ge=t.bevelSize!==void 0?t.bevelSize:he-2,ye=t.bevelOffset!==void 0?t.bevelOffset:0,Ae=t.bevelSegments!==void 0?t.bevelSegments:3,je=t.extrudePath,He=t.UVGenerator!==void 0?t.UVGenerator:Kp;t.amount!==void 0&&(console.warn("THREE.ExtrudeBufferGeometry: amount has been renamed to depth."),ae=t.amount);var et,Ge,it,qe,vt,Tt,Et,Ot,Bt=!1;je&&(et=je.getSpacedPoints(ee),W=!(Bt=!0),Ge=je.computeFrenetFrames(ee,!1),it=new Le,qe=new Le,vt=new Le),W||(ye=ge=he=Ae=0);var Xt=L.extractPoints(Z),Dt=Xt.shape,Mt=Xt.holes;if(!hs.isClockWise(Dt))for(Dt=Dt.reverse(),Et=0,Ot=Mt.length;Et<Ot;Et++)Tt=Mt[Et],hs.isClockWise(Tt)&&(Mt[Et]=Tt.reverse());var lr=hs.triangulateShape(Dt,Mt),yr=Dt;for(Et=0,Ot=Mt.length;Et<Ot;Et++)Tt=Mt[Et],Dt=Dt.concat(Tt);function $r(Vn,si,bi){return si||console.error("THREE.ExtrudeGeometry: vec does not exist"),si.clone().multiplyScalar(bi).add(Vn)}var Xr,Vr,hn,Mr,Ve,tt,Jt=Dt.length,Ut=lr.length;function nn(Vn,si,bi){var oa,ei,ea,eo=Vn.x-si.x,go=Vn.y-si.y,fs=bi.x-Vn.x,Fs=bi.y-Vn.y,rh=eo*eo+go*go,kd=eo*Fs-go*fs;if(Math.abs(kd)>Number.EPSILON){var nh=Math.sqrt(rh),rc=Math.sqrt(fs*fs+Fs*Fs),nc=si.x-go/nh,ic=si.y+eo/nh,ac=((bi.x-Fs/rc-nc)*Fs-(bi.y+fs/rc-ic)*fs)/(eo*Fs-go*fs),Bh=(oa=nc+eo*ac-Vn.x)*oa+(ei=ic+go*ac-Vn.y)*ei;if(Bh<=2)return new Gt(oa,ei);ea=Math.sqrt(Bh/2)}else{var To=!1;eo>Number.EPSILON?fs>Number.EPSILON&&(To=!0):eo<-Number.EPSILON?fs<-Number.EPSILON&&(To=!0):Math.sign(go)===Math.sign(Fs)&&(To=!0),ea=To?(oa=-go,ei=eo,Math.sqrt(rh)):(oa=eo,ei=go,Math.sqrt(rh/2))}return new Gt(oa/ea,ei/ea)}for(var _r=[],St=0,Dr=yr.length,pn=Dr-1,pt=St+1;St<Dr;St++,pn++,pt++)pn===Dr&&(pn=0),pt===Dr&&(pt=0),_r[St]=nn(yr[St],yr[pn],yr[pt]);var vr,xr,on=[],or=_r.concat();for(Et=0,Ot=Mt.length;Et<Ot;Et++){for(Tt=Mt[Et],vr=[],St=0,pn=(Dr=Tt.length)-1,pt=St+1;St<Dr;St++,pn++,pt++)pn===Dr&&(pn=0),pt===Dr&&(pt=0),vr[St]=nn(Tt[St],Tt[pn],Tt[pt]);on.push(vr),or=or.concat(vr)}for(Xr=0;Xr<Ae;Xr++){for(hn=Xr/Ae,Mr=he*Math.cos(hn*Math.PI/2),Vr=ge*Math.sin(hn*Math.PI/2)+ye,St=0,Dr=yr.length;St<Dr;St++)Ln((Ve=$r(yr[St],_r[St],Vr)).x,Ve.y,-Mr);for(Et=0,Ot=Mt.length;Et<Ot;Et++)for(Tt=Mt[Et],vr=on[Et],St=0,Dr=Tt.length;St<Dr;St++)Ln((Ve=$r(Tt[St],vr[St],Vr)).x,Ve.y,-Mr)}for(Vr=ge+ye,St=0;St<Jt;St++)Ve=W?$r(Dt[St],or[St],Vr):Dt[St],Bt?(qe.copy(Ge.normals[0]).multiplyScalar(Ve.x),it.copy(Ge.binormals[0]).multiplyScalar(Ve.y),vt.copy(et[0]).add(qe).add(it),Ln(vt.x,vt.y,vt.z)):Ln(Ve.x,Ve.y,0);for(xr=1;xr<=ee;xr++)for(St=0;St<Jt;St++)Ve=W?$r(Dt[St],or[St],Vr):Dt[St],Bt?(qe.copy(Ge.normals[xr]).multiplyScalar(Ve.x),it.copy(Ge.binormals[xr]).multiplyScalar(Ve.y),vt.copy(et[xr]).add(qe).add(it),Ln(vt.x,vt.y,vt.z)):Ln(Ve.x,Ve.y,ae/ee*xr);for(Xr=Ae-1;0<=Xr;Xr--){for(hn=Xr/Ae,Mr=he*Math.cos(hn*Math.PI/2),Vr=ge*Math.sin(hn*Math.PI/2)+ye,St=0,Dr=yr.length;St<Dr;St++)Ln((Ve=$r(yr[St],_r[St],Vr)).x,Ve.y,ae+Mr);for(Et=0,Ot=Mt.length;Et<Ot;Et++)for(Tt=Mt[Et],vr=on[Et],St=0,Dr=Tt.length;St<Dr;St++)Ve=$r(Tt[St],vr[St],Vr),Bt?Ln(Ve.x,Ve.y+et[ee-1].y,et[ee-1].x+Mr):Ln(Ve.x,Ve.y,ae+Mr)}function Mn(Vn,si){var bi,oa;for(St=Vn.length;0<=--St;){(oa=(bi=St)-1)<0&&(oa=Vn.length-1);var ei=0,ea=ee+2*Ae;for(ei=0;ei<ea;ei++){var eo=Jt*ei,go=Jt*(ei+1);mo(si+bi+eo,si+oa+eo,si+oa+go,si+bi+go)}}}function Ln(Vn,si,bi){V.push(Vn),V.push(si),V.push(bi)}function wi(Vn,si,bi){Bn(Vn),Bn(si),Bn(bi);var oa=i.length/3,ei=He.generateTopUV(r,i,oa-3,oa-2,oa-1);Ri(ei[0]),Ri(ei[1]),Ri(ei[2])}function mo(Vn,si,bi,oa){Bn(Vn),Bn(si),Bn(oa),Bn(si),Bn(bi),Bn(oa);var ei=i.length/3,ea=He.generateSideWallUV(r,i,ei-6,ei-3,ei-2,ei-1);Ri(ea[0]),Ri(ea[1]),Ri(ea[3]),Ri(ea[1]),Ri(ea[2]),Ri(ea[3])}function Bn(Vn){i.push(V[3*Vn+0]),i.push(V[3*Vn+1]),i.push(V[3*Vn+2])}function Ri(Vn){l.push(Vn.x),l.push(Vn.y)}(function(){var Vn=i.length/3;if(W){var si=0,bi=Jt*si;for(St=0;St<Ut;St++)wi((tt=lr[St])[2]+bi,tt[1]+bi,tt[0]+bi);for(bi=Jt*(si=ee+2*Ae),St=0;St<Ut;St++)wi((tt=lr[St])[0]+bi,tt[1]+bi,tt[2]+bi)}else{for(St=0;St<Ut;St++)wi((tt=lr[St])[2],tt[1],tt[0]);for(St=0;St<Ut;St++)wi((tt=lr[St])[0]+Jt*ee,tt[1]+Jt*ee,tt[2]+Jt*ee)}r.addGroup(Vn,i.length/3-Vn,0)})(),function(){var Vn=i.length/3,si=0;for(Mn(yr,si),si+=yr.length,Et=0,Ot=Mt.length;Et<Ot;Et++)Mn(Tt=Mt[Et],si),si+=Tt.length;r.addGroup(Vn,i.length/3-Vn,1)}()}this.setAttribute("position",new tr(i,3)),this.setAttribute("uv",new tr(l,2)),this.computeVertexNormals()}((cl.prototype=Object.create(un.prototype)).constructor=cl).prototype.toJSON=function(){var e=un.prototype.toJSON.call(this);return fp(this.parameters.shapes,this.parameters.options,e)},((Ls.prototype=Object.create(br.prototype)).constructor=Ls).prototype.toJSON=function(){var e=br.prototype.toJSON.call(this);return fp(this.parameters.shapes,this.parameters.options,e)};var Kp={generateTopUV:function(e,t,r,i,l){var p=t[3*r],f=t[3*r+1],w=t[3*i],L=t[3*i+1],V=t[3*l],Z=t[3*l+1];return[new Gt(p,f),new Gt(w,L),new Gt(V,Z)]},generateSideWallUV:function(e,t,r,i,l,p){var f=t[3*r],w=t[3*r+1],L=t[3*r+2],V=t[3*i],Z=t[3*i+1],ee=t[3*i+2],ae=t[3*l],W=t[3*l+1],he=t[3*l+2],ge=t[3*p],ye=t[3*p+1],Ae=t[3*p+2];return Math.abs(w-Z)<.01?[new Gt(f,1-L),new Gt(V,1-ee),new Gt(ae,1-he),new Gt(ge,1-Ae)]:[new Gt(w,1-L),new Gt(Z,1-ee),new Gt(W,1-he),new Gt(ye,1-Ae)]}};function fp(e,t,r){if(r.shapes=[],Array.isArray(e))for(var i=0,l=e.length;i<l;i++){var p=e[i];r.shapes.push(p.uuid)}else r.shapes.push(e.uuid);return t.extrudePath!==void 0&&(r.options.extrudePath=t.extrudePath.toJSON()),r}function Ji(e,t){un.call(this),this.type="TextGeometry",this.parameters={text:e,parameters:t},this.fromBufferGeometry(new da(e,t)),this.mergeVertices()}function da(e,t){var r=(t=t||{}).font;if(!r||!r.isFont)return console.error("THREE.TextGeometry: font parameter is not an instance of THREE.Font."),new un;var i=r.generateShapes(e,t.size);t.depth=t.height!==void 0?t.height:50,t.bevelThickness===void 0&&(t.bevelThickness=10),t.bevelSize===void 0&&(t.bevelSize=8),t.bevelEnabled===void 0&&(t.bevelEnabled=!1),Ls.call(this,i,t),this.type="TextBufferGeometry"}function zc(e,t,r,i,l,p,f){un.call(this),this.type="SphereGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:l,thetaStart:p,thetaLength:f},this.fromBufferGeometry(new hl(e,t,r,i,l,p,f)),this.mergeVertices()}function hl(e,t,r,i,l,p,f){br.call(this),this.type="SphereBufferGeometry",this.parameters={radius:e,widthSegments:t,heightSegments:r,phiStart:i,phiLength:l,thetaStart:p,thetaLength:f},e=e||1,t=Math.max(3,Math.floor(t)||8),r=Math.max(2,Math.floor(r)||6),i=i!==void 0?i:0,l=l!==void 0?l:2*Math.PI,p=p!==void 0?p:0,f=f!==void 0?f:Math.PI;var w,L,V=Math.min(p+f,Math.PI),Z=0,ee=[],ae=new Le,W=new Le,he=[],ge=[],ye=[],Ae=[];for(L=0;L<=r;L++){var je=[],He=L/r,et=0;for(L==0&&p==0?et=.5/t:L==r&&V==Math.PI&&(et=-.5/t),w=0;w<=t;w++){var Ge=w/t;ae.x=-e*Math.cos(i+Ge*l)*Math.sin(p+He*f),ae.y=e*Math.cos(p+He*f),ae.z=e*Math.sin(i+Ge*l)*Math.sin(p+He*f),ge.push(ae.x,ae.y,ae.z),W.copy(ae).normalize(),ye.push(W.x,W.y,W.z),Ae.push(Ge+et,1-He),je.push(Z++)}ee.push(je)}for(L=0;L<r;L++)for(w=0;w<t;w++){var it=ee[L][w+1],qe=ee[L][w],vt=ee[L+1][w],Tt=ee[L+1][w+1];(L!==0||0<p)&&he.push(it,qe,Tt),(L!==r-1||V<Math.PI)&&he.push(qe,vt,Tt)}this.setIndex(he),this.setAttribute("position",new tr(ge,3)),this.setAttribute("normal",new tr(ye,3)),this.setAttribute("uv",new tr(Ae,2))}function Uc(e,t,r,i,l,p){un.call(this),this.type="RingGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:l,thetaLength:p},this.fromBufferGeometry(new Vu(e,t,r,i,l,p)),this.mergeVertices()}function Vu(e,t,r,i,l,p){br.call(this),this.type="RingBufferGeometry",this.parameters={innerRadius:e,outerRadius:t,thetaSegments:r,phiSegments:i,thetaStart:l,thetaLength:p},e=e||.5,t=t||1,l=l!==void 0?l:0,p=p!==void 0?p:2*Math.PI,r=r!==void 0?Math.max(3,r):8;var f,w,L,V=[],Z=[],ee=[],ae=[],W=e,he=(t-e)/(i=i!==void 0?Math.max(1,i):1),ge=new Le,ye=new Gt;for(w=0;w<=i;w++){for(L=0;L<=r;L++)f=l+L/r*p,ge.x=W*Math.cos(f),ge.y=W*Math.sin(f),Z.push(ge.x,ge.y,ge.z),ee.push(0,0,1),ye.x=(ge.x/t+1)/2,ye.y=(ge.y/t+1)/2,ae.push(ye.x,ye.y);W+=he}for(w=0;w<i;w++){var Ae=w*(r+1);for(L=0;L<r;L++){var je=f=L+Ae,He=f+r+1,et=f+r+2,Ge=f+1;V.push(je,He,Ge),V.push(He,et,Ge)}}this.setIndex(V),this.setAttribute("position",new tr(Z,3)),this.setAttribute("normal",new tr(ee,3)),this.setAttribute("uv",new tr(ae,2))}function Fu(e,t,r,i){un.call(this),this.type="LatheGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},this.fromBufferGeometry(new Zl(e,t,r,i)),this.mergeVertices()}function Zl(e,t,r,i){br.call(this),this.type="LatheBufferGeometry",this.parameters={points:e,segments:t,phiStart:r,phiLength:i},t=Math.floor(t)||12,r=r||0,i=i||2*Math.PI,i=xn.clamp(i,0,2*Math.PI);var l,p,f,w=[],L=[],V=[],Z=1/t,ee=new Le,ae=new Gt;for(p=0;p<=t;p++){var W=r+p*Z*i,he=Math.sin(W),ge=Math.cos(W);for(f=0;f<=e.length-1;f++)ee.x=e[f].x*he,ee.y=e[f].y,ee.z=e[f].x*ge,L.push(ee.x,ee.y,ee.z),ae.x=p/t,ae.y=f/(e.length-1),V.push(ae.x,ae.y)}for(p=0;p<t;p++)for(f=0;f<e.length-1;f++){var ye=l=f+p*e.length,Ae=l+e.length,je=l+e.length+1,He=l+1;w.push(ye,Ae,He),w.push(Ae,je,He)}if(this.setIndex(w),this.setAttribute("position",new tr(L,3)),this.setAttribute("uv",new tr(V,2)),this.computeVertexNormals(),i===2*Math.PI){var et=this.attributes.normal.array,Ge=new Le,it=new Le,qe=new Le;for(l=t*e.length*3,f=p=0;p<e.length;p++,f+=3)Ge.x=et[f+0],Ge.y=et[f+1],Ge.z=et[f+2],it.x=et[l+f+0],it.y=et[l+f+1],it.z=et[l+f+2],qe.addVectors(Ge,it).normalize(),et[f+0]=et[l+f+0]=qe.x,et[f+1]=et[l+f+1]=qe.y,et[f+2]=et[l+f+2]=qe.z}}function Kl(e,t){un.call(this),this.type="ShapeGeometry",typeof t=="object"&&(console.warn("THREE.ShapeGeometry: Options parameter has been removed."),t=t.curveSegments),this.parameters={shapes:e,curveSegments:t},this.fromBufferGeometry(new $o(e,t)),this.mergeVertices()}function $o(e,t){br.call(this),this.type="ShapeBufferGeometry",this.parameters={shapes:e,curveSegments:t},t=t||12;var r=[],i=[],l=[],p=[],f=0,w=0;if(Array.isArray(e)===!1)V(e);else for(var L=0;L<e.length;L++)V(e[L]),this.addGroup(f,w,L),f+=w,w=0;function V(Z){var ee,ae,W,he=i.length/3,ge=Z.extractPoints(t),ye=ge.shape,Ae=ge.holes;for(hs.isClockWise(ye)===!1&&(ye=ye.reverse()),ee=0,ae=Ae.length;ee<ae;ee++)W=Ae[ee],hs.isClockWise(W)===!0&&(Ae[ee]=W.reverse());var je=hs.triangulateShape(ye,Ae);for(ee=0,ae=Ae.length;ee<ae;ee++)W=Ae[ee],ye=ye.concat(W);for(ee=0,ae=ye.length;ee<ae;ee++){var He=ye[ee];i.push(He.x,He.y,0),l.push(0,0,1),p.push(He.x,He.y)}for(ee=0,ae=je.length;ee<ae;ee++){var et=je[ee],Ge=et[0]+he,it=et[1]+he,qe=et[2]+he;r.push(Ge,it,qe),w+=3}}this.setIndex(r),this.setAttribute("position",new tr(i,3)),this.setAttribute("normal",new tr(l,3)),this.setAttribute("uv",new tr(p,2))}function mp(e,t){if(t.shapes=[],Array.isArray(e))for(var r=0,i=e.length;r<i;r++){var l=e[r];t.shapes.push(l.uuid)}else t.shapes.push(e.uuid);return t}function $l(e,t){br.call(this),this.type="EdgesGeometry",this.parameters={thresholdAngle:t},t=t!==void 0?t:1;var r,i,l,p,f=[],w=Math.cos(xn.DEG2RAD*t),L=[0,0],V={},Z=["a","b","c"];e.isBufferGeometry?(p=new un).fromBufferGeometry(e):p=e.clone(),p.mergeVertices(),p.computeFaceNormals();for(var ee=p.vertices,ae=p.faces,W=0,he=ae.length;W<he;W++)for(var ge=ae[W],ye=0;ye<3;ye++)r=ge[Z[ye]],i=ge[Z[(ye+1)%3]],L[0]=Math.min(r,i),L[1]=Math.max(r,i),V[l=L[0]+","+L[1]]===void 0?V[l]={index1:L[0],index2:L[1],face1:W,face2:void 0}:V[l].face2=W;for(l in V){var Ae=V[l];if(Ae.face2===void 0||ae[Ae.face1].normal.dot(ae[Ae.face2].normal)<=w){var je=ee[Ae.index1];f.push(je.x,je.y,je.z),je=ee[Ae.index2],f.push(je.x,je.y,je.z)}}this.setAttribute("position",new tr(f,3))}function pl(e,t,r,i,l,p,f,w){un.call(this),this.type="CylinderGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:l,openEnded:p,thetaStart:f,thetaLength:w},this.fromBufferGeometry(new Is(e,t,r,i,l,p,f,w)),this.mergeVertices()}function Is(e,t,r,i,l,p,f,w){br.call(this),this.type="CylinderBufferGeometry",this.parameters={radiusTop:e,radiusBottom:t,height:r,radialSegments:i,heightSegments:l,openEnded:p,thetaStart:f,thetaLength:w};var L=this;e=e!==void 0?e:1,t=t!==void 0?t:1,r=r||1,i=Math.floor(i)||8,l=Math.floor(l)||1,p=p!==void 0&&p,f=f!==void 0?f:0,w=w!==void 0?w:2*Math.PI;var V=[],Z=[],ee=[],ae=[],W=0,he=[],ge=r/2,ye=0;function Ae(je){var He,et,Ge,it=new Gt,qe=new Le,vt=0,Tt=je===!0?e:t,Et=je===!0?1:-1;for(et=W,He=1;He<=i;He++)Z.push(0,ge*Et,0),ee.push(0,Et,0),ae.push(.5,.5),W++;for(Ge=W,He=0;He<=i;He++){var Ot=He/i*w+f,Bt=Math.cos(Ot),Xt=Math.sin(Ot);qe.x=Tt*Xt,qe.y=ge*Et,qe.z=Tt*Bt,Z.push(qe.x,qe.y,qe.z),ee.push(0,Et,0),it.x=.5*Bt+.5,it.y=.5*Xt*Et+.5,ae.push(it.x,it.y),W++}for(He=0;He<i;He++){var Dt=et+He,Mt=Ge+He;je===!0?V.push(Mt,Mt+1,Dt):V.push(Mt+1,Mt,Dt),vt+=3}L.addGroup(ye,vt,je===!0?1:2),ye+=vt}(function(){var je,He,et=new Le,Ge=new Le,it=0,qe=(t-e)/r;for(He=0;He<=l;He++){var vt=[],Tt=He/l,Et=Tt*(t-e)+e;for(je=0;je<=i;je++){var Ot=je/i,Bt=Ot*w+f,Xt=Math.sin(Bt),Dt=Math.cos(Bt);Ge.x=Et*Xt,Ge.y=-Tt*r+ge,Ge.z=Et*Dt,Z.push(Ge.x,Ge.y,Ge.z),et.set(Xt,qe,Dt).normalize(),ee.push(et.x,et.y,et.z),ae.push(Ot,1-Tt),vt.push(W++)}he.push(vt)}for(je=0;je<i;je++)for(He=0;He<l;He++){var Mt=he[He][je],lr=he[He+1][je],yr=he[He+1][je+1],$r=he[He][je+1];V.push(Mt,lr,$r),V.push(lr,yr,$r),it+=6}L.addGroup(ye,it,0),ye+=it})(),p===!1&&(0<e&&Ae(!0),0<t&&Ae(!1)),this.setIndex(V),this.setAttribute("position",new tr(Z,3)),this.setAttribute("normal",new tr(ee,3)),this.setAttribute("uv",new tr(ae,2))}function Hc(e,t,r,i,l,p,f){pl.call(this,0,e,t,r,i,l,p,f),this.type="ConeGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:l,thetaStart:p,thetaLength:f}}function Wc(e,t,r,i,l,p,f){Is.call(this,0,e,t,r,i,l,p,f),this.type="ConeBufferGeometry",this.parameters={radius:e,height:t,radialSegments:r,heightSegments:i,openEnded:l,thetaStart:p,thetaLength:f}}function Jc(e,t,r,i){un.call(this),this.type="CircleGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},this.fromBufferGeometry(new Bu(e,t,r,i)),this.mergeVertices()}function Bu(e,t,r,i){br.call(this),this.type="CircleBufferGeometry",this.parameters={radius:e,segments:t,thetaStart:r,thetaLength:i},e=e||1,t=t!==void 0?Math.max(3,t):8,r=r!==void 0?r:0,i=i!==void 0?i:2*Math.PI;var l,p,f=[],w=[],L=[],V=[],Z=new Le,ee=new Gt;for(w.push(0,0,0),L.push(0,0,1),V.push(.5,.5),p=0,l=3;p<=t;p++,l+=3){var ae=r+p/t*i;Z.x=e*Math.cos(ae),Z.y=e*Math.sin(ae),w.push(Z.x,Z.y,Z.z),L.push(0,0,1),ee.x=(w[l]/e+1)/2,ee.y=(w[l+1]/e+1)/2,V.push(ee.x,ee.y)}for(l=1;l<=t;l++)f.push(l,l+1,0);this.setIndex(f),this.setAttribute("position",new tr(w,3)),this.setAttribute("normal",new tr(L,3)),this.setAttribute("uv",new tr(V,2))}(Ji.prototype=Object.create(un.prototype)).constructor=Ji,(da.prototype=Object.create(Ls.prototype)).constructor=da,(zc.prototype=Object.create(un.prototype)).constructor=zc,(hl.prototype=Object.create(br.prototype)).constructor=hl,(Uc.prototype=Object.create(un.prototype)).constructor=Uc,(Vu.prototype=Object.create(br.prototype)).constructor=Vu,(Fu.prototype=Object.create(un.prototype)).constructor=Fu,(Zl.prototype=Object.create(br.prototype)).constructor=Zl,((Kl.prototype=Object.create(un.prototype)).constructor=Kl).prototype.toJSON=function(){var e=un.prototype.toJSON.call(this);return mp(this.parameters.shapes,e)},(($o.prototype=Object.create(br.prototype)).constructor=$o).prototype.toJSON=function(){var e=br.prototype.toJSON.call(this);return mp(this.parameters.shapes,e)},($l.prototype=Object.create(br.prototype)).constructor=$l,(pl.prototype=Object.create(un.prototype)).constructor=pl,(Is.prototype=Object.create(br.prototype)).constructor=Is,(Hc.prototype=Object.create(pl.prototype)).constructor=Hc,(Wc.prototype=Object.create(Is.prototype)).constructor=Wc,(Jc.prototype=Object.create(un.prototype)).constructor=Jc,(Bu.prototype=Object.create(br.prototype)).constructor=Bu;var Ba=Object.freeze({__proto__:null,WireframeGeometry:Ou,ParametricGeometry:Ka,ParametricBufferGeometry:Au,TetrahedronGeometry:yn,TetrahedronBufferGeometry:Pu,OctahedronGeometry:Da,OctahedronBufferGeometry:yi,IcosahedronGeometry:Io,IcosahedronBufferGeometry:Ru,DodecahedronGeometry:Wl,DodecahedronBufferGeometry:po,PolyhedronGeometry:Fc,PolyhedronBufferGeometry:ia,TubeGeometry:Lu,TubeBufferGeometry:Ps,TorusKnotGeometry:vi,TorusKnotBufferGeometry:xi,TorusGeometry:Iu,TorusBufferGeometry:Jl,TextGeometry:Ji,TextBufferGeometry:da,SphereGeometry:zc,SphereBufferGeometry:hl,RingGeometry:Uc,RingBufferGeometry:Vu,PlaneGeometry:Rl,PlaneBufferGeometry:Qs,LatheGeometry:Fu,LatheBufferGeometry:Zl,ShapeGeometry:Kl,ShapeBufferGeometry:$o,ExtrudeGeometry:cl,ExtrudeBufferGeometry:Ls,EdgesGeometry:$l,ConeGeometry:Hc,ConeBufferGeometry:Wc,CylinderGeometry:pl,CylinderBufferGeometry:Is,CircleGeometry:Jc,CircleBufferGeometry:Bu,BoxGeometry:oh,BoxBufferGeometry:lu});function dl(e){kt.call(this),this.type="ShadowMaterial",this.color=new Qe(0),this.transparent=!0,this.setValues(e)}function ks(e){Xa.call(this,e),this.type="RawShaderMaterial"}function ps(e){kt.call(this),this.defines={STANDARD:""},this.type="MeshStandardMaterial",this.color=new Qe(16777215),this.roughness=1,this.metalness=0,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new Gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.roughnessMap=null,this.metalnessMap=null,this.alphaMap=null,this.envMap=null,this.envMapIntensity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Gu(e){ps.call(this),this.defines={STANDARD:"",PHYSICAL:""},this.type="MeshPhysicalMaterial",this.reflectivity=.5,this.clearcoat=0,this.clearcoatRoughness=0,this.sheen=null,this.clearcoatNormalScale=new Gt(1,1),this.clearcoatNormalMap=null,this.transparency=0,this.setValues(e)}function js(e){kt.call(this),this.type="MeshPhongMaterial",this.color=new Qe(16777215),this.specular=new Qe(1118481),this.shininess=30,this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new Gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ie,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function zu(e){kt.call(this),this.defines={TOON:""},this.type="MeshToonMaterial",this.color=new Qe(16777215),this.specular=new Qe(1118481),this.shininess=30,this.map=null,this.gradientMap=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new Gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.specularMap=null,this.alphaMap=null,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Uu(e){kt.call(this),this.type="MeshNormalMaterial",this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new Gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.wireframe=!1,this.wireframeLinewidth=1,this.fog=!1,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function fa(e){kt.call(this),this.type="MeshLambertMaterial",this.color=new Qe(16777215),this.map=null,this.lightMap=null,this.lightMapIntensity=1,this.aoMap=null,this.aoMapIntensity=1,this.emissive=new Qe(0),this.emissiveIntensity=1,this.emissiveMap=null,this.specularMap=null,this.alphaMap=null,this.envMap=null,this.combine=Ie,this.reflectivity=1,this.refractionRatio=.98,this.wireframe=!1,this.wireframeLinewidth=1,this.wireframeLinecap="round",this.wireframeLinejoin="round",this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function fl(e){kt.call(this),this.defines={MATCAP:""},this.type="MeshMatcapMaterial",this.color=new Qe(16777215),this.matcap=null,this.map=null,this.bumpMap=null,this.bumpScale=1,this.normalMap=null,this.normalMapType=xo,this.normalScale=new Gt(1,1),this.displacementMap=null,this.displacementScale=1,this.displacementBias=0,this.alphaMap=null,this.skinning=!1,this.morphTargets=!1,this.morphNormals=!1,this.setValues(e)}function Hu(e){Vi.call(this),this.type="LineDashedMaterial",this.scale=1,this.dashSize=3,this.gapSize=1,this.setValues(e)}((dl.prototype=Object.create(kt.prototype)).constructor=dl).prototype.isShadowMaterial=!0,dl.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.color.copy(e.color),this},((ks.prototype=Object.create(Xa.prototype)).constructor=ks).prototype.isRawShaderMaterial=!0,((ps.prototype=Object.create(kt.prototype)).constructor=ps).prototype.isMeshStandardMaterial=!0,ps.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.defines={STANDARD:""},this.color.copy(e.color),this.roughness=e.roughness,this.metalness=e.metalness,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.roughnessMap=e.roughnessMap,this.metalnessMap=e.metalnessMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.envMapIntensity=e.envMapIntensity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Gu.prototype=Object.create(ps.prototype)).constructor=Gu).prototype.isMeshPhysicalMaterial=!0,Gu.prototype.copy=function(e){return ps.prototype.copy.call(this,e),this.defines={STANDARD:"",PHYSICAL:""},this.reflectivity=e.reflectivity,this.clearcoat=e.clearcoat,this.clearcoatRoughness=e.clearcoatRoughness,e.sheen?this.sheen=(this.sheen||new Qe).copy(e.sheen):this.sheen=null,this.clearcoatNormalMap=e.clearcoatNormalMap,this.clearcoatNormalScale.copy(e.clearcoatNormalScale),this.transparency=e.transparency,this},((js.prototype=Object.create(kt.prototype)).constructor=js).prototype.isMeshPhongMaterial=!0,js.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((zu.prototype=Object.create(kt.prototype)).constructor=zu).prototype.isMeshToonMaterial=!0,zu.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.color.copy(e.color),this.specular.copy(e.specular),this.shininess=e.shininess,this.map=e.map,this.gradientMap=e.gradientMap,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Uu.prototype=Object.create(kt.prototype)).constructor=Uu).prototype.isMeshNormalMaterial=!0,Uu.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((fa.prototype=Object.create(kt.prototype)).constructor=fa).prototype.isMeshLambertMaterial=!0,fa.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.color.copy(e.color),this.map=e.map,this.lightMap=e.lightMap,this.lightMapIntensity=e.lightMapIntensity,this.aoMap=e.aoMap,this.aoMapIntensity=e.aoMapIntensity,this.emissive.copy(e.emissive),this.emissiveMap=e.emissiveMap,this.emissiveIntensity=e.emissiveIntensity,this.specularMap=e.specularMap,this.alphaMap=e.alphaMap,this.envMap=e.envMap,this.combine=e.combine,this.reflectivity=e.reflectivity,this.refractionRatio=e.refractionRatio,this.wireframe=e.wireframe,this.wireframeLinewidth=e.wireframeLinewidth,this.wireframeLinecap=e.wireframeLinecap,this.wireframeLinejoin=e.wireframeLinejoin,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((fl.prototype=Object.create(kt.prototype)).constructor=fl).prototype.isMeshMatcapMaterial=!0,fl.prototype.copy=function(e){return kt.prototype.copy.call(this,e),this.defines={MATCAP:""},this.color.copy(e.color),this.matcap=e.matcap,this.map=e.map,this.bumpMap=e.bumpMap,this.bumpScale=e.bumpScale,this.normalMap=e.normalMap,this.normalMapType=e.normalMapType,this.normalScale.copy(e.normalScale),this.displacementMap=e.displacementMap,this.displacementScale=e.displacementScale,this.displacementBias=e.displacementBias,this.alphaMap=e.alphaMap,this.skinning=e.skinning,this.morphTargets=e.morphTargets,this.morphNormals=e.morphNormals,this},((Hu.prototype=Object.create(Vi.prototype)).constructor=Hu).prototype.isLineDashedMaterial=!0,Hu.prototype.copy=function(e){return Vi.prototype.copy.call(this,e),this.scale=e.scale,this.dashSize=e.dashSize,this.gapSize=e.gapSize,this};var $p=Object.freeze({__proto__:null,ShadowMaterial:dl,SpriteMaterial:al,RawShaderMaterial:ks,ShaderMaterial:Xa,PointsMaterial:Ko,MeshPhysicalMaterial:Gu,MeshStandardMaterial:ps,MeshPhongMaterial:js,MeshToonMaterial:zu,MeshNormalMaterial:Uu,MeshLambertMaterial:fa,MeshDepthMaterial:Xo,MeshDistanceMaterial:rl,MeshBasicMaterial:Dn,MeshMatcapMaterial:fl,LineDashedMaterial:Hu,LineBasicMaterial:Vi,Material:kt}),Pi={arraySlice:function(e,t,r){return Pi.isTypedArray(e)?new e.constructor(e.subarray(t,r!==void 0?r:e.length)):e.slice(t,r)},convertArray:function(e,t,r){return!e||!r&&e.constructor===t?e:typeof t.BYTES_PER_ELEMENT=="number"?new t(e):Array.prototype.slice.call(e)},isTypedArray:function(e){return ArrayBuffer.isView(e)&&!(e instanceof DataView)},getKeyframeOrder:function(e){for(var t=e.length,r=new Array(t),i=0;i!==t;++i)r[i]=i;return r.sort(function(l,p){return e[l]-e[p]}),r},sortedArray:function(e,t,r){for(var i=e.length,l=new e.constructor(i),p=0,f=0;f!==i;++p)for(var w=r[p]*t,L=0;L!==t;++L)l[f++]=e[w+L];return l},flattenJSON:function(e,t,r,i){for(var l=1,p=e[0];p!==void 0&&p[i]===void 0;)p=e[l++];if(p!==void 0){var f=p[i];if(f!==void 0)if(Array.isArray(f))for(;(f=p[i])!==void 0&&(t.push(p.time),r.push.apply(r,f)),(p=e[l++])!==void 0;);else if(f.toArray!==void 0)for(;(f=p[i])!==void 0&&(t.push(p.time),f.toArray(r,r.length)),(p=e[l++])!==void 0;);else for(;(f=p[i])!==void 0&&(t.push(p.time),r.push(f)),(p=e[l++])!==void 0;);}},subclip:function(e,t,r,i,l){l=l||30;var p=e.clone();p.name=t;for(var f=[],w=0;w<p.tracks.length;++w){for(var L=p.tracks[w],V=L.getValueSize(),Z=[],ee=[],ae=0;ae<L.times.length;++ae){var W=L.times[ae]*l;if(!(W<r||i<=W)){Z.push(L.times[ae]);for(var he=0;he<V;++he)ee.push(L.values[ae*V+he])}}Z.length!==0&&(L.times=Pi.convertArray(Z,L.times.constructor),L.values=Pi.convertArray(ee,L.values.constructor),f.push(L))}p.tracks=f;var ge=1/0;for(w=0;w<p.tracks.length;++w)ge>p.tracks[w].times[0]&&(ge=p.tracks[w].times[0]);for(w=0;w<p.tracks.length;++w)p.tracks[w].shift(-1*ge);return p.resetDuration(),p}};function Ga(e,t,r,i){this.parameterPositions=e,this._cachedIndex=0,this.resultBuffer=i!==void 0?i:new t.constructor(r),this.sampleValues=t,this.valueSize=r}function qc(e,t,r,i){Ga.call(this,e,t,r,i),this._weightPrev=-0,this._offsetPrev=-0,this._weightNext=-0,this._offsetNext=-0}function Wu(e,t,r,i){Ga.call(this,e,t,r,i)}function Xc(e,t,r,i){Ga.call(this,e,t,r,i)}function ma(e,t,r,i){if(e===void 0)throw new Error("THREE.KeyframeTrack: track name is undefined");if(t===void 0||t.length===0)throw new Error("THREE.KeyframeTrack: no keyframes in track named "+e);this.name=e,this.times=Pi.convertArray(t,this.TimeBufferType),this.values=Pi.convertArray(r,this.ValueBufferType),this.setInterpolation(i||this.DefaultInterpolation)}function Yc(e,t,r){ma.call(this,e,t,r)}function Zc(e,t,r,i){ma.call(this,e,t,r,i)}function Ns(e,t,r,i){ma.call(this,e,t,r,i)}function Ql(e,t,r,i){Ga.call(this,e,t,r,i)}function ml(e,t,r,i){ma.call(this,e,t,r,i)}function Kc(e,t,r,i){ma.call(this,e,t,r,i)}function eu(e,t,r,i){ma.call(this,e,t,r,i)}function _o(e,t,r){this.name=e,this.tracks=r,this.duration=t!==void 0?t:-1,this.uuid=xn.generateUUID(),this.duration<0&&this.resetDuration()}function Qp(e){if(e.type===void 0)throw new Error("THREE.KeyframeTrack: track type undefined, can not parse");var t=function(l){switch(l.toLowerCase()){case"scalar":case"double":case"float":case"number":case"integer":return Ns;case"vector":case"vector2":case"vector3":case"vector4":return eu;case"color":return Zc;case"quaternion":return ml;case"bool":case"boolean":return Yc;case"string":return Kc}throw new Error("THREE.KeyframeTrack: Unsupported typeName: "+l)}(e.type);if(e.times===void 0){var r=[],i=[];Pi.flattenJSON(e.keys,r,i,"value"),e.times=r,e.values=i}return t.parse!==void 0?t.parse(e):new t(e.name,e.times,e.values,e.interpolation)}Object.assign(Ga.prototype,{evaluate:function(e){var t=this.parameterPositions,r=this._cachedIndex,i=t[r],l=t[r-1];e:{t:{var p;r:{a:if(!(e<i)){for(var f=r+2;;){if(i===void 0){if(e<l)break a;return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,e,l)}if(r===f)break;if(l=i,e<(i=t[++r]))break t}p=t.length;break r}if(l<=e)break e;var w=t[1];for(e<w&&(r=2,l=w),f=r-2;;){if(l===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(r===f)break;if(i=l,(l=t[--r-1])<=e)break t}p=r,r=0}for(;r<p;){var L=r+p>>>1;e<t[L]?p=L:r=1+L}if(i=t[r],(l=t[r-1])===void 0)return this._cachedIndex=0,this.beforeStart_(0,e,i);if(i===void 0)return r=t.length,this._cachedIndex=r,this.afterEnd_(r-1,l,e)}this._cachedIndex=r,this.intervalChanged_(r,l,i)}return this.interpolate_(r,l,e,i)},settings:null,DefaultSettings_:{},getSettings_:function(){return this.settings||this.DefaultSettings_},copySampleValue_:function(e){for(var t=this.resultBuffer,r=this.sampleValues,i=this.valueSize,l=e*i,p=0;p!==i;++p)t[p]=r[l+p];return t},interpolate_:function(){throw new Error("call to abstract method")},intervalChanged_:function(){}}),Object.assign(Ga.prototype,{beforeStart_:Ga.prototype.copySampleValue_,afterEnd_:Ga.prototype.copySampleValue_}),qc.prototype=Object.assign(Object.create(Ga.prototype),{constructor:qc,DefaultSettings_:{endingStart:De,endingEnd:De},intervalChanged_:function(e,t,r){var i=this.parameterPositions,l=e-2,p=e+1,f=i[l],w=i[p];if(f===void 0)switch(this.getSettings_().endingStart){case ce:l=e,f=2*t-r;break;case Ce:f=t+i[l=i.length-2]-i[l+1];break;default:l=e,f=r}if(w===void 0)switch(this.getSettings_().endingEnd){case ce:p=e,w=2*r-t;break;case Ce:w=r+i[p=1]-i[0];break;default:p=e-1,w=t}var L=.5*(r-t),V=this.valueSize;this._weightPrev=L/(t-f),this._weightNext=L/(w-r),this._offsetPrev=l*V,this._offsetNext=p*V},interpolate_:function(e,t,r,i){for(var l=this.resultBuffer,p=this.sampleValues,f=this.valueSize,w=e*f,L=w-f,V=this._offsetPrev,Z=this._offsetNext,ee=this._weightPrev,ae=this._weightNext,W=(r-t)/(i-t),he=W*W,ge=he*W,ye=-ee*ge+2*ee*he-ee*W,Ae=(1+ee)*ge+(-1.5-2*ee)*he+(-.5+ee)*W+1,je=(-1-ae)*ge+(1.5+ae)*he+.5*W,He=ae*ge-ae*he,et=0;et!==f;++et)l[et]=ye*p[V+et]+Ae*p[L+et]+je*p[w+et]+He*p[Z+et];return l}}),Wu.prototype=Object.assign(Object.create(Ga.prototype),{constructor:Wu,interpolate_:function(e,t,r,i){for(var l=this.resultBuffer,p=this.sampleValues,f=this.valueSize,w=e*f,L=w-f,V=(r-t)/(i-t),Z=1-V,ee=0;ee!==f;++ee)l[ee]=p[L+ee]*Z+p[w+ee]*V;return l}}),Xc.prototype=Object.assign(Object.create(Ga.prototype),{constructor:Xc,interpolate_:function(e){return this.copySampleValue_(e-1)}}),Object.assign(ma,{toJSON:function(e){var t,r=e.constructor;if(r.toJSON!==void 0)t=r.toJSON(e);else{t={name:e.name,times:Pi.convertArray(e.times,Array),values:Pi.convertArray(e.values,Array)};var i=e.getInterpolation();i!==e.DefaultInterpolation&&(t.interpolation=i)}return t.type=e.ValueTypeName,t}}),Object.assign(ma.prototype,{constructor:ma,TimeBufferType:Float32Array,ValueBufferType:Float32Array,DefaultInterpolation:Q,InterpolantFactoryMethodDiscrete:function(e){return new Xc(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodLinear:function(e){return new Wu(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:function(e){return new qc(this.times,this.values,this.getValueSize(),e)},setInterpolation:function(e){var t;switch(e){case Fn:t=this.InterpolantFactoryMethodDiscrete;break;case Q:t=this.InterpolantFactoryMethodLinear;break;case 2302:t=this.InterpolantFactoryMethodSmooth}if(t!==void 0)return this.createInterpolant=t,this;var r="unsupported interpolation for "+this.ValueTypeName+" keyframe track named "+this.name;if(this.createInterpolant===void 0){if(e===this.DefaultInterpolation)throw new Error(r);this.setInterpolation(this.DefaultInterpolation)}return console.warn("THREE.KeyframeTrack:",r),this},getInterpolation:function(){switch(this.createInterpolant){case this.InterpolantFactoryMethodDiscrete:return Fn;case this.InterpolantFactoryMethodLinear:return Q;case this.InterpolantFactoryMethodSmooth:return 2302}},getValueSize:function(){return this.values.length/this.times.length},shift:function(e){if(e!==0)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]+=e;return this},scale:function(e){if(e!==1)for(var t=this.times,r=0,i=t.length;r!==i;++r)t[r]*=e;return this},trim:function(e,t){for(var r=this.times,i=r.length,l=0,p=i-1;l!==i&&r[l]<e;)++l;for(;p!==-1&&r[p]>t;)--p;if(++p,l!==0||p!==i){p<=l&&(l=(p=Math.max(p,1))-1);var f=this.getValueSize();this.times=Pi.arraySlice(r,l,p),this.values=Pi.arraySlice(this.values,l*f,p*f)}return this},validate:function(){var e=!0,t=this.getValueSize();t-Math.floor(t)!=0&&(console.error("THREE.KeyframeTrack: Invalid value size in track.",this),e=!1);var r=this.times,i=this.values,l=r.length;l===0&&(console.error("THREE.KeyframeTrack: Track is empty.",this),e=!1);for(var p=null,f=0;f!==l;f++){var w=r[f];if(typeof w=="number"&&isNaN(w)){console.error("THREE.KeyframeTrack: Time is not a valid number.",this,f,w),e=!1;break}if(p!==null&&w<p){console.error("THREE.KeyframeTrack: Out of order keys.",this,f,w,p),e=!1;break}p=w}if(i!==void 0&&Pi.isTypedArray(i)){f=0;for(var L=i.length;f!==L;++f){var V=i[f];if(isNaN(V)){console.error("THREE.KeyframeTrack: Value is not a valid number.",this,f,V),e=!1;break}}}return e},optimize:function(){for(var e=Pi.arraySlice(this.times),t=Pi.arraySlice(this.values),r=this.getValueSize(),i=this.getInterpolation()===2302,l=1,p=e.length-1,f=1;f<p;++f){var w=!1,L=e[f];if(L!==e[f+1]&&(f!==1||L!==L[0]))if(i)w=!0;else for(var V=f*r,Z=V-r,ee=V+r,ae=0;ae!==r;++ae){var W=t[V+ae];if(W!==t[Z+ae]||W!==t[ee+ae]){w=!0;break}}if(w){if(f!==l){e[l]=e[f];var he=f*r,ge=l*r;for(ae=0;ae!==r;++ae)t[ge+ae]=t[he+ae]}++l}}if(0<p){for(e[l]=e[p],he=p*r,ge=l*r,ae=0;ae!==r;++ae)t[ge+ae]=t[he+ae];++l}return l!==e.length?(this.times=Pi.arraySlice(e,0,l),this.values=Pi.arraySlice(t,0,l*r)):(this.times=e,this.values=t),this},clone:function(){var e=Pi.arraySlice(this.times,0),t=Pi.arraySlice(this.values,0),r=new this.constructor(this.name,e,t);return r.createInterpolant=this.createInterpolant,r}}),Yc.prototype=Object.assign(Object.create(ma.prototype),{constructor:Yc,ValueTypeName:"bool",ValueBufferType:Array,DefaultInterpolation:Fn,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),Zc.prototype=Object.assign(Object.create(ma.prototype),{constructor:Zc,ValueTypeName:"color"}),Ns.prototype=Object.assign(Object.create(ma.prototype),{constructor:Ns,ValueTypeName:"number"}),Ql.prototype=Object.assign(Object.create(Ga.prototype),{constructor:Ql,interpolate_:function(e,t,r,i){for(var l=this.resultBuffer,p=this.sampleValues,f=this.valueSize,w=e*f,L=(r-t)/(i-t),V=w+f;w!==V;w+=4)Gi.slerpFlat(l,0,p,w-f,p,w,L);return l}}),ml.prototype=Object.assign(Object.create(ma.prototype),{constructor:ml,ValueTypeName:"quaternion",DefaultInterpolation:Q,InterpolantFactoryMethodLinear:function(e){return new Ql(this.times,this.values,this.getValueSize(),e)},InterpolantFactoryMethodSmooth:void 0}),Kc.prototype=Object.assign(Object.create(ma.prototype),{constructor:Kc,ValueTypeName:"string",ValueBufferType:Array,DefaultInterpolation:Fn,InterpolantFactoryMethodLinear:void 0,InterpolantFactoryMethodSmooth:void 0}),eu.prototype=Object.assign(Object.create(ma.prototype),{constructor:eu,ValueTypeName:"vector"}),Object.assign(_o,{parse:function(e){for(var t=[],r=e.tracks,i=1/(e.fps||1),l=0,p=r.length;l!==p;++l)t.push(Qp(r[l]).scale(i));return new _o(e.name,e.duration,t)},toJSON:function(e){for(var t=[],r=e.tracks,i={name:e.name,duration:e.duration,tracks:t,uuid:e.uuid},l=0,p=r.length;l!==p;++l)t.push(ma.toJSON(r[l]));return i},CreateFromMorphTargetSequence:function(e,t,r,i){for(var l=t.length,p=[],f=0;f<l;f++){var w=[],L=[];w.push((f+l-1)%l,f,(f+1)%l),L.push(0,1,0);var V=Pi.getKeyframeOrder(w);w=Pi.sortedArray(w,1,V),L=Pi.sortedArray(L,1,V),i||w[0]!==0||(w.push(l),L.push(L[0])),p.push(new Ns(".morphTargetInfluences["+t[f].name+"]",w,L).scale(1/r))}return new _o(e,-1,p)},findByName:function(e,t){var r=e;Array.isArray(e)||(r=e.geometry&&e.geometry.animations||e.animations);for(var i=0;i<r.length;i++)if(r[i].name===t)return r[i];return null},CreateClipsFromMorphTargetSequences:function(e,t,r){for(var i={},l=/^([\w-]*?)([\d]+)$/,p=0,f=e.length;p<f;p++){var w=e[p],L=w.name.match(l);if(L&&1<L.length){var V=i[ee=L[1]];V||(i[ee]=V=[]),V.push(w)}}var Z=[];for(var ee in i)Z.push(_o.CreateFromMorphTargetSequence(ee,i[ee],t,r));return Z},parseAnimation:function(e,t){if(!e)return console.error("THREE.AnimationClip: No animation in JSONLoader data."),null;for(var r=function(je,He,et,Ge,it){if(et.length!==0){var qe=[],vt=[];Pi.flattenJSON(et,qe,vt,Ge),qe.length!==0&&it.push(new je(He,qe,vt))}},i=[],l=e.name||"default",p=e.length||-1,f=e.fps||30,w=e.hierarchy||[],L=0;L<w.length;L++){var V=w[L].keys;if(V&&V.length!==0)if(V[0].morphTargets){for(var Z={},ee=0;ee<V.length;ee++)if(V[ee].morphTargets)for(var ae=0;ae<V[ee].morphTargets.length;ae++)Z[V[ee].morphTargets[ae]]=-1;for(var W in Z){var he=[],ge=[];for(ae=0;ae!==V[ee].morphTargets.length;++ae){var ye=V[ee];he.push(ye.time),ge.push(ye.morphTarget===W?1:0)}i.push(new Ns(".morphTargetInfluence["+W+"]",he,ge))}p=Z.length*(f||1)}else{var Ae=".bones["+t[L].name+"]";r(eu,Ae+".position",V,"pos",i),r(ml,Ae+".quaternion",V,"rot",i),r(eu,Ae+".scale",V,"scl",i)}}return i.length===0?null:new _o(l,p,i)}}),Object.assign(_o.prototype,{resetDuration:function(){for(var e=0,t=0,r=this.tracks.length;t!==r;++t){var i=this.tracks[t];e=Math.max(e,i.times[i.times.length-1])}return this.duration=e,this},trim:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].trim(0,this.duration);return this},validate:function(){for(var e=!0,t=0;t<this.tracks.length;t++)e=e&&this.tracks[t].validate();return e},optimize:function(){for(var e=0;e<this.tracks.length;e++)this.tracks[e].optimize();return this},clone:function(){for(var e=[],t=0;t<this.tracks.length;t++)e.push(this.tracks[t].clone());return new _o(this.name,this.duration,e)}});var gl={enabled:!1,files:{},add:function(e,t){this.enabled!==!1&&(this.files[e]=t)},get:function(e){if(this.enabled!==!1)return this.files[e]},remove:function(e){delete this.files[e]},clear:function(){this.files={}}};function Vh(e,t,r){var i=this,l=!1,p=0,f=0,w=void 0,L=[];this.onStart=void 0,this.onLoad=e,this.onProgress=t,this.onError=r,this.itemStart=function(V){f++,l===!1&&i.onStart!==void 0&&i.onStart(V,p,f),l=!0},this.itemEnd=function(V){p++,i.onProgress!==void 0&&i.onProgress(V,p,f),p===f&&(l=!1,i.onLoad!==void 0&&i.onLoad())},this.itemError=function(V){i.onError!==void 0&&i.onError(V)},this.resolveURL=function(V){return w?w(V):V},this.setURLModifier=function(V){return w=V,this},this.addHandler=function(V,Z){return L.push(V,Z),this},this.removeHandler=function(V){var Z=L.indexOf(V);return Z!==-1&&L.splice(Z,2),this},this.getHandler=function(V){for(var Z=0,ee=L.length;Z<ee;Z+=2){var ae=L[Z],W=L[Z+1];if(ae.global&&(ae.lastIndex=0),ae.test(V))return W}return null}}var gp=new Vh;function s(e){this.manager=e!==void 0?e:gp,this.crossOrigin="anonymous",this.path="",this.resourcePath=""}Object.assign(s.prototype,{load:function(){},parse:function(){},setCrossOrigin:function(e){return this.crossOrigin=e,this},setPath:function(e){return this.path=e,this},setResourcePath:function(e){return this.resourcePath=e,this}});var d={};function R(e){s.call(this,e)}function oe(e){s.call(this,e)}function de(e){s.call(this,e)}function Pe(e){s.call(this,e)}function Ye(e){s.call(this,e)}function nt(e){s.call(this,e)}function xt(e){s.call(this,e)}function mt(){this.type="Curve",this.arcLengthDivisions=200}function Nt(e,t,r,i,l,p,f,w){mt.call(this),this.type="EllipseCurve",this.aX=e||0,this.aY=t||0,this.xRadius=r||1,this.yRadius=i||1,this.aStartAngle=l||0,this.aEndAngle=p||2*Math.PI,this.aClockwise=f||!1,this.aRotation=w||0}function Zt(e,t,r,i,l,p){Nt.call(this,e,t,r,r,i,l,p),this.type="ArcCurve"}function Sr(){var e=0,t=0,r=0,i=0;function l(p,f,w,L){r=-3*(e=p)+3*f-2*(t=w)-L,i=2*p-2*f+w+L}return{initCatmullRom:function(p,f,w,L,V){l(f,w,V*(w-p),V*(L-f))},initNonuniformCatmullRom:function(p,f,w,L,V,Z,ee){var ae=(f-p)/V-(w-p)/(V+Z)+(w-f)/Z,W=(w-f)/Z-(L-f)/(Z+ee)+(L-w)/ee;l(f,w,ae*=Z,W*=Z)},calc:function(p){var f=p*p;return e+t*p+r*f+i*(f*p)}}}R.prototype=Object.assign(Object.create(s.prototype),{constructor:R,load:function(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var l=this,p=gl.get(e);if(p!==void 0)return l.manager.itemStart(e),setTimeout(function(){t&&t(p),l.manager.itemEnd(e)},0),p;if(d[e]===void 0){var f=e.match(/^data:(.*?)(;base64)?,(.*)$/);if(f){var w=f[1],L=!!f[2],V=f[3];V=decodeURIComponent(V),L&&(V=atob(V));try{var Z,ee=(this.responseType||"").toLowerCase();switch(ee){case"arraybuffer":case"blob":for(var ae=new Uint8Array(V.length),W=0;W<V.length;W++)ae[W]=V.charCodeAt(W);Z=ee==="blob"?new Blob([ae.buffer],{type:w}):ae.buffer;break;case"document":var he=new DOMParser;Z=he.parseFromString(V,w);break;case"json":Z=JSON.parse(V);break;default:Z=V}setTimeout(function(){t&&t(Z),l.manager.itemEnd(e)},0)}catch(Ae){setTimeout(function(){i&&i(Ae),l.manager.itemError(e),l.manager.itemEnd(e)},0)}}else{d[e]=[],d[e].push({onLoad:t,onProgress:r,onError:i});var ge=new XMLHttpRequest;for(var ye in ge.open("GET",e,!0),ge.addEventListener("load",function(Ae){var je=this.response,He=d[e];if(delete d[e],this.status===200||this.status===0){this.status===0&&console.warn("THREE.FileLoader: HTTP Status 0 received."),gl.add(e,je);for(var et=0,Ge=He.length;et<Ge;et++)(it=He[et]).onLoad&&it.onLoad(je);l.manager.itemEnd(e)}else{for(et=0,Ge=He.length;et<Ge;et++){var it;(it=He[et]).onError&&it.onError(Ae)}l.manager.itemError(e),l.manager.itemEnd(e)}},!1),ge.addEventListener("progress",function(Ae){for(var je=d[e],He=0,et=je.length;He<et;He++){var Ge=je[He];Ge.onProgress&&Ge.onProgress(Ae)}},!1),ge.addEventListener("error",function(Ae){var je=d[e];delete d[e];for(var He=0,et=je.length;He<et;He++){var Ge=je[He];Ge.onError&&Ge.onError(Ae)}l.manager.itemError(e),l.manager.itemEnd(e)},!1),ge.addEventListener("abort",function(Ae){var je=d[e];delete d[e];for(var He=0,et=je.length;He<et;He++){var Ge=je[He];Ge.onError&&Ge.onError(Ae)}l.manager.itemError(e),l.manager.itemEnd(e)},!1),this.responseType!==void 0&&(ge.responseType=this.responseType),this.withCredentials!==void 0&&(ge.withCredentials=this.withCredentials),ge.overrideMimeType&&ge.overrideMimeType(this.mimeType!==void 0?this.mimeType:"text/plain"),this.requestHeader)ge.setRequestHeader(ye,this.requestHeader[ye]);ge.send(null)}return l.manager.itemStart(e),ge}d[e].push({onLoad:t,onProgress:r,onError:i})},setResponseType:function(e){return this.responseType=e,this},setWithCredentials:function(e){return this.withCredentials=e,this},setMimeType:function(e){return this.mimeType=e,this},setRequestHeader:function(e){return this.requestHeader=e,this}}),oe.prototype=Object.assign(Object.create(s.prototype),{constructor:oe,load:function(e,t,r,i){var l=this,p=new R(l.manager);p.setPath(l.path),p.load(e,function(f){t(l.parse(JSON.parse(f)))},r,i)},parse:function(e){for(var t=[],r=0;r<e.length;r++){var i=_o.parse(e[r]);t.push(i)}return t}}),de.prototype=Object.assign(Object.create(s.prototype),{constructor:de,load:function(e,t,r,i){var l=this,p=[],f=new Nc;f.image=p;var w=new R(this.manager);function L(ae){w.load(e[ae],function(W){var he=l.parse(W,!0);p[ae]={width:he.width,height:he.height,format:he.format,mipmaps:he.mipmaps},(V+=1)===6&&(he.mipmapCount===1&&(f.minFilter=Tr),f.format=he.format,f.needsUpdate=!0,t&&t(f))},r,i)}if(w.setPath(this.path),w.setResponseType("arraybuffer"),Array.isArray(e))for(var V=0,Z=0,ee=e.length;Z<ee;++Z)L(Z);else w.load(e,function(ae){var W=l.parse(ae,!0);if(W.isCubemap)for(var he=W.mipmaps.length/W.mipmapCount,ge=0;ge<he;ge++){p[ge]={mipmaps:[]};for(var ye=0;ye<W.mipmapCount;ye++)p[ge].mipmaps.push(W.mipmaps[ge*W.mipmapCount+ye]),p[ge].format=W.format,p[ge].width=W.width,p[ge].height=W.height}else f.image.width=W.width,f.image.height=W.height,f.mipmaps=W.mipmaps;W.mipmapCount===1&&(f.minFilter=Tr),f.format=W.format,f.needsUpdate=!0,t&&t(f)},r,i);return f}}),Pe.prototype=Object.assign(Object.create(s.prototype),{constructor:Pe,load:function(e,t,r,i){var l=this,p=new Pl,f=new R(this.manager);return f.setResponseType("arraybuffer"),f.setPath(this.path),f.load(e,function(w){var L=l.parse(w);L&&(L.image!==void 0?p.image=L.image:L.data!==void 0&&(p.image.width=L.width,p.image.height=L.height,p.image.data=L.data),p.wrapS=L.wrapS!==void 0?L.wrapS:Or,p.wrapT=L.wrapT!==void 0?L.wrapT:Or,p.magFilter=L.magFilter!==void 0?L.magFilter:Tr,p.minFilter=L.minFilter!==void 0?L.minFilter:Tr,p.anisotropy=L.anisotropy!==void 0?L.anisotropy:1,L.format!==void 0&&(p.format=L.format),L.type!==void 0&&(p.type=L.type),L.mipmaps!==void 0&&(p.mipmaps=L.mipmaps,p.minFilter=Hr),L.mipmapCount===1&&(p.minFilter=Tr),p.needsUpdate=!0,t&&t(p,L))},r,i),p}}),Ye.prototype=Object.assign(Object.create(s.prototype),{constructor:Ye,load:function(e,t,r,i){this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var l=this,p=gl.get(e);if(p!==void 0)return l.manager.itemStart(e),setTimeout(function(){t&&t(p),l.manager.itemEnd(e)},0),p;var f=document.createElementNS("http://www.w3.org/1999/xhtml","img");function w(){f.removeEventListener("load",w,!1),f.removeEventListener("error",L,!1),gl.add(e,this),t&&t(this),l.manager.itemEnd(e)}function L(V){f.removeEventListener("load",w,!1),f.removeEventListener("error",L,!1),i&&i(V),l.manager.itemError(e),l.manager.itemEnd(e)}return f.addEventListener("load",w,!1),f.addEventListener("error",L,!1),e.substr(0,5)!=="data:"&&this.crossOrigin!==void 0&&(f.crossOrigin=this.crossOrigin),l.manager.itemStart(e),f.src=e,f}}),nt.prototype=Object.assign(Object.create(s.prototype),{constructor:nt,load:function(e,t,r,i){var l=new Ss,p=new Ye(this.manager);p.setCrossOrigin(this.crossOrigin),p.setPath(this.path);var f=0;function w(V){p.load(e[V],function(Z){l.images[V]=Z,++f==6&&(l.needsUpdate=!0,t&&t(l))},void 0,i)}for(var L=0;L<e.length;++L)w(L);return l}}),xt.prototype=Object.assign(Object.create(s.prototype),{constructor:xt,load:function(e,t,r,i){var l=new Yn,p=new Ye(this.manager);return p.setCrossOrigin(this.crossOrigin),p.setPath(this.path),p.load(e,function(f){l.image=f;var w=0<e.search(/\.jpe?g($|\?)/i)||e.search(/^data\:image\/jpeg/)===0;l.format=w?Sn:Tn,l.needsUpdate=!0,t!==void 0&&t(l)},r,i),l}}),Object.assign(mt.prototype,{getPoint:function(){return console.warn("THREE.Curve: .getPoint() not implemented."),null},getPointAt:function(e,t){var r=this.getUtoTmapping(e);return this.getPoint(r,t)},getPoints:function(e){e===void 0&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return t},getSpacedPoints:function(e){e===void 0&&(e=5);for(var t=[],r=0;r<=e;r++)t.push(this.getPointAt(r/e));return t},getLength:function(){var e=this.getLengths();return e[e.length-1]},getLengths:function(e){if(e===void 0&&(e=this.arcLengthDivisions),this.cacheArcLengths&&this.cacheArcLengths.length===e+1&&!this.needsUpdate)return this.cacheArcLengths;this.needsUpdate=!1;var t,r,i=[],l=this.getPoint(0),p=0;for(i.push(0),r=1;r<=e;r++)p+=(t=this.getPoint(r/e)).distanceTo(l),i.push(p),l=t;return this.cacheArcLengths=i},updateArcLengths:function(){this.needsUpdate=!0,this.getLengths()},getUtoTmapping:function(e,t){var r,i=this.getLengths(),l=0,p=i.length;r=t||e*i[p-1];for(var f,w=0,L=p-1;w<=L;)if((f=i[l=Math.floor(w+(L-w)/2)]-r)<0)w=l+1;else{if(!(0<f)){L=l;break}L=l-1}if(i[l=L]===r)return l/(p-1);var V=i[l];return(l+(r-V)/(i[l+1]-V))/(p-1)},getTangent:function(e){var t=e-1e-4,r=e+1e-4;t<0&&(t=0),1<r&&(r=1);var i=this.getPoint(t);return this.getPoint(r).clone().sub(i).normalize()},getTangentAt:function(e){var t=this.getUtoTmapping(e);return this.getTangent(t)},computeFrenetFrames:function(e,t){var r,i,l,p=new Le,f=[],w=[],L=[],V=new Le,Z=new mn;for(r=0;r<=e;r++)i=r/e,f[r]=this.getTangentAt(i),f[r].normalize();w[0]=new Le,L[0]=new Le;var ee=Number.MAX_VALUE,ae=Math.abs(f[0].x),W=Math.abs(f[0].y),he=Math.abs(f[0].z);for(ae<=ee&&(ee=ae,p.set(1,0,0)),W<=ee&&(ee=W,p.set(0,1,0)),he<=ee&&p.set(0,0,1),V.crossVectors(f[0],p).normalize(),w[0].crossVectors(f[0],V),L[0].crossVectors(f[0],w[0]),r=1;r<=e;r++)w[r]=w[r-1].clone(),L[r]=L[r-1].clone(),V.crossVectors(f[r-1],f[r]),V.length()>Number.EPSILON&&(V.normalize(),l=Math.acos(xn.clamp(f[r-1].dot(f[r]),-1,1)),w[r].applyMatrix4(Z.makeRotationAxis(V,l))),L[r].crossVectors(f[r],w[r]);if(t===!0)for(l=Math.acos(xn.clamp(w[0].dot(w[e]),-1,1)),l/=e,0<f[0].dot(V.crossVectors(w[0],w[e]))&&(l=-l),r=1;r<=e;r++)w[r].applyMatrix4(Z.makeRotationAxis(f[r],l*r)),L[r].crossVectors(f[r],w[r]);return{tangents:f,normals:w,binormals:L}},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this},toJSON:function(){var e={metadata:{version:4.5,type:"Curve",generator:"Curve.toJSON"}};return e.arcLengthDivisions=this.arcLengthDivisions,e.type=this.type,e},fromJSON:function(e){return this.arcLengthDivisions=e.arcLengthDivisions,this}}),((Nt.prototype=Object.create(mt.prototype)).constructor=Nt).prototype.isEllipseCurve=!0,Nt.prototype.getPoint=function(e,t){for(var r=t||new Gt,i=2*Math.PI,l=this.aEndAngle-this.aStartAngle,p=Math.abs(l)<Number.EPSILON;l<0;)l+=i;for(;i<l;)l-=i;l<Number.EPSILON&&(l=p?0:i),this.aClockwise!==!0||p||(l===i?l=-i:l-=i);var f=this.aStartAngle+e*l,w=this.aX+this.xRadius*Math.cos(f),L=this.aY+this.yRadius*Math.sin(f);if(this.aRotation!==0){var V=Math.cos(this.aRotation),Z=Math.sin(this.aRotation),ee=w-this.aX,ae=L-this.aY;w=ee*V-ae*Z+this.aX,L=ee*Z+ae*V+this.aY}return r.set(w,L)},Nt.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},Nt.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.aX=this.aX,e.aY=this.aY,e.xRadius=this.xRadius,e.yRadius=this.yRadius,e.aStartAngle=this.aStartAngle,e.aEndAngle=this.aEndAngle,e.aClockwise=this.aClockwise,e.aRotation=this.aRotation,e},Nt.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.aX=e.aX,this.aY=e.aY,this.xRadius=e.xRadius,this.yRadius=e.yRadius,this.aStartAngle=e.aStartAngle,this.aEndAngle=e.aEndAngle,this.aClockwise=e.aClockwise,this.aRotation=e.aRotation,this},((Zt.prototype=Object.create(Nt.prototype)).constructor=Zt).prototype.isArcCurve=!0;var Lr=new Le,en=new Sr,zt=new Sr,rr=new Sr;function Ir(e,t,r,i){mt.call(this),this.type="CatmullRomCurve3",this.points=e||[],this.closed=t||!1,this.curveType=r||"centripetal",this.tension=i||.5}function mr(e,t,r,i,l){var p=.5*(i-t),f=.5*(l-r),w=e*e;return(2*r-2*i+p+f)*(e*w)+(-3*r+3*i-2*p-f)*w+p*e+r}function fn(e,t,r,i){return(f=1-e)*f*t+2*(1-(p=e))*p*r+(l=e)*l*i;var l,p,f}function cn(e,t,r,i,l){return(V=1-e)*V*V*t+3*(L=1-(w=e))*L*w*r+3*(1-(f=e))*f*f*i+(p=e)*p*p*l;var p,f,w,L,V}function Rn(e,t,r,i){mt.call(this),this.type="CubicBezierCurve",this.v0=e||new Gt,this.v1=t||new Gt,this.v2=r||new Gt,this.v3=i||new Gt}function kr(e,t,r,i){mt.call(this),this.type="CubicBezierCurve3",this.v0=e||new Le,this.v1=t||new Le,this.v2=r||new Le,this.v3=i||new Le}function Gr(e,t){mt.call(this),this.type="LineCurve",this.v1=e||new Gt,this.v2=t||new Gt}function ci(e,t){mt.call(this),this.type="LineCurve3",this.v1=e||new Le,this.v2=t||new Le}function ii(e,t,r){mt.call(this),this.type="QuadraticBezierCurve",this.v0=e||new Gt,this.v1=t||new Gt,this.v2=r||new Gt}function Fi(e,t,r){mt.call(this),this.type="QuadraticBezierCurve3",this.v0=e||new Le,this.v1=t||new Le,this.v2=r||new Le}function Wn(e){mt.call(this),this.type="SplineCurve",this.points=e||[]}((Ir.prototype=Object.create(mt.prototype)).constructor=Ir).prototype.isCatmullRomCurve3=!0,Ir.prototype.getPoint=function(e,t){var r,i,l,p,f=t||new Le,w=this.points,L=w.length,V=(L-(this.closed?0:1))*e,Z=Math.floor(V),ee=V-Z;if(this.closed?Z+=0<Z?0:(Math.floor(Math.abs(Z)/L)+1)*L:ee===0&&Z===L-1&&(Z=L-2,ee=1),r=this.closed||0<Z?w[(Z-1)%L]:(Lr.subVectors(w[0],w[1]).add(w[0]),Lr),i=w[Z%L],l=w[(Z+1)%L],p=this.closed||Z+2<L?w[(Z+2)%L]:(Lr.subVectors(w[L-1],w[L-2]).add(w[L-1]),Lr),this.curveType==="centripetal"||this.curveType==="chordal"){var ae=this.curveType==="chordal"?.5:.25,W=Math.pow(r.distanceToSquared(i),ae),he=Math.pow(i.distanceToSquared(l),ae),ge=Math.pow(l.distanceToSquared(p),ae);he<1e-4&&(he=1),W<1e-4&&(W=he),ge<1e-4&&(ge=he),en.initNonuniformCatmullRom(r.x,i.x,l.x,p.x,W,he,ge),zt.initNonuniformCatmullRom(r.y,i.y,l.y,p.y,W,he,ge),rr.initNonuniformCatmullRom(r.z,i.z,l.z,p.z,W,he,ge)}else this.curveType==="catmullrom"&&(en.initCatmullRom(r.x,i.x,l.x,p.x,this.tension),zt.initCatmullRom(r.y,i.y,l.y,p.y,this.tension),rr.initCatmullRom(r.z,i.z,l.z,p.z,this.tension));return f.set(en.calc(ee),zt.calc(ee),rr.calc(ee)),f},Ir.prototype.copy=function(e){mt.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},Ir.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e.closed=this.closed,e.curveType=this.curveType,e.tension=this.tension,e},Ir.prototype.fromJSON=function(e){mt.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(new Le().fromArray(i))}return this.closed=e.closed,this.curveType=e.curveType,this.tension=e.tension,this},((Rn.prototype=Object.create(mt.prototype)).constructor=Rn).prototype.isCubicBezierCurve=!0,Rn.prototype.getPoint=function(e,t){var r=t||new Gt,i=this.v0,l=this.v1,p=this.v2,f=this.v3;return r.set(cn(e,i.x,l.x,p.x,f.x),cn(e,i.y,l.y,p.y,f.y)),r},Rn.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},Rn.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},Rn.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((kr.prototype=Object.create(mt.prototype)).constructor=kr).prototype.isCubicBezierCurve3=!0,kr.prototype.getPoint=function(e,t){var r=t||new Le,i=this.v0,l=this.v1,p=this.v2,f=this.v3;return r.set(cn(e,i.x,l.x,p.x,f.x),cn(e,i.y,l.y,p.y,f.y),cn(e,i.z,l.z,p.z,f.z)),r},kr.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this.v3.copy(e.v3),this},kr.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e.v3=this.v3.toArray(),e},kr.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this.v3.fromArray(e.v3),this},((Gr.prototype=Object.create(mt.prototype)).constructor=Gr).prototype.isLineCurve=!0,Gr.prototype.getPoint=function(e,t){var r=t||new Gt;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},Gr.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},Gr.prototype.getTangent=function(){return this.v2.clone().sub(this.v1).normalize()},Gr.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Gr.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Gr.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((ci.prototype=Object.create(mt.prototype)).constructor=ci).prototype.isLineCurve3=!0,ci.prototype.getPoint=function(e,t){var r=t||new Le;return e===1?r.copy(this.v2):(r.copy(this.v2).sub(this.v1),r.multiplyScalar(e).add(this.v1)),r},ci.prototype.getPointAt=function(e,t){return this.getPoint(e,t)},ci.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ci.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ci.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((ii.prototype=Object.create(mt.prototype)).constructor=ii).prototype.isQuadraticBezierCurve=!0,ii.prototype.getPoint=function(e,t){var r=t||new Gt,i=this.v0,l=this.v1,p=this.v2;return r.set(fn(e,i.x,l.x,p.x),fn(e,i.y,l.y,p.y)),r},ii.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},ii.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},ii.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Fi.prototype=Object.create(mt.prototype)).constructor=Fi).prototype.isQuadraticBezierCurve3=!0,Fi.prototype.getPoint=function(e,t){var r=t||new Le,i=this.v0,l=this.v1,p=this.v2;return r.set(fn(e,i.x,l.x,p.x),fn(e,i.y,l.y,p.y),fn(e,i.z,l.z,p.z)),r},Fi.prototype.copy=function(e){return mt.prototype.copy.call(this,e),this.v0.copy(e.v0),this.v1.copy(e.v1),this.v2.copy(e.v2),this},Fi.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);return e.v0=this.v0.toArray(),e.v1=this.v1.toArray(),e.v2=this.v2.toArray(),e},Fi.prototype.fromJSON=function(e){return mt.prototype.fromJSON.call(this,e),this.v0.fromArray(e.v0),this.v1.fromArray(e.v1),this.v2.fromArray(e.v2),this},((Wn.prototype=Object.create(mt.prototype)).constructor=Wn).prototype.isSplineCurve=!0,Wn.prototype.getPoint=function(e,t){var r=t||new Gt,i=this.points,l=(i.length-1)*e,p=Math.floor(l),f=l-p,w=i[p===0?p:p-1],L=i[p],V=i[p>i.length-2?i.length-1:p+1],Z=i[p>i.length-3?i.length-1:p+2];return r.set(mr(f,w.x,L.x,V.x,Z.x),mr(f,w.y,L.y,V.y,Z.y)),r},Wn.prototype.copy=function(e){mt.prototype.copy.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(i.clone())}return this},Wn.prototype.toJSON=function(){var e=mt.prototype.toJSON.call(this);e.points=[];for(var t=0,r=this.points.length;t<r;t++){var i=this.points[t];e.points.push(i.toArray())}return e},Wn.prototype.fromJSON=function(e){mt.prototype.fromJSON.call(this,e),this.points=[];for(var t=0,r=e.points.length;t<r;t++){var i=e.points[t];this.points.push(new Gt().fromArray(i))}return this};var ga=Object.freeze({__proto__:null,ArcCurve:Zt,CatmullRomCurve3:Ir,CubicBezierCurve:Rn,CubicBezierCurve3:kr,EllipseCurve:Nt,LineCurve:Gr,LineCurve3:ci,QuadraticBezierCurve:ii,QuadraticBezierCurve3:Fi,SplineCurve:Wn});function ya(){mt.call(this),this.type="CurvePath",this.curves=[],this.autoClose=!1}function va(e){ya.call(this),this.type="Path",this.currentPoint=new Gt,e&&this.setFromPoints(e)}function $a(e){va.call(this,e),this.uuid=xn.generateUUID(),this.type="Shape",this.holes=[]}function Hn(e,t){At.call(this),this.type="Light",this.color=new Qe(e),this.intensity=t!==void 0?t:1,this.receiveShadow=void 0}function Ju(e,t,r){Hn.call(this,e,r),this.type="HemisphereLight",this.castShadow=void 0,this.position.copy(At.DefaultUp),this.updateMatrix(),this.groundColor=new Qe(t)}function jo(e){this.camera=e,this.bias=0,this.radius=1,this.mapSize=new Gt(512,512),this.map=null,this.mapPass=null,this.matrix=new mn,this._frustum=new $s,this._frameExtents=new Gt(1,1),this._viewportCount=1,this._viewports=[new qn(0,0,1,1)]}function yl(){jo.call(this,new Ni(50,1,.5,500))}function tu(e,t,r,i,l,p){Hn.call(this,e,t),this.type="SpotLight",this.position.copy(At.DefaultUp),this.updateMatrix(),this.target=new At,Object.defineProperty(this,"power",{get:function(){return this.intensity*Math.PI},set:function(f){this.intensity=f/Math.PI}}),this.distance=r!==void 0?r:0,this.angle=i!==void 0?i:Math.PI/3,this.penumbra=l!==void 0?l:0,this.decay=p!==void 0?p:1,this.shadow=new yl}function ru(){jo.call(this,new Ni(90,1,.5,500)),this._frameExtents=new Gt(4,2),this._viewportCount=6,this._viewports=[new qn(2,1,1,1),new qn(0,1,1,1),new qn(3,1,1,1),new qn(1,1,1,1),new qn(3,0,1,1),new qn(1,0,1,1)],this._cubeDirections=[new Le(1,0,0),new Le(-1,0,0),new Le(0,0,1),new Le(0,0,-1),new Le(0,1,0),new Le(0,-1,0)],this._cubeUps=[new Le(0,1,0),new Le(0,1,0),new Le(0,1,0),new Le(0,1,0),new Le(0,0,1),new Le(0,0,-1)]}function vl(e,t,r,i){Hn.call(this,e,t),this.type="PointLight",Object.defineProperty(this,"power",{get:function(){return 4*this.intensity*Math.PI},set:function(l){this.intensity=l/(4*Math.PI)}}),this.distance=r!==void 0?r:0,this.decay=i!==void 0?i:1,this.shadow=new ru}function xl(e,t,r,i,l,p){Lo.call(this),this.type="OrthographicCamera",this.zoom=1,this.view=null,this.left=e!==void 0?e:-1,this.right=t!==void 0?t:1,this.top=r!==void 0?r:1,this.bottom=i!==void 0?i:-1,this.near=l!==void 0?l:.1,this.far=p!==void 0?p:2e3,this.updateProjectionMatrix()}function wl(){jo.call(this,new xl(-5,5,5,-5,.5,500))}function bl(e,t){Hn.call(this,e,t),this.type="DirectionalLight",this.position.copy(At.DefaultUp),this.updateMatrix(),this.target=new At,this.shadow=new wl}function yp(e,t){Hn.call(this,e,t),this.type="AmbientLight",this.castShadow=void 0}function vp(e,t,r,i){Hn.call(this,e,t),this.type="RectAreaLight",this.width=r!==void 0?r:10,this.height=i!==void 0?i:10}function xp(e){s.call(this,e),this.textures={}}ya.prototype=Object.assign(Object.create(mt.prototype),{constructor:ya,add:function(e){this.curves.push(e)},closePath:function(){var e=this.curves[0].getPoint(0),t=this.curves[this.curves.length-1].getPoint(1);e.equals(t)||this.curves.push(new Gr(t,e))},getPoint:function(e){for(var t=e*this.getLength(),r=this.getCurveLengths(),i=0;i<r.length;){if(r[i]>=t){var l=r[i]-t,p=this.curves[i],f=p.getLength(),w=f===0?0:1-l/f;return p.getPointAt(w)}i++}return null},getLength:function(){var e=this.getCurveLengths();return e[e.length-1]},updateArcLengths:function(){this.needsUpdate=!0,this.cacheLengths=null,this.getCurveLengths()},getCurveLengths:function(){if(this.cacheLengths&&this.cacheLengths.length===this.curves.length)return this.cacheLengths;for(var e=[],t=0,r=0,i=this.curves.length;r<i;r++)t+=this.curves[r].getLength(),e.push(t);return this.cacheLengths=e},getSpacedPoints:function(e){e===void 0&&(e=40);for(var t=[],r=0;r<=e;r++)t.push(this.getPoint(r/e));return this.autoClose&&t.push(t[0]),t},getPoints:function(e){e=e||12;for(var t,r=[],i=0,l=this.curves;i<l.length;i++)for(var p=l[i],f=p&&p.isEllipseCurve?2*e:p&&(p.isLineCurve||p.isLineCurve3)?1:p&&p.isSplineCurve?e*p.points.length:e,w=p.getPoints(f),L=0;L<w.length;L++){var V=w[L];t&&t.equals(V)||(r.push(V),t=V)}return this.autoClose&&1<r.length&&!r[r.length-1].equals(r[0])&&r.push(r[0]),r},copy:function(e){mt.prototype.copy.call(this,e),this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(i.clone())}return this.autoClose=e.autoClose,this},toJSON:function(){var e=mt.prototype.toJSON.call(this);e.autoClose=this.autoClose,e.curves=[];for(var t=0,r=this.curves.length;t<r;t++){var i=this.curves[t];e.curves.push(i.toJSON())}return e},fromJSON:function(e){mt.prototype.fromJSON.call(this,e),this.autoClose=e.autoClose,this.curves=[];for(var t=0,r=e.curves.length;t<r;t++){var i=e.curves[t];this.curves.push(new ga[i.type]().fromJSON(i))}return this}}),va.prototype=Object.assign(Object.create(ya.prototype),{constructor:va,setFromPoints:function(e){this.moveTo(e[0].x,e[0].y);for(var t=1,r=e.length;t<r;t++)this.lineTo(e[t].x,e[t].y);return this},moveTo:function(e,t){return this.currentPoint.set(e,t),this},lineTo:function(e,t){var r=new Gr(this.currentPoint.clone(),new Gt(e,t));return this.curves.push(r),this.currentPoint.set(e,t),this},quadraticCurveTo:function(e,t,r,i){var l=new ii(this.currentPoint.clone(),new Gt(e,t),new Gt(r,i));return this.curves.push(l),this.currentPoint.set(r,i),this},bezierCurveTo:function(e,t,r,i,l,p){var f=new Rn(this.currentPoint.clone(),new Gt(e,t),new Gt(r,i),new Gt(l,p));return this.curves.push(f),this.currentPoint.set(l,p),this},splineThru:function(e){var t=new Wn([this.currentPoint.clone()].concat(e));return this.curves.push(t),this.currentPoint.copy(e[e.length-1]),this},arc:function(e,t,r,i,l,p){var f=this.currentPoint.x,w=this.currentPoint.y;return this.absarc(e+f,t+w,r,i,l,p),this},absarc:function(e,t,r,i,l,p){return this.absellipse(e,t,r,r,i,l,p),this},ellipse:function(e,t,r,i,l,p,f,w){var L=this.currentPoint.x,V=this.currentPoint.y;return this.absellipse(e+L,t+V,r,i,l,p,f,w),this},absellipse:function(e,t,r,i,l,p,f,w){var L=new Nt(e,t,r,i,l,p,f,w);if(0<this.curves.length){var V=L.getPoint(0);V.equals(this.currentPoint)||this.lineTo(V.x,V.y)}this.curves.push(L);var Z=L.getPoint(1);return this.currentPoint.copy(Z),this},copy:function(e){return ya.prototype.copy.call(this,e),this.currentPoint.copy(e.currentPoint),this},toJSON:function(){var e=ya.prototype.toJSON.call(this);return e.currentPoint=this.currentPoint.toArray(),e},fromJSON:function(e){return ya.prototype.fromJSON.call(this,e),this.currentPoint.fromArray(e.currentPoint),this}}),$a.prototype=Object.assign(Object.create(va.prototype),{constructor:$a,getPointsHoles:function(e){for(var t=[],r=0,i=this.holes.length;r<i;r++)t[r]=this.holes[r].getPoints(e);return t},extractPoints:function(e){return{shape:this.getPoints(e),holes:this.getPointsHoles(e)}},copy:function(e){va.prototype.copy.call(this,e),this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(i.clone())}return this},toJSON:function(){var e=va.prototype.toJSON.call(this);e.uuid=this.uuid,e.holes=[];for(var t=0,r=this.holes.length;t<r;t++){var i=this.holes[t];e.holes.push(i.toJSON())}return e},fromJSON:function(e){va.prototype.fromJSON.call(this,e),this.uuid=e.uuid,this.holes=[];for(var t=0,r=e.holes.length;t<r;t++){var i=e.holes[t];this.holes.push(new va().fromJSON(i))}return this}}),Hn.prototype=Object.assign(Object.create(At.prototype),{constructor:Hn,isLight:!0,copy:function(e){return At.prototype.copy.call(this,e),this.color.copy(e.color),this.intensity=e.intensity,this},toJSON:function(e){var t=At.prototype.toJSON.call(this,e);return t.object.color=this.color.getHex(),t.object.intensity=this.intensity,this.groundColor!==void 0&&(t.object.groundColor=this.groundColor.getHex()),this.distance!==void 0&&(t.object.distance=this.distance),this.angle!==void 0&&(t.object.angle=this.angle),this.decay!==void 0&&(t.object.decay=this.decay),this.penumbra!==void 0&&(t.object.penumbra=this.penumbra),this.shadow!==void 0&&(t.object.shadow=this.shadow.toJSON()),t}}),Ju.prototype=Object.assign(Object.create(Hn.prototype),{constructor:Ju,isHemisphereLight:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.groundColor.copy(e.groundColor),this}}),Object.assign(jo.prototype,{_projScreenMatrix:new mn,_lightPositionWorld:new Le,_lookTarget:new Le,getViewportCount:function(){return this._viewportCount},getFrustum:function(){return this._frustum},updateMatrices:function(e){var t=this.camera,r=this.matrix,i=this._projScreenMatrix,l=this._lookTarget,p=this._lightPositionWorld;p.setFromMatrixPosition(e.matrixWorld),t.position.copy(p),l.setFromMatrixPosition(e.target.matrixWorld),t.lookAt(l),t.updateMatrixWorld(),i.multiplyMatrices(t.projectionMatrix,t.matrixWorldInverse),this._frustum.setFromProjectionMatrix(i),r.set(.5,0,0,.5,0,.5,0,.5,0,0,.5,.5,0,0,0,1),r.multiply(t.projectionMatrix),r.multiply(t.matrixWorldInverse)},getViewport:function(e){return this._viewports[e]},getFrameExtents:function(){return this._frameExtents},copy:function(e){return this.camera=e.camera.clone(),this.bias=e.bias,this.radius=e.radius,this.mapSize.copy(e.mapSize),this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e={};return this.bias!==0&&(e.bias=this.bias),this.radius!==1&&(e.radius=this.radius),this.mapSize.x===512&&this.mapSize.y===512||(e.mapSize=this.mapSize.toArray()),e.camera=this.camera.toJSON(!1).object,delete e.camera.matrix,e}}),yl.prototype=Object.assign(Object.create(jo.prototype),{constructor:yl,isSpotLightShadow:!0,updateMatrices:function(e){var t=this.camera,r=2*xn.RAD2DEG*e.angle,i=this.mapSize.width/this.mapSize.height,l=e.distance||t.far;r===t.fov&&i===t.aspect&&l===t.far||(t.fov=r,t.aspect=i,t.far=l,t.updateProjectionMatrix()),jo.prototype.updateMatrices.call(this,e)}}),tu.prototype=Object.assign(Object.create(Hn.prototype),{constructor:tu,isSpotLight:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.distance=e.distance,this.angle=e.angle,this.penumbra=e.penumbra,this.decay=e.decay,this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),ru.prototype=Object.assign(Object.create(jo.prototype),{constructor:ru,isPointLightShadow:!0,updateMatrices:function(e,t){t===void 0&&(t=0);var r=this.camera,i=this.matrix,l=this._lightPositionWorld,p=this._lookTarget,f=this._projScreenMatrix;l.setFromMatrixPosition(e.matrixWorld),r.position.copy(l),p.copy(r.position),p.add(this._cubeDirections[t]),r.up.copy(this._cubeUps[t]),r.lookAt(p),r.updateMatrixWorld(),i.makeTranslation(-l.x,-l.y,-l.z),f.multiplyMatrices(r.projectionMatrix,r.matrixWorldInverse),this._frustum.setFromProjectionMatrix(f)}}),vl.prototype=Object.assign(Object.create(Hn.prototype),{constructor:vl,isPointLight:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.distance=e.distance,this.decay=e.decay,this.shadow=e.shadow.clone(),this}}),xl.prototype=Object.assign(Object.create(Lo.prototype),{constructor:xl,isOrthographicCamera:!0,copy:function(e,t){return Lo.prototype.copy.call(this,e,t),this.left=e.left,this.right=e.right,this.top=e.top,this.bottom=e.bottom,this.near=e.near,this.far=e.far,this.zoom=e.zoom,this.view=e.view===null?null:Object.assign({},e.view),this},setViewOffset:function(e,t,r,i,l,p){this.view===null&&(this.view={enabled:!0,fullWidth:1,fullHeight:1,offsetX:0,offsetY:0,width:1,height:1}),this.view.enabled=!0,this.view.fullWidth=e,this.view.fullHeight=t,this.view.offsetX=r,this.view.offsetY=i,this.view.width=l,this.view.height=p,this.updateProjectionMatrix()},clearViewOffset:function(){this.view!==null&&(this.view.enabled=!1),this.updateProjectionMatrix()},updateProjectionMatrix:function(){var e=(this.right-this.left)/(2*this.zoom),t=(this.top-this.bottom)/(2*this.zoom),r=(this.right+this.left)/2,i=(this.top+this.bottom)/2,l=r-e,p=r+e,f=i+t,w=i-t;if(this.view!==null&&this.view.enabled){var L=(this.right-this.left)/this.view.fullWidth/this.zoom,V=(this.top-this.bottom)/this.view.fullHeight/this.zoom;p=(l+=L*this.view.offsetX)+L*this.view.width,w=(f-=V*this.view.offsetY)-V*this.view.height}this.projectionMatrix.makeOrthographic(l,p,f,w,this.near,this.far),this.projectionMatrixInverse.getInverse(this.projectionMatrix)},toJSON:function(e){var t=At.prototype.toJSON.call(this,e);return t.object.zoom=this.zoom,t.object.left=this.left,t.object.right=this.right,t.object.top=this.top,t.object.bottom=this.bottom,t.object.near=this.near,t.object.far=this.far,this.view!==null&&(t.object.view=Object.assign({},this.view)),t}}),wl.prototype=Object.assign(Object.create(jo.prototype),{constructor:wl,isDirectionalLightShadow:!0,updateMatrices:function(e){jo.prototype.updateMatrices.call(this,e)}}),bl.prototype=Object.assign(Object.create(Hn.prototype),{constructor:bl,isDirectionalLight:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.target=e.target.clone(),this.shadow=e.shadow.clone(),this}}),yp.prototype=Object.assign(Object.create(Hn.prototype),{constructor:yp,isAmbientLight:!0}),vp.prototype=Object.assign(Object.create(Hn.prototype),{constructor:vp,isRectAreaLight:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.width=e.width,this.height=e.height,this},toJSON:function(e){var t=Hn.prototype.toJSON.call(this,e);return t.object.width=this.width,t.object.height=this.height,t}}),xp.prototype=Object.assign(Object.create(s.prototype),{constructor:xp,load:function(e,t,r,i){var l=this,p=new R(l.manager);p.setPath(l.path),p.load(e,function(f){t(l.parse(JSON.parse(f)))},r,i)},parse:function(e){var t=this.textures;function r(L){return t[L]===void 0&&console.warn("THREE.MaterialLoader: Undefined texture",L),t[L]}var i=new $p[e.type];if(e.uuid!==void 0&&(i.uuid=e.uuid),e.name!==void 0&&(i.name=e.name),e.color!==void 0&&i.color.setHex(e.color),e.roughness!==void 0&&(i.roughness=e.roughness),e.metalness!==void 0&&(i.metalness=e.metalness),e.sheen!==void 0&&(i.sheen=new Qe().setHex(e.sheen)),e.emissive!==void 0&&i.emissive.setHex(e.emissive),e.specular!==void 0&&i.specular.setHex(e.specular),e.shininess!==void 0&&(i.shininess=e.shininess),e.clearcoat!==void 0&&(i.clearcoat=e.clearcoat),e.clearcoatRoughness!==void 0&&(i.clearcoatRoughness=e.clearcoatRoughness),e.vertexColors!==void 0&&(i.vertexColors=e.vertexColors),e.fog!==void 0&&(i.fog=e.fog),e.flatShading!==void 0&&(i.flatShading=e.flatShading),e.blending!==void 0&&(i.blending=e.blending),e.combine!==void 0&&(i.combine=e.combine),e.side!==void 0&&(i.side=e.side),e.opacity!==void 0&&(i.opacity=e.opacity),e.transparent!==void 0&&(i.transparent=e.transparent),e.alphaTest!==void 0&&(i.alphaTest=e.alphaTest),e.depthTest!==void 0&&(i.depthTest=e.depthTest),e.depthWrite!==void 0&&(i.depthWrite=e.depthWrite),e.colorWrite!==void 0&&(i.colorWrite=e.colorWrite),e.stencilWrite!==void 0&&(i.stencilWrite=e.stencilWrite),e.stencilWriteMask!==void 0&&(i.stencilWriteMask=e.stencilWriteMask),e.stencilFunc!==void 0&&(i.stencilFunc=e.stencilFunc),e.stencilRef!==void 0&&(i.stencilRef=e.stencilRef),e.stencilFuncMask!==void 0&&(i.stencilFuncMask=e.stencilFuncMask),e.stencilFail!==void 0&&(i.stencilFail=e.stencilFail),e.stencilZFail!==void 0&&(i.stencilZFail=e.stencilZFail),e.stencilZPass!==void 0&&(i.stencilZPass=e.stencilZPass),e.wireframe!==void 0&&(i.wireframe=e.wireframe),e.wireframeLinewidth!==void 0&&(i.wireframeLinewidth=e.wireframeLinewidth),e.wireframeLinecap!==void 0&&(i.wireframeLinecap=e.wireframeLinecap),e.wireframeLinejoin!==void 0&&(i.wireframeLinejoin=e.wireframeLinejoin),e.rotation!==void 0&&(i.rotation=e.rotation),e.linewidth!==1&&(i.linewidth=e.linewidth),e.dashSize!==void 0&&(i.dashSize=e.dashSize),e.gapSize!==void 0&&(i.gapSize=e.gapSize),e.scale!==void 0&&(i.scale=e.scale),e.polygonOffset!==void 0&&(i.polygonOffset=e.polygonOffset),e.polygonOffsetFactor!==void 0&&(i.polygonOffsetFactor=e.polygonOffsetFactor),e.polygonOffsetUnits!==void 0&&(i.polygonOffsetUnits=e.polygonOffsetUnits),e.skinning!==void 0&&(i.skinning=e.skinning),e.morphTargets!==void 0&&(i.morphTargets=e.morphTargets),e.morphNormals!==void 0&&(i.morphNormals=e.morphNormals),e.dithering!==void 0&&(i.dithering=e.dithering),e.visible!==void 0&&(i.visible=e.visible),e.toneMapped!==void 0&&(i.toneMapped=e.toneMapped),e.userData!==void 0&&(i.userData=e.userData),e.uniforms!==void 0)for(var l in e.uniforms){var p=e.uniforms[l];switch(i.uniforms[l]={},p.type){case"t":i.uniforms[l].value=r(p.value);break;case"c":i.uniforms[l].value=new Qe().setHex(p.value);break;case"v2":i.uniforms[l].value=new Gt().fromArray(p.value);break;case"v3":i.uniforms[l].value=new Le().fromArray(p.value);break;case"v4":i.uniforms[l].value=new qn().fromArray(p.value);break;case"m3":i.uniforms[l].value=new Ai().fromArray(p.value);case"m4":i.uniforms[l].value=new mn().fromArray(p.value);break;default:i.uniforms[l].value=p.value}}if(e.defines!==void 0&&(i.defines=e.defines),e.vertexShader!==void 0&&(i.vertexShader=e.vertexShader),e.fragmentShader!==void 0&&(i.fragmentShader=e.fragmentShader),e.extensions!==void 0)for(var f in e.extensions)i.extensions[f]=e.extensions[f];if(e.shading!==void 0&&(i.flatShading=e.shading===1),e.size!==void 0&&(i.size=e.size),e.sizeAttenuation!==void 0&&(i.sizeAttenuation=e.sizeAttenuation),e.map!==void 0&&(i.map=r(e.map)),e.matcap!==void 0&&(i.matcap=r(e.matcap)),e.alphaMap!==void 0&&(i.alphaMap=r(e.alphaMap),i.transparent=!0),e.bumpMap!==void 0&&(i.bumpMap=r(e.bumpMap)),e.bumpScale!==void 0&&(i.bumpScale=e.bumpScale),e.normalMap!==void 0&&(i.normalMap=r(e.normalMap)),e.normalMapType!==void 0&&(i.normalMapType=e.normalMapType),e.normalScale!==void 0){var w=e.normalScale;Array.isArray(w)===!1&&(w=[w,w]),i.normalScale=new Gt().fromArray(w)}return e.displacementMap!==void 0&&(i.displacementMap=r(e.displacementMap)),e.displacementScale!==void 0&&(i.displacementScale=e.displacementScale),e.displacementBias!==void 0&&(i.displacementBias=e.displacementBias),e.roughnessMap!==void 0&&(i.roughnessMap=r(e.roughnessMap)),e.metalnessMap!==void 0&&(i.metalnessMap=r(e.metalnessMap)),e.emissiveMap!==void 0&&(i.emissiveMap=r(e.emissiveMap)),e.emissiveIntensity!==void 0&&(i.emissiveIntensity=e.emissiveIntensity),e.specularMap!==void 0&&(i.specularMap=r(e.specularMap)),e.envMap!==void 0&&(i.envMap=r(e.envMap)),e.envMapIntensity!==void 0&&(i.envMapIntensity=e.envMapIntensity),e.reflectivity!==void 0&&(i.reflectivity=e.reflectivity),e.refractionRatio!==void 0&&(i.refractionRatio=e.refractionRatio),e.lightMap!==void 0&&(i.lightMap=r(e.lightMap)),e.lightMapIntensity!==void 0&&(i.lightMapIntensity=e.lightMapIntensity),e.aoMap!==void 0&&(i.aoMap=r(e.aoMap)),e.aoMapIntensity!==void 0&&(i.aoMapIntensity=e.aoMapIntensity),e.gradientMap!==void 0&&(i.gradientMap=r(e.gradientMap)),e.clearcoatNormalMap!==void 0&&(i.clearcoatNormalMap=r(e.clearcoatNormalMap)),e.clearcoatNormalScale!==void 0&&(i.clearcoatNormalScale=new Gt().fromArray(e.clearcoatNormalScale)),i},setTextures:function(e){return this.textures=e,this}});var ed={decodeText:function(e){if(typeof TextDecoder<"u")return new TextDecoder().decode(e);for(var t="",r=0,i=e.length;r<i;r++)t+=String.fromCharCode(e[r]);try{return decodeURIComponent(escape(t))}catch{return t}},extractUrlBase:function(e){var t=e.lastIndexOf("/");return t===-1?"./":e.substr(0,t+1)}};function wp(){br.call(this),this.type="InstancedBufferGeometry",this.maxInstancedCount=void 0}function bp(e,t,r,i){typeof r=="number"&&(i=r,r=!1,console.error("THREE.InstancedBufferAttribute: The constructor now expects normalized as the third argument.")),Kt.call(this,e,t,r),this.meshPerAttribute=i||1}function Mp(e){s.call(this,e)}wp.prototype=Object.assign(Object.create(br.prototype),{constructor:wp,isInstancedBufferGeometry:!0,copy:function(e){return br.prototype.copy.call(this,e),this.maxInstancedCount=e.maxInstancedCount,this},clone:function(){return new this.constructor().copy(this)},toJSON:function(){var e=br.prototype.toJSON.call(this);return e.maxInstancedCount=this.maxInstancedCount,e.isInstancedBufferGeometry=!0,e}}),bp.prototype=Object.assign(Object.create(Kt.prototype),{constructor:bp,isInstancedBufferAttribute:!0,copy:function(e){return Kt.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this},toJSON:function(){var e=Kt.prototype.toJSON.call(this);return e.meshPerAttribute=this.meshPerAttribute,e.isInstancedBufferAttribute=!0,e}}),Mp.prototype=Object.assign(Object.create(s.prototype),{constructor:Mp,load:function(e,t,r,i){var l=this,p=new R(l.manager);p.setPath(l.path),p.load(e,function(f){t(l.parse(JSON.parse(f)))},r,i)},parse:function(e){var t=new(e.isInstancedBufferGeometry?wp:br),r=e.data.index;if(r!==void 0){var i=new td[r.type](r.array);t.setIndex(new Kt(i,1))}var l=e.data.attributes;for(var p in l){var f=l[p],w=(i=new td[f.type](f.array),new(f.isInstancedBufferAttribute?bp:Kt)(i,f.itemSize,f.normalized));f.name!==void 0&&(w.name=f.name),t.setAttribute(p,w)}var L=e.data.morphAttributes;if(L)for(var p in L){for(var V=L[p],Z=[],ee=0,ae=V.length;ee<ae;ee++)f=V[ee],w=new Kt(i=new td[f.type](f.array),f.itemSize,f.normalized),f.name!==void 0&&(w.name=f.name),Z.push(w);t.morphAttributes[p]=Z}e.data.morphTargetsRelative&&(t.morphTargetsRelative=!0);var W=e.data.groups||e.data.drawcalls||e.data.offsets;if(W!==void 0){ee=0;for(var he=W.length;ee!==he;++ee){var ge=W[ee];t.addGroup(ge.start,ge.count,ge.materialIndex)}}var ye=e.data.boundingSphere;if(ye!==void 0){var Ae=new Le;ye.center!==void 0&&Ae.fromArray(ye.center),t.boundingSphere=new Kn(Ae,ye.radius)}return e.name&&(t.name=e.name),e.userData&&(t.userData=e.userData),t}});var td={Int8Array,Uint8Array,Uint8ClampedArray:typeof Uint8ClampedArray<"u"?Uint8ClampedArray:Uint8Array,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array};function _p(e){s.call(this,e)}_p.prototype=Object.assign(Object.create(s.prototype),{constructor:_p,load:function(e,t,r,i){var l=this,p=this.path===""?ed.extractUrlBase(e):this.path;this.resourcePath=this.resourcePath||p;var f=new R(l.manager);f.setPath(this.path),f.load(e,function(w){var L=null;try{L=JSON.parse(w)}catch(Z){return i!==void 0&&i(Z),void console.error("THREE:ObjectLoader: Can't parse "+e+".",Z.message)}var V=L.metadata;V!==void 0&&V.type!==void 0&&V.type.toLowerCase()!=="geometry"?l.parse(L,t):console.error("THREE.ObjectLoader: Can't load "+e)},r,i)},parse:function(e,t){var r=this.parseShape(e.shapes),i=this.parseGeometries(e.geometries,r),l=this.parseImages(e.images,function(){t!==void 0&&t(w)}),p=this.parseTextures(e.textures,l),f=this.parseMaterials(e.materials,p),w=this.parseObject(e.object,i,f);return e.animations&&(w.animations=this.parseAnimations(e.animations)),e.images!==void 0&&e.images.length!==0||t!==void 0&&t(w),w},parseShape:function(e){var t={};if(e!==void 0)for(var r=0,i=e.length;r<i;r++){var l=new $a().fromJSON(e[r]);t[l.uuid]=l}return t},parseGeometries:function(e,t){var r={};if(e!==void 0)for(var i=new Mp,l=0,p=e.length;l<p;l++){var f,w=e[l];switch(w.type){case"PlaneGeometry":case"PlaneBufferGeometry":f=new Ba[w.type](w.width,w.height,w.widthSegments,w.heightSegments);break;case"BoxGeometry":case"BoxBufferGeometry":case"CubeGeometry":f=new Ba[w.type](w.width,w.height,w.depth,w.widthSegments,w.heightSegments,w.depthSegments);break;case"CircleGeometry":case"CircleBufferGeometry":f=new Ba[w.type](w.radius,w.segments,w.thetaStart,w.thetaLength);break;case"CylinderGeometry":case"CylinderBufferGeometry":f=new Ba[w.type](w.radiusTop,w.radiusBottom,w.height,w.radialSegments,w.heightSegments,w.openEnded,w.thetaStart,w.thetaLength);break;case"ConeGeometry":case"ConeBufferGeometry":f=new Ba[w.type](w.radius,w.height,w.radialSegments,w.heightSegments,w.openEnded,w.thetaStart,w.thetaLength);break;case"SphereGeometry":case"SphereBufferGeometry":f=new Ba[w.type](w.radius,w.widthSegments,w.heightSegments,w.phiStart,w.phiLength,w.thetaStart,w.thetaLength);break;case"DodecahedronGeometry":case"DodecahedronBufferGeometry":case"IcosahedronGeometry":case"IcosahedronBufferGeometry":case"OctahedronGeometry":case"OctahedronBufferGeometry":case"TetrahedronGeometry":case"TetrahedronBufferGeometry":f=new Ba[w.type](w.radius,w.detail);break;case"RingGeometry":case"RingBufferGeometry":f=new Ba[w.type](w.innerRadius,w.outerRadius,w.thetaSegments,w.phiSegments,w.thetaStart,w.thetaLength);break;case"TorusGeometry":case"TorusBufferGeometry":f=new Ba[w.type](w.radius,w.tube,w.radialSegments,w.tubularSegments,w.arc);break;case"TorusKnotGeometry":case"TorusKnotBufferGeometry":f=new Ba[w.type](w.radius,w.tube,w.tubularSegments,w.radialSegments,w.p,w.q);break;case"TubeGeometry":case"TubeBufferGeometry":f=new Ba[w.type](new ga[w.path.type]().fromJSON(w.path),w.tubularSegments,w.radius,w.radialSegments,w.closed);break;case"LatheGeometry":case"LatheBufferGeometry":f=new Ba[w.type](w.points,w.segments,w.phiStart,w.phiLength);break;case"PolyhedronGeometry":case"PolyhedronBufferGeometry":f=new Ba[w.type](w.vertices,w.indices,w.radius,w.details);break;case"ShapeGeometry":case"ShapeBufferGeometry":for(var L=[],V=0,Z=w.shapes.length;V<Z;V++){var ee=t[w.shapes[V]];L.push(ee)}f=new Ba[w.type](L,w.curveSegments);break;case"ExtrudeGeometry":case"ExtrudeBufferGeometry":for(L=[],V=0,Z=w.shapes.length;V<Z;V++)ee=t[w.shapes[V]],L.push(ee);var ae=w.options.extrudePath;ae!==void 0&&(w.options.extrudePath=new ga[ae.type]().fromJSON(ae)),f=new Ba[w.type](L,w.options);break;case"BufferGeometry":case"InstancedBufferGeometry":f=i.parse(w);break;case"Geometry":"THREE"in window&&"LegacyJSONLoader"in THREE?f=new THREE.LegacyJSONLoader().parse(w,this.resourcePath).geometry:console.error('THREE.ObjectLoader: You have to import LegacyJSONLoader in order load geometry data of type "Geometry".');break;default:console.warn('THREE.ObjectLoader: Unsupported geometry type "'+w.type+'"');continue}f.uuid=w.uuid,w.name!==void 0&&(f.name=w.name),f.isBufferGeometry===!0&&w.userData!==void 0&&(f.userData=w.userData),r[w.uuid]=f}return r},parseMaterials:function(e,t){var r={},i={};if(e!==void 0){var l=new xp;l.setTextures(t);for(var p=0,f=e.length;p<f;p++){var w=e[p];if(w.type==="MultiMaterial"){for(var L=[],V=0;V<w.materials.length;V++){var Z=w.materials[V];r[Z.uuid]===void 0&&(r[Z.uuid]=l.parse(Z)),L.push(r[Z.uuid])}i[w.uuid]=L}else r[w.uuid]===void 0&&(r[w.uuid]=l.parse(w)),i[w.uuid]=r[w.uuid]}}return i},parseAnimations:function(e){for(var t=[],r=0;r<e.length;r++){var i=e[r],l=_o.parse(i);i.uuid!==void 0&&(l.uuid=i.uuid),t.push(l)}return t},parseImages:function(e,t){var r=this,i={};function l(he){return r.manager.itemStart(he),p.load(he,function(){r.manager.itemEnd(he)},void 0,function(){r.manager.itemError(he),r.manager.itemEnd(he)})}if(e!==void 0&&0<e.length){var p=new Ye(new Vh(t));p.setCrossOrigin(this.crossOrigin);for(var f=0,w=e.length;f<w;f++){var L=e[f],V=L.url;if(Array.isArray(V)){i[L.uuid]=[];for(var Z=0,ee=V.length;Z<ee;Z++){var ae=V[Z],W=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(ae)?ae:r.resourcePath+ae;i[L.uuid].push(l(W))}}else W=/^(\/\/)|([a-z]+:(\/\/)?)/i.test(L.url)?L.url:r.resourcePath+L.url,i[L.uuid]=l(W)}}return i},parseTextures:function(e,t){function r(L,V){return typeof L=="number"?L:(console.warn("THREE.ObjectLoader.parseTexture: Constant should be in numeric form.",L),V[L])}var i={};if(e!==void 0)for(var l=0,p=e.length;l<p;l++){var f,w=e[l];w.image===void 0&&console.warn('THREE.ObjectLoader: No "image" specified for',w.uuid),t[w.image]===void 0&&console.warn("THREE.ObjectLoader: Undefined image",w.image),(f=new(Array.isArray(t[w.image])?Ss:Yn)(t[w.image])).needsUpdate=!0,f.uuid=w.uuid,w.name!==void 0&&(f.name=w.name),w.mapping!==void 0&&(f.mapping=r(w.mapping,Tf)),w.offset!==void 0&&f.offset.fromArray(w.offset),w.repeat!==void 0&&f.repeat.fromArray(w.repeat),w.center!==void 0&&f.center.fromArray(w.center),w.rotation!==void 0&&(f.rotation=w.rotation),w.wrap!==void 0&&(f.wrapS=r(w.wrap[0],jd),f.wrapT=r(w.wrap[1],jd)),w.format!==void 0&&(f.format=w.format),w.type!==void 0&&(f.type=w.type),w.encoding!==void 0&&(f.encoding=w.encoding),w.minFilter!==void 0&&(f.minFilter=r(w.minFilter,Nd)),w.magFilter!==void 0&&(f.magFilter=r(w.magFilter,Nd)),w.anisotropy!==void 0&&(f.anisotropy=w.anisotropy),w.flipY!==void 0&&(f.flipY=w.flipY),w.premultiplyAlpha!==void 0&&(f.premultiplyAlpha=w.premultiplyAlpha),w.unpackAlignment!==void 0&&(f.unpackAlignment=w.unpackAlignment),i[w.uuid]=f}return i},parseObject:function(e,t,r){var i;function l(ye){return t[ye]===void 0&&console.warn("THREE.ObjectLoader: Undefined geometry",ye),t[ye]}function p(ye){if(ye!==void 0){if(Array.isArray(ye)){for(var Ae=[],je=0,He=ye.length;je<He;je++){var et=ye[je];r[et]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",et),Ae.push(r[et])}return Ae}return r[ye]===void 0&&console.warn("THREE.ObjectLoader: Undefined material",ye),r[ye]}}switch(e.type){case"Scene":i=new Wr,e.background!==void 0&&Number.isInteger(e.background)&&(i.background=new Qe(e.background)),e.fog!==void 0&&(e.fog.type==="Fog"?i.fog=new Yo(e.fog.color,e.fog.near,e.fog.far):e.fog.type==="FogExp2"&&(i.fog=new ho(e.fog.color,e.fog.density)));break;case"PerspectiveCamera":i=new Ni(e.fov,e.aspect,e.near,e.far),e.focus!==void 0&&(i.focus=e.focus),e.zoom!==void 0&&(i.zoom=e.zoom),e.filmGauge!==void 0&&(i.filmGauge=e.filmGauge),e.filmOffset!==void 0&&(i.filmOffset=e.filmOffset),e.view!==void 0&&(i.view=Object.assign({},e.view));break;case"OrthographicCamera":i=new xl(e.left,e.right,e.top,e.bottom,e.near,e.far),e.zoom!==void 0&&(i.zoom=e.zoom),e.view!==void 0&&(i.view=Object.assign({},e.view));break;case"AmbientLight":i=new yp(e.color,e.intensity);break;case"DirectionalLight":i=new bl(e.color,e.intensity);break;case"PointLight":i=new vl(e.color,e.intensity,e.distance,e.decay);break;case"RectAreaLight":i=new vp(e.color,e.intensity,e.width,e.height);break;case"SpotLight":i=new tu(e.color,e.intensity,e.distance,e.angle,e.penumbra,e.decay);break;case"HemisphereLight":i=new Ju(e.color,e.groundColor,e.intensity);break;case"SkinnedMesh":console.warn("THREE.ObjectLoader.parseObject() does not support SkinnedMesh yet.");case"Mesh":var f=l(e.geometry),w=p(e.material);i=new(f.bones&&0<f.bones.length?_u:Di)(f,w);break;case"InstancedMesh":f=l(e.geometry),w=p(e.material);var L=e.count,V=e.instanceMatrix;(i=new Oc(f,w,L)).instanceMatrix=new Kt(new Float32Array(V.array),16);break;case"LOD":i=new Mu;break;case"Line":i=new Ra(l(e.geometry),p(e.material),e.mode);break;case"LineLoop":i=new Du(l(e.geometry),p(e.material));break;case"LineSegments":i=new gi(l(e.geometry),p(e.material));break;case"PointCloud":case"Points":i=new zl(l(e.geometry),p(e.material));break;case"Sprite":i=new bu(p(e.material));break;case"Group":i=new nl;break;default:i=new At}if(i.uuid=e.uuid,e.name!==void 0&&(i.name=e.name),e.matrix!==void 0?(i.matrix.fromArray(e.matrix),e.matrixAutoUpdate!==void 0&&(i.matrixAutoUpdate=e.matrixAutoUpdate),i.matrixAutoUpdate&&i.matrix.decompose(i.position,i.quaternion,i.scale)):(e.position!==void 0&&i.position.fromArray(e.position),e.rotation!==void 0&&i.rotation.fromArray(e.rotation),e.quaternion!==void 0&&i.quaternion.fromArray(e.quaternion),e.scale!==void 0&&i.scale.fromArray(e.scale)),e.castShadow!==void 0&&(i.castShadow=e.castShadow),e.receiveShadow!==void 0&&(i.receiveShadow=e.receiveShadow),e.shadow&&(e.shadow.bias!==void 0&&(i.shadow.bias=e.shadow.bias),e.shadow.radius!==void 0&&(i.shadow.radius=e.shadow.radius),e.shadow.mapSize!==void 0&&i.shadow.mapSize.fromArray(e.shadow.mapSize),e.shadow.camera!==void 0&&(i.shadow.camera=this.parseObject(e.shadow.camera))),e.visible!==void 0&&(i.visible=e.visible),e.frustumCulled!==void 0&&(i.frustumCulled=e.frustumCulled),e.renderOrder!==void 0&&(i.renderOrder=e.renderOrder),e.userData!==void 0&&(i.userData=e.userData),e.layers!==void 0&&(i.layers.mask=e.layers),e.children!==void 0)for(var Z=e.children,ee=0;ee<Z.length;ee++)i.add(this.parseObject(Z[ee],t,r));if(e.type==="LOD"){e.autoUpdate!==void 0&&(i.autoUpdate=e.autoUpdate);for(var ae=e.levels,W=0;W<ae.length;W++){var he=ae[W],ge=i.getObjectByProperty("uuid",he.object);ge!==void 0&&i.addLevel(ge,he.distance)}}return i}});var Tp,Tf={UVMapping:300,CubeReflectionMapping:Rt,CubeRefractionMapping:It,EquirectangularReflectionMapping:Nr,EquirectangularRefractionMapping:Qt,SphericalReflectionMapping:Ur,CubeUVReflectionMapping:gt,CubeUVRefractionMapping:We},jd={RepeatWrapping:Yt,ClampToEdgeWrapping:Or,MirroredRepeatWrapping:Yr},Nd={NearestFilter:ct,NearestMipmapNearestFilter:st,NearestMipmapLinearFilter:qt,LinearFilter:Tr,LinearMipmapNearestFilter:ir,LinearMipmapLinearFilter:Hr};function rd(e){typeof createImageBitmap>"u"&&console.warn("THREE.ImageBitmapLoader: createImageBitmap() not supported."),typeof fetch>"u"&&console.warn("THREE.ImageBitmapLoader: fetch() not supported."),s.call(this,e),this.options=void 0}function nd(){this.type="ShapePath",this.color=new Qe,this.subPaths=[],this.currentPath=null}function id(e){this.type="Font",this.data=e}function Cf(e,t,r,i,l){var p=l.glyphs[e]||l.glyphs["?"];if(p){var f,w,L,V,Z,ee,ae,W,he=new nd;if(p.o)for(var ge=p._cachedOutline||(p._cachedOutline=p.o.split(" ")),ye=0,Ae=ge.length;ye<Ae;)switch(ge[ye++]){case"m":f=ge[ye++]*t+r,w=ge[ye++]*t+i,he.moveTo(f,w);break;case"l":f=ge[ye++]*t+r,w=ge[ye++]*t+i,he.lineTo(f,w);break;case"q":L=ge[ye++]*t+r,V=ge[ye++]*t+i,Z=ge[ye++]*t+r,ee=ge[ye++]*t+i,he.quadraticCurveTo(Z,ee,L,V);break;case"b":L=ge[ye++]*t+r,V=ge[ye++]*t+i,Z=ge[ye++]*t+r,ee=ge[ye++]*t+i,ae=ge[ye++]*t+r,W=ge[ye++]*t+i,he.bezierCurveTo(Z,ee,ae,W,L,V)}return{offsetX:p.ha*t,path:he}}console.error('THREE.Font: character "'+e+'" does not exists in font family '+l.familyName+".")}function ad(e){s.call(this,e)}rd.prototype=Object.assign(Object.create(s.prototype),{constructor:rd,setOptions:function(e){return this.options=e,this},load:function(e,t,r,i){e===void 0&&(e=""),this.path!==void 0&&(e=this.path+e),e=this.manager.resolveURL(e);var l=this,p=gl.get(e);if(p!==void 0)return l.manager.itemStart(e),setTimeout(function(){t&&t(p),l.manager.itemEnd(e)},0),p;fetch(e).then(function(f){return f.blob()}).then(function(f){return l.options===void 0?createImageBitmap(f):createImageBitmap(f,l.options)}).then(function(f){gl.add(e,f),t&&t(f),l.manager.itemEnd(e)}).catch(function(f){i&&i(f),l.manager.itemError(e),l.manager.itemEnd(e)}),l.manager.itemStart(e)}}),Object.assign(nd.prototype,{moveTo:function(e,t){return this.currentPath=new va,this.subPaths.push(this.currentPath),this.currentPath.moveTo(e,t),this},lineTo:function(e,t){return this.currentPath.lineTo(e,t),this},quadraticCurveTo:function(e,t,r,i){return this.currentPath.quadraticCurveTo(e,t,r,i),this},bezierCurveTo:function(e,t,r,i,l,p){return this.currentPath.bezierCurveTo(e,t,r,i,l,p),this},splineThru:function(e){return this.currentPath.splineThru(e),this},toShapes:function(e,t){function r(Mt){for(var lr=[],yr=0,$r=Mt.length;yr<$r;yr++){var Xr=Mt[yr],Vr=new $a;Vr.curves=Xr.curves,lr.push(Vr)}return lr}function i(Mt,lr){for(var yr=lr.length,$r=!1,Xr=yr-1,Vr=0;Vr<yr;Xr=Vr++){var hn=lr[Xr],Mr=lr[Vr],Ve=Mr.x-hn.x,tt=Mr.y-hn.y;if(Math.abs(tt)>Number.EPSILON){if(tt<0&&(hn=lr[Vr],Ve=-Ve,Mr=lr[Xr],tt=-tt),Mt.y<hn.y||Mt.y>Mr.y)continue;if(Mt.y===hn.y){if(Mt.x===hn.x)return 1}else{var Jt=tt*(Mt.x-hn.x)-Ve*(Mt.y-hn.y);if(Jt==0)return 1;if(Jt<0)continue;$r=!$r}}else{if(Mt.y!==hn.y)continue;if(Mr.x<=Mt.x&&Mt.x<=hn.x||hn.x<=Mt.x&&Mt.x<=Mr.x)return 1}}return $r}var l=hs.isClockWise,p=this.subPaths;if(p.length===0)return[];if(t===!0)return r(p);var f,w,L,V=[];if(p.length===1)return w=p[0],(L=new $a).curves=w.curves,V.push(L),V;var Z=!l(p[0].getPoints());Z=e?!Z:Z;var ee,ae,W=[],he=[],ge=[],ye=0;he[ye]=void 0,ge[ye]=[];for(var Ae=0,je=p.length;Ae<je;Ae++)f=l(ee=(w=p[Ae]).getPoints()),(f=e?!f:f)?(!Z&&he[ye]&&ye++,he[ye]={s:new $a,p:ee},he[ye].s.curves=w.curves,Z&&ye++,ge[ye]=[]):ge[ye].push({h:w,p:ee[0]});if(!he[0])return r(p);if(1<he.length){for(var He=!1,et=[],Ge=0,it=he.length;Ge<it;Ge++)W[Ge]=[];for(Ge=0,it=he.length;Ge<it;Ge++)for(var qe=ge[Ge],vt=0;vt<qe.length;vt++){for(var Tt=qe[vt],Et=!0,Ot=0;Ot<he.length;Ot++)i(Tt.p,he[Ot].p)&&(Ge!==Ot&&et.push({froms:Ge,tos:Ot,hole:vt}),Et?(Et=!1,W[Ot].push(Tt)):He=!0);Et&&W[Ge].push(Tt)}0<et.length&&(He||(ge=W))}Ae=0;for(var Bt=he.length;Ae<Bt;Ae++){L=he[Ae].s,V.push(L);for(var Xt=0,Dt=(ae=ge[Ae]).length;Xt<Dt;Xt++)L.holes.push(ae[Xt].h)}return V}}),Object.assign(id.prototype,{isFont:!0,generateShapes:function(e,t){t===void 0&&(t=100);for(var r=[],i=function(f,w,L){for(var V=Array.from?Array.from(f):String(f).split(""),Z=w/L.resolution,ee=(L.boundingBox.yMax-L.boundingBox.yMin+L.underlineThickness)*Z,ae=[],W=0,he=0,ge=0;ge<V.length;ge++){var ye=V[ge];if(ye===`
`)W=0,he-=ee;else{var Ae=Cf(ye,Z,W,he,L);W+=Ae.offsetX,ae.push(Ae.path)}}return ae}(e,t,this.data),l=0,p=i.length;l<p;l++)Array.prototype.push.apply(r,i[l].toShapes());return r}}),ad.prototype=Object.assign(Object.create(s.prototype),{constructor:ad,load:function(e,t,r,i){var l=this,p=new R(this.manager);p.setPath(this.path),p.load(e,function(f){var w;try{w=JSON.parse(f)}catch{console.warn("THREE.FontLoader: typeface.js support is being deprecated. Use typeface.json instead."),w=JSON.parse(f.substring(65,f.length-2))}var L=l.parse(w);t&&t(L)},r,i)},parse:function(e){return new id(e)}});var od={getContext:function(){return Tp===void 0&&(Tp=new(window.AudioContext||window.webkitAudioContext)),Tp},setContext:function(e){Tp=e}};function Cp(e){s.call(this,e)}function Dp(){this.coefficients=[];for(var e=0;e<9;e++)this.coefficients.push(new Le)}function ds(e,t){Hn.call(this,void 0,t),this.sh=e!==void 0?e:new Dp}function sd(e,t,r){ds.call(this,void 0,r);var i=new Qe().set(e),l=new Qe().set(t),p=new Le(i.r,i.g,i.b),f=new Le(l.r,l.g,l.b),w=Math.sqrt(Math.PI),L=w*Math.sqrt(.75);this.sh.coefficients[0].copy(p).add(f).multiplyScalar(w),this.sh.coefficients[1].copy(p).sub(f).multiplyScalar(L)}function ld(e,t){ds.call(this,void 0,t);var r=new Qe().set(e);this.sh.coefficients[0].set(r.r,r.g,r.b).multiplyScalar(2*Math.sqrt(Math.PI))}Cp.prototype=Object.assign(Object.create(s.prototype),{constructor:Cp,load:function(e,t,r,i){var l=new R(this.manager);l.setResponseType("arraybuffer"),l.setPath(this.path),l.load(e,function(p){var f=p.slice(0);od.getContext().decodeAudioData(f,function(w){t(w)})},r,i)}}),Object.assign(Dp.prototype,{isSphericalHarmonics3:!0,set:function(e){for(var t=0;t<9;t++)this.coefficients[t].copy(e[t]);return this},zero:function(){for(var e=0;e<9;e++)this.coefficients[e].set(0,0,0);return this},getAt:function(e,t){var r=e.x,i=e.y,l=e.z,p=this.coefficients;return t.copy(p[0]).multiplyScalar(.282095),t.addScale(p[1],.488603*i),t.addScale(p[2],.488603*l),t.addScale(p[3],.488603*r),t.addScale(p[4],r*i*1.092548),t.addScale(p[5],i*l*1.092548),t.addScale(p[6],.315392*(3*l*l-1)),t.addScale(p[7],r*l*1.092548),t.addScale(p[8],.546274*(r*r-i*i)),t},getIrradianceAt:function(e,t){var r=e.x,i=e.y,l=e.z,p=this.coefficients;return t.copy(p[0]).multiplyScalar(.886227),t.addScale(p[1],1.023328*i),t.addScale(p[2],1.023328*l),t.addScale(p[3],1.023328*r),t.addScale(p[4],.858086*r*i),t.addScale(p[5],.858086*i*l),t.addScale(p[6],.743125*l*l-.247708),t.addScale(p[7],.858086*r*l),t.addScale(p[8],.429043*(r*r-i*i)),t},add:function(e){for(var t=0;t<9;t++)this.coefficients[t].add(e.coefficients[t]);return this},scale:function(e){for(var t=0;t<9;t++)this.coefficients[t].multiplyScalar(e);return this},lerp:function(e,t){for(var r=0;r<9;r++)this.coefficients[r].lerp(e.coefficients[r],t);return this},equals:function(e){for(var t=0;t<9;t++)if(!this.coefficients[t].equals(e.coefficients[t]))return!1;return!0},copy:function(e){return this.set(e.coefficients)},clone:function(){return new this.constructor().copy(this)},fromArray:function(e,t){t===void 0&&(t=0);for(var r=this.coefficients,i=0;i<9;i++)r[i].fromArray(e,t+3*i);return this},toArray:function(e,t){e===void 0&&(e=[]),t===void 0&&(t=0);for(var r=this.coefficients,i=0;i<9;i++)r[i].toArray(e,t+3*i);return e}}),Object.assign(Dp,{getBasisAt:function(e,t){var r=e.x,i=e.y,l=e.z;t[0]=.282095,t[1]=.488603*i,t[2]=.488603*l,t[3]=.488603*r,t[4]=1.092548*r*i,t[5]=1.092548*i*l,t[6]=.315392*(3*l*l-1),t[7]=1.092548*r*l,t[8]=.546274*(r*r-i*i)}}),ds.prototype=Object.assign(Object.create(Hn.prototype),{constructor:ds,isLightProbe:!0,copy:function(e){return Hn.prototype.copy.call(this,e),this.sh.copy(e.sh),this.intensity=e.intensity,this},toJSON:function(e){return Hn.prototype.toJSON.call(this,e)}}),sd.prototype=Object.assign(Object.create(ds.prototype),{constructor:sd,isHemisphereLightProbe:!0,copy:function(e){return ds.prototype.copy.call(this,e),this},toJSON:function(e){return ds.prototype.toJSON.call(this,e)}}),ld.prototype=Object.assign(Object.create(ds.prototype),{constructor:ld,isAmbientLightProbe:!0,copy:function(e){return ds.prototype.copy.call(this,e),this},toJSON:function(e){return ds.prototype.toJSON.call(this,e)}});var Vd=new mn,Fd=new mn;function Bd(){this.type="StereoCamera",this.aspect=1,this.eyeSep=.064,this.cameraL=new Ni,this.cameraL.layers.enable(1),this.cameraL.matrixAutoUpdate=!1,this.cameraR=new Ni,this.cameraR.layers.enable(2),this.cameraR.matrixAutoUpdate=!1,this._cache={focus:null,fov:null,aspect:null,near:null,far:null,zoom:null,eyeSep:null}}function ud(e){this.autoStart=e===void 0||e,this.startTime=0,this.oldTime=0,this.elapsedTime=0,this.running=!1}Object.assign(Bd.prototype,{update:function(e){var t=this._cache;if(t.focus!==e.focus||t.fov!==e.fov||t.aspect!==e.aspect*this.aspect||t.near!==e.near||t.far!==e.far||t.zoom!==e.zoom||t.eyeSep!==this.eyeSep){t.focus=e.focus,t.fov=e.fov,t.aspect=e.aspect*this.aspect,t.near=e.near,t.far=e.far,t.zoom=e.zoom,t.eyeSep=this.eyeSep;var r,i,l=e.projectionMatrix.clone(),p=t.eyeSep/2,f=p*t.near/t.focus,w=t.near*Math.tan(xn.DEG2RAD*t.fov*.5)/t.zoom;Fd.elements[12]=-p,Vd.elements[12]=p,r=-w*t.aspect+f,i=w*t.aspect+f,l.elements[0]=2*t.near/(i-r),l.elements[8]=(i+r)/(i-r),this.cameraL.projectionMatrix.copy(l),r=-w*t.aspect-f,i=w*t.aspect-f,l.elements[0]=2*t.near/(i-r),l.elements[8]=(i+r)/(i-r),this.cameraR.projectionMatrix.copy(l)}this.cameraL.matrixWorld.copy(e.matrixWorld).multiply(Fd),this.cameraR.matrixWorld.copy(e.matrixWorld).multiply(Vd)}}),Object.assign(ud.prototype,{start:function(){this.startTime=(typeof performance>"u"?Date:performance).now(),this.oldTime=this.startTime,this.elapsedTime=0,this.running=!0},stop:function(){this.getElapsedTime(),this.running=!1,this.autoStart=!1},getElapsedTime:function(){return this.getDelta(),this.elapsedTime},getDelta:function(){var e=0;if(this.autoStart&&!this.running)return this.start(),0;if(this.running){var t=(typeof performance>"u"?Date:performance).now();e=(t-this.oldTime)/1e3,this.oldTime=t,this.elapsedTime+=e}return e}});var qu=new Le,Gd=new Gi,Df=new Le,Xu=new Le;function cd(){At.call(this),this.type="AudioListener",this.context=od.getContext(),this.gain=this.context.createGain(),this.gain.connect(this.context.destination),this.filter=null,this.timeDelta=0,this._clock=new ud}function $c(e){At.call(this),this.type="Audio",this.listener=e,this.context=e.context,this.gain=this.context.createGain(),this.gain.connect(e.getInput()),this.autoplay=!1,this.buffer=null,this.detune=0,this.loop=!1,this.loopStart=0,this.loopEnd=0,this.offset=0,this.duration=void 0,this.playbackRate=1,this.isPlaying=!1,this.hasPlaybackControl=!0,this.sourceType="empty",this._startedAt=0,this._pausedAt=0,this.filters=[]}cd.prototype=Object.assign(Object.create(At.prototype),{constructor:cd,getInput:function(){return this.gain},removeFilter:function(){return this.filter!==null&&(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination),this.gain.connect(this.context.destination),this.filter=null),this},getFilter:function(){return this.filter},setFilter:function(e){return this.filter!==null?(this.gain.disconnect(this.filter),this.filter.disconnect(this.context.destination)):this.gain.disconnect(this.context.destination),this.filter=e,this.gain.connect(this.filter),this.filter.connect(this.context.destination),this},getMasterVolume:function(){return this.gain.gain.value},setMasterVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this},updateMatrixWorld:function(e){At.prototype.updateMatrixWorld.call(this,e);var t=this.context.listener,r=this.up;if(this.timeDelta=this._clock.getDelta(),this.matrixWorld.decompose(qu,Gd,Df),Xu.set(0,0,-1).applyQuaternion(Gd),t.positionX){var i=this.context.currentTime+this.timeDelta;t.positionX.linearRampToValueAtTime(qu.x,i),t.positionY.linearRampToValueAtTime(qu.y,i),t.positionZ.linearRampToValueAtTime(qu.z,i),t.forwardX.linearRampToValueAtTime(Xu.x,i),t.forwardY.linearRampToValueAtTime(Xu.y,i),t.forwardZ.linearRampToValueAtTime(Xu.z,i),t.upX.linearRampToValueAtTime(r.x,i),t.upY.linearRampToValueAtTime(r.y,i),t.upZ.linearRampToValueAtTime(r.z,i)}else t.setPosition(qu.x,qu.y,qu.z),t.setOrientation(Xu.x,Xu.y,Xu.z,r.x,r.y,r.z)}}),$c.prototype=Object.assign(Object.create(At.prototype),{constructor:$c,getOutput:function(){return this.gain},setNodeSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="audioNode",this.source=e,this.connect(),this},setMediaElementSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaNode",this.source=this.context.createMediaElementSource(e),this.connect(),this},setMediaStreamSource:function(e){return this.hasPlaybackControl=!1,this.sourceType="mediaStreamNode",this.source=this.context.createMediaStreamSource(e),this.connect(),this},setBuffer:function(e){return this.buffer=e,this.sourceType="buffer",this.autoplay&&this.play(),this},play:function(e){if(e===void 0&&(e=0),this.isPlaying!==!0){if(this.hasPlaybackControl!==!1){this._startedAt=this.context.currentTime+e;var t=this.context.createBufferSource();return t.buffer=this.buffer,t.loop=this.loop,t.loopStart=this.loopStart,t.loopEnd=this.loopEnd,t.onended=this.onEnded.bind(this),t.start(this._startedAt,this._pausedAt+this.offset,this.duration),this.isPlaying=!0,this.source=t,this.setDetune(this.detune),this.setPlaybackRate(this.playbackRate),this.connect()}console.warn("THREE.Audio: this Audio has no playback control.")}else console.warn("THREE.Audio: Audio is already playing.")},pause:function(){if(this.hasPlaybackControl!==!1)return this.isPlaying===!0&&(this._pausedAt=(this.context.currentTime-this._startedAt)*this.playbackRate,this.source.stop(),this.source.onended=null,this.isPlaying=!1),this;console.warn("THREE.Audio: this Audio has no playback control.")},stop:function(){if(this.hasPlaybackControl!==!1)return this._pausedAt=0,this.source.stop(),this.source.onended=null,this.isPlaying=!1,this;console.warn("THREE.Audio: this Audio has no playback control.")},connect:function(){if(0<this.filters.length){this.source.connect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].connect(this.filters[e]);this.filters[this.filters.length-1].connect(this.getOutput())}else this.source.connect(this.getOutput());return this},disconnect:function(){if(0<this.filters.length){this.source.disconnect(this.filters[0]);for(var e=1,t=this.filters.length;e<t;e++)this.filters[e-1].disconnect(this.filters[e]);this.filters[this.filters.length-1].disconnect(this.getOutput())}else this.source.disconnect(this.getOutput());return this},getFilters:function(){return this.filters},setFilters:function(e){return e=e||[],this.isPlaying===!0?(this.disconnect(),this.filters=e,this.connect()):this.filters=e,this},setDetune:function(e){if(this.detune=e,this.source.detune!==void 0)return this.isPlaying===!0&&this.source.detune.setTargetAtTime(this.detune,this.context.currentTime,.01),this},getDetune:function(){return this.detune},getFilter:function(){return this.getFilters()[0]},setFilter:function(e){return this.setFilters(e?[e]:[])},setPlaybackRate:function(e){if(this.hasPlaybackControl!==!1)return this.playbackRate=e,this.isPlaying===!0&&this.source.playbackRate.setTargetAtTime(this.playbackRate,this.context.currentTime,.01),this;console.warn("THREE.Audio: this Audio has no playback control.")},getPlaybackRate:function(){return this.playbackRate},onEnded:function(){this.isPlaying=!1},getLoop:function(){return this.hasPlaybackControl===!1?(console.warn("THREE.Audio: this Audio has no playback control."),!1):this.loop},setLoop:function(e){if(this.hasPlaybackControl!==!1)return this.loop=e,this.isPlaying===!0&&(this.source.loop=this.loop),this;console.warn("THREE.Audio: this Audio has no playback control.")},setLoopStart:function(e){return this.loopStart=e,this},setLoopEnd:function(e){return this.loopEnd=e,this},getVolume:function(){return this.gain.gain.value},setVolume:function(e){return this.gain.gain.setTargetAtTime(e,this.context.currentTime,.01),this}});var Yu=new Le,zd=new Gi,Sf=new Le,Zu=new Le;function hd(e){$c.call(this,e),this.panner=this.context.createPanner(),this.panner.panningModel="HRTF",this.panner.connect(this.gain)}function pd(e,t){this.analyser=e.context.createAnalyser(),this.analyser.fftSize=t!==void 0?t:2048,this.data=new Uint8Array(this.analyser.frequencyBinCount),e.getOutput().connect(this.analyser)}function dd(e,t,r){this.binding=e,this.valueSize=r;var i,l=Float64Array;switch(t){case"quaternion":i=this._slerp;break;case"string":case"bool":l=Array,i=this._select;break;default:i=this._lerp}this.buffer=new l(4*r),this._mixBufferRegion=i,this.cumulativeWeight=0,this.useCount=0,this.referenceCount=0}hd.prototype=Object.assign(Object.create($c.prototype),{constructor:hd,getOutput:function(){return this.panner},getRefDistance:function(){return this.panner.refDistance},setRefDistance:function(e){return this.panner.refDistance=e,this},getRolloffFactor:function(){return this.panner.rolloffFactor},setRolloffFactor:function(e){return this.panner.rolloffFactor=e,this},getDistanceModel:function(){return this.panner.distanceModel},setDistanceModel:function(e){return this.panner.distanceModel=e,this},getMaxDistance:function(){return this.panner.maxDistance},setMaxDistance:function(e){return this.panner.maxDistance=e,this},setDirectionalCone:function(e,t,r){return this.panner.coneInnerAngle=e,this.panner.coneOuterAngle=t,this.panner.coneOuterGain=r,this},updateMatrixWorld:function(e){if(At.prototype.updateMatrixWorld.call(this,e),this.hasPlaybackControl!==!0||this.isPlaying!==!1){this.matrixWorld.decompose(Yu,zd,Sf),Zu.set(0,0,1).applyQuaternion(zd);var t=this.panner;if(t.positionX){var r=this.context.currentTime+this.listener.timeDelta;t.positionX.linearRampToValueAtTime(Yu.x,r),t.positionY.linearRampToValueAtTime(Yu.y,r),t.positionZ.linearRampToValueAtTime(Yu.z,r),t.orientationX.linearRampToValueAtTime(Zu.x,r),t.orientationY.linearRampToValueAtTime(Zu.y,r),t.orientationZ.linearRampToValueAtTime(Zu.z,r)}else t.setPosition(Yu.x,Yu.y,Yu.z),t.setOrientation(Zu.x,Zu.y,Zu.z)}}}),Object.assign(pd.prototype,{getFrequencyData:function(){return this.analyser.getByteFrequencyData(this.data),this.data},getAverageFrequency:function(){for(var e=0,t=this.getFrequencyData(),r=0;r<t.length;r++)e+=t[r];return e/t.length}}),Object.assign(dd.prototype,{accumulate:function(e,t){var r=this.buffer,i=this.valueSize,l=e*i+i,p=this.cumulativeWeight;if(p===0){for(var f=0;f!==i;++f)r[l+f]=r[f];p=t}else{var w=t/(p+=t);this._mixBufferRegion(r,l,0,w,i)}this.cumulativeWeight=p},apply:function(e){var t=this.valueSize,r=this.buffer,i=e*t+t,l=this.cumulativeWeight,p=this.binding;if(this.cumulativeWeight=0,l<1){var f=3*t;this._mixBufferRegion(r,i,f,1-l,t)}for(var w=t,L=t+t;w!==L;++w)if(r[w]!==r[w+t]){p.setValue(r,i);break}},saveOriginalState:function(){var e=this.binding,t=this.buffer,r=this.valueSize,i=3*r;e.getValue(t,i);for(var l=r,p=i;l!==p;++l)t[l]=t[i+l%r];this.cumulativeWeight=0},restoreOriginalState:function(){var e=3*this.valueSize;this.binding.setValue(this.buffer,e)},_select:function(e,t,r,i,l){if(.5<=i)for(var p=0;p!==l;++p)e[t+p]=e[r+p]},_slerp:function(e,t,r,i){Gi.slerpFlat(e,t,e,t,e,r,i)},_lerp:function(e,t,r,i,l){for(var p=1-i,f=0;f!==l;++f){var w=t+f;e[w]=e[w]*p+e[r+f]*i}}});var fd="\\[\\]\\.:\\/",Ef=new RegExp("["+fd+"]","g"),md="[^"+fd+"]",Of="[^"+fd.replace("\\.","")+"]",Af=/((?:WC+[\/:])*)/.source.replace("WC",md),Pf=/(WCOD+)?/.source.replace("WCOD",Of),Rf=/(?:\.(WC+)(?:\[(.+)\])?)?/.source.replace("WC",md),Lf=/\.(WC+)(?:\[(.+)\])?/.source.replace("WC",md),If=new RegExp("^"+Af+Pf+Rf+Lf+"$"),kf=["material","materials","bones"];function Ud(e,t,r){var i=r||Qa.parseTrackName(t);this._targetGroup=e,this._bindings=e.subscribe_(t,i)}function Qa(e,t,r){this.path=t,this.parsedPath=r||Qa.parseTrackName(t),this.node=Qa.findNode(e,this.parsedPath.nodeName)||e,this.rootNode=e}function Hd(){this.uuid=xn.generateUUID(),this._objects=Array.prototype.slice.call(arguments),this.nCachedObjects_=0;var e={};this._indicesByUUID=e;for(var t=0,r=arguments.length;t!==r;++t)e[arguments[t].uuid]=t;this._paths=[],this._parsedPaths=[],this._bindings=[],this._bindingsIndicesByPath={};var i=this;this.stats={objects:{get total(){return i._objects.length},get inUse(){return this.total-i.nCachedObjects_}},get bindingsPerObject(){return i._bindings.length}}}function Wd(e,t,r){this._mixer=e,this._clip=t,this._localRoot=r||null;for(var i=t.tracks,l=i.length,p=new Array(l),f={endingStart:De,endingEnd:De},w=0;w!==l;++w){var L=i[w].createInterpolant(null);(p[w]=L).settings=f}this._interpolantSettings=f,this._interpolants=p,this._propertyBindings=new Array(l),this._cacheIndex=null,this._byClipCacheIndex=null,this._timeScaleInterpolant=null,this._weightInterpolant=null,this.loop=2201,this._loopCount=-1,this._startTime=null,this.time=0,this.timeScale=1,this._effectiveTimeScale=1,this.weight=1,this._effectiveWeight=1,this.repetitions=1/0,this.paused=!1,this.enabled=!0,this.clampWhenFinished=!1,this.zeroSlopeAtStart=!0,this.zeroSlopeAtEnd=!0}function gd(e){this._root=e,this._initMemoryManager(),this._accuIndex=0,this.time=0,this.timeScale=1}function Sp(e){typeof e=="string"&&(console.warn("THREE.Uniform: Type parameter is no longer needed."),e=arguments[1]),this.value=e}function yd(e,t,r){Zo.call(this,e,t),this.meshPerAttribute=r||1}function Jd(e,t,r,i){this.ray=new kn(e,t),this.near=r||0,this.far=i||1/0,this.camera=null,this.params={Mesh:{},Line:{},LOD:{},Points:{threshold:1},Sprite:{}},Object.defineProperties(this.params,{PointCloud:{get:function(){return console.warn("THREE.Raycaster: params.PointCloud has been renamed to params.Points."),this.Points}}})}function qd(e,t){return e.distance-t.distance}function vd(e,t,r,i){if(e.visible!==!1&&(e.raycast(t,r),i===!0))for(var l=e.children,p=0,f=l.length;p<f;p++)vd(l[p],t,r,!0)}function Xd(e,t,r){return this.radius=e!==void 0?e:1,this.phi=t!==void 0?t:0,this.theta=r!==void 0?r:0,this}function Yd(e,t,r){return this.radius=e!==void 0?e:1,this.theta=t!==void 0?t:0,this.y=r!==void 0?r:0,this}Object.assign(Ud.prototype,{getValue:function(e,t){this.bind();var r=this._targetGroup.nCachedObjects_,i=this._bindings[r];i!==void 0&&i.getValue(e,t)},setValue:function(e,t){for(var r=this._bindings,i=this._targetGroup.nCachedObjects_,l=r.length;i!==l;++i)r[i].setValue(e,t)},bind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].bind()},unbind:function(){for(var e=this._bindings,t=this._targetGroup.nCachedObjects_,r=e.length;t!==r;++t)e[t].unbind()}}),Object.assign(Qa,{Composite:Ud,create:function(e,t,r){return e&&e.isAnimationObjectGroup?new Qa.Composite(e,t,r):new Qa(e,t,r)},sanitizeNodeName:function(e){return e.replace(/\s/g,"_").replace(Ef,"")},parseTrackName:function(e){var t=If.exec(e);if(!t)throw new Error("PropertyBinding: Cannot parse trackName: "+e);var r={nodeName:t[2],objectName:t[3],objectIndex:t[4],propertyName:t[5],propertyIndex:t[6]},i=r.nodeName&&r.nodeName.lastIndexOf(".");if(i!==void 0&&i!==-1){var l=r.nodeName.substring(i+1);kf.indexOf(l)!==-1&&(r.nodeName=r.nodeName.substring(0,i),r.objectName=l)}if(r.propertyName===null||r.propertyName.length===0)throw new Error("PropertyBinding: can not parse propertyName from trackName: "+e);return r},findNode:function(e,t){if(!t||t===""||t==="root"||t==="."||t===-1||t===e.name||t===e.uuid)return e;if(e.skeleton){var r=e.skeleton.getBoneByName(t);if(r!==void 0)return r}if(e.children){var i=function(p){for(var f=0;f<p.length;f++){var w=p[f];if(w.name===t||w.uuid===t)return w;var L=i(w.children);if(L)return L}return null},l=i(e.children);if(l)return l}return null}}),Object.assign(Qa.prototype,{_getValue_unavailable:function(){},_setValue_unavailable:function(){},BindingType:{Direct:0,EntireArray:1,ArrayElement:2,HasFromToArray:3},Versioning:{None:0,NeedsUpdate:1,MatrixWorldNeedsUpdate:2},GetterByBindingType:[function(e,t){e[t]=this.node[this.propertyName]},function(e,t){for(var r=this.resolvedProperty,i=0,l=r.length;i!==l;++i)e[t++]=r[i]},function(e,t){e[t]=this.resolvedProperty[this.propertyIndex]},function(e,t){this.resolvedProperty.toArray(e,t)}],SetterByBindingTypeAndVersioning:[[function(e,t){this.targetObject[this.propertyName]=e[t]},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.targetObject[this.propertyName]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){for(var r=this.resolvedProperty,i=0,l=r.length;i!==l;++i)r[i]=e[t++]},function(e,t){for(var r=this.resolvedProperty,i=0,l=r.length;i!==l;++i)r[i]=e[t++];this.targetObject.needsUpdate=!0},function(e,t){for(var r=this.resolvedProperty,i=0,l=r.length;i!==l;++i)r[i]=e[t++];this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty[this.propertyIndex]=e[t]},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty[this.propertyIndex]=e[t],this.targetObject.matrixWorldNeedsUpdate=!0}],[function(e,t){this.resolvedProperty.fromArray(e,t)},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.needsUpdate=!0},function(e,t){this.resolvedProperty.fromArray(e,t),this.targetObject.matrixWorldNeedsUpdate=!0}]],getValue:function(e,t){this.bind(),this.getValue(e,t)},setValue:function(e,t){this.bind(),this.setValue(e,t)},bind:function(){var e=this.node,t=this.parsedPath,r=t.objectName,i=t.propertyName,l=t.propertyIndex;if(e||(e=Qa.findNode(this.rootNode,t.nodeName)||this.rootNode,this.node=e),this.getValue=this._getValue_unavailable,this.setValue=this._setValue_unavailable,e){if(r){var p=t.objectIndex;switch(r){case"materials":if(!e.material)return void console.error("THREE.PropertyBinding: Can not bind to material as node does not have a material.",this);if(!e.material.materials)return void console.error("THREE.PropertyBinding: Can not bind to material.materials as node.material does not have a materials array.",this);e=e.material.materials;break;case"bones":if(!e.skeleton)return void console.error("THREE.PropertyBinding: Can not bind to bones as node does not have a skeleton.",this);e=e.skeleton.bones;for(var f=0;f<e.length;f++)if(e[f].name===p){p=f;break}break;default:if(e[r]===void 0)return void console.error("THREE.PropertyBinding: Can not bind to objectName of node undefined.",this);e=e[r]}if(p!==void 0){if(e[p]===void 0)return void console.error("THREE.PropertyBinding: Trying to bind to objectIndex of objectName, but is undefined.",this,e);e=e[p]}}var w=e[i];if(w!==void 0){var L=this.Versioning.None;(this.targetObject=e).needsUpdate!==void 0?L=this.Versioning.NeedsUpdate:e.matrixWorldNeedsUpdate!==void 0&&(L=this.Versioning.MatrixWorldNeedsUpdate);var V=this.BindingType.Direct;if(l!==void 0){if(i==="morphTargetInfluences"){if(!e.geometry)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.",this);if(e.geometry.isBufferGeometry){if(!e.geometry.morphAttributes)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphAttributes.",this);for(f=0;f<this.node.geometry.morphAttributes.position.length;f++)if(e.geometry.morphAttributes.position[f].name===l){l=f;break}}else{if(!e.geometry.morphTargets)return void console.error("THREE.PropertyBinding: Can not bind to morphTargetInfluences because node does not have a geometry.morphTargets.",this);for(f=0;f<this.node.geometry.morphTargets.length;f++)if(e.geometry.morphTargets[f].name===l){l=f;break}}}V=this.BindingType.ArrayElement,this.resolvedProperty=w,this.propertyIndex=l}else w.fromArray!==void 0&&w.toArray!==void 0?(V=this.BindingType.HasFromToArray,this.resolvedProperty=w):Array.isArray(w)?(V=this.BindingType.EntireArray,this.resolvedProperty=w):this.propertyName=i;this.getValue=this.GetterByBindingType[V],this.setValue=this.SetterByBindingTypeAndVersioning[V][L]}else{var Z=t.nodeName;console.error("THREE.PropertyBinding: Trying to update property for track: "+Z+"."+i+" but it wasn't found.",e)}}else console.error("THREE.PropertyBinding: Trying to update node for track: "+this.path+" but it wasn't found.")},unbind:function(){this.node=null,this.getValue=this._getValue_unbound,this.setValue=this._setValue_unbound}}),Object.assign(Qa.prototype,{_getValue_unbound:Qa.prototype.getValue,_setValue_unbound:Qa.prototype.setValue}),Object.assign(Hd.prototype,{isAnimationObjectGroup:!0,add:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,l=this._paths,p=this._parsedPaths,f=this._bindings,w=f.length,L=void 0,V=0,Z=arguments.length;V!==Z;++V){var ee=arguments[V],ae=ee.uuid,W=i[ae];if(W===void 0){W=t++,i[ae]=W,e.push(ee);for(var he=0,ge=w;he!==ge;++he)f[he].push(new Qa(ee,l[he],p[he]))}else if(W<r){L=e[W];var ye=--r,Ae=e[ye];for(e[i[Ae.uuid]=W]=Ae,e[i[ae]=ye]=ee,he=0,ge=w;he!==ge;++he){var je=f[he],He=je[ye],et=je[W];je[W]=He,et===void 0&&(et=new Qa(ee,l[he],p[he])),je[ye]=et}}else e[W]!==L&&console.error("THREE.AnimationObjectGroup: Different objects with the same UUID detected. Clean the caches or recreate your infrastructure when reloading scenes.")}this.nCachedObjects_=r},remove:function(){for(var e=this._objects,t=this.nCachedObjects_,r=this._indicesByUUID,i=this._bindings,l=i.length,p=0,f=arguments.length;p!==f;++p){var w=arguments[p],L=w.uuid,V=r[L];if(V!==void 0&&t<=V){var Z=t++,ee=e[Z];e[r[ee.uuid]=V]=ee,e[r[L]=Z]=w;for(var ae=0,W=l;ae!==W;++ae){var he=i[ae],ge=he[Z],ye=he[V];he[V]=ge,he[Z]=ye}}}this.nCachedObjects_=t},uncache:function(){for(var e=this._objects,t=e.length,r=this.nCachedObjects_,i=this._indicesByUUID,l=this._bindings,p=l.length,f=0,w=arguments.length;f!==w;++f){var L=arguments[f].uuid,V=i[L];if(V!==void 0)if(delete i[L],V<r){var Z=--r,ee=e[Z],ae=e[Ae=--t];e[i[ee.uuid]=V]=ee,e[i[ae.uuid]=Z]=ae,e.pop();for(var W=0,he=p;W!==he;++W){var ge=(je=l[W])[Z],ye=je[Ae];je[V]=ge,je[Z]=ye,je.pop()}}else{var Ae;for(e[i[(ae=e[Ae=--t]).uuid]=V]=ae,e.pop(),W=0,he=p;W!==he;++W){var je;(je=l[W])[V]=je[Ae],je.pop()}}}this.nCachedObjects_=r},subscribe_:function(e,t){var r=this._bindingsIndicesByPath,i=r[e],l=this._bindings;if(i!==void 0)return l[i];var p=this._paths,f=this._parsedPaths,w=this._objects,L=w.length,V=this.nCachedObjects_,Z=new Array(L);i=l.length,r[e]=i,p.push(e),f.push(t),l.push(Z);for(var ee=V,ae=w.length;ee!==ae;++ee){var W=w[ee];Z[ee]=new Qa(W,e,t)}return Z},unsubscribe_:function(e){var t=this._bindingsIndicesByPath,r=t[e];if(r!==void 0){var i=this._paths,l=this._parsedPaths,p=this._bindings,f=p.length-1,w=p[f];p[t[e[f]]=r]=w,p.pop(),l[r]=l[f],l.pop(),i[r]=i[f],i.pop()}}}),Object.assign(Wd.prototype,{play:function(){return this._mixer._activateAction(this),this},stop:function(){return this._mixer._deactivateAction(this),this.reset()},reset:function(){return this.paused=!1,this.enabled=!0,this.time=0,this._loopCount=-1,this._startTime=null,this.stopFading().stopWarping()},isRunning:function(){return this.enabled&&!this.paused&&this.timeScale!==0&&this._startTime===null&&this._mixer._isActiveAction(this)},isScheduled:function(){return this._mixer._isActiveAction(this)},startAt:function(e){return this._startTime=e,this},setLoop:function(e,t){return this.loop=e,this.repetitions=t,this},setEffectiveWeight:function(e){return this.weight=e,this._effectiveWeight=this.enabled?e:0,this.stopFading()},getEffectiveWeight:function(){return this._effectiveWeight},fadeIn:function(e){return this._scheduleFading(e,0,1)},fadeOut:function(e){return this._scheduleFading(e,1,0)},crossFadeFrom:function(e,t,r){if(e.fadeOut(t),this.fadeIn(t),r){var i=this._clip.duration,l=e._clip.duration,p=l/i,f=i/l;e.warp(1,p,t),this.warp(f,1,t)}return this},crossFadeTo:function(e,t,r){return e.crossFadeFrom(this,t,r)},stopFading:function(){var e=this._weightInterpolant;return e!==null&&(this._weightInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},setEffectiveTimeScale:function(e){return this.timeScale=e,this._effectiveTimeScale=this.paused?0:e,this.stopWarping()},getEffectiveTimeScale:function(){return this._effectiveTimeScale},setDuration:function(e){return this.timeScale=this._clip.duration/e,this.stopWarping()},syncWith:function(e){return this.time=e.time,this.timeScale=e.timeScale,this.stopWarping()},halt:function(e){return this.warp(this._effectiveTimeScale,0,e)},warp:function(e,t,r){var i=this._mixer,l=i.time,p=this._timeScaleInterpolant,f=this.timeScale;p===null&&(p=i._lendControlInterpolant(),this._timeScaleInterpolant=p);var w=p.parameterPositions,L=p.sampleValues;return w[0]=l,w[1]=l+r,L[0]=e/f,L[1]=t/f,this},stopWarping:function(){var e=this._timeScaleInterpolant;return e!==null&&(this._timeScaleInterpolant=null,this._mixer._takeBackControlInterpolant(e)),this},getMixer:function(){return this._mixer},getClip:function(){return this._clip},getRoot:function(){return this._localRoot||this._mixer._root},_update:function(e,t,r,i){if(this.enabled){var l=this._startTime;if(l!==null){var p=(e-l)*r;if(p<0||r===0)return;this._startTime=null,t=r*p}t*=this._updateTimeScale(e);var f=this._updateTime(t),w=this._updateWeight(e);if(0<w)for(var L=this._interpolants,V=this._propertyBindings,Z=0,ee=L.length;Z!==ee;++Z)L[Z].evaluate(f),V[Z].accumulate(i,w)}else this._updateWeight(e)},_updateWeight:function(e){var t=0;if(this.enabled){t=this.weight;var r=this._weightInterpolant;if(r!==null){var i=r.evaluate(e)[0];t*=i,e>r.parameterPositions[1]&&(this.stopFading(),i===0&&(this.enabled=!1))}}return this._effectiveWeight=t},_updateTimeScale:function(e){var t=0;if(!this.paused){t=this.timeScale;var r=this._timeScaleInterpolant;r!==null&&(t*=r.evaluate(e)[0],e>r.parameterPositions[1]&&(this.stopWarping(),t===0?this.paused=!0:this.timeScale=t))}return this._effectiveTimeScale=t},_updateTime:function(e){var t=this.time+e,r=this._clip.duration,i=this.loop,l=this._loopCount,p=i===2202;if(e===0)return l!==-1&&p&&(1&l)==1?r-t:t;if(i===2200){l===-1&&(this._loopCount=0,this._setEndings(!0,!0,!1));e:{if(r<=t)t=r;else{if(!(t<0)){this.time=t;break e}t=0}this.clampWhenFinished?this.paused=!0:this.enabled=!1,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:e<0?-1:1})}}else{if(l===-1&&(0<=e?(l=0,this._setEndings(!0,this.repetitions===0,p)):this._setEndings(this.repetitions===0,!0,p)),r<=t||t<0){var f=Math.floor(t/r);t-=r*f,l+=Math.abs(f);var w=this.repetitions-l;if(w<=0)this.clampWhenFinished?this.paused=!0:this.enabled=!1,t=0<e?r:0,this.time=t,this._mixer.dispatchEvent({type:"finished",action:this,direction:0<e?1:-1});else{if(w==1){var L=e<0;this._setEndings(L,!L,p)}else this._setEndings(!1,!1,p);this._loopCount=l,this.time=t,this._mixer.dispatchEvent({type:"loop",action:this,loopDelta:f})}}else this.time=t;if(p&&(1&l)==1)return r-t}return t},_setEndings:function(e,t,r){var i=this._interpolantSettings;r?(i.endingStart=ce,i.endingEnd=ce):(i.endingStart=e?this.zeroSlopeAtStart?ce:De:Ce,i.endingEnd=t?this.zeroSlopeAtEnd?ce:De:Ce)},_scheduleFading:function(e,t,r){var i=this._mixer,l=i.time,p=this._weightInterpolant;p===null&&(p=i._lendControlInterpolant(),this._weightInterpolant=p);var f=p.parameterPositions,w=p.sampleValues;return f[0]=l,w[0]=t,f[1]=l+e,w[1]=r,this}}),gd.prototype=Object.assign(Object.create(Ia.prototype),{constructor:gd,_bindAction:function(e,t){var r=e._localRoot||this._root,i=e._clip.tracks,l=i.length,p=e._propertyBindings,f=e._interpolants,w=r.uuid,L=this._bindingsByRootAndName,V=L[w];V===void 0&&(V={},L[w]=V);for(var Z=0;Z!==l;++Z){var ee=i[Z],ae=ee.name,W=V[ae];if(W!==void 0)p[Z]=W;else{if((W=p[Z])!==void 0){W._cacheIndex===null&&(++W.referenceCount,this._addInactiveBinding(W,w,ae));continue}var he=t&&t._propertyBindings[Z].binding.parsedPath;++(W=new dd(Qa.create(r,ae,he),ee.ValueTypeName,ee.getValueSize())).referenceCount,this._addInactiveBinding(W,w,ae),p[Z]=W}f[Z].resultBuffer=W.buffer}},_activateAction:function(e){if(!this._isActiveAction(e)){if(e._cacheIndex===null){var t=(e._localRoot||this._root).uuid,r=e._clip.uuid,i=this._actionsByClip[r];this._bindAction(e,i&&i.knownActions[0]),this._addInactiveAction(e,r,t)}for(var l=e._propertyBindings,p=0,f=l.length;p!==f;++p){var w=l[p];w.useCount++==0&&(this._lendBinding(w),w.saveOriginalState())}this._lendAction(e)}},_deactivateAction:function(e){if(this._isActiveAction(e)){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var l=t[r];--l.useCount==0&&(l.restoreOriginalState(),this._takeBackBinding(l))}this._takeBackAction(e)}},_initMemoryManager:function(){this._actions=[],this._nActiveActions=0,this._actionsByClip={},this._bindings=[],this._nActiveBindings=0,this._bindingsByRootAndName={},this._controlInterpolants=[],this._nActiveControlInterpolants=0;var e=this;this.stats={actions:{get total(){return e._actions.length},get inUse(){return e._nActiveActions}},bindings:{get total(){return e._bindings.length},get inUse(){return e._nActiveBindings}},controlInterpolants:{get total(){return e._controlInterpolants.length},get inUse(){return e._nActiveControlInterpolants}}}},_isActiveAction:function(e){var t=e._cacheIndex;return t!==null&&t<this._nActiveActions},_addInactiveAction:function(e,t,r){var i=this._actions,l=this._actionsByClip,p=l[t];if(p===void 0)p={knownActions:[e],actionByRoot:{}},e._byClipCacheIndex=0,l[t]=p;else{var f=p.knownActions;e._byClipCacheIndex=f.length,f.push(e)}e._cacheIndex=i.length,i.push(e),p.actionByRoot[r]=e},_removeInactiveAction:function(e){var t=this._actions,r=t[t.length-1],i=e._cacheIndex;t[r._cacheIndex=i]=r,t.pop(),e._cacheIndex=null;var l=e._clip.uuid,p=this._actionsByClip,f=p[l],w=f.knownActions,L=w[w.length-1],V=e._byClipCacheIndex;w[L._byClipCacheIndex=V]=L,w.pop(),e._byClipCacheIndex=null,delete f.actionByRoot[(e._localRoot||this._root).uuid],w.length===0&&delete p[l],this._removeInactiveBindingsForAction(e)},_removeInactiveBindingsForAction:function(e){for(var t=e._propertyBindings,r=0,i=t.length;r!==i;++r){var l=t[r];--l.referenceCount==0&&this._removeInactiveBinding(l)}},_lendAction:function(e){var t=this._actions,r=e._cacheIndex,i=this._nActiveActions++,l=t[i];t[e._cacheIndex=i]=e,t[l._cacheIndex=r]=l},_takeBackAction:function(e){var t=this._actions,r=e._cacheIndex,i=--this._nActiveActions,l=t[i];t[e._cacheIndex=i]=e,t[l._cacheIndex=r]=l},_addInactiveBinding:function(e,t,r){var i=this._bindingsByRootAndName,l=i[t],p=this._bindings;l===void 0&&(l={},i[t]=l),(l[r]=e)._cacheIndex=p.length,p.push(e)},_removeInactiveBinding:function(e){var t=this._bindings,r=e.binding,i=r.rootNode.uuid,l=r.path,p=this._bindingsByRootAndName,f=p[i],w=t[t.length-1],L=e._cacheIndex;t[w._cacheIndex=L]=w,t.pop(),delete f[l],Object.keys(f).length===0&&delete p[i]},_lendBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=this._nActiveBindings++,l=t[i];t[e._cacheIndex=i]=e,t[l._cacheIndex=r]=l},_takeBackBinding:function(e){var t=this._bindings,r=e._cacheIndex,i=--this._nActiveBindings,l=t[i];t[e._cacheIndex=i]=e,t[l._cacheIndex=r]=l},_lendControlInterpolant:function(){var e=this._controlInterpolants,t=this._nActiveControlInterpolants++,r=e[t];return r===void 0&&(e[(r=new Wu(new Float32Array(2),new Float32Array(2),1,this._controlInterpolantsResultBuffer)).__cacheIndex=t]=r),r},_takeBackControlInterpolant:function(e){var t=this._controlInterpolants,r=e.__cacheIndex,i=--this._nActiveControlInterpolants,l=t[i];t[e.__cacheIndex=i]=e,t[l.__cacheIndex=r]=l},_controlInterpolantsResultBuffer:new Float32Array(1),clipAction:function(e,t){var r=t||this._root,i=r.uuid,l=typeof e=="string"?_o.findByName(r,e):e,p=l!==null?l.uuid:e,f=this._actionsByClip[p],w=null;if(f!==void 0){var L=f.actionByRoot[i];if(L!==void 0)return L;w=f.knownActions[0],l===null&&(l=w._clip)}if(l===null)return null;var V=new Wd(this,l,t);return this._bindAction(V,w),this._addInactiveAction(V,p,i),V},existingAction:function(e,t){var r=t||this._root,i=r.uuid,l=typeof e=="string"?_o.findByName(r,e):e,p=l?l.uuid:e,f=this._actionsByClip[p];return f!==void 0&&f.actionByRoot[i]||null},stopAllAction:function(){var e=this._actions,t=this._nActiveActions,r=this._bindings,i=this._nActiveBindings;this._nActiveActions=0;for(var l=this._nActiveBindings=0;l!==t;++l)e[l].reset();for(l=0;l!==i;++l)r[l].useCount=0;return this},update:function(e){e*=this.timeScale;for(var t=this._actions,r=this._nActiveActions,i=this.time+=e,l=Math.sign(e),p=this._accuIndex^=1,f=0;f!==r;++f)t[f]._update(i,e,l,p);var w=this._bindings,L=this._nActiveBindings;for(f=0;f!==L;++f)w[f].apply(p);return this},setTime:function(e){for(var t=this.time=0;t<this._actions.length;t++)this._actions[t].time=0;return this.update(e)},getRoot:function(){return this._root},uncacheClip:function(e){var t=this._actions,r=e.uuid,i=this._actionsByClip,l=i[r];if(l!==void 0){for(var p=l.knownActions,f=0,w=p.length;f!==w;++f){var L=p[f];this._deactivateAction(L);var V=L._cacheIndex,Z=t[t.length-1];L._cacheIndex=null,L._byClipCacheIndex=null,t[Z._cacheIndex=V]=Z,t.pop(),this._removeInactiveBindingsForAction(L)}delete i[r]}},uncacheRoot:function(e){var t=e.uuid,r=this._actionsByClip;for(var i in r){var l=r[i].actionByRoot[t];l!==void 0&&(this._deactivateAction(l),this._removeInactiveAction(l))}var p=this._bindingsByRootAndName[t];if(p!==void 0)for(var f in p){var w=p[f];w.restoreOriginalState(),this._removeInactiveBinding(w)}},uncacheAction:function(e,t){var r=this.existingAction(e,t);r!==null&&(this._deactivateAction(r),this._removeInactiveAction(r))}}),Sp.prototype.clone=function(){return new Sp(this.value.clone===void 0?this.value:this.value.clone())},yd.prototype=Object.assign(Object.create(Zo.prototype),{constructor:yd,isInstancedInterleavedBuffer:!0,copy:function(e){return Zo.prototype.copy.call(this,e),this.meshPerAttribute=e.meshPerAttribute,this}}),Object.assign(Jd.prototype,{linePrecision:1,set:function(e,t){this.ray.set(e,t)},setFromCamera:function(e,t){t&&t.isPerspectiveCamera?(this.ray.origin.setFromMatrixPosition(t.matrixWorld),this.ray.direction.set(e.x,e.y,.5).unproject(t).sub(this.ray.origin).normalize(),this.camera=t):t&&t.isOrthographicCamera?(this.ray.origin.set(e.x,e.y,(t.near+t.far)/(t.near-t.far)).unproject(t),this.ray.direction.set(0,0,-1).transformDirection(t.matrixWorld),this.camera=t):console.error("THREE.Raycaster: Unsupported camera type.")},intersectObject:function(e,t,r){var i=r||[];return vd(e,this,i,t),i.sort(qd),i},intersectObjects:function(e,t,r){var i=r||[];if(Array.isArray(e)===!1)return console.warn("THREE.Raycaster.intersectObjects: objects is not an Array."),i;for(var l=0,p=e.length;l<p;l++)vd(e[l],this,i,t);return i.sort(qd),i}}),Object.assign(Xd.prototype,{set:function(e,t,r){return this.radius=e,this.phi=t,this.theta=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.phi=e.phi,this.theta=e.theta,this},makeSafe:function(){return this.phi=Math.max(1e-6,Math.min(Math.PI-1e-6,this.phi)),this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+t*t+r*r),this.radius===0?(this.theta=0,this.phi=0):(this.theta=Math.atan2(e,r),this.phi=Math.acos(xn.clamp(t/this.radius,-1,1))),this}}),Object.assign(Yd.prototype,{set:function(e,t,r){return this.radius=e,this.theta=t,this.y=r,this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.radius=e.radius,this.theta=e.theta,this.y=e.y,this},setFromVector3:function(e){return this.setFromCartesianCoords(e.x,e.y,e.z)},setFromCartesianCoords:function(e,t,r){return this.radius=Math.sqrt(e*e+r*r),this.theta=Math.atan2(e,r),this.y=t,this}});var Zd=new Gt;function xd(e,t){this.min=e!==void 0?e:new Gt(1/0,1/0),this.max=t!==void 0?t:new Gt(-1/0,-1/0)}Object.assign(xd.prototype,{set:function(e,t){return this.min.copy(e),this.max.copy(t),this},setFromPoints:function(e){this.makeEmpty();for(var t=0,r=e.length;t<r;t++)this.expandByPoint(e[t]);return this},setFromCenterAndSize:function(e,t){var r=Zd.copy(t).multiplyScalar(.5);return this.min.copy(e).sub(r),this.max.copy(e).add(r),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.min.copy(e.min),this.max.copy(e.max),this},makeEmpty:function(){return this.min.x=this.min.y=1/0,this.max.x=this.max.y=-1/0,this},isEmpty:function(){return this.max.x<this.min.x||this.max.y<this.min.y},getCenter:function(e){return e===void 0&&(console.warn("THREE.Box2: .getCenter() target is now required"),e=new Gt),this.isEmpty()?e.set(0,0):e.addVectors(this.min,this.max).multiplyScalar(.5)},getSize:function(e){return e===void 0&&(console.warn("THREE.Box2: .getSize() target is now required"),e=new Gt),this.isEmpty()?e.set(0,0):e.subVectors(this.max,this.min)},expandByPoint:function(e){return this.min.min(e),this.max.max(e),this},expandByVector:function(e){return this.min.sub(e),this.max.add(e),this},expandByScalar:function(e){return this.min.addScalar(-e),this.max.addScalar(e),this},containsPoint:function(e){return!(e.x<this.min.x||e.x>this.max.x||e.y<this.min.y||e.y>this.max.y)},containsBox:function(e){return this.min.x<=e.min.x&&e.max.x<=this.max.x&&this.min.y<=e.min.y&&e.max.y<=this.max.y},getParameter:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .getParameter() target is now required"),t=new Gt),t.set((e.x-this.min.x)/(this.max.x-this.min.x),(e.y-this.min.y)/(this.max.y-this.min.y))},intersectsBox:function(e){return!(e.max.x<this.min.x||e.min.x>this.max.x||e.max.y<this.min.y||e.min.y>this.max.y)},clampPoint:function(e,t){return t===void 0&&(console.warn("THREE.Box2: .clampPoint() target is now required"),t=new Gt),t.copy(e).clamp(this.min,this.max)},distanceToPoint:function(e){return Zd.copy(e).clamp(this.min,this.max).sub(e).length()},intersect:function(e){return this.min.max(e.min),this.max.min(e.max),this},union:function(e){return this.min.min(e.min),this.max.max(e.max),this},translate:function(e){return this.min.add(e),this.max.add(e),this},equals:function(e){return e.min.equals(this.min)&&e.max.equals(this.max)}});var Kd=new Le,Ep=new Le;function wd(e,t){this.start=e!==void 0?e:new Le,this.end=t!==void 0?t:new Le}function bd(e){At.call(this),this.material=e,this.render=function(){}}Object.assign(wd.prototype,{set:function(e,t){return this.start.copy(e),this.end.copy(t),this},clone:function(){return new this.constructor().copy(this)},copy:function(e){return this.start.copy(e.start),this.end.copy(e.end),this},getCenter:function(e){return e===void 0&&(console.warn("THREE.Line3: .getCenter() target is now required"),e=new Le),e.addVectors(this.start,this.end).multiplyScalar(.5)},delta:function(e){return e===void 0&&(console.warn("THREE.Line3: .delta() target is now required"),e=new Le),e.subVectors(this.end,this.start)},distanceSq:function(){return this.start.distanceToSquared(this.end)},distance:function(){return this.start.distanceTo(this.end)},at:function(e,t){return t===void 0&&(console.warn("THREE.Line3: .at() target is now required"),t=new Le),this.delta(t).multiplyScalar(e).add(this.start)},closestPointToPointParameter:function(e,t){Kd.subVectors(e,this.start),Ep.subVectors(this.end,this.start);var r=Ep.dot(Ep),i=Ep.dot(Kd)/r;return t&&(i=xn.clamp(i,0,1)),i},closestPointToPoint:function(e,t,r){var i=this.closestPointToPointParameter(e,t);return r===void 0&&(console.warn("THREE.Line3: .closestPointToPoint() target is now required"),r=new Le),this.delta(r).multiplyScalar(i).add(this.start)},applyMatrix4:function(e){return this.start.applyMatrix4(e),this.end.applyMatrix4(e),this},equals:function(e){return e.start.equals(this.start)&&e.end.equals(this.end)}}),((bd.prototype=Object.create(At.prototype)).constructor=bd).prototype.isImmediateRenderObject=!0;var $d=new Le;function Op(e,t){At.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=t;for(var r=new br,i=[0,0,0,0,0,1,0,0,0,1,0,1,0,0,0,-1,0,1,0,0,0,0,1,1,0,0,0,0,-1,1],l=0,p=1;l<32;l++,p++){var f=l/32*Math.PI*2,w=p/32*Math.PI*2;i.push(Math.cos(f),Math.sin(f),1,Math.cos(w),Math.sin(w),1)}r.setAttribute("position",new tr(i,3));var L=new Vi({fog:!1});this.cone=new gi(r,L),this.add(this.cone),this.update()}((Op.prototype=Object.create(At.prototype)).constructor=Op).prototype.dispose=function(){this.cone.geometry.dispose(),this.cone.material.dispose()},Op.prototype.update=function(){this.light.updateMatrixWorld();var e=this.light.distance?this.light.distance:1e3,t=e*Math.tan(this.light.angle);this.cone.scale.set(t,t,e),$d.setFromMatrixPosition(this.light.target.matrixWorld),this.cone.lookAt($d),this.color!==void 0?this.cone.material.color.set(this.color):this.cone.material.color.copy(this.light.color)};var nu=new Le,Ap=new mn,Md=new mn;function Pp(e){for(var t=function Z(ee){var ae=[];ee&&ee.isBone&&ae.push(ee);for(var W=0;W<ee.children.length;W++)ae.push.apply(ae,Z(ee.children[W]));return ae}(e),r=new br,i=[],l=[],p=new Qe(0,0,1),f=new Qe(0,1,0),w=0;w<t.length;w++){var L=t[w];L.parent&&L.parent.isBone&&(i.push(0,0,0),i.push(0,0,0),l.push(p.r,p.g,p.b),l.push(f.r,f.g,f.b))}r.setAttribute("position",new tr(i,3)),r.setAttribute("color",new tr(l,3));var V=new Vi({vertexColors:2,depthTest:!1,depthWrite:!1,transparent:!0});gi.call(this,r,V),this.root=e,this.bones=t,this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1}function Rp(e,t,r){this.light=e,this.light.updateMatrixWorld(),this.color=r;var i=new hl(t,4,2),l=new Dn({wireframe:!0,fog:!1});Di.call(this,i,l),this.matrix=this.light.matrixWorld,this.matrixAutoUpdate=!1,this.update()}((Pp.prototype=Object.create(gi.prototype)).constructor=Pp).prototype.updateMatrixWorld=function(e){var t=this.bones,r=this.geometry,i=r.getAttribute("position");Md.getInverse(this.root.matrixWorld);for(var l=0,p=0;l<t.length;l++){var f=t[l];f.parent&&f.parent.isBone&&(Ap.multiplyMatrices(Md,f.matrixWorld),nu.setFromMatrixPosition(Ap),i.setXYZ(p,nu.x,nu.y,nu.z),Ap.multiplyMatrices(Md,f.parent.matrixWorld),nu.setFromMatrixPosition(Ap),i.setXYZ(p+1,nu.x,nu.y,nu.z),p+=2)}r.getAttribute("position").needsUpdate=!0,At.prototype.updateMatrixWorld.call(this,e)},((Rp.prototype=Object.create(Di.prototype)).constructor=Rp).prototype.dispose=function(){this.geometry.dispose(),this.material.dispose()},Rp.prototype.update=function(){this.color!==void 0?this.material.color.set(this.color):this.material.color.copy(this.light.color)};var jf=new Le,Qd=new Qe,ef=new Qe;function Lp(e,t,r){At.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r;var i=new yi(t);i.rotateY(.5*Math.PI),this.material=new Dn({wireframe:!0,fog:!1}),this.color===void 0&&(this.material.vertexColors=2);var l=i.getAttribute("position"),p=new Float32Array(3*l.count);i.setAttribute("color",new Kt(p,3)),this.add(new Di(i,this.material)),this.update()}function Ip(e,t,r,i){e=e||10,t=t||10,r=new Qe(r!==void 0?r:4473924),i=new Qe(i!==void 0?i:8947848);for(var l=t/2,p=e/t,f=e/2,w=[],L=[],V=0,Z=0,ee=-f;V<=t;V++,ee+=p){w.push(-f,0,ee,f,0,ee),w.push(ee,0,-f,ee,0,f);var ae=V===l?r:i;ae.toArray(L,Z),Z+=3,ae.toArray(L,Z),Z+=3,ae.toArray(L,Z),Z+=3,ae.toArray(L,Z),Z+=3}var W=new br;W.setAttribute("position",new tr(w,3)),W.setAttribute("color",new tr(L,3));var he=new Vi({vertexColors:2});gi.call(this,W,he)}function _d(e,t,r,i,l,p){e=e||10,t=t||16,r=r||8,i=i||64,l=new Qe(l!==void 0?l:4473924),p=new Qe(p!==void 0?p:8947848);var f,w,L,V,Z,ee,ae,W=[],he=[];for(V=0;V<=t;V++)L=V/t*(2*Math.PI),f=Math.sin(L)*e,w=Math.cos(L)*e,W.push(0,0,0),W.push(f,0,w),ae=1&V?l:p,he.push(ae.r,ae.g,ae.b),he.push(ae.r,ae.g,ae.b);for(V=0;V<=r;V++)for(ae=1&V?l:p,ee=e-e/r*V,Z=0;Z<i;Z++)L=Z/i*(2*Math.PI),f=Math.sin(L)*ee,w=Math.cos(L)*ee,W.push(f,0,w),he.push(ae.r,ae.g,ae.b),L=(Z+1)/i*(2*Math.PI),f=Math.sin(L)*ee,w=Math.cos(L)*ee,W.push(f,0,w),he.push(ae.r,ae.g,ae.b);var ge=new br;ge.setAttribute("position",new tr(W,3)),ge.setAttribute("color",new tr(he,3));var ye=new Vi({vertexColors:2});gi.call(this,ge,ye)}((Lp.prototype=Object.create(At.prototype)).constructor=Lp).prototype.dispose=function(){this.children[0].geometry.dispose(),this.children[0].material.dispose()},Lp.prototype.update=function(){var e=this.children[0];if(this.color!==void 0)this.material.color.set(this.color);else{var t=e.geometry.getAttribute("color");Qd.copy(this.light.color),ef.copy(this.light.groundColor);for(var r=0,i=t.count;r<i;r++){var l=r<i/2?Qd:ef;t.setXYZ(r,l.r,l.g,l.b)}t.needsUpdate=!0}e.lookAt(jf.setFromMatrixPosition(this.light.matrixWorld).negate())},Ip.prototype=Object.assign(Object.create(gi.prototype),{constructor:Ip,copy:function(e){return gi.prototype.copy.call(this,e),this.geometry.copy(e.geometry),this.material.copy(e.material),this},clone:function(){return new this.constructor().copy(this)}}),(_d.prototype=Object.create(gi.prototype)).constructor=_d;var tf=new Le,kp=new Le,rf=new Le;function jp(e,t,r){At.call(this),this.light=e,this.light.updateMatrixWorld(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.color=r,t===void 0&&(t=1);var i=new br;i.setAttribute("position",new tr([-t,t,0,t,t,0,t,-t,0,-t,-t,0,-t,t,0],3));var l=new Vi({fog:!1});this.lightPlane=new Ra(i,l),this.add(this.lightPlane),(i=new br).setAttribute("position",new tr([0,0,0,0,0,1],3)),this.targetLine=new Ra(i,l),this.add(this.targetLine),this.update()}((jp.prototype=Object.create(At.prototype)).constructor=jp).prototype.dispose=function(){this.lightPlane.geometry.dispose(),this.lightPlane.material.dispose(),this.targetLine.geometry.dispose(),this.targetLine.material.dispose()},jp.prototype.update=function(){tf.setFromMatrixPosition(this.light.matrixWorld),kp.setFromMatrixPosition(this.light.target.matrixWorld),rf.subVectors(kp,tf),this.lightPlane.lookAt(kp),this.color!==void 0?(this.lightPlane.material.color.set(this.color),this.targetLine.material.color.set(this.color)):(this.lightPlane.material.color.copy(this.light.color),this.targetLine.material.color.copy(this.light.color)),this.targetLine.lookAt(kp),this.targetLine.scale.z=rf.length()};var Np=new Le,Qi=new Lo;function Td(e){var t=new br,r=new Vi({color:16777215,vertexColors:1}),i=[],l=[],p={},f=new Qe(16755200),w=new Qe(16711680),L=new Qe(43775),V=new Qe(16777215),Z=new Qe(3355443);function ee(W,he,ge){ae(W,ge),ae(he,ge)}function ae(W,he){i.push(0,0,0),l.push(he.r,he.g,he.b),p[W]===void 0&&(p[W]=[]),p[W].push(i.length/3-1)}ee("n1","n2",f),ee("n2","n4",f),ee("n4","n3",f),ee("n3","n1",f),ee("f1","f2",f),ee("f2","f4",f),ee("f4","f3",f),ee("f3","f1",f),ee("n1","f1",f),ee("n2","f2",f),ee("n3","f3",f),ee("n4","f4",f),ee("p","n1",w),ee("p","n2",w),ee("p","n3",w),ee("p","n4",w),ee("u1","u2",L),ee("u2","u3",L),ee("u3","u1",L),ee("c","t",V),ee("p","c",Z),ee("cn1","cn2",Z),ee("cn3","cn4",Z),ee("cf1","cf2",Z),ee("cf3","cf4",Z),t.setAttribute("position",new tr(i,3)),t.setAttribute("color",new tr(l,3)),gi.call(this,t,r),this.camera=e,this.camera.updateProjectionMatrix&&this.camera.updateProjectionMatrix(),this.matrix=e.matrixWorld,this.matrixAutoUpdate=!1,this.pointMap=p,this.update()}function aa(e,t,r,i,l,p,f){Np.set(l,p,f).unproject(i);var w=t[e];if(w!==void 0)for(var L=r.getAttribute("position"),V=0,Z=w.length;V<Z;V++)L.setXYZ(w[V],Np.x,Np.y,Np.z)}((Td.prototype=Object.create(gi.prototype)).constructor=Td).prototype.update=function(){var e=this.geometry,t=this.pointMap;Qi.projectionMatrixInverse.copy(this.camera.projectionMatrixInverse),aa("c",t,e,Qi,0,0,-1),aa("t",t,e,Qi,0,0,1),aa("n1",t,e,Qi,-1,-1,-1),aa("n2",t,e,Qi,1,-1,-1),aa("n3",t,e,Qi,-1,1,-1),aa("n4",t,e,Qi,1,1,-1),aa("f1",t,e,Qi,-1,-1,1),aa("f2",t,e,Qi,1,-1,1),aa("f3",t,e,Qi,-1,1,1),aa("f4",t,e,Qi,1,1,1),aa("u1",t,e,Qi,.7,1.1,-1),aa("u2",t,e,Qi,-.7,1.1,-1),aa("u3",t,e,Qi,0,2,-1),aa("cf1",t,e,Qi,-1,0,1),aa("cf2",t,e,Qi,1,0,1),aa("cf3",t,e,Qi,0,-1,1),aa("cf4",t,e,Qi,0,1,1),aa("cn1",t,e,Qi,-1,0,-1),aa("cn2",t,e,Qi,1,0,-1),aa("cn3",t,e,Qi,0,-1,-1),aa("cn4",t,e,Qi,0,1,-1),e.getAttribute("position").needsUpdate=!0};var Vp=new Zi;function Ku(e,t){this.object=e,t===void 0&&(t=16776960);var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new Float32Array(24),l=new br;l.setIndex(new Kt(r,1)),l.setAttribute("position",new Kt(i,3)),gi.call(this,l,new Vi({color:t})),this.matrixAutoUpdate=!1,this.update()}function Cd(e,t){this.type="Box3Helper",this.box=e,t=t||16776960;var r=new Uint16Array([0,1,1,2,2,3,3,0,4,5,5,6,6,7,7,4,0,4,1,5,2,6,3,7]),i=new br;i.setIndex(new Kt(r,1)),i.setAttribute("position",new tr([1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,-1,-1,1,-1,-1,-1,-1,1,-1,-1],3)),gi.call(this,i,new Vi({color:t})),this.geometry.computeBoundingSphere()}function Dd(e,t,r){this.type="PlaneHelper",this.plane=e,this.size=t===void 0?1:t;var i=r!==void 0?r:16776960,l=new br;l.setAttribute("position",new tr([1,-1,1,-1,1,1,-1,-1,1,1,1,1,-1,1,1,-1,-1,1,1,-1,1,1,1,1,0,0,1,0,0,0],3)),l.computeBoundingSphere(),Ra.call(this,l,new Vi({color:i}));var p=new br;p.setAttribute("position",new tr([1,1,1,-1,1,1,-1,-1,1,1,1,1,-1,-1,1,1,-1,1],3)),p.computeBoundingSphere(),this.add(new Di(p,new Dn({color:i,opacity:.2,transparent:!0,depthWrite:!1})))}((Ku.prototype=Object.create(gi.prototype)).constructor=Ku).prototype.update=function(e){if(e!==void 0&&console.warn("THREE.BoxHelper: .update() has no longer arguments."),this.object!==void 0&&Vp.setFromObject(this.object),!Vp.isEmpty()){var t=Vp.min,r=Vp.max,i=this.geometry.attributes.position,l=i.array;l[0]=r.x,l[1]=r.y,l[2]=r.z,l[3]=t.x,l[4]=r.y,l[5]=r.z,l[6]=t.x,l[7]=t.y,l[8]=r.z,l[9]=r.x,l[10]=t.y,l[11]=r.z,l[12]=r.x,l[13]=r.y,l[14]=t.z,l[15]=t.x,l[16]=r.y,l[17]=t.z,l[18]=t.x,l[19]=t.y,l[20]=t.z,l[21]=r.x,l[22]=t.y,l[23]=t.z,i.needsUpdate=!0,this.geometry.computeBoundingSphere()}},Ku.prototype.setFromObject=function(e){return this.object=e,this.update(),this},Ku.prototype.copy=function(e){return gi.prototype.copy.call(this,e),this.object=e.object,this},Ku.prototype.clone=function(){return new this.constructor().copy(this)},((Cd.prototype=Object.create(gi.prototype)).constructor=Cd).prototype.updateMatrixWorld=function(e){var t=this.box;t.isEmpty()||(t.getCenter(this.position),t.getSize(this.scale),this.scale.multiplyScalar(.5),At.prototype.updateMatrixWorld.call(this,e))},((Dd.prototype=Object.create(Ra.prototype)).constructor=Dd).prototype.updateMatrixWorld=function(e){var t=-this.plane.constant;Math.abs(t)<1e-8&&(t=1e-8),this.scale.set(.5*this.size,.5*this.size,t),this.children[0].material.side=t<0?_:E,this.lookAt(this.plane.normal),At.prototype.updateMatrixWorld.call(this,e)};var Sd,nf,af=new Le;function $u(e,t,r,i,l,p){At.call(this),e===void 0&&(e=new Le(0,0,1)),t===void 0&&(t=new Le(0,0,0)),r===void 0&&(r=1),i===void 0&&(i=16776960),l===void 0&&(l=.2*r),p===void 0&&(p=.2*l),Sd===void 0&&((Sd=new br).setAttribute("position",new tr([0,0,0,0,1,0],3)),(nf=new Is(0,.5,1,5,1)).translate(0,-.5,0)),this.position.copy(t),this.line=new Ra(Sd,new Vi({color:i})),this.line.matrixAutoUpdate=!1,this.add(this.line),this.cone=new Di(nf,new Dn({color:i})),this.cone.matrixAutoUpdate=!1,this.add(this.cone),this.setDirection(e),this.setLength(r,l,p)}function Fp(e){var t=[0,0,0,e=e||1,0,0,0,0,0,0,e,0,0,0,0,0,0,e],r=new br;r.setAttribute("position",new tr(t,3)),r.setAttribute("color",new tr([1,0,0,1,.6,0,0,1,0,.6,1,0,0,0,1,0,.6,1],3));var i=new Vi({vertexColors:2});gi.call(this,r,i)}(($u.prototype=Object.create(At.prototype)).constructor=$u).prototype.setDirection=function(e){if(.99999<e.y)this.quaternion.set(0,0,0,1);else if(e.y<-.99999)this.quaternion.set(1,0,0,0);else{af.set(e.z,0,-e.x).normalize();var t=Math.acos(e.y);this.quaternion.setFromAxisAngle(af,t)}},$u.prototype.setLength=function(e,t,r){t===void 0&&(t=.2*e),r===void 0&&(r=.2*t),this.line.scale.set(1,Math.max(1e-4,e-t),1),this.line.updateMatrix(),this.cone.scale.set(r,t,r),this.cone.position.y=e,this.cone.updateMatrix()},$u.prototype.setColor=function(e){this.line.material.color.set(e),this.cone.material.color.set(e)},$u.prototype.copy=function(e){return At.prototype.copy.call(this,e,!1),this.line.copy(e.line),this.cone.copy(e.cone),this},$u.prototype.clone=function(){return new this.constructor().copy(this)},(Fp.prototype=Object.create(gi.prototype)).constructor=Fp;var Qc=4,iu=8,Vs=Math.pow(2,iu),of=[.125,.215,.35,.446,.526,.582],sf=iu-Qc+1+of.length,eh=20,za={};za[Ke]=0,za[yt]=1,za[Wt]=2,za[Br]=3,za[ln]=4,za[di]=5,za[Vt]=6;var lf,uf,Ed=new xl,Bp=((uf=new ks({defines:{n:lf=eh},uniforms:{envMap:{value:null},samples:{value:1},weights:{value:new Float32Array(lf)},latitudinal:{value:!1},dTheta:{value:0},mipInt:{value:0},poleAxis:{value:new Le(0,1,0)},inputEncoding:{value:za[Ke]},outputEncoding:{value:za[Ke]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform int samples;
uniform float weights[n];
uniform bool latitudinal;
uniform float dTheta;
uniform float mipInt;
uniform vec3 poleAxis;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

#define ENVMAP_TYPE_CUBE_UV
#include <cube_uv_reflection_fragment>

void main() {
	gl_FragColor = vec4(0.0);
	for (int i = 0; i < n; i++) {
		if (i >= samples)
			break;
		for (int dir = -1; dir < 2; dir += 2) {
			if (i == 0 && dir == 1)
				continue;
			vec3 axis = latitudinal ? poleAxis : cross(poleAxis, vOutputDirection);
			if (all(equal(axis, vec3(0.0))))
				axis = cross(vec3(0.0, 1.0, 0.0), vOutputDirection);
			axis = normalize(axis);
			float theta = dTheta * float(dir * i);
			float cosTheta = cos(theta);
			// Rodrigues' axis-angle rotation
			vec3 sampleDirection = vOutputDirection * cosTheta
					+ cross(axis, vOutputDirection) * sin(theta)
					+ axis * dot(axis, vOutputDirection) * (1.0 - cosTheta);
			gl_FragColor.rgb +=
					weights[i] * bilinearCubeUV(envMap, sampleDirection, mipInt);
		}
	}
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:C,depthTest:!1,depthWrite:!1})).type="SphericalGaussianBlur",uf),Qu=null,ec=null,Od=function(){for(var e=[],t=[],r=[],i=iu,l=0;l<sf;l++){var p=Math.pow(2,i);t.push(p);var f=1/p;iu-Qc<l?f=of[l-iu+Qc-1]:l==0&&(f=0),r.push(f);for(var w=1/(p-1),L=-w/2,V=1+w/2,Z=[L,L,V,L,V,V,L,L,V,V,L,V],ee=new Float32Array(108),ae=new Float32Array(72),W=new Float32Array(36),he=0;he<6;he++){var ge=he%3*2/3-1,ye=2<he?0:-1,Ae=[ge,ye,0,ge+2/3,ye,0,ge+2/3,1+ye,0,ge,ye,0,ge+2/3,1+ye,0,ge,1+ye,0];ee.set(Ae,18*he),ae.set(Z,12*he);var je=[he,he,he,he,he,he];W.set(je,6*he)}var He=new br;He.setAttribute("position",new Kt(ee,3)),He.setAttribute("uv",new Kt(ae,2)),He.setAttribute("faceIndex",new Kt(W,1)),e.push(He),Qc<i&&i--}return{_lodPlanes:e,_sizeLods:t,_sigmas:r}}(),Fh=Od._lodPlanes,cf=Od._sizeLods,Gp=Od._sigmas,zp=null,Si=null,Ad=null,tc=(1+Math.sqrt(5))/2,th=1/tc,hf=[new Le(1,1,1),new Le(-1,1,1),new Le(1,1,-1),new Le(-1,1,-1),new Le(0,tc,th),new Le(0,tc,-th),new Le(th,0,tc),new Le(-th,0,tc),new Le(tc,th,0),new Le(-tc,th,0)];function Pd(e){Si=e,Rd(Bp)}function pf(e){var t={magFilter:ct,minFilter:ct,generateMipmaps:!1,type:e?e.type:vn,format:e?e.format:ri,encoding:e?e.encoding:Wt,depthBuffer:!1,stencilBuffer:!1},r=ff(t);return r.depthBuffer=!e,zp=ff(t),r}function df(e){zp.dispose(),Si.setRenderTarget(Ad),e.scissorTest=!1,e.setSize(e.width,e.height)}function Rd(e){var t=new Wr;t.add(new Di(Fh[0],e)),Si.compile(t,Ed)}function ff(e){var t=new Yi(3*Vs,3*Vs,e);return t.texture.mapping=gt,t.texture.name="PMREM.cubeUv",t.scissorTest=!0,t}function Ld(e,t,r,i,l){e.viewport.set(t,r,i,l),e.scissor.set(t,r,i,l)}function mf(e){var t=Si.autoClear;Si.autoClear=!1;for(var r=1;r<sf;r++)gf(e,r-1,r,Math.sqrt(Gp[r]*Gp[r]-Gp[r-1]*Gp[r-1]),hf[(r-1)%hf.length]);Si.autoClear=t}function gf(e,t,r,i,l){yf(e,zp,t,r,i,"latitudinal",l),yf(zp,e,r,r,i,"longitudinal",l)}function yf(e,t,r,i,l,p,f){p!=="latitudinal"&&p!=="longitudinal"&&console.error("blur direction must be either latitudinal or longitudinal!");var w=new Wr;w.add(new Di(Fh[i],Bp));var L=Bp.uniforms,V=cf[r]-1,Z=isFinite(l)?Math.PI/(2*V):2*Math.PI/(2*eh-1),ee=l/Z,ae=isFinite(l)?1+Math.floor(3*ee):eh;eh<ae&&console.warn("sigmaRadians, "+l+", is too large and will clip, as it requested "+ae+" samples when the maximum is set to "+eh);for(var W=[],he=0,ge=0;ge<eh;++ge){var ye=ge/ee,Ae=Math.exp(-ye*ye/2);W.push(Ae),ge==0?he+=Ae:ge<ae&&(he+=2*Ae)}for(ge=0;ge<W.length;ge++)W[ge]=W[ge]/he;L.envMap.value=e.texture,L.samples.value=ae,L.weights.value=W,L.latitudinal.value=p==="latitudinal",f&&(L.poleAxis.value=f),L.dTheta.value=Z,L.mipInt.value=iu-r,L.inputEncoding.value=za[e.texture.encoding],L.outputEncoding.value=za[e.texture.encoding];var je=cf[i];Ld(t,ye=3*Math.max(0,Vs-2*je),(i===0?0:2*Vs)+2*je*(iu-Qc<i?i-iu+Qc:0),3*je,2*je),Si.setRenderTarget(t),Si.render(w,Ed)}function vf(){var e=new ks({uniforms:{envMap:{value:null},texelSize:{value:new Gt(1,1)},inputEncoding:{value:za[Ke]},outputEncoding:{value:za[Ke]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform sampler2D envMap;
uniform vec2 texelSize;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

#define RECIPROCAL_PI 0.31830988618
#define RECIPROCAL_PI2 0.15915494

void main() {
	gl_FragColor = vec4(0.0);
	vec3 outputDirection = normalize(vOutputDirection);
	vec2 uv;
	uv.y = asin(clamp(outputDirection.y, -1.0, 1.0)) * RECIPROCAL_PI + 0.5;
	uv.x = atan(outputDirection.z, outputDirection.x) * RECIPROCAL_PI2 + 0.5;
	vec2 f = fract(uv / texelSize - 0.5);
	uv -= f * texelSize;
	vec3 tl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x += texelSize.x;
	vec3 tr = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.y += texelSize.y;
	vec3 br = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	uv.x -= texelSize.x;
	vec3 bl = envMapTexelToLinear(texture2D(envMap, uv)).rgb;
	vec3 tm = mix(tl, tr, f.x);
	vec3 bm = mix(bl, br, f.x);
	gl_FragColor.rgb = mix(tm, bm, f.y);
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:C,depthTest:!1,depthWrite:!1});return e.type="EquirectangularToCubeUV",e}function xf(){var e=new ks({uniforms:{envMap:{value:null},inputEncoding:{value:za[Ke]},outputEncoding:{value:za[Ke]}},vertexShader:`
precision mediump float;
precision mediump int;
attribute vec3 position;
attribute vec2 uv;
attribute float faceIndex;
varying vec3 vOutputDirection;
vec3 getDirection(vec2 uv, float face) {
	uv = 2.0 * uv - 1.0;
	vec3 direction = vec3(uv, 1.0);
	if (face == 0.0) {
		direction = direction.zyx;
		direction.z *= -1.0;
	} else if (face == 1.0) {
		direction = direction.xzy;
		direction.z *= -1.0;
	} else if (face == 3.0) {
		direction = direction.zyx;
		direction.x *= -1.0;
	} else if (face == 4.0) {
		direction = direction.xzy;
		direction.y *= -1.0;
	} else if (face == 5.0) {
		direction.xz *= -1.0;
	}
	return direction;
}
void main() {
	vOutputDirection = getDirection(uv, faceIndex);
	gl_Position = vec4( position, 1.0 );
}
	`,fragmentShader:`
precision mediump float;
precision mediump int;
varying vec3 vOutputDirection;
uniform samplerCube envMap;


uniform int inputEncoding;
uniform int outputEncoding;

#include <encodings_pars_fragment>

vec4 inputTexelToLinear(vec4 value){
	if(inputEncoding == 0){
		return value;
	}else if(inputEncoding == 1){
		return sRGBToLinear(value);
	}else if(inputEncoding == 2){
		return RGBEToLinear(value);
	}else if(inputEncoding == 3){
		return RGBMToLinear(value, 7.0);
	}else if(inputEncoding == 4){
		return RGBMToLinear(value, 16.0);
	}else if(inputEncoding == 5){
		return RGBDToLinear(value, 256.0);
	}else{
		return GammaToLinear(value, 2.2);
	}
}

vec4 linearToOutputTexel(vec4 value){
	if(outputEncoding == 0){
		return value;
	}else if(outputEncoding == 1){
		return LinearTosRGB(value);
	}else if(outputEncoding == 2){
		return LinearToRGBE(value);
	}else if(outputEncoding == 3){
		return LinearToRGBM(value, 7.0);
	}else if(outputEncoding == 4){
		return LinearToRGBM(value, 16.0);
	}else if(outputEncoding == 5){
		return LinearToRGBD(value, 256.0);
	}else{
		return LinearToGamma(value, 2.2);
	}
}

vec4 envMapTexelToLinear(vec4 color) {
	return inputTexelToLinear(color);
}
	

void main() {
	gl_FragColor = vec4(0.0);
	gl_FragColor.rgb = envMapTexelToLinear(textureCube(envMap, vec3( - vOutputDirection.x, vOutputDirection.yz ))).rgb;
	gl_FragColor = linearToOutputTexel(gl_FragColor);
}
		`,blending:C,depthTest:!1,depthWrite:!1});return e.type="CubemapToCubeUV",e}function wf(e){console.warn("THREE.ClosedSplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ir.call(this,e),this.type="catmullrom",this.closed=!0}function bf(e){console.warn("THREE.SplineCurve3 has been deprecated. Use THREE.CatmullRomCurve3 instead."),Ir.call(this,e),this.type="catmullrom"}function Id(e){console.warn("THREE.Spline has been removed. Use THREE.CatmullRomCurve3 instead."),Ir.call(this,e),this.type="catmullrom"}Pd.prototype={constructor:Pd,fromScene:function(e,t,r,i){t===void 0&&(t=0),r===void 0&&(r=.1),i===void 0&&(i=100),Ad=Si.getRenderTarget();var l=pf();return function(p,f,w,L){var V=new Ni(90,1,f,w),Z=[1,1,1,1,-1,1],ee=[1,1,-1,-1,-1,1],ae=Si.outputEncoding,W=Si.toneMapping,he=Si.toneMappingExposure,ge=Si.getClearColor(),ye=Si.getClearAlpha();Si.toneMapping=$e,Si.toneMappingExposure=1,Si.outputEncoding=Ke,p.scale.z*=-1;var Ae=p.background;if(Ae&&Ae.isColor){Ae.convertSRGBToLinear();var je=Math.max(Ae.r,Ae.g,Ae.b),He=Math.min(Math.max(Math.ceil(Math.log2(je)),-128),127);Ae=Ae.multiplyScalar(Math.pow(2,-He));var et=(He+128)/255;Si.setClearColor(Ae,et),p.background=null}for(var Ge=0;Ge<6;Ge++){var it=Ge%3;it==0?(V.up.set(0,Z[Ge],0),V.lookAt(ee[Ge],0,0)):it==1?(V.up.set(0,0,Z[Ge]),V.lookAt(0,ee[Ge],0)):(V.up.set(0,Z[Ge],0),V.lookAt(0,0,ee[Ge])),Ld(L,it*Vs,2<Ge?Vs:0,Vs,Vs),Si.setRenderTarget(L),Si.render(p,V)}Si.toneMapping=W,Si.toneMappingExposure=he,Si.outputEncoding=ae,Si.setClearColor(ge,ye),p.scale.z*=-1}(e,r,i,l),0<t&&gf(l,0,0,t),mf(l),df(l),l},fromEquirectangular:function(e){return e.magFilter=ct,e.minFilter=ct,e.generateMipmaps=!1,this.fromCubemap(e)},fromCubemap:function(e){Ad=Si.getRenderTarget();var t=pf(e);return function(r,i){var l=new Wr;r.isCubeTexture?ec==null&&(ec=xf()):Qu==null&&(Qu=vf());var p=r.isCubeTexture?ec:Qu;l.add(new Di(Fh[0],p));var f=p.uniforms;(f.envMap.value=r).isCubeTexture||f.texelSize.value.set(1/r.image.width,1/r.image.height),f.inputEncoding.value=za[r.encoding],f.outputEncoding.value=za[r.encoding],Ld(i,0,0,3*Vs,2*Vs),Si.setRenderTarget(i),Si.render(l,Ed)}(e,t),mf(t),df(t),t},compileCubemapShader:function(){ec==null&&Rd(ec=xf())},compileEquirectangularShader:function(){Qu==null&&Rd(Qu=vf())},dispose:function(){Bp.dispose(),ec!=null&&ec.dispose(),Qu!=null&&Qu.dispose();for(var e=0;e<Fh.length;e++)Fh[e].dispose()}},mt.create=function(e,t){return console.log("THREE.Curve.create() has been deprecated"),e.prototype=Object.create(mt.prototype),(e.prototype.constructor=e).prototype.getPoint=t,e},Object.assign(ya.prototype,{createPointsGeometry:function(e){console.warn("THREE.CurvePath: .createPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getPoints(e);return this.createGeometry(t)},createSpacedPointsGeometry:function(e){console.warn("THREE.CurvePath: .createSpacedPointsGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");var t=this.getSpacedPoints(e);return this.createGeometry(t)},createGeometry:function(e){console.warn("THREE.CurvePath: .createGeometry() has been removed. Use new THREE.Geometry().setFromPoints( points ) instead.");for(var t=new un,r=0,i=e.length;r<i;r++){var l=e[r];t.vertices.push(new Le(l.x,l.y,l.z||0))}return t}}),Object.assign(va.prototype,{fromPoints:function(e){return console.warn("THREE.Path: .fromPoints() has been renamed to .setFromPoints()."),this.setFromPoints(e)}}),wf.prototype=Object.create(Ir.prototype),bf.prototype=Object.create(Ir.prototype),Id.prototype=Object.create(Ir.prototype),Object.assign(Id.prototype,{initFromArray:function(){console.error("THREE.Spline: .initFromArray() has been removed.")},getControlPointsArray:function(){console.error("THREE.Spline: .getControlPointsArray() has been removed.")},reparametrizeByArcLength:function(){console.error("THREE.Spline: .reparametrizeByArcLength() has been removed.")}}),Ip.prototype.setColors=function(){console.error("THREE.GridHelper: setColors() has been deprecated, pass them in the constructor instead.")},Pp.prototype.update=function(){console.error("THREE.SkeletonHelper: update() no longer needs to be called.")},Object.assign(s.prototype,{extractUrlBase:function(e){return console.warn("THREE.Loader: .extractUrlBase() has been deprecated. Use THREE.LoaderUtils.extractUrlBase() instead."),ed.extractUrlBase(e)}}),s.Handlers={add:function(){console.error("THREE.Loader: Handlers.add() has been removed. Use LoadingManager.addHandler() instead.")},get:function(){console.error("THREE.Loader: Handlers.get() has been removed. Use LoadingManager.getHandler() instead.")}},Object.assign(_p.prototype,{setTexturePath:function(e){return console.warn("THREE.ObjectLoader: .setTexturePath() has been renamed to .setResourcePath()."),this.setResourcePath(e)}}),Object.assign(xd.prototype,{center:function(e){return console.warn("THREE.Box2: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box2: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box2: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},size:function(e){return console.warn("THREE.Box2: .size() has been renamed to .getSize()."),this.getSize(e)}}),Object.assign(Zi.prototype,{center:function(e){return console.warn("THREE.Box3: .center() has been renamed to .getCenter()."),this.getCenter(e)},empty:function(){return console.warn("THREE.Box3: .empty() has been renamed to .isEmpty()."),this.isEmpty()},isIntersectionBox:function(e){return console.warn("THREE.Box3: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionSphere:function(e){return console.warn("THREE.Box3: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)},size:function(e){return console.warn("THREE.Box3: .size() has been renamed to .getSize()."),this.getSize(e)}}),$s.prototype.setFromMatrix=function(e){return console.warn("THREE.Frustum: .setFromMatrix() has been renamed to .setFromProjectionMatrix()."),this.setFromProjectionMatrix(e)},wd.prototype.center=function(e){return console.warn("THREE.Line3: .center() has been renamed to .getCenter()."),this.getCenter(e)},Object.assign(xn,{random16:function(){return console.warn("THREE.Math: .random16() has been deprecated. Use Math.random() instead."),Math.random()},nearestPowerOfTwo:function(e){return console.warn("THREE.Math: .nearestPowerOfTwo() has been renamed to .floorPowerOfTwo()."),xn.floorPowerOfTwo(e)},nextPowerOfTwo:function(e){return console.warn("THREE.Math: .nextPowerOfTwo() has been renamed to .ceilPowerOfTwo()."),xn.ceilPowerOfTwo(e)}}),Object.assign(Ai.prototype,{flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix3: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},multiplyVector3:function(e){return console.warn("THREE.Matrix3: .multiplyVector3() has been removed. Use vector.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},multiplyVector3Array:function(){console.error("THREE.Matrix3: .multiplyVector3Array() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix3: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix3( matrix ) instead."),e.applyMatrix3(this)},applyToVector3Array:function(){console.error("THREE.Matrix3: .applyToVector3Array() has been removed.")}}),Object.assign(mn.prototype,{extractPosition:function(e){return console.warn("THREE.Matrix4: .extractPosition() has been renamed to .copyPosition()."),this.copyPosition(e)},flattenToArrayOffset:function(e,t){return console.warn("THREE.Matrix4: .flattenToArrayOffset() has been deprecated. Use .toArray() instead."),this.toArray(e,t)},getPosition:function(){return console.warn("THREE.Matrix4: .getPosition() has been removed. Use Vector3.setFromMatrixPosition( matrix ) instead."),new Le().setFromMatrixColumn(this,3)},setRotationFromQuaternion:function(e){return console.warn("THREE.Matrix4: .setRotationFromQuaternion() has been renamed to .makeRotationFromQuaternion()."),this.makeRotationFromQuaternion(e)},multiplyToArray:function(){console.warn("THREE.Matrix4: .multiplyToArray() has been removed.")},multiplyVector3:function(e){return console.warn("THREE.Matrix4: .multiplyVector3() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector4:function(e){return console.warn("THREE.Matrix4: .multiplyVector4() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},multiplyVector3Array:function(){console.error("THREE.Matrix4: .multiplyVector3Array() has been removed.")},rotateAxis:function(e){console.warn("THREE.Matrix4: .rotateAxis() has been removed. Use Vector3.transformDirection( matrix ) instead."),e.transformDirection(this)},crossVector:function(e){return console.warn("THREE.Matrix4: .crossVector() has been removed. Use vector.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},translate:function(){console.error("THREE.Matrix4: .translate() has been removed.")},rotateX:function(){console.error("THREE.Matrix4: .rotateX() has been removed.")},rotateY:function(){console.error("THREE.Matrix4: .rotateY() has been removed.")},rotateZ:function(){console.error("THREE.Matrix4: .rotateZ() has been removed.")},rotateByAxis:function(){console.error("THREE.Matrix4: .rotateByAxis() has been removed.")},applyToBufferAttribute:function(e){return console.warn("THREE.Matrix4: .applyToBufferAttribute() has been removed. Use attribute.applyMatrix4( matrix ) instead."),e.applyMatrix4(this)},applyToVector3Array:function(){console.error("THREE.Matrix4: .applyToVector3Array() has been removed.")},makeFrustum:function(e,t,r,i,l,p){return console.warn("THREE.Matrix4: .makeFrustum() has been removed. Use .makePerspective( left, right, top, bottom, near, far ) instead."),this.makePerspective(e,t,i,r,l,p)}}),na.prototype.isIntersectionLine=function(e){return console.warn("THREE.Plane: .isIntersectionLine() has been renamed to .intersectsLine()."),this.intersectsLine(e)},Gi.prototype.multiplyVector3=function(e){return console.warn("THREE.Quaternion: .multiplyVector3() has been removed. Use is now vector.applyQuaternion( quaternion ) instead."),e.applyQuaternion(this)},Object.assign(kn.prototype,{isIntersectionBox:function(e){return console.warn("THREE.Ray: .isIntersectionBox() has been renamed to .intersectsBox()."),this.intersectsBox(e)},isIntersectionPlane:function(e){return console.warn("THREE.Ray: .isIntersectionPlane() has been renamed to .intersectsPlane()."),this.intersectsPlane(e)},isIntersectionSphere:function(e){return console.warn("THREE.Ray: .isIntersectionSphere() has been renamed to .intersectsSphere()."),this.intersectsSphere(e)}}),Object.assign(ki.prototype,{area:function(){return console.warn("THREE.Triangle: .area() has been renamed to .getArea()."),this.getArea()},barycoordFromPoint:function(e,t){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),this.getBarycoord(e,t)},midpoint:function(e){return console.warn("THREE.Triangle: .midpoint() has been renamed to .getMidpoint()."),this.getMidpoint(e)},normal:function(e){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),this.getNormal(e)},plane:function(e){return console.warn("THREE.Triangle: .plane() has been renamed to .getPlane()."),this.getPlane(e)}}),Object.assign(ki,{barycoordFromPoint:function(e,t,r,i,l){return console.warn("THREE.Triangle: .barycoordFromPoint() has been renamed to .getBarycoord()."),ki.getBarycoord(e,t,r,i,l)},normal:function(e,t,r,i){return console.warn("THREE.Triangle: .normal() has been renamed to .getNormal()."),ki.getNormal(e,t,r,i)}}),Object.assign($a.prototype,{extractAllPoints:function(e){return console.warn("THREE.Shape: .extractAllPoints() has been removed. Use .extractPoints() instead."),this.extractPoints(e)},extrude:function(e){return console.warn("THREE.Shape: .extrude() has been removed. Use ExtrudeGeometry() instead."),new cl(this,e)},makeGeometry:function(e){return console.warn("THREE.Shape: .makeGeometry() has been removed. Use ShapeGeometry() instead."),new Kl(this,e)}}),Object.assign(Gt.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector2: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector2: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector2: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(Le.prototype,{setEulerFromRotationMatrix:function(){console.error("THREE.Vector3: .setEulerFromRotationMatrix() has been removed. Use Euler.setFromRotationMatrix() instead.")},setEulerFromQuaternion:function(){console.error("THREE.Vector3: .setEulerFromQuaternion() has been removed. Use Euler.setFromQuaternion() instead.")},getPositionFromMatrix:function(e){return console.warn("THREE.Vector3: .getPositionFromMatrix() has been renamed to .setFromMatrixPosition()."),this.setFromMatrixPosition(e)},getScaleFromMatrix:function(e){return console.warn("THREE.Vector3: .getScaleFromMatrix() has been renamed to .setFromMatrixScale()."),this.setFromMatrixScale(e)},getColumnFromMatrix:function(e,t){return console.warn("THREE.Vector3: .getColumnFromMatrix() has been renamed to .setFromMatrixColumn()."),this.setFromMatrixColumn(t,e)},applyProjection:function(e){return console.warn("THREE.Vector3: .applyProjection() has been removed. Use .applyMatrix4( m ) instead."),this.applyMatrix4(e)},fromAttribute:function(e,t,r){return console.warn("THREE.Vector3: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},distanceToManhattan:function(e){return console.warn("THREE.Vector3: .distanceToManhattan() has been renamed to .manhattanDistanceTo()."),this.manhattanDistanceTo(e)},lengthManhattan:function(){return console.warn("THREE.Vector3: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(qn.prototype,{fromAttribute:function(e,t,r){return console.warn("THREE.Vector4: .fromAttribute() has been renamed to .fromBufferAttribute()."),this.fromBufferAttribute(e,t,r)},lengthManhattan:function(){return console.warn("THREE.Vector4: .lengthManhattan() has been renamed to .manhattanLength()."),this.manhattanLength()}}),Object.assign(un.prototype,{computeTangents:function(){console.error("THREE.Geometry: .computeTangents() has been removed.")},computeLineDistances:function(){console.error("THREE.Geometry: .computeLineDistances() has been removed. Use THREE.Line.computeLineDistances() instead.")},applyMatrix:function(e){return console.warn("THREE.Geometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.assign(At.prototype,{getChildByName:function(e){return console.warn("THREE.Object3D: .getChildByName() has been renamed to .getObjectByName()."),this.getObjectByName(e)},renderDepth:function(){console.warn("THREE.Object3D: .renderDepth has been removed. Use .renderOrder, instead.")},translate:function(e,t){return console.warn("THREE.Object3D: .translate() has been removed. Use .translateOnAxis( axis, distance ) instead."),this.translateOnAxis(t,e)},getWorldRotation:function(){console.error("THREE.Object3D: .getWorldRotation() has been removed. Use THREE.Object3D.getWorldQuaternion( target ) instead.")},applyMatrix:function(e){return console.warn("THREE.Object3D: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(At.prototype,{eulerOrder:{get:function(){return console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order},set:function(e){console.warn("THREE.Object3D: .eulerOrder is now .rotation.order."),this.rotation.order=e}},useQuaternion:{get:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")},set:function(){console.warn("THREE.Object3D: .useQuaternion has been removed. The library now uses quaternions by default.")}}}),Object.assign(Di.prototype,{setDrawMode:function(){console.error("THREE.Mesh: .setDrawMode() has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}),Object.defineProperties(Di.prototype,{drawMode:{get:function(){return console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode."),0},set:function(){console.error("THREE.Mesh: .drawMode has been removed. The renderer now always assumes THREE.TrianglesDrawMode. Transform your geometry via BufferGeometryUtils.toTrianglesDrawMode() if necessary.")}}}),Object.defineProperties(Mu.prototype,{objects:{get:function(){return console.warn("THREE.LOD: .objects has been renamed to .levels."),this.levels}}}),Object.defineProperty(Ec.prototype,"useVertexTexture",{get:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")},set:function(){console.warn("THREE.Skeleton: useVertexTexture has been removed.")}}),_u.prototype.initBones=function(){console.error("THREE.SkinnedMesh: initBones() has been removed.")},Object.defineProperty(mt.prototype,"__arcLengthDivisions",{get:function(){return console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions},set:function(e){console.warn("THREE.Curve: .__arcLengthDivisions is now .arcLengthDivisions."),this.arcLengthDivisions=e}}),Ni.prototype.setLens=function(e,t){console.warn("THREE.PerspectiveCamera.setLens is deprecated. Use .setFocalLength and .filmGauge for a photographic setup."),t!==void 0&&(this.filmGauge=t),this.setFocalLength(e)},Object.defineProperties(Hn.prototype,{onlyShadow:{set:function(){console.warn("THREE.Light: .onlyShadow has been removed.")}},shadowCameraFov:{set:function(e){console.warn("THREE.Light: .shadowCameraFov is now .shadow.camera.fov."),this.shadow.camera.fov=e}},shadowCameraLeft:{set:function(e){console.warn("THREE.Light: .shadowCameraLeft is now .shadow.camera.left."),this.shadow.camera.left=e}},shadowCameraRight:{set:function(e){console.warn("THREE.Light: .shadowCameraRight is now .shadow.camera.right."),this.shadow.camera.right=e}},shadowCameraTop:{set:function(e){console.warn("THREE.Light: .shadowCameraTop is now .shadow.camera.top."),this.shadow.camera.top=e}},shadowCameraBottom:{set:function(e){console.warn("THREE.Light: .shadowCameraBottom is now .shadow.camera.bottom."),this.shadow.camera.bottom=e}},shadowCameraNear:{set:function(e){console.warn("THREE.Light: .shadowCameraNear is now .shadow.camera.near."),this.shadow.camera.near=e}},shadowCameraFar:{set:function(e){console.warn("THREE.Light: .shadowCameraFar is now .shadow.camera.far."),this.shadow.camera.far=e}},shadowCameraVisible:{set:function(){console.warn("THREE.Light: .shadowCameraVisible has been removed. Use new THREE.CameraHelper( light.shadow.camera ) instead.")}},shadowBias:{set:function(e){console.warn("THREE.Light: .shadowBias is now .shadow.bias."),this.shadow.bias=e}},shadowDarkness:{set:function(){console.warn("THREE.Light: .shadowDarkness has been removed.")}},shadowMapWidth:{set:function(e){console.warn("THREE.Light: .shadowMapWidth is now .shadow.mapSize.width."),this.shadow.mapSize.width=e}},shadowMapHeight:{set:function(e){console.warn("THREE.Light: .shadowMapHeight is now .shadow.mapSize.height."),this.shadow.mapSize.height=e}}}),Object.defineProperties(Kt.prototype,{length:{get:function(){return console.warn("THREE.BufferAttribute: .length has been deprecated. Use .count instead."),this.array.length}},dynamic:{get:function(){return console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.usage===wa},set:function(){console.warn("THREE.BufferAttribute: .dynamic has been deprecated. Use .usage instead."),this.setUsage(wa)}}}),Object.assign(Kt.prototype,{setDynamic:function(e){return console.warn("THREE.BufferAttribute: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?wa:Jn),this},copyIndicesArray:function(){console.error("THREE.BufferAttribute: .copyIndicesArray() has been removed.")},setArray:function(){console.error("THREE.BufferAttribute: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(br.prototype,{addIndex:function(e){console.warn("THREE.BufferGeometry: .addIndex() has been renamed to .setIndex()."),this.setIndex(e)},addAttribute:function(e,t){return console.warn("THREE.BufferGeometry: .addAttribute() has been renamed to .setAttribute()."),t&&t.isBufferAttribute||t&&t.isInterleavedBufferAttribute?e==="index"?(console.warn("THREE.BufferGeometry.addAttribute: Use .setIndex() for index attribute."),this.setIndex(t),this):this.setAttribute(e,t):(console.warn("THREE.BufferGeometry: .addAttribute() now expects ( name, attribute )."),this.setAttribute(e,new Kt(t,arguments[2])))},addDrawCall:function(e,t,r){r!==void 0&&console.warn("THREE.BufferGeometry: .addDrawCall() no longer supports indexOffset."),console.warn("THREE.BufferGeometry: .addDrawCall() is now .addGroup()."),this.addGroup(e,t)},clearDrawCalls:function(){console.warn("THREE.BufferGeometry: .clearDrawCalls() is now .clearGroups()."),this.clearGroups()},computeTangents:function(){console.warn("THREE.BufferGeometry: .computeTangents() has been removed.")},computeOffsets:function(){console.warn("THREE.BufferGeometry: .computeOffsets() has been removed.")},removeAttribute:function(e){return console.warn("THREE.BufferGeometry: .removeAttribute() has been renamed to .deleteAttribute()."),this.deleteAttribute(e)},applyMatrix:function(e){return console.warn("THREE.BufferGeometry: .applyMatrix() has been renamed to .applyMatrix4()."),this.applyMatrix4(e)}}),Object.defineProperties(br.prototype,{drawcalls:{get:function(){return console.error("THREE.BufferGeometry: .drawcalls has been renamed to .groups."),this.groups}},offsets:{get:function(){return console.warn("THREE.BufferGeometry: .offsets has been renamed to .groups."),this.groups}}}),Object.defineProperties(Zo.prototype,{dynamic:{get:function(){return console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.usage===wa},set:function(e){console.warn("THREE.InterleavedBuffer: .length has been deprecated. Use .usage instead."),this.setUsage(e)}}}),Object.assign(Zo.prototype,{setDynamic:function(e){return console.warn("THREE.InterleavedBuffer: .setDynamic() has been deprecated. Use .setUsage() instead."),this.setUsage(e===!0?wa:Jn),this},setArray:function(){console.error("THREE.InterleavedBuffer: .setArray has been removed. Use BufferGeometry .setAttribute to replace/resize attribute buffers")}}),Object.assign(Ls.prototype,{getArrays:function(){console.error("THREE.ExtrudeBufferGeometry: .getArrays() has been removed.")},addShapeList:function(){console.error("THREE.ExtrudeBufferGeometry: .addShapeList() has been removed.")},addShape:function(){console.error("THREE.ExtrudeBufferGeometry: .addShape() has been removed.")}}),Object.defineProperties(Sp.prototype,{dynamic:{set:function(){console.warn("THREE.Uniform: .dynamic has been removed. Use object.onBeforeRender() instead.")}},onUpdate:{value:function(){return console.warn("THREE.Uniform: .onUpdate() has been removed. Use object.onBeforeRender() instead."),this}}}),Object.defineProperties(kt.prototype,{wrapAround:{get:function(){console.warn("THREE.Material: .wrapAround has been removed.")},set:function(){console.warn("THREE.Material: .wrapAround has been removed.")}},overdraw:{get:function(){console.warn("THREE.Material: .overdraw has been removed.")},set:function(){console.warn("THREE.Material: .overdraw has been removed.")}},wrapRGB:{get:function(){return console.warn("THREE.Material: .wrapRGB has been removed."),new Qe}},shading:{get:function(){console.error("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead.")},set:function(e){console.warn("THREE."+this.type+": .shading has been removed. Use the boolean .flatShading instead."),this.flatShading=e===1}},stencilMask:{get:function(){return console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask},set:function(e){console.warn("THREE."+this.type+": .stencilMask has been removed. Use .stencilFuncMask instead."),this.stencilFuncMask=e}}}),Object.defineProperties(js.prototype,{metal:{get:function(){return console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead."),!1},set:function(){console.warn("THREE.MeshPhongMaterial: .metal has been removed. Use THREE.MeshStandardMaterial instead")}}}),Object.defineProperties(Xa.prototype,{derivatives:{get:function(){return console.warn("THREE.ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives},set:function(e){console.warn("THREE. ShaderMaterial: .derivatives has been moved to .extensions.derivatives."),this.extensions.derivatives=e}}}),Object.assign(Dc.prototype,{clearTarget:function(e,t,r,i){console.warn("THREE.WebGLRenderer: .clearTarget() has been deprecated. Use .setRenderTarget() and .clear() instead."),this.setRenderTarget(e),this.clear(t,r,i)},animate:function(e){console.warn("THREE.WebGLRenderer: .animate() is now .setAnimationLoop()."),this.setAnimationLoop(e)},getCurrentRenderTarget:function(){return console.warn("THREE.WebGLRenderer: .getCurrentRenderTarget() is now .getRenderTarget()."),this.getRenderTarget()},getMaxAnisotropy:function(){return console.warn("THREE.WebGLRenderer: .getMaxAnisotropy() is now .capabilities.getMaxAnisotropy()."),this.capabilities.getMaxAnisotropy()},getPrecision:function(){return console.warn("THREE.WebGLRenderer: .getPrecision() is now .capabilities.precision."),this.capabilities.precision},resetGLState:function(){return console.warn("THREE.WebGLRenderer: .resetGLState() is now .state.reset()."),this.state.reset()},supportsFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsFloatTextures() is now .extensions.get( 'OES_texture_float' )."),this.extensions.get("OES_texture_float")},supportsHalfFloatTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsHalfFloatTextures() is now .extensions.get( 'OES_texture_half_float' )."),this.extensions.get("OES_texture_half_float")},supportsStandardDerivatives:function(){return console.warn("THREE.WebGLRenderer: .supportsStandardDerivatives() is now .extensions.get( 'OES_standard_derivatives' )."),this.extensions.get("OES_standard_derivatives")},supportsCompressedTextureS3TC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTextureS3TC() is now .extensions.get( 'WEBGL_compressed_texture_s3tc' )."),this.extensions.get("WEBGL_compressed_texture_s3tc")},supportsCompressedTexturePVRTC:function(){return console.warn("THREE.WebGLRenderer: .supportsCompressedTexturePVRTC() is now .extensions.get( 'WEBGL_compressed_texture_pvrtc' )."),this.extensions.get("WEBGL_compressed_texture_pvrtc")},supportsBlendMinMax:function(){return console.warn("THREE.WebGLRenderer: .supportsBlendMinMax() is now .extensions.get( 'EXT_blend_minmax' )."),this.extensions.get("EXT_blend_minmax")},supportsVertexTextures:function(){return console.warn("THREE.WebGLRenderer: .supportsVertexTextures() is now .capabilities.vertexTextures."),this.capabilities.vertexTextures},supportsInstancedArrays:function(){return console.warn("THREE.WebGLRenderer: .supportsInstancedArrays() is now .extensions.get( 'ANGLE_instanced_arrays' )."),this.extensions.get("ANGLE_instanced_arrays")},enableScissorTest:function(e){console.warn("THREE.WebGLRenderer: .enableScissorTest() is now .setScissorTest()."),this.setScissorTest(e)},initMaterial:function(){console.warn("THREE.WebGLRenderer: .initMaterial() has been removed.")},addPrePlugin:function(){console.warn("THREE.WebGLRenderer: .addPrePlugin() has been removed.")},addPostPlugin:function(){console.warn("THREE.WebGLRenderer: .addPostPlugin() has been removed.")},updateShadowMap:function(){console.warn("THREE.WebGLRenderer: .updateShadowMap() has been removed.")},setFaceCulling:function(){console.warn("THREE.WebGLRenderer: .setFaceCulling() has been removed.")},allocTextureUnit:function(){console.warn("THREE.WebGLRenderer: .allocTextureUnit() has been removed.")},setTexture:function(){console.warn("THREE.WebGLRenderer: .setTexture() has been removed.")},setTexture2D:function(){console.warn("THREE.WebGLRenderer: .setTexture2D() has been removed.")},setTextureCube:function(){console.warn("THREE.WebGLRenderer: .setTextureCube() has been removed.")},getActiveMipMapLevel:function(){return console.warn("THREE.WebGLRenderer: .getActiveMipMapLevel() is now .getActiveMipmapLevel()."),this.getActiveMipmapLevel()}}),Object.defineProperties(Dc.prototype,{shadowMapEnabled:{get:function(){return this.shadowMap.enabled},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapEnabled is now .shadowMap.enabled."),this.shadowMap.enabled=e}},shadowMapType:{get:function(){return this.shadowMap.type},set:function(e){console.warn("THREE.WebGLRenderer: .shadowMapType is now .shadowMap.type."),this.shadowMap.type=e}},shadowMapCullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMapCullFace has been removed. Set Material.shadowSide instead.")}},context:{get:function(){return console.warn("THREE.WebGLRenderer: .context has been removed. Use .getContext() instead."),this.getContext()}},vr:{get:function(){return console.warn("THREE.WebGLRenderer: .vr has been renamed to .xr"),this.xr}},gammaInput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead."),!1},set:function(){console.warn("THREE.WebGLRenderer: .gammaInput has been removed. Set the encoding for textures via Texture.encoding instead.")}},gammaOutput:{get:function(){return console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),!1},set:function(e){console.warn("THREE.WebGLRenderer: .gammaOutput has been removed. Set WebGLRenderer.outputEncoding instead."),this.outputEncoding=e===!0?yt:Ke}}}),Object.defineProperties(Oh.prototype,{cullFace:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.cullFace has been removed. Set Material.shadowSide instead.")}},renderReverseSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderReverseSided has been removed. Set Material.shadowSide instead.")}},renderSingleSided:{get:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")},set:function(){console.warn("THREE.WebGLRenderer: .shadowMap.renderSingleSided has been removed. Set Material.shadowSide instead.")}}}),Object.defineProperties(Yi.prototype,{wrapS:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapS is now .texture.wrapS."),this.texture.wrapS=e}},wrapT:{get:function(){return console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT},set:function(e){console.warn("THREE.WebGLRenderTarget: .wrapT is now .texture.wrapT."),this.texture.wrapT=e}},magFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .magFilter is now .texture.magFilter."),this.texture.magFilter=e}},minFilter:{get:function(){return console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter},set:function(e){console.warn("THREE.WebGLRenderTarget: .minFilter is now .texture.minFilter."),this.texture.minFilter=e}},anisotropy:{get:function(){return console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy},set:function(e){console.warn("THREE.WebGLRenderTarget: .anisotropy is now .texture.anisotropy."),this.texture.anisotropy=e}},offset:{get:function(){return console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset},set:function(e){console.warn("THREE.WebGLRenderTarget: .offset is now .texture.offset."),this.texture.offset=e}},repeat:{get:function(){return console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat},set:function(e){console.warn("THREE.WebGLRenderTarget: .repeat is now .texture.repeat."),this.texture.repeat=e}},format:{get:function(){return console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format},set:function(e){console.warn("THREE.WebGLRenderTarget: .format is now .texture.format."),this.texture.format=e}},type:{get:function(){return console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type},set:function(e){console.warn("THREE.WebGLRenderTarget: .type is now .texture.type."),this.texture.type=e}},generateMipmaps:{get:function(){return console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps},set:function(e){console.warn("THREE.WebGLRenderTarget: .generateMipmaps is now .texture.generateMipmaps."),this.texture.generateMipmaps=e}}}),Object.defineProperties($c.prototype,{load:{value:function(e){console.warn("THREE.Audio: .load has been deprecated. Use THREE.AudioLoader instead.");var t=this;return new Cp().load(e,function(r){t.setBuffer(r)}),this}},startTime:{set:function(){console.warn("THREE.Audio: .startTime is now .play( delay ).")}}}),pd.prototype.getData=function(){return console.warn("THREE.AudioAnalyser: .getData() is now .getFrequencyData()."),this.getFrequencyData()},Xs.prototype.updateCubeMap=function(e,t){return console.warn("THREE.CubeCamera: .updateCubeMap() is now .update()."),this.update(e,t)};var Nf={merge:function(e,t,r){var i;console.warn("THREE.GeometryUtils: .merge() has been moved to Geometry. Use geometry.merge( geometry2, matrix, materialIndexOffset ) instead."),t.isMesh&&(t.matrixAutoUpdate&&t.updateMatrix(),i=t.matrix,t=t.geometry),e.merge(t,i,r)},center:function(e){return console.warn("THREE.GeometryUtils: .center() has been moved to Geometry. Use geometry.center() instead."),e.center()}};zo.crossOrigin=void 0,zo.loadTexture=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTexture has been deprecated. Use THREE.TextureLoader() instead.");var l=new xt;l.setCrossOrigin(this.crossOrigin);var p=l.load(e,r,void 0,i);return t&&(p.mapping=t),p},zo.loadTextureCube=function(e,t,r,i){console.warn("THREE.ImageUtils.loadTextureCube has been deprecated. Use THREE.CubeTextureLoader() instead.");var l=new nt;l.setCrossOrigin(this.crossOrigin);var p=l.load(e,r,void 0,i);return t&&(p.mapping=t),p},zo.loadCompressedTexture=function(){console.error("THREE.ImageUtils.loadCompressedTexture has been removed. Use THREE.DDSLoader instead.")},zo.loadCompressedTextureCube=function(){console.error("THREE.ImageUtils.loadCompressedTextureCube has been removed. Use THREE.DDSLoader instead.")};var Vf={createMultiMaterialObject:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},detach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")},attach:function(){console.error("THREE.SceneUtils has been moved to /examples/js/utils/SceneUtils.js")}};typeof __THREE_DEVTOOLS__<"u"&&__THREE_DEVTOOLS__.dispatchEvent(new CustomEvent("register",{detail:{revision:"113"}})),c.ACESFilmicToneMapping=Ue,c.AddEquation=D,c.AddOperation=Me,c.AdditiveBlending=Y,c.AlphaFormat=_n,c.AlwaysDepth=re,c.AlwaysStencilFunc=Gs,c.AmbientLight=yp,c.AmbientLightProbe=ld,c.AnimationClip=_o,c.AnimationLoader=oe,c.AnimationMixer=gd,c.AnimationObjectGroup=Hd,c.AnimationUtils=Pi,c.ArcCurve=Zt,c.ArrayCamera=fu,c.ArrowHelper=$u,c.Audio=$c,c.AudioAnalyser=pd,c.AudioContext=od,c.AudioListener=cd,c.AudioLoader=Cp,c.AxesHelper=Fp,c.AxisHelper=function(e){return console.warn("THREE.AxisHelper has been renamed to THREE.AxesHelper."),new Fp(e)},c.BackSide=_,c.BasicDepthPacking=ao,c.BasicShadowMap=0,c.BinaryTextureLoader=function(e){return console.warn("THREE.BinaryTextureLoader has been renamed to THREE.DataTextureLoader."),new Pe(e)},c.Bone=Rh,c.BooleanKeyframeTrack=Yc,c.BoundingBoxHelper=function(e,t){return console.warn("THREE.BoundingBoxHelper has been deprecated. Creating a THREE.BoxHelper instead."),new Ku(e,t)},c.Box2=xd,c.Box3=Zi,c.Box3Helper=Cd,c.BoxBufferGeometry=lu,c.BoxGeometry=oh,c.BoxHelper=Ku,c.BufferAttribute=Kt,c.BufferGeometry=br,c.BufferGeometryLoader=Mp,c.ByteType=In,c.Cache=gl,c.Camera=Lo,c.CameraHelper=Td,c.CanvasRenderer=function(){console.error("THREE.CanvasRenderer has been removed")},c.CanvasTexture=Eu,c.CatmullRomCurve3=Ir,c.CineonToneMapping=_t,c.CircleBufferGeometry=Bu,c.CircleGeometry=Jc,c.ClampToEdgeWrapping=Or,c.Clock=ud,c.ClosedSplineCurve3=wf,c.Color=Qe,c.ColorKeyframeTrack=Zc,c.CompressedTexture=Nc,c.CompressedTextureLoader=de,c.ConeBufferGeometry=Wc,c.ConeGeometry=Hc,c.CubeCamera=Xs,c.CubeGeometry=oh,c.CubeReflectionMapping=Rt,c.CubeRefractionMapping=It,c.CubeTexture=Ss,c.CubeTextureLoader=nt,c.CubeUVReflectionMapping=gt,c.CubeUVRefractionMapping=We,c.CubicBezierCurve=Rn,c.CubicBezierCurve3=kr,c.CubicInterpolant=qc,c.CullFaceBack=A,c.CullFaceFront=H,c.CullFaceFrontBack=3,c.CullFaceNone=x,c.Curve=mt,c.CurvePath=ya,c.CustomBlending=B,c.CylinderBufferGeometry=Is,c.CylinderGeometry=pl,c.Cylindrical=Yd,c.DataTexture=Pl,c.DataTexture2DArray=mc,c.DataTexture3D=ja,c.DataTextureLoader=Pe,c.DecrementStencilOp=7683,c.DecrementWrapStencilOp=34056,c.DefaultLoadingManager=gp,c.DepthFormat=an,c.DepthStencilFormat=Mi,c.DepthTexture=Vc,c.DirectionalLight=bl,c.DirectionalLightHelper=jp,c.DirectionalLightShadow=wl,c.DiscreteInterpolant=Xc,c.DodecahedronBufferGeometry=po,c.DodecahedronGeometry=Wl,c.DoubleSide=k,c.DstAlphaFactor=X,c.DstColorFactor=ve,c.DynamicBufferAttribute=function(e,t){return console.warn("THREE.DynamicBufferAttribute has been removed. Use new THREE.BufferAttribute().setUsage( THREE.DynamicDrawUsage ) instead."),new Kt(e,t).setUsage(wa)},c.DynamicCopyUsage=35050,c.DynamicDrawUsage=wa,c.DynamicReadUsage=35049,c.EdgesGeometry=$l,c.EdgesHelper=function(e,t){return console.warn("THREE.EdgesHelper has been removed. Use THREE.EdgesGeometry instead."),new gi(new $l(e.geometry),new Vi({color:t!==void 0?t:16777215}))},c.EllipseCurve=Nt,c.EqualDepth=le,c.EqualStencilFunc=514,c.EquirectangularReflectionMapping=Nr,c.EquirectangularRefractionMapping=Qt,c.Euler=y,c.EventDispatcher=Ia,c.ExtrudeBufferGeometry=Ls,c.ExtrudeGeometry=cl,c.Face3=dr,c.Face4=function(e,t,r,i,l,p,f){return console.warn("THREE.Face4 has been removed. A THREE.Face3 will be created instead."),new dr(e,t,r,l,p,f)},c.FaceColors=1,c.FileLoader=R,c.FlatShading=1,c.Float32Attribute=function(e,t){return console.warn("THREE.Float32Attribute has been removed. Use new THREE.Float32BufferAttribute() instead."),new tr(e,t)},c.Float32BufferAttribute=tr,c.Float64Attribute=function(e,t){return console.warn("THREE.Float64Attribute has been removed. Use new THREE.Float64BufferAttribute() instead."),new En(e,t)},c.Float64BufferAttribute=En,c.FloatType=ke,c.Fog=Yo,c.FogExp2=ho,c.Font=id,c.FontLoader=ad,c.FrontFaceDirectionCCW=1,c.FrontFaceDirectionCW=0,c.FrontSide=E,c.Frustum=$s,c.GammaEncoding=Vt,c.Geometry=un,c.GeometryUtils=Nf,c.GreaterDepth=at,c.GreaterEqualDepth=Re,c.GreaterEqualStencilFunc=518,c.GreaterStencilFunc=516,c.GridHelper=Ip,c.Group=nl,c.HalfFloatType=bt,c.HemisphereLight=Ju,c.HemisphereLightHelper=Lp,c.HemisphereLightProbe=sd,c.IcosahedronBufferGeometry=Ru,c.IcosahedronGeometry=Io,c.ImageBitmapLoader=rd,c.ImageLoader=Ye,c.ImageUtils=zo,c.ImmediateRenderObject=bd,c.IncrementStencilOp=7682,c.IncrementWrapStencilOp=34055,c.InstancedBufferAttribute=bp,c.InstancedBufferGeometry=wp,c.InstancedInterleavedBuffer=yd,c.InstancedMesh=Oc,c.Int16Attribute=function(e,t){return console.warn("THREE.Int16Attribute has been removed. Use new THREE.Int16BufferAttribute() instead."),new Ti(e,t)},c.Int16BufferAttribute=Ti,c.Int32Attribute=function(e,t){return console.warn("THREE.Int32Attribute has been removed. Use new THREE.Int32BufferAttribute() instead."),new be(e,t)},c.Int32BufferAttribute=be,c.Int8Attribute=function(e,t){return console.warn("THREE.Int8Attribute has been removed. Use new THREE.Int8BufferAttribute() instead."),new jn(e,t)},c.Int8BufferAttribute=jn,c.IntType=lt,c.InterleavedBuffer=Zo,c.InterleavedBufferAttribute=gu,c.Interpolant=Ga,c.InterpolateDiscrete=Fn,c.InterpolateLinear=Q,c.InterpolateSmooth=2302,c.InvertStencilOp=5386,c.JSONLoader=function(){console.error("THREE.JSONLoader has been removed.")},c.KeepStencilOp=oo,c.KeyframeTrack=ma,c.LOD=Mu,c.LatheBufferGeometry=Zl,c.LatheGeometry=Fu,c.Layers=O,c.LensFlare=function(){console.error("THREE.LensFlare has been moved to /examples/js/objects/Lensflare.js")},c.LessDepth=fe,c.LessEqualDepth=ne,c.LessEqualStencilFunc=515,c.LessStencilFunc=513,c.Light=Hn,c.LightProbe=ds,c.LightShadow=jo,c.Line=Ra,c.Line3=wd,c.LineBasicMaterial=Vi,c.LineCurve=Gr,c.LineCurve3=ci,c.LineDashedMaterial=Hu,c.LineLoop=Du,c.LinePieces=1,c.LineSegments=gi,c.LineStrip=0,c.LinearEncoding=Ke,c.LinearFilter=Tr,c.LinearInterpolant=Wu,c.LinearMipMapLinearFilter=1008,c.LinearMipMapNearestFilter=1007,c.LinearMipmapLinearFilter=Hr,c.LinearMipmapNearestFilter=ir,c.LinearToneMapping=$e,c.Loader=s,c.LoaderUtils=ed,c.LoadingManager=Vh,c.LogLuvEncoding=Pr,c.LoopOnce=2200,c.LoopPingPong=2202,c.LoopRepeat=2201,c.LuminanceAlphaFormat=hi,c.LuminanceFormat=Sa,c.MOUSE={LEFT:0,MIDDLE:1,RIGHT:2,ROTATE:0,DOLLY:1,PAN:2},c.Material=kt,c.MaterialLoader=xp,c.Math=xn,c.MathUtils=xn,c.Matrix3=Ai,c.Matrix4=mn,c.MaxEquation=u,c.Mesh=Di,c.MeshBasicMaterial=Dn,c.MeshDepthMaterial=Xo,c.MeshDistanceMaterial=rl,c.MeshFaceMaterial=function(e){return console.warn("THREE.MeshFaceMaterial has been removed. Use an Array instead."),e},c.MeshLambertMaterial=fa,c.MeshMatcapMaterial=fl,c.MeshNormalMaterial=Uu,c.MeshPhongMaterial=js,c.MeshPhysicalMaterial=Gu,c.MeshStandardMaterial=ps,c.MeshToonMaterial=zu,c.MinEquation=h,c.MirroredRepeatWrapping=Yr,c.MixOperation=ue,c.MultiMaterial=function(e){return e===void 0&&(e=[]),console.warn("THREE.MultiMaterial has been removed. Use an Array instead."),e.isMultiMaterial=!0,(e.materials=e).clone=function(){return e.slice()},e},c.MultiplyBlending=T,c.MultiplyOperation=Ie,c.NearestFilter=ct,c.NearestMipMapLinearFilter=1005,c.NearestMipMapNearestFilter=1004,c.NearestMipmapLinearFilter=qt,c.NearestMipmapNearestFilter=st,c.NeverDepth=Be,c.NeverStencilFunc=512,c.NoBlending=C,c.NoColors=U,c.NoToneMapping=Je,c.NormalBlending=S,c.NotEqualDepth=ze,c.NotEqualStencilFunc=517,c.NumberKeyframeTrack=Ns,c.Object3D=At,c.ObjectLoader=_p,c.ObjectSpaceNormalMap=So,c.OctahedronBufferGeometry=yi,c.OctahedronGeometry=Da,c.OneFactor=M,c.OneMinusDstAlphaFactor=se,c.OneMinusDstColorFactor=Ee,c.OneMinusSrcAlphaFactor=te,c.OneMinusSrcColorFactor=z,c.OrthographicCamera=xl,c.PCFShadowMap=F,c.PCFSoftShadowMap=P,c.PMREMGenerator=Pd,c.ParametricBufferGeometry=Au,c.ParametricGeometry=Ka,c.Particle=function(e){return console.warn("THREE.Particle has been renamed to THREE.Sprite."),new bu(e)},c.ParticleBasicMaterial=function(e){return console.warn("THREE.ParticleBasicMaterial has been renamed to THREE.PointsMaterial."),new Ko(e)},c.ParticleSystem=function(e,t){return console.warn("THREE.ParticleSystem has been renamed to THREE.Points."),new zl(e,t)},c.ParticleSystemMaterial=function(e){return console.warn("THREE.ParticleSystemMaterial has been renamed to THREE.PointsMaterial."),new Ko(e)},c.Path=va,c.PerspectiveCamera=Ni,c.Plane=na,c.PlaneBufferGeometry=Qs,c.PlaneGeometry=Rl,c.PlaneHelper=Dd,c.PointCloud=function(e,t){return console.warn("THREE.PointCloud has been renamed to THREE.Points."),new zl(e,t)},c.PointCloudMaterial=function(e){return console.warn("THREE.PointCloudMaterial has been renamed to THREE.PointsMaterial."),new Ko(e)},c.PointLight=vl,c.PointLightHelper=Rp,c.Points=zl,c.PointsMaterial=Ko,c.PolarGridHelper=_d,c.PolyhedronBufferGeometry=ia,c.PolyhedronGeometry=Fc,c.PositionalAudio=hd,c.PropertyBinding=Qa,c.PropertyMixer=dd,c.QuadraticBezierCurve=ii,c.QuadraticBezierCurve3=Fi,c.Quaternion=Gi,c.QuaternionKeyframeTrack=ml,c.QuaternionLinearInterpolant=Ql,c.REVISION="113",c.RGBADepthPacking=Oi,c.RGBAFormat=Tn,c.RGBAIntegerFormat=vo,c.RGBA_ASTC_10x10_Format=is,c.RGBA_ASTC_10x5_Format=An,c.RGBA_ASTC_10x6_Format=ns,c.RGBA_ASTC_10x8_Format=xs,c.RGBA_ASTC_12x10_Format=Bo,c.RGBA_ASTC_12x12_Format=Xi,c.RGBA_ASTC_4x4_Format=Bs,c.RGBA_ASTC_5x4_Format=ro,c.RGBA_ASTC_5x5_Format=ys,c.RGBA_ASTC_6x5_Format=Oa,c.RGBA_ASTC_6x6_Format=vs,c.RGBA_ASTC_8x5_Format=no,c.RGBA_ASTC_8x6_Format=io,c.RGBA_ASTC_8x8_Format=Xn,c.RGBA_PVRTC_2BPPV1_Format=Ea,c.RGBA_PVRTC_4BPPV1_Format=Fo,c.RGBA_S3TC_DXT1_Format=Do,c.RGBA_S3TC_DXT3_Format=ms,c.RGBA_S3TC_DXT5_Format=to,c.RGBDEncoding=di,c.RGBEEncoding=Wt,c.RGBEFormat=ri,c.RGBFormat=Sn,c.RGBIntegerFormat=Ei,c.RGBM16Encoding=ln,c.RGBM7Encoding=Br,c.RGB_ETC1_Format=gs,c.RGB_PVRTC_2BPPV1_Format=sa,c.RGB_PVRTC_4BPPV1_Format=rs,c.RGB_S3TC_DXT1_Format=ts,c.RGFormat=pi,c.RGIntegerFormat=Fr,c.RawShaderMaterial=ks,c.Ray=kn,c.Raycaster=Jd,c.RectAreaLight=vp,c.RedFormat=q,c.RedIntegerFormat=Cn,c.ReinhardToneMapping=ft,c.RepeatWrapping=Yt,c.ReplaceStencilOp=7681,c.ReverseSubtractEquation=I,c.RingBufferGeometry=Vu,c.RingGeometry=Uc,c.Scene=Wr,c.SceneUtils=Vf,c.ShaderChunk=Pn,c.ShaderLib=Mo,c.ShaderMaterial=Xa,c.ShadowMaterial=dl,c.Shape=$a,c.ShapeBufferGeometry=$o,c.ShapeGeometry=Kl,c.ShapePath=nd,c.ShapeUtils=hs,c.ShortType=Zr,c.Skeleton=Ec,c.SkeletonHelper=Pp,c.SkinnedMesh=_u,c.SmoothShading=2,c.Sphere=Kn,c.SphereBufferGeometry=hl,c.SphereGeometry=zc,c.Spherical=Xd,c.SphericalHarmonics3=Dp,c.SphericalReflectionMapping=Ur,c.Spline=Id,c.SplineCurve=Wn,c.SplineCurve3=bf,c.SpotLight=tu,c.SpotLightHelper=Op,c.SpotLightShadow=yl,c.Sprite=bu,c.SpriteMaterial=al,c.SrcAlphaFactor=J,c.SrcAlphaSaturateFactor=we,c.SrcColorFactor=j,c.StaticCopyUsage=35046,c.StaticDrawUsage=Jn,c.StaticReadUsage=35045,c.StereoCamera=Bd,c.StreamCopyUsage=35042,c.StreamDrawUsage=35040,c.StreamReadUsage=35041,c.StringKeyframeTrack=Kc,c.SubtractEquation=N,c.SubtractiveBlending=G,c.TOUCH={ROTATE:0,PAN:1,DOLLY_PAN:2,DOLLY_ROTATE:3},c.TangentSpaceNormalMap=xo,c.TetrahedronBufferGeometry=Pu,c.TetrahedronGeometry=yn,c.TextBufferGeometry=da,c.TextGeometry=Ji,c.Texture=Yn,c.TextureLoader=xt,c.TorusBufferGeometry=Jl,c.TorusGeometry=Iu,c.TorusKnotBufferGeometry=xi,c.TorusKnotGeometry=vi,c.Triangle=ki,c.TriangleFanDrawMode=2,c.TriangleStripDrawMode=1,c.TrianglesDrawMode=0,c.TubeBufferGeometry=Ps,c.TubeGeometry=Lu,c.UVMapping=300,c.Uint16Attribute=function(e,t){return console.warn("THREE.Uint16Attribute has been removed. Use new THREE.Uint16BufferAttribute() instead."),new mi(e,t)},c.Uint16BufferAttribute=mi,c.Uint32Attribute=function(e,t){return console.warn("THREE.Uint32Attribute has been removed. Use new THREE.Uint32BufferAttribute() instead."),new Ci(e,t)},c.Uint32BufferAttribute=Ci,c.Uint8Attribute=function(e,t){return console.warn("THREE.Uint8Attribute has been removed. Use new THREE.Uint8BufferAttribute() instead."),new tn(e,t)},c.Uint8BufferAttribute=tn,c.Uint8ClampedAttribute=function(e,t){return console.warn("THREE.Uint8ClampedAttribute has been removed. Use new THREE.Uint8ClampedBufferAttribute() instead."),new ui(e,t)},c.Uint8ClampedBufferAttribute=ui,c.Uncharted2ToneMapping=Pt,c.Uniform=Sp,c.UniformsLib=gr,c.UniformsUtils=sh,c.UnsignedByteType=vn,c.UnsignedInt248Type=Kr,c.UnsignedIntType=xe,c.UnsignedShort4444Type=er,c.UnsignedShort5551Type=Ar,c.UnsignedShort565Type=Cr,c.UnsignedShortType=Gn,c.VSMShadowMap=g,c.Vector2=Gt,c.Vector3=Le,c.Vector4=qn,c.VectorKeyframeTrack=eu,c.Vertex=function(e,t,r){return console.warn("THREE.Vertex has been removed. Use THREE.Vector3 instead."),new Le(e,t,r)},c.VertexColors=2,c.VideoTexture=Hl,c.WebGLCubeRenderTarget=Ys,c.WebGLMultisampleRenderTarget=zs,c.WebGLRenderTarget=Yi,c.WebGLRenderTargetCube=function(e,t,r){return console.warn("THREE.WebGLRenderTargetCube( width, height, options ) is now WebGLCubeRenderTarget( size, options )."),new Ys(e,r)},c.WebGLRenderer=Dc,c.WebGLUtils=jl,c.WireframeGeometry=Ou,c.WireframeHelper=function(e,t){return console.warn("THREE.WireframeHelper has been removed. Use THREE.WireframeGeometry instead."),new gi(new Ou(e.geometry),new Vi({color:t!==void 0?t:16777215}))},c.WrapAroundEnding=Ce,c.XHRLoader=function(e){return console.warn("THREE.XHRLoader has been renamed to THREE.FileLoader."),new R(e)},c.ZeroCurvatureEnding=De,c.ZeroFactor=v,c.ZeroSlopeEnding=ce,c.ZeroStencilOp=0,c.sRGBEncoding=yt,Object.defineProperty(c,"__esModule",{value:!0})},typeof o=="object"&&n!==void 0?m(o):typeof define=="function"&&define.amd?define(["exports"],m):m((a=a||self).THREE={})},{}],20:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MrxDbgUtils=void 0;var a,m,c=b("three"),x=b("./Operate/MxEntSelJig"),A=b("./Operate/MxJigCmdManager"),H=b("./UI/MxUiVue"),F=b("./Operate/MrxDbgUiPrPoint"),P=b("./Operate/MrxDbgUiPrBase"),g=b("./MxThreeJS");(m=a||(o.MrxDbgUtils=a={})).findEntAtPoint=function(E,_,k,U,C){return k===void 0&&(k=null),U===void 0&&(U=!0),new Promise(function(S){for(var Y=E.findMxEntityAtPoint(_,U,C),G=[],T=Y.length,B=0;B<T;B++){var D=Y[B];if(!k||!k.type||k.type==D.getTypeName()){var N=D.objectId();G.push(N)}}S(G)})},m.selectEnt=function(E,_){return _===void 0&&(_=null),new Promise(function(k){var U=new x.MxEntSelJig;U.disableAllTrace(),U.setDynamicInputType(A.MxJigCmdManager.DynamicInputType.kDynTip),E&&H.MxUiVue.acutPrintf(E),U.filter=_,U.callRet=function(C){k(C)},A.MxJigCmdManager.runCmd(U)})},m.getCorner=function(E,_,k,U,C){return k===void 0&&(k=!1),C===void 0&&(C=!1),new Promise(function(S){var Y=new F.MrxDbgUiPrPoint;Y.setMessage(_),k?(Y.setDynamicInputType(A.MxJigCmdManager.DynamicInputType.kDynTip),Y.disableAllTrace(),Y.setDisableOsnap(!0),Y.setInputToucheType(A.MxJigCmdManager.InType.kGetEnd)):(Y.setDynamicInputType(A.MxJigCmdManager.DynamicInputType.kXYCoordInput),C&&Y.disableAllTrace());var G=new P.McEdGetPointWorldDrawObject;G.setDraw(function(T,B){var D=new c.Vector3(E.x,T.y,T.z),N=new c.Vector3(T.x,E.y,T.z),I=[];I.push(E),I.push(D),I.push(T),I.push(N),I.push(E);var h=null,u=65280,v=B.getMcEdJig().getMxObject().automaticInversionColor(16777215);if(k){if(T.x>E.x)h=g.MxThreeJS.createLines(I,v),u=255;else{var M=B.getMcEdJig().getMxObject().viewCoordLong2Cad(3);h=g.MxThreeJS.createDashedLines(I,v,2*M,M)}var j=[];j.push(E),j.push(D),j.push(T),j.push(E),j.push(T),j.push(N);var z=g.MxThreeJS.createTriangle(j,u,.27);B.drawEntity(z,30),B.drawEntity(h,31)}else h=g.MxThreeJS.createLines(I,v),B.drawEntity(h,31)}),Y.setUserDraw(G),Y.go(function(T){U&&U({status:T,detailedResult:Y.getDetailedResult()}),T!=0?S(null):(Y.clearLastInputPoint(),S(Y.value()))})})}},{"./MxThreeJS":37,"./Operate/MrxDbgUiPrBase":45,"./Operate/MrxDbgUiPrPoint":47,"./Operate/MxEntSelJig":50,"./Operate/MxJigCmdManager":54,"./UI/MxUiVue":65,three:19}],21:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawCommands=void 0;var a,m=b("./MxFun"),c=b("./MxType"),x=b("./Operate/MxIntelliSelect"),A=b("./Operate/MxJigCmdManager");function H(k){k!=null&&k.grips!=null&&k.ids!=null&&m.MxFun.getCurrentMx().getMcObject().getGripManager().gripEditImp(k)}function F(k){if(k!=null&&k.pt!=null){var U=!1;k.shiftKey&&(U=k.shiftKey);var C=m.MxFun.getCurrentMx(),S=k.pt;if(!C.getMxDatabase().getGripManager().doPointSelect(S,U)){var Y=!0;if(C.isValidMcObject()&&C.getMcObject().getGripManager().doPointSelect(S,U)&&(Y=!1),m.MxFun.isPC()||(Y=!1),Y&&C.isMultipleSelect){var G=C.screenCoord2Current(S.x,S.y,0),T=new x.MxIntelliSelectJig(G,U);T.setDisableDynInput(!0),T.setDisableOsnap(!0),A.MxJigCmdManager.runCmd(T)}}}}function P(k){k!=null&&k.grips!=null&&k.ents!=null&&m.MxFun.getCurrentMx().getMxDatabase().getGripManager().gripEditImp(k)}function g(){m.MxFun.getCurrentMx().getMcObject().undo()}function E(){m.MxFun.getCurrentMx().getMcObject().redo()}function _(){m.MxFun.getCurrentMx().startPanCommand()}(a||(o.MxDrawCommands=a={})).registerCommand=function(){m.MxFun.addCommand("Mx_FrontEndWebpageIntelliSel",F,c.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|c.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER|c.MxType.MxCommandFlag.MCRX_JIG_CMD_END_NO_CLEAR_SELECT|c.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|c.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),m.MxFun.addCommand("Mx_FrontEndWebpageGripEdit",P,c.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|c.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER|c.MxType.MxCommandFlag.MCRX_JIG_CMD_END_NO_CLEAR_SELECT|c.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT_GRIP_POINT|c.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|c.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),m.MxFun.addCommand("McDraw_GripEdit",H,c.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT|c.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT_GRIP_POINT|c.MxType.MxCommandFlag.MCRX_JIG_CMD_END_NO_CLEAR_SELECT|c.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT|c.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD),m.MxFun.addCommand("Mx_Undo",g,c.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER),m.MxFun.addCommand("Mx_Redo",E,c.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER),m.MxFun.addCommand("Mx_Pan",_,c.MxType.MxCommandFlag.MCRX_CMD_NO_UNDO_MARKER)}},{"./MxFun":27,"./MxType":39,"./Operate/MxIntelliSelect":52,"./Operate/MxJigCmdManager":54}],22:[function(b,n,o){var a,m;Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawData=void 0,(m=a||(o.MxDrawData=a={})).m_dInputRectWidth=16,m.m_isEnableIntelliSelect=!0,m.m_isEnableGripEidt=1,m.m_isEnableCADEntityGripEidt=1,m.m_isForbiddenDynInput=!1,m.m_isMultipleSelect=!1,m.m_iIntelliSelectType=1,m.m_isAutoResetRenderer=!1,m.m_isCorrectLargeCoordinates=!0,m.m_isRequestHeaderCacheControl=!1,m.m_gripPointColor=3355443455,m.m_isMapBox=!1,m.m_isEnableDrawingViewAngle=!0,m.m_isEnableCommandRightClickMenu=!1,m.m_isMobileCommandOperationSupportsMultipoint=!0,m.m_dynamicInputLineColor=8421504,m.getIniSet=function(){return{EnableIntelliSelect:m.m_isEnableIntelliSelect,EnableGripEidt:m.m_isEnableGripEidt,EnableCADEntityGripEidt:m.m_isEnableCADEntityGripEidt,ForbiddenDynInput:m.m_isForbiddenDynInput,EnableDrawingViewAngle:m.m_isEnableDrawingViewAngle,gripPointColor:m.m_gripPointColor,multipleSelect:m.m_isMultipleSelect,EnableCommandRightClickMenu:m.m_isEnableCommandRightClickMenu}},m.setIniset=function(c){c.EnableIntelliSelect!==void 0&&typeof c.EnableIntelliSelect=="boolean"&&(m.m_isEnableIntelliSelect=c.EnableIntelliSelect),c.EnableGripEidt!==void 0&&typeof c.EnableGripEidt=="boolean"&&(m.m_isEnableGripEidt=c.EnableGripEidt?1:0),c.EnableGripEdit!==void 0&&(typeof c.EnableGripEdit=="boolean"?m.m_isEnableGripEidt=c.EnableGripEdit?1:0:typeof c.EnableGripEdit=="number"&&(m.m_isEnableGripEidt=c.EnableGripEdit)),c.EnableCADEntityGripEidt!==void 0&&typeof c.EnableCADEntityGripEidt=="number"&&(m.m_isEnableCADEntityGripEidt=c.EnableCADEntityGripEidt),c.EnableCADEntityGripEdit!==void 0&&typeof c.EnableCADEntityGripEdit=="number"&&(m.m_isEnableCADEntityGripEidt=c.EnableCADEntityGripEdit),c.ForbiddenDynInput!==void 0&&typeof c.ForbiddenDynInput=="boolean"&&(m.m_isForbiddenDynInput=c.ForbiddenDynInput),c.multipleSelect!==void 0&&typeof c.multipleSelect=="boolean"&&(m.m_isMultipleSelect=c.multipleSelect),c.IntelliSelectType!==void 0&&typeof c.IntelliSelectType=="number"&&(m.m_iIntelliSelectType=c.IntelliSelectType),c.autoResetRenderer!==void 0&&typeof c.autoResetRenderer=="boolean"&&(m.m_isAutoResetRenderer=c.autoResetRenderer),c.correctLargeCoordinates!==void 0&&typeof c.correctLargeCoordinates=="boolean"&&(m.m_isCorrectLargeCoordinates=c.correctLargeCoordinates),c.requestHeaderCacheControl!==void 0&&typeof c.requestHeaderCacheControl=="boolean"&&(m.m_isRequestHeaderCacheControl=c.requestHeaderCacheControl),c.MapBox!==void 0&&typeof c.MapBox=="boolean"&&(m.m_isMapBox=c.MapBox),c.inputRectWidth!==void 0&&typeof c.inputRectWidth=="number"&&(m.m_dInputRectWidth=c.inputRectWidth),c.gripPointColor!==void 0&&typeof c.gripPointColor=="number"&&(m.m_gripPointColor=c.gripPointColor),c.EnableDrawingViewAngle!==void 0&&typeof c.EnableDrawingViewAngle=="boolean"&&(m.m_isEnableDrawingViewAngle=c.EnableDrawingViewAngle),c.EnableCommandRightClickMenu!==void 0&&typeof c.EnableCommandRightClickMenu=="boolean"&&(m.m_isEnableCommandRightClickMenu=c.EnableCommandRightClickMenu),c.MobileCommandOperationSupportsMultipoint!==void 0&&typeof c.MobileCommandOperationSupportsMultipoint=="boolean"&&(m.m_isMobileCommandOperationSupportsMultipoint=c.MobileCommandOperationSupportsMultipoint),c.dynamicInputLineColor!==void 0&&typeof c.dynamicInputLineColor=="number"&&(m.m_dynamicInputLineColor=c.dynamicInputLineColor)}},{}],23:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObject=o.IniSetName=o.MxRunMode=void 0;var a,m,c,x=b("three"),A=b("./MxFun"),H=b("./View/MxBrowseLayerData"),F=b("./View/MxBrowseDisplay"),P=b("./MxNetData"),g=b("./MxNetData"),E=b("./MxManager"),_=b("./MxSystemVariable"),k=b("./MxLocalFileLoad"),U=b("./Operate/MxDrawObjectOsnap"),C=b("./View/MxDbDatabase"),S=b("./View/MxDrawMapBox"),Y=b("./MxDrawObjectEvent"),G=b("./View/MxDbEntityGrip"),T=b("./cpp/McDrawObject"),B=b("./UI/MxUiVue"),D=b("./MxDrawData"),N=b("./MxTempMarkDraw");(m=a||(o.MxRunMode=a={}))[m.kBrowse=1]="kBrowse",m[m.kCPPMxCAD=4]="kCPPMxCAD",(c||(o.IniSetName=c={})).kEnableOsnapFunction="EnableOsnapFunction";var I=(h.prototype.getCurrentMousePostion=function(){return this.curMousePostion},h.prototype.isValidCurMousePostion=function(){return this.m_isValidCurMousePostion},h.prototype.setCurrentMousePostion=function(u,v){if(v===void 0&&(v=!1),v){if(0<u.touches.length){var M=u.target.getBoundingClientRect();this.curMousePostion.x=u.touches[0].clientX-M.left,this.curMousePostion.y=u.touches[0].clientY-M.top,this.m_isValidCurMousePostion=!0}}else this.curMousePostion.x=u.offsetX,this.curMousePostion.y=u.offsetY,this.m_isValidCurMousePostion=!0},h.prototype.mapBoxRender=function(u,v,M){this.mcObject.updateDisplayMapBox(v),M||(this.camera.projectionMatrix=v,this.renderer.autoClear=!1,this.renderer.state.reset(),this.secenView&&this.renderer.render(this.secenView,this.cameraView),this.renderer.render(this.scene,this.camera),this._callCreateCanvasImageData!=null&&(this._callCreateCanvasImageData_param&&this._callCreateCanvasImageData_param.type=="image/bmp"?this._callCreateCanvasImageData(void 0):this._callCreateCanvasImageData(this.renderer.domElement.toDataURL("image/png")),this._callCreateCanvasImageData=void 0,this._callCreateCanvasImageData_param=void 0)),this.callEvent("render",this.renderer)},h.prototype.mapBoxInitThreeJSObject=function(u,v,M,j){this.scene=u,this.camera=v,this.renderer=M,this.controls=j},h.prototype.getMxDrawThreeJs=function(){return this.mxdrawThreeJS},h.prototype.setPointMultipleSelect=function(u){this.isPointMultipleSelect=u},h.prototype.pointMultipleSelect=function(){return this.isPointMultipleSelect},h.prototype.getMcObject=function(){return this.mcObject},h.prototype.is3DMode=function(){return this.mcObject.mxdraw3d.is3DMode()},h.prototype.getSysVarLong=function(u){return this.mcObject.isValid()?this.mcObject.getSysVarLong(u):this.m_sysVariable.getSysVarNumber(u)},h.prototype.getSysVarDouble=function(u){return this.mcObject.isValid()?this.mcObject.getSysVarDouble(u):this.m_sysVariable.getSysVarNumber(u)},h.prototype.getSysVarPoint=function(u){return this.mcObject.isValid()?this.mcObject.getSysVarPoint(u):this.m_sysVariable.getSysVarPoint(u)},h.prototype.getCAD2DocMatrix=function(){return this._cad2Doc},h.prototype.isValidMcObject=function(){return this.mcObject.isValid()},h.prototype.getId=function(){return this.id},h.prototype.getEventManager=function(){return this.eventManager},h.prototype.setCurrentLoadUrl=function(u){this._sCurrentLoadURL=u},h.prototype.getCurrentLoadUrl=function(){return this._sCurrentLoadURL},h.prototype.isWebgl2=function(){return!(!this._rendererParam||this._rendererParam.retver!="webgl2")},h.prototype.getMxDatabase=function(){return this.m_mxDatabase},h.prototype.updateCanvasSize=function(){this._onResizeFun&&this._onResizeFun(void 0,!1)},h.prototype.addMxEntity=function(u){return this.m_mxDatabase.addMxEntity(u)},h.prototype.getMxEntity=function(u){return this.m_mxDatabase.getEntity(u)},h.prototype.getMxEntityUserObject=function(u){var v=this.getMxEntity(u);return v?v.getUserObject():null},h.prototype.eraseAllMxEntity=function(){this.m_mxDatabase.eraseAllEntity()},h.prototype.eraseMxEntity=function(u){var v=this.m_mxDatabase.getEntity(u);return!!v&&v.erase()},h.prototype.getAllMxEntity=function(){var u=[];return this.m_mxDatabase.getAllEntity().forEach(function(v){v&&u.push(v.getUserObject())}),u},h.prototype.getMxAllSelect=function(){var u=this.m_mxDatabase.getSelectManager().getAllSelect(),v=this.m_mxDatabase.getGripManager().getAllSelect(),M=new Set;return u.forEach(function(j){M.add(j)}),v.forEach(function(j){M.has(j)||u.push(j)}),u},h.prototype.getPrvCommandSelect=function(){return this.m_mxDatabase.getSelectManager().getPrvCommandSelect()},h.prototype.getMxCADAllSelect=function(){return this.mcObject.isValid()?this.mcObject.getGripManager().getAllSelect():[]},h.prototype.getSelectPoints=function(){return this.mcObject.getGripManager().getSelectPoints()},h.prototype.getPrvCommandMxCADSelect=function(){return this.mcObject.isValid()?this.mcObject.getGripManager().getPrvCommandSelect():[]},h.prototype.addMxCurrentSelect=function(u,v,M){return v===void 0&&(v=!0),M===void 0&&(M=!0),this.m_mxDatabase.getGripManager().addSelect(u,v,M)},h.prototype.addMxCADCurrentSelect=function(u,v,M){return v===void 0&&(v=!0),M===void 0&&(M=!0),!!this.mcObject.isValid()&&this.mcObject.getGripManager().addSelect(u,v,M)},h.prototype.fireSelectChange=function(u){if(u){if(this.mcObject.isValid())return this.mcObject.getGripManager().fireSelectChange()}else this.m_mxDatabase.getGripManager().fireMxEntitySelectChange()},h.prototype.clearMxCurrentSelect=function(){var u=this.m_mxDatabase.clearMxCurrentSelect();return this.mcObject.isValid()&&this.mcObject.getGripManager().clearAll(),u},h.prototype.addViewObject=function(u){this.secenView?this.threejsselectObjectsView.add(u):console.log("this.secenView is null")},h.prototype.removeViewObject=function(u){A.MxFun.removeThreejsObject(u,this.threejsselectObjectsView)},h.prototype.setOtherRefFile=function(u){this._tzDwgStaticFile=u},h.prototype.setRequestHeader=function(u){this._requestHeader=u},h.prototype.initZoomW=function(u,v){this._initZoomwCoordPt1=u.clone(),this._initZoomWCoordPt2=v.clone()},h.prototype.setMouseRightRotate=function(u){this._mouseRightRotate=u,this.controls!=null&&(this.controls.mouseButtons.RIGHT=u?x.MOUSE.ROTATE:-1)},h.prototype.setZoomSpeed=function(u){var v=this.controls.zoomSpeed;return this.controls.zoomSpeed=u,v},h.prototype.resetRenderer=function(){this.renderer.info.reset()},h.prototype.getRenderer=function(){return this.renderer},h.prototype.isPaningCommand_call=function(){return this.bakControls!=null},h.prototype.startPanCommand_call=function(){this.bakControls={},this.bakControls.LEFT=this.controls.mouseButtons.LEFT,this.bakControls.RIGHT=this.controls.mouseButtons.RIGHT,this.bakControls.MIDDLE=this.controls.mouseButtons.MIDDLE,this.controls.mouseButtons.LEFT=x.MOUSE.PAN,this._mouseRightRotate?this.controls.mouseButtons.RIGHT=x.MOUSE.ROTATE:this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=1,B.MxUiVue.setCursorType(B.MxUiVue.CursorType.kPan)},h.prototype.endPanCommand_call=function(){this.bakControls&&(this.controls.mouseButtons.LEFT=this.bakControls.LEFT,this.controls.mouseButtons.RIGHT=this.bakControls.RIGHT,this.controls.mouseButtons.MIDDLE=this.bakControls.MIDDLE,this.bakControls=void 0,B.MxUiVue.setCursorType(B.MxUiVue.CursorType.kNormal))},h.prototype.isPaningCommand=function(){return this.mxdrawThreeJS.isPaningCommand()},h.prototype.startPanCommand=function(){this.mxdrawThreeJS.startPanCommand()},h.prototype.endPanCommand=function(){this.mxdrawThreeJS.endPanCommand()},h.prototype.setMouseMiddlePan=function(u){this._isMouseMiddlePan=typeof u=="boolean"?u?1:0:u,this.controls!=null&&(this._isMouseMiddlePan==1?(this.controls.mouseButtons.LEFT=-1,this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=x.MOUSE.PAN):this._isMouseMiddlePan==2?(this.controls.mouseButtons.LEFT=x.MOUSE.PAN,this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=x.MOUSE.PAN):(this.controls.mouseButtons.LEFT=x.MOUSE.PAN,this._mouseRightRotate?this.controls.mouseButtons.RIGHT=x.MOUSE.ROTATE:this.controls.mouseButtons.RIGHT=-1,this.controls.mouseButtons.MIDDLE=1))},h.prototype.resetThreeJSControls=function(){this.controls&&(this.controls.saveState(),this.controls.reset())},h.prototype.enableZoom=function(u){this.controls!=null&&(this.controls.enableZoom=u)},h.prototype.enablePan=function(u){this.controls!=null&&(this.controls.enablePan=u)},h.prototype.getOrbitControls=function(){return this.controls},h.prototype.enableViewControls=function(u){this.controls.enabled=u},h.prototype.initRunMode=function(u){this._isCreate?console.log("iniRunMode failed,mxobject already created"):this._runMode=u},h.prototype.getRunMode=function(){return this._runMode},h.prototype.setStaticLocalLoad=function(u){this._isStaticLocalLoad=u},h.prototype.isStaticLocalLoad=function(){return this._isStaticLocalLoad},h.prototype.setStaticLocalLoadPath=function(u){this._staticLocalLoadPath=u},h.prototype.on=function(u,v){if(this._event[u])if(this._event[u]instanceof Array){var M=this._event[u];M.includes(v)||M.push(v)}else{var j=this._event[u];if(j==v)return;this._event[u]=[],this._event[u].push(j),this._event[u].push(v)}else this._event[u]=v},h.prototype.addEvent=function(u,v){this.on(u,v)},h.prototype.addControlsEvent=function(u,v,M){return M===void 0&&(M=!1),this.eventManager.addEventListener(u,v,M)},h.prototype.removeEvent=function(u){this._event[u]=void 0},h.prototype.removeEventFuction=function(u,v){if(this._event[u]){if(this._event[u]instanceof Array){var M=this._event[u].indexOf(v);if(M!=-1)return this._event[u].splice(M,1),this._event[u].length==0&&delete this._event[u],!0}else if(this._event[u]==v)return delete this._event[u],!0}return!1},h.prototype.sysVariable=function(){return this.m_sysVariable},h.prototype.setIniset=function(u){var v=this;Object.keys(u).forEach(function(M){v.m_iniSet[M]=u[M]}),D.MxDrawData.setIniset(u),u.multipleSelect!==void 0&&typeof u.multipleSelect=="boolean"&&(this.isMultipleSelect=u.multipleSelect),u.IntelliSelectType!==void 0&&typeof u.IntelliSelectType=="number"&&(u.IntelliSelectType==1?this.isPointMultipleSelect=!1:u.IntelliSelectType==2&&(this.isPointMultipleSelect=!0))},h.prototype.getInisetValue=function(u){return this.m_iniSet[u]},h.prototype.getViewColor=function(){return this._viewcolor},h.prototype.isWhiteViewColor=function(){return this.mcObject.isPaperSpaceDisplay()?this.mcObject.getLayoutBkColor()!=0:this._viewcolor==16777215},h.prototype.initUserLoginData=function(u,v){this._userIdentitySign=u,this._userRandomToken=v},h.prototype.initRendererParam=function(u){this._rendererParam=u},h.prototype.getRendererParam=function(){return this._rendererParam},h.prototype.automaticInversionColor=function(u){return this._viewcolor!=16777215||u!=16777215?u:0},h.prototype.automaticInversionColor2=function(u){return this._viewcolor==16777215&&(16777215&u)==16777215?4278190080&u:u},h.prototype.setViewColor=function(u){this._viewcolor=u,this._runMode!=a.kCPPMxCAD&&this.scene!=null&&(this.scene.background=new x.Color(u))},h.prototype.zoomScale=function(u,v){this.mxdrawThreeJS.zoomScale(u,v)},h.prototype.setViewAngle=function(u){this.mxdrawThreeJS.setViewAngle(u)},h.prototype.zoomW=function(u,v,M,j,z){z===void 0&&(z=!1),this.mxdrawThreeJS.zoomW(u,v,M,j,z)},h.prototype.zoomCenter=function(u,v,M){this.mxdrawThreeJS.zoomCenter(u,v,M)},h.prototype.getViewAngle=function(){return this._viewangle},h.prototype.callInitCompleteEvent=function(){this.callEvent("loadComplete")},h.prototype.callInitObjectEvent=function(){this.callEvent("initObject")},h.prototype.callInitSceneEvent=function(u,v,M){var j=this._event.initScene;if(!j)return 0;if(j instanceof Array){var z=0;return j.forEach(function(J){z=J(u,v,M)}),z}return j(u,v,M)},h.prototype.callOpenFileComplete=function(u,v){v===void 0&&(v=0);try{var M=this._event.openFileComplete;if(!M)return;M instanceof Array?M.forEach(function(j){j(u,v)}):M(u,v)}catch(j){throw console.log(j),j}},h.prototype.hasEvent=function(u){return this._event[u]!=null},h.prototype.regenAllMxDbEntity=function(){return this.m_mxDatabase.regenAllMxDbEntity()},h.prototype.callEvent=function(u,v){try{var M=this._event[u];if(!M)return!1;if(M instanceof Array){var j=!1;return M.forEach(function(z){j=z(v)}),j}return M(v)}catch(z){throw console.log(z),z}},h.prototype.callViewChange=function(){this.onViewChange(),this.callEvent("viewchange")},h.prototype.userLoginResult=function(u){this.callEvent("userLoginResult",u)},h.prototype.serverReturn=function(u){var v=JSON.parse(u);this.callEvent("serverReturn",v)},h.prototype.openFileResult=function(u){JSON.parse(u).linkServer||console.log("link mx serverobj error"),this.callEvent("openFileResult",u)},h.prototype.xzSize=function(u){var v=this._devicePixelRatio;if(v-1<=1e-4&&-1e-4<=v-1)return u;for(var M=9999999,j=u,z=0,J=u;z<100;z++){if((X=(te=J*v)-Math.floor(te))<=.001)return J;X<M&&(M=X,j=J),J+=1}for(J=u;z<100;z++){var te,X;if((X=(te=J*v)-Math.floor(te))<=.001)return J;X<M&&(M=X,j=J),--J}return j},h.prototype.setSize=function(u,v){this._viewWidth=u,this._viewHeight=v,this._userCanvas!=null&&(this._userCanvas.width=u,this._userCanvas.height=v,this._userCanvas.style.width=u+"px",this._userCanvas.style.height=v+"px"),this.onResizeImp(),this.updateDisplay()},h.prototype.getCurrentColor=function(){return this._color},h.prototype.setCurrentColor=function(u){this._color=u},h.prototype.call=function(u,v,M){this._net.getSend().CallServerJS(u,v,M)},h.prototype.zoomAll=function(){this._is2d&&this.call("getDatabaseBoundHelp",'{"isBackground":1}',function(u){if(u.length!=0){var v=JSON.parse(u);this.zoomW(new x.Vector3(v[0],v[1],0),new x.Vector3(v[2],v[3],0))}})},h.prototype.getViewCenterDocCoord=function(){return this._userCanvas!=null?this.screenCoord2Current(.5*this._userCanvas.clientWidth,.5*this._userCanvas.clientHeight,0):this.screenCoord2Current(.5*this._viewWidth,.5*this._viewHeight,0)},h.prototype.closeWebSocket=function(){this._net.closeWebSocket()},h.prototype.findMxEntityAtPoint=function(u,v,M){!v&&v!==void 0||(u=this.currentCoord2Screen(u.x,u.y,0));var j=[],z=this.m_mxDatabase.getIntersectObjects(u);if(z.length==0)return j;var J=new Map;return z.forEach(function(te){var X=(0,G.MxGetMxDbEntitForThreeJsObject)(te.object);if(X){var se=X.objectId();if(!J.has(se)){if(M){var ve=(0,G.MxGetWordDrawxDataForThreeJsObject)(te.object);ve&&M(se,ve)}J.set(se,X.getUserObject())}}}),J.forEach(function(te){j.push(te)}),j},h.prototype.isCppMxCAD=function(){return this._runMode==a.kCPPMxCAD},h.prototype.loadMxCADImage=function(u,v,M){var j=this;M===void 0&&(M=""),this.mcObject.isValid()?(M.length==0&&(M=u).lastIndexOf("/")!=-1&&(M=M.substring(M.lastIndexOf("/")+1).toLowerCase()),this.mcObject.getTextureManager().loadImage(u,M,function(z,J){z?(j.mcObject.getTextureManager().createOpenGLTexture(u),v(J)):v(void 0)})):v(void 0)},h.prototype.onLoad=function(u){if(this._runMode==a.kCPPMxCAD)this.callInitCompleteEvent();else if(this._isStaticLocalLoad)this._net=new g.MxNet,this._net.init(this,!1),0<this._openFile.length&&(this._staticLocalNet=new k.MxLocalDwgFileLoad(this._net),this._staticLocalNet.load(encodeURIComponent(this._staticLocalLoadPath),encodeURIComponent(this._openFile)));else if(this._openFile.length==0)this.callInitCompleteEvent(),this.callOpenFileComplete(0);else if(this._net=new g.MxNet,this._net.init(this,!1),this._staticNet=new g.MxHFileLoad(this._net),this._staticNet.setRequestHeader(this._requestHeader),this._staticNet.setUrlParam(u),this._staticNet.load(this._openFile,this._staticLoadingOpenFiles),this._tzDwgStaticFile&&0<this._tzDwgStaticFile.length){var v=new g.MxNet;v.init(this,!1),this._extRefManager.createTzDwgExternalReferences(99999),v.setCurrentDatabaseId(99999),this._staticLoadTzNet=new g.MxHFileLoad(v),this._staticLoadTzNet.setShowloading(!1),this._staticLoadTzNet.setRequestHeader(this._requestHeader),this._staticLoadTzNet.load(this._tzDwgStaticFile,[])}},h.prototype.stopAllLoading=function(){this._staticNet&&this._staticNet.stopAllLoading()},h.prototype.getStaticNet=function(){return this._staticNet},h.prototype.isStaticFileNet=function(){return!this._isStaticLocalLoad&&this._staticNet!=null},h.prototype.getStaticLocalNet=function(){return this._staticLocalNet},h.prototype.getStaticLoadTzNet=function(){return this._staticLoadTzNet},h.prototype.getViewWidth=function(){return this._userCanvas!=null?this._userCanvas.clientWidth:this._viewWidth},h.prototype.getViewHeight=function(){return this._userCanvas!=null?this._userCanvas.clientHeight:this._viewHeight},h.prototype.makeCurrent=function(){E.MxManager.setCurrentMx(this),this.mcObject.makeCurrent()},h.prototype.createCanvasImageData=function(u,v){if(this.isMapBox())this._callCreateCanvasImageData_param=v,this._callCreateCanvasImageData=function(se){u(se)},this.updateDisplay();else{var M=0,j=0,z=!1,J=!1,te=!1;v&&v.range_pt1&&v.range_pt2&&(te=J=!0,this.saveZoom()),v&&v.width&&v.height&&(M=this.getViewWidth(),j=this.getViewHeight(),z=!0,this.setSize(v.width,v.height)),te&&this.zoomW(v.range_pt1,v.range_pt2),this._callCreateCanvasImageData_param=v;var X=this;this._callCreateCanvasImageData=function(se){u(se),z&&X.setSize(M,j),J&&X.recoverZoom()},this.updateDisplay()}},h.prototype.getIntersectObjects=function(u){return this.getMxDrawThreeJs().createRaycaster(u).intersectObjects(this.threejsselectObjects.children,!0)},h.prototype.addObject=function(u){this.threejsselectObjects.add(u)},h.prototype.removeObject=function(u){this.threejsselectObjects.remove(u)},h.prototype.render=function(){this.secenView?(this.mcObject.updateDisplay()?(this.renderer.autoClear=!1,this.renderer.state.reset()):this.renderer.autoClear=!0,this.renderer.render(this.secenView,this.cameraView),this.renderer.autoClear=!1):this.mcObject.updateDisplay()?(this.renderer.autoClear=!1,this.renderer.state.reset()):this.renderer.autoClear=!0,this.renderer.render(this.scene,this.camera),this._callCreateCanvasImageData!=null&&(this._callCreateCanvasImageData_param&&this._callCreateCanvasImageData_param.type=="image/bmp"?this._callCreateCanvasImageData(void 0):this._callCreateCanvasImageData(this.renderer.domElement.toDataURL("image/png")),this._callCreateCanvasImageData=void 0,this._callCreateCanvasImageData_param=void 0),this.callEvent("render",this.renderer)},h.prototype.updateDisplay=function(u){u===void 0&&(u=!1),this.mxdrawThreeJS.updateDisplay(u)},h.prototype.isRenderLoop=function(){return this._isAnimation},h.prototype.renderLoop=function(u){u===void 0&&(u=!0),this._isAnimation=u,this.updateDisplay()},h.prototype.updateDisplayImplement=function(u){u===void 0&&(u=!1);var v=this,M=function(){v.m_mxDatabase.upDirtyDisplay(),v._isAnimation?(v._isAnimationStarting=!0,requestAnimationFrame(M)):v._isWaiteCount=0,v.render()};u!==!0?this._isAnimationStarting||(this._isAnimation?requestAnimationFrame(M):((5<this._isWaiteCount||this._isWaiteCount<0)&&(this._isWaiteCount=0),this._isWaiteCount<=0&&requestAnimationFrame(M),this._isWaiteCount++)):M()},h.prototype.gotoLayoutOld=function(u){u=="Modle"&&(u="");var v=this._openFile;for(var M in this._iniParam)(te=(J=this._iniParam[M])[0])=="srcname"&&(v=J[1]);var j={},z="";for(var M in this._iniParam){var J,te;if(j[te=(J=this._iniParam[M])[0]]==null){j[te]=!0;var X=J[1];if(te=="file"){if(X=v,0<u.length){var se=X.substring(X.lastIndexOf(".")+1);X=X.substring(0,X.lastIndexOf("."))+"%23"+u+"%23."+se}}else if(te=="srcname")continue;z.length==0?z=te+"="+X+"&srcname="+v:z+="&"+te+"="+X}}var ve=A.MxFun.getLocationPageUrl()+"?"+z;window.location.href=ve},h.prototype.gotoLayout=function(u){var v=!1,M=!this.isStaticFileNet();for(var j in this._iniParam)if((ve=this._iniParam[j])[0]=="dwgdir"){v=!0;break}if(v||M)this.gotoLayoutOld(u);else{u=="Model"&&(u="");var z=this._openFile;if(!z)return;var J=z.lastIndexOf(".dwg");if(J===void 0||J===-1)return;if((z=z.substring(0,J))[z.length-1]=="#"){var te=z.substring(0,z.length-1),X=te.lastIndexOf("#");X!==void 0&&X!==-1&&(z=te.substring(0,X))}0<u.length?z=z+"#"+u+"#.dwg.mxb1.wgh":z+=".dwg.mxb1.wgh";var se={};for(var j in this._iniParam){var ve,Ee=(ve=this._iniParam[j])[0];if(se[Ee]==null){se[Ee]=!0;var we=ve[1];Ee!="file"&&Ee!="srcname"&&(z+="&"+Ee+"="+we)}}var Be=A.MxFun.getLocationPageUrl()+"?file="+z;window.location.href=encodeURI(Be)}},h.prototype.addInitParam=function(u,v){var M=new Array;M.push(u),M.push(v),this._iniParam.push(M)},h.prototype.openFile=function(u,v){if(v===void 0&&(v=""),!this._isCreate)return console.log("mx: openFile Fialed mxasser(_isCreate == false)"),!1;if(this.stopAllLoading(),u.length==0)return!1;this.reInit(),this._devicePixelRatio=window.devicePixelRatio,u instanceof Array?(this._openFile=u[0],this._staticLoadingOpenFiles=u):this._openFile=u,this._openFileExtName=this._openFile.substring(this._openFile.lastIndexOf(".")+1),this._iniParam=[],this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null;var M=new Array;return M.push("file"),M.push(this._openFile),this._iniParam.push(M),this.onLoad(v),!0},h.prototype.updateCameraDisplayRange=function(u,v,M){this.mxdrawThreeJS.updateCameraDisplayRange(u,v,M)},h.prototype.updateCameraForm3dViewData=function(u){this.mxdrawThreeJS.updateCameraForm3dViewData(u)},h.prototype.clearAllObject=function(){this.reInit()},h.prototype.newFile=function(u,v,M,j){if(!this._isCreate)return console.log("mx: openFile Fialed mxasser(_isCreate == false)"),!1;var z,J;if(J=u instanceof Object&&v instanceof Object?(z=u,v):(z=new x.Vector3(u,v,0),new x.Vector3(M,j,0)),z.x>J.x){var te=z.x;z.x=J.x,J.x=te}if(z.y>J.y){var X=z.y;z.y=J.y,J.y=X}this.reInit(),this._devicePixelRatio=window.devicePixelRatio,this._openFile="",this._openFileExtName="dwg",this._iniParam=[],this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null;var se=new x.Matrix4;se.identity(),this.intiDoc2Wold(se),this.initCAD2Doc(se),this.initializingObjectMatrix(),this.mxdrawThreeJS.updateCameraDisplayRange(z,J,0),this.updateDisplay(!0);var ve=A.MxFun.getUiObj();ve!=null&&(ve.SetLayoutData(this._allLayoutName),ve.UpDisplayLayout())},h.prototype.calcViewsize=function(){if(this._userCanvas==null)return{viewWidth:window.innerWidth,viewHeight:window.innerHeight};var u=this._userCanvas.clientWidth,v=this._userCanvas.clientHeight;if(this._event.onResize!=null){var M=this._event.onResize;M instanceof Array&&(M=M[0]);var j=M();j!=null&&(u=parseInt(j.width),v=parseInt(j.height))}return{viewWidth:u,viewHeight:v}},h.prototype.initMxCpp=function(u){u&&u.getImp()?(this.mcObject.init(this,u),this.secenView!=null?this.secenView.background=null:this.scene.background=null):console.log("mxerror: mcppObjectImp is null")},h.prototype.create=function(u,v,M,j){if(this._is2d?j?(this.mxdrawThreeJS=new S.MxDrawMapBoxThreeJS(j,this),D.MxDrawData.m_isMapBox=!0,this._viewcolor=16777215):this.mxdrawThreeJS=new S.MxDrawObject2dThreeJS(this):this.mxdrawThreeJS=new S.MxDrawObject3dThreeJS(this),this._callCreateCanvasImageData=void 0,this._callCreateCanvasImageData_param=void 0,this._devicePixelRatio=window.devicePixelRatio,this._runMode==a.kCPPMxCAD)this._openFile="";else{if(v instanceof Array?(this._openFile=v[0],this._staticLoadingOpenFiles=v):this._openFile=v,this._iniParam=A.MxFun.getUrlParams(),this._openFileExtName=this._openFile.substring(this._openFile.lastIndexOf(".")+1),this._openFile!=""){var z=new Array;z.push("file"),z.push(this._openFile),this._iniParam.push(z)}this._userIdentitySign!=""&&(this.addInitParam("userIdentitySign",this._userIdentitySign),this.addInitParam("userRandomToken",this._userRandomToken)),this.addInitParam("runMode","browse")}this._userCanvas=u;var J=window.innerWidth,te=window.innerHeight;if(u!=null&&(J=u.clientWidth,te=u.clientHeight),this._viewWidth=J,this._viewHeight=te,this.m_mxDatabase.getSelectManager().setCanvasSize(J,te),this.mxdrawThreeJS.onInitThreejs(),this.eventManager.registEvent(this),this.onCreate(),this.m_mxDatabase.init(this),this._parentDocObject=new x.Object3D,this.scene.add(this._parentDocObject),this._parentDocObject_SmallCoord=new x.Object3D,this.scene.add(this._parentDocObject_SmallCoord),this._parentDocObject_SmallCoord_JigDraw=new x.Object3D,this._parentDocObject_SmallCoord.add(this._parentDocObject_SmallCoord_JigDraw),this.threejsselectObjects=new x.Object3D,this.scene.add(this.threejsselectObjects),this._objectsOsnap=new U.MxDrawObjectOsnap(this),this.tempMarkDraw.init(this),E.MxManager.add(this),E.MxManager.setCurrentMx(this),this.mxdrawThreeJS.addControlsChangeEvent(),j||this.updateDisplay(),this.mxdrawThreeJS.getType()!=S.MxThreeJSType.kMapBox){var X=this;if(u==null){var se=function(le,Re){Re===void 0&&(Re=!0),X._viewWidth=window.innerWidth,X._viewHeight=window.innerHeight,X.onResizeImp()&&X.updateDisplay(Re)};window.addEventListener("resize",se,!1),this._onResizeFun=se}else{var ve=function(le,Re){Re===void 0&&(Re=!0),le&&le.viewWidth&&le.viewHeight||(le=X.calcViewsize()),X._viewWidth=le.viewWidth,X._viewHeight=le.viewHeight,X.onResizeImp(X._viewWidth,X._viewHeight)&&X.updateDisplay(Re)};if(this._onResizeFun=ve,this._event.addResizeEvent!=null){var Ee=this._event.addResizeEvent;Ee instanceof Array&&(Ee=Ee[0]),Ee(ve,u)}else window.addEventListener("resize",ve,!1);if(window.setTimeout(function(){ve(void 0,!1)},5),this._event.onResize!=null){var we=X.calcViewsize();ve(we,!1);var Be=0,re=0,fe=!0,ne=window.setInterval(function(){re++;var le=X.calcViewsize();if(le.viewWidth==we.viewWidth&&le.viewHeight==we.viewHeight&&0<le.viewWidth&&0<le.viewHeight){if(8<++Be)return clearInterval(ne),void ve(le,!1);1<=Be&&fe&&(ve(le,!1),2<=Be&&(fe=!1))}else Be=0;we=le,50<re&&(clearInterval(ne),0<le.viewWidth&&0<le.viewHeight?ve(le,!1):console.log("mxassert(0) error view size"))},50)}}}this.callInitObjectEvent(),this.onLoad(M),this._isCreate=!0},h.prototype.initResize=function(){if(this._userCanvas==null)this._viewWidth=window.innerWidth,this._viewHeight=window.innerHeight,this.onResizeImp();else{if(this._viewWidth=this._userCanvas.clientWidth,this._viewHeight=this._userCanvas.clientHeight,this._event.onResize!=null){var u=this._event.onResize;u instanceof Array&&(u=u[0]);var v=u();v!=null&&(this._viewWidth=v.width,this._viewHeight=v.height)}this.onResizeImp(this._viewWidth,this._viewHeight)}this.updateDisplay()},h.prototype.is2D=function(){return this._is2d},h.prototype.getOpenFile=function(){return this._openFile},h.prototype.getFileTitle=function(){var u=this._openFile;if(this._openFile.substring(this._openFile.lastIndexOf(".")+1).toLowerCase()=="wgh"){var v=this._openFile.substring(0,this._openFile.indexOf(".mxb1.wgh")).split("/");(u=v.length==1?v[0]:v[v.length-1])[0]=="$"&&(u=u.substring(1))}return u},h.prototype.getIniParam=function(){return this._iniParam},h.prototype.getOpenFileExtName=function(){return this._openFileExtName},h.prototype.loadCodeToServer=function(u,v){this._net.getSend().CallLoadCodeToServer(u,v)},h.prototype.userLogin=function(u,v){this._net.getSend().UserLogin(u,v)},h.prototype.getUserCanvas=function(){return this._userCanvas},h.prototype.getCanvas=function(){return this._userCanvas!=null?this._userCanvas:this.renderer.domElement},h.prototype.getScene=function(){return this.scene},h.prototype.getCamera=function(){return this.camera},h.prototype.callCommand=function(u,v,M){v===void 0&&(v=""),this._net.getSend().DoCommand(u,v,M)},h.prototype.deleteAll=function(){this.removeAllEntity(),this.callCommand("Mx_ClearAll"),this.updateDisplay()},h.prototype.initAllLayoutName=function(u){this._allLayoutName=u},h.prototype.getAllLayoutName=function(){return this._allLayoutName},h.prototype.updataClipMaterial=function(){this._blocks.updataClipMaterial(this)},h.prototype.getExtRefManager=function(){return this._extRefManager},h.prototype.showLayer=function(u,v){typeof u=="string"&&(u=this._layers.getLayerIdForName(u)),this._blocks.showLayer(u,v),this.updateDisplay()},h.prototype.addLayerInfo=function(u,v,M){v=this.automaticInversionColor(16777215&v),this._layers.add(u,v,M)},h.prototype.setZeroLayerId=function(u){this._layers.setZeroLayerId(u)},h.prototype.addLayerInfoComplete=function(){this._layers.initComplete()},h.prototype.addEntity=function(u,v){var M=this._mapId2Entity.get(u);M==null&&(M=new Array,this._mapId2Entity.set(u,M)),M.push(v)},h.prototype.getEntity=function(u){return this._mapId2Entity.get(u)},h.prototype.clearThreejsScence=function(){this.m_mxDatabase.getGripManager().reInit(),this.isValidMcObject()&&this.mcObject.getGripManager().reInit(),A.MxFun.removeThreejsObject(this.threejsselectObjects,this.scene),this.threejsselectObjects=new x.Object3D,A.MxFun.removeThreejsObject(this._parentDocObject,this.scene),this._parentDocObject=new x.Object3D,A.MxFun.removeThreejsObject(this._parentDocObject_SmallCoord,this.scene),this._parentDocObject_SmallCoord=new x.Object3D,this.scene.remove(),this.scene.dispose(),this.scene=new x.Scene,this.scene.add(this.threejsselectObjects),this.scene.add(this._parentDocObject),this.scene.add(this._parentDocObject_SmallCoord),this._parentDocObject_SmallCoord_JigDraw=new x.Object3D,this._parentDocObject_SmallCoord.add(this._parentDocObject_SmallCoord_JigDraw),this._objectsOsnap=new U.MxDrawObjectOsnap(this),this.m_mxDatabase.reInit(),this.tempMarkDraw.init(this),this.mxdrawThreeJS.onInitScene(),A.MxFun.removeThreejsObject(this.threejsselectObjectsView,this.secenView),this.threejsselectObjectsView=null,this.secenView.remove(),this.secenView.dispose(),this.secenView=null,this.onInitViewScene(),this._runMode!=a.kCPPMxCAD&&this.mxdrawThreeJS.getType()!=S.MxThreeJSType.kMapBox||(this.secenView!=null?this.secenView.background=null:this.scene.background=null)},h.prototype.reInit=function(){this.clearThreejsScence(),this._openFile="",this._openFileExtName="",this._mapId2Entity=new Map,this._setAdyDelete=new Map,this._layers=new H.MxBrowseLayerData,this._blocks=new F.Blocks,this._extRefManager=new F.ExternalReferenceManager,this._doc2World=new x.Matrix4,this._word2doc=new x.Matrix4,this._allLayoutName=new Array,this._tzDwgStaticFile="",this._devicePixelRatio=window.devicePixelRatio,this._blocks.initRootBlockRef()},h.prototype.removeEntity=function(u){if(this._setAdyDelete[u]==null){this._setAdyDelete[u]=!0;var v=this._mapId2Entity.get(u);if(v!=null){for(var M in v)this.scene.remove(v[M]);this._mapId2Entity.delete(u)}}},h.prototype.removeEntityFromServer=function(u){for(var v=u.getInt32(4,!0),M=0;M<v;M++){var j=u.getInt32(4*(M+20),!0);this.removeEntity(j)}},h.prototype.removeAllEntity=function(){var u=this;this._mapId2Entity.forEach(function(v,M,j){for(var z in v)u.scene.remove(v[z])}),this._mapId2Entity.clear()},h.prototype.mxWebAddEntity=function(u){this._setAdyDelete.clear();var v=this.mxWebAddEntity_3DChild(u);this.mxWebAddEntity_Curve(u,v),this._setAdyDelete.clear()},h.prototype.getViewWorldCoord=function(){var u=new x.Vector3(-1,-1,1);u.unproject(this.camera);var v=new x.Vector3(-1,1,1);v.unproject(this.camera);var M=new x.Vector3(1,1,1);M.unproject(this.camera);var j=new x.Vector3(1,-1,1);return j.unproject(this.camera),{pt1:u,pt2:v,pt3:M,pt4:j}},h.prototype.getViewDocCoord=function(){var u=this.getViewWorldCoord();return u.pt1=this.docCoord2Cad2(this.worldCoord2Doc(u.pt1.x,u.pt1.y,0)),u.pt2=this.docCoord2Cad2(this.worldCoord2Doc(u.pt2.x,u.pt2.y,0)),u.pt3=this.docCoord2Cad2(this.worldCoord2Doc(u.pt3.x,u.pt3.y,0)),u.pt4=this.docCoord2Cad2(this.worldCoord2Doc(u.pt4.x,u.pt4.y,0)),u},h.prototype.screenCoord2World=function(u,v,M){return this.mxdrawThreeJS.screenCoord2World(u,v,M)},h.prototype.worldCoord2Screen=function(u,v,M){return this.mxdrawThreeJS.worldCoord2Screen(u,v,M)},h.prototype.screenCoord2World_mxdrawThreeJS_call=function(u,v,M){var j=this.getCanvas(),z=j.clientWidth,J=j.clientHeight;M=.5;var te=this.camera;te&&te.isOrthographicCamera&&(M=(te.near+te.far)/(te.near-te.far));var X=new x.Vector3(u/z*2-1,-v/J*2+1,M);return X.unproject(this.camera),X.z=0,X},h.prototype.worldCoord2Screen_mxdrawThreeJS_call=function(u,v,M){var j=new x.Vector3(u,v,M).project(this.camera),z=this.getCanvas(),J=z.clientWidth/2,te=z.clientHeight/2,X=Math.round(j.x*J+J),se=Math.round(-j.y*te+te);return new x.Vector3(X,se,0)},h.prototype.worldCoordLong2Doc=function(u){var v=this.worldCoord2Doc(0,0,0),M=this.worldCoord2Doc(u,0,0);return v.distanceTo(M)},h.prototype.docCoordLong2World=function(u){var v=this.docCoord2World(0,0,0),M=this.docCoord2World(u,0,0);return v.distanceTo(M)},h.prototype.getDoc2CADMatrix=function(){return this._doc2CAD},h.prototype.docCoord2Cad=function(u,v,M){var j=new x.Vector3(u,v,M);return j.applyMatrix4(this._doc2CAD),j},h.prototype.toSmallcoord=function(u){return this._runMode==a.kCPPMxCAD?this.cadCoord2Doc2(u):u},h.prototype.toSmallcoord2=function(u,v,M){return M===void 0&&(M=0),this._runMode==a.kCPPMxCAD?this.cadCoord2Doc(u,v,M):new x.Vector3(u,v,M)},h.prototype.screenCoordLong2Smallcoord=function(u){return this.screenCoordLong2Doc(u)},h.prototype.docCoord2Cad2=function(u){return(u=u.clone()).applyMatrix4(this._doc2CAD),u},h.prototype.cadCoord2Doc=function(u,v,M){var j=new x.Vector3(u,v,M);return j.applyMatrix4(this._cad2Doc),j},h.prototype.cadCoord2Doc2=function(u){return(u=u.clone()).applyMatrix4(this._cad2Doc),u},h.prototype.docCoordLong2Cad=function(u){var v=this.docCoord2Cad(0,0,0),M=this.docCoord2Cad(u,0,0);return v.distanceTo(M)},h.prototype.cadCoordLong2Doc=function(u){var v=this.cadCoord2Doc(0,0,0),M=this.cadCoord2Doc(u,0,0);return v.distanceTo(M)},h.prototype.viewCoordLong2Cad=function(u){return this.docCoordLong2Cad(this.screenCoordLong2Doc(u))},h.prototype.cadCoordLong2View=function(u){return this.docCoordLong2Screen(this.cadCoordLong2Doc(u))},h.prototype.viewCoord2Cad=function(u,v,M){var j=this.screenCoord2Doc(u,v,M);return this.docCoord2Cad(j.x,j.y,j.z)},h.prototype.cadCoord2View=function(u,v,M){var j=this.cadCoord2Doc(u,v,M);return this.docCoord2Screen(j.x,j.y,j.z)},h.prototype.docCoord2World=function(u,v,M){var j=new x.Vector3(u,v,M);return j.applyMatrix4(this._doc2World),j},h.prototype.getDoc2World=function(){return this._doc2World},h.prototype.getWorldToDoc=function(){return this._word2doc},h.prototype.worldCoord2Doc=function(u,v,M){var j=new x.Vector3(u,v,M);return j.applyMatrix4(this._word2doc),j},h.prototype.screenCoord2Doc=function(u,v,M){var j=this.screenCoord2World(u,v,M);return this.worldCoord2Doc(j.x,j.y,0)},h.prototype.worldCoord2Currnet=function(u,v,M){var j=new x.Vector3(u,v,M);return j.applyMatrix4(this._word2Current),j},h.prototype.currentCoord2World=function(u,v,M){var j=new x.Vector3(u,v,M);return j.applyMatrix4(this._current2word),j},h.prototype.screenCoord2Current=function(u,v,M){var j=this.screenCoord2World(u,v,M);return j.applyMatrix4(this._word2Current),j},h.prototype.currentCoord2Screen=function(u,v,M){var j=new x.Vector3(u,v,M);return j.applyMatrix4(this._current2word),this.worldCoord2Screen(j.x,j.y,j.z)},h.prototype.docCoord2Screen=function(u,v,M){var j=this.docCoord2World(u,v,M);return this.worldCoord2Screen(j.x,j.y,j.z)},h.prototype.screenCoordLong2Doc=function(u){var v=this.screenCoord2Doc(0,0,0),M=this.screenCoord2Doc(u,0,0);return v.distanceTo(M)},h.prototype.screenCoordLong2DocScale=function(){var u=this.screenCoord2Doc(0,0,0),v=this.screenCoord2Doc(1,0,0);return u.distanceTo(v)},h.prototype.docCoordLong2Screen=function(u){var v=this.docCoord2Screen(0,0,0),M=this.docCoord2Screen(0<u?u:-u,0,0);return 0<=u?v.distanceTo(M):-v.distanceTo(M)},h.prototype.screenCoordLong2World=function(u){var v=this.screenCoord2World(0,0,0),M=this.screenCoord2World(0<u?u:-u,0,0);return 0<=u?v.distanceTo(M):-v.distanceTo(M)},h.prototype.worldCoordLong2Screen=function(u){var v=this.worldCoord2Screen(0,0,0),M=this.worldCoord2Screen(u,0,0);return v.distanceTo(M)},h.prototype.initCAD2Doc=function(u){u instanceof Array?this._cad2Doc.fromArray(u):this._cad2Doc=u,this._doc2CAD.getInverse(this._cad2Doc),this.mcObject.initCAD2Doc(this._cad2Doc,this._doc2CAD)},h.prototype.intiDoc2Wold=function(u){u instanceof Array?this._doc2World.fromArray(u):this._doc2World=u,this._word2doc.getInverse(this._doc2World)},h.prototype.intiword2Current=function(u){this._word2Current=u.clone(),this._current2word.getInverse(this._word2Current)},h.prototype.initializingObjectMatrix=function(){this.isNewObjectMatrix&&this._runMode==a.kCPPMxCAD?(this.m_mxDatabase.initObjectMatrix(this._cad2Doc),this._parentDocObject.matrix=this._cad2Doc,this._parentDocObject.matrixAutoUpdate=!1,this._parentDocObject_SmallCoord.matrix=new x.Matrix4,this._parentDocObject_SmallCoord.matrixAutoUpdate=!1,this.threejsselectObjects.matrix=this._cad2Doc,this.threejsselectObjects.matrixAutoUpdate=!1,this.intiword2Current(this._doc2CAD)):(this.m_mxDatabase.initObjectMatrix(this._doc2World),this._parentDocObject.matrix=this._doc2World,this._parentDocObject.matrixAutoUpdate=!1,this._parentDocObject_SmallCoord.matrix=this._doc2World,this._parentDocObject_SmallCoord.matrixAutoUpdate=!1,this.threejsselectObjects.matrix=this._doc2World,this.threejsselectObjects.matrixAutoUpdate=!1,this.intiword2Current(this._word2doc))},h.prototype.getDrawContainer=function(){return this.threejsselectObjects},h.prototype.getTheTempDrawContainer=function(){return this._parentDocObject},h.prototype.isMapBox=function(){return D.MxDrawData.m_isMapBox},h.prototype.getTheTempDrawContainer_SmallCoord_Draw=function(){return this._parentDocObject_SmallCoord},h.prototype.getTheTempDrawContainer_SmallCoord_JigDraw=function(){return this._parentDocObject_SmallCoord_JigDraw},h.prototype.clearTempDrawContainer_SmallCoord_JigDraw=function(){A.MxFun.removeThreejsObject(this._parentDocObject_SmallCoord_JigDraw,this._parentDocObject_SmallCoord),this._parentDocObject_SmallCoord_JigDraw=new x.Object3D,this._parentDocObject_SmallCoord.add(this._parentDocObject_SmallCoord_JigDraw)},h.prototype.getTempMarkDraw=function(){return this.tempMarkDraw},h.prototype.mxWebAddEntityFor2dPointMeshBuffers=function(u,v){var M=new P.MxNetData(u),j=M.getdPointMeshBuffersHead(),z=j.zeroLayerIdIndex,J=j.databaseIndex;v!=-1&&(J=v);for(var te=j.datasize,X=0;X<j.datacount;X++){var se=M.getdPointMeshBufferDataHead(te);te=se.offset;var ve=se.layerId,Ee=ve==z,we=se.blkId,Be=se.pointCount;if(!(Be<1)){for(var re=[],fe=[],ne=[],le=[],Re=[],at=0;at<Be;at++){var ze=u.getFloat32(te,!0);te+=4;var Ie=u.getFloat32(te,!0);te+=4;var ue=u.getFloat32(te,!0);te+=4;var Me=u.getFloat32(te,!0);te+=4;var Je=u.getFloat32(te,!0);te+=4;var $e=u.getFloat32(te,!0);te+=4;var ft=u.getInt32(te,!0);te+=4;var Pt=ft>>24&255;Pt==2?(le.push(ze,Ie),le.push(ue,Me),le.push(Je,$e)):Pt==1?we!=0&&Ee?(Re.push(ze,Ie),Re.push(ue,Me),Re.push(Je,$e)):(ne.push(ze,Ie),ne.push(ue,Me),ne.push(Je,$e)):(ft=this.automaticInversionColor(16777215&ft),re.push(ze,Ie),re.push(ue,Me),re.push(Je,$e),fe.push((255&ft)/255,(ft>>8&255)/255,(ft>>16&255)/255),fe.push((255&ft)/255,(ft>>8&255)/255,(ft>>16&255)/255),fe.push((255&ft)/255,(ft>>8&255)/255,(ft>>16&255)/255))}var _t=this._blocks,Ue=this._layers;J!=0&&(_t=this._extRefManager.getBlocks(J),Ue=this._extRefManager.getLayers(J));var Rt=_t.crateBlock(we);Rt.addGeometryMesh(re,fe,ve,le,ne,Re),_t.createThreejsObj(Rt,this,Ue)}}},h.prototype.mxWebAddEntityForMemorySections=function(u,v){var M=new P.MxNetData(u),j=M.getMemorySectionsHead(),z=(j.zeroLayerIdIndex,j.databaseIndex);v!=-1&&(z=v);var J=j.nOffset,te=this._blocks,X=this._layers;z!=0&&(te=this._extRefManager.getBlocks(z),X=this._extRefManager.getLayers(z));for(var se=0;se<j.datacount;se++){var ve=M.getMemorySectionHead(J);J=ve.offset;var Ee=new F.MxNewDisplayMemorySection;Ee.layerId=ve.layerId,Ee.blockId=ve.blkId,Ee.id=ve.memId,Ee.color=ve.memColor,Ee.type=ve.memType;var we=!1;Ee.type==F.MxNewDisplayMemorySectionType.kLinesType_Float?(we=!0,Ee.type=F.MxNewDisplayMemorySectionType.kLinesType):Ee.type==F.MxNewDisplayMemorySectionType.kTriangleType_Float?(we=!0,Ee.type=F.MxNewDisplayMemorySectionType.kTriangleType):Ee.type==F.MxNewDisplayMemorySectionType.kPointType_Float&&(we=!0,Ee.type=F.MxNewDisplayMemorySectionType.kPointType);var Be=ve.pointCount;if(!(Be<1)){for(var re=[],fe=0;fe<Be;fe++)if(we){var ne=u.getFloat32(J,!0);J+=4;var le=u.getFloat32(J,!0);J+=4,u.getFloat32(J,!0),J+=4,re.push(ne,le,0)}else ne=u.getFloat64(J,!0),J+=8,le=u.getFloat64(J,!0),J+=8,u.getFloat64(J,!0),J+=8,re.push(ne,le,0);Ee.points=re;var Re=te.crateBlock(Ee.blockId);Re.addMemorySections(Ee),te.createThreejsObj(Re,this,X)}}},h.prototype.convertBytesToUTF8=function(u,v){var M=0;v=Math.min(v||u.length,u.length),u[0]===239&&u[1]===187&&u[2]===191&&(M=3);for(var j=[],z=0;M<v;z++){var J,te,X,se=u[M++];if(se===0)break;se<128?j[z]=String.fromCharCode(se):194<=se&&se<224?(J=u[M++],j[z]=String.fromCharCode(((31&se)<<6)+(63&J))):224<=se&&se<240?(J=u[M++],te=u[M++],j[z]=String.fromCharCode(((15&se)<<12)+((63&J)<<6)+(63&te))):240<=se&&se<245&&(X=((7&se)<<18)+((63&(J=u[M++]))<<12)+((63&(te=u[M++]))<<6)+(63&u[M++])-65536,j[z]=String.fromCharCode(55296+(X>>10),56320+(1023&X)))}return j.join("")},h.prototype.mxWebAddEntityFor2dPointTextureBuffers=function(u,v){var M=new P.MxNetData(u),j=M.getdPointTextureBuffersHead(),z=j.ver,J=(j.zeroLayerIdIndex,j.databaseIndex);v!=-1&&(J=v);for(var te=j.datasize,X=0;X<j.datacount;X++){var se=M.getdPointTextureBufferDataHead(te);te=se.offset;var ve=se.layerId,Ee=se.blkId,we=se.dataCount;if(!(we<1)){var Be=0,re=this._blocks,fe=this._layers;J!=0&&(re=this._extRefManager.getBlocks(J),fe=this._extRefManager.getLayers(J));for(var ne=re.crateBlock(Ee);Be<we;Be++){var le=u.getFloat64(te,!0);te+=8;var Re=u.getFloat64(te,!0);te+=8;var at=u.getFloat64(te,!0);te+=8;var ze=u.getUint32(te,!0);te+=4;var Ie=u.getUint32(te,!0);te+=4;var ue=this.convertBytesToUTF8(new Uint8Array(u.buffer.slice(te,te+Ie)),void 0);te+=Ie;var Me=[],Je=[],$e=[];if(!(ze<1)){for(var ft=0;ft<ze;ft++){if(5<=z){var Pt=u.getFloat64(te,!0);te+=8;var _t=u.getFloat64(te,!0);te+=8,u.getFloat64(te,!0),te+=8;var Ue=u.getFloat64(te,!0);te+=8;var Rt=u.getFloat64(te,!0);te+=8,u.getFloat64(te,!0),te+=8;var It=u.getFloat64(te,!0);te+=8;var Nr=u.getFloat64(te,!0);te+=8,u.getFloat64(te,!0),te+=8,Me.push(Pt,_t),Me.push(Ue,Rt),Me.push(It,Nr)}else Pt=u.getFloat32(te,!0),te+=4,_t=u.getFloat32(te,!0),te+=4,Ue=u.getFloat32(te,!0),te+=4,Rt=u.getFloat32(te,!0),te+=4,It=u.getFloat32(te,!0),te+=4,Nr=u.getFloat32(te,!0),te+=4,Me.push(Pt,_t),Me.push(Ue,Rt),Me.push(It,Nr);var Qt=u.getInt32(te,!0);te+=4;var Ur=u.getFloat32(te,!0);te+=4;var gt=u.getFloat32(te,!0);te+=4;var We=u.getFloat32(te,!0);te+=4;var Yt=u.getFloat32(te,!0);te+=4;var Or=u.getFloat32(te,!0);te+=4;var Yr=u.getFloat32(te,!0);te+=4;var ct=Qt>>24&255;Qt=ct==2||ct==1?16777215:this.automaticInversionColor(16777215&Qt),$e.push(Ur,gt),$e.push(We,Yt),$e.push(Or,Yr),Je.push((255&Qt)/255,(Qt>>8&255)/255,(Qt>>16&255)/255),Je.push((255&Qt)/255,(Qt>>8&255)/255,(Qt>>16&255)/255),Je.push((255&Qt)/255,(Qt>>8&255)/255,(Qt>>16&255)/255)}ne.addGeometryTexture(Me,$e,Je,ve,ue,le,Re,at)}}re.createThreejsObj(ne,this,fe)}}},h.prototype.mxWebAddEntityFor2dPointCurveBuffers=function(u,v){var M=new P.MxNetData(u),j=M.getdPointCurveBuffersHead(),z=j.zeroLayerIdIndex,J=j.databaseIndex;v!=-1&&(J=v);for(var te=j.datasize,X=0;X<j.datacount;X++){var se=M.getdPointCurveBufferDataHead(te);te=se.offset;var ve=se.layerId,Ee=ve==z,we=se.blkId,Be=se.pointCount;if(!(Be<1)){for(var re=[],fe=[],ne=[],le=[],Re=[],at=0;at<Be;at++){var ze=u.getFloat32(te,!0);te+=4;var Ie=u.getFloat32(te,!0);te+=4;var ue=u.getFloat32(te,!0);te+=4;var Me=u.getFloat32(te,!0);te+=4;var Je=u.getInt32(te,!0);te+=4;var $e=Je>>24&255;$e==2?(le.push(ze,Ie),le.push(ue,Me)):$e==1?we!=0&&Ee?(Re.push(ze,Ie),Re.push(ue,Me)):(ne.push(ze,Ie),ne.push(ue,Me)):(re.push(ze,Ie),re.push(ue,Me),Je=this.automaticInversionColor(16777215&Je),fe.push((255&Je)/255,(Je>>8&255)/255,(Je>>16&255)/255),fe.push((255&Je)/255,(Je>>8&255)/255,(Je>>16&255)/255))}var ft=this._blocks,Pt=this._layers;J!=0&&(ft=this._extRefManager.getBlocks(J),Pt=this._extRefManager.getLayers(J));var _t=ft.crateBlock(we);_t.addGeometryCurve(re,fe,ve,le,ne,Re),ft.createThreejsObj(_t,this,Pt)}}},h.prototype.mxWebAddEntityFor2dPointCurveBuffer=function(u,v){var M=new P.MxNetData(u);if(!M.getIsSketchEntity()){var j,z=M.getLayerId(),J=z==M.getZeroLayerId(),te=M.getBlockId();if(!((j=u.getInt32(20,!0)/20)<1)){for(var X=80,se=[],ve=[],Ee=[],we=[],Be=[],re=0;re<j;re++){var fe=u.getFloat32(X,!0);X+=4;var ne=u.getFloat32(X,!0);X+=4;var le=u.getFloat32(X,!0);X+=4;var Re=u.getFloat32(X,!0);X+=4;var at=u.getInt32(X,!0);X+=4;var ze=at>>24&255;ze==2?(we.push(fe,ne),we.push(le,Re)):ze==1?te!=0&&J?(Be.push(fe,ne),Be.push(le,Re)):(Ee.push(fe,ne),Ee.push(le,Re)):(at=this.automaticInversionColor(16777215&at),se.push(fe,ne),se.push(le,Re),ve.push((255&at)/255,(at>>8&255)/255,(at>>16&255)/255),ve.push((255&at)/255,(at>>8&255)/255,(at>>16&255)/255))}var Ie=M.getDatabaseIndex();v!=-1&&(Ie=v);var ue=this._blocks,Me=this._layers;Ie!=0&&(ue=this._extRefManager.getBlocks(Ie),Me=this._extRefManager.getLayers(Ie));var Je=ue.crateBlock(te);Je.addGeometryCurve(se,ve,z,we,Ee,Be),ue.createThreejsObj(Je,this,Me)}}},h.prototype.mxWebAddEntityFor2dPointMeshBuffer=function(u,v){var M=new P.MxNetData(u);if(!M.getIsSketchEntity()){var j,z=M.getLayerId(),J=M.getBlockId(),te=z==M.getZeroLayerId();if(!((j=u.getInt32(12,!0)/28)<1)){for(var X=80,se=[],ve=[],Ee=[],we=[],Be=[],re=0;re<j;re++){var fe=u.getFloat32(X,!0);X+=4;var ne=u.getFloat32(X,!0);X+=4;var le=u.getFloat32(X,!0);X+=4;var Re=u.getFloat32(X,!0);X+=4;var at=u.getFloat32(X,!0);X+=4;var ze=u.getFloat32(X,!0);X+=4;var Ie=u.getInt32(X,!0);X+=4;var ue=Ie>>24&255;ue==2?(we.push(fe,ne),we.push(le,Re),we.push(at,ze)):ue==1?J!=0&&te?(Be.push(fe,ne),Be.push(le,Re),Be.push(at,ze)):(Ee.push(fe,ne),Ee.push(le,Re),Ee.push(at,ze)):(se.push(fe,ne),se.push(le,Re),se.push(at,ze),Ie=this.automaticInversionColor(16777215&Ie),ve.push((255&Ie)/255,(Ie>>8&255)/255,(Ie>>16&255)/255),ve.push((255&Ie)/255,(Ie>>8&255)/255,(Ie>>16&255)/255),ve.push((255&Ie)/255,(Ie>>8&255)/255,(Ie>>16&255)/255))}var Me=M.getDatabaseIndex();v!=-1&&(Me=v);var Je=this._blocks,$e=this._layers;Me!=0&&(Je=this._extRefManager.getBlocks(Me),$e=this._extRefManager.getLayers(Me));var ft=Je.crateBlock(J);ft.addGeometryMesh(se,ve,z,we,Ee,Be),Je.createThreejsObj(ft,this,$e)}}},h.prototype.mxWebCreateAllBlocks=function(u,v){var M=new P.MxNetData(u).getDatabaseIndex();v!=-1&&(M=v);var j=this._blocks;M!=0&&(j=this._extRefManager.getBlocks(M)),j.createBlocks(u,this.scene)},h.prototype.mxWebEntitysData=function(u,v){v==-1&&this._objectsOsnap.mxWebEntitysData(u,v)},h.prototype.getObjectOsnap=function(){return this._objectsOsnap},h.prototype.saveMxEntityToJson=function(u){return this.m_mxDatabase.saveJson(u)},h.prototype.getDtabaseJsonString=function(){return JSON.stringify(this.m_mxDatabase.toJsonObject())},h.prototype.loadMxEntityFromJson=function(u){return this.m_mxDatabase.loadJson(u)},h);function h(u){this._is2d=!0,this._runMode=a.kBrowse,this._userCanvas=null,this._openFile="empty",this._staticLoadingOpenFiles=[],this._openFileExtName="",this._userIdentitySign="",this._rendererParam=void 0,this._userRandomToken="",this._isCreate=!1,this.m_iniSet={},this._net=null,this._staticNet=null,this._staticLoadTzNet=null,this._staticLocalNet=null,this._isStaticLocalLoad=!1,this._staticLocalLoadPath="",this._viewWidth=1,this._viewHeight=1,this.m_sysVariable=new _.MxSystemVariable,this._color="#FFFFFF",this._viewcolor=15790320,this._isAnimation=!1,this._isAnimationStarting=!1,this._isWaiteCount=0,this._callCreateCanvasImageData=void 0,this._callCreateCanvasImageData_param=void 0,this._event={},this.scene=null,this.camera=null,this.camera_recover=null,this.secenView=null,this.cameraView=null,this.renderer=null,this.controls=null,this.threejsselectObjectsView=null,this._mouseRightRotate=!1,this._isMouseMiddlePan=1,this._mapId2Entity=new Map,this._setAdyDelete=new Map,this._layers=new H.MxBrowseLayerData,this._blocks=new F.Blocks,this._extRefManager=new F.ExternalReferenceManager,this._doc2World=new x.Matrix4,this._word2doc=new x.Matrix4,this._cad2Doc=new x.Matrix4,this._doc2CAD=new x.Matrix4,this._word2Current=new x.Matrix4,this._current2word=new x.Matrix4,this._allLayoutName=new Array,this._devicePixelRatio=1,this._tzDwgStaticFile="",this._requestHeader="",this._objectsOsnap=null,this._initZoomwCoordPt1=null,this._initZoomWCoordPt2=null,this.m_mxDatabase=null,this._parentDocObject=null,this._parentDocObject_SmallCoord=null,this._parentDocObject_SmallCoord_JigDraw=null,this.threejsselectObjects=null,this.tempMarkDraw=new N.MxTempMarkDraw,this._onResizeFun=null,this._sCurrentLoadURL="",this.eventManager=new Y.MxDrawObjectEvent,this._viewangle=0,this.id=0,this.mcObject=new T.McDrawObject,this.isPointMultipleSelect=!1,this.isNewObjectMatrix=!0,this.bakControls=void 0,this.isMultipleSelect=!1,this.mxdrawThreeJS=null,this.curMousePostion=new x.Vector2(0,0),this.m_isValidCurMousePostion=!1,this._is2d=u,this._blocks.initRootBlockRef(),this.m_iniSet[c.kEnableOsnapFunction]=!1,this.m_sysVariable.init(this),this.m_mxDatabase=new C.MxDbDatabase,this.id=E.MxManager.allocId(),D.MxDrawData.m_iIntelliSelectType==1?this.isPointMultipleSelect=!1:D.MxDrawData.m_iIntelliSelectType==2&&(this.isPointMultipleSelect=!0),this.isMultipleSelect=D.MxDrawData.m_isMultipleSelect,this.mcObject.initMxObject(this)}o.MxDrawObject=I},{"./MxDrawData":22,"./MxDrawObjectEvent":26,"./MxFun":27,"./MxLocalFileLoad":28,"./MxManager":29,"./MxNetData":31,"./MxSystemVariable":35,"./MxTempMarkDraw":36,"./Operate/MxDrawObjectOsnap":49,"./UI/MxUiVue":65,"./View/MxBrowseDisplay":66,"./View/MxBrowseLayerData":67,"./View/MxDbDatabase":68,"./View/MxDbEntityGrip":70,"./View/MxDrawMapBox":75,"./cpp/McDrawObject":78,three:19}],24:[function(b,n,o){var a,m=this&&this.__extends||(a=function(C,S){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Y,G){Y.__proto__=G}||function(Y,G){for(var T in G)Object.prototype.hasOwnProperty.call(G,T)&&(Y[T]=G[T])})(C,S)},function(C,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function Y(){this.constructor=C}a(C,S),C.prototype=S===null?Object.create(S):(Y.prototype=S.prototype,new Y)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObject2d=void 0;var c,x=b("three"),A=b("./MxFun"),H=b("./MxDrawObject"),F=b("three-orbitcontrols"),P=b("./MxNetData"),g=b("./MxMaterial"),E=b("./MxDrawData"),_=b("./View/MxDrawMapBox"),k=(m(U,c=H.MxDrawObject),U.prototype.set3DDraw=function(C){this.is3DDraw=C},U.prototype.getOrthographicCamera=function(){return this.camera instanceof x.OrthographicCamera?this.camera:null},U.prototype.getFullDisplayRange=function(){return{minPt:this._initMinDisplayPoint,maxPt:this._initMaxDisplayPoint}},U.prototype.saveZoom=function(){this.camera_recover=this.camera.clone(!1),this.controls.saveState()},U.prototype.recoverZoom=function(){this.camera_recover&&(this.camera.copy(this.camera_recover,!1),this.camera_recover=null,this.getOrthographicCamera().updateProjectionMatrix(),this.controls.reset(),this.mcObject.updateDisplayMatrixData())},U.prototype.zoomW_call=function(C,S,Y,G){if(C.distanceTo(S)<1e-7)console.log("Mx:ZoomW param invalid");else{if(Y!=null&&Y||(C=this.currentCoord2World(C.x,C.y,0),S=this.currentCoord2World(S.x,S.y,0)),C.x>S.x){var T=C.x;C.x=S.x,S.x=T}C.y>S.y&&(T=C.y,C.y=S.y,S.y=T);var B=this.getViewWidth(),D=this.getViewHeight();D<5&&(D=5),B<5&&(B=5);var N=Math.abs(C.x-S.x),I=Math.abs(C.y-S.y);N<1e-5&&(N=1e-5),I<1e-5&&(I=1e-5);var h=this.getOrthographicCamera();if(N/I<B/D){var u=.5*I,v=B/D;h.left=-u*v,h.right=u*v,h.top=u,h.bottom=-u}else u=.5*N,v=D/B,h.left=-u,h.right=u,h.top=u*v,h.bottom=-u*v;var M=N,j=I,z=M;z<j&&(z=j),this._runMode==H.MxRunMode.kCPPMxCAD?(h.far=10240,h.near=-10240):(h.far=1e3*z,h.far<9e4&&(h.far=9e4),h.near=1e3*-z,-9e4<h.near&&(h.near=-9e4));var J=C.x+.5*M,te=C.y+.5*j;h.zoom=1,h.position.set(J,te,100),h.lookAt(new x.Vector3(J,te,0)),h.updateProjectionMatrix(),this.controls.target.x=J,this.controls.target.y=te,this.controls.target.z=0,this.controls.update(),this.mcObject.updateDisplayMatrixData(G)}},U.prototype.zoomScale_call=function(C){var S=this.getOrthographicCamera();S.zoom=Math.max(this.controls.minZoom,Math.min(this.controls.maxZoom,S.zoom*C)),S.updateProjectionMatrix(),this.controls.update(),this.mcObject.updateDisplayMatrixData()},U.prototype.zoomCenter_call=function(C,S){var Y=this.bakViewDocWidth,G=this.bakViewDocHeight;if(this.bakViewDocWidth){var T=new x.Vector3,B=new x.Vector3;T.x=C-.5*this.bakViewDocWidth,T.y=S-.5*this.bakViewDocHeight,B.x=C+.5*this.bakViewDocWidth,B.y=S+.5*this.bakViewDocHeight,this.zoomW(T,B)}else{var D=this.getViewWidth(),N=this.getViewHeight(),I=this.screenCoord2World(0,0,0),h=this.screenCoord2World(D,N,0);Y=h.x-I.x,G=h.y-I.y;var u=C-(I.x+.5*(h.x-I.x)),v=S-(I.y+.5*(h.y-I.y));I.x+=u,I.y+=v,h.x+=u,h.y+=v,this.zoomW(I,h)}this.bakViewDocWidth=Y,this.bakViewDocHeight=G},U.prototype.calcCameraUp=function(C){var S=new x.Vector3(0,1,0),Y=new x.Matrix4;return Y.makeRotationZ(C),S.applyMatrix4(Y),S},U.prototype.updateCameraForm3dViewDataImp=function(C){C.updateCamera(this.getOrthographicCamera(),this.controls,this.getViewWidth(),this.getViewHeight()),this.mcObject.updateDisplayMatrixData(!1),this.controls.mouseButtons.LEFT=x.MOUSE.PAN,this.controls.mouseButtons.RIGHT=x.MOUSE.ROTATE,this.controls.mouseButtons.MIDDLE=x.MOUSE.PAN,this.controls.touches.ONE=x.TOUCH.ROTATE,this.controls.touches.TWO=x.TOUCH.PAN},U.prototype.updateCameraDisplayRangeImp=function(C,S,Y){this._initZoomwCoordPt1!=null&&this._initZoomWCoordPt2!=null?(this._initMinDisplayPoint=this.docCoord2World(this._initZoomwCoordPt1.x,this._initZoomwCoordPt1.y,0),this._initMaxDisplayPoint=this.docCoord2World(this._initZoomWCoordPt2.x,this._initZoomWCoordPt2.y,0)):(this._initMinDisplayPoint=C,this._initMaxDisplayPoint=S),this._viewangle=Y,this.camera.up=this.calcCameraUp(Y),this.cameraView.up=this.calcCameraUp(Y),this.cameraView.updateProjectionMatrix(),this.zoomW(this._initMinDisplayPoint,this._initMaxDisplayPoint,!0)},U.prototype.setViewAngle_call=function(C){this._viewangle=C;var S=this.getOrthographicCamera();S&&(S.up=this.calcCameraUp(C),S.updateProjectionMatrix()),this.cameraView.up=this.calcCameraUp(C),this.cameraView.updateProjectionMatrix(),this.controls.update(),this.mcObject.setViewAngle(C),this.mcObject.updateDisplayMatrixData()},U.prototype.zoomInitialStates=function(){this._initMinDisplayPoint!=null&&this._initMaxDisplayPoint!=null?(this.camera.up=this.calcCameraUp(this._viewangle),this.cameraView.up=this.calcCameraUp(this._viewangle),this.cameraView.updateProjectionMatrix(),this.zoomW(this._initMinDisplayPoint,this._initMaxDisplayPoint,!0)):console.log("mx assert(0)")},U.prototype.onInitScene=function(){if(this.callInitSceneEvent(this.scene,this.controls,!0)==0){var C=new x.AmbientLight(3355443,1);this.scene.add(C);var S=new x.DirectionalLight(16777215,1);S.position.set(-2,2,3).normalize(),this.scene.add(S)}},U.prototype.updataCameraView=function(C,S){var Y=C,G=S;this.cameraView.left=0,this.cameraView.right=Y,this.cameraView.top=G,this.cameraView.bottom=0,this.cameraView.updateProjectionMatrix()},U.prototype.onInitViewScene=function(){if(!this.secenView){this.secenView=new x.Scene,this._runMode!=H.MxRunMode.kCPPMxCAD&&this.mxdrawThreeJS.getType()!=_.MxThreeJSType.kMapBox&&(this.secenView.background=new x.Color(this._viewcolor));var C=this.getViewWidth(),S=this.getViewHeight();C=this.xzSize(C),S=this.xzSize(S),this.cameraView=new x.OrthographicCamera(0,C,S,0,1,2e3),this.cameraView.position.set(0,0,2e3),this.cameraView.lookAt(new x.Vector3(0,0,0)),this.cameraView.updateProjectionMatrix();var Y=new x.AmbientLight(3355443,1);this.secenView.add(Y);var G=new x.DirectionalLight(16777215,1);G.position.set(-2,2,3).normalize(),this.secenView.add(G),this.threejsselectObjectsView=new x.Object3D,this.secenView.add(this.threejsselectObjectsView)}},U.prototype.isSoftwareRenderer=function(C){var S=C.toLowerCase();return S.includes("swiftshader")||S.includes("llvmpipe")||S.includes("softpipe")||S.includes("microsoft")||S.includes("mesa")||S.includes("canvas")||S.includes("mozilla")},U.prototype.onInitThreejs=function(){var C=this.getViewWidth(),S=this.getViewHeight(),Y=(C=this.xzSize(C))/(S=this.xzSize(S))*50;this.onInitViewScene(),this.camera=new x.OrthographicCamera(Y/-2,Y/2,25,-25,-10240,10240),this.camera.position.set(0,0,200),this.scene=new x.Scene;var G=this.getUserCanvas(),T=this._rendererParam;T=T||{},G==null?(T.antialias=!1,T.stencil=!0,this.renderer=new x.WebGLRenderer(T),this.renderer.setClearColor(0,1),this.renderer.setPixelRatio(this._devicePixelRatio),this.renderer.setSize(C,S),document.body.appendChild(this.renderer.domElement)):(T.canvas=G,T.stencil=!0,this.renderer=new x.WebGLRenderer(T),this.renderer.setClearColor(0,1),this.renderer.setPixelRatio(this._devicePixelRatio));var B=this.renderer.getContext(),D=B.getParameter(B.RENDERER);console.log("MxTip:",D),this.isSoftwareRenderer(D)&&console.log("software renderer"),this.renderer.sortObjects=!0,this.renderer.info.autoReset=E.MxDrawData.m_isAutoResetRenderer,this.renderer.info.reset();var N=this.getUserCanvas();N==null&&(N=this.renderer.domElement),this.controls=new F.OrbitControls(this.camera,N),this.is3DDraw||(this.controls.enableZoom=!0),this.controls.enableRotate=!1,A.MxFun.isPC()?(this.controls.zoomSpeed=4,this.controls.screenSpacePanning=!0,this.controls.touches.ONE=x.TOUCH.PAN,this.setMouseMiddlePan(this._isMouseMiddlePan),this._mouseRightRotate&&(this.controls.mouseButtons.RIGHT=x.MOUSE.ROTATE)):(this.setMouseMiddlePan(this._isMouseMiddlePan),this.controls.zoomSpeed=1.5,this.controls.touches.ONE=x.TOUCH.PAN,this.controls.screenSpacePanning=!0)},U.prototype.onCreate=function(){this._is2d=!0,this.mxdrawThreeJS.onInitScene()},U.prototype.mxWebAddEntity_3DChild=function(C){var S=new P.MxNetData(C).getMesh();if(S.id==null)return S.size;var Y=new x.Mesh(S.geometry,g.MxMaterial.GetBaseColorMaterial(S.nColorIndex));return this.removeEntity(S.id),this.scene.add(Y),S.isSketchEntity&&this.addEntity(S.id,Y),S.size},U.prototype.mxWebAddEntity_Curve=function(C,S){var Y=new P.MxNetData(C).getCurve(S);if(Y.id!=null){var G=g.MxMaterial.GetCurveColorMaterial(Y.colorIndex),T=new x.LineSegments(Y.geometry,G);this.removeEntity(Y.id),this.scene.add(T),Y.isSketchEntity&&this.addEntity(Y.id,T)}},U.prototype.onViewChange=function(){this._onResizeImpCalling||(this._bakOnResizeViewWorldCoord=void 0),this.bakViewDocHeight=this.bakViewDocWidth=void 0},U.prototype.mapBox_onResizeImp=function(C,S){var Y=C,G=S;this.mcObject.setSize(Y,G),this.callEvent("viewsizechange",{width:Y,height:G}),this.callEvent("viewchange"),this.m_mxDatabase.getSelectManager().setCanvasSize(Y,G)},U.prototype.callOnResizeImp=function(C,S){var Y;this._bakOnResizeViewWorldCoord?Y=this._bakOnResizeViewWorldCoord:(Y=this.getViewWorldCoord(),this._bakOnResizeViewWorldCoord=Y);var G=Y.pt1.x+.5*(Y.pt3.x-Y.pt1.x),T=Y.pt1.y+.5*(Y.pt3.y-Y.pt1.y),B=new x.Matrix4;B.makeRotationZ(this._viewangle);var D=new x.Matrix4().makeTranslation(G,T,0).multiply(B).multiply(new x.Matrix4().makeTranslation(-G,-T,0)),N=Y.pt1.clone(),I=Y.pt2.clone(),h=Y.pt3.clone(),u=Y.pt4.clone();N.applyMatrix4(D),I.applyMatrix4(D),h.applyMatrix4(D),u.applyMatrix4(D);var v=N.clone();v.x>I.x&&(v.x=I.x),v.x>h.x&&(v.x=h.x),v.x>u.x&&(v.x=u.x),v.y>I.y&&(v.y=I.y),v.y>h.y&&(v.y=h.y),v.y>u.y&&(v.y=u.y);var M=N.clone();M.x<I.x&&(M.x=I.x),M.x<h.x&&(M.x=h.x),M.x<u.x&&(M.x=u.x),M.y<I.y&&(M.y=I.y),M.y<h.y&&(M.y=h.y),M.y<u.y&&(M.y=u.y);var j=new x.Vector2;if(this.renderer.getSize(j),j.x==C&&j.y==S)return!1;var z=this.getOrthographicCamera(),J=Math.abs(M.x-v.x),te=Math.abs(M.y-v.y);if(J<1e-5&&(J=1e-5),te<1e-5&&(te=1e-5),J/te<C/S){var X=.5*te,se=C/S;z.left=-X*se,z.right=X*se,z.top=X,z.bottom=-X}else X=.5*J,se=S/C,z.left=-X,z.right=X,z.top=X*se,z.bottom=-X*se;var ve=v.x+.5*J,Ee=v.y+.5*te;z.zoom=1;var we=z.position.z;return z.position.set(ve,Ee,we),z.lookAt(new x.Vector3(ve,Ee,0)),z.updateProjectionMatrix(),this.controls.target.x=ve,this.controls.target.y=Ee,this.controls.target.z=0,this.controls.update(),!0},U.prototype.onResizeImp=function(C,S){var Y=this.getViewWidth();C!=null&&(Y=C);var G=this.getViewHeight();if(S!=null&&(G=S),G<5||Y<5)return!1;Y=this.xzSize(Y),G=this.xzSize(G),this._onResizeImpCalling=!0;var T=this.mcObject.mxdraw3d.onResize(this.getOrthographicCamera(),this.controls,Y,G);return T&&(this.renderer.setSize(Y,G),this.mcObject.setSize(Y,G),this.updataClipMaterial(),this.updataCameraView(Y,G),this.callEvent("viewsizechange",{width:Y,height:G}),this.callEvent("viewchange"),this.m_mxDatabase.getSelectManager().setCanvasSize(Y,G),this.m_mxDatabase.onViewChange()),this._onResizeImpCalling=!1,T},U);function U(){var C=c.call(this,!0)||this;return C._initMinDisplayPoint=null,C._initMaxDisplayPoint=null,C.is3DDraw=A.MxFun.is3DDwg(),C._bakOnResizeViewWorldCoord=void 0,C._onResizeImpCalling=!1,C.bakViewDocWidth=void 0,C.bakViewDocHeight=void 0,C}o.MxDrawObject2d=k},{"./MxDrawData":22,"./MxDrawObject":23,"./MxFun":27,"./MxMaterial":30,"./MxNetData":31,"./View/MxDrawMapBox":75,three:19,"three-orbitcontrols":17}],25:[function(b,n,o){var a,m=this&&this.__extends||(a=function(k,U){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(C,S){C.__proto__=S}||function(C,S){for(var Y in S)Object.prototype.hasOwnProperty.call(S,Y)&&(C[Y]=S[Y])})(k,U)},function(k,U){if(typeof U!="function"&&U!==null)throw new TypeError("Class extends value "+String(U)+" is not a constructor or null");function C(){this.constructor=k}a(k,U),k.prototype=U===null?Object.create(U):(C.prototype=U.prototype,new C)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObject3d=void 0;var c,x=b("three"),A=b("./MxDrawObject"),H=b("three-orbitcontrols"),F=b("./MxNetData"),P=b("./MxMaterial"),g=b("./MxTools"),E=(m(_,c=A.MxDrawObject),_.prototype.mxWebAddEntity_Curve=function(k,U){var C,S=new F.MxNetData(k),Y=k.getInt32(32,!0)==0,G=S.getIsSketchEntity();if(!((C=Y?k.getInt32(20,!0)/4/3:k.getInt32(20,!0)/4/2)<2)){for(var T=new x.Geometry,B=U,D=0;D<C;D++){var N=k.getFloat32(B,!0);B+=4;var I=k.getFloat32(B,!0);B+=4;var h=0;Y&&(h=k.getFloat32(B,!0),B+=4),T.vertices.push(g.MxTools.AsThreeJsPoint(N,I,h))}var u=k.getInt32(28,!0),v=P.MxMaterial.GetCurveColorMaterial(u),M=new x.LineSegments(T,v),j=k.getInt32(4,!0);this.removeEntity(j),this.scene.add(M),G&&this.addEntity(j,M)}},_.prototype.mxWebAddEntity_3DChild=function(k){var U=new F.MxNetData(k),C=U.getId(),S=(U.getColorIndex(),U.getBufferType()==0),Y=U.getIsSketchEntity();this.removeEntity(C);var G=new x.Mesh(new x.Geometry),T=this.mxWebUpdateEntity_3DChild(G,k,S);return this.scene.add(G),Y&&this.addEntity(C,G),G.geometry.computeBoundingBox(),G.geometry.computeBoundingSphere(),T},_.prototype.mxWebUpdateEntity_3DChild=function(k,U,C){var S=new F.MxNetData(U),Y=S.getVertexBufferSize(),G=S.getIndexBufferSize(),T=S.getColorIndex();if(Y===0||G===0)return S.getDrawDataOffset();var B=S.getMateria(),D=void 0,N=!0,I=!1,h=!1;B.length!=0&&((D=JSON.parse(B)).computeFaceNonmal!=null&&(N=D.computeFaceNonmal),D.castShadow!=null&&(I=D.castShadow),D.receiveShadow!=null&&(h=D.receiveShadow)),k.material=P.MxMaterial.createMaterial(D),k.material==null&&(k.material=P.MxMaterial.GetColorMaterial(T)),k.castShadow=I,k.receiveShadow=h;var u,v=S.getDrawDataOffset();u=C?Y/4/8:Y/4/2;var M=k.geometry;M.vertices=[],M.faces=[];for(var j=0;j<u;j++){var z=U.getFloat32(v+0,!0),J=U.getFloat32(v+4,!0),te=0,X=0,se=0,ve=0,Ee=0,we=0;C?(te=U.getFloat32(v+8,!0),X=U.getFloat32(v+12,!0),se=U.getFloat32(v+16,!0),ve=U.getFloat32(v+20,!0),Ee=U.getFloat32(v+24,!0),we=U.getFloat32(v+28,!0),v+=32):v+=8;var Be=g.MxTools.AsThreeJsPoint(z,J,te);M.vertices.push(Be),M.vertices[j].normal=g.MxTools.AsThreeJsPoint(X,se,ve),M.vertices[j].uv=new x.Vector2(Ee,we)}var re=G/4;for(j=0;j<re;j+=3){var fe=U.getInt32(v,!0);v+=4;var ne=U.getInt32(v,!0);v+=4;var le=U.getInt32(v,!0);v+=4;var Re=new x.Face3(fe,ne,le);N||Re.vertexNormals.push(M.vertices[fe].normal,M.vertices[ne].normal,M.vertices[le].normal),M.faces.push(Re),M.faceVertexUvs[0].push([M.vertices[fe].uv,M.vertices[ne].uv,M.vertices[le].uv])}return N&&M.computeFaceNormals(),v},_.prototype.updateUVs=function(k){k.faceVertexUvs[0]=[],k.faces.forEach(function(U){var C=["x","y","z"].sort(function(N,I){return Math.abs(U.normal[N])-Math.abs(U.normal[I])}),S=k.vertices[U.a],Y=k.vertices[U.b],G=k.vertices[U.c],T=new x.Vector2(S[C[0]],S[C[1]]),B=new x.Vector2(Y[C[0]],Y[C[1]]),D=new x.Vector2(G[C[0]],G[C[1]]);k.faceVertexUvs[0].push([T,B,D])}),k.uvsNeedUpdate=!0},_.prototype.onInitThreejs=function(){var k=this.getViewWidth(),U=this.getViewHeight(),C=(k=this.xzSize(k))/(U=this.xzSize(U))*50;this.camera=new x.OrthographicCamera(C/-2,C/2,25,-25,1,1e3),this.camera.position.set(-200,200,200),this.scene=new x.Scene,this.scene.background=new x.Color(this._viewcolor);var S=this.getUserCanvas();S==null?(this.renderer=new x.WebGLRenderer({antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this._devicePixelRatio),this.renderer.setSize(k,U),document.body.appendChild(this.renderer.domElement)):(this.renderer=new x.WebGLRenderer({canvas:S,antialias:!0,alpha:!0}),this.renderer.setPixelRatio(this._devicePixelRatio));var Y=this.getUserCanvas();Y==null&&(Y=this.renderer.domElement),this.controls=new H.OrbitControls(this.camera,Y)},_.prototype.onInitViewScene=function(){},_.prototype.onInitScene=function(){if(this.callInitSceneEvent(this.scene,this.controls,!1)==0){var k=new x.AmbientLight(2236962);k.integrity=1,this.scene.add(k);var U=new x.DirectionalLight(16777215,1);U.position.set(-2,2,3).normalize(),this.scene.add(U);var C=new x.GridHelper(2e3,100);C.position.y=-199,C.material.opacity=.25,C.material.transparent=!0,this.scene.add(C);var S=new x.AxesHelper(20);this.scene.add(S)}},_.prototype.onCreate=function(){this._is2d=!1,this.callEvent("initRenderer",this.renderer),this.mxdrawThreeJS.onInitScene()},_.prototype.getOrthographicCamera=function(){return this.camera instanceof x.OrthographicCamera?this.camera:null},_.prototype.onViewChange=function(){},_.prototype.callOnResizeImp=function(k,U){return!1},_.prototype.onResizeImp=function(k,U){var C=this.getViewWidth();k!=null&&(C=k);var S=this.getViewHeight();U!=null&&(S=U),C=this.xzSize(C),S=this.xzSize(S);var Y=this.getOrthographicCamera(),G=C/S;return Y.left=50*G/-2,Y.right=50*G/2,Y.top=25,Y.bottom=-25,Y.updateProjectionMatrix(),this.renderer.setSize(C,S),!0},_.prototype.zoomInitialStates=function(){},_.prototype.saveZoom=function(){},_.prototype.recoverZoom=function(){},_.prototype.zoomScale_call=function(k){},_.prototype.zoomW_call=function(k,U,C,S){},_.prototype.zoomCenter_call=function(k,U){},_.prototype.setViewAngle_call=function(k){this._viewangle=k},_.prototype.getFullDisplayRange=function(){return{}},_);function _(){var k=c.call(this,!1)||this;return k._viewcolor=15790320,k}o.MxDrawObject3d=E},{"./MxDrawObject":23,"./MxMaterial":30,"./MxNetData":31,"./MxTools":38,three:19,"three-orbitcontrols":17}],26:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObjectEvent=o.MxDrawObjectEventDefautProc=void 0;var a=b("./MxFun"),m=b("./Operate/MxJigCmdManager"),c=b("three"),x=b("./UI/MxUiVue"),A=b("./MxDrawData"),H=(F.prototype.onMousemove=function(E){if(x.MxUiVue.isNull())return 0;var _=this.mxObj.screenCoord2Doc(E.offsetX,E.offsetY,0);return _=this.mxObj.docCoord2Cad(_.x,_.y,_.z),x.MxUiVue.setTipCoord(a.MxFun.formatString("{0},{1},0.000",_.x.toFixed(3),_.y.toFixed(3))),0},F.prototype.isEnableIntelliSelect=function(){return!!A.MxDrawData.m_isEnableIntelliSelect&&!this.mxObj.is3DMode()},F.prototype.onTouchStart=function(E){if(!this.isEnableIntelliSelect()||m.MxJigCmdManager.isRunning()||this.mxObj.isPaningCommand()||E.touches.length!=1)return 0;var _=E.target.getBoundingClientRect(),k=E.touches[0].clientX-_.left,U=E.touches[0].clientY-_.top,C=this.mxObj,S=C.screenCoord2Current(k,U,0);if(C.getMxDatabase().getGripManager().onMouseLBDown(S)||C.isValidMcObject()&&C.getMcObject().getGripManager().onMouseLBDown(S))return 1;var Y=new c.Vector3(k,U,0);return a.MxFun.sendStringToExecute("Mx_FrontEndWebpageIntelliSel",{pt:Y,shiftKey:!1}),1},F.prototype.onMousdown=function(E){if(E.button==m.MxJigCmdManager.MouseButton.kRight&&m.MxJigCmdManager.isRunning()&&!A.MxDrawData.m_isEnableCommandRightClickMenu&&!E.shiftKey)return m.MxJigCmdManager.OnEnter(-1),E.stopPropagation(),1;if(!this.isEnableIntelliSelect()||E.button!=m.MxJigCmdManager.MouseButton.kLeft||m.MxJigCmdManager.isRunning()||this.mxObj.isPaningCommand())return 0;var _=this.mxObj,k=_.screenCoord2Current(E.offsetX,E.offsetY,0);if(_.getMxDatabase().getGripManager().onMouseLBDown(k)||_.isValidMcObject()&&_.getMcObject().getGripManager().onMouseLBDown(k))return 1;var U=new c.Vector3(E.offsetX,E.offsetY,0);return a.MxFun.sendStringToExecute("Mx_FrontEndWebpageIntelliSel",{pt:U,shiftKey:E.shiftKey}),1},F.prototype.init=function(E,_){this.mxObj=E;var k=this;_.addEventListener("mousemove",function(U){return k.onMousemove(U)}),_.addEventListener("mousedown",function(U){return k.onMousdown(U)}),_.addEventListener("touchstart",function(U){return k.onTouchStart(U)})},F);function F(){}o.MxDrawObjectEventDefautProc=H;var P=(g.prototype.onMousedown=function(E,_){this.callEvent("mousedown",E,_)},g.prototype.onMousemove=function(E,_){this.callEvent("mousemove",E,_)},g.prototype.onMouseup=function(E,_){this.callEvent("mouseup",E,_)},g.prototype.registEvent=function(E){var _=E.getMxDrawThreeJs().getRegistEventObject();if(!_)return!1;var k=this;a.MxFun.isPC()?(_.addEventListener("mouseup",function(U){var C=E.getMxDrawThreeJs().getDomMousePos(U);k.onMouseup(U,C)},!0),_.addEventListener("mousemove",function(U){var C=E.getMxDrawThreeJs().getDomMousePos(U);E.setCurrentMousePostion(U),k.onMousemove(U,C)},!0),_.addEventListener("mousedown",function(U){var C=E.getMxDrawThreeJs().getDomMousePos(U);E.setCurrentMousePostion(U),k.onMousedown(U,C)},!0)):(_.addEventListener("touchstart",function(U){E.setCurrentMousePostion(U,!0),k.callEvent("touchstart",U)},!0),_.addEventListener("touchend",function(U){k.callEvent("touchend",U)},!0),_.addEventListener("touchmove",function(U){E.setCurrentMousePostion(U,!0),k.callEvent("touchmove",U)},!0)),this.defautProc.init(E,this)},g.prototype.getEventCall=function(E){var _;return E=="mousemove"?_=this.aryMousemoveEventCall:E=="mouseup"?_=this.aryMouseupEventCall:E=="mousedown"?_=this.aryMousedownEventCall:E=="touchstart"?_=this.aryTouchstartEventCall:E=="touchend"?_=this.aryTouchendEventCall:E=="touchmove"&&(_=this.aryTouchmoveEventCall),_},g.prototype.callEvent=function(E,_,k){var U=this.getEventCall(E);if(U){for(var C=U.slice(),S=0,Y=C.length;S<Y;S++){var G=C[S](_,k);if(G==1)return G}return 0}},g.prototype.addEventListener=function(E,_,k){k===void 0&&(k=!1);var U=this.getEventCall(E);return!!U&&(-1<U.indexOf(_)||(k?U.unshift(_):U.push(_)),!0)},g.prototype.removeEventListener=function(E,_){var k=this.getEventCall(E);if(!k)return!1;var U=k.indexOf(_);return-1<U&&(k.splice(U,1),!0)},g);function g(){this.aryMousedownEventCall=[],this.aryMouseupEventCall=[],this.aryMousemoveEventCall=[],this.aryTouchstartEventCall=[],this.aryTouchendEventCall=[],this.aryTouchmoveEventCall=[],this.defautProc=new H}o.MxDrawObjectEvent=P},{"./MxDrawData":22,"./MxFun":27,"./Operate/MxJigCmdManager":54,"./UI/MxUiVue":65,three:19}],27:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxFun=void 0;var a,m,c,x,A,H,F,P,g,E,_,k,U,C,S,Y,G=b("three"),T=b("./MxManager"),B=b("./MxDrawObject"),D=b("./MxDrawObject2d"),N=b("./MxDrawObject3d"),I=b("./UI/MxUiObjectMobile"),h=b("./UI/MxUiObjectPC"),u=b("./Operate/MxJigCmdManager"),v=b("./Operate/MxJigGetLine"),M=b("./Operate/MxCmdRunManager"),j=b("./UI/MxUiVue"),z=b("./MxThreeJS"),J=b("./MxWindowsEvent"),te=b("./MxTools"),X=b("./MxDrawCommands"),se=b("./MxDrawData"),ve=b("./MxLocalFileLoad"),Ee=b("./TempTest/MxTestJig"),we=b("./MxVersion"),Be=b("./MrxDbgUtils");function re(ue){ue.cmd&&ze(ue.cmd)}function fe(ue){var Me=new RegExp("(^|&)"+ue+"=([^&]*)(&|$)"),Je=window.location.href,$e=Je.indexOf("?"),ft=(Je=$e==-1?"":Je.substring($e)).substr(1).match(Me);return ft!=null?decodeURIComponent(ft[2]):""}function ne(){return T.MxManager.currentMx()}function le(ue,Me){var Je={};if(ue!=null)if(ue instanceof Array)Je.is2d=!0;else{ue.length==0&&(ue="empty");var $e=ue.substring(ue.lastIndexOf(".")+1).toLowerCase();if($e!="dwg"&&$e!="dxf"&&$e!="dwf"&&$e!="mwg"&&$e!="wgh"||(Je.is2d=!0),Me!=1&&Me!=null&&$e!="wgh"){var ft=void 0,Pt=ue.split("/");(ft=Pt.length==1?Pt[0]:Pt[Pt.length-1])[0]=="$"&&(ft=ft.substring(1));for(var _t=void 0,Ue=0;Ue<Pt.length-1;Ue++)_t=Ue==0?Pt[Ue]:_t+"/"+Pt[Ue];ue=_t?_t+"/$"+ft+".mxb1.wgh":"$"+ft+".mxb1.wgh"}}else ue="empty_template.dwg";return Je.sFileName=ue,Je}function Re(ue){if(typeof ue=="string"){var Me=ue.substring(ue.lastIndexOf(".")+1).toLowerCase();if(Me!="dwg"&&Me!="wgh"){var Je=ue.lastIndexOf("?");if(Je!=-1){var $e=ue.substring(Je,ue.length);return{sFileName:ue=ue.substring(0,Je),sUrlParam:$e}}}}return null}function at(){return u.MxJigCmdManager.stopCmd(u.MxJigCmdManager.DetailedResult.kUnknown)}function ze(ue,Me){if(ue.length!=0){var Je=ne();return M.MxCmdRunManager.runCmd(Je,ue,Me)}at()}function Ie(ue){ue!=null&&(ue.init(),j.MxUiVue.init(ue)),k||(console.log("MxDraw Version:"+we.MxBulid.getVersion()),k=!0,S=new ve.MxLocalNodeJs,u.MxJigCmdManager.init(),J.MxWindowsEvent.registEvent(),X.MxDrawCommands.registerCommand(),window.mxConfig_isLoadTest&&Ee.MxTest.registerCommand(),C.sendStringToExecute=re)}m=a||(o.MxFun=a={}),c=".",_=null,k=!(E="ws://localhost:5090"),C={},S=U=g=F=x=void 0,Y=P=H=A=-1,m.getUiObj=function(){return _},m.on=function(ue,Me){T.MxManager.on(ue,Me)},m.callEvent=function(ue,Me){return T.MxManager.callEvent(ue,Me)},m.getNodeJs=function(){return S},m.setMxServer=function(ue){E=ue},m.getMxServer=function(){return E},m.isPC=function(){return Y==-1?function(){if(!/Android|webOS|iPhone|iPod|BlackBerry/i.test(navigator.userAgent)){var ue=navigator.userAgent.toLowerCase();return 0<=ue.indexOf("win64")||0<=ue.indexOf("wow64")||0<=ue.indexOf("win32")||0<=ue.indexOf("wow32")||/macintosh|mac os x/i.test(navigator.userAgent)||!("ontouchstart"in window||0<navigator.maxTouchPoints)}}()?(Y=1,!0):(Y=0,!1):Y==1},m.getClientPlatform=function(){return navigator.platform},m.getClientInfo=function(){return{width:document.body.clientWidth,height:document.body.clientHeight}},m.curPath=function(){return c},m.setCurPath=function(ue){c=ue},m.getQueryString=fe,m.getLocationPageUrl=function(){var ue=window.location.href,Me=ue.lastIndexOf("?");return Me==-1?ue:ue.substring(0,Me)},m.getHostUrl=function(){var ue=window.location.hostname;return ue.substring(0,4)!="http"&&(ue="http://"+ue),ue},m.isAbsoluteWebPath=function(ue){return ue.substring(0,4)=="http"},m.getUrlParams=function(){var ue=window.location.search,Me=ue.substr(1,ue.length).split("&"),Je=new Array;if(Me!=null)for(var $e=0;$e<Me.length;$e++){var ft=Me[$e].replace(/[=|^==]/,"&").split("&");if(1<ft.length){var Pt=new Array;Pt.push(decodeURIComponent(ft[0])),Pt.push(decodeURIComponent(ft[1])),Je.push(Pt)}}return Je},m.call=function(ue,Me,Je){Me==null?Me="{}":typeof Me=="string"?Me.length==0?Me="{}":Me[0]=="["&&Me[Me.length-1]=="]"||Me[0]=="{"&&Me[Me.length-1]=="}"||(Me='"'+(Me=Me.replace(/"/g,"'"))+'"'):Me=typeof Me=="object"?JSON.stringify(Me):"{}",T.MxManager.currentMx().call(ue,Me,Je)},m.loadCodeToServer=function(ue,Me){T.MxManager.currentMx().loadCodeToServer(ue,Me)},m.getCurrentMx=function(){return T.MxManager.currentMx()},m.isEnableSelect=function(){if(A!=-1)return A==1;var ue=fe("select");return A=0,ue!=null&&ue.toLowerCase()=="y"&&(A=1),A==1},m.is3DDwg=function(){if(P!=-1)return P==1;var ue=fe("3ddwg");return P=0,ue!=null&&ue.toLowerCase()=="y"&&(P=1),P==1},m.isStaticLoad=function(){if(H!=-1)return H==1;var ue=fe("static");return H=0,ue!=null&&ue.toLowerCase()=="y"&&(H=1),H==1},m.enableSelect=function(ue){A=ue?1:0},m.enablStaticLoad=function(ue){H=ue==null||ue?1:0},m.dwgDir=function(){return F!=null||(F=fe("dwgdir"))==null&&(F=""),F},m.setDwgDir=function(ue){F=ue},m.getStaticServer=function(){return g!=null||(g=fe("staticServer"))==null&&(g=""),g},m.setStaticServer=function(ue){g=ue},m.is2dParam=function(){if(x!=null)return x;var ue=fe("file");if(x=!1,ue!=null){var Me=ue.substring(ue.lastIndexOf(".")+1);Me.toLowerCase()!="dwg"&&Me.toLowerCase()!="dxf"&&Me.toLowerCase()!="dwf"&&Me.toLowerCase()!="mwg"||(x=!0)}return x},m.set2dParam=function(ue){x=ue},m.showLayer=function(ue,Me){return T.MxManager.currentMx().showLayer(ue,Me)},m.screenCoord2World=function(ue,Me,Je){return ue instanceof Object?T.MxManager.currentMx().screenCoord2World(ue.x,ue.y,ue.z):T.MxManager.currentMx().screenCoord2World(ue,Me,Je)},m.worldCoord2Screen=function(ue,Me,Je){return ue instanceof Object?T.MxManager.currentMx().worldCoord2Screen(ue.x,ue.y,ue.z):T.MxManager.currentMx().worldCoord2Screen(ue,Me,Je)},m.docCoord2Cad=function(ue,Me,Je){return ue instanceof Object?T.MxManager.currentMx().docCoord2Cad(ue.x,ue.y,ue.z):T.MxManager.currentMx().docCoord2Cad(ue,Me,Je)},m.cadCoord2Doc=function(ue,Me,Je){return ue instanceof Object?T.MxManager.currentMx().cadCoord2Doc(ue.x,ue.y,ue.z):T.MxManager.currentMx().cadCoord2Doc(ue,Me,Je)},m.docCoord2World=function(ue,Me,Je){return ue instanceof Object?T.MxManager.currentMx().docCoord2World(ue.x,ue.y,ue.z):T.MxManager.currentMx().docCoord2World(ue,Me,Je)},m.worldCoord2Doc=function(ue,Me,Je){return ue instanceof Object?T.MxManager.currentMx().worldCoord2Doc(ue.x,ue.y,ue.z):T.MxManager.currentMx().worldCoord2Doc(ue,Me,Je)},m.screenCoord2Doc=function(ue,Me,Je){return ue instanceof Object?T.MxManager.currentMx().screenCoord2Doc(ue.x,ue.y,ue.z):T.MxManager.currentMx().screenCoord2Doc(ue,Me,Je)},m.docCoord2Screen=function(ue,Me,Je){return ue instanceof Object?T.MxManager.currentMx().docCoord2Screen(ue.x,ue.y,ue.z):T.MxManager.currentMx().docCoord2Screen(ue,Me,Je)},m.docCoordLong2Cad=function(ue){return T.MxManager.currentMx().docCoordLong2Cad(ue)},m.cadCoordLong2Doc=function(ue){return T.MxManager.currentMx().cadCoordLong2Doc(ue)},m.viewCoordLong2Cad=function(ue){return T.MxManager.currentMx().viewCoordLong2Cad(ue)},m.cadCoordLong2View=function(ue){return T.MxManager.currentMx().cadCoordLong2View(ue)},m.zoomCenter=function(ue,Me){T.MxManager.currentMx().is2D()&&(T.MxManager.currentMx().zoomCenter(ue,Me),T.MxManager.currentMx().updateDisplay())},m.zoomW=function(ue,Me,Je,$e,ft){T.MxManager.currentMx().is2D()&&(T.MxManager.currentMx().zoomW(new G.Vector3(ue,Me,0),new G.Vector3(Je,$e,0),ft),T.MxManager.currentMx().updateDisplay())},m.zoomScale=function(ue){T.MxManager.currentMx().is2D()&&(T.MxManager.currentMx().zoomScale(ue),T.MxManager.currentMx().updateDisplay())},m.zoomAll=function(){T.MxManager.currentMx().is2D()&&(T.MxManager.currentMx().zoomAll(),T.MxManager.currentMx().updateDisplay())},m.deleteAll=function(){return T.MxManager.currentMx().deleteAll()},m.callCommand=function(ue,Me,Je){T.MxManager.currentMx().callCommand(ue,Me,Je)},m.getCurrentColor=function(){return T.MxManager.currentMx().getCurrentColor()},m.setCurrentColor=function(ue){T.MxManager.currentMx().setCurrentColor(ue)},m.showLoading=function(){_!=null&&_.ShowLoading()},m.hideLoading=function(){_!=null&&_.HideLoading()},m.showProp=function(ue){_!=null&&_.ShowObjectProperty(ue)},m.hideProp=function(){_!=null&&_.HideObjectProp()},m.getUiObject=function(){return _},m.getViewCenterDocCoord=function(){return T.MxManager.currentMx().is2D()?T.MxManager.currentMx().getViewCenterDocCoord():new G.Vector3(0,0,0)},m.screenCoordLong2Doc=function(ue){return T.MxManager.currentMx().is2D()?T.MxManager.currentMx().screenCoordLong2Doc(ue):ue},m.docCoordLong2Screen=function(ue){return T.MxManager.currentMx().is2D()?T.MxManager.currentMx().docCoordLong2Screen(ue):ue},m.worldCoordLong2Doc=function(ue){return T.MxManager.currentMx().is2D()?T.MxManager.currentMx().worldCoordLong2Doc(ue):ue},m.docCoordLong2World=function(ue){return T.MxManager.currentMx().is2D()?T.MxManager.currentMx().docCoordLong2World(ue):ue},m.screenCoordLong2World=function(ue){return T.MxManager.currentMx().is2D()?T.MxManager.currentMx().screenCoordLong2World(ue):ue},m.worldCoordLong2Screen=function(ue){return T.MxManager.currentMx().is2D()?T.MxManager.currentMx().worldCoordLong2Screen(ue):ue},m.addSelectEvent=function(ue){T.MxManager.addSelectEvent(ue)},m.clearSelectEvent=function(){T.MxManager.clearSelectEvent()},m.removeThreejsObject=function(ue,Me,Je){ue&&(ue.traverse(function($e){($e instanceof G.Mesh||$e instanceof G.Line||$e instanceof G.LineLoop)&&($e.geometry.dispose(),Je&&($e.material instanceof Array?$e.material.forEach(function(ft){ft.dispose()}):$e.material.dispose()))}),Me.remove(ue))},m.removeThreejsAllChildren=function ue(Me){for(;0<Me.children.length;){var Je=Me.children[0];Me.remove(Je),0<Je.children.length&&ue(Je),Je.geometry&&Je.geometry.dispose(),Je.material instanceof Array?Je.material.forEach(function($e){$e.dispose()}):Je.material.dispose(),Je.texture&&Je.texture.dispose()}},m.setOutServerDebugCall=function(ue){T.MxManager.setOutDebugCall(ue)},m.updateDisplay=function(){T.MxManager.updateDisplay()},m.getCurrentDraw=ne,m.formatString=function(ue){for(var Me=[],Je=1;Je<arguments.length;Je++)Me[Je-1]=arguments[Je];for(var $e=0;$e<Me.length;$e++)ue=ue.replace("{".concat($e,"}"),Me[$e]);return ue},m.createMxUiObject=function(ue){var Me;return Me=this.isPC()?new h.MxUiObjectPC:new I.MxUiObjectMobile,ue(_=Me),Me.create(),Me},m.openFile=function(ue,Me){var Je="";if(typeof ue=="string"){var $e=Re(ue);$e&&(Je=$e.sUrlParam,ue=$e.sFileName)}Me==null&&(Me=!1);var ft=le(ue,Me);return ft.is2d&&(x=ft.is2d),ue=ft.sFileName,T.MxManager.currentMx().openFile(ue,Je)},m.createMxObject=function(ue,Me,Je,$e,ft,Pt,_t,Ue){k||Ie(),typeof ue=="string"&&(ue=ue.length==0?void 0:document.getElementById(ue));var Rt=null,It="";if(Ue)Me="",(Rt=new D.MxDrawObject2d).initRunMode(B.MxRunMode.kCPPMxCAD),Rt.setViewColor(0);else{if(Me==null)Me=m.getQueryString("file");else{var Nr=Re(Me);Nr&&(It=Nr.sUrlParam,Me=Nr.sFileName)}var Qt=$e==null||$e;if(Me===void 0||Me.length==0||Me=="empty")Qt=!0,Me=Me=="empty"?"":"empty_template.dwg";else{var Ur=le(Me,Pt);Ur.is2d&&(Qt=Ur.is2d),Me=Ur.sFileName}ft==1&&(Me=""),Qt?(Rt=new D.MxDrawObject2d).setViewColor(0):(Rt=new N.MxDrawObject3d).setViewColor(15790320)}return Je!=null&&Je(Rt),Rt.create(ue,Me,It,_t),Rt},m.getMxObjectFormElement=function(ue){return T.MxManager.getMxObject(ue)},m.initMxCpp=function(ue){T.MxManager.initMxCpp(ue)},m.isRunningCommand=function(){return u.MxJigCmdManager.isRunning()},m.getRunningCommand=function(){return u.MxJigCmdManager.getCurCmd()},m.stopRunCommand=at,m.runCommand=function(ue){return u.MxJigCmdManager.runCmd(ue)},m.getTHREE=function(){return G},m.getLine=function(ue){var Me=new v.MxJigGetLine;Me.setRetCall(ue),u.MxJigCmdManager.runCmd(Me)},m.addCommand=function(ue,Me,Je){M.MxCmdRunManager.addCommand(ue,Me,Je)},m.sendStringToExecute=ze,m.getMxEntity=function(ue){var Me=ne();return Me?Me.getMxEntityUserObject(ue):null},m.initUiDataObject=function(ue){j.MxUiVue.isNull()&&(ue.init(m),j.MxUiVue.init(ue))},m.init=Ie,m.addWindowsEvent=function(ue){J.MxWindowsEvent.addEvent(ue)},m.getCurrentMousePostion=function(){return ne().getCurrentMousePostion()},m.getMxThreeJS=function(){return z.MxThreeJS},m.getMxTools=function(){return te.MxTools},m.getMxCmdRunManager=function(){return M.MxCmdRunManager},m.getMxJigCmdManager=function(){return u.MxJigCmdManager},m.initQuickCommand=function(ue){M.MxCmdRunManager.InitQuickCommand(ue)},m.InitLanguageString=function(ue){M.MxCmdRunManager.InitLanguageString(ue)},m.getLanguageString=function(ue,Me){return Me===void 0&&(Me=""),M.MxCmdRunManager.getLanguageString(ue,Me)},m.Assert=function(ue){ue||console.log("MxAssert error")},m.setIniset=function(ue){se.MxDrawData.setIniset(ue)},m.getIniSet=function(){return se.MxDrawData.getIniSet()},m.setPostMessageToParentFrameFunction=function(ue){U=ue},m.postMessageToParentFrame=function(ue){return U!=null&&(U(ue),!0)},m.onParentFrameMessage=function(ue){ue!=null&&ue.type!=null&&C[ue.type]&&C[ue.type](ue)},m.acutPrintf=function(ue){for(var Me=[],Je=1;Je<arguments.length;Je++)Me[Je-1]=arguments[Je];if(!j.MxUiVue.isNull()){for(var $e=arguments,ft=$e[0],Pt=0;Pt<$e.length-1;Pt++){var _t=new RegExp("\\{"+Pt+"\\}","gm");ft=ft.replace(_t,$e[Pt+1])}j.MxUiVue.AcutPrintfNoFormat(ft,!0)}},m.loadImageMaterial=function(ue,Me){T.MxManager.getMxDbTextureManager().loadImage(ue,Me)},m.loadSVG=function(ue,Me,Je,$e){T.MxManager.getMxDbSvgManager().loadSVG(ue,Me,Je,$e)},m.initMxDbEntityType=function(ue){T.MxManager.getMxDbEntityClassHierarchy().init(ue)},m.initDynamicCreate=function(ue){T.MxManager.getMxDbEntityClassHierarchy().initDynamic(ue)},m.ceneratecursor=function(ue,Me,Je,$e){ue===void 0&&(ue=128),Me===void 0&&(Me=10),Je===void 0&&(Je=!0);var ft=document.createElement("canvas");ft.width=ft.height=ue,ft.style.background="transparent";var Pt=ft.getContext("2d"),_t=ue%2==0?-.5:0,Ue=Me%2==0?-.5:0;Pt.strokeStyle=$e||"#fff",Je&&(Pt.beginPath(),Pt.moveTo(ft.width/2+_t,_t),Pt.lineTo(ft.width/2+_t,ft.height+_t),Pt.stroke(),Pt.beginPath(),Pt.moveTo(_t,ft.height/2+_t),Pt.lineTo(ft.width+_t,ft.height/2+_t),Pt.stroke()),Pt.beginPath(),Pt.strokeRect(ue/2-Me/2+Ue,ue/2-Me/2+Ue,Me,Me),Pt.stroke();var Rt=new Image;return Rt.src=ft.toDataURL("image/png"),Rt.src},m.getMrxDbgUtilsClass=function(){return Be.MrxDbgUtils},m.getNumberColor=function(ue){return ue instanceof Object?ue.getHex&&(ue=ue.getHex()):typeof ue=="string"&&(ue=parseInt(ue)),ue},m.setloadImageFuction=function(ue){T.MxManager.setloadImageFuction(ue)}},{"./MrxDbgUtils":20,"./MxDrawCommands":21,"./MxDrawData":22,"./MxDrawObject":23,"./MxDrawObject2d":24,"./MxDrawObject3d":25,"./MxLocalFileLoad":28,"./MxManager":29,"./MxThreeJS":37,"./MxTools":38,"./MxVersion":40,"./MxWindowsEvent":41,"./Operate/MxCmdRunManager":48,"./Operate/MxJigCmdManager":54,"./Operate/MxJigGetLine":55,"./TempTest/MxTestJig":61,"./UI/MxUiObjectMobile":63,"./UI/MxUiObjectPC":64,"./UI/MxUiVue":65,three:19}],28:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxLocalDwgFileLoad=o.MxLocalFileLoad=o.MxLocalNodeJs=void 0;var a=b("./MxFun"),m=(c.prototype.init=function(P){this.loadFileCall=P.loadFileFun},c.prototype.loadFile=function(P,g,E,_,k){this.loadFileCall!=null?this.loadFileCall(P,g,E,_,k):k(void 0)},c);function c(){this.loadFileCall=null}o.MxLocalNodeJs=m;var x=(A.prototype.setPath=function(P){this.path=P},A.prototype.setBinary=function(P){this.isBinary=P},A.prototype.load=function(P,g,E,_){a.MxFun.getNodeJs().loadFile(this.path+P,this.isBinary,g,E,_)},A);function A(){this.path="",this.isBinary=!1}o.MxLocalFileLoad=x;var H=(F.prototype.setShowloading=function(P){this._isShowLoading=P},F.prototype.load=function(P,g){var E="$"+g+".mxb1.wgh";this._path=P,this._filename=g;var _=this;this.getFile(this._path,E,!1,function(k){typeof k=="string"?_.net.onStaticHeadMessage(k):console.log("mx error h1")},function(){console.log("mx get "+E+" faild")})},F.prototype.getDatas=function(){if(this._iGet>=this._dataNum)this._isShowLoading&&a.MxFun.hideLoading();else{var P=this._dataType[this._iGet];this._iGet++;var g=this,E=this._iGet+1,_="$"+this._filename+".mxb"+E+".wgh",k=P!=0;this.getFile(this._path,_,k,function(U){g.net.onStaticMessage(U),g.getDatas()},function(){g._dataNum=0,g._iGet=0,g._isShowLoading&&a.MxFun.hideLoading(),console.log("mx get "+_+" faild")})}},F.prototype.onRenderHead=function(P){var g=JSON.parse(P);this._dataType=g.type,this._dataNum=g.count,this._iGet=0,this._isShowLoading&&a.MxFun.showLoading(),this.getDatas()},F.prototype.getFile=function(P,g,E,_,k){var U=new x;U.setPath(P),U.setBinary(E),U.load(g,_,function(){},k)},F);function F(P){this.net=null,this._dataNum=0,this._iGet=0,this._dataType=[],this._path="",this._filename="",this._isShowLoading=!0,this.net=P}o.MxLocalDwgFileLoad=H},{"./MxFun":27}],29:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxManager=o.MxCpp=o.MxData=void 0;var a,m,c=b("./View/MxDbEntity"),x=b("./View/MxDbTextureManager"),A=b("./SVGLoader/MxSVGLoader");(m=a||(o.MxData=a={})).iSelectRenderOrder=5,m.iCADMeshRenderOrder=10,m.iCADCurveRenderOrder=20,m.iMxEntityRenderOrder=30,m.iGripRenderOrder=110,m.iDynJigRenderOrder=120;var H,F,P,g,E,_,k,U,C,S,Y,G,T,B=(D.prototype.init=function(N){this.imp=N},D.prototype.getMxCAD_MxCpp=function(){return this.imp},D.prototype.getMxCAD_App=function(){return this.imp.App},D.prototype.newMcGePoint3d=function(N){return this.imp?this.imp.newMcGePoint3d(N):null},D.prototype.decodeFromGb2312=function(N){return this.imp.decodeFromGb2312(N)},D.prototype.encodeToGb2312=function(N){return this.imp.encodeToGb2312(N)},D.prototype.getMcDbCurve=function(N){if(this.imp.App.objectIdIsKindOf(N,"McDbCurve"))return this.imp.App.objectIdToObject(N)},D);function D(){}o.MxCpp=B,F=H||(o.MxManager=H={}),P=[],g=null,_=[],k=void(E=0),U=new x.MxDbTextureManager,C=new A.MxSvgManager,S=new c.MxDbEntityClassHierarchy,Y=new B,G={},T=void 0,F.add=function(N){P.push(N)},F.setloadImageFuction=function(N){T=N},F.getLoadImageFuction=function(){return T},F.on=function(N,I){G[N]||(G[N]=[]),G[N].push(I)},F.callEvent=function(N,I){var h;if(G[N])return G[N].forEach(function(u){var v=u(I);h=h||v}),h},F.initMxCpp=function(N){Y.init(N)},F.getMxCpp=function(){return Y},F.allocId=function(){return++E},F.getMxDbEntityClassHierarchy=function(){return S},F.getMxDbTextureManager=function(){return U},F.getMxDbSvgManager=function(){return C},F.outDebugString=function(N){k==null?console.log(N):k(N)},F.setOutDebugCall=function(N){k=N},F.onLoad=function(){for(var N in P)P[N].onLoad("")},F.updateDisplay=function(){for(var N in P)P[N].updateDisplay()},F.currentMx=function(){return g},F.setCurrentMx=function(N){g=N},F.initResize=function(){for(var N in P)P[N].initResize()},F.addSelectEvent=function(N){_.push(N)},F.clearSelectEvent=function(){_=[]},F.callSelectObject=function(N){for(var I in _)if(_[I](N)==1)break},F.getMxObject=function(N){if(typeof N=="number"){for(var I in P)if(P[I].getId()===N)return P[I]}else for(var I in P)if(P[I].getCanvas()===N)return P[I];return null}},{"./SVGLoader/MxSVGLoader":59,"./View/MxDbEntity":69,"./View/MxDbTextureManager":74}],30:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxMaterial=void 0;var a,m=b("three");(function(c){c.shaderUniforms={crAmbient:{value:new m.Vector3(1,0,0)},crDiffuse:{value:new m.Vector3(1,0,0)},crSpecular:{value:new m.Vector3(1,0,0)}},c.m_arrSystemColors=new Array(0,16711680,16776960,65280,65535,255,16711935,16777215,8421504,12632256,16711680,16744319,13369344,13395558,10027008,10046540,8323072,8339263,4980736,4990502,16727808,16752511,13382400,13401958,10036736,10051404,8331008,8343359,4985600,4992806,16744192,16760703,13395456,13408614,10046464,10056268,8339200,8347455,4990464,4995366,16760576,16768895,13408512,13415014,10056192,10061132,8347392,8351551,4995328,4997670,16776960,16777087,13421568,13421670,10066176,10066252,8355584,8355647,5000192,5000230,12582656,14679935,10079232,11717734,7510272,8755532,6258432,7307071,3755008,4344870,8388352,12582783,6736896,10079334,5019904,7510348,4161280,6258495,2509824,3755046,4194048,10485631,3394560,8375398,2529536,6265164,2064128,5209919,1264640,3099686,65280,8388479,52224,6736998,39168,5019980,32512,4161343,19456,2509862,65343,8388511,52275,6737023,39206,5019999,32543,4161359,19475,2509871,65407,8388543,52326,6737049,39244,5020018,32575,4161375,19494,2509881,65471,8388575,52377,6737074,39282,5020037,32607,4161391,19513,2509890,65535,8388607,52428,6737100,39321,5020057,32639,4161407,19532,2509900,49151,8380415,39372,6730444,29337,5014937,24447,4157311,14668,2507340,32767,8372223,26316,6724044,19609,5010073,16255,4153215,9804,2505036,16383,8364031,13260,6717388,9881,5005209,8063,4149119,4940,2502476,255,8355839,204,6710988,153,5000345,127,4145023,76,2500172,4129023,10452991,3342540,8349388,2490521,6245529,2031743,5193599,1245260,3089996,8323327,12550143,6684876,10053324,4980889,7490713,4128895,6242175,2490444,3745356,12517631,14647295,10027212,11691724,7471257,8735897,6226047,7290751,3735628,4335180,16711935,16744447,13369548,13395660,10027161,10046617,8323199,8339327,4980812,4990540,16711871,16744415,13369497,13395634,10027122,10046597,8323167,8339311,4980793,4990530,16711807,16744383,13369446,13395609,10027084,10046578,8323135,8339295,4980774,4990521,16711743,16744351,13369395,13395583,10027046,10046559,8323103,8339279,4980755,4990511,3355443,5987163,8684676,11382189,14079702,16777215),c.m_arrDefUseMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),c.m_arrDefUseCurveMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),c.m_arrDefUseBasicMaterials=new Array(null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null,null),c.m_selectMaterial=new m.MeshPhongMaterial({color:255,opacity:.2,transparent:!0,side:m.DoubleSide}),c.m_mouseMoveMaterial=new m.MeshPhongMaterial({color:16776960,side:m.DoubleSide}),c.m_lockedMaterial=new m.MeshPhongMaterial({color:197379,side:m.DoubleSide}),c.m_samplePoints=new m.PointsMaterial({color:255,depthTest:!1,size:8}),c.m_samplePointsMouseMove=new m.PointsMaterial({color:16711680,depthTest:!1,size:12});var x=new m.MeshBasicMaterial({color:16777215,transparent:!0,depthTest:!1,side:m.DoubleSide,opacity:1,stencilWrite:!1,colorWrite:!1});c.getStencilMaterial=function(){return x},c.GetColorByIndex=function(A){return c.m_arrSystemColors[A]},c.GetColorMaterial=function(A){var H=c.m_arrDefUseMaterials[A];return H===null&&(H=new m.MeshLambertMaterial({color:c.m_arrSystemColors[A],side:m.DoubleSide}),c.m_arrDefUseMaterials[A]=H),H},c.GetBaseColorMaterial=function(A){var H=c.m_arrDefUseBasicMaterials[A];return H===null&&(H=new m.MeshBasicMaterial({color:c.m_arrSystemColors[A],side:m.DoubleSide}),c.m_arrDefUseMaterials[A]=H),H},c.GetCurveColorMaterial=function(A){var H=c.m_arrDefUseCurveMaterials[A];return H===null&&(H=new m.LineBasicMaterial({color:c.m_arrSystemColors[A],linewidth:1}),c.m_arrDefUseCurveMaterials[A]=H),H},c.GetSelectMaterial=function(){return c.m_selectMaterial},c.GetMouseMoveMaterial=function(){return c.m_mouseMoveMaterial},c.GetLockedMaterial=function(){return c.m_lockedMaterial},c.GetSamplePointsMaterial=function(){return c.m_samplePoints},c.GetSamplePointsMouseMoveMaterial=function(){return c.m_samplePointsMouseMove},c.createMaterial=function(A){var H=void 0;if(A==null)return H;function F(P,g){if(g.map!=null){var E=g.map,_=new m.TextureLoader().load(E);_.wrapS=_.wrapT=m.RepeatWrapping,P.map=_,P.side=m.DoubleSide}}return A.transparent!=0?A.transparent=!0:A.transparent=!1,A.name=="MeshPhongMaterial"?F(H=new m.MeshPhongMaterial(A),A):A.name=="MeshBasicMaterial"?F(H=new m.MeshBasicMaterial(A),A):A.name=="MeshDepthMaterial"?F(H=new m.MeshDepthMaterial(A),A):A.name=="MeshNormalMaterial"?F(H=new m.MeshNormalMaterial(A),A):A.name=="MeshLambertMaterial"?F(H=new m.MeshLambertMaterial(A),A):A.name=="MeshStandardMaterial"&&F(H=new m.MeshStandardMaterial(A),A),H}})(a||(o.MxMaterial=a={}))},{three:19}],31:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxHFileLoad=o.MxNet=o.MxNetBinMessageType=o.MxNetSend=o.MxNetMessage=o.MxNetMessageType=o.MxNetData=void 0;var a,m,c=b("three"),x=b("./MxFun"),A=b("pako"),H=b("./MxManager"),F=b("./MxDrawData"),P=(g.prototype.getId=function(){return this._dataView.getInt32(4,!0)},g.prototype.getVersion_MwBlobHead=function(){return this._dataView.getInt32(60,!0)},g.prototype.getVersion_MwBlobHeadDynLen=function(){return this._dataView.getInt32(4,!0)},g.prototype.getdPointCurveBuffersHead=function(){var D={};return D.ver=this._dataView.getInt32(4,!0),D.databaseIndex=this._dataView.getInt32(8,!0),D.zeroLayerIdIndex=this._dataView.getInt32(16,!0),D.datacount=this._dataView.getInt32(20,!0),D.datasize=this._dataView.getInt32(24,!0),D},g.prototype.getdPointMeshBuffersHead=function(){var D={};return D.ver=this._dataView.getInt32(4,!0),D.databaseIndex=this._dataView.getInt32(8,!0),D.id=this._dataView.getInt32(12,!0),D.zeroLayerIdIndex=this._dataView.getInt32(16,!0),D.datacount=this._dataView.getInt32(20,!0),D.datasize=this._dataView.getInt32(24,!0),D},g.prototype.getdPointTextureBuffersHead=function(){var D={};return D.ver=this._dataView.getInt32(4,!0),D.databaseIndex=this._dataView.getInt32(8,!0),D.zeroLayerIdIndex=this._dataView.getInt32(16,!0),D.datacount=this._dataView.getInt32(20,!0),D.datasize=this._dataView.getInt32(24,!0),D},g.prototype.getBlobHeadForMemorySectionsHead=function(D){var N={};return N.type=this._dataView.getInt32(D,!0),D+=4,N.ver=this._dataView.getInt32(D,!0),D+=4,N.databaseIndex=this._dataView.getInt32(D,!0),D+=4,N.nOffset=D,N},g.prototype.getMemorySectionsHead=function(){var D=this.getBlobHeadForMemorySectionsHead(0);return D.zeroLayerIdIndex=this._dataView.getInt32(D.nOffset,!0),D.nOffset+=4,D.datacount=this._dataView.getInt32(D.nOffset,!0),D.nOffset+=4,D.datasize=this._dataView.getInt32(D.nOffset,!0),D.nOffset+=4,D.datasize!=D.nOffset&&console.log("mx: sectionshead size assert(0)"),D},g.prototype.getMemorySectionHead=function(D){var N=this.getBlobHeadForMemorySectionsHead(D);return D=N.nOffset,N.pointCount=this._dataView.getInt32(D,!0),D+=4,N.layerId=this._dataView.getInt32(D,!0),D+=4,N.blkId=this._dataView.getInt32(D,!0),D+=4,N.memColor=this._dataView.getInt32(D,!0),D+=4,N.memId=this._dataView.getInt32(D,!0),D+=4,N.memType=this._dataView.getInt32(D,!0),D+=4,N.offset=D,N},g.prototype.getdPointTextureBufferDataHead=function(D){D+=4,D+=4,D+=4;var N={};return N.dataCount=this._dataView.getInt32(D,!0),D+=4,N.layerId=this._dataView.getInt32(D,!0),D+=4,N.blkId=this._dataView.getInt32(D,!0),D+=4,N.offset=D,N},g.prototype.getdPointCurveBufferDataHead=function(D){D+=4,D+=4,D+=4;var N={};return N.pointCount=this._dataView.getInt32(D,!0),D+=4,N.layerId=this._dataView.getInt32(D,!0),D+=4,N.blkId=this._dataView.getInt32(D,!0),D+=4,N.offset=D,N},g.prototype.getdPointMeshBufferDataHead=function(D){D+=4,D+=4,D+=4;var N={};return N.pointCount=this._dataView.getInt32(D,!0),D+=4,N.layerId=this._dataView.getInt32(D,!0),D+=4,N.blkId=this._dataView.getInt32(D,!0),D+=4,N.offset=D,N},g.prototype.getDatabaseIndex=function(){return this._dataView.getInt32(8,!0)},g.prototype.getColorIndex=function(){return this._dataView.getInt32(24,!0)},g.prototype.getBufferType=function(){return this._dataView.getInt32(32,!0)},g.prototype.getIsSketchEntity=function(){return this._dataView.getInt32(40,!0)},g.prototype.getLayerId=function(){return this._dataView.getInt32(44,!0)},g.prototype.getBlockId=function(){return this._dataView.getInt32(48,!0)},g.prototype.getVertexBufferSize=function(){return this._dataView.getInt32(12,!0)},g.prototype.getIndexBufferSize=function(){return this._dataView.getInt32(16,!0)},g.prototype.getZeroLayerId=function(){return this._dataView.getInt32(52,!0)},g.prototype.getSelectMark=function(){return this._dataView.getInt32(56,!0)},g.prototype.getMateria=function(){var D=this._dataView.getInt32(36,!0);if(D==0)return"";for(var N=[],I=0;I<D;I++){var h=String.fromCharCode(this._dataView.getUint8(80+I));N.push(h)}return N.join("")},g.prototype.getDrawDataOffset=function(){return this._dataView.getInt32(36,!0)+80},g.prototype.getMesh=function(){var D=this._dataView.getInt32(4,!0),N=this._dataView.getInt32(32,!0)==0,I={},h=this._dataView.getInt32(12,!0),u=this._dataView.getInt32(16,!0);if(h===0||u===0)return I.size=80,I;var v,M=new c.Geometry,j=80;v=N?h/4/8:h/4/2;for(var z=0;z<v;z++){var J=this._dataView.getFloat32(j+0,!0),te=this._dataView.getFloat32(j+4,!0),X=0;N?(X=this._dataView.getFloat32(j+8,!0),this._dataView.getFloat32(j+12,!0),this._dataView.getFloat32(j+16,!0),this._dataView.getFloat32(j+20,!0),this._dataView.getFloat32(j+24,!0),this._dataView.getFloat32(j+28,!0),j+=32):j+=8;var se=new c.Vector3(J,te,X);M.vertices.push(se)}var ve=u/4;for(z=0;z<ve;z+=3){var Ee=this._dataView.getInt32(j,!0);j+=4;var we=this._dataView.getInt32(j,!0);j+=4;var Be=this._dataView.getInt32(j,!0);j+=4;var re=new c.Face3(Ee,we,Be);M.faces.push(re)}var fe=this.getIsSketchEntity();return I.size=j,I.geometry=M,I.id=D,I.isSketchEntity=fe,I.nColorIndex=this._dataView.getInt32(24,!0),I},g.prototype.getCurve=function(D){var N,I=this._dataView.getInt32(32,!0),h=this.getIsSketchEntity(),u=I==0,v={};if((N=u?this._dataView.getInt32(20,!0)/4/3:this._dataView.getInt32(20,!0)/4/2)<2)return v;for(var M=new c.Geometry,j=D,z=0;z<N;z++){var J=this._dataView.getFloat32(j,!0);j+=4;var te=this._dataView.getFloat32(j,!0);j+=4;var X=0;u&&(X=this._dataView.getFloat32(j,!0),j+=4),M.vertices.push(new c.Vector3(J,te,X))}var se=this._dataView.getInt32(4,!0);return v.size=j,v.geometry=M,v.id=se,v.isSketchEntity=h,v.colorIndex=this._dataView.getInt32(28,!0),v},g);function g(D){this._dataView=D}o.MxNetData=P,(m=a||(o.MxNetMessageType=a={})).kAddLayer="00000007",m.kClearLayer="00000008",m.kHideLayer="00000009",m.kShowLayer="00000010",m.kUpdateDisplayRange="00000011",m.kCallJsReturn="00000012",m.kLayerData="00000013",m.kSendDebugString="00000014",m.kShowLoading="00000015",m.kHideLoading="00000016",m.kSelectObject="00000017",m.kGlRenderHead="00000018",m.kUserLoginResult="00000019",m.kOpenFileResult="00000020",m.kServerReturn="00000021",m.kMxCADLayerData="00000056",m.kMxCADSystemVariable="00000057";var E=(_.prototype.setJsRetCall=function(D,N,I){this.serverJsRetCall.set(N+I,D)},_.prototype.onSocketErrort=function(){this.serverJsRetCall.forEach(function(D){D(void 0)}),this.serverJsRetCall=new Map},_.prototype.Do=function(D){var N=this.net.getCurrentDatabaseId();if(N==-1){var I=D.substring(0,4);N=parseInt(I)}var h=D.substring(4,12),u=D.substring(12);return this.messageCall[h]!=null&&(this.messageCall[h](u,N),!0)},_);function _(D,N){this.messageCall=new Map,this.serverJsRetCall=new Map,this.net=null,this.net=N;var I=this;this.messageCall[a.kUpdateDisplayRange]=function(h){if(!I.net.isTzDwgStaticFile()){h=h.replace(/\\/g,"\\\\");try{var u=JSON.parse(h);if(u!=null&&D.is2D()){D.initCAD2Doc(new c.Matrix4),u.newbrownermode?u.DToSMat?F.MxDrawData.m_isCorrectLargeCoordinates?(D.intiDoc2Wold(new c.Matrix4),D.initCAD2Doc(u.DToSMat)):D.intiDoc2Wold(u.DToSMat):D.intiDoc2Wold(new c.Matrix4):D.intiDoc2Wold(u.DToWMat),D.initializingObjectMatrix(),D.updateCameraDisplayRange(new c.Vector3(+u.pt1[0],+u.pt1[1],+u.pt1[2]),new c.Vector3(+u.pt2[0],+u.pt2[1],+u.pt2[2]),+u.viewangle),D.initAllLayoutName(u.layout),D.updateDisplay(!0);var v=x.MxFun.getUiObj();v!=null&&(v.SetLayoutData(u.layout),v.UpDisplayLayout())}}catch{console.log("UpdateDisplayRange exception")}}},this.messageCall[a.kCallJsReturn]=function(h){if(h.length!=0){var u=JSON.parse(h);u.cmd.length==0&&(u.cmd="__mx_loadcode");var v=u.cmd+u.count,M=I.serverJsRetCall.get(v);M&&(I.serverJsRetCall.delete(v),typeof u.ret=="string"&&(u.ret=u.ret.replace(/\'/g,'"')),M(u.ret))}else console.log("assert(0),kCallJsReturn return empty")},this.messageCall[a.kSendDebugString]=function(h){H.MxManager.outDebugString(h)},this.messageCall[a.kUserLoginResult]=function(h){D.userLoginResult(h)},this.messageCall[a.kOpenFileResult]=function(h){D.openFileResult(h)},this.messageCall[a.kServerReturn]=function(h){D.serverReturn(h)},this.messageCall[a.kShowLoading]=function(h){I.net.isTzDwgStaticFile()||x.MxFun.showLoading()},this.messageCall[a.kHideLoading]=function(h){I.net.isTzDwgStaticFile()||(x.MxFun.hideLoading(),D.callInitCompleteEvent())},this.messageCall[a.kSelectObject]=function(h){var u=JSON.parse(h);H.MxManager.callSelectObject(parseInt(u.id))},this.messageCall[a.kGlRenderHead]=function(h){D.isStaticLocalLoad()?D.getStaticLocalNet().onRenderHead(h):(I.net.isTzDwgStaticFile()?D.getStaticLoadTzNet():D.getStaticNet()).onRenderHead(h)},this.messageCall[a.kMxCADSystemVariable]=function(h,u){D.sysVariable().OnMessageMxCADSystemVariable(h)},this.messageCall[a.kLayerData]=function(h,u){if(u==0){if(D.addLayerInfoComplete(),(z=JSON.parse(h))!=null){if(!z.isSketch){var v=z.list;for(var M in v)D.addLayerInfo(v[M].id,v[M].colorvalue,v[M].name),v[M].zerolayer==1&&D.setZeroLayerId(v[M].id)}z.isSketch||D.callEvent("uiSetLayerData",z.list);var j=x.MxFun.getUiObj();j!=null&&(z.isSketch?j.SetSketchLayerData(z.list):j.SetLayerData(z.list),j.UpDisplayLayer())}}else{var z,J=D.getExtRefManager().getLayers(u);if(J.initComplete(),(z=JSON.parse(h))!=null)for(var M in v=z.list)J.add(v[M].id,v[M].colorvalue,v[M].name),v[M].zerolayer==1&&J.setZeroLayerId(v[M].id)}}}o.MxNetMessage=E;var k,U,C=(S.prototype.setWebSocket=function(D){this._webSocket=D},S.prototype.UndoMark=function(){this._webSocket!=null&&this._webSocket.send(this.SendType.kUndoMark+"")},S.prototype.DoCommand=function(D,N,I){this._webSocket!=null&&(I!=null?(this._callCount++,200<this._callCount&&(this._callCount=1),this._msg.setJsRetCall(I,D,this._callCount),N==null&&(N=""),this._webSocket.send(this.SendType.kCmdEx+","+D+","+this._callCount+","+N)):N==null?this._webSocket.send(this.SendType.kCmd+","+D):this._webSocket.send(this.SendType.kCmd+","+D+","+N))},S.prototype.OpenFile=function(D){this._webSocket!=null&&this._webSocket.send(this.SendType.kOpenFile+","+D)},S.prototype.UserLogin=function(D,N,I){if(this._webSocket!=null){var h={};h.IdentitySign=D,h.RandomToken=N??"",h.Init=I??"",this._webSocket.send(this.SendType.kUserLogin+","+JSON.stringify(h))}},S.prototype.Init=function(D){this._webSocket!=null&&this._webSocket.send(this.SendType.kInit+","+D)},S.prototype.CallServerJS=function(D,N,I){this._webSocket!=null&&(I==null?N==null||N==null||N.length==0?this._webSocket.send(this.SendType.kCallJS+',{"command":"'+D+'","param":"{}"}'):this._webSocket.send(this.SendType.kCallJS+',{"command":"'+D+'","param":'+N+"}"):(this._callCount++,200<this._callCount&&(this._callCount=1),this._msg.setJsRetCall(I,D,this._callCount),N==null||N==null||N.length==0?this._webSocket.send(this.SendType.kCallJS+',{"command":"'+D+'","param":"{}","count":"'+this._callCount+'"}'):this._webSocket.send(this.SendType.kCallJS+',{"command":"'+D+'","param":'+N+',"count":"'+this._callCount+'"}')))},S.prototype.CallLoadCodeToServer=function(D,N){this._webSocket!=null&&(this._msg.setJsRetCall(N,"__mx_loadcode",0),D!=null&&D!=null&&D.length!=0&&this._webSocket.send(this.SendType.kCallJS+","+D))},S.prototype.DeleteObject=function(D){this._webSocket!=null&&this._webSocket.send(this.SendType.kDelete+","+D)},S.prototype.SelectObject=function(D){this._webSocket!=null&&this._webSocket.send(this.SendType.kSelect+","+D)},S.prototype.QuitSelectObject=function(D){this._webSocket!=null&&this._webSocket.send(this.SendType.kQuitSelect+","+D)},S.prototype.SendDragDrawEntity=function(D){this._webSocket!=null&&this._webSocket.send(this.SendType.kAddDragDraw+","+D)},S.prototype.SendDragDrawRequest=function(){this._webSocket!=null&&(this.SendMousePickRay(),this._webSocket.send(this.SendType.kRequestDragDraw))},S.prototype.SendDragDrawDetermine=function(){this._webSocket!=null&&(this.SendMousePickRay(),this._webSocket.send(this.SendType.kDetermineDragDraw))},S.prototype.SendDragDrawCancel=function(){this._webSocket!=null&&this._webSocket.send(this.SendType.kCancelDragDraw)},S.prototype.SendMousePickRay=function(){this._webSocket},S);function S(D,N){this.SendType={},this._callCount=1,this._webSocket=D,this._msg=N,this.SendType.kCmd=0,this.SendType.kDelete=1,this.SendType.kSelect=2,this.SendType.kOpenFile=3,this.SendType.kGetDemoList=4,this.SendType.kCallJS=5,this.SendType.kAddDragDraw=6,this.SendType.kRequestDragDraw=7,this.SendType.kMousePickRay=8,this.SendType.kDetermineDragDraw=9,this.SendType.kCancelDragDraw=10,this.SendType.kQuitSelect=11,this.SendType.kInit=12,this.SendType.kCmdEx=13,this.SendType.kUserLogin=14,this.SendType.kUndoMark=15}o.MxNetSend=C,(U=k||(o.MxNetBinMessageType=k={})).eBlockRef=10,U.eEntitysData=14,U.eAddEntityFor2dPointTextureBuffers=15,U.eMxNewMemorySections=16,U.kMxCADBlockRef=56,U.kMxCADMemorySections=57,U.kMxCADMemorySectionsFromChange=59,U.kMxCADNotUseMemorySectionsForChage=61,U.kMxCADEntityDisplayDatas=62;var Y=(G.prototype.setCurrentDatabaseId=function(D){this._iCurrentDatabaseId=D},G.prototype.getMxDrawObject=function(){return this._mx},G.prototype.getCurrentDatabaseId=function(){return this._iCurrentDatabaseId},G.prototype.isTzDwgStaticFile=function(){return this._iCurrentDatabaseId!=-1},G.prototype.onBinMessage=function(D){var N=this._mx,I=A.inflate(D),h=new DataView(I.buffer),u=h.getInt32(0,!0);this._binMessageCall.has(u)?this._binMessageCall.get(u)(h,this._iCurrentDatabaseId):(this._iCurrentDatabaseId==-1&&(u==0?N.mxWebAddEntity(h):u==6?N.removeEntityFromServer(h):u==11&&N.getExtRefManager().createExternalReferences(h)),u==12?N.mxWebAddEntityFor2dPointCurveBuffers(h,this._iCurrentDatabaseId):u==13?N.mxWebAddEntityFor2dPointMeshBuffers(h,this._iCurrentDatabaseId):u==8?N.mxWebAddEntityFor2dPointCurveBuffer(h,this._iCurrentDatabaseId):u==9?N.mxWebAddEntityFor2dPointMeshBuffer(h,this._iCurrentDatabaseId):u==k.eBlockRef&&N.mxWebCreateAllBlocks(h,this._iCurrentDatabaseId))},G.prototype.socket_onErrort=function(){this._msg.onSocketErrort()},G.prototype.socket_onMessageImp=function(D,N){if(N===void 0&&(N=!1),typeof D=="string")this._msg.Do(D);else if(N)this.onBinMessage(D);else{var I=new FileReader;I.readAsArrayBuffer(D);var h=this;I.onload=function(u){h._mx.updateDisplay(),h.onBinMessage(I.result)}}this._mx.updateDisplay()},G.prototype.initBinMessage=function(){var D=this._mx;this._binMessageCall.set(k.eEntitysData,function(N,I){D.mxWebEntitysData(N,I)}),this._binMessageCall.set(k.eAddEntityFor2dPointTextureBuffers,function(N,I){D.mxWebAddEntityFor2dPointTextureBuffers(N,I)}),this._binMessageCall.set(k.eMxNewMemorySections,function(N,I){D.mxWebAddEntityForMemorySections(N,I)})},G.prototype.init=function(D,N){var I=this;this._mx=D,this._msg=new E(D,this),this.initBinMessage(),N&&(this._webSocket=new WebSocket(x.MxFun.getMxServer()),this._webSocket.onopen=function(){var h=I._mx.getIniParam();if(h.length!=0){for(var u="{",v=h.length,M=0;M<v;M++)u=M==0?u+'"'+h[M][0]+'":"'+h[M][1]+'"':u+',"'+h[M][0]+'":"'+h[M][1]+'"';u+="}",I._send.Init(u)}},this._webSocket.onmessage=function(h){I.socket_onMessageImp(h.data)},this._webSocket.onerror=function(){console.log("mx: socket error"),I.socket_onErrort()}),this._send=new C(this._webSocket,this._msg)},G.prototype.closeWebSocket=function(){this._webSocket&&(this._send.setWebSocket(null),this._webSocket.close(),this._webSocket=null)},G.prototype.getOnMessage=function(){return this._msg},G.prototype.getSend=function(){return this._send},G.prototype.onStaticMessage=function(D){try{return this.socket_onMessageImp(D,!0),!0}catch(N){return console.log("mx file data error!"),console.log(N),!1}},G.prototype.onStaticHeadMessage=function(D){return typeof D=="string"&&this._msg.Do(D)},G);function G(){this._webSocket=null,this._send=null,this._msg=null,this._mx=null,this._binMessageCall=new Map,this._iCurrentDatabaseId=-1}o.MxNet=Y;var T=(B.prototype.stopAllLoading=function(){this._isStopLoading||(this._isStopLoading=!0,this._isShowLoading&&x.MxFun.hideLoading())},B.prototype.setShowloading=function(D){this._isShowLoading=D},B.prototype.showLoading=function(){this._isShowLoading&&x.MxFun.showLoading()},B.prototype.hideLoading=function(D){this._isStopLoading||(this._isShowLoading&&x.MxFun.hideLoading(),this.net.getMxDrawObject().callInitCompleteEvent(),this.net.getMxDrawObject().callOpenFileComplete(D))},B.prototype.setRequestHeader=function(D){this._requestHeader=D},B.prototype.setUrlParam=function(D){this._urlParam=D},B.prototype.load=function(D,N){var I=x.MxFun.curPath(),h=x.MxFun.dwgDir(),u=x.MxFun.getStaticServer(),v="/buf/";if(D.substring(D.lastIndexOf(".")+1).toLowerCase()=="wgh"){v="/";var M=D.substring(0,D.indexOf(".mxb1.wgh")).split("/");(D=M.length==1?M[0]:(u=D.substring(0,D.lastIndexOf("/")),M[M.length-1]))[0]=="$"&&(D=D.substring(1))}var j="$"+(D=encodeURIComponent(D))+".mxb1.wgh";u.length!=0?I=u+v:h.length!=0?I=I+"/"+h+v:I+=v,this._path=I,this._filename=D,1<(this._staticLoadingOpenFiles=N).length&&(j=N[0],this._path=void 0);var z=this;this.getFile(this._path,j,function(J){if(!z._isStopLoading)return typeof J!="string"?(console.log("mx error h1"),void z.hideLoading(4)):z.net.onStaticHeadMessage(J)?void 0:(console.log("mx error h1:"+J),void z.hideLoading(2))},function(){z.hideLoading(3),console.log("mx get "+j+" faild")})},B.prototype.getData=function(){if(this._isStopLoading)this.hideLoading(5);else if(this._iGet>=this._dataNum)this.hideLoading(0);else{var D=this._dataType[this._iGet];this._iGet++;var N=this,I=this._iGet+1,h="$"+this._filename+".mxb"+I+".wgh";if(1<this._staticLoadingOpenFiles.length){if(this._iGet>=this._staticLoadingOpenFiles.length)return console.log("Mx staticLoadingOpenFiles error!"),void this.hideLoading(7);h=this._staticLoadingOpenFiles[this._iGet]}var u=h;this._path&&(u=this._path+h);var v=u.substring(0,u.lastIndexOf("/")+1);if(this.net.getMxDrawObject().setCurrentLoadUrl(v),D==0)this.getFile(this._path,h,function(z){N._isStopLoading||(N.net.onStaticMessage(z)||(console.log(this._path),console.log(h)),N.getData())},function(){N._dataNum=0,N._iGet=0,N.hideLoading(8),console.log("mx get "+h+" faild")});else{var M=new XMLHttpRequest,j=h;this._path&&(j=this._path+h),this._urlParam.length!=0?M.open("GET",j+this._urlParam):M.open("GET",j),F.MxDrawData.m_isRequestHeaderCacheControl&&M.setRequestHeader("Cache-Control","max-age=7200"),this._requestHeader.length!=0&&M.setRequestHeader("usertoken",this._requestHeader),M.responseType="arraybuffer",M.onload=function(){N._isStopLoading||(N.net.onStaticMessage(M.response)||console.log(j),N.getData())},M.addEventListener("error",function(z){N._dataNum=0,N._iGet=0,N.hideLoading(9),console.log("mx get "+h+" faild")},!1),M.send()}}},B.prototype.onRenderHead=function(D){if(!this._isStopLoading){var N=JSON.parse(D);this._dataType=N.type,this._dataNum=N.count,this._iGet=0,this.showLoading(),this.getData()}},B.prototype.getFile=function(D,N,I,h){var u=new c.FileLoader(this.manager);u.setPath(D);var v=N;this._urlParam.length!=0&&(v=N+this._urlParam),this._requestHeader.length!=0&&(u.requestHeader={usertoken:this._requestHeader}),u.load(v,I,function(){},h)},B);function B(D,N){this.net=null,this.manager=null,this._dataNum=0,this._iGet=0,this._dataType=[],this._path="",this._filename="",this._staticLoadingOpenFiles=[],this._isShowLoading=!0,this._requestHeader="",this._isStopLoading=!1,this._urlParam="",this.net=D,this.manager=N!==void 0?N:c.DefaultLoadingManager}o.MxHFileLoad=T},{"./MxDrawData":22,"./MxFun":27,"./MxManager":29,pako:1,three:19}],32:[function(b,n,o){var a,m;Object.defineProperty(o,"__esModule",{value:!0}),o.MxShader=void 0,(m=a||(o.MxShader=a={})).VSHADER_COLOR_POINT=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
attribute vec2 position; 
attribute vec3 color; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,m.VSHADER_COLOR_POINT_BYLAYER=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,m.FSHADER_COLOR_POINT=` precision highp float; 
varying vec4 vColor; 
void main() { 
gl_FragColor = vColor; 
} 
`,m.VSHADER_COLOR_POINT_TEXTURE=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
attribute vec2 position; 
attribute vec2 uv; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
varying vec2 vUv; 
void main(){ 
vUv = uv; 
mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,m.FSHADER_COLOR_POINT_TEXTURE=` precision highp float; 
varying vec2 vUv; 
uniform sampler2D texture; 
void main() { 
gl_FragColor = texture2D( texture, vUv ); 
} 
`,m.VSHADER_COLOR_POINT_CLIP=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec3 color; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,m.VSHADER_COLOR_POINT_BYLAYER_CLIP=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,m.FSHADER_COLOR_POINT_CLIP=`precision highp float; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main() { 
if(gl_FragCoord.x > vCp1.x && gl_FragCoord.x < vCp2.x && gl_FragCoord.y > vCp1.y && gl_FragCoord.y < vCp2.y) 
gl_FragColor = vColor; 
else 
discard; 
} 
`,m.VSHADER_COLOR_POINT_FORMXCAD=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
gl_PointSize = 1.0;
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,m.FSHADER_COLOR_POINT_FORMXCAD=` precision highp float; 
varying vec4 vColor; 
void main() { 
gl_FragColor = vColor; 
} 
`,m.VSHADER_COLOR_POINT_CLIP_FORMXCAD=` precision highp float; 
uniform mat4 modelViewMatrix; 
uniform mat4 projectionMatrix; 
uniform vec3 color; 
uniform vec2 clippt1; 
uniform vec2 clippt2; 
uniform float vieww; 
uniform float viewh; 
attribute vec2 position; 
attribute vec4 tran1; 
attribute vec4 tran2; 
attribute vec4 tran3; 
attribute vec4 tran4; 
attribute float ishide; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main(){ 
 mat4 tran; 
tran[0][0] = tran1.x;tran[0][1] = tran1.y;tran[0][2] = tran1.z;tran[0][3] = tran1.w; 
tran[1][0] = tran2.x;tran[1][1] = tran2.y;tran[1][2] = tran2.z;tran[1][3] = tran2.w; 
tran[2][0] = tran3.x;tran[2][1] = tran3.y;tran[2][2] = tran3.z;tran[2][3] = tran3.w; 
tran[3][0] = tran4.x;tran[3][1] = tran4.y;tran[3][2] = tran4.z;tran[3][3] = tran4.w; 
vec4 pt1 = projectionMatrix * modelViewMatrix * vec4( clippt1.x,clippt1.y,0.0, 1.0 ); 
vec4 pt2 = projectionMatrix * modelViewMatrix * vec4( clippt2.x,clippt2.y,0.0, 1.0 ); 
vCp1 = vec2(pt1.x * vieww + vieww,pt1.y * viewh + viewh); 
vCp2 = vec2(pt2.x * vieww + vieww,pt2.y * viewh + viewh); 
if(ishide > 0.1) 
   vColor = vec4(color,0.0); 
else 
   vColor = vec4(color,1.0); 
gl_Position = projectionMatrix * modelViewMatrix * tran *  vec4( position.x,position.y,0.0, 1.0 ); 
} 
`,m.FSHADER_COLOR_POINT_CLIP_FORMXCAD=`precision highp float; 
varying vec4 vColor; 
varying vec2 vCp1; 
varying vec2 vCp2; 
void main() { 
if(gl_FragCoord.x > vCp1.x && gl_FragCoord.x < vCp2.x && gl_FragCoord.y > vCp1.y && gl_FragCoord.y < vCp2.y) 
gl_FragColor = vColor; 
else 
discard; 
} 
`},{}],33:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxStencilObject=void 0;var a=b("three"),m=b("./MxMaterial"),c=(x.prototype.object_onAfterRender=function(A){var H=this.aryMeshStencil;if(H&&0<H.length){A.getContext();var F=A.state.buffers;F.stencil.setLocked(!1),F.depth.setTest(!0),F.stencil.setTest(!1)}},x.prototype.object_onBeforeRender=function(A,H,F){var P=this.aryMeshStencil;if(P&&0<P.length){var g=A.getContext(),E=A.state.buffers;E.color.setMask(!1),E.color.setLocked(!0),E.depth.setTest(!1),E.stencil.setTest(!0),E.stencil.setMask(255),E.stencil.setClear(0),A.clearStencil(),E.stencil.setLocked(!0);var _=1,k=!0;P.forEach(function(U){k?(k=!1,E.stencil.setFunc(g.ALWAYS,_,255),E.stencil.setOp(g.KEEP,g.KEEP,g.REPLACE)):(E.stencil.setFunc(g.EQUAL,_,255),E.stencil.setOp(g.KEEP,g.KEEP,g.INCR),_++),A.mxRenderObject(U,H,F,U.material,null)}),E.color.setLocked(!1),E.color.setMask(!0),E.stencil.setMask(0),E.stencil.setFunc(g.EQUAL,_,255)}},x.prototype.associateObject=function(A,H){var F=this;H.forEach(function(g){if(3<=g.length){var E=new a.Shape(g),_=new a.ShapeGeometry(E),k=new a.Mesh(_,m.MxMaterial.getStencilMaterial());F.aryMeshStencil.push(k)}});var P=this;A.onBeforeRender=function(g,E,_){P.object_onBeforeRender(g,E,_)},A.onAfterRender=function(g){P.object_onAfterRender(g)}},x);function x(){this.aryMeshStencil=[]}o.MxStencilObject=c},{"./MxMaterial":30,three:19}],34:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxString=void 0;var a=(m.prototype.Find=function(c){return this.m_val.indexOf(c)},m.prototype.Left=function(c){return this.m_val.substring(0,c)},m.prototype.Right=function(c){return this.m_val.substring(this.m_val.length-c,this.m_val.length)},m.prototype.TrimLeft=function(c){for(;0<this.m_val.length&&this.m_val[0]==c;)this.m_val=this.m_val.slice(1)},m.prototype.TrimRight=function(c){for(;0<this.m_val.length&&this.m_val[this.m_val.length-1]==c;)this.m_val=this.m_val.slice(0,-1)},m.prototype.AnalyzeString=function(c){return this.m_val.split(c)},m.prototype.IsEmpty=function(){return this.m_val.length==0},m.prototype.MakeUpper=function(){this.m_val=this.m_val.toUpperCase()},m.prototype.MakeLower=function(){this.m_val=this.m_val.toLowerCase()},m.prototype.GetLength=function(){return this.m_val.length},m);function m(c){this.m_val="",c!=null&&(this.m_val=c)}o.MxString=a},{}],35:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxSystemVariable=void 0;var a=b("three"),m=b("./Operate/McEdJigOsnap"),c=(x.prototype.init=function(A){this.m_mxObj=A},x.prototype.getAllLinetypeName=function(){return this.m_vecLinetype},x.prototype.getSysVarBool=function(A){return this.m_data[A]!=null&&this.m_data[A]},x.prototype.setSysVarBool=function(A,H){this.m_data[A]=H},x.prototype.setSysVarPoint=function(A,H){this.m_data[A]=H},x.prototype.OnMessageMxCADSystemVariable=function(A){this.m_vecLinetype=[];var H=JSON.parse(A);if(H!=null){var F=H.vecLinetypeName;for(var P in F)this.m_vecLinetype.push(F[P]);this.m_data.CELTYPE=H.curLinetypeName,this.m_data.CLAYER=H.clayer,this.m_data.CECOLOR=H.cecolor,this.m_data.CECOLORINDEX=H.cecolorindex}this.m_mxObj.callEvent("loadSystmeVariableComplete")},x.prototype.getSysVarPoint=function(A){return this.m_data[A]==null?new a.Vector3(0,0,0):this.m_data[A]},x.prototype.setSysVarNumber=function(A,H){this.m_data[A]=H},x.prototype.getSysVarNumber=function(A){return this.m_data[A]==null?0:this.m_data[A]},x.prototype.getSysVar=function(A){return this.m_data[A]},x.prototype.setSysVar=function(A,H){this.m_data[A]=H},x);function x(){this.m_data={},this.m_mxObj=null,this.m_vecLinetype=[],this.m_data.GETPOINTSTATUS=0,this.m_data.LASTPOINT=void 0,this.m_data.LASTMOVEPOINT=void 0,this.m_data.CELTYPE="Continuous",this.m_data.CLAYER="0",this.m_data.CECOLOR=67108863,this.m_data.CECOLORINDEX=7,this.m_data.OSMODE=m.MxOsnapDefine.OsModeAll}o.MxSystemVariable=c},{"./Operate/McEdJigOsnap":43,three:19}],36:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxTempMarkDraw=void 0;var a=b("three"),m=b("./MxFun"),c=b("./MxThreeJS"),x=(A.prototype.init=function(H){this.threeObjectGroup=new a.Object3D,H.addObject(this.threeObjectGroup)},A.prototype.clear=function(H){H||m.MxFun.removeThreejsAllChildren(this.threeObjectGroup)},A.prototype.drawLine=function(H,F,P,g){P===void 0&&(P=16777215),g===void 0&&(g=1),this.threeObjectGroup.add(c.MxThreeJS.createLine(H,F,P,g))},A.prototype.drawCircle=function(H,F,P){this.threeObjectGroup.add(c.MxThreeJS.createCircle(H,F,P))},A.prototype.drawEntity=function(H){this.threeObjectGroup.add(H)},A.prototype.drawCircleMark=function(H,F,P){this.drawCircle(H,F,P);var g=new a.Vector3(.3*F,0,0);g.applyAxisAngle(new a.Vector3(0,0,1),60*Math.PI/180);var E=new a.Vector3(.3*F,0,0);E.applyAxisAngle(new a.Vector3(0,0,1),30*Math.PI/180);var _=new a.Vector3(F,0,0);_.applyAxisAngle(new a.Vector3(0,0,1),45*Math.PI/180);var k=H.clone().add(g),U=H.clone().add(E),C=H.clone().add(_);this.drawLine(H,k,P),this.drawLine(H,U,P),this.drawLine(H,C,P)},A);function A(){this.threeObjectGroup=null}o.MxTempMarkDraw=x},{"./MxFun":27,"./MxThreeJS":37,three:19}],37:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxThreeJS=void 0;var a,m,c=b("three"),x=b("./MxFun");function A(H){return Math.pow(2,Math.floor(Math.log(H)/Math.LN2))}(m=a||(o.MxThreeJS=a={})).createLine=function(H,F,P,g){var E,_=new c.Geometry;return E=g&&g!=1||g==0?new c.LineBasicMaterial({color:P,transparent:!0,depthTest:!1,opacity:g}):new c.LineBasicMaterial({color:P,transparent:!0,depthTest:!1}),_.vertices.push(H,F),new c.Line(_,E)},m.createSolid=function(H,F,P){if(H.length<3)return null;var g,E=new c.Shape(H.map(function(k){var U=k.x,C=k.y;return new c.Vector2(U,C)})),_=new c.ShapeGeometry(E);return g=P&&P!=1||P==0?new c.MeshPhongMaterial({color:F,side:c.DoubleSide,transparent:!0,depthTest:!1,opacity:P}):new c.MeshPhongMaterial({color:F,side:c.DoubleSide,transparent:!0,depthTest:!1}),new c.Mesh(_,g)},m.createPoint=function(H,F,P){P===void 0&&(P=3);var g=new c.Geometry;g.vertices.push(H);var E=new c.PointsMaterial({color:F,size:P});return new c.Points(g,E)},m.createDashedLine=function(H,F,P,g,E){var _=new c.Geometry;_.vertices.push(H,F);var k=new c.Line(_,new c.LineDashedMaterial({color:P,dashSize:g,gapSize:E,transparent:!0,depthTest:!1}));return k.computeLineDistances(),k},m.createCircle=function(H,F,P){var g=new c.CircleGeometry(F,64,3,2*Math.PI),E=new c.LineBasicMaterial({color:P,transparent:!0,depthTest:!1});g.vertices.shift();var _=new c.LineLoop(g,E);return _.position.x=H.x,_.position.y=H.y,_.position.z=H.z,_},m.createSolidCircle=function(H,F,P){var g=new c.MeshBasicMaterial({color:P,transparent:!0,depthTest:!1}),E=new c.CircleGeometry(F,64,3,2*Math.PI),_=new c.Mesh(E,g);return _.position.x=H.x,_.position.y=H.y,_.position.z=H.z,_},m.clacTextSize=function(H,F){var P=document.createElement("canvas").getContext("2d");if(P==null)return F;var g=x.MxFun.formatString("normal {0}px Arial","256");return P.font=g,P.measureText(H).width*F/256},m.clacTextSpriteSize=function(H,F,P){F<=1e-8&&(F=1);var g=document.createElement("canvas"),E=g.getContext("2d"),_=x.MxFun.formatString("normal {0}px Arial","256");E.font=_;var k=F/256,U=0,C=[],S=!0,Y=0;if(P){U=P;for(var G=0,T=0,B=0;T<H.length;T++)(D=E.measureText(H.substring(G,T+1))).width*k>U&&(Y+=(D.fontBoundingBoxAscent+D.fontBoundingBoxDescent)*k,C.push(H.substring(G,T)),G=T,B++);if(G<T){var D=E.measureText(H.substring(G,T));C.push(H.substring(G,T)),Y+=(D.fontBoundingBoxAscent+D.fontBoundingBoxDescent)*k,B++}S=B<=1}else Y=F,U=(D=E.measureText(H)).width*k,C.push(H),S=!1;var N=Y/U*(g.width=1024);return g.height=A(N),g.height<N&&(g.height*=2),g.height==0&&(g.height=512),{spritewidth:U,spriteheight:U*g.height/g.width,textwidth:U,allTextHeight:Y,singleline:S}},m.creatTextSprite=function(H,F,P,g,E,_,k){P<=1e-8&&(P=1);var U=document.createElement("canvas"),C=U.getContext("2d");k?(C.font=k(256),C.font.length==0&&(C.font=x.MxFun.formatString("normal {0}px Arial","256"))):C.font=x.MxFun.formatString("normal {0}px Arial","256");var S=P/256,Y=0,G=[],T=[],B=0;if(_){Y=_;for(var D=0,N=0;N<H.length;N++)(h=C.measureText(H.substring(D,N+1))).width*S>Y&&(B+=I=(h.fontBoundingBoxAscent+h.fontBoundingBoxDescent)*S,G.push(H.substring(D,N)),T.push(I),D=N);if(D<N){var I,h=C.measureText(H.substring(D,N));G.push(H.substring(D,N)),B+=I=(h.fontBoundingBoxAscent+h.fontBoundingBoxDescent)*S,T.push(I)}}else B=P,Y=(h=C.measureText(H)).width*S,G.push(H),T.push(B);var u=B/Y*(U.width=1024);U.height=A(u),U.height<u&&(U.height*=2),U.height==0&&(U.height=512);var v=1024/Y,M=v*P;k?(C.font=k(M),C.font.length==0&&(C.font=x.MxFun.formatString("normal {0}px Arial",""+M))):C.font=x.MxFun.formatString("normal {0}px Arial",""+M);var j=x.MxFun.formatString("rgba({0}, {1}, {2}, 1.0)",(E>>16&255)+"",(E>>8&255)+"",(255&E)+"");C.fillStyle=j,C.textAlign="left",C.textBaseline="bottom";for(var z=0,J=0;z<G.length;z++)J+=v*T[z];for(z=0,J=.5*(U.height-J);z<G.length;z++)J+=v*T[z],C.fillText(G[z],0,J);var te=new c.Texture(U);te.needsUpdate=!0;var X=new c.SpriteMaterial({transparent:!0,depthTest:!1,map:te});X.rotation=g;var se=new c.Sprite(X);return se.scale.set(Y,Y/U.width*U.height,1),se.position.set(F.x,F.y,F.z),se},m.createTriangle=function(H,F,P){if(!(H.length<3)){for(var g=H.length,E=new c.Geometry,_=0;_+2<g;_+=3){E.vertices.push(H[_]),E.vertices.push(H[_+1]),E.vertices.push(H[_+2]);var k=new c.Face3(_,_+1,_+2);E.faces.push(k)}E.computeFaceNormals(),E.computeVertexNormals(),P==null&&(P=1);var U=new c.MeshBasicMaterial({color:F,transparent:!0,depthTest:!1,side:c.DoubleSide,opacity:P});return new c.Mesh(E,U)}},m.createLines=function(H,F,P){var g,E=new c.Geometry;return E.vertices=H,g=P&&P!=1||P==0?new c.LineBasicMaterial({color:F,transparent:!0,depthTest:!1,opacity:P}):new c.LineBasicMaterial({color:F,transparent:!0,depthTest:!1}),new c.Line(E,g)},m.createDashedArc=function(H,F,P,g,E,_,k){var U=new c.CircleGeometry(F,64,P,g),C=new c.LineDashedMaterial({color:E,dashSize:_,gapSize:k,transparent:!0,depthTest:!1});U.vertices.shift();var S=new c.Line(U,C);return S.position.x=H.x,S.position.y=H.y,S.position.z=H.z,S},m.createDashedLines=function(H,F,P,g){var E=new c.Geometry;E.vertices=H;var _=new c.Line(E,new c.LineDashedMaterial({color:F,dashSize:P,gapSize:g,transparent:!0,depthTest:!1}));return _.computeLineDistances(),_}},{"./MxFun":27,three:19}],38:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxPair=o.MxTools=void 0;var a,m,c=b("three");(m=a||(o.MxTools=a={})).AsMxWebPoint=function(x,A,H){return new c.Vector3(-x,H,A)},m.AsMxWebPoint_pt=function(x){return new c.Vector3(-x.x,x.z,x.y)},m.AsThreeJsPoint=function(x,A,H){return new c.Vector3(-x,H,A)},m.stringTrimLeftSpace=function(x){return x.replace(/^\s*/g,"")},m.stringDeleteAllSpace=function(x){return x.replace(/\s*/g,"")},m.stringTrimLeftRightSpace=function(x){return x.replace(/^\s*|\s*$/g,"")},m.stringTrimRightSpace=function(x){return x.replace(/(\s*$)/g,"")},m.IsNumerical=function(x){if(typeof x=="string"){var A=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/;return!(!/^\d+(\.\d+)?$/.test(x)&&!A.test(x))}var H=x.m_val;return A=/^(-(([0-9]+\.[0-9]*[1-9][0-9]*)|([0-9]*[1-9][0-9]*\.[0-9]+)|([0-9]*[1-9][0-9]*)))$/,!(!/^\d+(\.\d+)?$/.test(H)&&!A.test(H))},m.formatString=function(x){for(var A=[],H=1;H<arguments.length;H++)A[H-1]=arguments[H];for(var F=0;F<A.length;F++)x=x.replace("{".concat(F,"}"),A[F]);return x},m._tstof=function(x){return parseFloat(x)},m._tstoi=function(x){return parseInt(x)},m.IsZero=function(x){return-1e-7<x&&x<1e-7},m.MillimeterToPixels=function(x){return 10*x},m.getXYPlanDistance=function(x,A){var H=new c.Vector2(x.x,x.y),F=new c.Vector2(A.x,A.y);return H.distanceTo(F)},m.MxASSERT=function(x,A){x||console.log("MxASSERT(0):"+A)},m.generateUUID=function(){return c.MathUtils.generateUUID()},m.MxMax=function(x,A){return A<x?x:A},m.getOpacity=function(x){var A=(4278190080&x)>>24&255;return A<=0&&(A=255),A/255},m.getColor=function(x){return 16777215&x},o.MxPair=function(x,A){this.first=x,this.second=A}},{three:19}],39:[function(b,n,o){var a,m,c,x;Object.defineProperty(o,"__esModule",{value:!0}),o.MxType=void 0,(c=(m=a||(o.MxType=a={})).MxCommandFlag||(m.MxCommandFlag={}))[c.MCRX_CMD_MODAL=0]="MCRX_CMD_MODAL",c[c.MCRX_CMD_TRANSPARENT=1]="MCRX_CMD_TRANSPARENT",c[c.MCRX_CMD_NO_UNDO_MARKER=2]="MCRX_CMD_NO_UNDO_MARKER",c[c.MCRX_CMD_NOPRV=4]="MCRX_CMD_NOPRV",c[c.MCRX_CMD_NO_RECORD_PRVCMD=8]="MCRX_CMD_NO_RECORD_PRVCMD",c[c.MCRX_CMD_NO_CLEAR_SELECT=16]="MCRX_CMD_NO_CLEAR_SELECT",c[c.MCRX_CMD_NO_CLEAR_SELECT_GRIP_POINT=32]="MCRX_CMD_NO_CLEAR_SELECT_GRIP_POINT",c[c.MCRX_JIG_CMD_END_NO_CLEAR_SELECT=64]="MCRX_JIG_CMD_END_NO_CLEAR_SELECT",(x=m.MxCloneType||(m.MxCloneType={}))[x.kClone=1]="kClone",x[x.kDragClone=2]="kDragClone",x[x.kMxFileClone=3]="kMxFileClone",x[x.kSaveDwgClone=4]="kSaveDwgClone"},{}],40:[function(b,n,o){var a;Object.defineProperty(o,"__esModule",{value:!0}),o.MxBulid=void 0,window.MxDrawVersion="1.0(2025-08-27 08:35)",(a||(o.MxBulid=a={})).getVersion=function(){return window.MxDrawVersion?window.MxDrawVersion:"inalid version"}},{}],41:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxWindowsEvent=void 0;var a,m=b("./MxFun"),c=b("./Operate/MxJigCmdManager"),x=b("./MxDrawData"),A=b("./UI/MxUiVue");(function(H){var F=!1;H.shiftPressed=!1;var P=new Array;function g(Y,G){for(var T=0,B=P.length;T<B;T++){var D=P[T](Y,G);if(D!=0)return D}}function E(Y){g("mousemove",Y)}function _(Y){g("mouseup",Y)}function k(Y){g("dblclick",Y)}function U(Y){g("mousedown",Y)}function C(Y){var G=Y||window.event||arguments.callee.caller.arguments[0];if(G&&G.keyCode==27){var T=m.MxFun.getCurrentMx();if(T.isPaningCommand())return void T.endPanCommand();if(c.MxJigCmdManager.isRunning()){if(c.MxJigCmdManager.getCurCmd().getDynImput().onKeyEcsDown()!=0)return;c.MxJigCmdManager.stopCmd(c.MxJigCmdManager.DetailedResult.kEcsIn)}else{var B=!1;if(x.MxDrawData.m_isEnableIntelliSelect){var D=!1;T.getMxDatabase().getGripManager().removeAllGrips()&&(D=!0),T.getMxDatabase().getSelectManager().removeAllEntity()&&(D=!0),T.isValidMcObject()&&T.getMcObject().getGripManager().clearAll()&&(D=!0),D&&(T.updateDisplay(),T.getMxDatabase().getGripManager().fireMxEntitySelectChange(),B=!0)}B||A.MxUiVue.acutPrintf(` *取消*
命令:`)}}G&&G.key==="Shift"&&(H.shiftPressed=!0)}function S(Y){(Y=Y||window.event||arguments.callee.caller.arguments[0]).key==="Shift"&&(H.shiftPressed=!1)}H.addEvent=function(Y){P.push(Y)},H.clearKeyStatus=function(){H.shiftPressed=!1},H.registEvent=function(){F||(F=!0,m.MxFun.isPC()&&(document.addEventListener("mousemove",E,!1),document.addEventListener("mouseup",_,!1),document.addEventListener("mousedown",U,!1),document.addEventListener("dblclick",k,!1),document.onkeydown=C,document.onkeyup=S))}})(a||(o.MxWindowsEvent=a={}))},{"./MxDrawData":22,"./MxFun":27,"./Operate/MxJigCmdManager":54,"./UI/MxUiVue":65}],42:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McEdJigDynamicTrace=void 0;var a=b("three"),m=b("./MxJigCmdManager"),c=b("../MxFun"),x=b("../MxDrawData"),A=b("../MxTools"),H=b("../MxManager"),F=b("../MxThreeJS"),P=b("./McEdJigOsnap"),g=(E.prototype.IsEqual=function(S){return this.m_snapObjectId==S.m_snapObjectId&&this.m_pt.distanceTo(S.m_pt)<1e-6},E.prototype.drawLine=function(S,Y,G){var T=F.MxThreeJS.createLine(new a.Vector3(S.x,S.y,S.z),new a.Vector3(Y.x,Y.y,Y.z),this.m_iColor);G.add(T),this.m_aryDynDrawObject.push(T)},E.prototype.clearDraw=function(S){for(var Y=this.m_aryDynDrawObject.length,G=0;G<Y;G++)c.MxFun.removeThreejsObject(this.m_aryDynDrawObject[G],S);this.m_aryDynDrawObject=[]},E.prototype.draw=function(S,Y){var G=S.toSmallcoord(this.m_pt),T=new a.Vector3(G.x,G.y+this.m_iGripWidth,0),B=new a.Vector3(G.x,G.y-this.m_iGripWidth,0);this.drawLine(T,B,Y);var D=new a.Vector3(G.x+this.m_iGripWidth,G.y,0),N=new a.Vector3(G.x-this.m_iGripWidth,G.y,0);this.drawLine(D,N,Y)},E);function E(){this.m_snapObjectId=0,this.m_pt=new a.Vector3,this.m_osmode=0,this.m_iColor=16760703,this.m_iGripWidth=10,this.m_aryDynDrawObject=new Array}var _=(k.prototype.clearDraw=function(S){for(var Y=this.m_aryDynDrawObject.length,G=0;G<Y;G++)c.MxFun.removeThreejsObject(this.m_aryDynDrawObject[G],S);this.m_aryDynDrawObject=[]},k.prototype.draw=function(S,Y){this.m_draw.setWidth(this.m_iGripWidth),this.m_draw.draw(S.toSmallcoord(this.m_pt),this.m_ostype,Y)},k);function k(S,Y){var G=this;this.m_aryDynDrawObject=new Array,this.m_iGripWidth=10,this.m_draw=new P.McEdJigOsnapDraw,this.m_pt=S,this.m_ostype=Y,this.m_draw.setAddDynDrawObject_call(function(T){G.m_aryDynDrawObject.push(T)})}var U=(C.prototype.DynamicTraceTimeCall=function(S){if(!this.m_mxJig.isExit()&&this.m_iTimeCallId==S&&this.isDYNTRACE()&&this.m_snapObjectId!=0){var Y=new g;Y.m_osmode=this.m_osmode,Y.m_snapObjectId=this.m_snapObjectId,Y.m_pt=this.m_ptSnapPoint,Y.m_iGripWidth=.5*this.m_mxJig.getMxObject().screenCoordLong2Doc(x.MxDrawData.m_dInputRectWidth);for(var G=this.m_aryTraceObject.length,T=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),B=0;B<G;B++)if(this.m_aryTraceObject[B].IsEqual(Y))return this.m_aryTraceObject[B].clearDraw(T),void this.m_aryTraceObject.splice(B,1);this.m_aryTraceObject.push(Y),Y.draw(this.m_mxJig.getMxObject(),T),this.m_mxJig.getMxObject().updateDisplay()}},C.prototype.OnDynamicTrace=function(S,Y,G){if(this.isDYNTRACE())if(S==0)this.m_iTimeCallId++,this.m_snapObjectId=0;else{if(G==m.MxJigCmdManager.OsnapMode.kOsModeNear)return;var T=.5*this.m_mxJig.getMxObject().screenCoordLong2Doc(x.MxDrawData.m_dInputRectWidth);if(this.m_snapObjectId!=0&&this.m_ptSnapPoint.distanceTo(Y)<T)return;var B=this.m_iTimeCallId,D=this;setTimeout(function(){D.DynamicTraceTimeCall(B)},400),this.m_snapObjectId=S,this.m_ptSnapPoint=Y,this.m_osmode=G}},C.prototype.ClearOsmodeObjectDisplay=function(){for(var S=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),Y=this.m_aryTraceOsmodeObject.length,G=0;G<Y;G++)this.m_aryTraceOsmodeObject[G].clearDraw(S);this.m_aryTraceOsmodeObject=[]},C.prototype.ClearTraceObject=function(){for(var S=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),Y=this.m_aryTraceObject.length,G=0;G<Y;G++)this.m_aryTraceObject[G].clearDraw(S);this.m_aryTraceObject=[]},C.prototype.ClearDisplay=function(){this.ClearTraceObject(),this.ClearOsmodeObjectDisplay(),this.ClearDynDrawEntity()},C.prototype.GetTraceLine=function(S,Y,G,T){var B=Y.m_pt,D={pt1:new a.Vector3(B.x-T,B.y),pt2:new a.Vector3(B.x+T,B.y)},N={pt1:new a.Vector3(B.x,B.y-T),pt2:new a.Vector3(B.x,B.y+T)},I=[];I.push(D),I.push(N);for(var h=H.MxManager.getMxCpp().getMcDbCurve(Y.m_snapObjectId);h;){var u=h.getFirstDeriv(H.MxManager.getMxCpp().newMcGePoint3d(B));if(!u.ret||u.val.isZeroLength())break;u.val.normalize(),u.val.mult(T);var v={pt1:new a.Vector3(B.x-u.val.x,B.y-u.val.y),pt2:new a.Vector3(B.x+u.val.x,B.y+u.val.y)};I.push(v),u.val.rotateBy(Math.PI/2);var M={pt1:new a.Vector3(B.x-u.val.x,B.y-u.val.y),pt2:new a.Vector3(B.x+u.val.x,B.y+u.val.y)};I.push(M);break}return I},C.prototype.ClearDynDrawEntity=function(){for(var S=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),Y=this.m_vecDynDrawEntity.length,G=0;G<Y;G++)c.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[G],S);this.m_vecDynDrawEntity=[]},C.prototype.DoMouseMove=function(S){if(this.ClearDynDrawEntity(),this.ClearOsmodeObjectDisplay(),this.m_isValidTracePoint=!1,!this.isDYNTRACE())return[];if(this.m_aryTraceObject.length==0)return[];for(var Y=[],G=this.m_mxJig.getMxObject(),T=G.viewCoordLong2Cad(x.MxDrawData.m_dInputRectWidth),B=2*T,D=G.viewCoordLong2Cad(G.getViewWidth()),N=G.viewCoordLong2Cad(G.getViewHeight()),I=A.MxTools.MxMax(D,N),h=H.MxManager.getMxCpp().getMxCAD_App(),u=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),v=this.m_mxJig.getMxObject().viewCoordLong2Cad(this.m_dashedLineLen),M=0;M<this.m_aryTraceObject.length-1;M++){var j=this.m_aryTraceObject[M],z=j.m_pt,J=this.GetTraceLine(S,j,B,I);if(J.length!=0)for(var te=M+1;te<this.m_aryTraceObject.length&&!this.m_isValidTracePoint;te++){var X=this.m_aryTraceObject[te],se=X.m_pt,ve=this.GetTraceLine(S,X,B,I);if(ve.length!=0)for(var Ee=0;Ee<ve.length&&!this.m_isValidTracePoint;Ee++)for(var we=ve[Ee],Be=0;Be<J.length&&!this.m_isValidTracePoint;Be++){var re=J[Be],fe=h.MxCADAssist.IntersectWith(re.pt1.x,re.pt1.y,re.pt2.x,re.pt2.y,we.pt1.x,we.pt1.y,we.pt2.x,we.pt2.y,3);if(0<fe.length()){var ne=fe.at(0),le=new a.Vector3(ne.x,ne.y,ne.z);if(le.distanceTo(S)<B){var Re=F.MxThreeJS.createDashedLine(G.toSmallcoord(re.pt1),G.toSmallcoord(re.pt2),this.m_iDashedLineLenColor,v,v);u.add(Re),this.m_vecDynDrawEntity.push(Re);var at=F.MxThreeJS.createDashedLine(G.toSmallcoord(we.pt1),G.toSmallcoord(we.pt2),this.m_iDashedLineLenColor,v,v);u.add(at),this.m_vecDynDrawEntity.push(at),Ee=ve.length,this.m_isValidTracePoint=!0,this.m_ptTracePoint=le,this.CreteTracePoint(le,T),Y.push({pt:z,ostype:j.m_osmode}),Y.push({pt:se,ostype:X.m_osmode});break}}}}}if(this.m_isValidTracePoint||this.TracekPerpLine(S,Y,B,I,T)||this.TracekTangLine(S,Y,B,I,T))return Y;for(M=0;M<this.m_aryTraceObject.length;M++)if(z=this.m_aryTraceObject[M].m_pt,this.m_aryTraceObject[M].m_osmode!=m.MxJigCmdManager.OsnapMode.kOsModePerp&&!(z.distanceTo(S)<2*B)){var ze={pt1:new a.Vector3(z.x-I,z.y),pt2:new a.Vector3(z.x+I,z.y)};if(0<(Me=h.MxCADAssist.GetClosestPointTo(ze.pt1.x,ze.pt1.y,ze.pt2.x,ze.pt2.y,S.x,S.y,!0)).length()){var Ie=Me.at(0);if((Je=new a.Vector3(Ie.x,Ie.y,Ie.z)).distanceTo(S)<B){var ue=F.MxThreeJS.createDashedLine(G.toSmallcoord(ze.pt1),G.toSmallcoord(ze.pt2),this.m_iDashedLineLenColor,v,v);u.add(ue),this.m_vecDynDrawEntity.push(ue),this.m_isValidTracePoint=!0,this.m_ptTracePoint=Je,Y.push({pt:z,ostype:this.m_aryTraceObject[M].m_osmode}),this.CreteTracePoint(Je,T);break}}var Me,Je,$e={pt1:new a.Vector3(z.x,z.y-I),pt2:new a.Vector3(z.x,z.y+I)};if(0<(Me=h.MxCADAssist.GetClosestPointTo($e.pt1.x,$e.pt1.y,$e.pt2.x,$e.pt2.y,S.x,S.y,!0)).length()&&(Ie=Me.at(0),(Je=new a.Vector3(Ie.x,Ie.y,Ie.z)).distanceTo(S)<B)){ue=F.MxThreeJS.createDashedLine(G.toSmallcoord($e.pt1),G.toSmallcoord($e.pt2),this.m_iDashedLineLenColor,v,v),u.add(ue),this.m_vecDynDrawEntity.push(ue),this.m_isValidTracePoint=!0,this.m_ptTracePoint=Je,Y.push({pt:z,ostype:this.m_aryTraceObject[M].m_osmode}),this.CreteTracePoint(Je,T);break}}return Y},C.prototype.MouseMove=function(S){var Y=this.DoMouseMove(S);if(this.m_isValidTracePoint)for(var G=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),T=this.m_mxJig.getMxObject().screenCoordLong2Doc(x.MxDrawData.m_dInputRectWidth),B=0;B<Y.length;B++){var D=new _(Y[B].pt,Y[B].ostype);D.m_iGripWidth=T,D.draw(this.m_mxJig.getMxObject(),G),this.m_aryTraceOsmodeObject.push(D)}},C.prototype.isDYNTRACE=function(){return this.m_isDynTrace&&this.m_mxJig.getMxObject().getSysVarLong("DYNTRACE")!=0},C.prototype.Init=function(){var S=this.m_mxJig.getMxObject();S.getMcObject().isValid()?(this.m_isDynTrace=!0,S.sysVariable().getSysVarNumber("GETPOINTSTATUS")&m.MxJigCmdManager.GETPOINTSTATUS.OsModeDynTraceTempDisable&&(this.m_isDynTrace=!1),this.m_mxJig.isDisableDynamicTrace()&&(this.m_isDynTrace=!1)):this.m_isDynTrace=!1},C.prototype.GetTracePoint=function(){if(this.isDYNTRACE())return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},C.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.ClearOsmodeObjectDisplay(),this.m_isValidTracePoint=!1},C.prototype.CreteTracePoint=function(S,Y){var G=this.m_mxJig.getMxObject(),T=G.getTheTempDrawContainer_SmallCoord_JigDraw();Y/=2;var B=F.MxThreeJS.createLine(G.toSmallcoord2(S.x+Y,S.y+Y,0),G.toSmallcoord2(S.x-Y,S.y-Y,0),16711680);T.add(B),this.m_vecDynDrawEntity.push(B);var D=F.MxThreeJS.createLine(G.toSmallcoord2(S.x-Y,S.y+Y,0),G.toSmallcoord2(S.x+Y,S.y-Y,0),16711680);T.add(D),this.m_vecDynDrawEntity.push(D)},C.prototype.TracekPerpLine=function(S,Y,G,T,B){for(var D=this.m_aryTraceObject,N=D.length,I=H.MxManager.getMxCpp().getMxCAD_App(),h=this.m_mxJig.getMxObject(),u=h.getTheTempDrawContainer_SmallCoord_JigDraw(),v=h.viewCoordLong2Cad(this.m_dashedLineLen),M=0;M<N;M++){var j=D[M].m_pt;if(!(j.distanceTo(S)<2*G)){var z=H.MxManager.getMxCpp().getMcDbCurve(D[M].m_snapObjectId);if(z){var J=z.getFirstDeriv(H.MxManager.getMxCpp().newMcGePoint3d(j));if(J.ret&&!J.val.isZeroLength()){J.val.normalize(),J.val.rotateBy(Math.PI/2),J.val.mult(T);var te={pt1:new a.Vector3(j.x-J.val.x,j.y-J.val.y),pt2:new a.Vector3(j.x+J.val.x,j.y+J.val.y)},X=I.MxCADAssist.GetClosestPointTo(te.pt1.x,te.pt1.y,te.pt2.x,te.pt2.y,S.x,S.y,!0);if(0<X.length()){var se=X.at(0),ve=new a.Vector3(se.x,se.y,se.z);if(ve.distanceTo(S)<G){var Ee=F.MxThreeJS.createDashedLine(h.toSmallcoord2(j.x-J.val.x,j.y-J.val.y,0),h.toSmallcoord2(j.x+J.val.x,j.y+J.val.y,0),this.m_iDashedLineLenColor,v,v);u.add(Ee),this.m_vecDynDrawEntity.push(Ee),this.m_isValidTracePoint=!0,this.m_ptTracePoint=ve,Y.push({pt:j,ostype:D[M].m_osmode}),this.CreteTracePoint(ve,B);break}}}}}}return this.m_isValidTracePoint},C.prototype.TracekTangLine=function(S,Y,G,T,B){for(var D=this.m_aryTraceObject,N=D.length,I=H.MxManager.getMxCpp().getMxCAD_App(),h=this.m_mxJig.getMxObject(),u=h.getTheTempDrawContainer_SmallCoord_JigDraw(),v=h.viewCoordLong2Cad(this.m_dashedLineLen),M=0;M<N;M++){var j=D[M].m_pt;if(!(j.distanceTo(S)<2*G)){var z=H.MxManager.getMxCpp().getMcDbCurve(D[M].m_snapObjectId);if(z){var J=z.getFirstDeriv(H.MxManager.getMxCpp().newMcGePoint3d(j));if(J.ret&&!J.val.isZeroLength()){J.val.normalize(),J.val.mult(T);var te={pt1:new a.Vector3(j.x-J.val.x,j.y-J.val.y),pt2:new a.Vector3(j.x+J.val.x,j.y+J.val.y)},X=I.MxCADAssist.GetClosestPointTo(te.pt1.x,te.pt1.y,te.pt2.x,te.pt2.y,S.x,S.y,!0);if(0<X.length()){var se=X.at(0),ve=new a.Vector3(se.x,se.y,se.z);if(ve.distanceTo(S)<G){var Ee=F.MxThreeJS.createDashedLine(h.toSmallcoord2(j.x-J.val.x,j.y-J.val.y),h.toSmallcoord2(j.x+J.val.x,j.y+J.val.y),this.m_iDashedLineLenColor,v,v);u.add(Ee),this.m_vecDynDrawEntity.push(Ee),this.m_isValidTracePoint=!0,this.m_ptTracePoint=ve,Y.push({pt:j,ostype:D[M].m_osmode}),this.CreteTracePoint(ve,B);break}}}}}}return this.m_isValidTracePoint},C);function C(S){this.m_snapObjectId=0,this.m_ptSnapPoint=new a.Vector3,this.m_osmode=0,this.m_ptTracePoint=new a.Vector3,this.m_isValidTracePoint=!1,this.m_isDynTrace=!1,this.m_iTimeCallId=0,this.m_mxJig=null,this.m_aryTraceObject=[],this.m_aryTraceOsmodeObject=[],this.m_vecDynDrawEntity=[],this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=11184810,this.m_mxJig=S}o.McEdJigDynamicTrace=U},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,"../MxTools":38,"./McEdJigOsnap":43,"./MxJigCmdManager":54,three:19}],43:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McEdJigOsnap=o.McEdJigOsnapDraw=o.McEdJigOrtho=o.McEdImpJigGlobalData=o.MxOsnapDefine=void 0;var a,m,c,x,A,H,F,P,g,E,_=b("three"),k=b("../MxDrawObject"),U=b("../MxFun"),C=b("./MxJigCmdManager"),S=b("../MxTools"),Y=b("../MxDrawData"),G=b("../MxWindowsEvent");(m=a||(o.MxOsnapDefine=a={}))[m.OsModeInvalid=0]="OsModeInvalid",m[m.OsModeEnd=1]="OsModeEnd",m[m.OsModeMid=2]="OsModeMid",m[m.OsModeCen=4]="OsModeCen",m[m.OsModeNode=8]="OsModeNode",m[m.OsModeQuad=16]="OsModeQuad",m[m.OsModeInt=32]="OsModeInt",m[m.OsModeIns=64]="OsModeIns",m[m.OsModePerp=128]="OsModePerp",m[m.OsModeTan=256]="OsModeTan",m[m.OsModeNear=512]="OsModeNear",m[m.OsModeApp=2048]="OsModeApp",m[m.OsModeExt=4096]="OsModeExt",m[m.OsModePar=8192]="OsModePar",m[m.OsModeOff=16384]="OsModeOff",m[m.OsModeAll=16383]="OsModeAll",x=c||(o.McEdImpJigGlobalData=c={}),A=!1,H=new _.Vector3,F=new _.Vector3,g=P=!1,E=new Array,x.setPrvPoint=function(M){H=M,g=!0},x.isOsnapZValue=function(){return!1},x.setIsValidPrvpoint=function(M){g=M},x.isValidPrvpoint=function(){return g},x.getPrvPoint=function(){return H},x.setIsValidBasepoint=function(M){A=M},x.isValidBasepoint=function(){return A},x.setBasepoint=function(M){A=!0,F=M},x.getBasepoint=function(){return F},x.initStartCommand=function(){P=A=!1},x.setIsTmpDisableOsmode=function(M){P=M},x.isTmpDisableOsmode=function(){return P},x.addDynDrawObject=function(M){E.push(M)},x.clearDisplay=function(M){for(var j=E.length,z=0;z<j;z++)U.MxFun.removeThreejsObject(E[z],M);E=[]};var T=(B.prototype.Init=function(){this.m_isTrace=!this.m_mxJig.isDisableOrthoTrace(),this.m_isValid=!1},B.prototype.OnViewMouseMove=function(M){if(this.m_isTrace){var j=this.m_mxJig.getMxObject(),z=j.sysVariable().getSysVarNumber("GETPOINTSTATUS"),J=j.getSysVarLong("ORTHOMODE");if(G.MxWindowsEvent.shiftPressed&&(J=1),!(J==0||z&C.MxJigCmdManager.GETPOINTSTATUS.OsModeOrthoTempDisable)&&z&C.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint){var te=j.sysVariable().getSysVarPoint("LASTPOINT");Math.abs(M.x-te.x)>Math.abs(M.y-te.y)?(this.m_ptOrtho.x=M.x,this.m_ptOrtho.y=te.y):(this.m_ptOrtho.x=te.x,this.m_ptOrtho.y=M.y),this.m_isValid=!0}else this.m_isValid=!1}},B.prototype.GetCurOrthoPoint=function(){return{pt:this.m_ptOrtho,isValid:this.m_isValid}},B);function B(M){this.m_mxJig=null,this.m_ptOrtho=new _.Vector3,this.m_isValid=!1,this.m_isTrace=!0,this.m_mxJig=M}o.McEdJigOrtho=T;var D=(N.prototype.addTipObjects=function(M){var j=this;if(!M)return!1;var z=!1;return M.forEach(function(J){j.m_tipObjects.has(J.id)||(z=!0,j.m_tipObjects.set(J.id,J))}),z},N.prototype.onNotifyOsnap=function(M){if(this.m_tipObjects.size!=0){var j=M.SearchRnge,z=new _.Vector3(M.ptx,M.pty,0),J=void 0,te=void 0;return this.m_tipObjects.forEach(function(X){var se=new _.Vector3(X.x,X.y,0).distanceTo(z);se<j&&(te===void 0||se<te)&&(te=se,J={ptsx:X.x,ptsy:X.y,ptsz:0,osmode:C.MxJigCmdManager.OsnapMode.kOsModeCen,id:X.id})}),J}},N.prototype.clearData=function(){this.m_tipObjects=new Map},N.prototype.clearDisplay=function(M){for(var j=M.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),z=this.m_aryDynDrawObject.length,J=0;J<z;J++)U.MxFun.removeThreejsObject(this.m_aryDynDrawObject[J],j);this.m_aryDynDrawObject=[]},N.prototype.addDynDrawObject=function(M){this.m_aryDynDrawObject.push(M)},N.prototype.drawPolyline=function(M,j){for(var z=new _.Geometry,J=new _.LineBasicMaterial({color:this.m_iColor}),te=M.length,X=0;X<te;X++)z.vertices.push(new _.Vector3(M[X].x,M[X].y,M[X].z));var se=new _.Line(z,J);j.add(se),this.addDynDrawObject(se)},N.prototype.GetDrawRect=function(M){var j=.25*this.m_dOsmodeWdith,z={};return z.left=M.x-j,z.right=M.x+j,z.top=M.y-j,z.bottom=M.y+j,z},N.prototype.drawLine=function(M,j,z){var J=new _.Geometry,te=new _.LineBasicMaterial({color:this.m_iColor});J.vertices.push(new _.Vector3(M.x,M.y,M.z),new _.Vector3(j.x,j.y,j.z));var X=new _.Line(J,te);z.add(X),this.addDynDrawObject(X)},N.prototype.DrawNear=function(M,j){var z=this.GetDrawRect(M),J=[new _.Vector3,new _.Vector3];J[0].x=z.right,J[0].y=z.top,J[1].x=z.left,J[1].y=z.bottom,this.drawLine(J[0],J[1],j),J[0].x=z.right,J[0].y=z.bottom,J[1].x=z.left,J[1].y=z.top,this.drawLine(J[0],J[1],j)},N.prototype.DrawCircle=function(M,j,z){z==null&&(z=.5*this.m_dOsmodeWdith);for(var J=[],te=0,X=3.14159265/180;te<=360;te+=15){var se=z*Math.cos(te*X)+M.x,ve=z*Math.sin(te*X)+M.y;J.push(new _.Vector3(se,ve))}this.drawPolyline(J,j)},N.prototype.upDisplay=function(M){var j=this;this.clearDisplay(M);var z=M.getMxObject(),J=z.getTheTempDrawContainer_SmallCoord_JigDraw();this.m_dOsmodeWdith=z.screenCoordLong2Doc(Y.MxDrawData.m_dInputRectWidth),this.m_tipObjects.forEach(function(te){j.DrawNear(z.toSmallcoord(new _.Vector3(te.x,te.y,0)),J)})},N);function N(){this.m_tipObjects=new Map,this.m_iColor=16777215,this.m_aryDynDrawObject=new Array,this.m_dOsmodeWdith=10}var I=(h.prototype.setAddDynDrawObject_call=function(M){this.m_addDynDrawObject_call=M},h.prototype.addDynDrawObject=function(M){this.m_addDynDrawObject_call?this.m_addDynDrawObject_call(M):c.addDynDrawObject(M)},h.prototype.drawLine=function(M,j,z){var J=new _.Geometry,te=new _.LineBasicMaterial({color:this.m_iColor});J.vertices.push(new _.Vector3(M.x,M.y,M.z),new _.Vector3(j.x,j.y,j.z));var X=new _.Line(J,te);z.add(X),this.addDynDrawObject(X)},h.prototype.drawPolyline=function(M,j){for(var z=new _.Geometry,J=new _.LineBasicMaterial({color:this.m_iColor}),te=M.length,X=0;X<te;X++)z.vertices.push(new _.Vector3(M[X].x,M[X].y,M[X].z));var se=new _.Line(z,J);j.add(se),this.addDynDrawObject(se)},h.prototype.setWidth=function(M){this.m_dOsmodeWdith=M},h.prototype.GetDrawRect=function(){var M=.5*this.m_dOsmodeWdith,j={};return j.left=this.m_pt.x-M,j.right=this.m_pt.x+M,j.top=this.m_pt.y-M,j.bottom=this.m_pt.y+M,j},h.prototype.DrawNear=function(M){var j=this.GetDrawRect(),z=[new _.Vector3,new _.Vector3];z[0].x=j.left,z[0].y=j.top,z[1].x=j.right,z[1].y=j.top,this.drawLine(z[0],z[1],M),z[0].x=j.left,z[0].y=j.bottom,z[1].x=j.right,z[1].y=j.bottom,this.drawLine(z[0],z[1],M),z[0].x=j.right,z[0].y=j.top,z[1].x=j.left,z[1].y=j.bottom,this.drawLine(z[0],z[1],M),z[0].x=j.right,z[0].y=j.bottom,z[1].x=j.left,z[1].y=j.top,this.drawLine(z[0],z[1],M)},h.prototype.DrawEnd=function(M){var j=this.GetDrawRect(),z=[new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3];z[0].x=j.left,z[0].y=j.top,z[1].x=j.right,z[1].y=j.top,z[2].x=j.right,z[2].y=j.bottom,z[3].x=j.left,z[3].y=j.bottom,this.drawLine(z[0],z[1],M),this.drawLine(z[1],z[2],M),this.drawLine(z[2],z[3],M),this.drawLine(z[3],z[0],M)},h.prototype.DrawMid=function(M){var j=this.GetDrawRect(),z=1.2*(j.right-j.left),J=z/2/Math.sin(60*3.14159265/180),te=J*Math.sin(.5235987750000001),X=new _.Vector3(this.m_pt.x,this.m_pt.y,this.m_pt.z);X.y-=J;var se=new _.Vector3;se.x=this.m_pt.x+z/2,se.y=this.m_pt.y+te;var ve=new _.Vector3;ve.x=this.m_pt.x-z/2,ve.y=this.m_pt.y+te;var Ee=[new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3];Ee[0].x=X.x,Ee[0].y=X.y,Ee[1].x=se.x,Ee[1].y=se.y,Ee[2].x=ve.x,Ee[2].y=ve.y,Ee[3].x=X.x,Ee[3].y=X.y,this.drawLine(Ee[0],Ee[1],M),this.drawLine(Ee[1],Ee[2],M),this.drawLine(Ee[2],Ee[3],M)},h.prototype.DrawPerp=function(M){var j=this.GetDrawRect(),z=[new _.Vector3,new _.Vector3,new _.Vector3];z[0].x=j.left,z[0].y=j.top,z[1].x=j.left,z[1].y=j.bottom,z[2].x=j.right,z[2].y=j.bottom,this.drawPolyline(z,M),z[0].x=j.left,z[0].y=this.m_pt.y,z[1].x=this.m_pt.x,z[1].y=this.m_pt.y,z[2].x=this.m_pt.x,z[2].y=j.bottom,this.drawPolyline(z,M)},h.prototype.DrawCircle=function(M,j,z){z==null&&(z=.5*this.m_dOsmodeWdith);for(var J=[],te=0,X=3.14159265/180;te<=360;te+=15){var se=z*Math.cos(te*X)+M.x,ve=z*Math.sin(te*X)+M.y;J.push(new _.Vector3(se,ve))}this.drawPolyline(J,j)},h.prototype.DrawInt=function(M){var j=this.GetDrawRect(),z=[new _.Vector3,new _.Vector3];z[0].x=j.right,z[0].y=j.top,z[1].x=j.left,z[1].y=j.bottom,this.drawLine(z[0],z[1],M),z[0].x=j.right,z[0].y=j.bottom,z[1].x=j.left,z[1].y=j.top,this.drawLine(z[0],z[1],M)},h.prototype.DrawCen=function(M){this.DrawInt(M),this.DrawCircle(this.m_pt,M)},h.prototype.DrawTan=function(M){this.DrawEnd(M)},h.prototype.DrawIns=function(M){var j=this.GetDrawRect(),z={},J=(j.right-j.left)/1.5;z.left=this.m_pt.x-J,z.right=this.m_pt.x+J,z.top=this.m_pt.y-J,z.bottom=this.m_pt.y+J;var te=this.m_pt.x,X=this.m_pt.y,se=[new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3];se[0].x=z.left,se[0].y=z.top,se[1].x=z.left,se[1].y=X+2,se[2].x=te,se[2].y=X+2,se[3].x=te,se[3].y=z.bottom,se[4].x=z.right,se[4].y=z.bottom,se[5].x=z.right,se[5].y=X-2,se[6].x=te,se[6].y=X-2,se[7].x=te,se[7].y=z.top,se[8].x=z.left,se[8].y=z.top,this.drawPolyline(se,M)},h.prototype.DrawNode=function(M){var j=this.GetDrawRect(),z={},J=(j.right-j.left)/1.5;z.left=this.m_pt.x-J,z.right=this.m_pt.x+J,z.top=this.m_pt.y-J,z.bottom=this.m_pt.y+J;var te=this.m_dOsmodeWdith/1.3;this.m_pt.x,this.m_pt.x,this.m_pt.y,this.m_pt.y;var X=[new _.Vector3,new _.Vector3,new _.Vector3,new _.Vector3];X[0].x=z.left,X[0].y=z.top,X[1].x=z.right,X[1].y=z.bottom,X[2].x=z.left,X[2].y=z.bottom,X[3].x=z.right,X[3].y=z.top,this.drawLine(X[0],X[1],M),this.drawLine(X[2],X[3],M),this.DrawCircle(this.m_pt,M,te)},h.prototype.draw=function(M,j,z){this.m_pt=M,this.m_osmode=j;var J=.5*this.m_dOsmodeWdith;if(this.m_osmode!=C.MxJigCmdManager.OsnapMode.kOsModekInValid)if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModeNear)this.DrawNear(z);else if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModeEnd)this.DrawEnd(z);else if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModeMid)this.DrawMid(z);else if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModePerp)this.DrawPerp(z);else if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModeInt)this.DrawInt(z);else if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModeCen)this.DrawCen(z);else if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModeTan)this.DrawTan(z);else if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModeIns)this.DrawIns(z);else if(this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModeNode)this.DrawNode(z);else{var te=new _.Vector3(M.x-J,M.y-J,0),X=new _.Vector3(M.x+J,M.y+J,0);this.drawLine(te,X,z);var se=new _.Vector3(M.x-J,M.y+J,0),ve=new _.Vector3(M.x+J,M.y-J,0);this.drawLine(se,ve,z)}},h.prototype.upDisplay=function(M,j,z){this.clearDisplay(z);var J=z.getMxObject();this.setWidth(J.screenCoordLong2Doc(Y.MxDrawData.m_dInputRectWidth)),M=J.toSmallcoord(M),this.draw(M,j,J.getTheTempDrawContainer_SmallCoord_JigDraw())},h.prototype.clearDisplay=function(M){var j=M.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw();c.clearDisplay(j)},h);function h(){this.m_iColor=16711935,this.m_addDynDrawObject_call=void 0,this.m_pt=new _.Vector3,this.m_osmode=C.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_dOsmodeWdith=10}o.McEdJigOsnapDraw=I;var u=(v.prototype.setSpecificOsMode=function(M){this.m_lSpecificOsMode=M},v.prototype.resetData=function(){this.m_osmode=C.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_isValidPrvInputPoint=!1,this.m_lOSmode=0,this.m_vecOffset.set(0,0,0),this.m_isValid=!1,this.m_iLongprogressStatus=-1,this.m_lSpecificOsMode=0,this.m_tipsObject.clearData(),this.reComputeOffset()},v.prototype.notifyOsnapToServer=function(){var M=this;if(this.m_isRuning){var j={ptx:this.m_pt.x,pty:this.m_pt.y,osmode:this.m_lOSmode,isValidPrvInputPoint:this.m_isValidPrvInputPoint};this.m_isValidPrvInputPoint&&(j.prvPtx=this.m_prvInputPoint.x,j.prvPty=this.m_prvInputPoint.y);var z=this.m_mxJig.getMxObject();if(z.getRunMode()==k.MxRunMode.kBrowse){var J=this,te=z.getCurrentMousePostion();z.getObjectOsnap().getOsnapData(te,function(Ee,we){Ee=z.worldCoord2Doc(Ee.x,Ee.y,Ee.z),J.m_ptSnapPoint.x=Ee.x,J.m_ptSnapPoint.y=Ee.y,J.m_ptSnapPoint.z=0,J.m_ptSnapSrcPoint.x=J.m_pt.x,J.m_ptSnapSrcPoint.y=J.m_pt.y,J.m_ptSnapSrcPoint.z=0,J.m_osmode=we,J.m_draw.upDisplay(new _.Vector3(Ee.x,Ee.y,0),we,J.m_mxJig)})}else if(z.getRunMode()==k.MxRunMode.kCPPMxCAD){var X=this;j.SearchRnge=z.viewCoordLong2Cad(Y.MxDrawData.m_dInputRectWidth);var se=X.m_tipsObject.onNotifyOsnap(j);se?(X.m_ptSnapPoint.x=se.ptsx,X.m_ptSnapPoint.y=se.ptsy,X.m_ptSnapPoint.z=se.ptsz,X.m_ptSnapSrcPoint.x=j.ptx,X.m_ptSnapSrcPoint.y=j.pty,X.m_ptSnapSrcPoint.z=0,X.m_osmode=se.osmode,X.m_snapObjectId=se.id,X.m_draw.upDisplay(new _.Vector3(se.ptsx,se.ptsy,se.ptsz),se.osmode,X.m_mxJig),X.m_mxJig.onGetOsnapData(se)):z.getMcObject().onNotifyOsnap(j,function(Ee){X.m_ptSnapPoint.x=Ee.ptsx,X.m_ptSnapPoint.y=Ee.ptsy,X.m_ptSnapPoint.z=Ee.ptsz,X.m_ptSnapSrcPoint.x=Ee.ptx,X.m_ptSnapSrcPoint.y=Ee.pty,X.m_ptSnapSrcPoint.z=0,X.m_osmode=Ee.osmode,X.m_snapObjectId=Ee.id,X.m_draw.upDisplay(new _.Vector3(Ee.ptsx,Ee.ptsy,Ee.ptsz),Ee.osmode,X.m_mxJig),X.m_tipsObject.addTipObjects(Ee.tips)&&X.m_tipsObject.upDisplay(X.m_mxJig),X.m_mxJig.onGetOsnapData(Ee)})}else{j.SearchRnge=z.viewCoordLong2Cad(Y.MxDrawData.m_dInputRectWidth);var ve=this;z.callCommand("MxCAD_NotifyOsnap",JSON.stringify(j),function(Ee){if(!(typeof Ee!="string"||Ee.length<1)&&ve.m_isRuning){var we=JSON.parse(Ee);M.m_ptSnapPoint.x=we.ptsx,M.m_ptSnapPoint.y=we.ptsy,M.m_ptSnapPoint.z=we.ptsz,M.m_ptSnapSrcPoint.x=we.ptx,M.m_ptSnapSrcPoint.y=we.pty,M.m_ptSnapSrcPoint.z=0,M.m_osmode=we.osmode,ve.m_draw.upDisplay(new _.Vector3(we.ptsx,we.ptsy,we.ptsz),we.osmode,ve.m_mxJig)}})}}},v.prototype.startDrag=function(M,j){this.m_mxJig=j;var z,J,te=this.m_mxJig.getMxObject();function X(){z.notifyOsnapToServer()}return j.isDisableOsnap()?this.m_isEnable=!1:this.m_isEnable=te.getInisetValue(k.IniSetName.kEnableOsnapFunction)===!0,this.m_isOffsetInputPostion=M,this.m_isRuning=!0,this.resetData(),this.m_notifyOsnap_delayCall=(z=this,J=null,function(){clearTimeout(J),J=setTimeout(X,20)}),!0},v.prototype.endDrag=function(){return this.m_isRuning=!1,this.m_draw.clearDisplay(this.m_mxJig),this.m_tipsObject.clearDisplay(this.m_mxJig),!0},v.prototype.reCompteCurrentPoint=function(M){return this.m_isOffsetInputPostion&&M.add(this.m_vecOffset),M},v.prototype.getIsEnableVar=function(){return this.m_isEnable},v.prototype.isEnable=function(){if(!this.m_isEnable||c.isTmpDisableOsmode())return!1;var M=this.m_mxJig.getMxObject().getSysVarLong("OSMODE");return this.m_lSpecificOsMode!=0&&(M=this.m_lSpecificOsMode),!(M==0||M&a.OsModeOff)},v.prototype.notifyOsnap=function(M,j){this.m_lOSmode=M,j==null?this.m_isValidPrvInputPoint=!1:(this.m_isValidPrvInputPoint=!0,this.m_prvInputPoint=j),this.m_osmode==C.MxJigCmdManager.OsnapMode.kOsModekInValid&&this.m_draw.clearDisplay(this.m_mxJig),this.m_notifyOsnap_delayCall()},v.prototype.setPoint=function(M,j){if(this.isEnable()){M==null?(this.m_isValid=!1,this.m_osmode=C.MxJigCmdManager.OsnapMode.kOsModekInValid):(this.m_iLongprogressStatus==-1||this.m_iLongprogressStatus,this.m_pt=M,this.m_inPoint=M,this.m_isValid=!0,(j==null||this.m_osmode!=C.MxJigCmdManager.OsnapMode.kOsModekInValid&&S.MxTools.getXYPlanDistance(this.m_ptSnapSrcPoint,M)>j)&&(this.m_osmode=C.MxJigCmdManager.OsnapMode.kOsModekInValid));var z=this.m_mxJig.getMxObject().getSysVarLong("OSMODE");this.m_lSpecificOsMode!=0&&(z=this.m_lSpecificOsMode);var J=c.getPrvPoint();this.notifyOsnap(z,c.isValidPrvpoint()?J:void 0)}},v.prototype.seInValidPoint=function(){this.setPoint(void 0)},v.prototype.getCurrentOSnapPoint=function(M){var j={isSnapPoint:!1};return this.isEnable()?(j.pt=M,j.osmode=this.m_osmode,this.m_osmode!=C.MxJigCmdManager.OsnapMode.kOsModekInValid?(j.isSnapPoint=!0,j.pt.x=this.m_ptSnapPoint.x,j.pt.y=this.m_ptSnapPoint.y,j.pt.z=this.m_ptSnapPoint.z,c.isOsnapZValue()||(M.z=0)):j.pt=M):(j.pt=M,j.osmode=C.MxJigCmdManager.OsnapMode.kOsModekInValid),j},v.prototype.setLongprogressStatus=function(M){this.m_iLongprogressStatus=M},v.prototype.reComputeOffset=function(){if(this.m_isOffsetInputPostion){var M=this.m_mxJig.getMxObject(),j=S.MxTools.MillimeterToPixels(8);j=M.screenCoordLong2Doc(j),this.m_vecOffset.set(0,j,0),this.m_vecOffset.applyAxisAngle(new _.Vector3(0,0,1),20*Math.PI/180)}},v);function v(M){this.m_inPoint=new _.Vector3,this.m_vecOffset=new _.Vector3,this.m_pt=new _.Vector3,this.m_isValid=!1,this.m_ptSnapPoint=new _.Vector3,this.m_ptSnapSrcPoint=new _.Vector3,this.m_snapObjectId=0,this.m_osmode=C.MxJigCmdManager.OsnapMode.kOsModekInValid,this.m_prvInputPoint=new _.Vector3,this.m_isValidPrvInputPoint=!1,this.m_lOSmode=0,this.m_iLongprogressStatus=-1,this.m_isOffsetInputPostion=!1,this.m_mxJig=null,this.m_notifyOsnap_delayCall=void 0,this.m_isRuning=!1,this.m_isEnable=!1,this.m_lSpecificOsMode=0,this.m_mxJig=M,this.m_draw=new I,this.m_tipsObject=new D}o.McEdJigOsnap=u},{"../MxDrawData":22,"../MxDrawObject":23,"../MxFun":27,"../MxTools":38,"../MxWindowsEvent":41,"./MxJigCmdManager":54,three:19}],44:[function(b,n,o){var a,m=this&&this.__extends||(a=function(S,Y){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(G,T){G.__proto__=T}||function(G,T){for(var B in T)Object.prototype.hasOwnProperty.call(T,B)&&(G[B]=T[B])})(S,Y)},function(S,Y){if(typeof Y!="function"&&Y!==null)throw new TypeError("Class extends value "+String(Y)+" is not a constructor or null");function G(){this.constructor=S}a(S,Y),S.prototype=Y===null?Object.create(Y):(G.prototype=Y.prototype,new G)});Object.defineProperty(o,"__esModule",{value:!0}),o.McGiWorldDrawSelect=o.McGiWorldDraw=o.McGiWorldDrawType=void 0;var c,x,A=b("three"),H=b("../MxThreeJS"),F=b("../MxManager"),P=b("three.meshline"),g=b("../MxFun");(x=c||(o.McGiWorldDrawType=c={}))[x.kWorldDraw=1]="kWorldDraw",x[x.kDynDragDraw=2]="kDynDragDraw",x[x.kSelectDraw=3]="kSelectDraw";var E=(_.prototype.getType=function(){return this.worldDrawType},_.prototype.setXData=function(S){this.xData=S},_.prototype.setMatrix=function(S){this.matrix=S},_.prototype.getMatrix=function(){return this.matrix},_.prototype.setOpacity=function(S){this.opacity=S},_.prototype.getOpacity=function(){return this.opacity},_.prototype.setColor=function(S){S=g.MxFun.getNumberColor(S),this.iColor!=S&&(this.widthMaterial=null),this.iColor=S},_.prototype.setDash=function(S,Y){this.dDashArray=S,this.dDashRatio=Y},_.prototype.getDash=function(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}},_.prototype.setDashLineDisplay=function(S){S?(this.dDashArray=.03,this.dDashRatio=.1,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0)},_.prototype.isDashLineDisplay=function(){return 0<this.dDashArray&&0<this.dDashRatio},_.prototype.getColor=function(){return this.iColor},_.prototype.setRenderOrder=function(S){this.iRenderOrder=S},_.prototype.getRenderOrder=function(){return this.iRenderOrder},_.prototype.setLineWidthByPixels=function(S){this.lineWidthByPixels!=S&&(this.widthMaterial=null),this.lineWidthByPixels=S},_.prototype.getLineWidthByPixels=function(){return this.lineWidthByPixels},_.prototype.setLineWidth=function(S){this.dLineWidth!=S&&(this.widthMaterial=null),this.dLineWidth=S},_.prototype.getLineWidth=function(){return this.dLineWidth},_.prototype.drawEntity=function(S){var Y=this.iRenderOrder;S.type=="Group"?S.traverse(function(G){G.type!="Group"&&(G.renderOrder=Y)}):S.renderOrder=Y,this.matrix!=null&&S.applyMatrix4(this.matrix),this.aryEntity.push(S),this.xData&&(S.MxWordDrawXData=this.xData,this.xData=null)},_.prototype.getEntitys=function(){return this.aryEntity},_.prototype.getMxObject=function(){return this.mxObj},_.prototype.createWidthMaterial=function(){this.widthMaterial==null&&(0<this.dDashArray&&0<this.dDashRatio?this.widthMaterial=new P.MeshLineMaterial({useMap:!1,color:this.iColor,opacity:1,resolution:new A.Vector2(this.mxObj.getViewWidth(),this.mxObj.getViewHeight()),sizeAttenuation:!this.lineWidthByPixels,lineWidth:this.dLineWidth,transparent:!0,depthTest:!1,dashArray:this.dDashArray,dashRatio:this.dDashRatio}):this.widthMaterial=new P.MeshLineMaterial({useMap:!1,color:this.iColor,opacity:1,resolution:new A.Vector2(this.mxObj.getViewWidth(),this.mxObj.getViewHeight()),sizeAttenuation:!this.lineWidthByPixels,lineWidth:this.dLineWidth,transparent:!0,depthTest:!1}))},_.prototype.drawSolid=function(S){if(!(S.length<3)){var Y=new A.Shape(S.map(function(B){var D=B.x,N=B.y;return new A.Vector2(D,N)})),G=new A.ShapeGeometry(Y),T=new A.Mesh(G,new A.MeshPhongMaterial({color:this.getColor(),side:A.DoubleSide,transparent:!0,opacity:this.getOpacity()}));this.drawEntity(T)}},_.prototype.drawLines=function(S){if(!(S.length<2))if(this.dLineWidth!=0){this.createWidthMaterial();var Y=new A.Geometry;Y.vertices=S;var G=new P.MeshLine;G.setGeometry(Y);var T=new A.Mesh(G.geometry,this.widthMaterial);this.drawEntity(T),this.drawEntity(H.MxThreeJS.createLines(S.slice(0),this.iColor,0))}else this.drawEntity(H.MxThreeJS.createLines(S.slice(0),this.iColor,this.opacity))},_.prototype.drawGeometryLines=function(S){if(!(S.vertices.length<2))if(this.dLineWidth!=0){this.createWidthMaterial();var Y=new P.MeshLine;if(!(S instanceof A.Geometry)){var G=new A.Geometry;G.vertices=S.vertices,S=G}Y.setGeometry(S);var T=new A.Mesh(Y.geometry,this.widthMaterial);this.drawEntity(T);var B=new A.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1,opacity:0}),D=new A.Line(S,B);this.drawEntity(D)}else B=void 0,B=this.opacity&&this.opacity!=1||this.opacity==0?new A.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1,opacity:this.opacity}):new A.LineBasicMaterial({color:this.iColor,transparent:!0,depthTest:!1}),D=new A.Line(S,B),this.drawEntity(D)},_.prototype.drawSelectLine=function(S,Y,G,T){S instanceof Object&&Y instanceof Object?this.drawEntity(H.MxThreeJS.createLine(S,Y,this.iColor,0)):typeof S=="number"&&typeof Y=="number"&&this.drawEntity(H.MxThreeJS.createLine(new A.Vector3(S,Y,0),new A.Vector3(G,T,0),this.iColor,0))},_.prototype.drawLine=function(S,Y,G,T){var B,D;if(S instanceof Object&&Y instanceof Object?(B=S,D=Y):typeof S=="number"&&typeof Y=="number"&&(B=new A.Vector3(S,Y,0),D=new A.Vector3(G,T,0)),this.dLineWidth!=0){this.createWidthMaterial();var N=new Float32Array(6);N[0]=B.x,N[1]=B.y,N[2]=0,N[3]=D.x,N[4]=D.y,N[5]=0;var I=new P.MeshLine;I.setGeometry(N);var h=new A.Mesh(I.geometry,this.widthMaterial);h.renderOrder=this.iRenderOrder,this.drawEntity(h),this.drawSelectLine(B,D)}else this.drawEntity(H.MxThreeJS.createLine(B,D,this.iColor,this.opacity))},_.prototype.drawCircle=function(S,Y){this.drawEntity(H.MxThreeJS.createCircle(S,Y,this.iColor))},_.prototype.drawText=function(S,Y,G,T,B,D){var N=H.MxThreeJS.creatTextSprite(S,T,Y,G,this.iColor,B,D);return this.drawEntity(N),N},_.prototype.setupForEntity=function(S){this.iColor=g.MxFun.getNumberColor(S.getColor()),this.iRenderOrder=S.getRenderOrder(),this.opacity=S.opacity,this.dLineWidth=S.getLineWidth(),this.lineWidthByPixels=S.getLineWidthByPixels(),this.dDashArray=S.getDash().dDashArray,this.dDashRatio=S.getDash().dDashRatio},_);function _(S,Y){this.aryEntity=[],this.iColor=16777215,this.dLineWidth=0,this.lineWidthByPixels=!0,this.iRenderOrder=F.MxData.iMxEntityRenderOrder,this.worldDrawType=1,this.widthMaterial=null,this.dDashArray=0,this.dDashRatio=0,this.matrix=null,this.opacity=1,this.xData=null,this.mxObj=S,this.worldDrawType=Y}o.McGiWorldDraw=E;var k,U=(m(C,k=E),C.prototype.setSmallCoordDraw=function(S){this.isSmallCorrdDraw=S},C.prototype.setCurEntityId=function(S){this.curEntityId=S},C.prototype.drawEntity=function(S){},C.prototype.drawText=function(S,Y,G,T,B,D){return null},C.prototype.drawSelectLine=function(S,Y,G,T){},C.prototype.isValid=function(){return this.curEntityId!=0||(console.log("this.curEntityId == 0"),!1)},C.prototype.drawLine=function(S,Y,G,T){var B,D;this.isValid()&&(S instanceof Object&&Y instanceof Object?(B=S,D=Y):typeof S=="number"&&typeof Y=="number"&&(B=new A.Vector3(S,Y,0),D=new A.Vector3(G,T,0)),this.selectManager.addLineDisplay(this.curEntityId,B,D,this.isSmallCorrdDraw))},C.prototype.drawCircle=function(S,Y){this.isValid()&&this.selectManager.addCircleDisplay(this.curEntityId,S,Y,this.isSmallCorrdDraw)},C.prototype.drawLines=function(S){if(!(S.length<2))for(var Y=S.length,G=0;G<Y-1;G++)this.selectManager.addLineDisplay(this.curEntityId,S[G],S[G+1],this.isSmallCorrdDraw)},C);function C(S,Y){var G=k.call(this,S,c.kSelectDraw)||this;return G.isSmallCorrdDraw=!1,G.selectManager=Y,G.curEntityId=0,G.isSmallCorrdDraw=!1,G}o.McGiWorldDrawSelect=U},{"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,three:19,"three.meshline":18}],45:[function(b,n,o){var a,m=this&&this.__extends||(a=function(N,I){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,u){h.__proto__=u}||function(h,u){for(var v in u)Object.prototype.hasOwnProperty.call(u,v)&&(h[v]=u[v])})(N,I)},function(N,I){if(typeof I!="function"&&I!==null)throw new TypeError("Class extends value "+String(I)+" is not a constructor or null");function h(){this.constructor=N}a(N,I),N.prototype=I===null?Object.create(I):(h.prototype=I.prototype,new h)});Object.defineProperty(o,"__esModule",{value:!0}),o.MrxDbgUiPrBase=o.MrxDbgUiPrBase_Return=o.McEdGetPointWorldDrawObject=o.McEdGetPointWorldDraw=void 0;var c=b("three"),x=b("./MxJig"),A=b("./MxJigCmdManager"),H=b("../MxThreeJS"),F=b("../UI/MxUiVue"),P=b("../MxString"),g=b("./McGiWorldDraw"),E=b("../MxManager"),_=(k.prototype.setMcEdJig=function(N){this.m_pJig=N},k.prototype.getMcEdJig=function(){return this.m_pJig},k.prototype.setColor=function(N){this.m_iColor=N},k.prototype.getColor=function(){return this.m_iColor},k.prototype.getDrawColor=function(){return this.m_pJig.getMxObject().automaticInversionColor(this.m_iColor)},k.prototype.drawLine=function(N,I){this.m_pJig.drawEntity(H.MxThreeJS.createLine(N,I,this.getDrawColor()))},k.prototype.drawRect=function(N,I){var h=new c.Vector3(N.x,I.y,0),u=new c.Vector3(I.x,N.y,0);this.drawLine(N,h),this.drawLine(h,I),this.drawLine(I,u),this.drawLine(u,N)},k.prototype.drawMcDbEntity=function(N,I){this.m_pJig.drawMcDbEntity(N,I?0:this.getDrawColor(),I)},k.prototype.drawMcDbLine=function(N,I,h,u,v,M){this.m_pJig.drawMcDbLine(N,I,h,u,v,M,this.getDrawColor())},k.prototype.drawCircle=function(N,I){this.m_pJig.drawEntity(H.MxThreeJS.createCircle(N,I,this.getDrawColor()))},k.prototype.drawEntity=function(N,I,h){h===void 0&&(h=!1),this.m_pJig.drawEntity(N,I,h)},k.prototype.drawText=function(N,I,h,u){var v=H.MxThreeJS.creatTextSprite(N,u,I,h,this.getDrawColor());this.drawEntity(v)},k.prototype.drawSolid=function(N,I){var h=H.MxThreeJS.createSolid(N,this.getDrawColor(),I);h&&this.drawEntity(h)},k.prototype.drawCustomEntity=function(N,I){var h=new g.McGiWorldDraw(this.m_pJig.getMxObject(),g.McGiWorldDrawType.kDynDragDraw);h.setupForEntity(N),N.worldDraw(h);for(var u=h.getEntitys(),v=u.length,M=0;M<v;M++)this.drawEntity(u[M],I,N.isUseSmallcoordDisplay())},k);function k(){this.m_pJig=null,this.m_iColor=16777215}o.McEdGetPointWorldDraw=_;var U,C,S,Y=(m(G,U=_),G.prototype.setDraw=function(N){this.m_callDraw=N},G.prototype.worldDraw=function(N){this.m_callDraw!=null&&this.m_callDraw(N,this)},G);function G(){var N=U!==null&&U.apply(this,arguments)||this;return N.m_callDraw=void 0,N}o.McEdGetPointWorldDrawObject=Y,(S=C||(o.MrxDbgUiPrBase_Return=C={}))[S.kCancel=-2]="kCancel",S[S.kNone=-1]="kNone",S[S.kOk=0]="kOk",S[S.kKeyWord=1]="kKeyWord";var T,B=(m(D,T=x.McEdJigCommand),D.prototype.procInKeyword=function(N){N.status>=A.MxJigCmdManager.DragStatus.kKW1&&0<N.sKeyValue.length?this.m_keyWordPicked=N.sKeyValue.toUpperCase():this.m_keyWordPicked=""},D.prototype.getReturnStatus=function(N){switch(N){case A.MxJigCmdManager.DragStatus.kNoChange:return C.kNone;case A.MxJigCmdManager.DragStatus.kCancel:return C.kCancel;case A.MxJigCmdManager.DragStatus.kNull:return C.kNone;case A.MxJigCmdManager.DragStatus.kNormal:return C.kOk}return 1<=N?C.kKeyWord:C.kCancel},D.prototype.SetLASTPOINT=function(N){var I=this._mxObject;if((I=I||E.MxManager.currentMx()).sysVariable().setSysVarPoint("LASTPOINT",N),N){var h=I.sysVariable().getSysVarNumber("GETPOINTSTATUS");h|=A.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,I.sysVariable().setSysVarNumber("GETPOINTSTATUS",h)}else h=I.sysVariable().getSysVarNumber("GETPOINTSTATUS"),h&=~A.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,I.sysVariable().setSysVarNumber("GETPOINTSTATUS",h)},D.prototype.clearLastInputPoint=function(){this._mxObject||(this._mxObject=E.MxManager.currentMx()),this.SetLASTPOINT(void 0)},D.prototype.setCursorType=function(N){this.m_cursorType=N},D.prototype.getCursorType=function(){return this.m_cursorType},D.prototype.setInputToucheType=function(N){this.m_toucheType=N},D.prototype.getInputToucheType=function(){return this.m_toucheType},D.prototype.keyWords=function(){return this.m_keyWords},D.prototype.setKeyWords=function(N){this.m_keyWords=N},D.prototype.message=function(){return this.m_message},D.prototype.setMessage=function(N){this.m_message=N},D.prototype.keyWordPicked=function(){return this.m_keyWordPicked},D.prototype.isKeyWordPicked=function(N){return N=N.toUpperCase(),this.m_keyWordPicked==N},D.prototype.setUserDraw=function(N){N.setMcEdJig(this),this.m_pWorldDraw=N},D.prototype.printMessage=function(){var N=new P.MxString(this.m_message);N.TrimRight(":"),1<this.m_keyWords.length&&this.m_keyWords[0]=="["&&this.m_keyWords[this.m_keyWords.length-1]=="]"?N.m_val.indexOf(`
`)==-1?F.MxUiVue.acutPrintf(`
`+N.m_val+" 或"+this.m_keyWords+":"):F.MxUiVue.acutPrintf(N.m_val+" 或"+this.m_keyWords+":"):N.m_val.indexOf(`
`)==-1?F.MxUiVue.acutPrintf(`
`+N.m_val+":"):F.MxUiVue.acutPrintf(N.m_val+":")},D);function D(){var N=T!==null&&T.apply(this,arguments)||this;return N.m_keyWords="",N.m_message="",N.m_keyWordPicked="",N.m_pWorldDraw=null,N.m_toucheType=A.MxJigCmdManager.InType.kGetBegan,N.m_cursorType=F.MxUiVue.CursorType.kNormal,N}o.MrxDbgUiPrBase=B},{"../MxManager":29,"../MxString":34,"../MxThreeJS":37,"../UI/MxUiVue":65,"./McGiWorldDraw":44,"./MxJig":53,"./MxJigCmdManager":54,three:19}],46:[function(b,n,o){var a,m=this&&this.__extends||(a=function(v,M){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(j,z){j.__proto__=z}||function(j,z){for(var J in z)Object.prototype.hasOwnProperty.call(z,J)&&(j[J]=z[J])})(v,M)},function(v,M){if(typeof M!="function"&&M!==null)throw new TypeError("Class extends value "+String(M)+" is not a constructor or null");function j(){this.constructor=v}a(v,M),v.prototype=M===null?Object.create(M):(j.prototype=M.prototype,new j)});Object.defineProperty(o,"__esModule",{value:!0}),o.MrxDbgUiPrAngle=o.MrxDbgUiPrKeyWord=o.MrxDbgUiPrString=o.MrxDbgUiPrInt=o.MrxDbgUiPrDist=void 0;var c,x=b("three"),A=b("./MxJigCmdManager"),H=b("../MxFun"),F=b("./MrxDbgUiPrBase"),P=b("../UI/MxUiVue"),g=b("../MxThreeJS"),E=b("../MxString"),_=(m(k,c=F.MrxDbgUiPrBase),k.prototype.value=function(){return this.m_value},k.prototype.basePt=function(){return new x.Vector3(this.m_basePt.x,this.m_basePt.y,0)},k.prototype.setBasePt=function(v){this.m_basePt==null?this.m_basePt=new x.Vector3(v.x,v.y,0):(this.m_basePt.x=v.x,this.m_basePt.y=v.y),this.m_useBasePt=!0},k.prototype.setUseBasePt=function(v){this.m_useBasePt=v},k.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.clearLastInputPoint(),this.getDynImput().setGetNumber(!0),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},k.prototype.go=function(v){this.initGo(),this.m_retcall=v,this.m_previousInPoint=null,this.m_currentInPoint=null,this.m_value=0,A.MxJigCmdManager.runCmd(this)},k.prototype.onExitCommand=function(){var v=this;P.MxUiVue.setCursorType(P.MxUiVue.CursorType.kNormal);var M=!1;this.m_retcall!=null&&(A.MxJigCmdManager.setRunCmdEvent(function(){c.prototype.onExitCommand.call(v,!1),M=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.setRunCmdEvent(void 0)),!M&&A.MxJigCmdManager.isWaitCmdNull()&&P.MxUiVue.restoreCmdStatus(),M||c.prototype.onExitCommand.call(this,!0)},k.prototype.onStartCommand=function(){P.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),A.MxJigCmdManager.setKeywordList(this.keyWords()),c.prototype.onStartCommand.call(this)},k.prototype.sampler=function(){var v,M=A.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);return M.status==A.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new x.Vector3(M.pt.x,M.pt.y,0):(this.m_currSamplerPoint.x=M.pt.x,this.m_currSamplerPoint.y=M.pt.y)),v=this.m_useBasePt?this.acquireDist(this.m_toucheType,this.m_basePt):this.acquireDist(this.m_toucheType,this.m_currentInPoint),this.procInKeyword(v),v.status==A.MxJigCmdManager.DragStatus.kNormal?(this.m_value=v.dist,v.status):v.status==A.MxJigCmdManager.DragStatus.kKW1?v.status:this.m_useBasePt||this.m_currentInPoint?M.status:((v=this.acquirePoint(this.m_toucheType,!1)).status==A.MxJigCmdManager.DragStatus.kNormal&&v.exit&&(this.m_previousInPoint==null?this.m_previousInPoint=new x.Vector3(v.pt.x,v.pt.y,0):(this.m_previousInPoint.x=v.pt.x,this.m_previousInPoint.y=v.pt.y)),v.status)},k.prototype.done=function(v){if(this.m_retcall!=null)return this.m_resultDragStatus=v,this.m_useBasePt||v!=A.MxJigCmdManager.DragStatus.kNormal||!this.m_previousInPoint||this.m_currentInPoint?A.MxJigCmdManager.DoneStatius.kExitCommand:(this.m_currentInPoint=this.m_previousInPoint,this.m_previousInPoint=null,A.MxJigCmdManager.DoneStatius.kContinueCommand);H.MxFun.Assert(0)},k.prototype.upDisplay=function(){this.m_currSamplerPoint&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint)),this.m_useBasePt&&this.m_basePt?this.drawEntity(g.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_basePt,16777215)):this.m_currentInPoint&&this.drawEntity(g.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_currentInPoint,16777215)))},k);function k(){var v=c.call(this)||this;return v.m_useBasePt=!1,v.m_basePt=null,v.m_previousInPoint=null,v.m_currentInPoint=null,v.m_value=0,v.m_currSamplerPoint=null,v.m_retcall=null,v.m_resultDragStatus=A.MxJigCmdManager.DragStatus.kCancel,v.m_cursorType=P.MxUiVue.CursorType.kCross,v}o.MrxDbgUiPrDist=_;var U,C=(m(S,U=F.MrxDbgUiPrBase),S.prototype.value=function(){return this.m_value},S.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.clearLastInputPoint()},S.prototype.go=function(v){this.initGo(),this.m_retcall=v,this.m_value=0,this.m_currSamplerPoint=null,this.getDynImput().setGetNumber(!0),A.MxJigCmdManager.runCmd(this)},S.prototype.onExitCommand=function(){var v=this;P.MxUiVue.setCursorType(P.MxUiVue.CursorType.kNormal);var M=!1;this.m_retcall!=null&&(A.MxJigCmdManager.setRunCmdEvent(function(){U.prototype.onExitCommand.call(v,!1),M=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.setRunCmdEvent(void 0)),!M&&A.MxJigCmdManager.isWaitCmdNull()&&P.MxUiVue.restoreCmdStatus(),M||U.prototype.onExitCommand.call(this,!0)},S.prototype.onStartCommand=function(){P.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),A.MxJigCmdManager.setKeywordList(this.keyWords()),U.prototype.onStartCommand.call(this)},S.prototype.sampler=function(){var v=A.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);v.status==A.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new x.Vector3(v.pt.x,v.pt.y,0):(this.m_currSamplerPoint.x=v.pt.x,this.m_currSamplerPoint.y=v.pt.y));var M=this.acquireInt();return this.procInKeyword(M),M.status==A.MxJigCmdManager.DragStatus.kNormal?this.m_value=M.iVal:(M.status,A.MxJigCmdManager.DragStatus.kKW1),M.status},S.prototype.done=function(v){if(this.m_retcall!=null)return this.m_resultDragStatus=v,A.MxJigCmdManager.DoneStatius.kExitCommand;H.MxFun.Assert(0)},S.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},S);function S(){var v=U.call(this)||this;return v.m_value=0,v.m_currSamplerPoint=null,v.m_retcall=null,v.m_resultDragStatus=A.MxJigCmdManager.DragStatus.kCancel,v.m_cursorType=P.MxUiVue.CursorType.kNormal,v.setDynamicInputType(A.MxJigCmdManager.DynamicInputType.kNoInput),v}o.MrxDbgUiPrInt=C;var Y,G=(m(T,Y=F.MrxDbgUiPrBase),T.prototype.value=function(){return this.m_value},T.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null},T.prototype.go=function(v){this.initGo(),this.m_retcall=v,this.m_value="",this.m_currSamplerPoint=null,A.MxJigCmdManager.runCmd(this)},T.prototype.onExitCommand=function(){var v=this;P.MxUiVue.setCursorType(P.MxUiVue.CursorType.kNormal);var M=!1;this.m_retcall!=null&&(A.MxJigCmdManager.setRunCmdEvent(function(){Y.prototype.onExitCommand.call(v,!1),M=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.setRunCmdEvent(void 0)),!M&&A.MxJigCmdManager.isWaitCmdNull()&&P.MxUiVue.restoreCmdStatus(),M||Y.prototype.onExitCommand.call(this,!0)},T.prototype.onStartCommand=function(){P.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),A.MxJigCmdManager.setKeywordList(this.keyWords()),Y.prototype.onStartCommand.call(this)},T.prototype.sampler=function(){var v=A.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);v.status==A.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new x.Vector3(v.pt.x,v.pt.y,0):(this.m_currSamplerPoint.x=v.pt.x,this.m_currSamplerPoint.y=v.pt.y));var M=this.acquireString();return this.procInKeyword(M),M.status==A.MxJigCmdManager.DragStatus.kNormal?this.m_value=M.sValue:(M.status,A.MxJigCmdManager.DragStatus.kKW1),M.status},T.prototype.done=function(v){if(this.m_retcall!=null)return this.m_resultDragStatus=v,A.MxJigCmdManager.DoneStatius.kExitCommand;H.MxFun.Assert(0)},T.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},T);function T(){var v=Y.call(this)||this;return v.m_value="",v.m_currSamplerPoint=null,v.m_retcall=null,v.m_resultDragStatus=A.MxJigCmdManager.DragStatus.kCancel,v.m_cursorType=P.MxUiVue.CursorType.kCross,v}o.MrxDbgUiPrString=G;var B,D=(m(N,B=F.MrxDbgUiPrBase),N.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null},N.prototype.printMessage=function(){var v=new E.MxString(this.m_message);v.TrimRight(":"),1<this.m_keyWords.length&&this.m_keyWords[0]=="["&&this.m_keyWords[this.m_keyWords.length-1]=="]"?v.m_val.indexOf(`
`)==-1?P.MxUiVue.acutPrintf(`
`+v.m_val+" "+this.m_keyWords+":"):P.MxUiVue.acutPrintf(v.m_val+" "+this.m_keyWords+":"):v.m_val.indexOf(`
`)==-1?P.MxUiVue.acutPrintf(`
`+v.m_val+":"):P.MxUiVue.acutPrintf(v.m_val+":")},N.prototype.go=function(v){this.initGo(),this.m_retcall=v,this.m_currSamplerPoint=null,A.MxJigCmdManager.runCmd(this)},N.prototype.onExitCommand=function(){var v=this;P.MxUiVue.setCursorType(P.MxUiVue.CursorType.kNormal);var M=!1;this.m_retcall!=null&&(A.MxJigCmdManager.setRunCmdEvent(function(){B.prototype.onExitCommand.call(v,!1),M=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.setRunCmdEvent(void 0)),!M&&A.MxJigCmdManager.isWaitCmdNull()&&P.MxUiVue.restoreCmdStatus(),M||B.prototype.onExitCommand.call(this,!0)},N.prototype.onStartCommand=function(){P.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),A.MxJigCmdManager.setKeywordList(this.keyWords()),B.prototype.onStartCommand.call(this)},N.prototype.sampler=function(){var v=A.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);v.status==A.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new x.Vector3(v.pt.x,v.pt.y,0):(this.m_currSamplerPoint.x=v.pt.x,this.m_currSamplerPoint.y=v.pt.y));var M=this.acquireKeyword();return this.procInKeyword(M),M.status,A.MxJigCmdManager.DragStatus.kKW1,M.status},N.prototype.done=function(v){if(this.m_retcall!=null)return v>=A.MxJigCmdManager.DragStatus.kKW1&&(v=A.MxJigCmdManager.DragStatus.kNormal),this.m_resultDragStatus=v,A.MxJigCmdManager.DoneStatius.kExitCommand;H.MxFun.Assert(0)},N.prototype.upDisplay=function(){this.m_currSamplerPoint&&this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint))},N);function N(){var v=B.call(this)||this;return v.m_currSamplerPoint=null,v.m_retcall=null,v.m_resultDragStatus=A.MxJigCmdManager.DragStatus.kCancel,v.m_cursorType=P.MxUiVue.CursorType.kCross,v.setUserInputControls(0),v.setDisableDynInput(!0),v}o.MrxDbgUiPrKeyWord=D;var I,h=(m(u,I=F.MrxDbgUiPrBase),u.prototype.value=function(){return this.m_value},u.prototype.basePt=function(){return new x.Vector3(this.m_basePt.x,this.m_basePt.y,0)},u.prototype.setBasePt=function(v){this.m_basePt==null?this.m_basePt=new x.Vector3(v.x,v.y,0):(this.m_basePt.x=v.x,this.m_basePt.y=v.y),this.m_useBasePt=!0},u.prototype.setUseBasePt=function(v){this.m_useBasePt=v},u.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.getDynImput().setGetNumber(!0),this.clearLastInputPoint(),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},u.prototype.go=function(v){this.initGo(),this.m_retcall=v,this.m_previousInPoint=null,this.m_currentInPoint=null,this.m_value=0,A.MxJigCmdManager.runCmd(this)},u.prototype.onExitCommand=function(){var v=this;P.MxUiVue.setCursorType(P.MxUiVue.CursorType.kNormal);var M=!1;this.m_retcall!=null&&(A.MxJigCmdManager.setRunCmdEvent(function(){I.prototype.onExitCommand.call(v,!1),M=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.setRunCmdEvent(void 0)),!M&&A.MxJigCmdManager.isWaitCmdNull()&&P.MxUiVue.restoreCmdStatus(),M||I.prototype.onExitCommand.call(this,!0)},u.prototype.onStartCommand=function(){P.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),A.MxJigCmdManager.setKeywordList(this.keyWords()),I.prototype.onStartCommand.call(this)},u.prototype.sampler=function(){var v,M=A.MxJigCmdManager.acquirePoint(this.m_toucheType,!1);return M.status==A.MxJigCmdManager.DragStatus.kNormal&&(this.m_currSamplerPoint==null?this.m_currSamplerPoint=new x.Vector3(M.pt.x,M.pt.y,0):(this.m_currSamplerPoint.x=M.pt.x,this.m_currSamplerPoint.y=M.pt.y)),v=this.m_useBasePt?this.acquireAngle(this.m_toucheType,this.m_basePt):this.acquireAngle(this.m_toucheType,this.m_currentInPoint),this.procInKeyword(v),v.status==A.MxJigCmdManager.DragStatus.kNormal?(this.m_value=v.ang,v.status):v.status==A.MxJigCmdManager.DragStatus.kKW1?v.status:this.m_useBasePt||this.m_currentInPoint?M.status:((v=this.acquirePoint(this.m_toucheType,!1)).status==A.MxJigCmdManager.DragStatus.kNormal&&v.exit&&(this.m_previousInPoint==null?this.m_previousInPoint=new x.Vector3(v.pt.x,v.pt.y,0):(this.m_previousInPoint.x=v.pt.x,this.m_previousInPoint.y=v.pt.y)),v.status)},u.prototype.done=function(v){if(this.m_retcall!=null)return this.m_resultDragStatus=v,this.m_useBasePt||v!=A.MxJigCmdManager.DragStatus.kNormal||!this.m_previousInPoint||this.m_currentInPoint?A.MxJigCmdManager.DoneStatius.kExitCommand:(this.m_currentInPoint=this.m_previousInPoint,this.m_previousInPoint=null,A.MxJigCmdManager.DoneStatius.kContinueCommand);H.MxFun.Assert(0)},u.prototype.upDisplay=function(){this.m_currSamplerPoint&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(),this.m_pWorldDraw.worldDraw(this.m_currSamplerPoint)),this.m_useBasePt&&this.m_basePt?this.drawEntity(g.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_basePt,16777215)):this.m_currentInPoint&&this.drawEntity(g.MxThreeJS.createLine(this.m_currSamplerPoint,this.m_currentInPoint,16777215)))},u);function u(){var v=I.call(this)||this;return v.m_useBasePt=!1,v.m_basePt=null,v.m_previousInPoint=null,v.m_currentInPoint=null,v.m_value=0,v.m_currSamplerPoint=null,v.m_retcall=null,v.m_resultDragStatus=A.MxJigCmdManager.DragStatus.kCancel,v.m_cursorType=P.MxUiVue.CursorType.kCross,v}o.MrxDbgUiPrAngle=h},{"../MxFun":27,"../MxString":34,"../MxThreeJS":37,"../UI/MxUiVue":65,"./MrxDbgUiPrBase":45,"./MxJigCmdManager":54,three:19}],47:[function(b,n,o){var a,m=this&&this.__extends||(a=function(U,C){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(S,Y){S.__proto__=Y}||function(S,Y){for(var G in Y)Object.prototype.hasOwnProperty.call(Y,G)&&(S[G]=Y[G])})(U,C)},function(U,C){if(typeof C!="function"&&C!==null)throw new TypeError("Class extends value "+String(C)+" is not a constructor or null");function S(){this.constructor=U}a(U,C),U.prototype=C===null?Object.create(C):(S.prototype=C.prototype,new S)});Object.defineProperty(o,"__esModule",{value:!0}),o.MrxDbgUiPrPoint=void 0;var c,x=b("three"),A=b("./MxJigCmdManager"),H=b("../MxFun"),F=b("./MrxDbgUiPrBase"),P=b("../UI/MxUiVue"),g=b("../MxThreeJS"),E=b("../MxManager"),_=(m(k,c=F.MrxDbgUiPrBase),k.prototype.value=function(){return new x.Vector3(this.m_value.x,this.m_value.y,0)},k.prototype.getCADValue=function(){return E.MxManager.getMxCpp().newMcGePoint3d(new x.Vector3(this.m_value.x,this.m_value.y,0))},k.prototype.basePt=function(){return new x.Vector3(this.m_basePt.x,this.m_basePt.y,0)},k.prototype.setBasePt=function(U){this.m_basePt==null?this.m_basePt=new x.Vector3(U.x,U.y,0):(this.m_basePt.x=U.x,this.m_basePt.y=U.y),this.m_useBasePt=!0},k.prototype.setUseBasePt=function(U){this.m_useBasePt=U},k.prototype.initGo=function(){this.m_keyWordPicked="",this.m_retcall=null,this.m_retWhileCall=null,this.m_exitCall=null,this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt)},k.prototype.go=function(U){this.initGo(),this.m_retcall=U,A.MxJigCmdManager.runCmd(this)},k.prototype.goWhile=function(U,C){this.initGo(),this.m_retWhileCall=U,C&&(this.m_exitCall=C),A.MxJigCmdManager.runCmd(this)},k.prototype.onExitCommand=function(){var U=this;P.MxUiVue.setCursorType(P.MxUiVue.CursorType.kNormal);var C=!1;this.m_retcall!=null&&(A.MxJigCmdManager.setRunCmdEvent(function(){c.prototype.onExitCommand.call(U,!1),C=!0}),this.m_retcall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.setRunCmdEvent(void 0)),!C&&A.MxJigCmdManager.isWaitCmdNull()&&P.MxUiVue.restoreCmdStatus(),C||c.prototype.onExitCommand.call(this,!0)},k.prototype.onStartCommand=function(){P.MxUiVue.setCursorType(this.m_cursorType),this.printMessage(),A.MxJigCmdManager.setKeywordList(this.keyWords()),this.m_useBasePt&&this.SetLASTPOINT(this.m_basePt),c.prototype.onStartCommand.call(this)},k.prototype.sampler=function(){var U=this.acquirePoint(this.m_toucheType);return this.procInKeyword(U),U.status==A.MxJigCmdManager.DragStatus.kNormal&&(this.m_value==null?this.m_value=new x.Vector3(U.pt.x,U.pt.y,0):(this.m_value.x=U.pt.x,this.m_value.y=U.pt.y)),U.status},k.prototype.done=function(U){if(this.m_retcall!=null)return this.m_resultDragStatus=U,this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.DoneStatius.kExitCommand;if(this.m_retWhileCall!=null){if((this.m_resultDragStatus=U)==A.MxJigCmdManager.DragStatus.kCancel)return this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.DoneStatius.kExitCommand;var C=!1;U==A.MxJigCmdManager.DragStatus.kNull&&(C=!0);var S=this.m_retWhileCall(this.getReturnStatus(this.m_resultDragStatus));return S!=null&&S.exit!=null&&(C=S.exit),C?(this.m_exitCall&&this.m_exitCall(this.getReturnStatus(this.m_resultDragStatus)),A.MxJigCmdManager.DoneStatius.kExitCommand):(A.MxJigCmdManager.setKeywordList(this.keyWords()),this.printMessage(),A.MxJigCmdManager.DoneStatius.kContinueCommand)}H.MxFun.Assert(0)},k.prototype.upDisplay=function(){if(this.m_value&&(this.m_pWorldDraw&&(this._mxObject.getMcObject().onReadyJigUpdateDispla(0,this.m_value),this.m_pWorldDraw.worldDraw(this.m_value)),this.m_useBasePt&&this.m_basePt)){var U=16777215;this._mxObject.isWhiteViewColor()&&(U=0);var C=this._mxObject;this.drawEntity(g.MxThreeJS.createLine(C.toSmallcoord(this.m_value),C.toSmallcoord(this.m_basePt),U),void 0,!0)}},k);function k(){var U=c.call(this)||this;return U.m_useBasePt=!1,U.m_basePt=null,U.m_value=null,U.m_retcall=null,U.m_retWhileCall=null,U.m_exitCall=null,U.m_resultDragStatus=A.MxJigCmdManager.DragStatus.kCancel,U.m_cursorType=P.MxUiVue.CursorType.kCross,U}o.MrxDbgUiPrPoint=_},{"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,"../UI/MxUiVue":65,"./MrxDbgUiPrBase":45,"./MxJigCmdManager":54,three:19}],48:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxCmdRunManager=void 0;var a,m,c,x,A,H,F,P,g,E,_=b("../MxFun"),k=b("../MxType"),U=b("./MxJigCmdManager"),C=b("../UI/MxUiVue"),S=b("../MxDrawData");function Y(T,B){B===void 0&&(B=!0);var D=!1,N=T.getMxAllSelect();if(T.getMxDatabase().getGripManager().removeAllGrips()&&(D=!0),T.getMxDatabase().getSelectManager().removeAllEntity()&&(D=!0),T.isValidMcObject()){var I=T.getMcObject().getGripManager().getAllSelect();B&&T.getMcObject().getGripManager().setPrvCommandSelect(I),T.getMcObject().getGripManager().clearAll()&&(D=!0)}B&&T.getMxDatabase().getSelectManager().setPrvCommandSelect(N),D&&(T.getMxDatabase().getGripManager().fireMxEntitySelectChange(),T.updateDisplay())}function G(T){E&&Y(T,E=!1)}m=a||(o.MxCmdRunManager=a={}),c={},x=new Array,A=0,H=!1,F="",P={},E=!(g={}),m.InitQuickCommand=function(T){if(T)if(T instanceof Array)for(var B=T.length,D=0;D<B;D++){var N=T[D];if(!(N.length<2)){var I=N[0];if(I.length!=0)for(var h=N.length,u=1;u<h;u++)N[u].length!=0&&(P[N[u].toUpperCase()]=I)}}else console.log("Mx:QuickCommand data error,Not an array");else console.log("Mx:QuickCommand data error")},m.InitLanguageString=function(T){this.m_mapLanguageString=T},m.getLanguageString=function(T,B){var D=g[T];return D===void 0&&(D=B),D},m.MoveUpKey=function(){return H?++A>=x.length&&(A=0):H=!0,!0},m.MoveDownKey=function(){return!!H&&(--A<0&&(A=x.length-1),!0)},m.GetListCommad=function(){return A<0||A>=x.length?"":x[A]},m.ClearPrvCmd=function(){F=""},m.GetPrvCmd=function(){return F},m.SetPrvCmd=function(T){F=T},m.clearCurrentSelect=Y,m.clearCurrentSelectIfNeed=G,m.runCmd=function(T,B,D){var N=B.toUpperCase(),I=c[N];if(T&&I==null){var h=P[N];if(h!=null&&(I=c[h.toUpperCase()]),I==null)return C.MxUiVue.isNull()?console.log(_.MxFun.formatString('未知命令"{0}"',B)):C.MxUiVue.acutPrintf(`未知命令"{0}"。
命令:`,B),!1}if(!I)return!1;T.endPanCommand(),T.getTempMarkDraw().clear(!1);var u=x.indexOf(I.cmd);-1<u&&x.splice(u,1),H=!(A=0),x.push(I.cmd),!(I.flag&k.MxType.MxCommandFlag.MCRX_CMD_NO_RECORD_PRVCMD)&&(F=I.cmd);var v=I.fun;T&&!(I.flag&k.MxType.MxCommandFlag.MCRX_CMD_TRANSPARENT)&&C.MxUiVue.acutPrintf(`{0}
`,I.cmd),U.MxJigCmdManager.stopCmd(U.MxJigCmdManager.DetailedResult.kNewCommadIn),T.callEvent("commandWillStart",{cmd:I.cmd}),T.getMcObject().fireStartRunCommand(I.cmd,I.flag);var M=T.sysVariable().getSysVarNumber("GETPOINTSTATUS");if(M&=~U.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint,M&=~U.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastMovePoint,T.sysVariable().setSysVarNumber("GETPOINTSTATUS",M),E=!1,T&&(I.flag&k.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT)==0)Y(T);else if(!(I.flag&k.MxType.MxCommandFlag.MCRX_JIG_CMD_END_NO_CLEAR_SELECT)&&(E=!0),T&&(I.flag&k.MxType.MxCommandFlag.MCRX_CMD_NO_CLEAR_SELECT_GRIP_POINT)==0){var j=!1;T.getMxDatabase().getGripManager().removeAllGrips()&&(j=!0),T.isValidMcObject()&&T.getMcObject().getGripManager().clearGripDisplay()&&(j=!0),j&&T.updateDisplay()}try{v(D)}catch(z){console.log("mx: run cmd error"),console.log(z)}return T.getMcObject().fireEndRunCommand(I.cmd,I.flag),T&&(U.MxJigCmdManager.isRunning()||(C.MxUiVue.restoreCmdStatus(),G(T)),T.updateDisplay(),S.MxDrawData.m_isAutoResetRenderer||T.resetRenderer()),!0},m.addCommand=function(T,B,D){D==null&&(D=k.MxType.MxCommandFlag.MCRX_CMD_MODAL);var N=T.toUpperCase();c[N]={fun:B,cmd:T,flag:D}}},{"../MxDrawData":22,"../MxFun":27,"../MxType":39,"../UI/MxUiVue":65,"./MxJigCmdManager":54}],49:[function(b,n,o){var a,m=this&&this.__extends||(a=function(D,N){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(I,h){I.__proto__=h}||function(I,h){for(var u in h)Object.prototype.hasOwnProperty.call(h,u)&&(I[u]=h[u])})(D,N)},function(D,N){if(typeof N!="function"&&N!==null)throw new TypeError("Class extends value "+String(N)+" is not a constructor or null");function I(){this.constructor=D}a(D,N),D.prototype=N===null?Object.create(N):(I.prototype=N.prototype,new I)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObjectOsnap=o.McDbLine=o.McDbCurve=o.McDbEntity=o.McDbType=void 0;var c,x,A=b("three"),H=b("../MxThreeJS"),F=b("../MxDrawData"),P=b("./MxJigCmdManager"),g=b("./McEdJigOsnap");(x=c||(o.McDbType=c={}))[x.kInValid=0]="kInValid",x[x.kLine=1]="kLine";var E=(_.prototype.getType=function(){return this.m_type},_);function _(){this.m_type=c.kInValid}o.McDbEntity=E;var k,U=(m(C,k=E),C);function C(){return k!==null&&k.apply(this,arguments)||this}o.McDbCurve=U;var S,Y=(m(G,S=U),G);function G(){var D=S.call(this)||this;return D.m_type=c.kLine,D}o.McDbLine=Y;var T=(B.prototype.getBlobHead=function(D,N){var I={};return I.type=D.getInt32(N,!0),N+=4,I.ver=D.getInt32(N,!0),N+=4,I.databaseIndex=D.getInt32(N,!0),N+=4,I.nOffset=N,I},B.prototype.clearData=function(){this.threejsObjects=new A.Object3D},B.prototype.calculateDistance=function(D,N,I){var h=new A.Vector3().subVectors(N,D),u=new A.Vector3().subVectors(I,D),v=h.clone().normalize(),M=u.clone().normalize(),j=v.dot(M),z=new A.Vector3().subVectors(I,N),J=new A.Vector3().subVectors(D,N),te=z.clone().normalize(),X=J.clone().normalize();if(0<te.dot(X)&&0<j){var se=Math.sqrt(1-j*j),ve=D.distanceTo(I),Ee=ve*se,we=ve*j,Be=h.clone().normalize().multiplyScalar(we),re=D.clone().add(Be),fe=h.clone().normalize().multiplyScalar(200+we);return{pt1:D,pt2:N,pt:I,distance:Ee,targetPt:re,warningPt:D.clone().add(fe)}}return null},B.prototype.getOsnapData=function(D,N){if(this.threejsObjects){var I=new A.Raycaster,h=F.MxDrawData.m_dInputRectWidth;I.linePrecision=this.mxObj.screenCoordLong2World(h);var u=this.mxObj.getCanvas(),v=u.clientWidth,M=u.clientHeight,j=this.mxObj.screenCoord2World(D.x,D.y);j.z=0,D=new A.Vector2(D.x/v*2-1,-D.y/M*2+1),I.setFromCamera(D,this.mxObj.getCamera());var z=I.intersectObjects(this.threejsObjects.children,!0),J=this.mxObj.getSysVarLong("OSMODE"),te=new Map;if(z.length)for(var X=0;X<z.length;X++){var se=z[X];if(se.object.userData&&se.object.userData.obj.getType()==c.kLine){var ve=se.object.userData.obj;if(J&g.MxOsnapDefine.OsModeEnd){var Ee=j.distanceTo(ve.pt1);ve.pt1.type=P.MxJigCmdManager.OsnapMode.kOsModeEnd,te.set(Ee,ve.pt1);var we=j.distanceTo(ve.pt2);ve.pt2.type=P.MxJigCmdManager.OsnapMode.kOsModeEnd,te.set(we,ve.pt2)}if(J&g.MxOsnapDefine.OsModeNear&&(!ve.bulge||ve.bulge==0)){var Be=this.calculateDistance(ve.pt1,ve.pt2,j);Be&&(Be.targetPt.type=P.MxJigCmdManager.OsnapMode.kOsModeNear,te.set(Be.distance,Be.targetPt))}}}if(te.size){var re=this.mxObj.screenCoordLong2World(h),fe=Array.from(te);fe.sort(function(ne,le){return ne[0]-le[0]}),fe[0][0]<re&&N(fe[0][1],fe[0][1].type)}}},B.prototype.mxWebEntitysData=function(D,N){var I=this.getBlobHead(D,0);D.getInt32(I.nOffset,!0),I.nOffset+=4;var h=D.getInt32(I.nOffset,!0);I.nOffset+=4;var u=D.getInt32(I.nOffset,!0);if(I.nOffset+=4,1<u)console.log("mx:error mxfun.js version is old!");else{var v=D.getInt32(I.nOffset,!0);if(I.nOffset+=4,v==I.nOffset){this.threejsObjects=new A.Object3D;for(var M=0;M<h;M++){var j=D.getInt8(I.nOffset);I.nOffset+=1;var z=D.getInt32(I.nOffset,!0);if(I.nOffset+=4,j==1){var J=D.getFloat32(I.nOffset,!0);I.nOffset+=4;var te=D.getFloat32(I.nOffset,!0);I.nOffset+=4;var X=D.getFloat32(I.nOffset,!0);I.nOffset+=4;var se=D.getFloat32(I.nOffset,!0);I.nOffset+=4,(le=new Y).pt1=new A.Vector3(J,te,0),le.pt2=new A.Vector3(X,se,0),(Re=H.MxThreeJS.createLine(le.pt1,le.pt2,16777215)).userData.obj=le,this.threejsObjects.add(Re)}else if(j==2){var ve=D.getInt8(I.nOffset);I.nOffset+=1;var Ee=D.getInt32(I.nOffset,!0);I.nOffset+=4;for(var we=new A.Vector3,Be=0,re=null,fe=0;fe<Ee;fe++){var ne=new A.Vector3;ne.x=D.getFloat32(I.nOffset,!0),I.nOffset+=4,ne.y=D.getFloat32(I.nOffset,!0),I.nOffset+=4;var le,Re,at=D.getFloat32(I.nOffset,!0);I.nOffset+=4,0<fe&&((le=new Y).pt1=we.clone(),le.pt2=ne.clone(),le.bulge=at,(Re=H.MxThreeJS.createLine(le.pt1,le.pt2,16777215)).userData.obj=le,this.threejsObjects.add(Re)),we=ne,Be=at,fe==0&&(re=ne)}ve&&2<Ee&&((le=new Y).pt1=re.clone(),le.pt2=we.clone(),le.bulge=Be,(Re=H.MxThreeJS.createLine(le.pt1,le.pt2,16777215)).userData.obj=le,this.threejsObjects.add(Re))}else console.log("mx:error mxWebEntitysData type"),I.nOffset=I.nOffset-5+z}}else console.log("mx: mxWebEntitysData size assert(0)")}},B);function B(D){this.threejsObjects=null,this.mxObj=null,this.mxObj=D}o.MxDrawObjectOsnap=T},{"../MxDrawData":22,"../MxThreeJS":37,"./McEdJigOsnap":43,"./MxJigCmdManager":54,three:19}],50:[function(b,n,o){var a,m=this&&this.__extends||(a=function(E,_){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(k,U){k.__proto__=U}||function(k,U){for(var C in U)Object.prototype.hasOwnProperty.call(U,C)&&(k[C]=U[C])})(E,_)},function(E,_){if(typeof _!="function"&&_!==null)throw new TypeError("Class extends value "+String(_)+" is not a constructor or null");function k(){this.constructor=E}a(E,_),E.prototype=_===null?Object.create(_):(k.prototype=_.prototype,new k)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxEntSelJig=void 0;var c,x=b("./MxJig"),A=b("./MxJigCmdManager"),H=b("../UI/MxUiVue"),F=b("../MrxDbgUtils"),P=(m(g,c=x.McEdJigCommand),g.prototype.sampler=function(){var E=A.MxJigCmdManager.InType.kGetBegan,_=this.acquirePoint(E);return _.status==A.MxJigCmdManager.DragStatus.kNormal&&(this.point=_.pt),_.status},g.prototype.done=function(E){if(E==A.MxJigCmdManager.DragStatus.kNormal){var _=this;F.MrxDbgUtils.findEntAtPoint(this.getMxObject(),this.point,this.filter).then(function(k){_.callRet(k)})}else this.callRet([]);return A.MxJigCmdManager.DoneStatius.kExitCommand},g.prototype.onStartCommand=function(){H.MxUiVue.setCursorType(H.MxUiVue.CursorType.kRect),c.prototype.onStartCommand.call(this)},g.prototype.onExitCommand=function(){H.MxUiVue.setCursorType(H.MxUiVue.CursorType.kNormal),A.MxJigCmdManager.isWaitCmdNull()&&H.MxUiVue.restoreCmdStatus(),c.prototype.onExitCommand.call(this,!0)},g.prototype.upDisplay=function(){},g);function g(){return c!==null&&c.apply(this,arguments)||this}o.MxEntSelJig=P},{"../MrxDbgUtils":20,"../UI/MxUiVue":65,"./MxJig":53,"./MxJigCmdManager":54}],51:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxGridTrace=void 0;var a=b("three"),m=b("./MxJigCmdManager"),c=b("../MxFun"),x=b("../MxDrawData"),A=b("../MxThreeJS"),H=(F.prototype.ClearDynDrawEntity=function(){for(var P=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),g=this.m_vecDynDrawEntity.length,E=0;E<g;E++)c.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[E],P);this.m_vecDynDrawEntity=[]},F.prototype.GetSanpValue=function(P,g){var E=P%g;return 0<=E?g/2<E?P+=g-E:P-=E:g/2<(E=Math.abs(E))?P-=g-E:P+=E,P},F.prototype.CreteTracePoint=function(P,g){var E=this.m_mxJig.getMxObject(),_=E.getTheTempDrawContainer_SmallCoord_JigDraw();g/=2;var k=A.MxThreeJS.createLine(E.toSmallcoord2(P.x+g,P.y+g,0),E.toSmallcoord2(P.x-g,P.y-g,0),16711680);_.add(k),this.m_vecDynDrawEntity.push(k);var U=A.MxThreeJS.createLine(E.toSmallcoord2(P.x-g,P.y+g,0),E.toSmallcoord2(P.x+g,P.y-g,0),16711680);_.add(U),this.m_vecDynDrawEntity.push(U)},F.prototype.isTrace=function(){return this.m_isTrace&&this.m_mxJig.getMxObject().getSysVarLong("GRIDMODE")!=0},F.prototype.MouseMove=function(P){var g=this.m_mxJig.getMxObject();if(g.getMcObject().isValid()){if(this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1,this.isTrace()){var E=g.getSysVarPoint("SNAPUNIT");if(!(E.x<1e-6||E.y<1e-6)){P.z=0;var _=new a.Vector3;_.x=this.GetSanpValue(P.x,E.x),_.y=this.GetSanpValue(P.y,E.y);var k=g.viewCoordLong2Cad(x.MxDrawData.m_dInputRectWidth),U=2*k;_.distanceTo(P)<U&&(this.m_isValidTracePoint=!0,this.m_ptTracePoint=_,this.CreteTracePoint(_,k))}}}else this.m_isTrace=!1},F.prototype.Init=function(){var P=this.m_mxJig.getMxObject();P.getMcObject().isValid()?(this.m_isValidTracePoint=!1,this.m_isTrace=!0,P.sysVariable().getSysVarNumber("GETPOINTSTATUS")&m.MxJigCmdManager.GETPOINTSTATUS.OsModeGridSnapTempDisable&&(this.m_isTrace=!1),this.m_mxJig.isDisableGridTrace()&&(this.m_isTrace=!1)):this.m_isTrace=!1},F.prototype.GetTracePoint=function(){if(this.isTrace())return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},F.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},F.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1},F);function F(P){this.m_vecDynDrawEntity=[],this.m_ptTracePoint=new a.Vector3,this.m_isValidTracePoint=!1,this.m_isTrace=!1,this.m_mxJig=null,this.m_mxJig=P}o.MxGridTrace=H},{"../MxDrawData":22,"../MxFun":27,"../MxThreeJS":37,"./MxJigCmdManager":54,three:19}],52:[function(b,n,o){var a,m=this&&this.__extends||(a=function(_,k){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(U,C){U.__proto__=C}||function(U,C){for(var S in C)Object.prototype.hasOwnProperty.call(C,S)&&(U[S]=C[S])})(_,k)},function(_,k){if(typeof k!="function"&&k!==null)throw new TypeError("Class extends value "+String(k)+" is not a constructor or null");function U(){this.constructor=_}a(_,k),_.prototype=k===null?Object.create(k):(U.prototype=k.prototype,new U)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxIntelliSelectJig=void 0;var c,x=b("three"),A=b("./MxJig"),H=b("./MxJigCmdManager"),F=b("../MxThreeJS"),P=b("../MxTools"),g=(m(E,c=A.McEdJigCommand),E.prototype.sampler=function(){var _=H.MxJigCmdManager.InType.kGetBegan,k=this.acquirePoint(_);return k.status==H.MxJigCmdManager.DragStatus.kNormal&&(this.m_pt2=k.pt),k.status},E.prototype.getTypeName=function(){return"MxIntelliSelect"},E.prototype.done=function(_){if(_==H.MxJigCmdManager.DragStatus.kNormal){var k=this.getMxObject();k.getMxDatabase().getGripManager().doWindowsSelect(this.m_pt1,this.m_pt2,this.m_isRemoveSelect),k.getMcObject().getGripManager().doRangeSelect(this.m_pt1,this.m_pt2,this.m_isRemoveSelect)}return H.MxJigCmdManager.DoneStatius.kExitCommand},E.prototype.upDisplay=function(){var _=this.getMxObject(),k=this.m_pt1.clone(),U=this.m_pt2.clone(),C=new x.Vector3(this.m_pt1.x,this.m_pt2.y,this.m_pt2.z),S=new x.Vector3(this.m_pt2.x,this.m_pt1.y,this.m_pt2.z);if(!P.MxTools.IsZero(_.getViewAngle())){var Y=new x.Matrix4;Y.makeRotationZ(_.getViewAngle());var G=new x.Matrix4().makeTranslation(k.x,k.y,0).multiply(Y).multiply(new x.Matrix4().makeTranslation(-k.x,-k.y,0));k.applyMatrix4(G),U.applyMatrix4(G),C=new x.Vector3(k.x,U.y,U.z),S=new x.Vector3(U.x,k.y,U.z);var T=new x.Matrix4;T.getInverse(G),k.applyMatrix4(T),U.applyMatrix4(T),C.applyMatrix4(T),S.applyMatrix4(T)}k=_.toSmallcoord(k),U=_.toSmallcoord(U),C=_.toSmallcoord(C),S=_.toSmallcoord(S);var B=[];B.push(k),B.push(C),B.push(U),B.push(S),B.push(k);var D=null,N=65280,I=_.automaticInversionColor(16777215);if(U.x>k.x)D=F.MxThreeJS.createLines(B,I),N=255;else{var h=_.screenCoordLong2Smallcoord(3);D=F.MxThreeJS.createDashedLines(B,I,2*h,h)}var u=[];u.push(k),u.push(C),u.push(U),u.push(k),u.push(U),u.push(S);var v=F.MxThreeJS.createTriangle(u,N,.27);this.drawEntity(v,30,!0),this.drawEntity(D,31,!0)},E);function E(_,k){k===void 0&&(k=!1);var U=c.call(this)||this;return U.m_isRemoveSelect=!1,U.m_pt1=_,U.m_pt2=_,U.m_isRemoveSelect=k,U}o.MxIntelliSelectJig=g},{"../MxThreeJS":37,"../MxTools":38,"./MxJig":53,"./MxJigCmdManager":54,three:19}],53:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McEdJigCommand=o.MxDynamicInput=void 0;var a=b("three"),m=b("../MxFun"),c=b("./MxJigCmdManager"),x=b("../MxManager"),A=b("../MxTools"),H=b("../UI/MxUiVue"),F=b("./McEdJigOsnap"),P=b("./McEdJigDynamicTrace"),g=b("./MxPolarAxisTrace"),E=b("./MxGridTrace"),_=b("../MxThreeJS"),k=b("../MxDrawData"),U=b("./MxOffsetArrow"),C=(S.prototype.getLockValuesMap=function(){return this.m_isShowDynInput?H.MxUiVue.DynamicInput_getLockValuesMap():new Map},S.prototype.getFocusIndex=function(){return this.m_isShowDynInput?this.m_iFocusIndex:-1},S.prototype.ClearDynDrawEntity=function(){for(var T=this.m_jig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),B=this.m_vecDynDrawEntity.length,D=0;D<B;D++)m.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[D],T);this.m_vecDynDrawEntity=[]},S.prototype.setGetNumber=function(T){this.m_isGetNumber=T},S.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},S.prototype.onKeyEcsDown=function(){return this.m_isShowDynInput&&this.m_isInputStatus?(this.m_isInputStatus=!1,H.MxUiVue.OnMxEvent({name:"dynInputReSet"}),1):0},S.prototype.getCurrentInputPointCoordinates=function(T){if(!this.m_isShowDynInput)return!1;var B=H.MxUiVue.DynamicInput_getLockValuesMap();if(B.size==0)return!1;var D,N=T.clone(),I=this.m_jig.getMxObject();if(H.MxUiVue.DynamicInput_getType()!=c.MxJigCmdManager.DynamicInputType.kDistanceInput)return H.MxUiVue.DynamicInput_getType()==c.MxJigCmdManager.DynamicInputType.kXYCoordInput&&(B.size!=1?B.size==2&&B.has(0)&&B.has(1)?(N.x=A.MxTools._tstof(B.get(0)),N.y=A.MxTools._tstof(B.get(1)),N):(console.log("Mx:error index:",B),!1):(u=(D=B.entries().next().value)[0],v=A.MxTools._tstof(D[1]),u==0?(N.x=v,N):u==1?(N.y=v,N):(console.log("Mx:error index:",u),!1)));if(!(I.sysVariable().getSysVarNumber("GETPOINTSTATUS")&c.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint))return!1;var h=I.sysVariable().getSysVarPoint("LASTPOINT");if(B.size==1){var u=(D=B.entries().next().value)[0],v=A.MxTools._tstof(D[1]);if(u==0)return!((X=N.clone().sub(h)).length()<1e-7)&&(X.normalize(),X.multiplyScalar(v),h.clone().add(X));if(u!=1)return console.log("Mx:error index:",u),!1;var M=v;if(!(I.sysVariable().getSysVarNumber("GETPOINTSTATUS")&c.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint))return!1;var j=I.sysVariable().getSysVarPoint("LASTPOINT");return!((X=N.clone().sub(j)).length()<1e-7)&&(M=M*Math.PI/180,X.dot(new a.Vector3(0,1,0))<0&&(M=-M),(z=new a.Vector3(X.length(),0,0)).applyAxisAngle(new a.Vector3(0,0,1),M),j.clone().add(z))}if(B.size!=2||!B.has(0)||!B.has(1))return console.log("Mx:error index:",B),!1;if(!(I.sysVariable().getSysVarNumber("GETPOINTSTATUS")&c.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint))return!1;var z,J=A.MxTools._tstof(B.get(0)),te=(M=A.MxTools._tstof(B.get(1)),I.sysVariable().getSysVarPoint("LASTPOINT")),X=N.clone().sub(te);return M=M*Math.PI/180,X.dot(new a.Vector3(0,1,0))<0&&(M=-M),(z=new a.Vector3(J,0,0)).applyAxisAngle(new a.Vector3(0,0,1),M),te.clone().add(z)},S.prototype.onKeyDonw=function(T){if(!this.m_isShowDynInput||T==27||T==16||T==17||T==18)return 0;if(T==9)return this.m_isInputStatus=!1,0;if(T!=32&&T!=13)return this.m_isInputStatus=!0,0;if(this.m_isInputStatus&&H.MxUiVue.DynamicInput_isShow()){if(this.m_isGetNumber||H.MxUiVue.DynamicInput_getType()==c.MxJigCmdManager.DynamicInputType.kDistanceInput){var B=H.MxUiVue.DynamicInput_getFocusValue();this.m_iFocusIndex=H.MxUiVue.DynamicInput_getFocusIndex(),H.MxUiVue.setCmdText(B)}else if(H.MxUiVue.DynamicInput_getType()==c.MxJigCmdManager.DynamicInputType.kXYCoordInput){var D=H.MxUiVue.DynamicInput_getValue1(),N=H.MxUiVue.DynamicInput_getValue2(),I=H.MxUiVue.DynamicInput_getLockValuesMap();I.has(0)&&(D=I.get(0)),I.has(1)&&(N=I.get(1)),B=H.MxUiVue.DynamicInput_getFocusValue();var h=H.MxUiVue.DynamicInput_getFocusIndex(),u="";B.length!=0?u=A.MxTools.IsNumerical(B)?h==0?m.MxFun.formatString("{0},{1}",B,N):m.MxFun.formatString("{0},{1}",D,B):B:A.MxTools.IsNumerical(D)&&A.MxTools.IsNumerical(N)&&(u=m.MxFun.formatString("{0},{1}",D,N)),this.m_iFocusIndex=h,H.MxUiVue.setCmdText(u)}}return this.m_isInputStatus=!1,0},S.prototype.isInputStatus=function(){return this.m_isInputStatus},S.prototype.isTruncatedInput=function(){return this.m_isShowDynInput&&this.m_isInputStatus},S.prototype.initDynInput=function(T){this.m_jig=T;var B=this.m_jig.getMxObject();if(this.m_iFocusIndex=-1,this.m_isShowDynInput=!1,!H.MxUiVue.isNull()){H.MxUiVue.DynamicInput_clearLockValuesMap(),H.MxUiVue.DynamicInput_setType(this.m_dynType);var D=B.sysVariable().getSysVarNumber("GETPOINTSTATUS");D&c.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint&&H.MxUiVue.SetLasetPoint(B.sysVariable().getSysVarPoint("LASTPOINT")),this.m_dynType==c.MxJigCmdManager.DynamicInputType.kAutoInput&&(D&c.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint?H.MxUiVue.DynamicInput_setType(c.MxJigCmdManager.DynamicInputType.kDistanceInput):H.MxUiVue.DynamicInput_setType(c.MxJigCmdManager.DynamicInputType.kXYCoordInput))}},S.prototype.setFocus=function(T){H.MxUiVue.OnMxEvent({name:"dynInputSetFocus",param:{isFocus:T}})},S.prototype.exitDynInput=function(){H.MxUiVue.DynamicInput_setShow(!1),H.MxUiVue.DynamicInput_upDisplay()},S.prototype.isShow=function(){return H.MxUiVue.DynamicInput_isShow()},S.prototype.drawSolidPoint=function(T,B,D,N){var I=_.MxThreeJS.createPoint(N.toSmallcoord(T),this.m_iDashedLineLenColor,B);D.add(I),this.m_vecDynDrawEntity.push(I)},S.prototype.drawDashedLine=function(T,B,D,N,I,h){var u=_.MxThreeJS.createDashedLine(h.toSmallcoord2(T.x,T.y,T.z),h.toSmallcoord2(B.x,B.y,B.z),this.m_iDashedLineLenColor,N,N);D.add(u),this.m_vecDynDrawEntity.push(u)},S.prototype.worldDrawDistanceInput=function(T,B){var D=this.m_jig.getMxObject();if(D.getMcObject().isValid()&&((T=T.clone()).z=0,(B=B.clone()).z=0,!(D.docCoordLong2Screen(T.distanceTo(B))<20))){var N=D.getTheTempDrawContainer_SmallCoord_JigDraw(),I=D.viewCoordLong2Cad(this.m_dashedLineLen),h=T.clone().sub(B),u=h.clone();u.applyAxisAngle(new a.Vector3(0,0,1),.5*Math.PI),u.normalize(),u.multiplyScalar(D.viewCoordLong2Cad(50));var v=new a.Vector3(0,1,0),M=new a.Vector3(1,0,0);u.dot(v)<0&&u.multiplyScalar(-1),h.dot(v)<0&&u.multiplyScalar(-1),h.dot(M)<0&&u.multiplyScalar(-1);var j=B.clone().add(u),z=T.clone().add(u),J=B.distanceTo(T),te=new a.Vector3(B.x+J,B.y,B.z);this.drawSolidPoint(B.clone().add(u),3,N,D),this.drawSolidPoint(T.clone().add(u),3,N,D),this.drawSolidPoint(te,3,N,D),this.drawDashedLine(j,z,N,I,I,D),this.drawDashedLine(B,j,N,I,I,D),this.drawDashedLine(T,z,N,I,I,D),this.drawDashedLine(B,te,N,I,I,D);var X=T.clone().sub(B),se=0;1e-6<X.length()&&(se=X.angleTo(new a.Vector3(1,0,0)));var ve=0,Ee=se;X.dot(v)<0&&(ve=2*Math.PI-se,Ee=se);var we=_.MxThreeJS.createDashedArc(D.toSmallcoord(B),J,ve,Ee,this.m_iDashedLineLenColor,I,I);N.add(we),this.m_vecDynDrawEntity.push(we)}},S.prototype.upDynInput=function(){if(!H.MxUiVue.isNull()){var T=this.m_jig.getMxObject(),B=!1;if(B=!this.m_jig.isDisableDynInput()&&T.getSysVarLong("DYNINPUT")==1,k.MxDrawData.m_isForbiddenDynInput&&(B=!1),m.MxFun.isPC()||(B=!1),H.MxUiVue.DynamicInput_setShow(B),this.m_isShowDynInput=B){if(H.MxUiVue.DynamicInput_setTip(H.MxUiVue.getCmdTip()),c.MxJigCmdManager.getAcquireStatus()==c.MxJigCmdManager.AcquireStatus.kMove){var D=c.MxJigCmdManager.getAcquirePoint();if(H.MxUiVue.DynamicInput_setPos(T.currentCoord2Screen(D.x,D.y,D.z)),H.MxUiVue.DynamicInput_getType()==c.MxJigCmdManager.DynamicInputType.kXYCoordInput)H.MxUiVue.DynamicInput_setValue1(D.x.toFixed(3)),H.MxUiVue.DynamicInput_setValue2(D.y.toFixed(3));else if(H.MxUiVue.DynamicInput_getType()==c.MxJigCmdManager.DynamicInputType.kDistanceInput){var N=c.MxJigCmdManager.getAcquirePoint(),I=H.MxUiVue.GetLasetPoint();this.worldDrawDistanceInput(N,I);var h=new a.Vector3(I.x+.5*(N.x-I.x),I.y+.5*(N.y-I.y),I.z+.5*(N.z-I.z)),u=N.clone().sub(I);u.length()<1e-8&&(u=new a.Vector3(1,0,0));var v=u.clone();v.applyAxisAngle(new a.Vector3(0,0,1),.5*Math.PI),v.normalize(),v.multiplyScalar(T.viewCoordLong2Cad(50));var M=new a.Vector3(0,1,0),j=new a.Vector3(1,0,0);v.dot(M)<0&&v.multiplyScalar(-1),u.dot(M)<0&&v.multiplyScalar(-1),u.dot(j)<0&&v.multiplyScalar(-1),h.add(v);var z=I.distanceTo(N);H.MxUiVue.DynamicInput_setValue1(z.toFixed(3)),H.MxUiVue.DynamicInput_setValue1Pos(T.currentCoord2Screen(h.x,h.y,D.z)),z=I.distanceTo(N);var J=I.clone();J.x+=z;var te=(h=new a.Vector3(J.x+.5*(N.x-J.x),J.y+.5*(N.y-J.y),J.z+.5*(N.z-J.z))).clone().sub(I);te.normalize(),te.multiplyScalar(z),h=I.clone().add(te);var X=N.clone().sub(I),se=0;1e-6<X.length()&&(se=X.angleTo(new a.Vector3(1,0,0))),se=180*se/Math.PI,H.MxUiVue.DynamicInput_setValue2(se.toFixed(3)+"°"),H.MxUiVue.DynamicInput_setValue2Pos(T.currentCoord2Screen(h.x,h.y,D.z))}}H.MxUiVue.DynamicInput_upDisplay()}}},S.prototype.setDynamicInputType=function(T){this.m_dynType=T},S.prototype.getDynamicInputType=function(){return this.m_dynType},S);function S(T){this.m_dynType=c.MxJigCmdManager.DynamicInputType.kAutoInput,this.m_isInputStatus=!1,this.m_vecDynDrawEntity=[],this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=8421504,this.m_iFocusIndex=-1,this.m_isShowDynInput=!1,this.m_isGetNumber=!1,this.m_jig=T,this.m_iDashedLineLenColor=k.MxDrawData.m_dynamicInputLineColor}o.MxDynamicInput=C;var Y=(G.prototype.getTypeName=function(){return""},G.prototype.isExit=function(){return this._isExit},G.prototype.isEnableOsnap=function(){return this.getOsnap().getIsEnableVar()&&!F.McEdImpJigGlobalData.isTmpDisableOsmode()},G.prototype.getDetailedResult=function(){return this.m_DetailedResult},G.prototype.clearGroup=function(){this.drawGroup&&(this._mxObject.getTheTempDrawContainer().remove(this.drawGroup),this.drawGroup=null),this.drawGroup_smallCoord&&(this._mxObject.getTheTempDrawContainer_SmallCoord_JigDraw().remove(this.drawGroup_smallCoord),this.drawGroup_smallCoord=null)},G.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new a.Group,k.MxDrawData.m_isMapBox||(this.drawGroup.renderOrder=x.MxData.iGripRenderOrder),this._mxObject.getTheTempDrawContainer().add(this.drawGroup)),this.drawGroup},G.prototype.getParentGroup_smallCoord=function(){return this.drawGroup_smallCoord||(this.drawGroup_smallCoord=new a.Group,k.MxDrawData.m_isMapBox||(this.drawGroup_smallCoord.renderOrder=x.MxData.iGripRenderOrder),this._mxObject.getTheTempDrawContainer_SmallCoord_JigDraw().add(this.drawGroup_smallCoord)),this.drawGroup_smallCoord},G.prototype.onExitCommand=function(T){T&&this.m_dynInput.exitDynInput(),this.m_osnap.endDrag(),this.m_dynamicTrace.ClearDisplay(),this.m_polarAxisTrace.ClearDisplay(),this.m_offsetArrow.ClearDisplay(),this.m_gridTrace.ClearDisplay(),this.m_dynInput.ClearDisplay(),this.clearGroup(),this._mxObject.getMcObject().onJigCommandEnd(),this._mxObject.clearTempDrawContainer_SmallCoord_JigDraw()},G.prototype.getOsnap=function(){return this.m_osnap},G.prototype.getOrtho=function(){return this.m_ortho},G.prototype.getDynamicTrace=function(){return this.m_dynamicTrace},G.prototype.getPolarAxisTrace=function(){return this.m_polarAxisTrace},G.prototype.getOffsetArrow=function(){return this.m_offsetArrow},G.prototype.getGridTrace=function(){return this.m_gridTrace},G.prototype.onGetOsnapData=function(T){this.m_dynamicTrace.OnDynamicTrace(T.id,new a.Vector3(T.ptsx,T.ptsy,T.ptsz),T.osmode)},G.prototype.isDisableDynInput=function(){return this.m_isDisableDynInput},G.prototype.setDisableDynInput=function(T){this.m_isDisableDynInput=T},G.prototype.setDisableOsnap=function(T){this.m_isDisableOsnap=T},G.prototype.setOffsetInputPostion=function(T){this.m_isOffsetInputPostion=T},G.prototype.isOffsetInputPostion=function(){return this.m_isOffsetInputPostion},G.prototype.isDisableOsnap=function(){return this.m_isDisableOsnap},G.prototype.setDisableDynamicTrace=function(T){this.m_isDisableDynamicTrace=T},G.prototype.isDisableDynamicTrace=function(){return this.m_isDisableDynamicTrace},G.prototype.setDisablePolarAxisTrace=function(T){this.m_isDisablePolarAxisTrace=T},G.prototype.isDisablePolarAxisTrace=function(){return this.m_isDisablePolarAxisTrace},G.prototype.setDisableGridTrace=function(T){this.m_isDisableGridTrace=T},G.prototype.isDisableGridTrace=function(){return this.m_isDisableGridTrace},G.prototype.setDisableOrthoTrace=function(T){this.m_isDisableOrtho=T},G.prototype.isDisableOrthoTrace=function(){return this.m_isDisableOrtho},G.prototype.disableAllTrace=function(T){T===void 0&&(T=!0),this.m_isDisableOsnap=T,this.m_isDisableDynamicTrace=T,this.m_isDisablePolarAxisTrace=T,this.m_isDisableGridTrace=T,this.m_isDisableOrtho=T},G.prototype.onStartCommand=function(){this._isCancle=!1,this._isExit=!1,this.m_DetailedResult=c.MxJigCmdManager.DetailedResult.kUnknown,this.m_dynInput.initDynInput(this),this.m_osnap.startDrag(this.m_isOffsetInputPostion,this);var T=this._mxObject.getCurrentMousePostion();if(this._mxObject.isValidCurMousePostion()){var B=this._mxObject.screenCoord2Current(T.x,T.y,0);this.m_osnap.setPoint(B)}this.m_dynamicTrace.Init(),this.m_polarAxisTrace.Init(),this.m_offsetArrow.Init(),this.m_gridTrace.Init(),this.m_ortho.Init(),c.MxJigCmdManager.doMouseMoveImp(void 0,m.MxFun.isPC()),this.m_dynInput.setFocus(!0)},G.prototype.getDynImput=function(){return this.m_dynInput},G.prototype.setMxObject=function(T){this._mxObject=T},G.prototype.getMxObject=function(){return this._mxObject},G.prototype.setColor=function(T){this._iColor=T},G.prototype.getColor=function(){return this._iColor},G.prototype.setDynamicInputType=function(T){this.m_dynInput.setDynamicInputType(T)},G.prototype.getDynamicInputType=function(){return this.m_dynInput.getDynamicInputType()},G.prototype.createTriangle=function(T,B,D){var N=new a.MeshBasicMaterial({color:this._iColor,side:a.DoubleSide}),I=new a.Geometry;I.vertices.push(T),I.vertices.push(B),I.vertices.push(D);var h=new a.Vector3(1,1,1),u=new a.Color(this._iColor),v=new a.Face3(0,1,2,h,u,0);return I.faces.push(v),I.computeFaceNormals(),I.computeVertexNormals(),new a.Mesh(I,N)},G.prototype.createPoint=function(T){var B=new a.Geometry;B.vertices.push(T);var D=new a.PointsMaterial({color:this._iColor,size:3});return new a.Points(B,D)},G.prototype.createLine=function(T,B){var D=new a.Geometry,N=new a.LineBasicMaterial({color:this._iColor});return D.vertices.push(T,B),new a.Line(D,N)},G.prototype.drawReserve=function(T){this.m_isReserveDrawStatus=!0,this.m_callReserveDrawAddEntity=T,this.upDisplay(),this.m_isReserveDrawStatus=!1,this.m_callReserveDrawAddEntity=null},G.prototype.drawMcDbEntity=function(T,B,D){var N=T.getImp(),I=N.GetObjectID();I==0&&T.tempRelationObject(),this.m_isReserveDrawStatus?this._mxObject.getMcObject().DrawEntity(N,B,D):this._mxObject.getMcObject().onJigDrawEntityDisplay(N,B,D),I==0&&T.freeTempRelationObject()},G.prototype.drawMcDbLine=function(T,B,D,N,I,h,u){this.m_isReserveDrawStatus?this._mxObject.getMcObject().DrawLine(T,B,D,N,I,h,u):this._mxObject.getMcObject().onJigDrawEntityDisplay_line(T,B,D,N,I,h,u)},G.prototype.drawEntity=function(T,B,D){if(D===void 0&&(D=!1),T!=null)if(this.m_isReserveDrawStatus)k.MxDrawData.m_isMapBox||(T.renderOrder=B??x.MxData.iDynJigRenderOrder),this._mxObject.addObject(T),this.m_callReserveDrawAddEntity&&this.m_callReserveDrawAddEntity(T);else{var N="MxDynDraw_"+this._DynNameId.toString();T.name=N,k.MxDrawData.m_isMapBox||(T.renderOrder=B??x.MxData.iDynJigRenderOrder),this._aryDynDrawObjectNamesId==null&&(this._aryDynDrawObjectNamesId=new Array),this._aryDynDrawObjectNamesId.push(this._DynNameId),this._DynNameId++,D?this.getParentGroup_smallCoord().add(T):this.getParentGroup().add(T)}},G.prototype.floorPowerOfTwo=function(T){return Math.pow(2,Math.floor(Math.log(T)/Math.LN2))},G.prototype.makeTextSprite=function(T,B,D,N,I){var h,u=document.createElement("canvas"),v=u.getContext("2d"),M=m.MxFun.formatString("normal {0}px Arial","256");v.font=M;var j=v.measureText(T);h=2*this.floorPowerOfTwo(j.width),u.width=h,u.height=256,v.font=M,v.textAlign="center",v.textBaseline="middle";var z=m.MxFun.formatString("#{0}",I.toString(16));v.fillStyle=z,v.fillText(T,h/2,128);var J=new a.Texture(u);J.needsUpdate=!0;var te=new a.SpriteMaterial({map:J});te.transparent=!1,te.rotation=N;var X=new a.Sprite(te);return X.scale.set(h/256*D,D,1),X.position.set(B.x,B.y,0),X},G.prototype.drawText=function(T,B,D,N){var I=this.makeTextSprite(T,N,B,D,this._iColor);this.drawEntity(I)},G.prototype.drawPoints=function(T){for(var B=0;B<T.length;B++){var D=new a.Geometry;D.vertices.push(T[B]);var N=new a.PointsMaterial({color:this._iColor,size:3}),I=new a.Points(D,N);this.drawEntity(I)}},G.prototype.drawPoint=function(T){var B=new a.Geometry;B.vertices.push(T);var D=new a.PointsMaterial({color:this._iColor,size:3}),N=new a.Points(B,D);this.drawEntity(N)},G.prototype.drawPolyline=function(T){for(var B=new a.Geometry,D=0;D<T.length;D++)B.vertices.push(T[D]);var N=new a.LineBasicMaterial({color:this._iColor}),I=new a.Line(B,N);this.drawEntity(I)},G.prototype.drawSpline=function(T){},G.prototype.drawCircle=function(T,B){var D=new a.CircleGeometry(B,64,3,2*Math.PI),N=new a.LineBasicMaterial({color:this._iColor});D.vertices.shift();var I=new a.LineLoop(D,N);I.position.x=T.x,I.position.y=T.y,I.position.z=T.z,this.drawEntity(I)},G.prototype.drawArc=function(T,B,D,N){var I=new a.CircleGeometry(B,64,D,N),h=new a.LineBasicMaterial({color:this._iColor});I.vertices.shift();var u=new a.Line(I,h);u.position.x=T.x,u.position.y=T.y,u.position.z=T.z,this.drawEntity(u)},G.prototype.drawLine=function(T,B){var D=new a.Geometry,N=new a.LineBasicMaterial({color:this._iColor});D.vertices.push(T,B);var I=new a.Line(D,N);this.drawEntity(I)},G.prototype.removeDynDrawObject=function(){if(this._aryDynDrawObjectNamesId!=null){for(var T=0;T<this._aryDynDrawObjectNamesId.length;T++){var B,D="MxDynDraw_"+this._aryDynDrawObjectNamesId[T].toString();(B=this.getParentGroup().getObjectByName(D))?m.MxFun.removeThreejsObject(B,this.getParentGroup()):(B=this.getParentGroup_smallCoord().getObjectByName(D))&&m.MxFun.removeThreejsObject(B,this.getParentGroup_smallCoord())}this._aryDynDrawObjectNamesId=[],this._mxObject.getMcObject().onJigClearDisplay()}},G.prototype.acquirePoint=function(T,B){B===void 0&&(B=!0);var D=c.MxJigCmdManager.acquirePoint(T,B);return this._isExit=D.exit,this._isExit&&(this.m_DetailedResult=D.DetailedResult),D},G.prototype.acquireDist=function(T,B){var D=c.MxJigCmdManager.acquireDist(T,B);return this._isExit=D.exit,this._isExit&&(this.m_DetailedResult=D.DetailedResult),D},G.prototype.acquireAngle=function(T,B){var D=c.MxJigCmdManager.acquireAngle(T,B);return this._isExit=D.exit,this._isExit&&(this.m_DetailedResult=D.DetailedResult),D},G.prototype.acquireInt=function(){var T=c.MxJigCmdManager.acquireInt();return this._isExit=T.exit,this._isExit&&(this.m_DetailedResult=T.DetailedResult),T},G.prototype.acquireString=function(){var T=c.MxJigCmdManager.acquireString();return this._isExit=T.exit,this._isExit&&(this.m_DetailedResult=T.DetailedResult),T},G.prototype.acquireKeyword=function(){var T=c.MxJigCmdManager.acquireKeyword();return this._isExit=T.exit,this._isExit&&(this.m_DetailedResult=T.DetailedResult),T},G.prototype.notifyCancleExit=function(T){this.m_DetailedResult=T,this._isCancle=!0,this.removeDynDrawObject(),this.done(c.MxJigCmdManager.DragStatus.kCancel),this.onExitCommand(!0),c.MxJigCmdManager.commandRunComplete(this)},G.prototype.notifySampler=function(){var T=this.sampler();if(this.m_dynInput.upDynInput(),T==c.MxJigCmdManager.DragStatus.kNormal&&(this.removeDynDrawObject(),this.upDisplay()),this._isExit){var B=this.done(T);this._isCancle||(B==c.MxJigCmdManager.DoneStatius.kContinueCommand?(this._isExit=!1,c.MxJigCmdManager.doMouseMoveImp(),H.MxUiVue.OnMxEvent({name:"dynInputReSet"})):(this.removeDynDrawObject(),c.MxJigCmdManager.commandRunComplete(this),this.onExitCommand(!0)))}this._mxObject.updateDisplay()},G.prototype.getCurrentMouseButton=function(){return c.MxJigCmdManager.getCurrentMouseButton()},G.prototype.userInputControls=function(){return this._userInputContros},G.prototype.setUserInputControls=function(T){this._userInputContros=T},G.prototype.abort=function(T){c.MxJigCmdManager.stopCmd(T)},G);function G(){this._isExit=!1,this._aryDynDrawObjectNamesId=void 0,this._DynNameId=1,this._iColor=16777215,this._isCancle=!1,this.m_isDisableDynInput=!1,this.m_isDisableOsnap=!1,this.m_isDisableDynamicTrace=!1,this.m_isDisablePolarAxisTrace=!1,this.m_isDisableGridTrace=!1,this.m_isDisableOrtho=!1,this.m_dynInput=new C(this),this.m_dynamicTrace=new P.McEdJigDynamicTrace(this),this.m_polarAxisTrace=new g.MxPolarAxisTrace(this),this.m_offsetArrow=new U.MxOffsetArrow(this),this.m_gridTrace=new E.MxGridTrace(this),this.m_osnap=new F.McEdJigOsnap(this),this.m_ortho=new F.McEdJigOrtho(this),this._userInputContros=c.MxJigCmdManager.UserInputControls.kNullResponseAccepted,this.m_isOffsetInputPostion=!1,this.m_isReserveDrawStatus=!1,this.m_callReserveDrawAddEntity=null,this.drawGroup=null,this.drawGroup_smallCoord=null,this._mxObject=null,this.m_DetailedResult=c.MxJigCmdManager.DetailedResult.kUnknown}o.McEdJigCommand=Y},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,"../MxTools":38,"../UI/MxUiVue":65,"./McEdJigDynamicTrace":42,"./McEdJigOsnap":43,"./MxGridTrace":51,"./MxJigCmdManager":54,"./MxOffsetArrow":56,"./MxPolarAxisTrace":57,three:19}],54:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxJigCmdManager=o.AcquireReturn=void 0;var a,m=b("three"),c=b("../MxFun"),x=b("./MxJig"),A=b("../MxManager"),H=b("./MrxDbgUiPrPoint"),F=b("./MrxDbgUiPrBase"),P=b("../UI/MxUiVue"),g=b("../MxTools"),E=b("../MxString"),_=b("../MxWindowsEvent"),k=b("./McEdJigOsnap"),U=b("../MxDrawData"),C=b("./MrxDbgUiPrDist"),S=b("./MxCmdRunManager"),Y=function(){this.status=a.DragStatus.kNoChange,this.exit=!0,this.DetailedResult=a.DetailedResult.kUnknown,this.sKeyValue="",this.dist=0,this.iVal=0,this.sValue="",this.ang=0};o.AcquireReturn=Y,function(G){var T,B,D,N,I,h,u,v,M,j,z,J,te,X,se,ve,Ee,we,Be,re;(B=T=G.UserInputControls||(G.UserInputControls={}))[B.kGovernedByOrthoMode=1]="kGovernedByOrthoMode",B[B.kNullResponseAccepted=2]="kNullResponseAccepted",B[B.kDontEchoCancelForCtrlC=4]="kDontEchoCancelForCtrlC",B[B.kDontUpdateLastPoint=8]="kDontUpdateLastPoint",B[B.kNoDwgLimitsChecking=16]="kNoDwgLimitsChecking",B[B.kNoZeroResponseAccepted=32]="kNoZeroResponseAccepted",B[B.kNoNegativeResponseAccepted=64]="kNoNegativeResponseAccepted",B[B.kAccept3dCoordinates=128]="kAccept3dCoordinates",B[B.kAcceptMouseUpAsPoint=256]="kAcceptMouseUpAsPoint",B[B.kAnyBlankTerminatesInput=512]="kAnyBlankTerminatesInput",B[B.kInitialBlankTerminatesInput=1024]="kInitialBlankTerminatesInput",B[B.kAcceptOtherInputString=2048]="kAcceptOtherInputString",B[B.kGovernedByUCSDetect=4096]="kGovernedByUCSDetect",B[B.kNoZDirectionOrtho=8192]="kNoZDirectionOrtho",B[B.kSpacesInAccepted=16384]="kSpacesInAccepted",(N=D=G.AcquireStatus||(G.AcquireStatus={}))[N.kNoChange=0]="kNoChange",N[N.kMove=1]="kMove",N[N.kBegan=2]="kBegan",N[N.kEnd=3]="kEnd",N[N.kMouseUp=4]="kMouseUp",N[N.kMouseDown=5]="kMouseDown",N[N.kCancle=6]="kCancle",(h=I=G.DragStatus||(G.DragStatus={}))[h.kNoChange=-6]="kNoChange",h[h.kCancel=-4]="kCancel",h[h.kOther=-3]="kOther",h[h.kNull=-1]="kNull",h[h.kNormal=0]="kNormal",h[h.kKW1=1]="kKW1",(v=u=G.DetailedResult||(G.DetailedResult={}))[v.kUnknown=1]="kUnknown",v[v.kTouchDownIn=2]="kTouchDownIn",v[v.kTouchUpIn=3]="kTouchUpIn",v[v.kMouseLeftIn=4]="kMouseLeftIn",v[v.kMouseLeftUpIn=5]="kMouseLeftUpIn",v[v.kMouseRightIn=6]="kMouseRightIn",v[v.kKeyIn=7]="kKeyIn",v[v.kCoordIn=8]="kCoordIn",v[v.kNullEnterIn=9]="kNullEnterIn",v[v.kNullSpaceIn=10]="kNullSpaceIn",v[v.kEcsIn=11]="kEcsIn",v[v.kNewCommadIn=12]="kNewCommadIn",(M=G.DoneStatius||(G.DoneStatius={}))[M.kContinueCommand=0]="kContinueCommand",M[M.kExitCommand=1]="kExitCommand",(z=j=G.InType||(G.InType={}))[z.kGetBegan=1]="kGetBegan",z[z.kGetEnd=2]="kGetEnd",(te=J=G.MouseButton||(G.MouseButton={}))[te.kInvalid=-1]="kInvalid",te[te.kLeft=0]="kLeft",te[te.kMid=1]="kMid",te[te.kRight=2]="kRight",(se=X=G.COMMAND_IN||(G.COMMAND_IN={}))[se.COMMAND_IN_NO_ENTITY=0]="COMMAND_IN_NO_ENTITY",se[se.COMMAND_IN_EMTPY=1]="COMMAND_IN_EMTPY",se[se.COMMAND_IN_KEY=2]="COMMAND_IN_KEY",se[se.COMMAND_IN_STRING=3]="COMMAND_IN_STRING",se[se.COMMAND_IN_COORD=5]="COMMAND_IN_COORD",se[se.COMMAND_IN_DIST=6]="COMMAND_IN_DIST",se[se.COMMAND_IN_INVALID=7]="COMMAND_IN_INVALID",se[se.COMMAND_IN_INVALID_ZERO=8]="COMMAND_IN_INVALID_ZERO",se[se.COMMAND_IN_INVALID_NEG=9]="COMMAND_IN_INVALID_NEG",se[se.COMMAND_IN_INT=10]="COMMAND_IN_INT",(Ee=ve=G.COMMAND_GET||(G.COMMAND_GET={}))[Ee.COMMAND_GET_STRING=1]="COMMAND_GET_STRING",Ee[Ee.COMMAND_GET_KEY=2]="COMMAND_GET_KEY",Ee[Ee.COMMAND_GET_DIST=4]="COMMAND_GET_DIST",Ee[Ee.COMMAND_GET_COORD=8]="COMMAND_GET_COORD",Ee[Ee.COMMAND_GET_INT=16]="COMMAND_GET_INT",(we=G.DynamicInputType||(G.DynamicInputType={}))[we.kNoInput=0]="kNoInput",we[we.kXYCoordInput=1]="kXYCoordInput",we[we.kDistanceInput=2]="kDistanceInput",we[we.kDynTip=3]="kDynTip",we[we.kAutoInput=4]="kAutoInput",(Be=G.GETPOINTSTATUS||(G.GETPOINTSTATUS={}))[Be.OsModeSValidLastPoint=1]="OsModeSValidLastPoint",Be[Be.OsModeSTempDisable=2]="OsModeSTempDisable",Be[Be.OsModeOrthoTempDisable=4]="OsModeOrthoTempDisable",Be[Be.OsModeSValidLastMovePoint=8]="OsModeSValidLastMovePoint",Be[Be.OsModePoloarTempDisable=16]="OsModePoloarTempDisable",Be[Be.OsModeDynTraceTempDisable=32]="OsModeDynTraceTempDisable",Be[Be.OsModeGridSnapTempDisable=64]="OsModeGridSnapTempDisable",(re=G.OsnapMode||(G.OsnapMode={}))[re.kOsModekInValid=0]="kOsModekInValid",re[re.kOsModeEnd=1]="kOsModeEnd",re[re.kOsModeMid=2]="kOsModeMid",re[re.kOsModeCen=3]="kOsModeCen",re[re.kOsModeNode=4]="kOsModeNode",re[re.kOsModeQuad=5]="kOsModeQuad",re[re.kOsModeIns=7]="kOsModeIns",re[re.kOsModePerp=8]="kOsModePerp",re[re.kOsModeTan=9]="kOsModeTan",re[re.kOsModeNear=10]="kOsModeNear",re[re.kOsModeInt=11]="kOsModeInt";var fe,ne=void 0,le=void 0,Re=D.kNoChange,at=J.kInvalid,ze=-9999999,Ie=new m.Vector2(ze,ze),ue=!1,Me=void 0,Je=!1,$e=0,ft=new Map,Pt=new Array,_t=new E.MxString,Ue=void 0,Rt=-2;function It(){ne!=null&&ne.notifySampler()}function Nr(lt,xe){var ke=lt.srcElement;if(ke&&(U.MxDrawData.m_isMapBox||ke.tagName=="CANVAS")){if(ne==null||ne.getDynImput().isTruncatedInput())return 0;Ie.x=lt.offsetX,Ie.y=lt.offsetY,xe&&(Ie.x=xe.x,Ie.y=xe.y),ct(Ie)}return 0}function Qt(lt,xe){if(lt.button!=J.kLeft)return 0;var ke=lt.srcElement;if(!ke||!U.MxDrawData.m_isMapBox&&ke.tagName!="CANVAS"||ne==null||ne.getDynImput().isTruncatedInput())return 0;Ie.x=lt.offsetX,Ie.y=lt.offsetY,xe&&(Ie.x=xe.x,Ie.y=xe.y),fe=ne.getMxObject().screenCoord2Current(lt.offsetX,lt.offsetY,0);var bt=ne.getOsnap();return fe=bt.reCompteCurrentPoint(fe),Re=D.kMouseUp,at=lt.button,It(),lt.stopPropagation(),1}function Ur(lt,xe,ke){var bt=ne.getMxObject().screenCoord2Current(lt,xe,ke),er=ne.getOsnap();bt=er.reCompteCurrentPoint(bt);var Ar,Cr=!1,Kr=ne.getDynImput().getCurrentInputPointCoordinates(bt);if(Kr instanceof m.Vector3&&(Cr=!0,bt.x=Kr.x,bt.y=Kr.y),!Cr){var _n=er.getCurrentOSnapPoint(bt);bt=_n.pt,_n.isSnapPoint&&(Cr=!0)}if(Cr||(Ar=ne.getDynamicTrace().GetTracePoint())&&(bt.copy(Ar),Cr=!0),Cr||(Ar=ne.getPolarAxisTrace().GetTracePoint())&&(bt.copy(Ar),Cr=!0),!Cr){var Sn=ne.getOrtho();Sn.OnViewMouseMove(bt);var Tn=Sn.GetCurOrthoPoint();Tn.isValid&&(bt.copy(Tn.pt),Cr=!0)}return Cr||(Ar=ne.getGridTrace().GetTracePoint())&&(bt.copy(Ar),Cr=!0),bt}function gt(lt,xe){if(lt.button!=J.kLeft)return 0;ne!=null&&ne.getDynImput().isShow()&&ne.getDynImput().setFocus(!0);var ke=lt.srcElement;if(!ke||!U.MxDrawData.m_isMapBox&&ke.tagName!="CANVAS"||ne==null||ne.getDynImput().isTruncatedInput())return 0;Ie.x=lt.offsetX,Ie.y=lt.offsetY,xe&&(Ie.x=xe.x,Ie.y=xe.y);var bt=Ur(lt.offsetX,lt.offsetY,0);return k.McEdImpJigGlobalData.setPrvPoint(bt),ne.getOsnap().seInValidPoint(),fe=bt,Re=D.kMouseDown,at=lt.button,It(),lt.stopPropagation(),1}function We(lt,xe){xe===void 0&&(xe=!0);var ke=void 0,bt=lt.touches;xe&&(bt=lt.changedTouches);for(var er=0;er<bt.length;er++)if(bt[er].identifier==0){ke=bt[er];break}return ke}function Yt(lt){var xe;if(U.MxDrawData.m_isMobileCommandOperationSupportsMultipoint){if(!(xe=We(lt,!0)))return;lt.stopPropagation(),lt.preventDefault()}else{if(lt.stopPropagation(),lt.preventDefault(),lt.touches.length==0)return;xe=lt.touches[0]}ne!=null&&ne.getDynImput().isShow()&&ne.getDynImput().setFocus(!0);var ke=lt.srcElement;if(ke&&(U.MxDrawData.m_isMapBox||ke.tagName=="CANVAS")){if(ne==null)return;var bt=lt.target.getBoundingClientRect();Ie.x=xe.clientX-bt.left,Ie.y=xe.clientY-bt.top;var er=Ur(Ie.x,Ie.y,0);return k.McEdImpJigGlobalData.setPrvPoint(er),ne.getOsnap().seInValidPoint(),fe=er,Re=D.kBegan,at=J.kInvalid,It(),1}}function Or(lt){var xe;if(U.MxDrawData.m_isMobileCommandOperationSupportsMultipoint){if(!(xe=We(lt)))return;lt.stopPropagation(),lt.preventDefault()}else lt.stopPropagation(),lt.preventDefault(),0<lt.touches.length&&(xe=lt.touches[0]);var ke=lt.srcElement;if(ke&&(U.MxDrawData.m_isMapBox||ke.tagName=="CANVAS")){if(ne==null||Ie.x==ze||Ie.y==ze)return;if(xe){var bt=lt.target.getBoundingClientRect();Ie.x=xe.clientX-bt.left,Ie.y=xe.clientY-bt.top}var er=Ur(Ie.x,Ie.y,0);return k.McEdImpJigGlobalData.setPrvPoint(er),ne.getOsnap().seInValidPoint(),fe=er,Re=D.kEnd,at=J.kInvalid,It(),1}}function Yr(lt){var xe;if(U.MxDrawData.m_isMobileCommandOperationSupportsMultipoint){if(lt.touches.length==1&&(xe=We(lt)),!xe)return;lt.stopPropagation(),lt.preventDefault()}else{if(lt.stopPropagation(),lt.preventDefault(),lt.touches.length==0)return;xe=lt.touches[0]}var ke=lt.srcElement;if(ke&&(U.MxDrawData.m_isMapBox||ke.tagName=="CANVAS")){if(ne==null)return;var bt=lt.target.getBoundingClientRect();Ie.x=xe.clientX-bt.left,Ie.y=xe.clientY-bt.top,ct(Ie)}}function ct(lt,xe){if(xe===void 0&&(xe=!0),Je=!1,lt==null){if(Ie.x==ze||Ie.y==ze)return;lt=Ie}ne.getDynImput().ClearDisplay();var ke=ne.getMxObject().screenCoord2Current(lt.x,lt.y,0),bt=ne.getOffsetArrow();bt.ReSetTempDisplay(),bt.MouseMove(ke);var er=ne.getOsnap();ke=er.reCompteCurrentPoint(ke);var Ar=ne.getMxObject().viewCoordLong2Cad(.5*U.MxDrawData.m_dInputRectWidth);xe?er.setPoint(ke,Ar):er.setPoint();var Cr=ne.getDynamicTrace();Cr.ReSetTempDisplay(),Cr.OnDynamicTrace(0,ke,G.OsnapMode.kOsModekInValid),Cr.MouseMove(ke);var Kr,_n=!1,Sn=ne.getDynImput().getCurrentInputPointCoordinates(ke);Sn instanceof m.Vector3&&(_n=!0,ke.x=Sn.x,ke.y=Sn.y,ke.z=Sn.z),_n||(Kr=Cr.GetTracePoint())&&(_n=!0);var Tn=ne.getPolarAxisTrace();if(Tn.ReSetTempDisplay(),_n||(Tn.MouseMove(ke),(Kr=Tn.GetTracePoint())&&(ke.x=Kr.x,ke.y=Kr.y,ke.z=Kr.z,_n=!0)),!_n){var Sa=ne.getOrtho();Sa.OnViewMouseMove(ke);var hi=Sa.GetCurOrthoPoint();hi.isValid&&ke.copy(hi.pt)}var ri=ne.getGridTrace();ri.ReSetTempDisplay(),_n||(ri.MouseMove(ke),(Kr=ri.GetTracePoint())&&(ke.x=Kr.x,ke.y=Kr.y,ke.z=Kr.z,_n=!0)),fe=ke,Re=D.kMove;var an=ne.getMxObject();an.sysVariable().setSysVarPoint("LASTMOVEPOINT",ke);var Mi=an.sysVariable().getSysVarNumber("GETPOINTSTATUS");Mi|=G.GETPOINTSTATUS.OsModeSValidLastMovePoint,an.sysVariable().setSysVarNumber("GETPOINTSTATUS",Mi),It.call(this)}function st(){ne&&(Ue=ne.getMxObject().getEventManager(),c.MxFun.isPC()?(Ue.addEventListener("mouseup",Qt,!0),Ue.addEventListener("mousemove",Nr,!0),Ue.addEventListener("mousedown",gt,!0)):(Ue.addEventListener("touchstart",Yt,!0),Ue.addEventListener("touchend",Or,!0),Ue.addEventListener("touchmove",Yr,!0)))}function qt(){Ue&&(c.MxFun.isPC()?(Ue.removeEventListener("mouseup",Qt,!0),Ue.removeEventListener("mousemove",Nr,!0),Ue.removeEventListener("mousedown",gt,!0)):(Ue.removeEventListener("touchstart",Yt,!0),Ue.removeEventListener("touchend",Or,!0),Ue.removeEventListener("touchmove",Yr,!0)),Ue=void 0)}function Tr(lt){_.MxWindowsEvent.clearKeyStatus();var xe=lt.getOrbitControls();c.MxFun.isPC()?(Rt=xe.mouseButtons.LEFT,xe.mouseButtons.LEFT=-1):U.MxDrawData.m_isMobileCommandOperationSupportsMultipoint||(xe.enabled=!1),xe.resetStatusValue(),lt.callEvent("dragWillStart"),lt.updateDisplay()}function ir(lt){var xe=new m.Vector3,ke=!1,bt=new E.MxString(lt),er=bt.AnalyzeString(",");if(er.length<2)for(;;){var Ar=ne.getDynImput().getFocusIndex();if(Ar==-1||bt.IsEmpty()||!g.MxTools.IsNumerical(bt))break;var Cr=ne.getDynImput().getLockValuesMap();if(Ar==0){var Kr=g.MxTools._tstof(bt.m_val);if(g.MxTools.IsZero(Kr)||!((q=(Cn=ne.getMxObject()).sysVariable().getSysVarNumber("GETPOINTSTATUS"))&G.GETPOINTSTATUS.OsModeSValidLastPoint)||!(q&G.GETPOINTSTATUS.OsModeSValidLastMovePoint))break;var _n=void 0;Cr.has(1)&&(_n=g.MxTools._tstof(Cr.get(1)));var Sn=Cn.sysVariable().getSysVarPoint("LASTPOINT"),Tn=Cn.sysVariable().getSysVarPoint("LASTMOVEPOINT").clone().sub(Sn);if(_n===void 0){if(Tn.length()<1e-7)break;Tn.normalize()}else _n=_n*Math.PI/180,Tn.dot(new m.Vector3(0,1,0))<0&&(_n=-_n),(Tn=new m.Vector3(1,0,0)).applyAxisAngle(new m.Vector3(0,0,1),_n);Tn.multiplyScalar(Kr);var Sa=(xe=Sn.clone().add(Tn)).clone().add(Tn.multiplyScalar(10));Cn.sysVariable().setSysVarPoint("LASTMOVEPOINT",Sa),ke=!0}else if(Ar==1){var hi=g.MxTools._tstof(bt.m_val);if(!((q=(Cn=ne.getMxObject()).sysVariable().getSysVarNumber("GETPOINTSTATUS"))&G.GETPOINTSTATUS.OsModeSValidLastPoint)||!(q&G.GETPOINTSTATUS.OsModeSValidLastMovePoint))break;var ri=void 0;Cr.has(0)&&(ri=g.MxTools._tstof(Cr.get(0))),Sn=Cn.sysVariable().getSysVarPoint("LASTPOINT"),Tn=Cn.sysVariable().getSysVarPoint("LASTMOVEPOINT").clone().sub(Sn);var an=0;if(ri===void 0){if(Tn.length()<1e-7)break;an=Tn.length()}else an=ri;hi=hi*Math.PI/180,Tn.dot(new m.Vector3(0,1,0))<0&&(hi=-hi);var Mi=new m.Vector3(an,0,0);Mi.applyAxisAngle(new m.Vector3(0,0,1),hi),Sa=(xe=Sn.clone().add(Mi)).clone().add(Mi.multiplyScalar(2)),Cn.sysVariable().setSysVarPoint("LASTMOVEPOINT",Sa),ke=!0}break}else{var q,Cn=ne.getMxObject(),pi=new E.MxString(er[0]),Fr=new E.MxString(er[1]),Ei=new E.MxString("0");if(2<er.length&&(Ei.m_val=er[2]),pi.IsEmpty()||pi.Left(1)!="@")g.MxTools.IsNumerical(pi)&&g.MxTools.IsNumerical(Fr)&&g.MxTools.IsNumerical(Ei)?(ke=!0,xe.x=g.MxTools._tstof(pi.m_val),xe.y=g.MxTools._tstof(Fr.m_val),xe.z=g.MxTools._tstof(Ei.m_val)):ke=!1;else if(pi.m_val=pi.m_val.substring(1,pi.m_val.length),g.MxTools.IsNumerical(pi)&&g.MxTools.IsNumerical(Fr)&&g.MxTools.IsNumerical(Ei))if((q=Cn.sysVariable().getSysVarNumber("GETPOINTSTATUS"))&G.GETPOINTSTATUS.OsModeSValidLastPoint){ke=!0;var vo=g.MxTools._tstof(pi.m_val),ts=g.MxTools._tstof(Fr.m_val),Do=g.MxTools._tstof(Ei.m_val);Sn=Cn.sysVariable().getSysVarPoint("LASTPOINT"),xe.x=Sn.x+vo,xe.y=Sn.y+ts,xe.z=Sn.z+Do}else ke=!1;else ke=!1}return ke?xe:null}function Hr(lt,xe){xe===void 0&&(xe=!1),P.MxUiVue.AcutPrintfNoFormat(lt,xe)}function vn(lt,xe){if(lt==X.COMMAND_IN_INVALID){var ke=P.MxUiVue.getCmdTip();return Hr(xe),Hr(ke),I.kNoChange}return lt==X.COMMAND_IN_INVALID_ZERO?(ke=P.MxUiVue.getCmdTip(),ne.userInputControls()&T.kNoNegativeResponseAccepted?Hr(`
 值必须为正 且非零。 
`):Hr(`
 值必不能为零。 
`),Hr(ke),I.kOther):lt!=X.COMMAND_IN_INVALID_NEG?I.kNoChange:(ke=P.MxUiVue.getCmdTip(),ne.userInputControls()&T.kNoZeroResponseAccepted?Hr(`
 值必须为正 且非零。 
`):Hr(`
 值必不能为负。 
`),Hr(ke),I.kOther)}function In(lt){var xe={iRet:X.COMMAND_IN_NO_ENTITY,sValue:"",iKey:I.kNull,dDist:0,iVal:0,pt:null,cmdText:""};if(!Je)return xe;var ke=ne.userInputControls(),bt=P.MxUiVue.getCmdText();if((xe.cmdText=bt).length==0)return ke&T.kNullResponseAccepted?xe.iRet=X.COMMAND_IN_EMTPY:xe.iRet=X.COMMAND_IN_INVALID,xe;if(lt&ve.COMMAND_GET_KEY&&0<ft.size){var er=new E.MxString(bt);er.MakeUpper(),er.TrimLeft(" "),er.TrimRight(" ");var Ar=ft.get(er.m_val);if(Ar!=null)return xe.iRet=X.COMMAND_IN_KEY,xe.iKey=Ar,xe.sValue=er.m_val,xe}if(lt&ve.COMMAND_GET_DIST&&g.MxTools.IsNumerical(bt))return xe.dDist=g.MxTools._tstof(bt),ke&T.kNoZeroResponseAccepted&&g.MxTools.IsZero(xe.dDist)?xe.iRet=X.COMMAND_IN_INVALID_ZERO:ke&T.kNoNegativeResponseAccepted&&xe.dDist<0?xe.iRet=X.COMMAND_IN_INVALID_NEG:(xe.sValue=bt,xe.iRet=X.COMMAND_IN_DIST),xe;if(lt&ve.COMMAND_GET_INT&&g.MxTools.IsNumerical(bt))return xe.iVal=g.MxTools._tstoi(bt),ke&T.kNoZeroResponseAccepted&&xe.iVal==0?xe.iRet=X.COMMAND_IN_INVALID_ZERO:ke&T.kNoNegativeResponseAccepted&&xe.iVal<0?xe.iRet=X.COMMAND_IN_INVALID_NEG:(xe.sValue=bt,xe.iRet=X.COMMAND_IN_INT),xe;if(lt&ve.COMMAND_GET_COORD){var Cr=ir(bt);if(Cr!=null)return xe.sValue=bt,xe.iRet=X.COMMAND_IN_COORD,xe.pt=Cr,xe}return lt&ve.COMMAND_GET_STRING?(xe.sValue=bt,xe.iRet=X.COMMAND_IN_STRING):xe.iRet=X.COMMAND_IN_INVALID,xe}function Zr(lt){var xe=ne.getMxObject();if(xe.sysVariable().setSysVarPoint("LASTPOINT",lt),lt){var ke=xe.sysVariable().getSysVarNumber("GETPOINTSTATUS");ke|=G.GETPOINTSTATUS.OsModeSValidLastPoint,xe.sysVariable().setSysVarNumber("GETPOINTSTATUS",ke)}else ke=xe.sysVariable().getSysVarNumber("GETPOINTSTATUS"),ke&=~G.GETPOINTSTATUS.OsModeSValidLastPoint,xe.sysVariable().setSysVarNumber("GETPOINTSTATUS",ke)}function Gn(lt){var xe=new Y;return Re==D.kMove?(xe.status=I.kNormal,xe.pt=fe,xe.exit=!1):Re==D.kEnd?lt&j.kGetEnd?(xe.status=I.kNormal,xe.pt=fe,xe.exit=!0,xe.DetailedResult=u.kTouchUpIn,Zr(xe.pt)):(xe.status=I.kNormal,xe.pt=fe,xe.exit=!1):Re==D.kCancle?(xe.status=I.kCancel,xe.pt=fe,xe.exit=!0):Re==D.kBegan?lt&j.kGetBegan?(xe.status=I.kNormal,xe.pt=fe,xe.exit=!0,xe.DetailedResult=u.kTouchDownIn,Zr(xe.pt)):(xe.status=I.kNormal,xe.pt=fe,xe.exit=!1):Re==D.kMouseDown?(xe.status=I.kNormal,xe.pt=fe,xe.exit=!0,xe.DetailedResult=u.kMouseLeftIn,Zr(xe.pt)):(xe.status=I.kNoChange,xe.pt=void 0,xe.exit=!1),xe}G.getInputKeyword=function(lt){if(lt<1)return"";for(var xe,ke=ft.entries();!(xe=ke.next()).done;)if(xe.value==lt)return xe.key;return""},G.GetKeyWordToString=function(){return Pt},G.keywordList=function(){return _t.m_val},G.setKeywordList=function(lt){if(_t.m_val=lt,ft.clear(),Pt.length=0,!_t.IsEmpty())if(_t.TrimLeft(" "),_t.TrimRight(" "),_t.m_val[0]=="["&&_t.m_val[_t.m_val.length-1]=="]"){_t.TrimLeft("["),_t.TrimRight("]");for(var xe=_t.AnalyzeString("/"),ke=1,bt=0;bt<xe.length;bt++){var er=(Kr=new E.MxString(xe[bt])).Find("(");if(er!=-1){var Ar=new E.MxString(Kr.Left(er)),Cr=new E.MxString(Kr.Right(Kr.GetLength()-er-1));Cr.TrimRight(")"),Ar.IsEmpty()||Cr.IsEmpty()||(Cr.MakeUpper(),ft.set(Cr.m_val,ke),ke++,Pt.push(new g.MxPair(Cr.m_val,Ar.m_val)))}}}else for(xe=_t.AnalyzeString(" "),ke=1,bt=0;bt<xe.length;bt++){var Kr;(Kr=new E.MxString(xe[bt])).IsEmpty()||(Kr.MakeUpper(),ft.set(Kr.m_val,ke),ke++)}},G.getAcquirePoint=function(){return fe},G.getAcquireStatus=function(){return Re},G.doMouseMoveImp=ct,G.OnThreeControlsChage=function(){if(ne!=null)return ne.getOsnap().reComputeOffset(),void(Ie.x!=ze&&Ie.y!=ze&&ct(Ie))},G.OnEnter=function(lt){$e=lt,Je=!0,Re=D.kNoChange,It(),Je=!1},G.Test=function(){Je=!0},G.registEvent=st,G.unRegistEvent=qt,G.getCurrentMouseButton=function(){return at},G.isRunning=function(){return ne!=null},G.getCurCmd=function(){return ne},G.commandRunComplete=function(lt){ne!=lt&&console.log("aseert:_curCmd == cmd");var xe,ke,bt=A.MxManager.currentMx();ne!=null&&(bt=ne.getMxObject()),le!=null?(ne=le,le=void 0,at=J.kInvalid,st(),ne.onStartCommand(),Tr(bt)):(qt(),ne=void 0,ke=(xe=bt).getOrbitControls(),c.MxFun.isPC()?Rt!=-2&&(ke.mouseButtons.LEFT=Rt,Rt=-2,ke.resetStatusValue()):(U.MxDrawData.m_isMobileCommandOperationSupportsMultipoint||(ke.enabled=!0),ke.resetStatusValue()),S.MxCmdRunManager.clearCurrentSelectIfNeed(xe),xe.callEvent("dragWillEnd"),xe.updateDisplay(),U.MxDrawData.m_isAutoResetRenderer||xe.resetRenderer())},G.isWaitCmdNull=function(){return le==null},G.stopCmd=function(lt){A.MxManager.currentMx().endPanCommand(),ne!=null&&(ue=!0,ne.notifyCancleExit(lt),ue=!1)},G.setRunCmdEvent=function(lt){Me=lt},G.runCmd=function(lt){if(!ue){var xe=A.MxManager.currentMx();lt.setMxObject(xe),xe.isValidCurMousePostion()?Ie=xe.getCurrentMousePostion():c.MxFun.isPC()?(Ie.x=ze,Ie.y=ze):(Ie.x=.5*xe.getViewWidth(),Ie.y=.5*xe.getViewHeight()),Me&&Me(),ne==null?(ne=lt,at=J.kInvalid,st(),ne.onStartCommand(),Tr(xe)):(le=lt,ue=!0,ne.notifyCancleExit(u.kNewCommadIn),ue=!1)}},G.GetAcqurePointFromStringTo=ir,G.ProcCommandRetResult=vn,G.GetCommandLineContent=In,G.acquireKeyword=function(){var lt=new Y;if(ne==null)return lt.status=I.kCancel,lt.exit=!0,lt;var xe=In(ve.COMMAND_GET_STRING|ve.COMMAND_GET_KEY);return xe.iRet==X.COMMAND_IN_EMTPY?(lt.status=I.kNull,lt.exit=!0,$e==13?lt.DetailedResult=u.kNullEnterIn:$e==32?lt.DetailedResult=u.kNullSpaceIn:$e==-1&&(lt.DetailedResult=u.kMouseRightIn)):xe.iRet==X.COMMAND_IN_KEY?(lt.status=xe.iKey,lt.exit=!0,lt.sKeyValue=xe.sValue,lt.DetailedResult=u.kKeyIn):(xe.cmdText.length==0?lt.status=I.kNoChange:lt.status=vn(xe.iRet,`
需要输入关键字。 
`),lt.exit=!1),lt},G.acquireString=function(){var lt=new Y;if(ne==null)return lt.status=I.kCancel,lt.exit=!0,lt;var xe=In(ve.COMMAND_GET_STRING|ve.COMMAND_GET_KEY);return xe.iRet==X.COMMAND_IN_EMTPY?(lt.status=I.kNull,lt.exit=!0,$e==13?lt.DetailedResult=u.kNullEnterIn:$e==32?lt.DetailedResult=u.kNullSpaceIn:$e==-1&&(lt.DetailedResult=u.kMouseRightIn)):xe.iRet==X.COMMAND_IN_KEY?(lt.status=xe.iKey,lt.exit=!0,lt.sKeyValue=xe.sValue,lt.DetailedResult=u.kKeyIn):xe.iRet==X.COMMAND_IN_STRING?(lt.status=I.kNormal,lt.sValue=xe.sValue,lt.exit=!0,lt.DetailedResult=u.kKeyIn):(lt.status=vn(xe.iRet,`
需要输入非空字符串。 
`),lt.exit=!1),lt},G.acquireInt=function(){var lt=new Y;if(ne==null)return lt.status=I.kCancel,lt.exit=!0,lt;var xe=In(ve.COMMAND_GET_INT|ve.COMMAND_GET_KEY);return xe.iRet==X.COMMAND_IN_EMTPY?(lt.status=I.kNull,lt.exit=!0,$e==13?lt.DetailedResult=u.kNullEnterIn:$e==32?lt.DetailedResult=u.kNullSpaceIn:$e==-1&&(lt.DetailedResult=u.kMouseRightIn)):xe.iRet==X.COMMAND_IN_KEY?(lt.status=xe.iKey,lt.exit=!0,lt.sKeyValue=xe.sValue,lt.DetailedResult=u.kKeyIn):xe.iRet==X.COMMAND_IN_INT?(lt.status=I.kNormal,lt.iVal=xe.iVal,lt.exit=!0,lt.DetailedResult=u.kKeyIn):(lt.status=vn(xe.iRet,`
 需要整数或选项关键字。 
`),lt.exit=!1),lt},G.acquireDist=function(lt,xe){var ke=new Y;if(ne==null)return ke.status=I.kCancel,ke.exit=!0,ke;var bt=In(ve.COMMAND_GET_DIST|ve.COMMAND_GET_KEY);if(bt.iRet==X.COMMAND_IN_EMTPY)return ke.status=I.kNull,ke.exit=!0,$e==13?ke.DetailedResult=u.kNullEnterIn:$e==32?ke.DetailedResult=u.kNullSpaceIn:$e==-1&&(ke.DetailedResult=u.kMouseRightIn),ke;if(bt.iRet==X.COMMAND_IN_KEY)return ke.status=bt.iKey,ke.exit=!0,ke.sKeyValue=bt.sValue,ke.DetailedResult=u.kKeyIn,ke;if(bt.iRet==X.COMMAND_IN_DIST)return ke.status=I.kNormal,ke.dist=bt.dDist,ke.exit=!0,ke.DetailedResult=u.kCoordIn,ke;if(ke.status=vn(bt.iRet,`
 需要点或选项关键字。 
`),!xe||bt.iRet==X.COMMAND_IN_INVALID_ZERO||bt.iRet==X.COMMAND_IN_INVALID_NEG)return ke.exit=!1,ke;var er=Gn(lt);if(er.status==I.kNormal&&er.exit){var Ar=er.pt.clone(),Cr=xe.clone();Ar.z=Cr.z=0;var Kr=Ar.distanceTo(Cr);return ne.userInputControls()&T.kNoZeroResponseAccepted&&g.MxTools.IsZero(Kr)?(vn(X.COMMAND_IN_INVALID_ZERO,`
 需要点或选项关键字。 
`),ke.status=I.kOther,ke.exit=!1,ke):(ke.status=I.kNormal,ke.dist=Kr,ke.exit=!0,ke.DetailedResult=er.DetailedResult,ke)}return ke.exit=!1,ke.status=I.kNoChange,ke},G.acquirePoint=function(lt,xe){xe===void 0&&(xe=!0);var ke=new Y;if(ne==null)return ke.status=I.kCancel,ke;var bt=In(ve.COMMAND_GET_COORD|ve.COMMAND_GET_KEY);return bt.iRet==X.COMMAND_IN_EMTPY?(ke.status=I.kNull,ke.exit=!0,$e==13?ke.DetailedResult=u.kNullEnterIn:$e==32?ke.DetailedResult=u.kNullSpaceIn:$e==-1&&(ke.DetailedResult=u.kMouseRightIn),ke):bt.iRet==X.COMMAND_IN_KEY?(ke.status=bt.iKey,ke.exit=!0,ke.sKeyValue=bt.sValue,ke.DetailedResult=u.kKeyIn,ke):bt.iRet==X.COMMAND_IN_COORD?(ke.status=I.kNormal,ke.pt=new m.Vector3(bt.pt.x,bt.pt.y,bt.pt.z),ke.exit=!0,ke.DetailedResult=u.kCoordIn,ke):(xe&&vn(bt.iRet,`
 需要点或选项关键字。 
`),Gn(lt))},G.acquireAngle=function(lt,xe){var ke=new Y;if(ne==null)return ke.status=I.kCancel,ke.exit=!0,ke;var bt=In(ve.COMMAND_GET_DIST|ve.COMMAND_GET_KEY);if(bt.iRet==X.COMMAND_IN_EMTPY)return ke.status=I.kNull,ke.exit=!0,$e==13?ke.DetailedResult=u.kNullEnterIn:$e==32?ke.DetailedResult=u.kNullSpaceIn:$e==-1&&(ke.DetailedResult=u.kMouseRightIn),ke;if(bt.iRet==X.COMMAND_IN_KEY)return ke.status=bt.iKey,ke.exit=!0,ke.sKeyValue=bt.sValue,ke.DetailedResult=u.kKeyIn,ke;if(bt.iRet==X.COMMAND_IN_DIST)return ke.status=I.kNormal,ke.ang=3.14159265*bt.dDist/180,ke.exit=!0,ke.DetailedResult=u.kCoordIn,ke;if(ke.status=vn(bt.iRet,`
 需要点或选项关键字。 
`),!xe||bt.iRet==X.COMMAND_IN_INVALID_ZERO||bt.iRet==X.COMMAND_IN_INVALID_NEG)return ke.exit=!1,ke;var er=Gn(lt);if(er.status==I.kNormal&&er.exit){var Ar=new m.Vector3(er.pt.x-xe.x,er.pt.y-xe.y,0),Cr=Ar.angleTo(new m.Vector3(1,0,0));Ar.dot(new m.Vector3(0,1,0))<-1e-11&&(Cr=2*Math.PI-Cr);var Kr=ne.userInputControls();return Kr&T.kNoZeroResponseAccepted&&g.MxTools.IsZero(Cr)?(vn(X.COMMAND_IN_INVALID_ZERO,`
 需要点或选项关键字。 
`),ke.status=I.kOther,ke.exit=!1,ke):(Kr&T.kNoNegativeResponseAccepted&&Cr<0?(vn(X.COMMAND_IN_INVALID_NEG,`
 需要点或选项关键字。 
`),ke.status=I.kOther,ke.exit=!1):(ke.status=I.kNormal,ke.ang=Cr,ke.exit=!0,ke.DetailedResult=er.DetailedResult),ke)}return ke.exit=!1,ke.status=I.kNoChange,ke},G.getMcEdJigCommandClass=function(){return x.McEdJigCommand},G.getMrxDbgUiPrPointClass=function(){return H.MrxDbgUiPrPoint},G.getMrxDbgUiPrDistClass=function(){return C.MrxDbgUiPrDist},G.getMrxDbgUiPrIntClass=function(){return C.MrxDbgUiPrInt},G.getMrxDbgUiPrStringClass=function(){return C.MrxDbgUiPrString},G.getMrxDbgUiPrKeyWordClass=function(){return C.MrxDbgUiPrKeyWord},G.getMrxDbgUiPrAngleClass=function(){return C.MrxDbgUiPrAngle},G.getMcEdGetPointWorldDrawClass=function(){return F.McEdGetPointWorldDraw},G.McEdGetPointWorldDrawObjectClass=function(){return F.McEdGetPointWorldDrawObject},G.init=function(){this._curCmd=void 0}}(a||(o.MxJigCmdManager=a={}))},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxString":34,"../MxTools":38,"../MxWindowsEvent":41,"../UI/MxUiVue":65,"./McEdJigOsnap":43,"./MrxDbgUiPrBase":45,"./MrxDbgUiPrDist":46,"./MrxDbgUiPrPoint":47,"./MxCmdRunManager":48,"./MxJig":53,three:19}],55:[function(b,n,o){var a,m=this&&this.__extends||(a=function(P,g){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,_){E.__proto__=_}||function(E,_){for(var k in _)Object.prototype.hasOwnProperty.call(_,k)&&(E[k]=_[k])})(P,g)},function(P,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function E(){this.constructor=P}a(P,g),P.prototype=g===null?Object.create(g):(E.prototype=g.prototype,new E)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxJigGetLine=void 0;var c,x=b("./MxJig"),A=b("./MxJigCmdManager"),H=(m(F,c=x.McEdJigCommand),F.prototype.sampler=function(){var P=A.MxJigCmdManager.InType.kGetBegan;this._isGetPt1||(P=A.MxJigCmdManager.InType.kGetEnd);var g=this.acquirePoint(P);return g.status==A.MxJigCmdManager.DragStatus.kNormal&&(this._isGetPt1?this._pt1=g.pt:this._pt2=g.pt),g.status},F.prototype.setRetCall=function(P){this._retCall=P},F.prototype.done=function(P){if(this._isGetPt1)return this._isGetPt1=!1,A.MxJigCmdManager.DoneStatius.kContinueCommand;var g={};return g.pt1=this.getMxObject().worldCoord2Currnet(this._pt1.x,this._pt1.y,this._pt1.z),g.pt2=this.getMxObject().worldCoord2Currnet(this._pt2.x,this._pt2.y,this._pt2.z),this._retCall(g),A.MxJigCmdManager.DoneStatius.kExitCommand},F.prototype.upDisplay=function(){this._isGetPt1||this._pt1==null||this._pt2==null||this.drawLine(this._pt1,this._pt2)},F);function F(){var P=c!==null&&c.apply(this,arguments)||this;return P._isGetPt1=!0,P}o.MxJigGetLine=H},{"./MxJig":53,"./MxJigCmdManager":54}],56:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxOffsetArrow=void 0;var a=b("three"),m=b("../MxFun"),c=b("../MxThreeJS"),x=b("../MxTools"),A=(H.prototype.ClearDynDrawEntity=function(){var F=this.m_vecDynDrawEntity.length;if(F!=0){for(var P=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),g=0;g<F;g++)m.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[g],P);this.m_vecDynDrawEntity=[]}},H.prototype.MouseMove=function(F){var P=this.m_mxJig.getMxObject();if(P.getMcObject().isValid()&&(this.ClearDynDrawEntity(),this.m_mxJig.isOffsetInputPostion())){var g=F.clone(),E=this.m_mxJig.getOsnap().reCompteCurrentPoint(g.clone()),_=c.MxThreeJS.createLine(P.toSmallcoord(g),P.toSmallcoord(E),16777215),k=P.getTheTempDrawContainer_SmallCoord_JigDraw();k.add(_),this.m_vecDynDrawEntity.push(_);var U=x.MxTools.MillimeterToPixels(2.9);U=P.screenCoordLong2Doc(U);var C=c.MxThreeJS.createSolidCircle(P.toSmallcoord(g),.85*U,16777215);k.add(C),this.m_vecDynDrawEntity.push(C);var S=c.MxThreeJS.createCircle(P.toSmallcoord(g),U,16777215);k.add(S),this.m_vecDynDrawEntity.push(S);var Y=g.sub(E);Y.normalize().multiplyScalar(.8*U);var G=Y.clone().applyAxisAngle(new a.Vector3(0,0,1),15*Math.PI/180),T=Y.clone().applyAxisAngle(new a.Vector3(0,0,1),15*-Math.PI/180),B=E.clone().add(G),D=E.clone().add(T),N=c.MxThreeJS.createLine(P.toSmallcoord(B),P.toSmallcoord(E),16777215);P.getTheTempDrawContainer_SmallCoord_JigDraw().add(N),this.m_vecDynDrawEntity.push(N);var I=c.MxThreeJS.createLine(P.toSmallcoord(D),P.toSmallcoord(E),16777215);P.getTheTempDrawContainer_SmallCoord_JigDraw().add(I),this.m_vecDynDrawEntity.push(I)}},H.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},H.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity()},H.prototype.Init=function(){},H);function H(F){this.m_vecDynDrawEntity=[],this.m_mxJig=null,this.m_mxJig=F}o.MxOffsetArrow=A},{"../MxFun":27,"../MxThreeJS":37,"../MxTools":38,three:19}],57:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxPolarAxisTrace=void 0;var a=b("three"),m=b("./MxJigCmdManager"),c=b("../MxFun"),x=b("../MxDrawData"),A=b("../MxTools"),H=b("../MxManager"),F=b("../MxThreeJS"),P=(g.prototype.ClearDynDrawEntity=function(){for(var E=this.m_mxJig.getMxObject().getTheTempDrawContainer_SmallCoord_JigDraw(),_=this.m_vecDynDrawEntity.length,k=0;k<_;k++)c.MxFun.removeThreejsObject(this.m_vecDynDrawEntity[k],E);this.m_vecDynDrawEntity=[]},g.prototype.CreteTracePoint=function(E,_){var k=this.m_mxJig.getMxObject(),U=k.getTheTempDrawContainer_SmallCoord_JigDraw();_/=2;var C=F.MxThreeJS.createLine(k.toSmallcoord2(E.x+_,E.y+_,0),k.toSmallcoord2(E.x-_,E.y-_,0),16711680);U.add(C),this.m_vecDynDrawEntity.push(C);var S=F.MxThreeJS.createLine(k.toSmallcoord2(E.x-_,E.y+_,0),k.toSmallcoord2(E.x+_,E.y-_,0),16711680);U.add(S),this.m_vecDynDrawEntity.push(S)},g.prototype.MouseMove=function(E){var _=this.m_mxJig.getMxObject();if(_.getMcObject().isValid()){if(this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1,this.isTrace()&&_.sysVariable().getSysVarNumber("GETPOINTSTATUS")&m.MxJigCmdManager.GETPOINTSTATUS.OsModeSValidLastPoint){var k=_.sysVariable().getSysVarPoint("LASTPOINT"),U=_.getSysVarDouble("POLARANG");if(U=180*U/Math.PI,!((U=Math.abs(U))<.001)){var C=_.viewCoordLong2Cad(x.MxDrawData.m_dInputRectWidth),S=2*C,Y=E.clone().sub(k);if(!(Y.length()<S)){Y.normalize();var G=H.MxManager.getMxCpp().getMxCAD_MxCpp(),T=H.MxManager.getMxCpp().getMxCAD_App(),B=_.getTheTempDrawContainer_SmallCoord_JigDraw(),D=_.viewCoordLong2Cad(this.m_dashedLineLen);Y=G.newMcGeVector3d(Y);var N=G.newMcGeVector3d(new a.Vector3(1,0,0)),I=Y.angleTo2(N),h=(I=180*I/Math.PI)%U;h<U/2?I-=h:I+=U-h;var u=_.viewCoordLong2Cad(_.getViewWidth()),v=_.viewCoordLong2Cad(_.getViewHeight()),M=A.MxTools.MxMax(u,v);(Y=N.clone()).rotateBy(I*Math.PI/180),Y.mult(M);var j=new a.Vector3(k.x+Y.x,k.y+Y.y,k.z+Y.z),z={pt1:j,pt2:k},J=T.MxCADAssist.GetClosestPointTo(z.pt1.x,z.pt1.y,z.pt2.x,z.pt2.y,E.x,E.y,!0);if(0<J.length()){var te=J.at(0),X=new a.Vector3(te.x,te.y,te.z);if(X.distanceTo(E)<S){var se=F.MxThreeJS.createDashedLine(_.toSmallcoord2(k.x-Y.x,k.y-Y.y,k.z-Y.z),_.toSmallcoord(j),this.m_iDashedLineLenColor,D,D);B.add(se),this.m_vecDynDrawEntity.push(se),this.m_isValidTracePoint=!0,this.m_ptTracePoint=X,this.CreteTracePoint(X,C)}}}}}}else this.m_isTrace=!1},g.prototype.isTrace=function(){return this.m_isTrace&&(8&this.m_mxJig.getMxObject().getSysVarLong("AUTOSNAP"))!=0},g.prototype.Init=function(){var E=this.m_mxJig.getMxObject();E.getMcObject().isValid()?(this.m_isValidTracePoint=!1,this.m_isTrace=!0,E.sysVariable().getSysVarNumber("GETPOINTSTATUS")&m.MxJigCmdManager.GETPOINTSTATUS.OsModePoloarTempDisable&&(this.m_isTrace=!1),this.m_mxJig.isDisablePolarAxisTrace()&&(this.m_isTrace=!1)):this.m_isTrace=!1},g.prototype.GetTracePoint=function(){if(this.isTrace())return this.m_isValidTracePoint?this.m_ptTracePoint:void 0},g.prototype.ClearDisplay=function(){this.ClearDynDrawEntity()},g.prototype.ReSetTempDisplay=function(){this.ClearDynDrawEntity(),this.m_isValidTracePoint=!1},g);function g(E){this.m_vecDynDrawEntity=[],this.m_ptTracePoint=new a.Vector3,this.m_isValidTracePoint=!1,this.m_isTrace=!1,this.m_mxJig=null,this.m_dashedLineLen=1.5,this.m_iDashedLineLenColor=11184810,this.m_mxJig=E}o.MxPolarAxisTrace=P},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxThreeJS":37,"../MxTools":38,"./MxJigCmdManager":54,three:19}],58:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0});var a=b("./MxFun");window.MXFUN_THREE=a.MxFun.getTHREE();var m=b("./MxManager");function c(){}(c.CreateMx=function(){a.MxFun.init(),typeof MxMain<"u"&&MxMain(b)==0||a.MxFun.createMxObject(),m.MxManager.callEvent("init");var x=a.MxFun.getUiObject();x!=null&&(x.sTitle=a.MxFun.getCurrentDraw().getFileTitle(),setTimeout(function(){x.init()},400))},c.Main=function(){if(typeof MxUiMain<"u"){MxUiMain(b);var x=a.MxFun.getUiObject();x!=null&&x.writeUICSS()}typeof MxDocumentReady>"u"?$(document).ready(function(){c.CreateMx()}):MxDocumentReady(b,c.CreateMx)},c).Main()},{"./MxFun":27,"./MxManager":29}],59:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxSvgManager=void 0;var a=b("three"),m=b("three"),c=b("./SVGLoader"),x=function(){this.svg=new a.Group,this.aryMeterial=[],this.boxSize=new m.Vector3(1,1,1)},A=(H.prototype.loadSVGImp=function(g,E,_,k){new c.SVGLoader().load(g,function(U){if(U.paths.length){var C=[],S=U.paths,Y=new a.Group,G=!0,T=!0,B=!1,D=!1;k&&(k.drawStrokes&&(G=k.drawStrokes),k.drawFillShapes&&(T=k.drawFillShapes),k.fillShapesWireframe&&(B=k.fillShapesWireframe),k.strokesWireframe&&(D=k.strokesWireframe));for(var N=0;N<S.length;N++){var I=S[N],h=I.userData.style.fill;if(T&&h!==void 0&&h!=="none"){for(var u=new a.MeshBasicMaterial({color:E||new a.Color().setStyle(h),opacity:I.userData.style.fillOpacity,transparent:I.userData.style.fillOpacity<1,side:a.DoubleSide,depthWrite:!1,wireframe:B}),v=c.SVGLoader.createShapes(I),M=0;M<v.length;M++){var j=v[M],z=new a.ShapeBufferGeometry(j),J=new a.Mesh(z,u);Y.add(J)}C.push(u)}var te=I.userData.style.stroke;if(G&&te!==void 0&&te!=="none"){u=new a.MeshBasicMaterial({color:E||new a.Color().setStyle(te),opacity:I.userData.style.strokeOpacity,transparent:I.userData.style.strokeOpacity<1,side:a.DoubleSide,depthWrite:!1,wireframe:D}),M=0;for(var X=I.subPaths.length;M<X;M++){var se=I.subPaths[M];(z=c.SVGLoader.pointsToStroke(se.getPoints(),I.userData.style,12,.001))&&(J=new a.Mesh(z,u),Y.add(J))}C.push(u)}}_&&_(Y,C)}else console.log("mx svg:"+g+" data.paths.length == 0"),_&&_(null,null)},void 0,function(){_&&_(null,null)})},H.prototype.loadSVG=function(g,E,_,k){var U=this,C=this.mapSvgUrlToData.get(g),S=!k||!k.useBuffer||k.useBuffer;if(C&&S){if(_)if(C==null)_(null,null);else{var Y=C.svg.clone();Y.boxSize=C.boxSize,_(Y,C.aryMeterial)}}else this.loadSVGImp(g,E,function(G,T){if(G&&T){var B=new x;B.svg=G,B.aryMeterial=T;var D=new m.Box3().setFromObject(G);B.boxSize.x=D.max.x-D.min.x,B.boxSize.y=D.max.y-D.min.y,B.boxSize.x!==-1/0&&B.boxSize.y!==-1/0||console.log("mx svg:"+g+" boxSize invalid"),U.mapSvgUrlToData.set(g,B);var N=B.svg.clone();N.boxSize=B.boxSize,_&&_(N,B.aryMeterial)}else U.mapSvgUrlToData.set(g,null),_&&_(null,null)},k)},H);function H(){this.mapSvgUrlToData=new Map}var F=(P.prototype.loadSVG=function(g,E,_,k){_&&this.mxThreeJsBuffer.loadSVG(g,E,_,k)},P);function P(){this.mxThreeJsBuffer=new A}o.MxSvgManager=F},{"./SVGLoader":60,three:19}],60:[function(b,n,o){var a,m=this&&this.__extends||(a=function(F,P){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(g,E){g.__proto__=E}||function(g,E){for(var _ in E)Object.prototype.hasOwnProperty.call(E,_)&&(g[_]=E[_])})(F,P)},function(F,P){if(typeof P!="function"&&P!==null)throw new TypeError("Class extends value "+String(P)+" is not a constructor or null");function g(){this.constructor=F}a(F,P),F.prototype=P===null?Object.create(P):(g.prototype=P.prototype,new g)});Object.defineProperty(o,"__esModule",{value:!0}),o.SVGLoader=void 0;var c,x=b("three"),A=(m(H,c=x.Loader),H.prototype.load=function(F,P,g,E){var _=this,k=new x.FileLoader(_.manager);k.setPath(_.path),k.setRequestHeader(_.requestHeader),k.setWithCredentials(_.withCredentials),k.load(F,function(U){try{P(_.parse(U))}catch(C){E?E(C):console.error(C),_.manager.itemError(F)}},g,E)},H.prototype.parse=function(F){var P=this;function g(z,J,te,X,se,ve,Ee,we){if(J!=0&&te!=0){X=X*Math.PI/180,J=Math.abs(J),te=Math.abs(te);var Be=(Ee.x-we.x)/2,re=(Ee.y-we.y)/2,fe=Math.cos(X)*Be+Math.sin(X)*re,ne=-Math.sin(X)*Be+Math.cos(X)*re,le=J*J,Re=te*te,at=fe*fe,ze=ne*ne,Ie=at/le+ze/Re;if(1<Ie){var ue=Math.sqrt(Ie);le=(J*=ue)*J,Re=(te*=ue)*te}var Me=le*ze+Re*at,Je=(le*Re-Me)/Me,$e=Math.sqrt(Math.max(0,Je));se===ve&&($e=-$e);var ft=$e*J*ne/te,Pt=-$e*te*fe/J,_t=Math.cos(X)*ft-Math.sin(X)*Pt+(Ee.x+we.x)/2,Ue=Math.sin(X)*ft+Math.cos(X)*Pt+(Ee.y+we.y)/2,Rt=E(1,0,(fe-ft)/J,(ne-Pt)/te),It=E((fe-ft)/J,(ne-Pt)/te,(-fe-ft)/J,(-ne-Pt)/te)%(2*Math.PI);z.currentPath.absellipse(_t,Ue,J,te,Rt,Rt+It,ve===0,X)}else z.lineTo(we.x,we.y)}function E(z,J,te,X){var se=z*te+J*X,ve=Math.sqrt(z*z+J*J)*Math.sqrt(te*te+X*X),Ee=Math.acos(Math.max(-1,Math.min(1,se/ve)));return z*X-J*te<0&&(Ee=-Ee),Ee}function _(z,J){J=Object.assign({},J);var te={};if(z.hasAttribute("class"))for(var X=z.getAttribute("class").split(/\s/).filter(Boolean).map(function(Be){return Be.trim()}),se=0;se<X.length;se++)te=Object.assign(te,T["."+X[se]]);function ve(Be,re,fe){fe===void 0&&(fe=function(ne){return ne.startsWith("url")&&console.warn("SVGLoader: url access in attributes is not implemented."),ne}),z.hasAttribute(Be)&&(J[re]=fe(z.getAttribute(Be))),te[Be]&&(J[re]=fe(te[Be])),z.style&&z.style[Be]!==""&&(J[re]=fe(z.style[Be]))}function Ee(Be){return Math.max(0,Math.min(1,Y(Be)))}function we(Be){return Math.max(0,Y(Be))}return z.hasAttribute("id")&&(te=Object.assign(te,T["#"+z.getAttribute("id")])),ve("fill","fill"),ve("fill-opacity","fillOpacity",Ee),ve("fill-rule","fillRule"),ve("opacity","opacity",Ee),ve("stroke","stroke"),ve("stroke-opacity","strokeOpacity",Ee),ve("stroke-width","strokeWidth",we),ve("stroke-linejoin","strokeLineJoin"),ve("stroke-linecap","strokeLineCap"),ve("stroke-miterlimit","strokeMiterLimit",we),ve("visibility","visibility"),J}function k(z,J){return z-(J-z)}function U(z,J,te){if(typeof z!="string")throw new TypeError("Invalid input: "+typeof z);var X,se={WHITESPACE:/[ \t\r\n]/,DIGIT:/[\d]/,SIGN:/[-+]/,POINT:/\./,COMMA:/,/,EXP:/e/i,FLAGS:/[01]/},ve=0,Ee=!0,we="",Be="",re=[];function fe(at,ze,Ie){var ue=new SyntaxError('Unexpected character "'+at+'" at index '+ze+".");throw ue.partial=Ie,ue}function ne(){we!==""&&(Be===""?re.push(Number(we)):re.push(Number(we)*Math.pow(10,Number(Be)))),Be=we=""}for(var le=z.length,Re=0;Re<le;Re++)if(X=z[Re],Array.isArray(J)&&J.includes(re.length%te)&&se.FLAGS.test(X))ve=1,we=X,ne();else{if(ve===0){if(se.WHITESPACE.test(X))continue;if(se.DIGIT.test(X)||se.SIGN.test(X)){ve=1,we=X;continue}if(se.POINT.test(X)){ve=2,we=X;continue}se.COMMA.test(X)&&(Ee&&fe(X,Re,re),Ee=!0)}if(ve===1){if(se.DIGIT.test(X)){we+=X;continue}if(se.POINT.test(X)){we+=X,ve=2;continue}if(se.EXP.test(X)){ve=3;continue}se.SIGN.test(X)&&we.length===1&&se.SIGN.test(we[0])&&fe(X,Re,re)}if(ve===2){if(se.DIGIT.test(X)){we+=X;continue}if(se.EXP.test(X)){ve=3;continue}se.POINT.test(X)&&we[we.length-1]==="."&&fe(X,Re,re)}if(ve===3){if(se.DIGIT.test(X)){Be+=X;continue}if(se.SIGN.test(X)){if(Be===""){Be+=X;continue}Be.length===1&&se.SIGN.test(Be)&&fe(X,Re,re)}}se.WHITESPACE.test(X)?(ne(),ve=0,Ee=!1):se.COMMA.test(X)?(ne(),Ee=!(ve=0)):se.SIGN.test(X)?(ne(),ve=1,we=X):se.POINT.test(X)?(ne(),ve=2,we=X):fe(X,Re,re)}return ne(),re}var C=["mm","cm","in","pt","pc","px"],S={mm:{mm:1,cm:.1,in:1/25.4,pt:72/25.4,pc:6/25.4,px:-1},cm:{mm:10,cm:1,in:1/2.54,pt:72/2.54,pc:6/2.54,px:-1},in:{mm:25.4,cm:2.54,in:1,pt:72,pc:6,px:-1},pt:{mm:25.4/72,cm:2.54/72,in:1/72,pt:1,pc:6/72,px:-1},pc:{mm:25.4/6,cm:2.54/6,in:1/6,pt:12,pc:1,px:-1},px:{px:1}};function Y(z){var J="px";if(typeof z=="string"||z instanceof String)for(var te=0,X=C.length;te<X;te++){var se=C[te];if(z.endsWith(se)){J=se,z=z.substring(0,z.length-se.length);break}}var ve=void 0;return J==="px"&&P.defaultUnit!=="px"?ve=S.in[P.defaultUnit]/P.defaultDPI:(ve=S[J][P.defaultUnit])<0&&(ve=S[J].in*P.defaultDPI),ve*parseFloat(z)}var G=[],T={},B=[],D=new x.Matrix3,N=new x.Matrix3,I=new x.Matrix3,h=new x.Matrix3,u=new x.Vector2,v=new x.Vector3,M=new x.Matrix3,j=new DOMParser().parseFromString(F,"image/svg+xml");return function z(J,te){if(J.nodeType===1){var X,se,ve,Ee,we,Be,re,fe,ne,le,Re,at,ze=function(Pt){if(!(Pt.hasAttribute("transform")||Pt.nodeName==="use"&&(Pt.hasAttribute("x")||Pt.hasAttribute("y"))))return null;var _t=function(Ue){var Rt=new x.Matrix3,It=D;if(Ue.nodeName==="use"&&(Ue.hasAttribute("x")||Ue.hasAttribute("y"))){var Nr=Y(Ue.getAttribute("x")),Qt=Y(Ue.getAttribute("y"));Rt.translate(Nr,Qt)}if(Ue.hasAttribute("transform"))for(var Ur=Ue.getAttribute("transform").split(")"),gt=Ur.length-1;0<=gt;gt--){var We=Ur[gt].trim();if(We!==""){var Yt=We.indexOf("("),Or=We.length;if(0<Yt&&Yt<Or){var Yr=We.substr(0,Yt),ct=U(We.substr(Yt+1,Or-Yt-1));switch(It.identity(),Yr){case"translate":1<=ct.length&&(Qt=Nr=ct[0],2<=ct.length&&(Qt=ct[1]),It.translate(Nr,Qt));break;case"rotate":if(1<=ct.length){var st,qt=0,Tr=0;st=-ct[0]*Math.PI/180,3<=ct.length&&(qt=ct[1],Tr=ct[2]),N.identity().translate(-qt,-Tr),I.identity().rotate(st),h.multiplyMatrices(I,N),N.identity().translate(qt,Tr),It.multiplyMatrices(N,h)}break;case"scale":if(1<=ct.length){var ir=ct[0],Hr=ir;2<=ct.length&&(Hr=ct[1]),It.scale(ir,Hr)}break;case"skewX":ct.length===1&&It.set(1,Math.tan(ct[0]*Math.PI/180),0,0,1,0,0,0,1);break;case"skewY":ct.length===1&&It.set(1,0,0,Math.tan(ct[0]*Math.PI/180),1,0,0,0,1);break;case"matrix":ct.length===6&&It.set(ct[0],ct[2],ct[4],ct[1],ct[3],ct[5],0,0,1)}}Rt.premultiply(It)}}return Rt}(Pt);return 0<B.length&&_t.premultiply(B[B.length-1]),M.copy(_t),B.push(_t),_t}(J),Ie=!0,ue=null;switch(J.nodeName){case"svg":break;case"style":(function(Pt){if(Pt.sheet&&Pt.sheet.cssRules&&Pt.sheet.cssRules.length)for(var _t=0;_t<Pt.sheet.cssRules.length;_t++){var Ue=Pt.sheet.cssRules[_t];if(Ue.type===1)for(var Rt=Ue.selectorText.split(/,/gm).filter(Boolean).map(function(Nr){return Nr.trim()}),It=0;It<Rt.length;It++)T[Rt[It]]=Object.assign(T[Rt[It]]||{},Ue.style)}})(J);break;case"g":te=_(J,te);break;case"path":te=_(J,te),J.hasAttribute("d")&&(ue=function(Pt){for(var _t=new x.ShapePath,Ue=new x.Vector2,Rt=new x.Vector2,It=new x.Vector2,Nr=!0,Qt=!1,Ur=Pt.getAttribute("d").match(/[a-df-z][^a-df-z]*/gi),gt=0,We=Ur.length;gt<We;gt++){var Yt=Ur[gt],Or=Yt.charAt(0),Yr=Yt.substr(1).trim();Nr===!0&&(Nr=!(Qt=!0));var ct=void 0;switch(Or){case"M":for(var st=0,qt=(ct=U(Yr)).length;st<qt;st+=2)Ue.x=ct[st+0],Ue.y=ct[st+1],Rt.x=Ue.x,Rt.y=Ue.y,st===0?_t.moveTo(Ue.x,Ue.y):_t.lineTo(Ue.x,Ue.y),st===0&&It.copy(Ue);break;case"H":for(st=0,qt=(ct=U(Yr)).length;st<qt;st++)Ue.x=ct[st],Rt.x=Ue.x,Rt.y=Ue.y,_t.lineTo(Ue.x,Ue.y),st===0&&Qt===!0&&It.copy(Ue);break;case"V":for(st=0,qt=(ct=U(Yr)).length;st<qt;st++)Ue.y=ct[st],Rt.x=Ue.x,Rt.y=Ue.y,_t.lineTo(Ue.x,Ue.y),st===0&&Qt===!0&&It.copy(Ue);break;case"L":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=2)Ue.x=ct[st+0],Ue.y=ct[st+1],Rt.x=Ue.x,Rt.y=Ue.y,_t.lineTo(Ue.x,Ue.y),st===0&&Qt===!0&&It.copy(Ue);break;case"C":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=6)_t.bezierCurveTo(ct[st+0],ct[st+1],ct[st+2],ct[st+3],ct[st+4],ct[st+5]),Rt.x=ct[st+2],Rt.y=ct[st+3],Ue.x=ct[st+4],Ue.y=ct[st+5],st===0&&Qt===!0&&It.copy(Ue);break;case"S":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=4)_t.bezierCurveTo(k(Ue.x,Rt.x),k(Ue.y,Rt.y),ct[st+0],ct[st+1],ct[st+2],ct[st+3]),Rt.x=ct[st+0],Rt.y=ct[st+1],Ue.x=ct[st+2],Ue.y=ct[st+3],st===0&&Qt===!0&&It.copy(Ue);break;case"Q":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=4)_t.quadraticCurveTo(ct[st+0],ct[st+1],ct[st+2],ct[st+3]),Rt.x=ct[st+0],Rt.y=ct[st+1],Ue.x=ct[st+2],Ue.y=ct[st+3],st===0&&Qt===!0&&It.copy(Ue);break;case"T":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=2){var Tr=k(Ue.x,Rt.x),ir=k(Ue.y,Rt.y);_t.quadraticCurveTo(Tr,ir,ct[st+0],ct[st+1]),Rt.x=Tr,Rt.y=ir,Ue.x=ct[st+0],Ue.y=ct[st+1],st===0&&Qt===!0&&It.copy(Ue)}break;case"A":for(st=0,qt=(ct=U(Yr,[3,4],7)).length;st<qt;st+=7)if(ct[st+5]!=Ue.x||ct[st+6]!=Ue.y){var Hr=Ue.clone();Ue.x=ct[st+5],Ue.y=ct[st+6],Rt.x=Ue.x,Rt.y=Ue.y,g(_t,ct[st],ct[st+1],ct[st+2],ct[st+3],ct[st+4],Hr,Ue),st===0&&Qt===!0&&It.copy(Ue)}break;case"m":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=2)Ue.x+=ct[st+0],Ue.y+=ct[st+1],Rt.x=Ue.x,Rt.y=Ue.y,st===0?_t.moveTo(Ue.x,Ue.y):_t.lineTo(Ue.x,Ue.y),st===0&&It.copy(Ue);break;case"h":for(st=0,qt=(ct=U(Yr)).length;st<qt;st++)Ue.x+=ct[st],Rt.x=Ue.x,Rt.y=Ue.y,_t.lineTo(Ue.x,Ue.y),st===0&&Qt===!0&&It.copy(Ue);break;case"v":for(st=0,qt=(ct=U(Yr)).length;st<qt;st++)Ue.y+=ct[st],Rt.x=Ue.x,Rt.y=Ue.y,_t.lineTo(Ue.x,Ue.y),st===0&&Qt===!0&&It.copy(Ue);break;case"l":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=2)Ue.x+=ct[st+0],Ue.y+=ct[st+1],Rt.x=Ue.x,Rt.y=Ue.y,_t.lineTo(Ue.x,Ue.y),st===0&&Qt===!0&&It.copy(Ue);break;case"c":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=6)_t.bezierCurveTo(Ue.x+ct[st+0],Ue.y+ct[st+1],Ue.x+ct[st+2],Ue.y+ct[st+3],Ue.x+ct[st+4],Ue.y+ct[st+5]),Rt.x=Ue.x+ct[st+2],Rt.y=Ue.y+ct[st+3],Ue.x+=ct[st+4],Ue.y+=ct[st+5],st===0&&Qt===!0&&It.copy(Ue);break;case"s":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=4)_t.bezierCurveTo(k(Ue.x,Rt.x),k(Ue.y,Rt.y),Ue.x+ct[st+0],Ue.y+ct[st+1],Ue.x+ct[st+2],Ue.y+ct[st+3]),Rt.x=Ue.x+ct[st+0],Rt.y=Ue.y+ct[st+1],Ue.x+=ct[st+2],Ue.y+=ct[st+3],st===0&&Qt===!0&&It.copy(Ue);break;case"q":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=4)_t.quadraticCurveTo(Ue.x+ct[st+0],Ue.y+ct[st+1],Ue.x+ct[st+2],Ue.y+ct[st+3]),Rt.x=Ue.x+ct[st+0],Rt.y=Ue.y+ct[st+1],Ue.x+=ct[st+2],Ue.y+=ct[st+3],st===0&&Qt===!0&&It.copy(Ue);break;case"t":for(st=0,qt=(ct=U(Yr)).length;st<qt;st+=2)Tr=k(Ue.x,Rt.x),ir=k(Ue.y,Rt.y),_t.quadraticCurveTo(Tr,ir,Ue.x+ct[st+0],Ue.y+ct[st+1]),Rt.x=Tr,Rt.y=ir,Ue.x=Ue.x+ct[st+0],Ue.y=Ue.y+ct[st+1],st===0&&Qt===!0&&It.copy(Ue);break;case"a":for(st=0,qt=(ct=U(Yr,[3,4],7)).length;st<qt;st+=7)ct[st+5]==0&&ct[st+6]==0||(Hr=Ue.clone(),Ue.x+=ct[st+5],Ue.y+=ct[st+6],Rt.x=Ue.x,Rt.y=Ue.y,g(_t,ct[st],ct[st+1],ct[st+2],ct[st+3],ct[st+4],Hr,Ue),st===0&&Qt===!0&&It.copy(Ue));break;case"Z":case"z":_t.currentPath.autoClose=!0,0<_t.currentPath.curves.length&&(Ue.copy(It),_t.currentPath.currentPoint.copy(Ue),Nr=!0);break;default:console.warn(Yt)}Qt=!1}return _t}(J));break;case"rect":te=_(J,te),ue=function(Pt){var _t=Y(Pt.getAttribute("x")||0),Ue=Y(Pt.getAttribute("y")||0),Rt=Y(Pt.getAttribute("rx")||Pt.getAttribute("ry")||0),It=Y(Pt.getAttribute("ry")||Pt.getAttribute("rx")||0),Nr=Y(Pt.getAttribute("width")),Qt=Y(Pt.getAttribute("height")),Ur=.448084975506,gt=new x.ShapePath;return gt.moveTo(_t+Rt,Ue),gt.lineTo(_t+Nr-Rt,Ue),Rt===0&&It===0||gt.bezierCurveTo(_t+Nr-Rt*Ur,Ue,_t+Nr,Ue+It*Ur,_t+Nr,Ue+It),gt.lineTo(_t+Nr,Ue+Qt-It),Rt===0&&It===0||gt.bezierCurveTo(_t+Nr,Ue+Qt-It*Ur,_t+Nr-Rt*Ur,Ue+Qt,_t+Nr-Rt,Ue+Qt),gt.lineTo(_t+Rt,Ue+Qt),Rt===0&&It===0||gt.bezierCurveTo(_t+Rt*Ur,Ue+Qt,_t,Ue+Qt-It*Ur,_t,Ue+Qt-It),gt.lineTo(_t,Ue+It),Rt===0&&It===0||gt.bezierCurveTo(_t,Ue+It*Ur,_t+Rt*Ur,Ue,_t+Rt,Ue),gt}(J);break;case"polygon":te=_(J,te),le=J,Re=new x.ShapePath,at=0,le.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(Pt,_t,Ue){var Rt=Y(_t),It=Y(Ue);at===0?Re.moveTo(Rt,It):Re.lineTo(Rt,It),at++}),Re.currentPath.autoClose=!0,ue=Re;break;case"polyline":te=_(J,te),re=J,fe=new x.ShapePath,ne=0,re.getAttribute("points").replace(/(-?[\d\.?]+)[,|\s](-?[\d\.?]+)/g,function(Pt,_t,Ue){var Rt=Y(_t),It=Y(Ue);ne===0?fe.moveTo(Rt,It):fe.lineTo(Rt,It),ne++}),fe.currentPath.autoClose=!1,ue=fe;break;case"circle":te=_(J,te),ue=function(Pt){var _t=Y(Pt.getAttribute("cx")||0),Ue=Y(Pt.getAttribute("cy")||0),Rt=Y(Pt.getAttribute("r")||0),It=new x.Path;It.absarc(_t,Ue,Rt,0,2*Math.PI,!1);var Nr=new x.ShapePath;return Nr.subPaths.push(It),Nr}(J);break;case"ellipse":te=_(J,te),ue=function(Pt){var _t=Y(Pt.getAttribute("cx")||0),Ue=Y(Pt.getAttribute("cy")||0),Rt=Y(Pt.getAttribute("rx")||0),It=Y(Pt.getAttribute("ry")||0),Nr=new x.Path;Nr.absellipse(_t,Ue,Rt,It,0,2*Math.PI,void 0,void 0);var Qt=new x.ShapePath;return Qt.subPaths.push(Nr),Qt}(J);break;case"line":te=_(J,te),se=Y((X=J).getAttribute("x1")||0),ve=Y(X.getAttribute("y1")||0),Ee=Y(X.getAttribute("x2")||0),we=Y(X.getAttribute("y2")||0),(Be=new x.ShapePath).moveTo(se,ve),Be.lineTo(Ee,we),Be.currentPath.autoClose=!1,ue=Be;break;case"defs":Ie=!1;break;case"use":te=_(J,te);var Me=J.href.baseVal.substring(1),Je=J.viewportElement.getElementById(Me);Je?z(Je,te):console.warn("SVGLoader: 'use node' references non-existent node id: "+Me)}if(ue&&(te.fill!==void 0&&te.fill!=="none"&&ue.color.setStyle(te.fill),function(Pt,_t){function Ue(Yr){v.set(Yr.x,Yr.y,1).applyMatrix3(_t),Yr.set(v.x,v.y)}for(var Rt=function(Yr){return Yr.elements[1]!==0||Yr.elements[3]!==0}(_t),It=Pt.subPaths,Nr=0,Qt=It.length;Nr<Qt;Nr++)for(var Ur=It[Nr].curves,gt=0;gt<Ur.length;gt++){var We=Ur[gt];We.isLineCurve?(Ue(We.v1),Ue(We.v2)):We.isCubicBezierCurve?(Ue(We.v0),Ue(We.v1),Ue(We.v2),Ue(We.v3)):We.isQuadraticBezierCurve?(Ue(We.v0),Ue(We.v1),Ue(We.v2)):We.isEllipseCurve&&(Rt&&console.warn("SVGLoader: Elliptic arc or ellipse rotation or skewing is not implemented."),u.set(We.aX,We.aY),Ue(u),We.aX=u.x,We.aY=u.y,We.xRadius*=(Or=_t.elements,Math.sqrt(Or[0]*Or[0]+Or[1]*Or[1])),We.yRadius*=(Yt=_t.elements,Math.sqrt(Yt[3]*Yt[3]+Yt[4]*Yt[4])))}var Yt,Or}(ue,M),G.push(ue),ue.userData={node:J,style:te}),Ie)for(var $e=J.childNodes,ft=0;ft<$e.length;ft++)z($e[ft],te);ze&&(B.pop(),0<B.length?M.copy(B[B.length-1]):M.identity())}}(j.documentElement,{fill:"#000",fillOpacity:1,strokeOpacity:1,strokeWidth:1,strokeLineJoin:"miter",strokeLineCap:"butt",strokeMiterLimit:4}),{paths:G,xml:j.documentElement}},H.createShapes=function(F){var P=999999999,g={ORIGIN:0,DESTINATION:1,BETWEEN:2,LEFT:3,RIGHT:4,BEHIND:5,BEYOND:6},E={loc:g.ORIGIN,t:0};function _(D,N,I,h){var u=D.x,v=N.x,M=I.x,j=h.x,z=D.y,J=N.y,te=I.y,X=h.y,se=(j-M)*(z-te)-(X-te)*(u-M),ve=(X-te)*(v-u)-(j-M)*(J-z),Ee=se/ve,we=((v-u)*(z-te)-(J-z)*(u-M))/ve;if(ve==0&&se!=0||Ee<=0||1<=Ee||we<0||1<we)return null;if(se==0&&ve==0){for(var Be=0;Be<2;Be++){if(k(Be===0?I:h,D,N),E.loc==g.ORIGIN)return{x:(re=Be===0?I:h).x,y:re.y,t:E.t};if(E.loc==g.BETWEEN)return{x:+(u+E.t*(v-u)).toPrecision(10),y:+(z+E.t*(J-z)).toPrecision(10),t:E.t}}return null}for(Be=0;Be<2;Be++){var re;if(k(Be===0?I:h,D,N),E.loc==g.ORIGIN)return{x:(re=Be===0?I:h).x,y:re.y,t:E.t}}return{x:+(u+Ee*(v-u)).toPrecision(10),y:+(z+Ee*(J-z)).toPrecision(10),t:Ee}}function k(D,N,I){var h,u=I.x-N.x,v=I.y-N.y,M=D.x-N.x,j=D.y-N.y,z=u*j-M*v;return D.x===N.x&&D.y===N.y?(E.loc=g.ORIGIN,E.t=0):D.x===I.x&&D.y===I.y?(E.loc=g.DESTINATION,E.t=1,0):void(z<-Number.EPSILON?E.loc=g.LEFT:z>Number.EPSILON?E.loc=g.RIGHT:u*M<0||v*j<0?E.loc=g.BEHIND:Math.sqrt(u*u+v*v)<Math.sqrt(M*M+j*j)?E.loc=g.BEYOND:(h=u!=0?M/u:j/v,E.loc=g.BETWEEN,E.t=h))}function U(D,N,I){var h=new x.Vector2;N.getCenter(h);var u=[];return I.forEach(function(v){v.boundingBox.containsPoint(h)&&function(M,j){for(var z=[],J=[],te=1;te<M.length;te++)for(var X=M[te-1],se=M[te],ve=function(we){var Be=j[we-1],re=j[we],fe=_(X,se,Be,re);fe!==null&&z.find(function(ne){return ne.t<=fe.t+Number.EPSILON&&ne.t>=fe.t-Number.EPSILON})===void 0&&(z.push(fe),J.push(new x.Vector2(fe.x,fe.y)))},Ee=1;Ee<j.length;Ee++)ve(Ee);return J}(D,v.points).forEach(function(M){u.push({identifier:v.identifier,isCW:v.isCW,point:M})})}),u.sort(function(v,M){return v.point.x-M.point.x}),u}var C=0,S=P,Y=-P,G=F.subPaths.map(function(D){for(var N=D.getPoints(),I=-P,h=P,u=-P,v=P,M=0;M<N.length;M++){var j=N[M];j.y>I&&(I=j.y),j.y<h&&(h=j.y),j.x>u&&(u=j.x),j.x<v&&(v=j.x)}return Y<=u&&(Y=u+1),v<=S&&(S=v-1),{curves:D.curves,points:N,isCW:x.ShapeUtils.isClockWise(N),identifier:C++,boundingBox:new x.Box2(new x.Vector2(v,h),new x.Vector2(u,I))}});G=G.filter(function(D){return 1<D.points.length}),C=0;var T=(G=G.map(function(D){return D.identifier=C,C++,D})).map(function(D){return function(N,I,h,u,v){v!=null&&v!==""||(v="nonzero");var M=new x.Vector2;N.boundingBox.getCenter(M);var j=U([new x.Vector2(h,M.y),new x.Vector2(u,M.y)],N.boundingBox,I);j.sort(function(fe,ne){return fe.point.x-ne.point.x});var z=[],J=[];j.forEach(function(fe){fe.identifier===N.identifier?z.push(fe):J.push(fe)});for(var te=z[0].point.x,X=[],se=0;se<J.length&&J[se].point.x<te;)0<X.length&&X[X.length-1]===J[se].identifier?X.pop():X.push(J[se].identifier),se++;if(X.push(N.identifier),v==="evenodd"){var ve=X.length%2==0,Ee=X[X.length-2];return{identifier:N.identifier,isHole:ve,for:Ee}}if(v==="nonzero"){ve=!0;for(var we=Ee=null,Be=0;Be<X.length;Be++){var re=X[Be];ve?(we=I[re].isCW,ve=!1,Ee=re):we!==I[re].isCW&&(we=I[re].isCW,ve=!0)}return{identifier:N.identifier,isHole:ve,for:Ee}}console.warn('fill-rule: "'+v+'" is currently not implemented.')}(D,G,S,Y,F.userData.style.fillRule)}),B=[];return G.forEach(function(D){if(!T[D.identifier].isHole){var N=new x.Shape;N.curves=D.curves,T.filter(function(I){return I.isHole&&I.for===D.identifier}).forEach(function(I){var h=G[I.identifier],u=new x.Path;u.curves=h.curves,N.holes.push(u)}),B.push(N)}}),B},H.getStrokeStyle=function(F,P,g,E,_){return{strokeColor:P=P!==void 0?P:"#000",strokeWidth:F=F!==void 0?F:1,strokeLineJoin:g=g!==void 0?g:"miter",strokeLineCap:E=E!==void 0?E:"butt",strokeMiterLimit:_=_!==void 0?_:4}},H.pointsToStroke=function(F,P,g,E){var _=[],k=[],U=[];if(H.pointsToStrokeWithBuffers(F,P,g,E,_,k,U)===0)return null;var C=new x.BufferGeometry;return C.setAttribute("position",new x.Float32BufferAttribute(_,3)),C.setAttribute("normal",new x.Float32BufferAttribute(k,3)),C.setAttribute("uv",new x.Float32BufferAttribute(U,2)),C},H.pointsToStrokeWithBuffers=function(F,P,g,E,_,k,U,C){var S=new x.Vector2,Y=new x.Vector2,G=new x.Vector2,T=new x.Vector2,B=new x.Vector2,D=new x.Vector2,N=new x.Vector2,I=new x.Vector2,h=new x.Vector2,u=new x.Vector2,v=new x.Vector2,M=new x.Vector2,j=new x.Vector2,z=new x.Vector2,J=new x.Vector2,te=new x.Vector2,X=new x.Vector2;g=g!==void 0?g:12,E=E!==void 0?E:.001,C=C!==void 0?C:0;var se=(F=function(qt){for(var Tr=!1,ir=1,Hr=qt.length-1;ir<Hr;ir++)if(qt[ir].distanceTo(qt[ir+1])<E){Tr=!0;break}if(!Tr)return qt;var vn=[];for(vn.push(qt[0]),ir=1,Hr=qt.length-1;ir<Hr;ir++)qt[ir].distanceTo(qt[ir+1])>=E&&vn.push(qt[ir]);return vn.push(qt[qt.length-1]),vn}(F)).length;if(se<2)return 0;var ve,Ee,we,Be,re,fe,ne=F[0].equals(F[se-1]),le=F[0],Re=P.strokeWidth/2,at=1/(se-1),ze=0,Ie=!1,ue=0,Me=3*C,Je=2*C;gt(F[0],F[1],S).multiplyScalar(Re),I.copy(F[0]).sub(S),h.copy(F[0]).add(S),u.copy(I),v.copy(h);for(var $e=1;$e<se;$e++){ve=F[$e],Ee=$e===se-1?ne?F[1]:void 0:F[$e+1];var ft=S;if(gt(le,ve,ft),G.copy(ft).multiplyScalar(Re),M.copy(ve).sub(G),j.copy(ve).add(G),we=ze+at,Be=!1,Ee!==void 0){gt(ve,Ee,Y),G.copy(Y).multiplyScalar(Re),z.copy(ve).sub(G),J.copy(ve).add(G),re=!0,G.subVectors(Ee,le),ft.dot(G)<0&&(re=!1),$e===1&&(Ie=re),G.subVectors(Ee,ve),G.normalize();var Pt=Math.abs(ft.dot(G));if(Pt!==0){var _t=Re/Pt;G.multiplyScalar(-_t),T.subVectors(ve,le),B.copy(T).setLength(_t).add(G),te.copy(B).negate();var Ue=B.length(),Rt=T.length();T.divideScalar(Rt),D.subVectors(Ee,ve);var It=D.length();switch(D.divideScalar(It),T.dot(te)<Rt&&D.dot(te)<It&&(Be=!0),X.copy(B).add(ve),te.add(ve),fe=!1,Be?re?(J.copy(te),j.copy(te)):(z.copy(te),M.copy(te)):Or(),P.strokeLineJoin){case"bevel":Yr(re,Be,we);break;case"round":ct(re,Be),re?Yt(ve,M,z,we,0):Yt(ve,J,j,we,1);break;default:var Nr=Re*P.strokeMiterLimit/Ue;if(Nr<1){if(P.strokeLineJoin!=="miter-clip"){Yr(re,Be,we);break}ct(re,Be),re?(D.subVectors(X,M).multiplyScalar(Nr).add(M),N.subVectors(X,z).multiplyScalar(Nr).add(z),We(M,we,0),We(D,we,0),We(ve,we,.5),We(ve,we,.5),We(D,we,0),We(N,we,0),We(ve,we,.5),We(N,we,0),We(z,we,0)):(D.subVectors(X,j).multiplyScalar(Nr).add(j),N.subVectors(X,J).multiplyScalar(Nr).add(J),We(j,we,1),We(D,we,1),We(ve,we,.5),We(ve,we,.5),We(D,we,1),We(N,we,1),We(ve,we,.5),We(N,we,1),We(J,we,1))}else Be?(re?(We(h,ze,1),We(I,ze,0),We(X,we,0),We(h,ze,1),We(X,we,0),We(te,we,1)):(We(h,ze,1),We(I,ze,0),We(X,we,1),We(I,ze,0),We(te,we,0),We(X,we,1)),re?z.copy(X):J.copy(X)):re?(We(M,we,0),We(X,we,0),We(ve,we,.5),We(ve,we,.5),We(X,we,0),We(z,we,0)):(We(j,we,1),We(X,we,1),We(ve,we,.5),We(ve,we,.5),We(X,we,1),We(J,we,1)),fe=!0}}else Or()}else Or();ne||$e!==se-1||st(F[0],u,v,re,!0,ze),ze=we,le=ve,I.copy(z),h.copy(J)}if(ne){if(Be&&_){var Qt=X,Ur=te;Ie!==re&&(Qt=te,Ur=X),re?(fe||Ie)&&(Ur.toArray(_,0),Ur.toArray(_,9),fe&&Qt.toArray(_,3)):!fe&&Ie||(Ur.toArray(_,3),Ur.toArray(_,9),fe&&Qt.toArray(_,0))}}else st(ve,M,j,re,!1,we);return ue;function gt(qt,Tr,ir){return ir.subVectors(Tr,qt),ir.set(-ir.y,ir.x).normalize()}function We(qt,Tr,ir){_&&(_[Me]=qt.x,_[Me+1]=qt.y,_[Me+2]=0,k&&(k[Me]=0,k[Me+1]=0,k[Me+2]=1),Me+=3,U&&(U[Je]=Tr,U[Je+1]=ir,Je+=2)),ue+=3}function Yt(qt,Tr,ir,Hr,vn){S.copy(Tr).sub(qt).normalize(),Y.copy(ir).sub(qt).normalize();var In=Math.PI,Zr=S.dot(Y);Math.abs(Zr)<1&&(In=Math.abs(Math.acos(Zr))),In/=g,G.copy(Tr);for(var Gn=0,lt=g-1;Gn<lt;Gn++)T.copy(G).rotateAround(qt,In),We(G,Hr,vn),We(T,Hr,vn),We(qt,Hr,.5),G.copy(T);We(T,Hr,vn),We(ir,Hr,vn),We(qt,Hr,.5)}function Or(){We(h,ze,1),We(I,ze,0),We(M,we,0),We(h,ze,1),We(M,we,1),We(j,we,0)}function Yr(qt,Tr,ir){Tr?(qt?(We(h,ze,1),We(I,ze,0),We(M,we,0),We(h,ze,1),We(M,we,0),We(te,we,1),We(M,ir,0),We(z,ir,0)):(We(h,ze,1),We(I,ze,0),We(j,we,1),We(I,ze,0),We(te,we,0),We(j,we,1),We(j,ir,1),We(J,ir,0)),We(te,ir,.5)):(qt?(We(M,ir,0),We(z,ir,0)):(We(j,ir,1),We(J,ir,0)),We(ve,ir,.5))}function ct(qt,Tr){Tr&&(qt?(We(h,ze,1),We(I,ze,0),We(M,we,0),We(h,ze,1),We(M,we,0),We(te,we,1),We(M,ze,0),We(ve,we,.5),We(te,we,1),We(ve,we,.5),We(z,ze,0),We(te,we,1)):(We(h,ze,1),We(I,ze,0),We(j,we,1),We(I,ze,0),We(te,we,0),We(j,we,1),We(j,ze,1),We(te,we,0),We(ve,we,.5),We(ve,we,.5),We(te,we,0),We(J,ze,1)))}function st(qt,Tr,ir,Hr,vn,In){switch(P.strokeLineCap){case"round":vn?Yt(qt,ir,Tr,In,.5):Yt(qt,Tr,ir,In,.5);break;case"square":if(vn)S.subVectors(Tr,qt),Y.set(S.y,-S.x),G.addVectors(S,Y).add(qt),T.subVectors(Y,S).add(qt),Hr?(G.toArray(_,3),T.toArray(_,0),T.toArray(_,9)):(G.toArray(_,3),G.toArray(_,9),T.toArray(_,0));else{S.subVectors(ir,qt),Y.set(S.y,-S.x),G.addVectors(S,Y).add(qt),T.subVectors(Y,S).add(qt);var Zr=_.length;Hr?(G.toArray(_,Zr-3),T.toArray(_,Zr-6)):(G.toArray(_,Zr-6),T.toArray(_,Zr-3)),T.toArray(_,Zr-12)}}}},H);function H(F){var P=c.call(this,F)||this;return P.defaultDPI=90,P.defaultUnit="px",P}o.SVGLoader=A},{three:19}],61:[function(b,n,o){var a,m=this&&this.__extends||(a=function(h,u){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,M){v.__proto__=M}||function(v,M){for(var j in M)Object.prototype.hasOwnProperty.call(M,j)&&(v[j]=M[j])})(h,u)},function(h,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function v(){this.constructor=h}a(h,u),h.prototype=u===null?Object.create(u):(v.prototype=u.prototype,new v)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxTest=void 0;var c,x,A,H=b("../Operate/MrxDbgUiPrBase"),F=b("../Operate/MrxDbgUiPrPoint"),P=b("../MxThreeJS"),g=b("three"),E=b("../MxFun"),_=b("../View/MxDbEntity"),k=b("../MrxDbgUtils"),U=b("../Operate/MrxDbgUiPrDist"),C=(b("../MxString"),m(S,c=_.MxDbEntityUserObject),S.prototype.worldDraw=function(h){var u=new g.Vector3(this.pt.x-this.r,this.pt.y-this.r,0),v=new g.Vector3(this.pt.x+this.r,this.pt.y+this.r,0);new g.Vector3(u.x,v.y);var M=new g.Vector3(v.x,u.y);h.setDashLineDisplay(!0),h.setDash(.1,.2),h.drawLine(M,u)},S.prototype.setPoint=function(h){this.pt=h},S.prototype.setR=function(h){this.r=h},S.prototype.getTypeName=function(){return"MxDbTest"},S.prototype.getGripPoints=function(){var h=[];return h.push(this.pt),h},S.prototype.moveGripPointsAt=function(h,u){return h==0&&this.pt.add(u),!0},S.prototype.dwgIn=function(h){return c.prototype.dwgIn.call(this,h),this.pt.copy(h.pt),this.r=h.r,!0},S.prototype.dwgOut=function(h){return c.prototype.dwgOut.call(this,h),h.pt=this.pt,h.r=this.r,h},S.prototype.create=function(){return new S},S);function S(){var h=c!==null&&c.apply(this,arguments)||this;return h.pt=new g.Vector3,h.r=100,h}function Y(h){var u=new F.MrxDbgUiPrPoint;u.setMessage(`
指定第一点:`),u.go(function(v){if(v==0){var M=u.value(),j=new g.Vector3;j.x=M.x,j.y=M.y;var z=new H.McEdGetPointWorldDrawObject;z.setDraw(function(J,te){te.setColor(255),te.drawLine(J,j)}),u.setUserDraw(z),u.setMessage(`
指定下一点:`),u.go(function(J){if(J==0){var te=u.value(),X=E.MxFun.getCurrentDraw(),se=P.MxThreeJS.createLine(M,te,16777215);X.addObject(se)}})}})}function G(){var h=new F.MrxDbgUiPrPoint;h.setMessage(`
指定第一点:`),h.go(function(u){if(u==0){var v=E.MxFun.getCurrentDraw(),M=new C;M.setColor(16711680),M.setPoint(h.value()),M.setR(v.viewCoordLong2Cad(100)),v.addMxEntity(M),v.addMxCurrentSelect(M.objectId())}})}function T(){k.MrxDbgUtils.selectEnt("Test").then(function(h){console.log(h)})}function B(){var h=E.MxFun.getCurrentDraw();A?(h.eraseAllMxEntity(),h.loadMxEntityFromJson(A)):(A=h.saveMxEntityToJson(),console.log(A))}function D(){E.MxFun.openFile("demo/buf/hhhh.dwg?token=123456")}function N(){var h=new F.MrxDbgUiPrPoint;h.setMessage(`
指定第一点:`),h.go(function(u){if(u==0){var v=h.value();k.MrxDbgUtils.getCorner(v,"Test",!0).then(function(M){console.log("xxxdddd"),console.log(M)})}})}function I(){var h=new U.MrxDbgUiPrDist;h.setMessage(`
输入距离:`),h.go(function(u){if(u==0){var v=h.value();console.log(v)}})}(x||(o.MxTest=x={})).registerCommand=function(){console.log("regist mx test"),new C().init(),E.MxFun.addCommand("MxTest_GetPoint",Y),E.MxFun.addCommand("MxTest_GetDist",I),E.MxFun.addCommand("MxTest_DrawCustomEntity",G),E.MxFun.addCommand("MxTest_EntSel",T),E.MxFun.addCommand("MxTest_SaveMxDbEntityToJson",B),E.MxFun.addCommand("MxTest_OpenFile",D),E.MxFun.addCommand("MxTest_GetCorner",N),E.MxFun.addWindowsEvent(function(h,u){if(h=="mouseup"){if(E.MxFun.isRunningCommand()||u.button!=0)return 0;var v=u.srcElement;if(v&&v.tagName=="CANVAS"){var M=E.MxFun.getCurrentDraw(),j=new g.Vector3(u.offsetX,u.offsetY,0);M.findMxEntityAtPoint(j,!1).length&&u.preventDefault()}return 0}})}},{"../MrxDbgUtils":20,"../MxFun":27,"../MxString":34,"../MxThreeJS":37,"../Operate/MrxDbgUiPrBase":45,"../Operate/MrxDbgUiPrDist":46,"../Operate/MrxDbgUiPrPoint":47,"../View/MxDbEntity":69,three:19}],62:[function(require,module,exports){Object.defineProperty(exports,"__esModule",{value:!0}),exports.MxUiObject=exports.MxToolBarItem=exports.MxMenuItem=void 0;var MxFun_1=require("../MxFun"),MxMenuItem=function(){this.id=-1,this.text="",this.evalString="",this.parentId=-1};exports.MxMenuItem=MxMenuItem;var MxToolBarItem=function(){this.isMxCommand=!1,this.itemid=""};exports.MxToolBarItem=MxToolBarItem;var MxUiObject=function(){function MxUiObject(){this.vecMenuItem=new Array,this.vecToolBarItem=new Array,this.uiPath="./ui",this.idMenuItemCount=100,this.isShowTitle=!1,this.isShowStructTree=!1,this.isEnableLoading=!0,this.isShowLayer=!1,this.isShowTakeColor=!1,this.isShowLayout=!1,this.isEnableObjectProperty=!1,this.isShowToolbar=!1,this.isShowMainMenu=!1,this.sTitle="",this.sLanguageTable={layout:"布局",layer:"图层",visible:"可见",color:"颜色",name:"名字",status:"状态",openComplete:"提示：打开图纸完成"}}return MxUiObject.prototype.SetLayoutData=function(b){this.vecLayoutData=b},MxUiObject.prototype.CallMxCommand=function(b){MxFun_1.MxFun.callCommand(b,"")},MxUiObject.prototype.EvalJs=function(value){eval(value)},MxUiObject.prototype.SetLayerData=function(b){this.vecLayerData=b},MxUiObject.prototype.SetSketchLayerData=function(b){this.vecSketchLayerData=b},MxUiObject.prototype.init=function(){this.onInit()},MxUiObject.prototype.addMenuItem=function(b,n,o,a){n===void 0&&(n=""),o===void 0&&(o=-1),a===void 0&&(a=-1);var m=new MxMenuItem;m.text=b,m.evalString=n,a==-1&&(a=this.idMenuItemCount,this.idMenuItemCount++),m.id=a,m.parentId=o,this.vecMenuItem.push(m)},MxUiObject.prototype.addToolBarItem=function(b,n,o,a,m){n===void 0&&(n=""),o===void 0&&(o=""),a===void 0&&(a=!1),m===void 0&&(m="");var c=new MxToolBarItem;c.image=b,c.evalString=o,c.text=n,c.isMxCommand=a,c.itemid=m,this.vecToolBarItem.push(c)},MxUiObject.prototype.setPath=function(b){this.uiPath=b},MxUiObject.prototype.getPath=function(){return this.uiPath},MxUiObject.prototype.create=function(){this.onCreate()},MxUiObject.prototype.writeUICSS=function(){var b=this.uiPath;MxFun_1.MxFun.isPC()?(document.write("<link rel='stylesheet' href='"+b+"/css/mxbimpcm.css'>"),this.isShowMainMenu&&(document.write("<link rel='stylesheet' href='"+b+"/css/rightfacefonts2.css'>"),document.write("<link rel='stylesheet' href='"+b+"/css/rightmnu.css'>"),document.write("<script type='text/javascript' src='"+b+"/hc-mobile-nav.js'><\/script>"))):(document.write("<link rel='stylesheet' href='"+b+"/css/mxmobile.css'>"),this.isShowMainMenu&&(document.write("<link href='"+b+"/css/font-awesome.min.css' rel='stylesheet'>"),document.write("<link rel='stylesheet' href='"+b+"/css/rightfacefonts1.css'>"),document.write("<link rel='stylesheet' href='"+b+"/css/rightfacefonts2.css'>"),document.write("<link rel='stylesheet' href='"+b+"/css/rightmnu.css'>"),document.write("<script type='text/javascript' src='"+b+"/hc-mobile-nav.js'><\/script>")))},MxUiObject}();exports.MxUiObject=MxUiObject},{"../MxFun":27}],63:[function(b,n,o){var a,m=this&&this.__extends||(a=function(P,g){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,_){E.__proto__=_}||function(E,_){for(var k in _)Object.prototype.hasOwnProperty.call(_,k)&&(E[k]=_[k])})(P,g)},function(P,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function E(){this.constructor=P}a(P,g),P.prototype=g===null?Object.create(g):(E.prototype=g.prototype,new E)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxUiObjectMobile=void 0;var c,x=b("./MxUiObject"),A=b("../MxFun"),H=(m(F,c=x.MxUiObject),F.prototype.onCreate=function(){this.isShowTitle&&this.WriteTitle(),this.WriteStructTree(),this.isEnableLoading&&this.WriteLoading(),this.WriteLayer(),this.WriteTakeColor(),this.WriteLayout(),this.isEnableObjectProperty&&this.WriteObjectProperty(),this.isShowToolbar&&this.WriteToolbar()},F.prototype.onInit=function(){this.InitEvent()},F.prototype.ShowLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0)"),$(".Prompt").fadeIn(100),$(".Prompt span").css("display","none"))},F.prototype.HideLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0.8)"),$(".Prompt div").fadeOut(100),$(".Prompt span").fadeIn(200),setTimeout(function(){$(".Prompt").fadeOut(1e3)},1e3))},F.prototype.ShowObjectProperty=function(P){if(P.length!=0){var g;g=typeof P=="string"?JSON.parse(P):P;var E="";for(var _ in g){var k=g[_];for(var U in E+='<tbody class="bf-group undefined bf-collapse">',E+='<tr class="bf-group-title">',E+='<td colspan="2"><i class="bf-icon" style=" padding: 12px;"></i>'+k.name+"</td>",E+="</tr>",k.datas){var C=k.datas[U];E+="<tr class='bf-group-content'>",E+="<td class='bf-key'>"+C.name+"</td>",E+="<td class='bf-value'>"+C.value+"</td>",E+="</tr>"}E+="</tbody>"}document.getElementById("ComponentContent").innerHTML=E,$(".bf-group").click(function(){$(this).hasClass("bf-collapse")?$(this).removeClass("bf-collapse"):$(this).addClass("bf-collapse")})}},F.prototype.HideObjectProp=function(){},F.prototype.SwitchShowLayer=function(){var P=document.getElementById("LayerInterface");P.style.display=="none"?(P.style.display="block",P.style.left="80px",P.style.top="50px"):P.style.display="none"},F.prototype.SwitchShowStructTree=function(){},F.prototype.Chosecolor=function(){document.getElementById("color-picker").click()},F.prototype.ColorChange=function(P){document.getElementById("colorbox").style.backgroundColor=P,A.MxFun.setCurrentColor(P)},F.prototype.SwitchShowLayout=function(){var P=document.getElementById("LayerOutInterface");P.style.display=="none"?P.style.display="block":P.style.display="none"},F.prototype.WriteTitle=function(){var P=this.uiPath;document.write("<div class='bar1'>"),document.write("<img src='"+P+"/image/mxcad.png' style='height: 50%;position: absolute;top: 12px;left: 10px;'>"),document.write("<span  class='barspan'  style='position: absolute;left: 45px;'>"),document.write("</span>"),document.write("<div id='container'>"),this.isShowMainMenu&&(document.write("<header>"),document.write("<div class='wrapper cf'style='z-index: 999'>"),document.write("<nav id='main-nav' >"),document.write("</nav>"),document.write("<a class='toggle'>"),document.write("<span></span>"),document.write("</a>"),document.write("</div>"),document.write("</header>")),document.write("</div>"),document.write("</div>")},F.prototype.WriteToolbar=function(){document.write("<div id='MainMenuContent' class='bf-toolbar bf-toolbar-bottom'>"),document.write("</div>")},F.prototype.WriteLoading=function(){var P=this.uiPath;document.write("<div class='Prompt' style='width: 100px;height:30px;position:"),document.write("absolute;top: 60px;left: 50%;margin-left: -50px;color: #fff;text-align: center;'>"),document.write("<div style='text-align: center;'>"),document.write("<img src='"+P+"/image/loading.gif' alt='' style='width:30px;height:30px;float: left'>"),document.write("<p style='color:black;vertical-align: middle;float: left;  margin-top: 5px;margin-left: 5px;'>加载中.....</p>"),document.write("</div>"),document.write("<span style='vertical-align: middle;display: none'>图纸加载完毕</span>"),document.write("</div>")},F.prototype.WriteLayer=function(){var P=this.uiPath;this.isShowLayer&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' title='ModelTree' style='position: absolute; top:111px;left: 0px;' onclick='uiObj.SwitchShowLayer()'>"),document.write("<div class='bf-button mxbim-bf-tree' title='图层'>"),document.write("<img src='"+P+"/image/layer.png.gif' alt='' style='width: 24px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerInterface' title='图层'"),document.write("style='left: 0px;"),document.write("top: 0px;"),document.write("width: 100%;"),document.write("height: 100%;"),document.write("display: none;'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayer()' style='text-align: center;'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'>图层</div>"),document.write("<div>"),document.write("<div class='layer-title' style='width: 12.5%;'>可见</div>"),document.write("<div class='layer-title' style='width: 12.5%;'>颜色</div>"),document.write("<div class='layer-title' style='width: 62.5%'>名字</div>"),document.write("<div class='layer-title' style='width: 12.5%'>状态</div>"),document.write("</div>"),document.write("<div id='Layer-Info'  style='margin-top: 26px;height: 79%;width: 100%; position: absolute;overflow-y: auto;'>"),document.write("</div>"),document.write("</div>")},F.prototype.WriteStructTree=function(){this.isShowStructTree&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='Fmj' title='ModelTree'"),document.write("style='position: absolute; top:60px;left: 0px;' onclick='uiObj.SwitchShowStructTree()'>"),document.write("<div class='bf-button mxbim-bf-tree' title='构件树'><i class='fa fa-sitemap' aria-hidden='true' style='font-size: 24px;'></i></div>"),document.write("</div>")),document.write("<div class='bf-panel  bf-has-title bf-sizable tree-panel' id='dv' title='目录树' style='left: 0px; top: 0px; width: 100%; height: 100%; display: none;'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowStructTree()'><i class='fa fa-times fa-2x' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'>目录树</div>"),document.write("<div class='bf-panel-body' style='padding-top: 57px;overflow-y: scroll;'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-tree-header' style='margin-top: -57px;'>"),document.write("<div class='bf-tabs bf-tabs-tree'>"),document.write("<ul class='bf-tabs-list'>"),document.write("<li class='bf-tabs-option my-option undefined active' id='component'>构件</li>"),document.write("<li class='bf-tabs-option my-option undefined' id='area'>空间</li>"),document.write("<li class='bf-tabs-option my-option undefined' id='drawing'>图纸</li>"),document.write("</ul>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("<div class='' style='margin-bottom: 100px;' id='DirectoryContent'>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},F.prototype.WriteTakeColor=function(){var P=this.uiPath;this.isShowTakeColor&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='TakeColor'"),document.write("style='position: absolute;left: 0px; top: 162px;width: 45px; '>"),document.write("<div class='bf-button' onclick='uiObj.Chosecolor()' style='opacity: 1;width: 45px;'>"),document.write("<div  style='position: relative;margin-left: 10px;margin-top: -5px;'>"),document.write("<img src='"+P+"/image/color.png' alt='' style='width: 40px;margin-left: -21px;'>"),document.write("</div>"),document.write("<div id='colorbox' style='width: 30px;height: 5px;background-color: #cccccc;margin-left: -3px;margin-top: -5px;'>"),document.write("</div>"),document.write("<div style='width: 18px;height: 40px;float: right;margin-top: -38px;margin-left: 14px;position: absolute;'>"),document.write("<img src='"+P+"/image/daojiao.png' alt='' style='width: 15px;margin-top: 10px;z-index: 999;position: relative'>"),document.write("<input id='color-picker' type='color' value='#c0c0c0'   style='display: none' onchange='colorChange(value)'>"),document.write("</div>"),document.write("</div>"),document.write("</div>"))},F.prototype.WriteLayout=function(){var P=this.uiPath;this.isShowLayout&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerOut'"),document.write("style='position: absolute;left: 0px; top: 213px; ' onclick='uiObj.SwitchShowLayout()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+P+"/image/layout.png' alt='' style='width: 24px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerOutInterface'"),document.write("style='left: 0; top: 0; width: 100%;display:none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayout()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='buju' style='cursor: move; user-select: none;'>布局</div>"),document.write("<div>"),document.write("</div>"),document.write("<div id=''>"),document.write("<div>"),document.write("<table  class='bf-table'>"),document.write("<tbody class='bf-group'>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div layer_on'></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div' ></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div' ></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>"),document.write("<td class='bf_layerout_td'  style='width: 60px' >"),document.write("<div class='bf_layer_div'></div>"),document.write("</td>"),document.write("<td  style='width: 238px' >"),document.write("<span  style='color: white;cursor: pointer;'>LayerOut</span>"),document.write("</td>"),document.write("</tr>"),document.write("</tbody>"),document.write("</table>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},F.prototype.WriteObjectProperty=function(){document.write("<div class='bf-panel bf-has-title bf-sizable property-panel' id='fmj2' title='构件详情' style='left: 0px; top: 0px; width: 100%; height: 100%;display: none;'>"),document.write("<div class='bf-close' id='close2' style='top:4.0em;'><i class='fa fa-times fa-2x' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'>构件详情</div>"),document.write("<div class='bf-panel-body' style='padding-top: 41px;'>"),document.write("<div class='bf-panel-container bf-scroll-bar' style='top:0;width: 100%;height: 100%;overflow-y: auto;position: relative;'>"),document.write("<table class='bf-table' id='ComponentContent'>"),document.write("</table>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},F.prototype.UpDisplayLayout=function(){},F.prototype.UpDisplayLayer=function(){var P=this.uiPath,g=this.vecLayerData,E=this.vecSketchLayerData,_="";if(E!=null){var k=E;for(var U in k){_+="<div>";var C="hide.png";k[U].off==0&&(C="show.png");var S="unlock.png";_+="<table class='bf-table'>",_+="<tbody class='bf-group'>",_+="<tr class='bf-group-title'>",_+='<td><img class="layer-enable" sketch=1 id='+k[U].id+' src="'+P+"/image/"+C+'"/></td>',_+='<td><span class="layer-color" style="background-color:'+k[U].color+'"></span></td>',_+='<td><span class="layer-text">草图_'+k[U].name+"</span></td>",_+='<td><img class="layer-state" src="'+P+"/image/"+S+'"/></td>',_+="</tr>",_+="</tbody>",_+="</table>",_+="</div>"}}if(g!=null)for(var U in k=g)_+="<div>",C="hide.png",k[U].off==0&&(C="show.png"),S="lock.png",_+="<table class='bf-table'>",_+="<tbody class='bf-group'>",_+="<tr class='bf-group-title'>",_+='<td><img class="layer-enable" sketch=0 id='+k[U].id+' src="'+P+"/image/"+C+'"/></td>',_+='<td><span class="layer-color" style="background-color:'+k[U].color+'"></span></td>',_+='<td><span class="layer-text">'+k[U].name+"</span></td>",_+='<td><img class="layer-state" src="'+P+"/image/"+S+'"/></td>',_+="</tr>",_+="</tbody>",_+="</table>",_+="</div>";var Y=document.getElementById("Layer-Info");Y!=null&&(Y.innerHTML=_)},F.prototype.WriteFooter=function(){document.write("<div class='footer' style='background: rgba(0, 0, 0, 0.7);min-width: auto;position: fixed;left: 0;bottom: 0;width: 100%;'>"),document.write("<div style='line-height: 40px;font-size: 12px;color: #999;padding: 0 10px;'>"),document.write("<p style='float: right;line-height: 15px;font-size: 12px;color: #999;display: block;'>"),document.write("<a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com/' target='_blank'>梦想CAD</a>旗下产品"),document.write("</p>"),document.write("<a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com' target='_blank'>MX3D</a> 蜀ICP备15011727号"),document.write("</div>"),document.write("</div>")},F.prototype.CreateToolBar=function(P){if(this.isShowToolbar){var g="";for(var E in P){var _=P[E],k="uiObj.CallMxCommand";_.isMxCommand||(k="uiObj.EvalJs"),0<_.itemid.length?g+='<div class="bf-button" onclick="'+k+"('"+P[E].evalString+`')"><img class="mainimage-bf-butto" id="`+_.itemid+'" src="'+this.uiPath+"\\image\\"+_.image+'" title="'+P[E].text+'"></div>':g+='<div class="bf-button" onclick="'+k+"('"+P[E].evalString+`')"><img class="mainimage-bf-butto" src="`+this.uiPath+"\\image\\"+_.image+'" title="'+P[E].text+'"></div>'}document.getElementById("MainMenuContent").innerHTML=g}},F.prototype.InitEvent=function(){var P=document.getElementById("LayerInterface");this.CreateToolBar(this.vecToolBarItem),P.style.display="none";var g=this.vecMenuItem;this.isShowMainMenu&&function(C){var S="";(function N(I,h){var u=function(M,j){var z=new Array;for(var J in j)j[J].parentId==M&&z.push(j[J]);return z}(I,h);if(0<u.length){for(var v in S+="<ul>",u)u[v].evalString.length!=0?(S+='<li><p class="li_option" ',S+=`onclick="uiObj.EvalJs('`+u[v].evalString+`')"`,S+=">"+u[v].text+"</p>"):(S+="<li><a ",S+=">"+u[v].text+"</a>"),N(u[v].id,h),S+="</li>";S+="</br>",S+="</br>",S+="</br>",S+="</ul>"}})(-1,g),C("#main-nav").append(S);var Y=C("#main-nav"),G=C(".toggle"),T={maxWidth:!1,customToggle:G,levelTitles:!0},B=null,D={};B&&B.remove(),G.off("click"),B=Y.clone(),C.extend(D,{side:"right"}),B.hcMobileNav(C.extend({},T,D))}(jQuery);var E=window.location.href,_=E.length,k=E.indexOf("?"),U=E.substr(k,_).split("=")[1];$(".barspan").html(decodeURIComponent(U)),$("#close2").click(function(){$(this).parent("div").fadeOut(200)}),$(".bf-select-current").click(function(){$(this).hasClass("bf-open")?$(this).removeClass("bf-open"):$(this).addClass("bf-open")}),$(".my-option").click(function(){var C=$(this);$(".my-option").each(function(){$(this).removeClass("active")}),C.addClass("active")}),$(".bf-select-option").click(function(){$(this).parent("ul").prev("span").html($(this).text()),$(this).parent("ul").prev("span").removeClass("bf-open")}),$(document).on("click",".layer-enable",function(){var C=A.MxFun.getUiObj().getPath(),S=parseInt($(this).attr("id")),Y=!0;$(this).attr("src")==C+"/image/show.png"?($(this).attr("src",C+"/image/hide.png"),Y=!1):$(this).attr("src",C+"/image/show.png"),A.MxFun.showLayer(S,Y)})},F.prototype.Fullscreen=function(){var P=document.documentElement;P.requestFullscreen?P.requestFullscreen():P.mozRequestFullScreen?P.mozRequestFullScreen():P.webkitRequestFullScreen&&P.webkitRequestFullScreen(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.IsFullStatus()?($("img[title='取消全屏']").attr("src",this.uiPath+"/image\\fullscreen1.gif"),$("img[title='取消全屏']").attr("title","全屏")):($("img[title='全屏']").attr("src",this.uiPath+"/image\\escscreen1.gif"),$("img[title='全屏']").attr("title","取消全屏"))},F.prototype.IsFullStatus=function(){return(document.fullscreenEnabled||document.mozFullscreenElement||document.webkitFullscreenElement)!=null},F);function F(){return c!==null&&c.apply(this,arguments)||this}o.MxUiObjectMobile=H},{"../MxFun":27,"./MxUiObject":62}],64:[function(b,n,o){var a,m=this&&this.__extends||(a=function(P,g){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(E,_){E.__proto__=_}||function(E,_){for(var k in _)Object.prototype.hasOwnProperty.call(_,k)&&(E[k]=_[k])})(P,g)},function(P,g){if(typeof g!="function"&&g!==null)throw new TypeError("Class extends value "+String(g)+" is not a constructor or null");function E(){this.constructor=P}a(P,g),P.prototype=g===null?Object.create(g):(E.prototype=g.prototype,new E)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxUiObjectPC=void 0;var c,x=b("./MxUiObject"),A=b("../MxFun"),H=(m(F,c=x.MxUiObject),F.prototype.onCreate=function(){this.isShowTitle&&this.WriteTitle(),this.WriteStructTree(),this.isEnableLoading&&this.WriteLoading(),this.WriteLayer(),this.WriteTakeColor(),this.WriteLayout(),this.isEnableObjectProperty&&this.WriteObjectProperty(),this.isShowToolbar&&this.WriteToolbar()},F.prototype.onInit=function(){this.InitEvent()},F.prototype.WriteTitle=function(){var P=this.uiPath;document.write("<div id='all'>"),document.write("   <div class='bar1'>"),document.write("   <img src="+P+"/image/mxcad.png style='height: 50%;position: absolute;top: 12px;left: 10px;'>"),document.write("   <span  class='barspan' style='position: absolute;left: 45px;'>"),document.write("   </span>"),document.write("   <div id='container'>"),this.isShowMainMenu&&(document.write("   <header>"),document.write("    <div class='wrapper cf'style='z-index: 999'>"),document.write("   <nav id='main-nav' >"),document.write("    </nav>"),document.write("    <a class='toggle'>"),document.write("   <span></span>"),document.write("    </a>"),document.write("    </div>"),document.write("    </header>")),document.write("    </div>"),document.write("    </div>")},F.prototype.WriteStructTree=function(){this.isShowStructTree&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='ModelTreeThumbnail' title='目录树'"),document.write("style='position: absolute;left: 10px; top: 97px; ' onclick='uiObj.SwitchShowStructTree()'>"),document.write("<div class='bf-button mxbim-bf-tree' title='目录树'><i class='fa fa-sitemap' aria-hidden='true'></i></div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='ModelTreeInterface' title='目录树'"),document.write("style='left:0px; top: 0px; width: 300px; height: 416px;display: none'>"),document.write("   <div class='bf-close' onclick='uiObj.SwitchShowStructTree()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;' id='mulushu'>目录树</div>"),document.write("<div class='bf-panel-body' style='padding-top: 36px;'>"),document.write("<div class='bf-panel-header'>"),document.write("<div class='bf-tree-header' style='margin-top: -36px;'>"),document.write("<div class='bf-select bf-select-tree'>"),document.write("<span class='bf-select-current'>构件</span>"),document.write("<ul class='bf-select-list'>"),document.write("<li class='bf-select-option' id='type'>构件</li>"),document.write("<li class='bf-select-option' id='file'>文件</li>"),document.write("<li class='bf-select-option' id='area'>空间</li>"),document.write("<li class='bf-select-option' id='drawing'>图纸</li>"),document.write("</ul>"),document.write("</div>"),document.write("</div>"),document.write("</div>"),document.write("<div id='DirectoryContent' class='bf-panel-container TreeInfo'>"),document.write("</div>"),document.write("</div>"),document.write("</div>")},F.prototype.WriteLoading=function(){var P=this.uiPath;document.write("<div class='Prompt'>"),document.write("<div style='text-align: center;'>"),document.write("<img src='"+P+"/image/loading.gif' alt='' style='width:30px;height:30px;float: left'>"),document.write("<p  style='color:black;vertical-align: middle;float: left; margin-top: 5px;margin-left: 5px;'>加载中.....</p>"),document.write("</div>"),document.write("<span style='display: none'>"+this.sLanguageTable.openComplete+"</span>"),document.write("</div>")},F.prototype.WriteLayer=function(){var P=this.uiPath;this.isShowLayer&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerThumbnail' title='"+this.sLanguageTable.layer+"'"),document.write("style='position: absolute;left: 10px; top: 45px; ' onclick='uiObj.SwitchShowLayer()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+P+"/image/layer.png.gif' alt='' style='width: 32px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerInterface'"),document.write("style='left: 10px; top: 50px; width: 300px; height: 416px;display: none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayer(false)'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='tuceng' style='cursor: move; user-select: none;'>"+this.sLanguageTable.layer+"</div>"),document.write("<div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.visible+"</div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.color+"</div>"),document.write("<div class='layer-title' style='width: 148px;font-size: 14px'>"+this.sLanguageTable.name+"</div>"),document.write("<div class='layer-title' style='width: 50px;font-size: 14px'>"+this.sLanguageTable.status+"</div>"),document.write("</div>"),document.write("<div id='Layer-Info' style='margin-top: 25px;height: 349px;position: absolute;overflow-y: auto;'>"),document.write("</div>"),document.write("</div>")},F.prototype.WriteTakeColor=function(){var P=this.uiPath;this.isShowTakeColor&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='TakeColor' title='选择颜色'"),document.write("style='position: absolute;left: 10px; top: 149px; '>"),document.write("<div class='bf-button' onclick='uiObj.Chosecolor()' style='opacity: 1;'>"),document.write("<img src='"+P+"/image/color.png' alt='' style='width: 40px;margin-left: -10px;'>"),document.write("<div id='colorbox' style='width: 35px;height: 5px;background-color: #cccccc;margin-left: -3px'>"),document.write("</div>"),document.write("<div style='width: 18px;height: 40px;float: right;margin-top: -42px;margin-left: 14px;'>"),document.write("<img src='"+P+"/image/daojiao.png' alt='' style='width: 15px;margin-top: 10px;z-index: 999;position: relative'>"),document.write("<input id='color-picker' type='color' value='#c0c0c0'   style='display: none' onchange='uiObj.ColorChange(value)'>"),document.write("</div>"),document.write("</div>"),document.write("</div>"))},F.prototype.WriteLayout=function(){var P=this.uiPath;this.isShowLayout&&(document.write("<div class='bf-toolbar bf-toolbar bf-tree-toolbar' id='LayerOut' title='"+this.sLanguageTable.layout+"'"),document.write("style='position: absolute;left: 10px; top: 97px; ' onclick='uiObj.SwitchShowLayout()'>"),document.write("<div class='bf-button'>"),document.write("<img src='"+P+"/image/layout.png' alt='' style='width: 32px;'>"),document.write("</div>"),document.write("</div>")),document.write("<div class='bf-panel bf-has-title bf-sizable' id='LayerOutInterface'"),document.write("style='left: 10px; top: 50px; width: 300px;display:none'>"),document.write("<div class='bf-close' onclick='uiObj.SwitchShowLayout()'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' id='buju' style='cursor: move; user-select: none;'>"+this.sLanguageTable.layout+"</div>"),document.write("<div>"),document.write("</div>"),document.write("<div id='layout-Info'>"),document.write("</div>"),document.write("</div>")},F.prototype.WriteObjectProperty=function(){document.write("<div class='bf-panel bf-has-title bf-sizable' id='StrcutInfoBase' title='属性'"),document.write("style='right: 10px; top: 45px; width: 300px; height: 416px;display: none'>"),document.write("<div class='bf-close' id='close2'><i class='fa fa-times' aria-hidden='true'></i></div>"),document.write("<div class='bf-title' style='cursor: move; user-select: none;'>属性</div>"),document.write("<div id='ComponentContent' class='bf-panel-body StructInfo'></div>"),document.write("<div class='bf-resize'></div>"),document.write("</div>")},F.prototype.WriteToolbar=function(){document.write("<div id='MainMenuContent' class='bf-toolbar bf-toolbar-bottom' style='position: fixed'></div>")},F.prototype.CreateToolBar=function(P){if(this.isShowToolbar){var g="";for(var E in P){var _=P[E],k="uiObj.CallMxCommand";_.isMxCommand||(k="uiObj.EvalJs"),0<_.itemid.length?g+='<div class="bf-button" onclick="'+k+"('"+P[E].evalString+`')"><img class="mainimage-bf-butto" id="`+_.itemid+'" src="'+this.uiPath+"\\image\\"+_.image+'" title="'+P[E].text+'"></div>':g+='<div class="bf-button" onclick="'+k+"('"+P[E].evalString+`')"><img class="mainimage-bf-butto" src="`+this.uiPath+"\\image\\"+_.image+'" title="'+P[E].text+'"></div>'}document.getElementById("MainMenuContent").innerHTML=g}},F.prototype.UpDisplayLayer=function(){var P=this.uiPath,g=this.vecLayerData,E=this.vecSketchLayerData,_="";if(E!=null){var k=E;for(var U in k){_+="<div>";var C="hide.png";k[U].off==0&&(C="show.png");var S="unlock.png";_+="<table class='bf-table'>",_+="<tbody class='bf-group'>",_+="<tr class='bf-group-title'>",_+='<td><img class="layer-enable" sketch=1 id='+k[U].id+' src="'+P+"/image/"+C+'"/></td>',_+='<td><span class="layer-color" style="background-color:'+k[U].color+'"></span></td>',_+='<td><span class="layer-text">草图_'+k[U].name+"</span></td>",_+='<td><img class="layer-state" src="'+P+"/image/"+S+'"/></td>',_+="</tr>",_+="</tbody>",_+="</table>",_+="</div>"}}if(g!=null)for(var U in k=g)_+="<div>",C="hide.png",k[U].off==0&&(C="show.png"),S="lock.png",_+="<table class='bf-table'>",_+="<tbody class='bf-group'>",_+="<tr class='bf-group-title'>",_+='<td><img class="layer-enable" sketch=0 id='+k[U].id+' src="'+P+"/image/"+C+'"/></td>',_+='<td><span class="layer-color" style="background-color:'+k[U].color+'"></span></td>',_+='<td><span class="layer-text">'+k[U].name+"</span></td>",_+='<td><img class="layer-state" src="'+P+"/image/"+S+'"/></td>',_+="</tr>",_+="</tbody>",_+="</table>",_+="</div>";var Y=document.getElementById("Layer-Info");Y!=null&&(Y.innerHTML=_)},F.prototype.UpDisplayLayout=function(){var P=this.vecLayoutData,g="";if(g+="<div>",g+="<table  class='bf-table'>",g+="<tbody class='bf-group'>",g+="<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>",g+="<td class='bf_layerout_td'  style='width: 60px' >",g+="<div class='bf_layer_div layer_on'></div>",g+="</td>",g+="<td  style='width: 238px' >",g+="<span  class='layout-name' name='Model' style='color: white;cursor: pointer;'>Model</span>",g+="</td>",g+="</tr>",P!=null){var E=P;for(var _ in E)g+="<tr class='bf-group-title  bf_layerout' style='height: 30px;cursor: pointer;'>",g+="<td class='bf_layerout_td'  style='width: 60px' >",g+="<div class='bf_layer_div layer_on'></div>",g+="</td>",g+="<td style='width: 238px' >",g+="<span class='layout-name' name='"+E[_]+"' style='color: white;cursor: pointer;'>"+E[_]+"</span>",g+="</td>",g+="</tr>"}g+="</tbody>",g+="</table>",g+="</div>";var k=document.getElementById("layout-Info");k!=null&&(k.innerHTML=g)},F.prototype.InitEvent=function(){var P=document.getElementById("ModelTreeInterface"),g=document.getElementById("LayerInterface"),E=document.getElementById("LayerOutInterface"),_=document.getElementById("tuceng"),k=document.getElementById("mulushu"),U=document.getElementById("buju"),C=0,S=0,Y=0,G=0,T=!1;k.onmousedown=function(v){C=v.clientX,S=v.clientY,Y=P.offsetLeft,G=P.offsetTop,T=!0,P.style.cursor="move"},_.onmousedown=function(v){C=v.clientX,S=v.clientY,Y=g.offsetLeft,G=g.offsetTop,T=!0,g.style.cursor="move"},U.onmousedown=function(v){C=v.clientX,S=v.clientY,Y=E.offsetLeft,G=E.offsetTop,T=!0,E.style.cursor="move"},window.onmousemove=function(v){if(T!=0){var M=v.clientX,j=v.clientY,z=M-(C-Y),J=j-(S-G);P.style.left=z+"px",P.style.top=J+"px",g.style.left=z+"px",g.style.top=J+"px",E.style.left=z+"px",E.style.top=J+"px"}},k.onmouseup=function(){T=!1,P.style.cursor="default"},_.onmouseup=function(){T=!1,g.style.cursor="default"},U.onmouseup=function(){T=!1,E.style.cursor="default"},$("#close2").click(function(){$(this).parent("div").fadeOut(200)}),$("#menu4").click(function(){$("#StrcutInfoBase").hasClass("hide")?($("#StrcutInfoBase").fadeIn(200),$("#StrcutInfoBase").removeClass("hide")):($("#StrcutInfoBase").fadeOut(200),$("#StrcutInfoBase").addClass("hide"))}),$(".bf-select-current").click(function(){$(this).hasClass("bf-open")?$(this).removeClass("bf-open"):$(this).addClass("bf-open")}),$(".bf-select-option").click(function(){$(this).parent("ul").prev("span").html($(this).text()),$(this).parent("ul").prev("span").removeClass("bf-open")});var B=$("#StrcutInfoBase");B.bind("mousedown",function(v){var M=$(this)[0].offsetLeft,j=$(this)[0].offsetTop,z=v.pageX,J=v.pageY;$(document).bind("mousemove",function(te){var X=te.pageX-z,se=te.pageY-J,ve=M+X+"px",Ee=j+se+"px";B.css({top:Ee,left:ve})})}),$(document).bind("mouseup",function(){$(this).unbind("mousemove")}),this.CreateToolBar(this.vecToolBarItem);var D=this.vecMenuItem;if(this.isShowMainMenu&&function(v){var M="";(function se(ve,Ee){var we=function(re,fe){var ne=new Array;for(var le in fe)fe[le].parentId==re&&ne.push(fe[le]);return ne}(ve,Ee);if(0<we.length){for(var Be in M+="<ul>",we)we[Be].evalString.length!=0?(M+='<li><p class="li_option" ',M+=`onclick="uiObj.EvalJs('`+we[Be].evalString+`')"`,M+=">"+we[Be].text+"</p>"):(M+="<li><a ",M+=">"+we[Be].text+"</a>"),se(we[Be].id,Ee),M+="</li>";M+="</br>",M+="</br>",M+="</br>",M+="</ul>"}})(-1,D),v("#main-nav").append(M);var j=v("#main-nav"),z=v(".toggle"),J={maxWidth:!1,customToggle:z,levelTitles:!0},te=null,X={};te&&te.remove(),z.off("click"),te=j.clone(),v.extend(X,{side:"right"}),te.hcMobileNav(v.extend({},J,X))}(jQuery),$(".li_option").click(function(){var v=$(this);$(".li_option").each(function(){$(this).removeClass("active")}),v.addClass("active")}),this.sTitle==""){var N=window.location.href,I=N.length,h=N.indexOf("?"),u=N.substr(h,I).split("=")[1];u!=null&&(this.sTitle=u)}$(".barspan").html(decodeURIComponent(this.sTitle)),$(document).on("click",".layer-enable",function(){var v=A.MxFun.getUiObj().getPath(),M=parseInt($(this).attr("id")),j=(parseInt($(this).attr("sketch")),!0);$(this).attr("src")==v+"/image/show.png"?($(this).attr("src",v+"/image/hide.png"),j=!1):$(this).attr("src",v+"/image/show.png"),A.MxFun.showLayer(M,j)}),$(document).on("click",".layout-name",function(){var v=$(this).attr("name");v=="Model"&&(v=""),A.MxFun.getCurrentDraw().gotoLayout(v)})},F.prototype.WriteFooter=function(){document.write("<div class='footer' style='background: rgba(0, 0, 0, 0.7);position: fixed;left: 0;bottom: 0;width: 100%;'>"),document.write("   <div style='line-height: 40px;font-size: 12px;color: #999;padding: 0 10px;'>"),document.write("    <p style='float: right;line-height: 15px;font-size: 12px;color: #999;display: block;'>"),document.write("    <a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com/' target='_blank'>MxDraw </a>旗下产品"),document.write("    </p>"),document.write("    <a style='color: #4a90e2;text-decoration: none;outline: none;' href='http://www.mxdraw.com' target='_blank'>MX3D </a> 蜀ICP备15011727号"),document.write("    </div>"),document.write("   </div>")},F.prototype.ShowLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0)"),$(".Prompt").fadeIn(100),$(".Prompt span").css("display","none"))},F.prototype.HideLoading=function(){this.isEnableLoading&&($(".Prompt").css("background","rgba(0, 0, 0, 0.8)"),$(".Prompt div").fadeOut(100),$(".Prompt span").fadeIn(200),setTimeout(function(){$(".Prompt").fadeOut(1e3)},1e3))},F.prototype.ShowObjectProperty=function(P){if(P.length!=0){var g;g=typeof P=="string"?JSON.parse(P):P;var E="";for(var _ in g){var k=g[_];for(var U in E+="<table class='bf-table'>",E+="<tbody class='bf-group'>",E+="<tr class='bf-group-title'>",E+="<td colspan='2'><i class='bf-icon'></i>"+k.name+"</td>",E+="</tr>",k.datas){var C=k.datas[U];E+="<tr class='bf-group-content'>",E+="<td class='bf-key'>"+C.name+"</td>",E+="<td class='bf-value'>"+C.value+"</td>",E+="</tr>"}E+="</tbody>",E+="</table>"}document.getElementById("ComponentContent").innerHTML=E,$(".bf-group").click(function(){$(this).hasClass("bf-collapse")?$(this).removeClass("bf-collapse"):$(this).addClass("bf-collapse")}),$("#StrcutInfoBase").fadeIn(200),$("#StrcutInfoBase").removeClass("hide")}},F.prototype.HideObjectProp=function(){$("#StrcutInfoBase").hasClass("hide")||($("#StrcutInfoBase").fadeOut(200),$("#StrcutInfoBase").addClass("hide"))},F.prototype.SwitchShowLayer=function(){var P=document.getElementById("ModelTreeInterface"),g=document.getElementById("ModelTreeThumbnail"),E=document.getElementById("LayerThumbnail"),_=document.getElementById("LayerInterface"),k=document.getElementById("LayerOut"),U=document.getElementById("LayerOutInterface");P.style.display="none",(U.style.display="none")==_.style.display?(E.style.display="block",_.style.display="block",_.style.left="80px",_.style.top="50px",g!=null&&(g.style.display="block"),k!=null&&(k.style.display="block"),P.style.display="none",U.style.display="none"):(_.style.display="none",g!=null&&(g.style.display="block"),E.style.display="block",k!=null&&(k.style.display="block"))},F.prototype.SwitchShowStructTree=function(){var P=document.getElementById("ModelTreeInterface"),g=document.getElementById("ModelTreeThumbnail"),E=document.getElementById("LayerThumbnail"),_=document.getElementById("LayerInterface"),k=document.getElementById("LayerOut"),U=document.getElementById("LayerOutInterface");_.style.display="none",(U.style.display="none")==P.style.display?(g!=null&&(g.style.display="block"),P.style.display="block",P.style.left="80px",P.style.top="50px",E.style.display="block",k!=null&&(k.style.display="block"),_.style.display="none",U.style.display="none"):(P.style.display="none",g!=null&&(g.style.display="block"),E.style.display="block",k!=null&&(k.style.display="block"))},F.prototype.Chosecolor=function(){document.getElementById("color-picker").click()},F.prototype.ColorChange=function(P){document.getElementById("colorbox").style.backgroundColor=P,A.MxFun.setCurrentColor(P)},F.prototype.SwitchShowLayout=function(){var P=document.getElementById("ModelTreeInterface"),g=document.getElementById("ModelTreeThumbnail"),E=document.getElementById("LayerThumbnail"),_=document.getElementById("LayerInterface"),k=document.getElementById("LayerOut"),U=document.getElementById("LayerOutInterface");P.style.display="none",_.style.display="none",U&&U.style.display=="none"?(k&&(k.style.display="block"),U.style.display="block",U.style.left="80px",U.style.top="120px",g!=null&&(g.style.display="block"),E&&(E.style.display="block"),P.style.display="none",_.style.display="none"):(U&&(U.style.display="none"),g!=null&&(g.style.display="block"),E&&(E.style.display="block"),k&&(k.style.display="block"))},F.prototype.Fullscreen=function(){var P=document.documentElement;P.requestFullscreen?P.requestFullscreen():P.mozRequestFullScreen?P.mozRequestFullScreen():P.webkitRequestFullScreen&&P.webkitRequestFullScreen(),document.exitFullscreen?document.exitFullscreen():document.mozCancelFullScreen?document.mozCancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.msExitFullscreen&&document.msExitFullscreen(),this.IsFullStatus()?($("img[title='取消全屏']").attr("src",this.uiPath+"/image\\fullscreen1.gif"),$("img[title='取消全屏']").attr("title","全屏")):($("img[title='全屏']").attr("src",this.uiPath+"/image\\escscreen1.gif"),$("img[title='全屏']").attr("title","取消全屏"))},F.prototype.IsFullStatus=function(){return(document.fullscreenEnabled||document.mozFullscreenElement||document.webkitFullscreenElement)!=null},F);function F(){return c!==null&&c.apply(this,arguments)||this}o.MxUiObjectPC=H},{"../MxFun":27,"./MxUiObject":62}],65:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxUiVue=o.MxUiOperations=void 0;var a,m,c,x,A,H=b("three"),F=b("../MxFun"),P=b("../Operate/MxJigCmdManager"),g=b("../MxTools"),E=b("../Operate/MxCmdRunManager");function _(B){var D=P.MxJigCmdManager.getCurCmd();D!=null&&D.getOsnap().setSpecificOsMode(B)}function k(B){if(B==32||B==13){if(P.MxJigCmdManager.isRunning())P.MxJigCmdManager.OnEnter(B);else{var D=Y(),N="";N=D.length==0?E.MxCmdRunManager.GetPrvCmd():D,G(""),N=g.MxTools.stringTrimLeftSpace(N),F.MxFun.sendStringToExecute(N)}return 1}if(B==38)P.MxJigCmdManager.isRunning()||(E.MxCmdRunManager.MoveUpKey(),(I=E.MxCmdRunManager.GetListCommad()).length!=0&&(G(I),S()));else if(B==40){var I;P.MxJigCmdManager.isRunning()||(E.MxCmdRunManager.MoveDownKey(),(I=E.MxCmdRunManager.GetListCommad()).length!=0&&(G(I),S()))}return 0}function U(B,D){D===void 0&&(D=!0);var N=B.length;if(!(N<1)){for(var I=x.getCmdLine(),h=I.getCmdTip(),u=I.getCmdText(),v=B.indexOf(`
`),M=0,j=!0;v!=-1&&(j?(I.addCmdDisplay(`
`+h+u+B.substring(M,v-M)),u=h="",j=!1):I.addCmdDisplay(`
`+B.substring(M,v-M)),(M=v+1)<N);)v=B.indexOf(`
`,M);if(j){var z=B.substring(M,N-M),J=z.indexOf("\r"),te=z.length;h=J==-1?h+u+z:J+1<te?z.substring(J+1,te-J-1):""}else M<N&&(h=B.substring(M,N));u="",D&&(h+=" "),I.setCmdTip(h),I.setCmdText(u),I.upDisplay()}}function C(B){for(var D=[],N=1;N<arguments.length;N++)D[N-1]=arguments[N];if(x!=null){for(var I=arguments,h=I[0],u=0;u<I.length-1;u++){var v=new RegExp("\\{"+u+"\\}","gm");h=h.replace(v,I[u+1])}U(h,!0)}}function S(){x!=null&&x.getCmdLine().upDisplay()}function Y(){if(x==null)return"";var B=x.getCmdLine();return g.MxTools.stringTrimLeftRightSpace(B.getCmdText())}function G(B){if(x!=null)return x.getCmdLine().setCmdText(B)}function T(B){var D=P.MxJigCmdManager.getCurCmd();return D==null?0:D.getDynImput().onKeyDonw(B)?1:k(B)}o.MxUiOperations={kOkCommand:1,kCancaleCommand:2},m=a||(o.MxUiVue=a={}),x=void 0,A=new H.Vector3,m.SetLasetPoint=function(B){A=B},m.GetLasetPoint=function(){return A},(c=m.CursorType||(m.CursorType={}))[c.kNormal=0]="kNormal",c[c.kRect=1]="kRect",c[c.kCross=2]="kCross",c[c.kPan=3]="kPan",m.isNull=function(){return x==null},m.init=function(B){(x=B).mountKeydownEvent(k),x.getDynamicInput().mountKeydownEvent(T),x.mountsetRightMenuSnapTypeFun&&x.mountsetRightMenuSnapTypeFun(_),x.mountTsWeb_MxUiVue&&x.mountTsWeb_MxUiVue(this)},m.executeOperations=function(B){B==o.MxUiOperations.kOkCommand?P.MxJigCmdManager.getCurCmd()&&P.MxJigCmdManager.OnEnter(-1):B==o.MxUiOperations.kCancaleCommand&&P.MxJigCmdManager.getCurCmd()&&P.MxJigCmdManager.stopCmd(P.MxJigCmdManager.DetailedResult.kEcsIn)},m.setTipCoord=function(B){x!=null&&x.setTipCoord(B)},m.setCursorType=function(B){x!=null&&x.setCursorType(B)},m.AcutPrintfNoFormat=U,m.acutPrintf=C,m.cmdLineUpDisplay=S,m.getCmdText=Y,m.setCmdText=G,m.getCmdDisplay=function(){return x==null?"":x.getCmdLine().getCmdDisplay()},m.setCmdDisplay=function(B){if(x!=null)return x.getCmdLine().setCmdDisplay(B)},m.getCmdTip=function(){return x==null?"":x.getCmdLine().getCmdTip()},m.setCmdTip=function(B){if(x!=null)return x.getCmdLine().setCmdTip(B)},m.restoreCmdStatus=function(){if(x!=null){var B=x.getCmdLine();B.getCmdTip()==" "&&B.getCmdText().length==0?(B.setCmdTip(""),C("{0}:","命令")):C(`
{0}:`,"命令")}},m.DynamicInput_upDisplay=function(){x!=null&&m.OnMxEvent({name:"dynInputUpDisplay"})},m.DynamicInput_setType=function(B){x!=null&&x.getDynamicInput().setType(B)},m.DynamicInput_getType=function(){return x==null?P.MxJigCmdManager.DynamicInputType.kNoInput:x.getDynamicInput().getType()},m.DynamicInput_setPos=function(B){x!=null&&x.getDynamicInput().setPos([B.x,B.y])},m.DynamicInput_setTip=function(B){x!=null&&x.getDynamicInput().setTip(B)},m.DynamicInput_setValue1=function(B){x!=null&&x.getDynamicInput().setValue1(B)},m.DynamicInput_getValue1=function(){return x==null?"":x.getDynamicInput().getValue1()},m.DynamicInput_setValue1Pos=function(B){x!=null&&x.getDynamicInput().setValue1Pos([B.x,B.y])},m.DynamicInput_setValue2=function(B){x!=null&&x.getDynamicInput().setValue2(B)},m.DynamicInput_getValue2=function(){return x==null?"":x.getDynamicInput().getValue2()},m.DynamicInput_getFocusValue=function(){return x==null?"":x.getDynamicInput().getFocusValue()},m.DynamicInput_getFocusIndex=function(){return x==null?0:x.getDynamicInput().getFocusIndex()},m.DynamicInput_setValue2Pos=function(B){x!=null&&x.getDynamicInput().setValue2Pos([B.x,B.y])},m.DynamicInput_setShow=function(B){x!=null&&x.getDynamicInput().setShow(B)},m.DynamicInput_isShow=function(){return x!=null&&x.getDynamicInput().isShow()},m.OnMxEvent=function(B){if(x==null)return!1;x.OnMxEvent(B)},m.DynamicInput_getLockValuesMap=function(){return x==null?new Map:x.getDynamicInput().getLockValuesMap()},m.DynamicInput_clearLockValuesMap=function(){x!=null&&x.getDynamicInput().clearLockValuesMap()}},{"../MxFun":27,"../MxTools":38,"../Operate/MxCmdRunManager":48,"../Operate/MxJigCmdManager":54,three:19}],66:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.ExternalReferenceManager=o.ExternalReferenceDatabase=o.Blocks=o.Block=o.Layer=o.MxNewDisplayMemorySection=o.MxNewDisplayMemorySectionType=o.TextureData=o.BlockInstance=o.BlockRef=o.ClipPlans=o.ClipPlan=void 0;var a=b("three"),m=b("../MxShader"),c=b("./MxBrowseLayerData"),x=b("../MxManager"),A=b("../MxNetData"),H=b("../MxStencilObject"),F=b("../MxFun"),P=function(){this.x1=0,this.y1=0,this.x2=0,this.y2=0};o.ClipPlan=P;var g=function(){this.ver=4,this.id=1,this.clipPlanArray=new Array,this.clipPoints=[],this.instansClipePoints=[]};o.ClipPlans=g;var E=function(){this.ver=4,this.mat=new a.Matrix4,this.blkRecId=-1,this.blkOwnerId=0,this.layerId=-1,this.color=16777215,this.clipPlans=new g};o.BlockRef=E;var _=function(){this.mat=new a.Matrix4,this.color=new Array,this.topLayerColor=new Array,this.clipPlans=new g,this.clipMat=new a.Matrix4};o.BlockInstance=_;var k,U,C=function(){};o.TextureData=C,(U=k||(o.MxNewDisplayMemorySectionType=k={}))[U.kLinesType=1]="kLinesType",U[U.kTriangleType=2]="kTriangleType",U[U.kLinesType_Float=3]="kLinesType_Float",U[U.kTriangleType_Float=4]="kTriangleType_Float",U[U.kPointType_Float=5]="kPointType_Float",U[U.kPointType=6]="kPointType",o.MxNewDisplayMemorySection=function(){this.id=0,this.type=k.kLinesType,this.blockId=0,this.layerId=0,this.color=0,this.points=[]};var S=(Y.prototype.Show=function(u){for(var v=0,M=this._entitys.length;v<M;v++)this._entitys[v].visible=u},Y.prototype.updataClipMaterial=function(u){for(var v=this._material_clip.length,M=.5*u.width,j=.5*u.height,z=0;z<v;z++)this._material_clip[z].uniforms.vieww.value=M,this._material_clip[z].uniforms.viewh.value=j},Y.prototype.createThreejsObjForMesh_Clip=function(u,v,M){u.size!=0&&u.forEach(function(j){var z=j;if(z.length!=0){var J=[],te=[],X=z[0].clipPlans;X.ver<=3&&(J.push(X.clipPlanArray[0].x1,X.clipPlanArray[0].y1),te.push(X.clipPlanArray[0].x2,X.clipPlanArray[0].y2));for(var se=[],ve=[],Ee=[],we=[],Be=[],re=[],fe=[],ne=0;ne<z.length;ne++){var le=z[ne];se=se.concat(le.mat.elements.slice(0,4)),ve=ve.concat(le.mat.elements.slice(4,8)),Ee=Ee.concat(le.mat.elements.slice(8,12)),we=we.concat(le.mat.elements.slice(12,16)),Be.push(0),re=re.concat(z[ne].color)}if(0<this._geometryMeshPositionsByBlock.length)for(ne=0;ne<z.length;ne++)re=re.concat(z[ne].color);if(0<this._geometryMeshPositionsByBlock_ZeroLayer.length)for(ne=0;ne<z.length;ne++)fe=fe.concat(z[ne].topLayerColor);var Re,at=.5*M.width,ze=.5*M.height;X.ver<=3?(Re=new a.RawShaderMaterial({uniforms:{clippt1:{value:J},clippt2:{value:te},vieww:{value:at},viewh:{value:ze}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_CLIP,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:a.DoubleSide}),this._material_clip.push(Re)):Re=new a.RawShaderMaterial({vertexShader:m.MxShader.VSHADER_COLOR_POINT,fragmentShader:m.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:a.DoubleSide});for(var Ie=0;Ie<this._geometryMeshPostion.length;Ie++)(Me=new a.InstancedBufferGeometry).maxInstancedCount=z.length,Me.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPostion[Ie],2)),Me.setAttribute("color",new a.Float32BufferAttribute(this._geometryMeshColor[Ie],3)),Me.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(se),4)),Me.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ve),4)),Me.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),Me.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(we),4)),Me.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Be),1)),(Je=new a.Mesh(Me,Re)).frustumCulled=!1,Je.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(Je),this._entitys.push(Je),4<=X.ver&&0<X.instansClipePoints.length&&new H.MxStencilObject().associateObject(Je,X.instansClipePoints);for(Ie=0;Ie<this._geometryMeshPositionsByBlock.length;Ie++)(Me=new a.InstancedBufferGeometry).maxInstancedCount=z.length,Me.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByBlock[Ie],2)),Me.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(re),3)),Me.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(se),4)),Me.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ve),4)),Me.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),Me.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(we),4)),Me.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Be),1)),(Je=new a.Mesh(Me,Re)).frustumCulled=!1,Je.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(Je),this._entitys.push(Je),4<=X.ver&&0<X.instansClipePoints.length&&new H.MxStencilObject().associateObject(Je,X.instansClipePoints);for(Ie=0;Ie<this._geometryMeshPositionsByBlock_ZeroLayer.length;Ie++)(Me=new a.InstancedBufferGeometry).maxInstancedCount=z.length,Me.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByBlock_ZeroLayer[Ie],2)),Me.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(fe),3)),Me.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(se),4)),Me.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ve),4)),Me.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),Me.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(we),4)),Me.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Be),1)),(Je=new a.Mesh(Me,Re)).frustumCulled=!1,Je.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(Je),this._entitys.push(Je),4<=X.ver&&0<X.instansClipePoints.length&&new H.MxStencilObject().associateObject(Je,X.instansClipePoints);var ue=new a.RawShaderMaterial({uniforms:{color:{value:this._color},clippt1:{value:J},clippt2:{value:te},vieww:{value:at},viewh:{value:ze}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_BYLAYER_CLIP,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:a.DoubleSide});for(this._material_clip.push(ue),Ie=0;Ie<this._geometryMeshPositionsByLayer.length;Ie++){var Me,Je;(Me=new a.InstancedBufferGeometry).maxInstancedCount=z.length,Me.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByLayer[Ie],2)),Me.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(se),4)),Me.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ve),4)),Me.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),Me.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(we),4)),Me.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Be),1)),(Je=new a.Mesh(Me,ue)).frustumCulled=!1,Je.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(Je),this._entitys.push(Je),4<=X.ver&&0<X.instansClipePoints.length&&new H.MxStencilObject().associateObject(Je,X.instansClipePoints)}}},this)},Y.prototype.createThreejsObjForCurve_Clip=function(u,v,M){u.size!=0&&u.forEach(function(j,z,J){var te=j;if(te.length!=0){var X=[],se=[],ve=te[0].clipPlans;ve.ver<=3&&(X.push(ve.clipPlanArray[0].x1,ve.clipPlanArray[0].y1),se.push(ve.clipPlanArray[0].x2,ve.clipPlanArray[0].y2));for(var Ee=[],we=[],Be=[],re=[],fe=[],ne=[],le=[],Re=0;Re<te.length;Re++){var at=te[Re];Ee=Ee.concat(at.mat.elements.slice(0,4)),we=we.concat(at.mat.elements.slice(4,8)),Be=Be.concat(at.mat.elements.slice(8,12)),re=re.concat(at.mat.elements.slice(12,16)),fe.push(0)}if(0<this._geometryCurvePositionsByBlock.length)for(Re=0;Re<te.length;Re++)ne=ne.concat(te[Re].color);if(0<this._geometryCurvePositionsByBlock_ZeroLayer.length)for(Re=0;Re<te.length;Re++)le=le.concat(te[Re].topLayerColor);var ze,Ie=.5*M.width,ue=.5*M.height;ve.ver<=3?(ze=new a.RawShaderMaterial({uniforms:{clippt1:{value:X},clippt2:{value:se},vieww:{value:Ie},viewh:{value:ue}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_CLIP,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:a.DoubleSide}),this._material_clip.push(ze)):ze=new a.RawShaderMaterial({vertexShader:m.MxShader.VSHADER_COLOR_POINT,fragmentShader:m.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:a.DoubleSide});for(var Me=0;Me<this._geometryCurvePostion.length;Me++)($e=new a.InstancedBufferGeometry).maxInstancedCount=te.length,$e.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePostion[Me],2)),$e.setAttribute("color",new a.Float32BufferAttribute(this._geometryCurveColor[Me],3)),$e.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),$e.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(we),4)),$e.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Be),4)),$e.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(re),4)),$e.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(fe),1)),(ft=new a.LineSegments($e,ze)).frustumCulled=!1,ft.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(ft),this._entitys.push(ft),4<=ve.ver&&0<ve.instansClipePoints.length&&new H.MxStencilObject().associateObject(ft,ve.instansClipePoints);for(Me=0;Me<this._geometryCurvePositionsByBlock.length;Me++)($e=new a.InstancedBufferGeometry).maxInstancedCount=te.length,$e.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByBlock[Me],2)),$e.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(ne),3)),$e.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),$e.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(we),4)),$e.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Be),4)),$e.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(re),4)),$e.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(fe),1)),(ft=new a.LineSegments($e,ze)).frustumCulled=!1,ft.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(ft),this._entitys.push(ft),4<=ve.ver&&0<ve.instansClipePoints.length&&new H.MxStencilObject().associateObject(ft,ve.instansClipePoints);for(Me=0;Me<this._geometryCurvePositionsByBlock_ZeroLayer.length;Me++)($e=new a.InstancedBufferGeometry).maxInstancedCount=te.length,$e.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByBlock_ZeroLayer[Me],2)),$e.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(le),3)),$e.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),$e.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(we),4)),$e.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Be),4)),$e.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(re),4)),$e.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(fe),1)),(ft=new a.LineSegments($e,ze)).frustumCulled=!1,ft.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(ft),this._entitys.push(ft),4<=ve.ver&&0<ve.instansClipePoints.length&&new H.MxStencilObject().associateObject(ft,ve.instansClipePoints);var Je=new a.RawShaderMaterial({uniforms:{color:{value:this._color},clippt1:{value:X},clippt2:{value:se},vieww:{value:Ie},viewh:{value:ue}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_BYLAYER_CLIP,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_CLIP,linewidth:1,transparent:!0,side:a.DoubleSide});for(this._material_clip.push(Je),Me=0;Me<this._geometryCurvePositionsByLayer.length;Me++){var $e,ft;($e=new a.InstancedBufferGeometry).maxInstancedCount=te.length,$e.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByLayer[Me],2)),$e.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),$e.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(we),4)),$e.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Be),4)),$e.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(re),4)),$e.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(fe),1)),(ft=new a.LineSegments($e,Je)).frustumCulled=!1,ft.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(ft),this._entitys.push(ft),4<=ve.ver&&0<ve.instansClipePoints.length&&new H.MxStencilObject().associateObject(ft,ve.instansClipePoints)}}},this)},Y.prototype.createThreejsObjForCurve=function(u,v){if(u.length!=0){for(var M=[],j=[],z=[],J=[],te=[],X=[],se=[],ve=0;ve<u.length;ve++){var Ee=u[ve];M=M.concat(Ee.mat.elements.slice(0,4)),j=j.concat(Ee.mat.elements.slice(4,8)),z=z.concat(Ee.mat.elements.slice(8,12)),J=J.concat(Ee.mat.elements.slice(12,16)),te.push(0)}if(0<this._geometryCurvePositionsByBlock.length)for(ve=0;ve<u.length;ve++)X=X.concat(u[ve].color);if(0<this._geometryCurvePositionsByBlock_ZeroLayer.length)for(ve=0;ve<u.length;ve++)se=se.concat(u[ve].topLayerColor);for(var we=new a.RawShaderMaterial({vertexShader:m.MxShader.VSHADER_COLOR_POINT,fragmentShader:m.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:a.DoubleSide}),Be=0;Be<this._geometryCurvePostion.length;Be++)(fe=new a.InstancedBufferGeometry).maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePostion[Be],2)),fe.setAttribute("color",new a.Float32BufferAttribute(this._geometryCurveColor[Be],3)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(M),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(ne=new a.LineSegments(fe,we)).frustumCulled=!1,ne.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(ne),this._entitys.push(ne);for(Be=0;Be<this._geometryCurvePositionsByBlock.length;Be++)(fe=new a.InstancedBufferGeometry).maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByBlock[Be],2)),fe.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(X),3)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(M),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(ne=new a.LineSegments(fe,we)).frustumCulled=!1,ne.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(ne),this._entitys.push(ne);for(Be=0;Be<this._geometryCurvePositionsByBlock_ZeroLayer.length;Be++)(fe=new a.InstancedBufferGeometry).maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByBlock_ZeroLayer[Be],2)),fe.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(se),3)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(M),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(ne=new a.LineSegments(fe,we)).frustumCulled=!1,ne.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(ne),this._entitys.push(ne);var re=new a.RawShaderMaterial({uniforms:{color:{value:this._color}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_BYLAYER,fragmentShader:m.MxShader.FSHADER_COLOR_POINT,linewidth:1,transparent:!0,side:a.DoubleSide});for(Be=0;Be<this._geometryCurvePositionsByLayer.length;Be++){var fe,ne;(fe=new a.InstancedBufferGeometry).maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(this._geometryCurvePositionsByLayer[Be],2)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(M),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(ne=new a.LineSegments(fe,re)).frustumCulled=!1,ne.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(ne),this._entitys.push(ne)}}},Y.prototype.createThreejsObjForMemorySections_clip=function(u,v,M){u.size!=0&&u.forEach(function(j){var z=j;if(z.length!=0){for(var J=z[0].clipPlans,te=[],X=[],se=[],ve=[],Ee=[],we=0;we<z.length;we++){var Be=z[we];te.push.apply(te,Be.mat.elements.slice(0,4)),X.push.apply(X,Be.mat.elements.slice(4,8)),se.push.apply(se,Be.mat.elements.slice(8,12)),ve.push.apply(ve,Be.mat.elements.slice(12,16)),Ee.push(0)}for(var re=this._MemorySections.length,fe=0;fe<re;fe++){var ne=this._MemorySections[fe],le=M.automaticInversionColor2(ne.color),Re=[];if((4278190080&le)==16777216?Re=this._color:Re.push((255&le)/255,(le>>8&255)/255,(le>>16&255)/255),ne.type==k.kLinesType){var at=new a.RawShaderMaterial({uniforms:{color:{value:Re}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_FORMXCAD,linewidth:1,transparent:!0,side:a.DoubleSide});(Ie=new a.InstancedBufferGeometry).maxInstancedCount=z.length,Ie.setAttribute("position",new a.Float32BufferAttribute(ne.points,3)),Ie.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(te),4)),Ie.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(X),4)),Ie.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(se),4)),Ie.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(ve),4)),Ie.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Ee),1)),(ue=new a.LineSegments(Ie,at)).frustumCulled=!1,ue.renderOrder=x.MxData.iCADCurveRenderOrder,4<=J.ver&&0<J.instansClipePoints.length&&new H.MxStencilObject().associateObject(ue,J.instansClipePoints),v.add(ue),this._entitys.push(ue)}else if(ne.type==k.kTriangleType){at=new a.RawShaderMaterial({uniforms:{color:{value:Re}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:a.DoubleSide}),(Ie=new a.InstancedBufferGeometry).maxInstancedCount=z.length,Ie.setAttribute("position",new a.Float32BufferAttribute(ne.points,3)),Ie.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(te),4)),Ie.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(X),4)),Ie.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(se),4)),Ie.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(ve),4)),Ie.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Ee),1));var ze=new a.Mesh(Ie,at);ze.frustumCulled=!1,ze.renderOrder=x.MxData.iCADMeshRenderOrder,4<=J.ver&&0<J.instansClipePoints.length&&new H.MxStencilObject().associateObject(ze,J.instansClipePoints),v.add(ze),this._entitys.push(ze)}else if(ne.type==k.kPointType){var Ie,ue;at=new a.RawShaderMaterial({uniforms:{color:{value:Re}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:a.DoubleSide}),(Ie=new a.InstancedBufferGeometry).maxInstancedCount=z.length,Ie.setAttribute("position",new a.Float32BufferAttribute(ne.points,3)),Ie.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(te),4)),Ie.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(X),4)),Ie.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(se),4)),Ie.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(ve),4)),Ie.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Ee),1)),(ue=new a.Points(Ie,at)).frustumCulled=!1,ue.renderOrder=x.MxData.iCADCurveRenderOrder,4<=J.ver&&0<J.instansClipePoints.length&&new H.MxStencilObject().associateObject(ue,J.instansClipePoints),v.add(ue),this._entitys.push(ue)}}}},this)},Y.prototype.createThreejsObjForMemorySections=function(u,v,M){if(u.length!=0){for(var j=[],z=[],J=[],te=[],X=[],se=0;se<u.length;se++){var ve=u[se];j.push.apply(j,ve.mat.elements.slice(0,4)),z.push.apply(z,ve.mat.elements.slice(4,8)),J.push.apply(J,ve.mat.elements.slice(8,12)),te.push.apply(te,ve.mat.elements.slice(12,16)),X.push(0)}for(var Ee=this._MemorySections.length,we=0;we<Ee;we++){var Be=this._MemorySections[we],re=M.automaticInversionColor2(Be.color),fe=[];if((4278190080&re)==16777216?(fe=this._color,this._colorValue):fe.push((255&re)/255,(re>>8&255)/255,(re>>16&255)/255),Be.type==k.kLinesType){var ne=new a.RawShaderMaterial({uniforms:{color:{value:fe}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_FORMXCAD,linewidth:1,transparent:!0,side:a.DoubleSide});(Re=new a.InstancedBufferGeometry).maxInstancedCount=u.length,Re.setAttribute("position",new a.Float32BufferAttribute(Be.points,3)),Re.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(j),4)),Re.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(z),4)),Re.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(J),4)),Re.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(te),4)),Re.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(X),1)),(at=new a.LineSegments(Re,ne)).frustumCulled=!1,at.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(at),this._entitys.push(at)}else if(Be.type==k.kTriangleType){ne=new a.RawShaderMaterial({uniforms:{color:{value:fe}},vertexShader:m.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:a.DoubleSide}),(Re=new a.InstancedBufferGeometry).maxInstancedCount=u.length,Re.setAttribute("position",new a.Float32BufferAttribute(Be.points,3)),Re.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(j),4)),Re.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(z),4)),Re.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(J),4)),Re.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(te),4)),Re.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(X),1));var le=new a.Mesh(Re,ne);le.frustumCulled=!1,le.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(le),this._entitys.push(le)}else if(Be.type==k.kPointType){var Re,at;ne=new a.RawShaderMaterial({uniforms:{color:{value:fe},size:1},vertexShader:m.MxShader.VSHADER_COLOR_POINT_FORMXCAD,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_FORMXCAD,transparent:!0,side:a.DoubleSide}),(Re=new a.InstancedBufferGeometry).maxInstancedCount=u.length,Re.setAttribute("position",new a.Float32BufferAttribute(Be.points,3)),Re.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(j),4)),Re.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(z),4)),Re.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(J),4)),Re.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(te),4)),Re.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(X),1)),(at=new a.Points(Re,ne)).frustumCulled=!1,at.renderOrder=x.MxData.iCADCurveRenderOrder,v.add(at),this._entitys.push(at)}}}},Y.prototype.createThreejsObjForTexture=function(u,v,M){if(u.length!=0){var j=[],z=[],J=[],te=[],X=[],se=M.getCurrentLoadUrl(),ve=F.MxFun.dwgDir();ve.length!=0&&se.substring(se.lastIndexOf("/buf/")).toLowerCase()!="/buf/"&&(se=se+ve+"/buf/");for(var Ee=0;Ee<u.length;Ee++){var we=u[Ee];j=j.concat(we.mat.elements.slice(0,4)),z=z.concat(we.mat.elements.slice(4,8)),J=J.concat(we.mat.elements.slice(8,12)),te=te.concat(we.mat.elements.slice(12,16)),X.push(0)}for(var Be=0;Be<this._TextureData.length;Be++){var re=this._TextureData[Be],fe=new a.InstancedBufferGeometry;fe.maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(re.pos,2)),fe.setAttribute("uv",new a.Float32BufferAttribute(re.textureCoord,2)),fe.setAttribute("color",new a.Float32BufferAttribute(re.color,3)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(te),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(X),1));var ne=se+re.sFileName,le={texture:{value:new a.TextureLoader().load(ne,function(ze){ze&&M.updateDisplay()})}};le.texture.value.wrapS=le.texture.value.wrapT=a.RepeatWrapping;var Re=new a.RawShaderMaterial({uniforms:le,vertexShader:m.MxShader.VSHADER_COLOR_POINT_TEXTURE,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_TEXTURE,transparent:!0,side:a.DoubleSide}),at=new a.Mesh(fe,Re);at.renderOrder=x.MxData.iCADMeshRenderOrder,at.frustumCulled=!1,v.add(at),this._entitys.push(at)}}},Y.prototype.createThreejsObjForTexture_Clip=function(u,v,M){if(u.size!=0){var j=M.getCurrentLoadUrl(),z=F.MxFun.dwgDir();z.length!=0&&j.substring(j.lastIndexOf("/buf/")).toLowerCase()!="/buf/"&&(j=j+z+"/buf/"),u.forEach(function(J){var te=J;if(te.length!=0){for(var X=te[0].clipPlans,se=[],ve=[],Ee=[],we=[],Be=[],re=0;re<te.length;re++){var fe=te[re];se=se.concat(fe.mat.elements.slice(0,4)),ve=ve.concat(fe.mat.elements.slice(4,8)),Ee=Ee.concat(fe.mat.elements.slice(8,12)),we=we.concat(fe.mat.elements.slice(12,16)),Be.push(0)}for(var ne=0;ne<this._TextureData.length;ne++){var le=this._TextureData[ne],Re=new a.InstancedBufferGeometry;Re.maxInstancedCount=te.length,Re.setAttribute("position",new a.Float32BufferAttribute(le.pos,2)),Re.setAttribute("uv",new a.Float32BufferAttribute(le.textureCoord,2)),Re.setAttribute("color",new a.Float32BufferAttribute(le.color,3)),Re.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(se),4)),Re.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(ve),4)),Re.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(Ee),4)),Re.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(we),4)),Re.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(Be),1));var at=j+le.sFileName,ze={texture:{value:new a.TextureLoader().load(at,function(Me){Me&&M.updateDisplay()})}};ze.texture.value.wrapS=ze.texture.value.wrapT=a.RepeatWrapping;var Ie=new a.RawShaderMaterial({uniforms:ze,vertexShader:m.MxShader.VSHADER_COLOR_POINT_TEXTURE,fragmentShader:m.MxShader.FSHADER_COLOR_POINT_TEXTURE,transparent:!0,side:a.DoubleSide}),ue=new a.Mesh(Re,Ie);ue.renderOrder=x.MxData.iCADMeshRenderOrder,ue.frustumCulled=!1,4<=X.ver&&0<X.instansClipePoints.length&&new H.MxStencilObject().associateObject(ue,X.instansClipePoints),v.add(ue),this._entitys.push(ue)}}},this)}},Y.prototype.createThreejsObjForMesh=function(u,v){if(u.length!=0){for(var M=[],j=[],z=[],J=[],te=[],X=[],se=[],ve=0;ve<u.length;ve++){var Ee=u[ve];M=M.concat(Ee.mat.elements.slice(0,4)),j=j.concat(Ee.mat.elements.slice(4,8)),z=z.concat(Ee.mat.elements.slice(8,12)),J=J.concat(Ee.mat.elements.slice(12,16)),te.push(0),X=X.concat(u[ve].color)}if(0<this._geometryMeshPositionsByBlock.length)for(ve=0;ve<u.length;ve++)X=X.concat(u[ve].color);if(0<this._geometryMeshPositionsByBlock_ZeroLayer.length)for(ve=0;ve<u.length;ve++)se=se.concat(u[ve].topLayerColor);for(var we=new a.RawShaderMaterial({vertexShader:m.MxShader.VSHADER_COLOR_POINT,fragmentShader:m.MxShader.FSHADER_COLOR_POINT,transparent:!0,side:a.DoubleSide}),Be=0;Be<this._geometryMeshPostion.length;Be++)(fe=new a.InstancedBufferGeometry).maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPostion[Be],2)),fe.setAttribute("color",new a.Float32BufferAttribute(this._geometryMeshColor[Be],3)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(M),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(ne=new a.Mesh(fe,we)).frustumCulled=!1,ne.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(ne),this._entitys.push(ne);for(Be=0;Be<this._geometryMeshPositionsByBlock.length;Be++)(fe=new a.InstancedBufferGeometry).maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByBlock[Be],2)),fe.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(X),3)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(M),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(ne=new a.Mesh(fe,we)).frustumCulled=!1,ne.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(ne),this._entitys.push(ne);for(Be=0;Be<this._geometryMeshPositionsByBlock_ZeroLayer.length;Be++)(fe=new a.InstancedBufferGeometry).maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByBlock_ZeroLayer[Be],2)),fe.setAttribute("color",new a.InstancedBufferAttribute(new Float32Array(se),3)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(M),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(ne=new a.Mesh(fe,we)).frustumCulled=!1,ne.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(ne),this._entitys.push(ne);var re=new a.RawShaderMaterial({uniforms:{color:{value:this._color}},vertexShader:m.MxShader.VSHADER_COLOR_POINT,fragmentShader:m.MxShader.FSHADER_COLOR_POINT,transparent:!0,side:a.DoubleSide});for(Be=0;Be<this._geometryMeshPositionsByLayer.length;Be++){var fe,ne;(fe=new a.InstancedBufferGeometry).maxInstancedCount=u.length,fe.setAttribute("position",new a.Float32BufferAttribute(this._geometryMeshPositionsByLayer[Be],2)),fe.setAttribute("tran1",new a.InstancedBufferAttribute(new Float32Array(M),4)),fe.setAttribute("tran2",new a.InstancedBufferAttribute(new Float32Array(j),4)),fe.setAttribute("tran3",new a.InstancedBufferAttribute(new Float32Array(z),4)),fe.setAttribute("tran4",new a.InstancedBufferAttribute(new Float32Array(J),4)),fe.setAttribute("ishide",new a.InstancedBufferAttribute(new Float32Array(te),1)),(ne=new a.Mesh(fe,re)).frustumCulled=!1,ne.renderOrder=x.MxData.iCADMeshRenderOrder,v.add(ne),this._entitys.push(ne)}}},Y.prototype.addGeometryCurve=function(u,v,M,j,z){0<u.length&&(this._geometryCurvePostion.push(u),this._geometryCurveColor.push(v)),0<M.length&&this._geometryCurvePositionsByBlock.push(M),0<j.length&&this._geometryCurvePositionsByLayer.push(j),0<z.length&&this._geometryCurvePositionsByBlock_ZeroLayer.push(z)},Y.prototype.addGeometryMesh=function(u,v,M,j,z){0<u.length&&(this._geometryMeshPostion.push(u),this._geometryMeshColor.push(v)),0<M.length&&this._geometryMeshPositionsByBlock.push(M),0<j.length&&this._geometryMeshPositionsByLayer.push(j),0<z.length&&this._geometryMeshPositionsByBlock_ZeroLayer.push(z)},Y.prototype.addGeometryTexture=function(u,v,M,j,z,J,te){var X=new C;X.pos=u,X.textureCoord=v,X.color=M,X.sFileName=j,X.dAngel=z,X.ptRotationPostionX=J,X.ptRotationPostionY=te,this._TextureData.push(X)},Y.prototype.addMemorySections=function(u){this._MemorySections.push(u)},Y.prototype.createThreejsObj=function(u,v,M,j,z){var J=M.getScene(),te=M.getCanvas();if(u.length!=0){if(this._color==null){var X=j.getColor(z);this._color=[],this._color.push((255&X)/255,(X>>8&255)/255,(X>>16&255)/255),this._colorValue=16777215&X}this._geometryCurvePostion.length==0&&this._geometryCurvePositionsByBlock.length==0&&this._geometryCurvePositionsByLayer.length==0&&this._geometryCurvePositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForCurve(u,J),this._geometryMeshPostion.length==0&&this._geometryMeshPositionsByBlock.length==0&&this._geometryMeshPositionsByLayer.length==0&&this._geometryMeshPositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForMesh(u,J),this._TextureData.length!=0&&this.createThreejsObjForTexture(u,J,M),this._MemorySections.length!=0&&this.createThreejsObjForMemorySections(u,J,M)}v.size!=0&&(this._color==null&&(X=j.getColor(z),this._color=[],this._color.push((255&X)/255,(X>>8&255)/255,(X>>16&255)/255),this._colorValue=16777215&X),this._geometryCurvePostion.length==0&&this._geometryCurvePositionsByBlock.length==0&&this._geometryCurvePositionsByLayer.length==0&&this._geometryCurvePositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForCurve_Clip(v,J,te),this._geometryMeshPostion.length==0&&this._geometryMeshPositionsByBlock.length==0&&this._geometryMeshPositionsByLayer.length==0&&this._geometryMeshPositionsByBlock_ZeroLayer.length==0||this.createThreejsObjForMesh_Clip(v,J,te),this._TextureData.length!=0&&this.createThreejsObjForTexture_Clip(v,J,M),this._MemorySections.length!=0&&this.createThreejsObjForMemorySections_clip(v,J,M)),this._geometryCurvePostion=[],this._geometryCurvePositionsByBlock=[],this._geometryCurvePositionsByLayer=[],this._geometryCurvePositionsByBlock_ZeroLayer=[],this._geometryCurveColor=[],this._geometryMeshPostion=[],this._geometryMeshPositionsByBlock=[],this._geometryMeshPositionsByLayer=[],this._geometryMeshPositionsByBlock_ZeroLayer=[],this._geometryMeshColor=[],this._TextureData=[],this._MemorySections=[]},Y);function Y(u){this._blockRecId=0,this._TextureData=[],this._MemorySections=[],this._geometryCurvePostion=new Array,this._geometryCurveColor=new Array,this._geometryMeshPostion=new Array,this._geometryMeshColor=new Array,this._geometryCurvePositionsByBlock=new Array,this._geometryMeshPositionsByBlock=new Array,this._geometryCurvePositionsByLayer=new Array,this._geometryMeshPositionsByLayer=new Array,this._geometryCurvePositionsByBlock_ZeroLayer=new Array,this._geometryMeshPositionsByBlock_ZeroLayer=new Array,this._entitys=new Array,this._color=void 0,this._colorValue=16777215,this._material_clip=[],this._blockRecId=u}o.Layer=S;var G=(T.prototype.showLayer=function(u,v){var M=this._layerTogeometry.get(u);M!=null&&M.Show(v)},T.prototype.updataClipMaterial=function(u){var v=u.getCanvas();this._layerTogeometry.forEach(function(M,j,z){M.updataClipMaterial(v)})},T.prototype.getId=function(){return this._id},T.prototype.getBlkRef=function(){return this._blkRef},T.prototype.createThreejsObj=function(u,v){var M=this;this._layerTogeometry.forEach(function(j,z,J){j.createThreejsObj(M._instance,M._instance_clip,u,v,z)})},T.prototype.addGeometryCurve=function(u,v,M,j,z,J){var te=this._layerTogeometry.get(M);te==null&&(te=new S(this._id),this._layerTogeometry.set(M,te)),te.addGeometryCurve(u,v,j,z,J)},T.prototype.addMemorySections=function(u){var v=this._layerTogeometry.get(u.layerId);v==null&&(v=new S(this._id),this._layerTogeometry.set(u.layerId,v)),v.addMemorySections(u)},T.prototype.addGeometryTexture=function(u,v,M,j,z,J,te,X){var se=this._layerTogeometry.get(j);se==null&&(se=new S(this._id),this._layerTogeometry.set(j,se)),se.addGeometryTexture(u,v,M,z,J,te,X)},T.prototype.addGeometryMesh=function(u,v,M,j,z,J){var te=this._layerTogeometry.get(M);te==null&&(te=new S(this._id),this._layerTogeometry.set(M,te)),te.addGeometryMesh(u,v,j,z,J)},T.prototype.addInstance=function(u){var v;u.clipPlans.ver<=3?u.clipPlans.clipPlanArray.length==0?this._instance.length<5e4&&this._instance.push(u):((v=this._instance_clip.get(u.clipPlans.id))==null&&(v=[],this._instance_clip.set(u.clipPlans.id,v)),v.push(u)):u.clipPlans.instansClipePoints.length==0||100<this._instance_clip.size?this._instance.length<5e4&&this._instance.push(u):((v=this._instance_clip.get(u.clipPlans.id))==null&&(v=[],this._instance_clip.set(u.clipPlans.id,v)),v.push(u))},T.prototype.addBlkRef=function(u){this._blkRef.push(u)},T);function T(u){this._id=0,this._layerTogeometry=new Map,this._blkRef=[],this._instance=[],this._instance_clip=new Map,this._id=u}o.Block=G;var B=(D.prototype.crateBlock=function(u){var v=this._mapBlock.get(u);return v==null&&(v=new G(u),this._mapBlock.set(u,v)),v},D.prototype.getBlock=function(u){return this._mapBlock.get(u)},D.prototype.addBlockRef=function(u){this.crateBlock(u.blkOwnerId).addBlkRef(u)},D.prototype.showLayer=function(u,v){this._mapBlock.forEach((function(M,j){var z=M,J=j;return function(te,X,se){te.showLayer(z,J)}}).call(this,u,v))},D.prototype.createBlocks_30=function(u,v){if(!this._isCreate){this.crateBlock(0);for(var M=1,j=u.getInt32(12,!0),z=80,J=0;J<j;J++){var te=u.getInt32(z,!0);z+=4;var X=u.getInt32(z,!0);z+=4;var se=u.getInt32(z,!0);z+=4;var ve=u.getInt32(z,!0);z+=4;for(var Ee=new Array,we=0;we<16;we++){var Be=u.getFloat32(z,!0);z+=4,Ee.push(Be)}var re=u.getInt32(z,!0);z+=4;var fe=new g;fe.id=M,fe.ver=3,M++,fe.clipPlanArray=[];for(var ne=0;ne<re;ne++){var le=u.getFloat32(z,!0);z+=4;var Re=u.getFloat32(z,!0);z+=4;var at=u.getFloat32(z,!0);z+=4;var ze=u.getFloat32(z,!0);z+=4;var Ie=new P;Ie.x1=le,Ie.y1=Re,Ie.x2=at,Ie.y2=ze,fe.clipPlanArray.push(Ie)}var ue=new E;ue.ver=3,ue.mat=new a.Matrix4,ue.mat.fromArray(Ee),ue.blkRecId=se,ue.blkOwnerId=te,ue.layerId=X,ue.color=ve,ue.clipPlans=fe,this.crateBlock(se),this.addBlockRef(ue)}this._isGetAllBlocks=!0,this._isCreate=!0}},D.prototype.createBlocks_40=function(u,v){if(!this._isCreate){this.crateBlock(0);for(var M=1,j=u.getInt32(12,!0),z=80,J=0;J<j;J++){var te=u.getInt32(z,!0);z+=4;var X=u.getInt32(z,!0);z+=4;var se=u.getInt32(z,!0);z+=4;var ve=u.getInt32(z,!0);z+=4;for(var Ee=new Array,we=0;we<16;we++){var Be=u.getFloat32(z,!0);z+=4,Ee.push(Be)}var re=u.getInt32(z,!0);z+=4;var fe=new g;fe.id=M,fe.ver=4,M++,fe.clipPoints=[];for(var ne=0;ne<re;ne++){var le=new a.Vector2;le.x=u.getFloat32(z,!0),z+=4,le.y=u.getFloat32(z,!0),z+=4,fe.clipPoints.push(le)}var Re=new E;Re.ver=4,Re.mat=new a.Matrix4,Re.mat.fromArray(Ee),Re.blkRecId=se,Re.blkOwnerId=te,Re.layerId=X,Re.color=ve,Re.clipPlans=fe,this.crateBlock(se),this.addBlockRef(Re)}this._isGetAllBlocks=!0,this._isCreate=!0}},D.prototype.createBlocks=function(u,v){this._isCreate||(new A.MxNetData(u).getVersion_MwBlobHead()<=3?this.createBlocks_30(u,v):this.createBlocks_40(u,v))},D.prototype.updataClipMaterial=function(u){this._mapBlock.forEach(function(v,M,j){v.updataClipMaterial(u)})},D.prototype.createAllInstance=function(u){var v=this.getBlock(0);if(v==null||this._rootBlockRef==null)return!1;var M=new a.Matrix4,j=new Map,z=new g;return this._iClipIdCount=1,z.id=this._iClipIdCount,this._iClipIdCount++,this.createAllInstanceCall(v,this._rootBlockRef,M,j,16777215,u,void 0,z),!0},D.prototype.createThreejsObj=function(u,v,M){this._mapNeedCreateThreejsObj.get(u.getId())==null&&this._mapNeedCreateThreejsObj.set(u.getId(),u),this._isCreateAllInstance||this._isGetAllBlocks&&M.isInitComplete()&&(this._isCreateAllInstance=this.createAllInstance(M)),this._isCreateAllInstance&&(this._mapNeedCreateThreejsObj.forEach(function(j,z,J){j.createThreejsObj(v,M)}),this._mapNeedCreateThreejsObj.clear())},D.prototype.createAllInstanceCall=function(u,v,M,j,z,J,te,X){if(j[u.getId()]!=1){j[u.getId()]=!0;var se=new _;if(se.mat=new a.Matrix4,se.mat.copy(M),se.mat.multiply(v.mat),v.ver<=3)if(v.clipPlans.clipPlanArray.length==0)se.clipPlans=X;else{se.clipPlans=v.clipPlans,se.clipPlans.ver=3;for(var ve,Ee,we,Be,re=se.clipPlans.clipPlanArray.length,fe=function(){ve=new a.Vector3(se.clipPlans.clipPlanArray[ne].x1,se.clipPlans.clipPlanArray[ne].y1,0),Ee=new a.Vector3(se.clipPlans.clipPlanArray[ne].x2,se.clipPlans.clipPlanArray[ne].y2,0),we=new a.Vector3(se.clipPlans.clipPlanArray[ne].x1,se.clipPlans.clipPlanArray[ne].y2,0),Be=new a.Vector3(se.clipPlans.clipPlanArray[ne].x2,se.clipPlans.clipPlanArray[ne].y1,0),ve.applyMatrix4(se.mat),Ee.applyMatrix4(se.mat),we.applyMatrix4(se.mat),Be.applyMatrix4(se.mat);var ft=ve.x,Pt=ve.x,_t=ve.y,Ue=ve.y,Rt=[];Rt.push(Ee),Rt.push(we),Rt.push(Be),Rt.forEach(function(It){ft>It.x&&(ft=It.x),Pt<It.x&&(Pt=It.x),_t>It.y&&(_t=It.y),Ue<It.y&&(Ue=It.y)}),se.clipPlans.clipPlanArray[ne].x1=ft,se.clipPlans.clipPlanArray[ne].y1=_t,se.clipPlans.clipPlanArray[ne].x2=Pt,se.clipPlans.clipPlanArray[ne].y2=Ue},ne=0;ne<re;ne++)fe()}else if(v.clipPlans.clipPoints.length==0)se.clipPlans=X;else{se.clipPlans=new g,se.clipPlans.ver=4,se.clipPlans.id=this._iClipIdCount,this._iClipIdCount++,se.clipPlans.instansClipePoints=X.instansClipePoints.slice(0);var le=[],Re=v.clipPlans.clipPoints;for(re=Re.length,ne=0;ne<re;ne++){var at=new a.Vector3(Re[ne].x,Re[ne].y,0);at.applyMatrix4(se.mat),le.push(new a.Vector2(at.x,at.y))}se.clipPlans.instansClipePoints.push(le)}te==null?se.topLayerColor.push(1,1,1):se.topLayerColor.push(te[0],te[1],te[2]);var ze=v.color>>24&255;if(ze==2)se.color.push((255&z)/255,(z>>8&255)/255,(z>>16&255)/255);else if(ze==1){var Ie=J.getColor(v.layerId);se.color.push((255&Ie)/255,(Ie>>8&255)/255,(Ie>>16&255)/255),z=Ie}else se.color.push((255&v.color)/255,(v.color>>8&255)/255,(v.color>>16&255)/255),z=v.color;u.addInstance(se);for(var ue=u.getBlkRef(),Me=te==null,Je=0;Je<ue.length;Je++)if(ue[Je].blkRecId!=0){var $e=this.getBlock(ue[Je].blkRecId);if($e==null)return;Me&&(te=[],Ie=J.getColor(ue[Je].layerId),te.push((255&Ie)/255,(Ie>>8&255)/255,(Ie>>16&255)/255)),this.createAllInstanceCall($e,ue[Je],se.mat,j,z,J,te,se.clipPlans)}j[u.getId()]=!1}},D.prototype.initRootBlockRef=function(u){u==null&&((u=new E).mat=new a.Matrix4,u.blkRecId=0,u.blkOwnerId=-1,u.layerId=-1,u.color=16777215),this._rootBlockRef=u},D);function D(){this._mapBlock=new Map,this._mapNeedCreateThreejsObj=new Map,this._isCreate=!1,this._isGetAllBlocks=!1,this._isCreateAllInstance=!1,this._rootBlockRef=void 0,this._iClipIdCount=1}o.Blocks=B;var N=function(){this.blocks=new B,this.layers=new c.MxBrowseLayerData};o.ExternalReferenceDatabase=N;var I=(h.prototype.createTzDwgExternalReferences=function(u){this._mapId2ExternalDatabase.get(u)||this.getBlocks(u).initRootBlockRef()},h.prototype.createExternalReferences=function(u){for(var v=u.getInt32(12,!0),M=80,j=0;j<v;j++){for(var z=new Array,J=0;J<16;J++){var te=u.getFloat32(M,!0);M+=4,z.push(te)}var X=u.getInt32(M,!0);M+=4;var se=u.getInt32(M,!0);if(M+=4,u.getInt32(M,!0),M+=4,X!=0){var ve=this.getBlocks(X),Ee=new E;Ee.mat=new a.Matrix4,Ee.mat.fromArray(z),Ee.blkRecId=0,Ee.blkOwnerId=-1,Ee.layerId=-1,Ee.color=se,ve.initRootBlockRef(Ee)}else console.log("mx error iDatabaseIndex")}},h.prototype.getBlocks=function(u){if(u!=0){var v=this._mapId2ExternalDatabase.get(u);return v==null&&(v=new N,this._mapId2ExternalDatabase.set(u,v)),v.blocks}console.log("mx error iDatabaseIndex")},h.prototype.getLayers=function(u){if(u!=0){var v=this._mapId2ExternalDatabase.get(u);return v==null&&(v=new N,this._mapId2ExternalDatabase.set(u,v)),v.layers}console.log("mx error iDatabaseIndex")},h);function h(){this._mapId2ExternalDatabase=new Map}o.ExternalReferenceManager=I},{"../MxFun":27,"../MxManager":29,"../MxNetData":31,"../MxShader":32,"../MxStencilObject":33,"./MxBrowseLayerData":67,three:19}],67:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxBrowseLayerData=void 0;var a=(m.prototype.add=function(c,x,A){this._layerColor[c]=x,this._nametoId[A]=c},m.prototype.setZeroLayerId=function(c){this._zeroLayerId=c},m.prototype.getZeroLayerId=function(){return this._zeroLayerId},m.prototype.getLayerIdForName=function(c){return this._nametoId[c]==null?0:this._nametoId[c]},m.prototype.getColor=function(c){return this._layerColor[c]==null?16777215:this._layerColor[c]},m.prototype.initComplete=function(){this._isSetInstanceComplete=!0},m.prototype.isInitComplete=function(){return this._isSetInstanceComplete},m);function m(){this._isSetInstanceComplete=!1,this._layerColor=new Map,this._nametoId=new Map,this._zeroLayerId=0}o.MxBrowseLayerData=a},{}],68:[function(b,n,o){var a=this&&this.__awaiter||function(S,Y,G,T){return new(G=G||Promise)(function(B,D){function N(u){try{h(T.next(u))}catch(v){D(v)}}function I(u){try{h(T.throw(u))}catch(v){D(v)}}function h(u){var v;u.done?B(u.value):((v=u.value)instanceof G?v:new G(function(M){M(v)})).then(N,I)}h((T=T.apply(S,Y||[])).next())})},m=this&&this.__generator||function(S,Y){var G,T,B,D={label:0,sent:function(){if(1&B[0])throw B[1];return B[1]},trys:[],ops:[]},N=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return N.next=I(0),N.throw=I(1),N.return=I(2),typeof Symbol=="function"&&(N[Symbol.iterator]=function(){return this}),N;function I(h){return function(u){return function(v){if(G)throw new TypeError("Generator is already executing.");for(;N&&v[N=0]&&(D=0),D;)try{if(G=1,T&&(B=2&v[0]?T.return:v[0]?T.throw||((B=T.return)&&B.call(T),0):T.next)&&!(B=B.call(T,v[1])).done)return B;switch(T=0,B&&(v=[2&v[0],B.value]),v[0]){case 0:case 1:B=v;break;case 4:return D.label++,{value:v[1],done:!1};case 5:D.label++,T=v[1],v=[0];continue;case 7:v=D.ops.pop(),D.trys.pop();continue;default:if(!(B=0<(B=D.trys).length&&B[B.length-1])&&(v[0]===6||v[0]===2)){D=0;continue}if(v[0]===3&&(!B||v[1]>B[0]&&v[1]<B[3])){D.label=v[1];break}if(v[0]===6&&D.label<B[1]){D.label=B[1],B=v;break}if(B&&D.label<B[2]){D.label=B[2],D.ops.push(v);break}B[2]&&D.ops.pop(),D.trys.pop();continue}v=Y.call(S,D)}catch(M){v=[6,M],T=0}finally{G=B=0}if(5&v[0])throw v[1];return{value:v[0]?v[1]:void 0,done:!0}}([h,u])}}};Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbDatabase=void 0;var c=b("three"),x=b("../MxFun"),A=b("./MxDbEntity"),H=b("./MxDbEntityGrip"),F=b("./MxDbEntitySelect"),P=b("../MxManager"),g=b("../MxType"),E=b("./MxDbLayerTable"),_=b("./MxDbGroup"),k=b("../MxTools"),U=(C.prototype.getAllEntity=function(){return this.mapIdToEntity},C.prototype.getGroupDictionary=function(){return this.groupDictionary},C.prototype.regenAllMxDbEntity=function(){return this.mapIdToEntity.forEach(function(S){S.upDisplay(),S.setDirtyDisplay(!1)}),!0},C.prototype.upDirtyDisplay=function(){var S=!1;return this.mapIdToEntity.forEach(function(Y){Y.getDirtyDisplay()&&(Y.upDisplay(),Y.setDirtyDisplay(!1),S=!0)}),S},C.prototype.onViewChange=function(){var S=!1;return this.mapIdToEntity.forEach(function(Y){Y.onViewChange()&&(S=!0)}),S},C.prototype.toJsonObject=function(S){var Y={ver:1},G=new c.Vector3(0,0,0),T=new c.Vector3(this.mxObj.getViewWidth(),this.mxObj.getViewHeight(),0),B=g.MxType.MxCloneType.kMxFileClone;S&&(B=g.MxType.MxCloneType.kSaveDwgClone);var D=this.mxObj.screenCoord2Current(G.x,G.y,0),N=this.mxObj.screenCoord2Current(T.x,T.y,0);Y.view={ptView1:D,ptView2:N};var I=[];return this.mapNameToLayer.forEach(function(h){var u={type:B};h.dwgOut(u),u.TypeName="MxDbLayerTableRecord",I.push(u)}),Y.layers=I,this.groupDictionary.dwgOut(Y),Y},C.prototype.saveJson=function(S){var Y=this,G=this.toJsonObject(S),T=g.MxType.MxCloneType.kMxFileClone;S&&(T=g.MxType.MxCloneType.kSaveDwgClone);var B=[];return this.mapIdToEntity.forEach(function(D){var N=D.getUserObject(),I={type:T};N.dwgOut(I),I.TypeName=N.getTypeName(),I.group=Y.groupDictionary.getEntityInGroupName(D.objectId()),B.push(I)}),G.entitys=B,G},C.prototype.reInit=function(){this.eraseAllEntity(),this.groupDictionary=new _.MxDbGroupDictionary;var S=this.parentObject.matrix;this.init(this.mxObj),this.initObjectMatrix(S)},C.prototype.init=function(S){this.mxObj=S,this.scene=S.getScene(),x.MxFun.removeThreejsObject(this.parentObject,this.scene),x.MxFun.removeThreejsObject(this.parentObject_SmallCoord,this.scene),this.parentObject=new c.Object3D,this.parentObject.renderOrder=P.MxData.iMxEntityRenderOrder,this.scene.add(this.parentObject),this.parentObject_SmallCoord=new c.Object3D,this.parentObject_SmallCoord.renderOrder=P.MxData.iMxEntityRenderOrder,this.scene.add(this.parentObject_SmallCoord),this.initLayerTable()},C.prototype.loadJson=function(S){return a(this,void 0,void 0,function(){var Y,G,T,B,D,N,I,h,u,v,M=this;return m(this,function(j){switch(j.label){case 0:if(this.reInit(),(Y=S).view&&(G=Y.view,this.mxObj.zoomW(new c.Vector3(G.ptView1.x,G.ptView1.y,0),new c.Vector3(G.ptView2.x,G.ptView2.y,0),!1)),T=Y.layers)for(B=T.length,v=0;v<B;v++)D=T[v],this.addLayer(D.name).dwgIn(D);this.groupDictionary.dwgIn(Y),N=Y.entitys,I=N.length,h=function(z){var J,te,X,se;return m(this,function(ve){switch(ve.label){case 0:return J=N[z],[4,P.MxManager.getMxDbEntityClassHierarchy().createMxEntity(J.TypeName)];case 1:return(te=ve.sent())?(te.dwgIn(J),(X=new A.MxDbEntity).initUserObject(te),u.addEntityImp(X),(se=J.group)&&0<se.length&&se.forEach(function(Ee){M.groupDictionary.add(Ee).append(X.objectId())}),[2]):[2,"continue"]}})},u=this,v=0,j.label=1;case 1:return v<I?[5,h(v)]:[3,4];case 2:j.sent(),j.label=3;case 3:return v++,[3,1];case 4:return[2,new Promise(function(z){z(!0)})]}})})},C.prototype.getMxObject=function(){return this.mxObj},C.prototype.getGripManager=function(){return this.gripManager},C.prototype.getSelectManager=function(){return this.selectManager},C.prototype.clearMxCurrentSelect=function(){var S=!1;return this.gripManager.removeAllGrips()&&(S=!0),this.selectManager.removeAllEntity()&&(S=!0),S},C.prototype.eraseAllEntity=function(){this.mapIdToEntity.forEach(function(S){S.clearDisplayImp()}),this.mapIdToEntity=new Map,this.clearMxCurrentSelect()},C.prototype.initObjectMatrix=function(S){this.parentObject.matrix=S,this.parentObject.matrixAutoUpdate=!1,this.parentObject_SmallCoord.matrix=new c.Matrix4,this.parentObject_SmallCoord.matrixAutoUpdate=!1},C.prototype.initLayerTable=function(){this.mapNameToLayer=new Map,this.curLayer="0";var S=new E.MxDbLayerTableRecord;S.init(this.curLayer,this.parentObject,this.parentObject_SmallCoord),this.mapNameToLayer.set(this.curLayer,S)},C.prototype.getEntity=function(S){return this.mapIdToEntity.get(S)},C.prototype.isValidId=function(S){return this.mapIdToEntity.has(S)},C.prototype.setRenderOrder=function(S){var Y=this.parentObject.renderOrder;return this.parentObject.renderOrder=S,this.parentObject_SmallCoord.renderOrder=S,Y},C.prototype.eraseEntity=function(S){this.gripManager.deleteGripData(S),this.selectManager.deleteSelect(S),this.mapIdToEntity.delete(S)},C.prototype.showLayer=function(S,Y){var G=this.getLayer(S);G&&G.setVisible(Y)},C.prototype.setCurrentLayer=function(S){if(S.length!=0)return this.curLayer=S,this.addLayer(S)},C.prototype.addLayer=function(S){var Y=this.mapNameToLayer.get(S);return Y||((Y=new E.MxDbLayerTableRecord).init(S,this.parentObject,this.parentObject_SmallCoord),this.mapNameToLayer.set(S,Y),Y)},C.prototype.getLayer=function(S){return this.mapNameToLayer.get(S)},C.prototype.addMxEntity=function(S){if(S.getImp())return S.objectId();var Y=new A.MxDbEntity;return Y.initUserObject(S),S.initGuid(k.MxTools.generateUUID()),this.addEntityImp(Y)},C.prototype.addEntityImp=function(S){return this.mapIdToEntity.set(this.idCount,S),S.setMxDatabase(this),S.setObjectId(this.idCount),S.getLayer().length==0&&S.setLayer(this.curLayer),S.upDisplay(),this.idCount++},C.prototype.getThreeJSParentObject=function(){return this.parentObject},C.prototype.getThreeJSParentObject_SmallCoord=function(){return this.parentObject_SmallCoord},C.prototype.getIntersectObjects=function(S){var Y=this.getIntersectObjects_imp(S),G=this.getIntersectObjects_SmallCoord_imp(S);return Y.concat(G)},C.prototype.getIntersectObjects_imp=function(S){return this.mxObj.getMxDrawThreeJs().createRaycaster(S).intersectObjects(this.parentObject.children,!0)},C.prototype.getIntersectObjects_SmallCoord_imp=function(S){return this.mxObj.getMxDrawThreeJs().createRaycaster(S).intersectObjects(this.parentObject_SmallCoord.children,!0)},C);function C(){this.mapIdToEntity=new Map,this.mxObj=null,this.scene=null,this.idCount=1,this.parentObject=null,this.parentObject_SmallCoord=null,this.mapNameToLayer=new Map,this.curLayer="0",this.gripManager=new H.MxDbEntityGrip(this),this.selectManager=new F.MxDbEntitySelect(this),this.groupDictionary=new _.MxDbGroupDictionary}o.MxDbDatabase=U},{"../MxFun":27,"../MxManager":29,"../MxTools":38,"../MxType":39,"./MxDbEntity":69,"./MxDbEntityGrip":70,"./MxDbEntitySelect":71,"./MxDbGroup":72,"./MxDbLayerTable":73,three:19}],69:[function(b,n,o){var a=this&&this.__awaiter||function(C,S,Y,G){return new(Y=Y||Promise)(function(T,B){function D(h){try{I(G.next(h))}catch(u){B(u)}}function N(h){try{I(G.throw(h))}catch(u){B(u)}}function I(h){var u;h.done?T(h.value):((u=h.value)instanceof Y?u:new Y(function(v){v(u)})).then(D,N)}I((G=G.apply(C,S||[])).next())})},m=this&&this.__generator||function(C,S){var Y,G,T,B={label:0,sent:function(){if(1&T[0])throw T[1];return T[1]},trys:[],ops:[]},D=Object.create((typeof Iterator=="function"?Iterator:Object).prototype);return D.next=N(0),D.throw=N(1),D.return=N(2),typeof Symbol=="function"&&(D[Symbol.iterator]=function(){return this}),D;function N(I){return function(h){return function(u){if(Y)throw new TypeError("Generator is already executing.");for(;D&&u[D=0]&&(B=0),B;)try{if(Y=1,G&&(T=2&u[0]?G.return:u[0]?G.throw||((T=G.return)&&T.call(G),0):G.next)&&!(T=T.call(G,u[1])).done)return T;switch(G=0,T&&(u=[2&u[0],T.value]),u[0]){case 0:case 1:T=u;break;case 4:return B.label++,{value:u[1],done:!1};case 5:B.label++,G=u[1],u=[0];continue;case 7:u=B.ops.pop(),B.trys.pop();continue;default:if(!(T=0<(T=B.trys).length&&T[T.length-1])&&(u[0]===6||u[0]===2)){B=0;continue}if(u[0]===3&&(!T||u[1]>T[0]&&u[1]<T[3])){B.label=u[1];break}if(u[0]===6&&B.label<T[1]){B.label=T[1],T=u;break}if(T&&B.label<T[2]){B.label=T[2],B.ops.push(u);break}T[2]&&B.ops.pop(),B.trys.pop();continue}u=S.call(C,B)}catch(v){u=[6,v],G=0}finally{Y=T=0}if(5&u[0])throw u[1];return{value:u[0]?u[1]:void 0,done:!0}}([I,h])}}};Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbEntity=o.MxDbEntityClassHierarchy=o.MxDbEntityUserObject=void 0;var c=b("three"),x=b("../Operate/McGiWorldDraw"),A=b("../MxManager"),H=b("../MxTools"),F=b("../MxType"),P=(g.prototype.getClosestPointTo=function(C,S){return null},g.prototype.getTypeName=function(){return""},g.prototype.isUseSmallcoordDisplay=function(){return this.use_smallcoord_display},g.prototype.toSmallcoord=function(C,S){return this.use_smallcoord_display?C.toSmallcoord(S):S},g.prototype.initGuid=function(C){0<this.sGuid.length?console.log("mx: init guid error"):this.sGuid=C},g.prototype.guid=function(){return this.sGuid},g.prototype.setGuid=function(C){this.sGuid=C},g.prototype.setLayer=function(C){var S=this.getImp();S&&S.nodifySetLayer(),this.layer=C},g.prototype.getLayer=function(){return this.layer},g.prototype.setDash=function(C,S){this.dDashArray=C,this.dDashRatio=S,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)},g.prototype.getDash=function(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}},g.prototype.setDashLineDisplay=function(C){C?(this.dDashArray=.03,this.dDashRatio=.1,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0)},g.prototype.isDashLineDisplay=function(){return 0<this.dDashArray&&0<this.dDashRatio},g.prototype.setLineWidthByPixels=function(C){this.lineWidthByPixels=C},g.prototype.getLineWidthByPixels=function(){return this.lineWidthByPixels},g.prototype.setLineWidth=function(C){this.dLineWidth=C},g.prototype.getLineWidth=function(){return this.dLineWidth},g.prototype.getMxObject=function(){var C=this.getImp();return C?C.getMxObject():null},g.prototype.onViewChange=function(){return!1},g.prototype.getImp=function(){return this.MxDbEntityImp},g.prototype.upDisplay=function(){var C=this.getImp();return!!C&&C.upDisplay()},g.prototype.erase=function(){var C=this.getImp();return!!C&&C.erase()},g.prototype.setColor=function(C){this.iColor=C},g.prototype.getColor=function(){return this.iColor},g.prototype.setRenderOrder=function(C){this.iRenderOrder=C},g.prototype.getRenderOrder=function(){return this.iRenderOrder},g.prototype.onEndGripEidt=function(){},g.prototype.onStartGripEidt=function(){},g.prototype.dwgIn=function(C){return this.iColor=C.iColor,this.iRenderOrder=C.iRenderOrder,this.opacity=C.opacity,this.visible=C.visible,this.dLineWidth=C.lineWidth,this.lineWidthByPixels=C.lineWidthByPixels,this.dDashArray=C.dashArray,this.dDashRatio=C.dashRatio,this.layer=C.layer,C.guid&&(this.sGuid=C.guid),!0},g.prototype.dwgOut=function(C){return C.iColor=this.iColor,C.iRenderOrder=this.iRenderOrder,C.opacity=this.opacity,C.visible=this.visible,C.lineWidth=this.dLineWidth,C.lineWidthByPixels=this.lineWidthByPixels,C.dashArray=this.dDashArray,C.dashRatio=this.dDashRatio,C.layer=this.layer,C.guid=this.sGuid,C},g.prototype.clone=function(C){var S=this.create(),Y={type:C||F.MxType.MxCloneType.kClone};return this.dwgOut(Y),S.dwgIn(Y),S.sGuid="",S},g.prototype.init=function(){A.MxManager.getMxDbEntityClassHierarchy().init(this)},g.prototype.transformBy=function(C){},g.prototype.objectId=function(){var C=this.getImp();return C?C.objectId():0},g);function g(){this.iColor=16777215,this.iRenderOrder=A.MxData.iMxEntityRenderOrder,this.opacity=1,this.visible=!0,this.dLineWidth=0,this.lineWidthByPixels=!0,this.dDashArray=0,this.dDashRatio=0,this.layer="",this.sGuid="",this.use_smallcoord_display=!1}o.MxDbEntityUserObject=P;var E=(_.prototype.init=function(C){var S=C.getTypeName();this.mapType2Create.get(S)&&console.log("MxError:already has this class name "+S),this.mapType2Create.set(S,{type:0,createfun:C})},_.prototype.initDynamic=function(C){this.dynmaicCreate=C},_.prototype.createMxEntity=function(C){return a(this,void 0,void 0,function(){var S,Y;return m(this,function(G){switch(G.label){case 0:return(S=this.mapType2Create.get(C))?[3,3]:this.dynmaicCreate?[4,this.dynmaicCreate(C)]:[3,2];case 1:return(Y=G.sent())?(this.mapType2Create.set(C,{type:1,createfun:Y}),[2,new Promise(function(T,B){T(new Y)})]):[2,new Promise(function(T,B){T(null)})];case 2:return[2,new Promise(function(T,B){T(null)})];case 3:return S.type==0?[2,new Promise(function(T,B){T(S.createfun.create())})]:S.type==1?[2,new Promise(function(T,B){T(new S.createfun)})]:[2,new Promise(function(T,B){T(null)})]}})})},_);function _(){this.mapType2Create=new Map,this.dynmaicCreate=null}o.MxDbEntityClassHierarchy=E;var k=(U.prototype.setObjectId=function(C){this.id=C},U.prototype.nodifySetLayer=function(){this.layerObjectGroup&&this.clearDisplayImp()},U.prototype.setLayer=function(C){this.userObject.setLayer(C)},U.prototype.getLayer=function(){return this.userObject.getLayer()},U.prototype.setDirtyDisplay=function(C){this.isDirtyDisplay=C},U.prototype.getDirtyDisplay=function(){return this.isDirtyDisplay},U.prototype.setMxDatabase=function(C){this.mxDatabase=C},U.prototype.objectId=function(){return this.id},U.prototype.initUserObject=function(C){(this.userObject=C).MxDbEntityImp=this},U.prototype.upDisplay=function(){if(!this.mxDatabase)return console.log("mxassert(0) this.mxDatabase is null"),!1;this.updateDisplayImp(this.mxDatabase.getMxObject())},U.prototype.erase=function(){if(this.id==0)return!1;this.clearDisplayImp(),this.userObject=null,this.mxDatabase.eraseEntity(this.id),this.id=0,this.mxDatabase=null},U.prototype.clearDisplayImp=function(){this.layerObjectGroup&&(this.threeObjectGroup&&(this.threeObjectGroup.traverse(function(C){C.type==="Mesh"&&(C.geometry.dispose(),C.material.dispose())}),this.layerObjectGroup.remove(this.threeObjectGroup)),this.threeObjectGroup=null,this.layerObjectGroup=null)},U.prototype.updateDisplayImp=function(C){if(this.clearDisplayImp(),this.userObject){if(this.userObject.visible){var S=this.mxDatabase.addLayer(this.userObject.getLayer());if(!S)return console.log("mxassert(0) this.layerRecord is null"),!1;this.threeObjectGroup=new c.Object3D;var Y=new x.McGiWorldDraw(C,x.McGiWorldDrawType.kWorldDraw);Y.setupForEntity(this.userObject),this.worldDraw(Y);for(var G=Y.getEntitys(),T=G.length,B=0;B<T;B++){var D=G[B];(D.MxDbEntity=this).threeObjectGroup.add(D)}this.userObject.isUseSmallcoordDisplay()?this.layerObjectGroup=S.getGroup_SmallCoord():this.layerObjectGroup=S.getGroup(),this.layerObjectGroup.add(this.threeObjectGroup)}}else H.MxTools.MxASSERT(!1,"this.userObject == null")},U.prototype.worldDraw=function(C){this.userObject.worldDraw(C)},U.prototype.getGripPoints=function(){return this.userObject.getGripPoints()},U.prototype.getClosestPointTo=function(C,S){return this.userObject.getClosestPointTo(C,S)},U.prototype.getUserObject=function(){return this.userObject},U.prototype.clone=function(C){var S=new U;return S.initUserObject(this.userObject.clone(C)),S},U.prototype.transformBy=function(C){this.userObject.transformBy(C)},U.prototype.setColor=function(C){this.userObject.setColor(C)},U.prototype.onEndGripEidt=function(){this.userObject.onEndGripEidt()},U.prototype.onStartGripEidt=function(){return this.userObject.onStartGripEidt()},U.prototype.getColor=function(){return this.userObject.getColor()},U.prototype.getMxObject=function(){return this.mxDatabase?this.mxDatabase.getMxObject():null},U.prototype.onViewChange=function(){return!!this.userObject&&this.userObject.onViewChange()},U);function U(){this.threeObjectGroup=null,this.userObject=null,this.mxDatabase=null,this.isDirtyDisplay=!1,this.layerObjectGroup=null,this.id=0}o.MxDbEntity=k},{"../MxManager":29,"../MxTools":38,"../MxType":39,"../Operate/McGiWorldDraw":44,three:19}],70:[function(b,n,o){var a,m=this&&this.__extends||(a=function(T,B){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,N){D.__proto__=N}||function(D,N){for(var I in N)Object.prototype.hasOwnProperty.call(N,I)&&(D[I]=N[I])})(T,B)},function(T,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function D(){this.constructor=T}a(T,B),T.prototype=B===null?Object.create(B):(D.prototype=B.prototype,new D)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbEntityGrip=o.MxDbEntityGripJig=o.MxDbEntityGripData=void 0,o.MxGetMxDbEntitForThreeJsObject=k,o.MxGetWordDrawxDataForThreeJsObject=function(T){for(var B=null;T&&!(B=T.MxWordDrawXData)&&T.parent;)T=T.parent;return B};var c=b("three"),x=b("../MxFun"),A=b("../MxDrawData"),H=b("../Operate/MxJig"),F=b("../Operate/MxJigCmdManager"),P=b("../Operate/McGiWorldDraw"),g=b("../MxManager"),E=b("../MxType"),_=function(){this.threeObject=null};function k(T){for(var B=null;T&&!(B=T.MxDbEntity)&&T.parent;)T=T.parent;return B}o.MxDbEntityGripData=_;var U,C=(m(S,U=H.McEdJigCommand),S.prototype.sampler=function(){var T=F.MxJigCmdManager.InType.kGetBegan|F.MxJigCmdManager.InType.kGetEnd,B=this.acquirePoint(T);return B.status==F.MxJigCmdManager.DragStatus.kNormal&&(this.currPt=B.pt),B.status},S.prototype.getTypeName=function(){return"MxGripEdit"},S.prototype.onStartCommand=function(){this.iscallOnStartCommand=!0,U.prototype.onStartCommand.call(this)},S.prototype.done=function(T){if(T==F.MxJigCmdManager.DragStatus.kNormal){var B=this.currPt.clone();B.sub(this.dragBasePt);for(var D=this.getMxObject(),N=D.getMxDatabase(),I=D.getMxDatabase().getGripManager(),h=this.grips.length,u=new Set,v=[],M=0;M<h;M++){var j=this.grips[M],z=this.ents[M];I.deleteGripData(z.objectId()),z.getUserObject().moveGripPointsAt(j.iIndex,B),I.addGripFromEntity(z),z.upDisplay(),u.add(z.objectId());var J={type:"mxdraw",id:z.objectId(),index:j.iIndex,curentPoint:this.currPt,point:j.point,offset_x:B.x,offset_y:B.y};v.push(J)}D.updateDisplay(),0<v.length&&D.callEvent("objectGripEdit",v),N.getSelectManager().upSelectDilsplay(u)}var te=this.ents.length;for(M=0;M<te;M++)(z=this.ents[M]).onEndGripEidt(),T!=F.MxJigCmdManager.DragStatus.kNormal&&z.upDisplay();return F.MxJigCmdManager.DoneStatius.kExitCommand},S.prototype.upDisplay=function(){var T=this.currPt.clone();if(T.sub(this.dragBasePt),!(T.length()<.001)){if(this.iscallOnStartCommand){for(var B=this.ents.length,D=0;D<B;D++){var N=this.ents[D];this.aryParam.push(N.onStartGripEidt())}this.iscallOnStartCommand=!1}var I=this.getMxObject(),h=this.grips.length;for(D=0;D<h;D++){var u=this.grips[D],v=(N=this.ents[D],this.aryParam[D]),M=N.clone(E.MxType.MxCloneType.kDragClone);M.getUserObject().moveGripPointsAt(u.iIndex,T);var j=new P.McGiWorldDraw(I,P.McGiWorldDrawType.kDynDragDraw);j.setupForEntity(M.getUserObject()),M.worldDraw(j);var z=j.getEntitys(),J=z.length,te=31;v&&v.renderOrder&&(te=v.renderOrder);for(var X=0;X<J;X++)this.drawEntity(z[X],te,M.getUserObject().isUseSmallcoordDisplay())}}},S);function S(T,B,D){var N=U.call(this)||this;return N.aryParam=[],N.iscallOnStartCommand=!0,N.dragBasePt=T,N.grips=B,N.ents=D,N.currPt=T,N.iscallOnStartCommand=!0,N}o.MxDbEntityGripJig=C;var Y=(G.prototype.getAllSelect=function(){var T=[];return this.mapGrips.forEach(function(B,D){T.push(D)}),T},G.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new c.Group,this.drawGroup.renderOrder=g.MxData.iGripRenderOrder,this.database.getMxObject().getTheTempDrawContainer_SmallCoord_Draw().add(this.drawGroup)),this.drawGroup},G.prototype.reInit=function(){this.removeAllGrips(),this.drawGroup&&x.MxFun.removeThreejsObject(this.drawGroup,this.database.getMxObject().getTheTempDrawContainer_SmallCoord_Draw()),this.drawGroup=null},G.prototype.removeAllGrips=function(){if(this.mapGrips.size==0)return!1;var T=this.getParentGroup();return this.mapGrips.forEach(function(B,D,N){for(var I=B.length,h=0;h<I;h++){var u=B[h];x.MxFun.removeThreejsObject(u.threeObject,T)}}),this.mapGrips=new Map,!0},G.prototype.deleteGripData=function(T){var B=this.getParentGroup(),D=this.mapGrips.get(T);if(D)for(var N=D.length,I=0;I<N;I++){var h=D[I];x.MxFun.removeThreejsObject(h.threeObject,B)}this.mapGrips.delete(T)},G.prototype.createGripDisplayObject=function(T){var B=this.database.getMxObject(),D=this.getParentGroup();T.geometry=new c.Geometry;var N=B.toSmallcoord2(T.point.x,T.point.y,T.point.z),I=B.screenCoordLong2World(A.MxDrawData.m_dInputRectWidth/2);T.geometry.vertices.push(new c.Vector3(N.x-I,N.y-I,0)),T.geometry.vertices.push(new c.Vector3(N.x-I,N.y+I,0)),T.geometry.vertices.push(new c.Vector3(N.x+I,N.y+I,0)),T.geometry.vertices.push(new c.Vector3(N.x+I,N.y-I,0)),T.geometry.faces.push(new c.Face3(0,1,2)),T.geometry.faces.push(new c.Face3(2,3,0)),T.geometry.computeFaceNormals(),T.geometry.computeVertexNormals();var h=new c.MeshBasicMaterial({color:255,transparent:!0,depthTest:!1,side:c.DoubleSide,opacity:.9}),u=new c.Mesh(T.geometry,h);D.add(u),T.threeObject=u},G.prototype.addGripData=function(T,B,D){var N=this.mapGrips.get(T);N==null&&(N=new Array,this.mapGrips.set(T,N));var I=new _;return I.iIndex=B,I.point=new c.Vector3(D.x,D.y,0),N.push(I),I},G.prototype.hitTest=function(T){var B=this,D={grips:new Array,ents:new Array,pt:T},N=new c.Vector3(T.x,T.y,0),I=this.database.getMxObject(),h=I.viewCoordLong2Cad(A.MxDrawData.m_dInputRectWidth/2);return this.mapGrips.forEach(function(u,v){for(var M=u.length,j=0;j<M;j++){var z=u[j];if(z.point.distanceTo(N)<=h){var J=B.database.getEntity(v),te=!0;I.hasEvent("whetherEditTheGripPoint")&&(te=I.callEvent("whetherEditTheGripPoint",{entity:J.getUserObject(),index:z.iIndex})),te&&(D.grips.push(z),D.ents.push(J));break}}}),D},G.prototype.onMouseLBDown=function(T){if(A.MxDrawData.m_isEnableGripEidt!=1)return!1;var B=this.hitTest(T);return B.grips.length!=0&&(x.MxFun.sendStringToExecute("Mx_FrontEndWebpageGripEdit",B),!0)},G.prototype.gripEditImp=function(T){var B=T.grips,D=T.ents,N=T.pt,I=new C(N,B,D);I.setDisableDynInput(!0),I.setDisableOsnap(!0),F.MxJigCmdManager.runCmd(I)},G.prototype.doWindowsSelect=function(T,B,D){},G.prototype.addGripFromEntity=function(T){if(A.MxDrawData.m_isEnableGripEidt!=0){var B=T.getGripPoints(),D=T.objectId();this.deleteGripData(D);for(var N=0;N<B.length;N++){var I=this.addGripData(D,N,B[N]);this.createGripDisplayObject(I)}}},G.prototype.addSelect=function(T,B,D){D===void 0&&(D=!0);var N=this.database.getSelectManager(),I=!1;if(this.getAllSelect().forEach(function(v){v==T&&(I=!0)}),I)return!1;var h=this.database.getMxObject().getMxEntity(T);if(!h)return!1;var u=new Set;return u.add(T),D&&this.addGripFromEntity(h),N.upSelectDilsplay(u),B&&this.fireMxEntitySelectChange(),!0},G.prototype.fireMxEntitySelectChange=function(){var T=this.database.getMxObject();this.isCallingMxEntitySelectChange||(this.isCallingMxEntitySelectChange=!0,T.callEvent("mxdrawSelectChange",this.getAllSelect()),this.isCallingMxEntitySelectChange=!1)},G.prototype.doPointSelect=function(T,B){B===void 0&&(B=!1);for(var D=!1,N=this.database.getSelectManager(),I=this.database.getMxObject(),h=N.isEmptySelect(),u=!1,v=I.viewCoordLong2Cad(.5*A.MxDrawData.m_dInputRectWidth),M=function(){I.pointMultipleSelect()||(j.removeAllGrips()&&(u=!0),N.removeAllEntity()&&(u=!0),I.getMcObject().isValid()&&(u=I.getMcObject().getGripManager().clearAll()),B=!1);var z=j.database.getIntersectObjects(T);if(z.length==0)return I.updateDisplay(),"break";var J=I.screenCoord2Current(T.x,T.y,T.z),te=j,X=new Set;if(z.forEach(function(Ee){var we=k(Ee.object);if(we){var Be=we.objectId();if(te.database.isValidId(Be)&&!X.has(Be)){var re=we.getClosestPointTo(J,1),fe=!1;(!re||re.distanceTo(J)<v)&&(fe=!0),fe&&(X.add(Be),B?te.deleteGripData(we.objectId()):te.addGripFromEntity(we))}}}),B)X.forEach(function(Ee){N.deleteSelect(Ee)});else{var se=new Set,ve=j.database.getGroupDictionary();X.forEach(function(Ee){se.add(Ee),ve.getEntityInGroup(Ee).forEach(function(we){we.getAll().forEach(function(Be){te.database.isValidId(Be)&&se.add(Be)})})}),N.upSelectDilsplay(se)}return u=!0,I.updateDisplay(),D=!0,"break"},j=this;M()!=="break";);return!u&&h==N.isEmptySelect()||this.fireMxEntitySelectChange(),D},G);function G(T){this.database=null,this.mapGrips=new Map,this.isCallingMxEntitySelectChange=!1,this.drawGroup=null,this.database=T}o.MxDbEntityGrip=Y},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxType":39,"../Operate/McGiWorldDraw":44,"../Operate/MxJig":53,"../Operate/MxJigCmdManager":54,three:19}],71:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbEntitySelect=void 0;var a=b("three"),m=b("../MxFun"),c=b("three.meshline"),x=b("../Operate/McGiWorldDraw"),A=b("../MxManager"),H=(F.prototype.setRenderOrder=function(P){this.iRenderOrder=P},F.prototype.getRenderOrder=function(){return this.iRenderOrder},F.prototype.setCanvasSize=function(P,g){this.canvasWidth==P&&this.canvasHeight==g||(this.canvasWidth=P,this.canvasHeight=g,this.material.resolution=new a.Vector2(this.canvasWidth,this.canvasHeight),this.material.needsUpdate=!0)},F.prototype.removeAllEntity=function(){return this.mapIdToThreeObject.size!=0&&(this.mapIdToThreeObject.forEach(function(P){for(var g=P.length,E=0;E<g;E++){var _=P[E];m.MxFun.removeThreejsObject(_,_.parentObject)}}),this.mapIdToThreeObject.clear(),!0)},F.prototype.isEmptySelect=function(){return this.mapIdToThreeObject.size==0},F.prototype.getParentObject=function(P){return P?this.mxDatabase.getMxObject().getTheTempDrawContainer_SmallCoord_Draw():this.mxDatabase.getMxObject().getTheTempDrawContainer()},F.prototype.getAllSelect=function(){var P=[];return this.mapIdToThreeObject.forEach(function(g,E){P.push(E)}),P},F.prototype.setPrvCommandSelect=function(P){this.aryPrvCommandSelect=P},F.prototype.getPrvCommandSelect=function(){return this.aryPrvCommandSelect},F.prototype.deleteSelect=function(P){var g=this.mapIdToThreeObject.get(P);if(g){for(var E=g.length,_=0;_<E;_++){var k=g[_];m.MxFun.removeThreejsObject(k,k.parentObject)}this.mapIdToThreeObject.delete(P)}},F.prototype.upSelectDilsplayFromId=function(P){var g=new Set;g.add(P),this.upSelectDilsplay(g)},F.prototype.upSelectDilsplay=function(P){var g=this,E=new x.McGiWorldDrawSelect(this.mxDatabase.getMxObject(),this);P.forEach(function(_){g.deleteSelect(_);var k=g.mxDatabase.getEntity(_);k&&(E.setSmallCoordDraw(k.getUserObject().isUseSmallcoordDisplay()),E.setCurEntityId(_),k.worldDraw(E))})},F.prototype.addCircleDisplay=function(P,g,E,_){var k=new a.CircleGeometry(E,64,3,2*Math.PI);if(k.vertices.shift(),k.vertices.length!=0){k.vertices.push(k.vertices[0]);var U=3*k.vertices.length;if(U!=0){for(var C=this.getParentObject(_),S=new Float32Array(U),Y=0,G=0;Y+2<U;Y+=3,G++)S[Y]=k.vertices[G].x+g.x,S[Y+1]=k.vertices[G].y+g.y,S[Y+2]=g.z;var T=new c.MeshLine;T.setGeometry(S);var B=new a.Mesh(T.geometry,this.material);B.renderOrder=this.iRenderOrder,(B.parentObject=C).add(B);var D=this.mapIdToThreeObject.get(P);D||(D=new Array,this.mapIdToThreeObject.set(P,D)),D.push(B)}}},F.prototype.addLineDisplay=function(P,g,E,_){var k=this.getParentObject(_),U=new Float32Array(6);U[0]=g.x,U[1]=g.y,U[2]=0,U[3]=E.x,U[4]=E.y,U[5]=0;var C=new c.MeshLine;C.setGeometry(U);var S=new a.Mesh(C.geometry,this.material);S.renderOrder=this.iRenderOrder,(S.parentObject=k).add(S);var Y=this.mapIdToThreeObject.get(P);Y||(Y=new Array,this.mapIdToThreeObject.set(P,Y)),Y.push(S)},F);function F(P){this.mapIdToThreeObject=new Map,this.canvasWidth=800,this.canvasHeight=500,this.mxDatabase=null,this.material=new c.MeshLineMaterial({useMap:!1,color:new a.Color(2641557),opacity:.8,resolution:new a.Vector2(800,500),sizeAttenuation:!1,lineWidth:10,transparent:!0,depthTest:!1}),this.iRenderOrder=A.MxData.iSelectRenderOrder,this.aryPrvCommandSelect=[],this.mxDatabase=P}o.MxDbEntitySelect=H},{"../MxFun":27,"../MxManager":29,"../Operate/McGiWorldDraw":44,three:19,"three.meshline":18}],72:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbGroupDictionary=o.MxDbGroup=void 0;var a=(m.prototype.name=function(){return this.sName},m.prototype.append=function(A){this.has(A)||this.setId.add(A)},m.prototype.clear=function(){this.setId=new Set},m.prototype.getAll=function(){var A=[];return this.setId.forEach(function(H){A.push(H)}),A},m.prototype.has=function(A){return this.setId.has(A)},m.prototype.delete=function(A){return this.setId.delete(A)},m);function m(A){this.setId=new Set,this.sName="",this.sName=A}o.MxDbGroup=a;var c=(x.prototype.getAt=function(A){return this.mapNameToGroup.get(A)},x.prototype.delete=function(A){return!!this.mapNameToGroup.has(A)&&this.mapNameToGroup.delete(A)},x.prototype.add=function(A){var H=this.mapNameToGroup.get(A);return H||(H=new a(A),this.mapNameToGroup.set(A,H),H)},x.prototype.dwgOut=function(A){var H=[];return this.mapNameToGroup.forEach(function(F,P){H.push(P)}),A.groups=H,A},x.prototype.dwgIn=function(A){var H=this;return A.groups.forEach(function(F){var P=new a(F);H.mapNameToGroup.set(F,P)}),!0},x.prototype.getEntityInGroup=function(A){var H=[];return this.mapNameToGroup.forEach(function(F){F.has(A)&&H.push(F)}),H},x.prototype.getEntityInGroupName=function(A){var H=[];return this.mapNameToGroup.forEach(function(F,P){F.has(A)&&H.push(P)}),H},x);function x(){this.mapNameToGroup=new Map}o.MxDbGroupDictionary=c},{}],73:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbLayerTableRecord=void 0;var a=b("three"),m=(c.prototype.getGroup=function(){return this.group},c.prototype.getGroup_SmallCoord=function(){return this.group_SmallCoord},c.prototype.getName=function(){return this.name},c.prototype.setName=function(x){this.name=x},c.prototype.setVisible=function(x){this.visible=x,this.group.visible=x,this.group_SmallCoord.visible=x},c.prototype.getVisible=function(){return this.visible},c.prototype.init=function(x,A,H){return this.name=x,A.add(this.group),H.add(this.group_SmallCoord),!0},c.prototype.dwgIn=function(x){return this.visible=x.visible,this.name=x.name,this.group.visible=this.visible,this.group_SmallCoord.visible=this.visible,!0},c.prototype.dwgOut=function(x){return x.visible=this.visible,x.name=this.name,x},c);function c(){this.group=new a.Group,this.group_SmallCoord=new a.Group,this.name="",this.visible=!0}o.MxDbLayerTableRecord=m},{three:19}],74:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.MxDbTextureManager=void 0;var a=b("three"),m=(c.prototype.loadImage=function(x,A){var H=this.mapImageUrlToMaterialTexture.get(x);if(H)A(H);else{var F=this;new a.TextureLoader().load(x,function(P){var g=new a.MeshLambertMaterial({map:P,transparent:!0,side:a.DoubleSide});g.map&&(g.map.needsUpdate=!0),F.mapImageUrlToMaterialTexture.set(x,g),A&&A(g)},void 0,function(P){console.log(P),A&&A(null)})}},c);function c(){this.mapImageUrlToMaterialTexture=new Map}o.MxDbTextureManager=m},{three:19}],75:[function(b,n,o){var a,m=this&&this.__extends||(a=function(h,u){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(v,M){v.__proto__=M}||function(v,M){for(var j in M)Object.prototype.hasOwnProperty.call(M,j)&&(v[j]=M[j])})(h,u)},function(h,u){if(typeof u!="function"&&u!==null)throw new TypeError("Class extends value "+String(u)+" is not a constructor or null");function v(){this.constructor=h}a(h,u),h.prototype=u===null?Object.create(u):(v.prototype=u.prototype,new v)});Object.defineProperty(o,"__esModule",{value:!0}),o.MxDrawObject3dThreeJS=o.MxDrawMapBoxThreeJS=o.MxDrawObject2dThreeJS=o.MxDrawThreeJS=o.MxThreeJSType=void 0;var c,x,A,H=b("three"),F=b("../Operate/MxJigCmdManager"),P=b("three-orbitcontrols"),g=b("../UI/MxUiVue"),E=(m(_,c=P.OrbitControls),_.prototype.update=function(){},_);function _(h,u){return c.call(this,h,u)||this}(A=x||(o.MxThreeJSType=x={}))[A.k2d=0]="k2d",A[A.k3d=1]="k3d",A[A.kMapBox=2]="kMapBox";var k=(U.prototype.screenCoord2World=function(h,u,v){return this.mxObject.screenCoord2World_mxdrawThreeJS_call(h,u,v)},U.prototype.worldCoord2Screen=function(h,u,v){return this.mxObject.worldCoord2Screen_mxdrawThreeJS_call(h,u,v)},U.prototype.getDomMousePos=function(h){},U.prototype.createRaycaster=function(h){var u=new H.Raycaster;u.linePrecision=this.mxObject.screenCoordLong2World(10);var v=this.mxObject.getCanvas(),M=v.clientWidth,j=v.clientHeight,z=new H.Vector2(h.x/M*2-1,-h.y/j*2+1);return u.setFromCamera(z,this.mxObject.getCamera()),u},U.prototype.zoomW=function(h,u,v,M,j){return this.mxObject.zoomW_call(h,u,v,j)},U.prototype.zoomCenter=function(h,u,v){return this.mxObject.zoomCenter_call(h,u)},U.prototype.zoomScale=function(h,u){return this.mxObject.zoomScale_call(h)},U.prototype.setViewAngle=function(h){return this.mxObject.setViewAngle_call(h)},U.prototype.startPanCommand=function(){return this.mxObject.startPanCommand_call()},U.prototype.endPanCommand=function(){return this.mxObject.endPanCommand_call()},U.prototype.isPaningCommand=function(){return this.mxObject.isPaningCommand_call()},U);function U(h){this.mxObject=h}o.MxDrawThreeJS=k;var C,S=(m(Y,C=k),Y.prototype.onInitThreejs=function(){this.proxyObj.onInitThreejs()},Y.prototype.onInitScene=function(){this.proxyObj.onInitScene()},Y.prototype.getType=function(){return x.k2d},Y.prototype.updateCameraDisplayRange=function(h,u,v){this.proxyObj.updateCameraDisplayRangeImp(h,u,v)},Y.prototype.updateCameraForm3dViewData=function(h){this.proxyObj.updateCameraForm3dViewDataImp(h)},Y.prototype.addControlsChangeEvent=function(){var h=this.mxObject;this.mxObject.getOrbitControls().addEventListener("change",function(){F.MxJigCmdManager.OnThreeControlsChage(),h.callViewChange(),h.getMxDatabase().onViewChange(),h.getMcObject().isValid()&&h.getMcObject().getGripManager().onControlsChage(),h.getTempMarkDraw().clear(!0),h.updateDisplay()})},Y.prototype.updateDisplay=function(h){h===void 0&&(h=!1),this.mxObject.updateDisplayImplement(h)},Y.prototype.getRegistEventObject=function(){return this.mxObject.getCanvas()},Y);function Y(h){var u=C.call(this,h)||this;return u.proxyObj=h,u}o.MxDrawObject2dThreeJS=S;var G,T=(m(B,G=k),B.prototype.startPanCommand=function(){this.mapBox.map&&(this.isPaning=!0,this.bakPan=this.mapBox.map.dragPan.useMouseMiddle(!1),g.MxUiVue.setCursorType(g.MxUiVue.CursorType.kPan))},B.prototype.endPanCommand=function(){this.mapBox.map&&this.isPaning&&(this.isPaning=!1,this.mapBox.map.dragPan.useMouseMiddle(this.bakPan),g.MxUiVue.setCursorType(g.MxUiVue.CursorType.kNormal))},B.prototype.isPaningCommand=function(){return this.mapBox.map,this.isPaning},B.prototype.mercatorCoord2CAD=function(h,u){var v=new H.Vector3(h,u,0);return v.applyMatrix4(this.mapBox.matMapToCad),v},B.prototype.cadToMercatorCoord=function(h){return h.applyMatrix4(this.mapBox.matCadToMap),h},B.prototype.setViewAngle=function(h){this.mapBox.map&&this.mapBox.map.setBearing(180*h/Math.PI)},B.prototype.zoomCenter=function(h,u,v){if(this.mapBox.map){var M=this.cadToMercatorCoord(new H.Vector3(h,u,0)),j=this.mapBox.map.mercator_to_lnglat(M.x,M.y,0),z=this.mapBox.map.getBounds(),J=.5*(z._ne.wrap().lng-z._sw.wrap().lng),te=.5*(z._ne.wrap().lat-z._sw.wrap().lat);this.mapBox.map.fitBounds([[j.lng-J,j.lat-te],[j.lng+J,j.lat+te]],{animate:!!v})}},B.prototype.zoomScale=function(h,u){if(this.mapBox.map){var v=this.mapBox.map.getBounds(),M=.5*(v._ne.wrap().lng-v._sw.wrap().lng),j=.5*(v._ne.wrap().lat-v._sw.wrap().lat),z=v._sw.wrap().lng+M,J=v._sw.wrap().lat+j;M*=h,j*=h,this.mapBox.map.fitBounds([[z-M,J-j],[z+M,J+j]],{animate:!!u})}},B.prototype.zoomW=function(h,u,v,M,j){if(this.mapBox.map)if(h.distanceTo(u)<1e-7)console.log("Mx:ZoomW param invalid");else{v!==void 0&&v&&(h=this.mxObject2d.docCoord2Cad(h.x,h.y,0),u=this.mxObject2d.docCoord2Cad(u.x,u.y,0));var z=this.cadToMercatorCoord(h),J=this.cadToMercatorCoord(u),te=this.mapBox.map.mercator_to_lnglat(z.x,z.y,0),X=this.mapBox.map.mercator_to_lnglat(J.x,J.y,0),se=Math.min(te.lng,X.lng),ve=Math.max(te.lng,X.lng),Ee=Math.min(te.lat,X.lat),we=Math.max(te.lat,X.lat);this.mapBox.map.fitBounds([[se,Ee],[ve,we]],{animate:!!M})}},B.prototype.onInitScene=function(){},B.prototype.addControlsChangeEvent=function(){},B.prototype.updateDisplay=function(h){this.mapBox.map&&(this.mapBox.map.repaint=!0)},B.prototype.createRaycaster=function(h){if(this.mapBox.map){var u=h.x/this.mapBox.map.transform.width*2-1,v=-h.y/this.mapBox.map.transform.height*2+1,M=this.mxObject2d.getCamera(),j=new H.Raycaster;j.linePrecision=this.mxObject2d.screenCoordLong2World(10);var z=new H.Matrix4().getInverse(M.projectionMatrix),J=new H.Vector3().applyMatrix4(z),te=new H.Vector3(u,v,1).applyMatrix4(z).clone().sub(J).normalize();return j.setFromCamera(new H.Vector2(u,v),M),j.set(J,te),j}return G.prototype.createRaycaster.call(this,h)},B.prototype.getRegistEventObject=function(){return this.mapBox.canvasContainer},B.prototype.getType=function(){return x.kMapBox},B.prototype.getDomMousePos=function(h){return this.mapBox.map?this.mapBox.map.dom_mousePos(h):void 0},B.prototype.screenCoord2World=function(h,u,v){if(this.mapBox.map){var M=this.mapBox.map.unproject({x:h,y:u}),j=this.mapBox.map.lnglat_to_mercator(M.lng,M.lat),z=new H.Vector3(j.x,j.y,0);return z.applyMatrix4(this.mapBox.matMapToCADDrawCoord),z}return G.prototype.screenCoord2World.call(this,h,u,v)},B.prototype.worldCoord2Screen=function(h,u,v){if(this.mapBox.map){var M=new H.Vector3(h,u,v);M.applyMatrix4(this.mapBox.matCADDrawCoordToMap);var j=this.mapBox.map.mercator_to_lnglat(M.x,M.y,0),z=this.mapBox.map.project([j.lng,j.lat]);return new H.Vector3(z.x,z.y,0)}G.prototype.worldCoord2Screen.call(this,h,u,v)},B.prototype.onInitThreejs=function(){var h=this,u=this.mapBox.threebox;if(u){var v=u.camera,M=u.scene,j=this.mapBox.canvas,z=u.renderer;this.canvas=j,z.autoClear=!1;var J=new E(v,j);this.mxObject2d.mapBoxInitThreeJSObject(M,v,z,J)}else{this.mxObject2d.onInitViewScene(),M=new H.Scene;var te=(j=this.mapBox.canvas).clientHeight,X=j.clientWidth;v=new H.OrthographicCamera(X/-2,X/2,te/2,te/-2,.1,1e21),this.canvas=j;var se=new H.DirectionalLight(16777215);se.position.set(0,-70,100).normalize(),M.add(se);var ve=new H.DirectionalLight(16777215);ve.position.set(0,70,100).normalize(),M.add(ve);var Ee=this.mxObject2d.getRendererParam();(Ee=Ee||{}).canvas=j,Ee.context=this.mapBox.gl,(z=new H.WebGLRenderer(Ee)).autoClear=!1,(J=new E(new H.Camera,j)).enabled=!1,this.mxObject2d.mapBoxInitThreeJSObject(M,v,z,J)}this.mxObject2d.initRendererParam({retver:"webgl2",webgl2:!0});var we=this;this.mapBox.render=function(Be,re){var fe=new H.Matrix4().fromArray(re);fe.multiply(h.matCADDrawCoordToMap);var ne=new H.Vector3(0,0,0);if(ne.applyMatrix4(fe),1<ne.z){var le=1-ne.z-1e-5;fe=new H.Matrix4().makeTranslation(0,0,le).multiply(fe)}we.mxObject2d.mapBoxRender(Be,fe,!!we.mapBox.threebox),we.mxObject2d.isRenderLoop()&&h.mapBox.map&&(h.mapBox.map.repaint=!0)},this.mapBox.onResize=function(){we.mxObject2d.mapBox_onResizeImp(we.canvas.clientWidth,we.canvas.clientHeight)}},B.prototype.updateCameraForm3dViewData=function(h){console.log("assert(0) map does not support 3ddwg")},B.prototype.updateCameraDisplayRange=function(h,u,v){if(this.mxObject2d.isCppMxCAD()){(z=new H.Matrix4).makeTranslation(-this.mapBox.cadOrigin.x,-this.mapBox.cadOrigin.y,-this.mapBox.cadOrigin.z),(J=new H.Matrix4).makeTranslation(this.mapBox.mapOrigin.x,this.mapBox.mapOrigin.y,this.mapBox.elevation),(te=new H.Matrix4).makeScale(this.mapBox.mapLenInCADUnits,-this.mapBox.mapLenInCADUnits,this.mapBox.mapLenInCADUnits);var M=J.multiply(te).multiply(z),j=this.mxObject2d.getDoc2CADMatrix();this.matCADDrawCoordToMap=M.clone().multiply(j),this.mapBox.matcadtsmall=new H.Matrix4,this.mapBox.matcadtsmall.getInverse(j),this.mapBox.matCADDrawCoordToMap=this.matCADDrawCoordToMap,this.mapBox.matMapToCADDrawCoord=new H.Matrix4,this.mapBox.matMapToCADDrawCoord.getInverse(this.matCADDrawCoordToMap),this.mapBox.matCadToMap=M,this.mapBox.matMapToCad=new H.Matrix4,this.mapBox.matMapToCad.getInverse(M),1e-5<Math.abs(v)&&this.setViewAngle(v),this.zoomW(h,u,!0,!1)}else{var z,J,te;(z=new H.Matrix4).makeTranslation(-this.mapBox.cadOrigin.x,-this.mapBox.cadOrigin.y,-this.mapBox.cadOrigin.z),(J=new H.Matrix4).makeTranslation(this.mapBox.mapOrigin.x,this.mapBox.mapOrigin.y,this.mapBox.elevation),(te=new H.Matrix4).makeScale(this.mapBox.mapLenInCADUnits,-this.mapBox.mapLenInCADUnits,this.mapBox.mapLenInCADUnits);var X=J.multiply(te).multiply(z),se=this.mxObject2d.getWorldToDoc();this.matCADDrawCoordToMap=X.clone().multiply(se),this.mapBox.matcadtsmall=new H.Matrix4,this.mapBox.matcadtsmall.getInverse(se),this.mapBox.matCADDrawCoordToMap=this.matCADDrawCoordToMap,this.mapBox.matMapToCADDrawCoord=new H.Matrix4,this.mapBox.matMapToCADDrawCoord.getInverse(this.matCADDrawCoordToMap),this.mapBox.matCadToMap=X,this.mapBox.matMapToCad=new H.Matrix4,this.mapBox.matMapToCad.getInverse(X)}},B);function B(h,u){var v=G.call(this,u)||this;return v.matCADDrawCoordToMap=new H.Matrix4,v.isPaning=!1,v.bakPan=!0,v.mapBox=h,v.mxObject2d=u,v.mapBox.matMapToCad=v.mapBox.matCadToMap=v.mapBox.matCADDrawCoordToMap=v.mapBox.matMapToCADDrawCoord=new H.Matrix4,v}o.MxDrawMapBoxThreeJS=T;var D,N=(m(I,D=k),I.prototype.onInitThreejs=function(){this.proxyObj.onInitThreejs()},I.prototype.onInitScene=function(){this.proxyObj.onInitScene()},I.prototype.getType=function(){return x.k3d},I.prototype.updateCameraDisplayRange=function(h,u,v){},I.prototype.updateCameraForm3dViewData=function(h){},I.prototype.addControlsChangeEvent=function(){var h=this.mxObject;this.mxObject.getOrbitControls().addEventListener("change",function(){F.MxJigCmdManager.OnThreeControlsChage(),h.callViewChange(),h.getMxDatabase().onViewChange(),h.getMcObject().isValid()&&h.getMcObject().getGripManager().onControlsChage(),h.getTempMarkDraw().clear(!0),h.updateDisplay()})},I.prototype.updateDisplay=function(h){h===void 0&&(h=!1),this.mxObject.updateDisplayImplement(h)},I.prototype.getRegistEventObject=function(){return this.mxObject.getCanvas()},I);function I(h){var u=D.call(this,h)||this;return u.proxyObj=h,u}o.MxDrawObject3dThreeJS=N},{"../Operate/MxJigCmdManager":54,"../UI/MxUiVue":65,three:19,"three-orbitcontrols":17}],76:[function(b,n,o){var a,m=this&&this.__extends||(a=function(C,S){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(Y,G){Y.__proto__=G}||function(Y,G){for(var T in G)Object.prototype.hasOwnProperty.call(G,T)&&(Y[T]=G[T])})(C,S)},function(C,S){if(typeof S!="function"&&S!==null)throw new TypeError("Class extends value "+String(S)+" is not a constructor or null");function Y(){this.constructor=C}a(C,S),C.prototype=S===null?Object.create(S):(Y.prototype=S.prototype,new Y)});function c(){}Object.defineProperty(o,"__esModule",{value:!0}),o.McDraw2d=o.McDraw3d=o.McDraw3dViewData=o.McDraw3dBase=void 0;var x=b("three"),A=b("../MxDrawData");o.McDraw3dBase=c;var H=(F.prototype.updateCamera=function(C,S,Y,G){var T=this.width,B=this.height;T<1e-5&&(T=1e-5),B<1e-5&&(B=1e-5);var D=Y/G,N=D*B;T<N?T=N:B=T/D,C.left=.5*-T,C.right=.5*T,C.top=.5*B,C.bottom=.5*-B,C.far=this.frontClip,C.near=this.backClip,C.up=this.up,C.zoom=1;var I=this.target.clone().add(this.dir);C.position.set(I.x,I.y,I.z),C.lookAt(this.target),C.updateProjectionMatrix(),S.target.x=this.target.x,S.target.y=this.target.y,S.target.z=this.target.z,S.update()},F);function F(){}o.McDraw3dViewData=H;var P,g=(m(E,P=c),E.prototype.is3DMode=function(){return!0},E.prototype.onResize=function(C,S,Y,G){var T=C.right-C.left,B=C.top-C.bottom;T<1e-5&&(T=1e-5),B<1e-5&&(B=1e-5);var D=Y/G,N=D*B;return T<N?T=N:B=T/D,C.left=.5*-T,C.right=.5*T,C.top=.5*B,C.bottom=.5*-B,C.updateProjectionMatrix(),S.update(),!0},E.prototype.initDisplayRange=function(C){var S=this.mcObject.mxObject;S.intiDoc2Wold(new x.Matrix4),S.initCAD2Doc(JSON.parse(C.DToSMat)),S.initializingObjectMatrix();var Y=new H;Y.dir=new x.Vector3(C.vecDirectionx,C.vecDirectiony,C.vecDirectionz),Y.up=new x.Vector3(C.vecUpx,C.vecUpy,C.vecUpz),Y.target=new x.Vector3(C.targetx,C.targety,C.targetz),Y.height=C.height,Y.width=C.width,Y.backClip=C.backClip,Y.frontClip=C.frontClip,S.updateCameraForm3dViewData(Y)},E);function E(){return P!==null&&P.apply(this,arguments)||this}o.McDraw3d=g;var _,k=(m(U,_=c),U.prototype.is3DMode=function(){return!1},U.prototype.initDisplayRange=function(C){var S=this.mcObject.mxObject;S.intiDoc2Wold(new x.Matrix4),S.initCAD2Doc(JSON.parse(C.DToSMat)),S.initializingObjectMatrix(),S.updateCameraDisplayRange(new x.Vector3(C.pt1x,C.pt1y,0),new x.Vector3(C.pt2x,C.pt2y,0),A.MxDrawData.m_isEnableDrawingViewAngle?C.viewangle:0)},U.prototype.onResize=function(C,S,Y,G){return this.mcObject.mxObject.callOnResizeImp(Y,G)},U);function U(){return _!==null&&_.apply(this,arguments)||this}o.McDraw2d=k},{"../MxDrawData":22,three:19}],77:[function(b,n,o){var a,m=this&&this.__extends||(a=function(T,B){return(a=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(D,N){D.__proto__=N}||function(D,N){for(var I in N)Object.prototype.hasOwnProperty.call(N,I)&&(D[I]=N[I])})(T,B)},function(T,B){if(typeof B!="function"&&B!==null)throw new TypeError("Class extends value "+String(B)+" is not a constructor or null");function D(){this.constructor=T}a(T,B),T.prototype=B===null?Object.create(B):(D.prototype=B.prototype,new D)});Object.defineProperty(o,"__esModule",{value:!0}),o.McDrawGripJig=o.McDrawGrip=o.McDrawSlect=o.McDrawGripData=void 0;var c=b("three"),x=b("../MxFun"),A=b("../Operate/MxJig"),H=b("../Operate/MxJigCmdManager"),F=b("../MxManager"),P=b("../MxDrawData"),g=b("../MxTools"),E=function(){this.threeObject=null};o.McDrawGripData=E;var _=(k.prototype.add=function(T){return!this.setId.has(T)&&(this.setId.add(T),this.mcObj.HighlightEntity(T,!0),!0)},k.prototype.remove=function(T){this.setId.has(T)&&(this.setId.delete(T),this.mcObj.HighlightEntity(T,!1))},k.prototype.removeAll=function(){var T=this;this.setId.forEach(function(B){T.mcObj.HighlightEntity(B,!1)}),this.setId.clear()},k.prototype.getAllSelect=function(){var T=[];return this.setId.forEach(function(B,D){T.push(D)}),T},k.prototype.getSelectCount=function(){return this.setId.size},k.prototype.isEmpty=function(){return this.setId.size==0},k);function k(T){this.mcObj=null,this.setId=new Set,this.mcObj=T}o.McDrawSlect=_;var U=(C.prototype.fireSelectChange=function(){this.isCallingSelectChange||(this.isCallingSelectChange=!0,this.mxObj.callEvent("selectChange",this.getAllSelect()),this.isCallingSelectChange=!1)},C.prototype.getParentGroup=function(){return this.drawGroup||(this.drawGroup=new c.Group,this.drawGroup.renderOrder=F.MxData.iGripRenderOrder,this.mxObj.getTheTempDrawContainer_SmallCoord_Draw().add(this.drawGroup)),this.drawGroup},C.prototype.reInit=function(){this.clearAll(),this.drawGroup&&x.MxFun.removeThreejsObject(this.drawGroup,this.mxObj.getTheTempDrawContainer_SmallCoord_Draw()),this.drawGroup=null,this.selectPoint1=null,this.selectPoint2=null},C.prototype.removeAllEntity=function(){var T=this.getParentGroup();this.mapGrips.forEach(function(B,D,N){for(var I=B.length,h=0;h<I;h++){var u=B[h];x.MxFun.removeThreejsObject(u.threeObject,T)}}),this.mapGrips=new Map},C.prototype.deleteGripData=function(T){var B=this.getParentGroup(),D=this.mapGrips.get(T);if(D)for(var N=D.length,I=0;I<N;I++){var h=D[I];x.MxFun.removeThreejsObject(h.threeObject,B)}this.mapGrips.delete(T)},C.prototype.addGripData=function(T,B,D,N){var I=this.mapGrips.get(T);I==null&&(I=new Array,this.mapGrips.set(T,I));var h=new E;return h.iIndex=B,h.point=new c.Vector3(D,N),I.push(h),h},C.prototype.createGripDisplayObject=function(T){var B=this.getParentGroup();T.geometry=new c.Geometry;var D=this.mxObj.toSmallcoord2(T.point.x,T.point.y,T.point.z),N=this.mxObj.screenCoordLong2World(.5*P.MxDrawData.m_dInputRectWidth);T.geometry.vertices.push(new c.Vector3(D.x-N,D.y-N,0)),T.geometry.vertices.push(new c.Vector3(D.x-N,D.y+N,0)),T.geometry.vertices.push(new c.Vector3(D.x+N,D.y+N,0)),T.geometry.vertices.push(new c.Vector3(D.x+N,D.y-N,0)),T.geometry.faces.push(new c.Face3(0,1,2)),T.geometry.faces.push(new c.Face3(2,3,0)),T.geometry.computeFaceNormals(),T.geometry.computeVertexNormals();var I=g.MxTools.getColor(P.MxDrawData.m_gripPointColor),h=g.MxTools.getOpacity(P.MxDrawData.m_gripPointColor),u=new c.MeshBasicMaterial({color:I,transparent:!0,depthTest:!1,side:c.DoubleSide,opacity:h}),v=new c.Mesh(T.geometry,u);B.add(v),T.threeObject=v},C.prototype.setPrvCommandSelect=function(T){this.aryPrvCommandSelect=T},C.prototype.getPrvCommandSelect=function(){return this.aryPrvCommandSelect},C.prototype.getAllSelect=function(){return this.mcSelect.getAllSelect()},C.prototype.getSelectPoints=function(){var T=this.selectPoint1!==null;return T&&this.mcSelect.getSelectCount()==0&&this.aryPrvCommandSelect.length==0&&(T=!1),{point1:this.selectPoint1,point2:this.selectPoint2,isvalid:T}},C.prototype.clearAll=function(){var T=this.mcSelect.isEmpty();return this.mcSelect.removeAll(),this.mapGrips.size==0?!T:(this.removeAllEntity(),!0)},C.prototype.clearGripDisplay=function(){return this.mapGrips.size!=0&&(this.removeAllEntity(),!0)},C.prototype.onControlsChage=function(){var T=this;if(this.mapGrips.size!=0){var B=this.mxObj.screenCoordLong2World(.5*P.MxDrawData.m_dInputRectWidth),D=!1;this.mapGrips.forEach(function(N,I,h){for(var u=N.length,v=0;v<u;v++){var M=N[v];if(M.geometry.vertices.length==4){var j=T.mxObj.cadCoord2Doc(M.point.x,M.point.y,M.point.z);M.geometry.vertices[0].x=j.x-B,M.geometry.vertices[0].y=j.y-B,M.geometry.vertices[1].x=j.x-B,M.geometry.vertices[1].y=j.y+B,M.geometry.vertices[2].x=j.x+B,M.geometry.vertices[2].y=j.y+B,M.geometry.vertices[3].x=j.x+B,M.geometry.vertices[3].y=j.y-B,M.geometry.computeFaceNormals(),M.geometry.computeVertexNormals(),M.geometry.verticesNeedUpdate=!0,D=!0}}}),D&&this.mxObj.resetRenderer()}},C.prototype.getGripNum=function(T){for(var B=new Set,D=T.length(),N=0;N<D;N++)B.add(T.at(N));var I=0;return this.mapGrips.forEach(function(h,u){B.has(u)||(I+=h.length)}),I},C.prototype.hitTest=function(T){var B={grips:new Array,ids:new Array,pt:T},D=new c.Vector3(T.x,T.y,0),N=this.mxObj.viewCoordLong2Cad(32);return this.mapGrips.forEach(function(I,h){for(var u=I.length,v=0;v<u;v++){var M=I[v];if(M.point.distanceTo(D)<=N){B.grips.push(M),B.ids.push(h),B.pt=M.point;break}}}),B},C.prototype.onMouseLBDown=function(T){if(P.MxDrawData.m_isEnableCADEntityGripEidt==1){if(P.MxDrawData.m_isEnableGripEidt!=1)return!1}else if(P.MxDrawData.m_isEnableCADEntityGripEidt==0)return!1;var B=this.hitTest(T);return B.grips.length!=0&&(x.MxFun.sendStringToExecute("McDraw_GripEdit",B),!0)},C.prototype.gripEditImp=function(T){var B=T.grips,D=T.ids,N=T.pt,I=new Y(N,B,D,this.mcObj);H.MxJigCmdManager.runCmd(I)},C.prototype.addGridDisplay=function(T,B){var D=this;T&&T.length()!=0&&(this.deleteGripData(B),T.forEach(function(N,I){var h=D.addGripData(B,I,N.x,N.y);D.createGripDisplayObject(h)}))},C.prototype.upEntityGridDisplay=function(T){if(P.MxDrawData.m_isEnableGripEidt==0||T==0)return 0;var B=this.mcObj.ObjectIdToObject(T);if(!B)return 0;var D=B.getGripPoints();return this.addGridDisplay(D,T),D.length()},C.prototype.doPointSelect=function(T,B){if(B===void 0&&(B=!1),!this.mcObj.mcObjectImp)return!1;var D=this.mxObj.docCoordLong2Cad(this.mxObj.screenCoordLong2Doc(10)),N=this.mxObj.screenCoord2Doc(T.x,T.y,0),I=this.mxObj.docCoord2Cad(N.x,N.y,N.z),h=this.mcObj.mcObjectImp.IntelliSelect_PointSelect(I.x,I.y,D),u=h.length();if(u==0)return this.mcObj.mxappimp.DestroyMdGeLongArray(h),!1;if(this.mxObj.pointMultipleSelect()||(this.mxObj.getMxDatabase().clearMxCurrentSelect(),this.clearAll(),B=!1),B)for(var v=0;v<u;v++){var M=h.at(v);this.mcSelect.remove(M),this.deleteGripData(M)}else{var j=u+this.mcSelect.getSelectCount(),z=!1;for(v=0;v<u;v++)M=h.at(v),this.mcSelect.add(M),j<2e3?this.upEntityGridDisplay(M):z=!0;z&&this.clearGripDisplay()}return this.selectPoint1=I,this.selectPoint2=I,this.fireSelectChange(),this.mcObj.mxappimp.DestroyMdGeLongArray(h),!0},C.prototype.doRangeSelect=function(T,B,D){if(D===void 0&&(D=!1),this.mcObj.mcObjectImp){var N,I=T.clone(),h=B.clone();N=B.x<T.x?0:1;var u=this.mcObj.mcObjectImp.IntelliSelect_RangeSelect(I.x,I.y,h.x,h.y,N),v=u.length();if(this.mxObj.pointMultipleSelect()||(D=!1),D)for(var M=0;M<v;M++){var j=u.at(M);this.mcSelect.remove(j),this.deleteGripData(j)}else{var z=v+this.mcSelect.getSelectCount(),J=this.getGripNum(u),te=!1;for(M=0;M<v;M++)j=u.at(M),this.mcSelect.add(j),z<500&&J<2e3?J+=this.upEntityGridDisplay(j):te=!0;te&&this.clearGripDisplay()}0<v&&(this.selectPoint1=I,this.selectPoint2=h,this.fireSelectChange()),this.mcObj.mxappimp.DestroyMdGeLongArray(u)}},C.prototype.addSelect=function(T,B,D){if(D===void 0&&(D=!0),T==0)return!1;var N=this.mcSelect.add(T);return D&&this.upEntityGridDisplay(T),B&&this.fireSelectChange(),N},C);function C(T,B){this.mxObj=null,this.mcObj=null,this.mcSelect=null,this.mapGrips=new Map,this.aryPrvCommandSelect=[],this.drawGroup=null,this.isCallingSelectChange=!1,this.selectPoint1=null,this.selectPoint2=null,this.mxObj=T,this.mcObj=B,this.mcSelect=new _(B)}o.McDrawGrip=U;var S,Y=(m(G,S=A.McEdJigCommand),G.prototype.onExitCommand=function(T){this.tempEntity=null,this.tempEntityWordDraw=null,S.prototype.onExitCommand.call(this,T)},G.prototype.sampler=function(){var T=H.MxJigCmdManager.InType.kGetBegan|H.MxJigCmdManager.InType.kGetEnd,B=this.acquirePoint(T);if(B.status==H.MxJigCmdManager.DragStatus.kNormal&&(this.currPt=B.pt,this.tempEntity)){var D=new c.Vector3(B.pt.x,B.pt.y,B.pt.z),N=new c.Vector3(this.pt.x,this.pt.y,this.pt.z);this.tempEntityWordDraw=this.tempEntity.clone(),this.tempEntityWordDraw&&this.tempEntityWordDraw.moveGripPointsAt(this.grips[0].iIndex,D.x-N.x,D.y-N.y,D.z-N.z)}return B.status},G.prototype.getTypeName=function(){return"McDrawGripEdit"},G.prototype.done=function(T){if(T==H.MxJigCmdManager.DragStatus.kNormal){for(var B=new c.Vector3(this.pt.x,this.pt.y,this.pt.z),D=new c.Vector3(this.currPt.x,this.currPt.y,this.currPt.z),N=D.x-B.x,I=D.y-B.y,h=this.getMxObject().getMcObject().getGripManager(),u=this.grips.length,v=[],M=0;M<u;M++){var j=this.grips[M],z=this.ids[M],J=this.mcObj.ObjectIdToObject(z);J&&J.moveGripPointsAt(j.iIndex,N,I,0),h.upEntityGridDisplay(z),v.push({type:"mxcad",id:z,index:j.iIndex,curentPoint:this.currPt,point:j.point,offset_x:N,offset_y:I})}0<v.length&&this._mxObject.callEvent("objectGripEdit",v)}return H.MxJigCmdManager.DoneStatius.kExitCommand},G.prototype.upDisplay=function(){this.tempEntityWordDraw&&(this.mcObj.onReadyJigUpdateDispla(1,this.currPt,this.grips[0].iIndex),this.tempEntityWordDraw.tempRelationObject(),this.mcObj.onJigDrawEntityDisplay(this.tempEntityWordDraw.getImp()),this.tempEntityWordDraw.freeTempRelationObject())},G);function G(T,B,D,N){var I=S.call(this)||this;return I.pt=T,I.grips=B,I.ids=D,I.currPt=T,I.mcObj=N,I.ids.length&&(I.tempEntity=N.ObjectIdToObject(I.ids[0])),I}o.McDrawGripJig=Y},{"../MxDrawData":22,"../MxFun":27,"../MxManager":29,"../MxTools":38,"../Operate/MxJig":53,"../Operate/MxJigCmdManager":54,three:19}],78:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McDrawObject=void 0;var a=b("../MxManager"),m=b("three"),c=b("../MxFun"),x=b("./McDrawGrip"),A=b("./McTextureManager"),H=b("./McDraw3D"),F=window;F.McDrawObjectEvent_openFileComplete=function(E,_,k){var U=a.MxManager.getMxObject(_);U&&U.getMcObject().openFileComplete(E,k)},F.McDrawObjectEvent_objectModified=function(E,_){var k=a.MxManager.getMxObject(E);if(k){var U=k.getMcObject(),C=new U.mxcppImp.McDrawResbuf;C.Connect(_,!1);for(var S=C.AtString(0,!1),Y=C.GetCount(),G=[],T=1;T+1<Y;T+=2){var B=C.AtObjectId(T),D=C.Atlong(T+1)==1,N=U.mxapp.newMcObjectId(B,0);G.push({id:N,erase:D,status:C.Atlong(T+1)})}k.callEvent("objectModified",{cmd:S,entitys:G})}},F.McDrawObjectEvent_call=function(E,_,k){if(_=="mxpost")try{var U=JSON.parse(k);if(U&&U.url&&U.data){var C=new XMLHttpRequest;C.open("POST",U.url,!0),C.setRequestHeader("Content-Type","application/x-www-form-urlencoded"),C.onreadystatechange=function(){C.readyState===4&&C.status},C.send(U.data)}}catch{}else if(_=="regen_complete"){if(!(S=a.MxManager.getMxObject(E)))return;S.regenAllMxDbEntity()}else{var S;if(!(S=a.MxManager.getMxObject(E)))return;S.callEvent(_,k)}},F.McDrawObjectEvent_synchronizeuUdateDisplayRange=function(E,_){var k=a.MxManager.getMxObject(E);k&&k.getMcObject().updateDisplayRange(_==1)},F.McDrawObjectEvent_osnapComplete=function(E,_){var k=a.MxManager.getMxObject(E);k&&k.getMcObject().callOsnapComplete(_)},F.McDrawObjectEvent_mcutPrintf=function(E){c.MxFun.acutPrintf(E)},F.McDrawObjectEvent_updateDisplay=function(E){var _=a.MxManager.getMxObject(E);_&&_.updateDisplay()},F.McDrawObjectEvent_loadImages=function(E,_,k,U){var C=a.MxManager.getMxObject(E);if(C){C.getMcObject().getTextureManager().clear();var S=0,Y=[];U.substring(0,5)=="blob:"&&(U=U.substring(5)),_.forEach(function(G){var T=a.MxManager.getMxCpp().decodeFromGb2312(G),B=T;T.lastIndexOf("/")==-1?(k&&0<k.length&&(B=k+"/"+B),U&&0<U.length&&(B=U+"/"+B)):T=T.substring(T.lastIndexOf("/")+1).toLowerCase(),Y.push(B),C.getMcObject().getTextureManager().loadImage(B,T,function(){++S==_.length&&(Y.forEach(function(D){C.getMcObject().getTextureManager().createOpenGLTexture(D)}),C.updateDisplay(!1))})})}},F.McDrawObjectEvent_loadImagesBase64=function(E,_){var k=a.MxManager.getMxObject(E);if(k){var U=_.indexOf("data:image/png;base64");if(U!=-1){var C=_.substring(0,U);_=_.substring(U),k.getMcObject().getTextureManager().loadImageBase64(C,_,function(){k.getMcObject().getTextureManager().createOpenGLTexture(C),k.updateDisplay(!1)})}}},F.McDrawObjectEvent_viewCoord2Cad=function(E,_,k,U,C){var S=a.MxManager.getMxObject(E);if(S){var Y=new(S.getMcObject()).mxcppImp.McDrawResbuf;Y.Connect(C,!1);var G=S.viewCoord2Cad(_,k,U);Y.AddDouble(G.x,-10),Y.AddDouble(G.y,-10),Y.AddDouble(G.z,-10)}},F.McDrawObjectEvent_cadCoord2View=function(E,_,k,U,C){var S=a.MxManager.getMxObject(E);if(S){var Y=new(S.getMcObject()).mxcppImp.McDrawResbuf;Y.Connect(C,!1);var G=S.cadCoord2View(_,k,U);Y.AddDouble(G.x,-10),Y.AddDouble(G.y,-10),Y.AddDouble(G.z,-10)}};var P=(g.prototype.getTextureManager=function(){return this.textureManager},g.prototype.isValid=function(){return this.mcObjectImp!==null},g.prototype.isPaperSpaceDisplay=function(){return!!this.mcObjectImp&&this.mcObjectImp.isPaperSpaceDisplay()},g.prototype.getLayoutBkColor=function(){return this.mcObjectImp?this.mcObjectImp.getLayoutBkColor():16777215},g.prototype.fireStartRunCommand=function(E,_){this.mcObjectImp&&this.mcObjectImp.fireStartRunCommand(E,_)},g.prototype.fireEndRunCommand=function(E,_){this.mcObjectImp&&this.mcObjectImp.fireEndRunCommand(E,_)},g.prototype.undo=function(){this.mcObjectImp&&this.mcObjectImp.undo()},g.prototype.redo=function(){this.mcObjectImp&&this.mcObjectImp.redo()},g.prototype.initCAD2Doc=function(E,_){this.matCad2doc=E,this.matDoc2cad=_},g.prototype.getSysVarLong=function(E){return this.mcObjectImp.GetSysVarLong(E)},g.prototype.getSysVarDouble=function(E){return this.mcObjectImp.GetSysVarDouble(E)},g.prototype.getSysVarPoint=function(E){var _=this.mcObjectImp.GetSysVarPoint(E);return new m.Vector3(_.x,_.y,_.z)},g.prototype.ObjectIdToMdObjectImp=function(E){return this.mcObjectImp?this.mxcpp.App.getImp().ObjectIdToMdObject(E):null},g.prototype.DestroyObject=function(E){if(!this.mcObjectImp)return null;this.mcObject.destroyObject(E)},g.prototype.onJigCommandEnd=function(){this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onJigCommandEnd()},g.prototype.callOsnapComplete=function(E){if(this.m_retCall&&E)try{var _=E;if(typeof E=="string"&&(_=JSON.parse(E)),_.callId!=this.m_lOsnapCallCount)return;this.m_retCall(_)}catch{}},g.prototype.doc2cad1=function(E){return E},g.prototype.doc2cad2=function(E,_){return new m.Vector3(E,_,0)},g.prototype.cad2doc1=function(E){return E},g.prototype.cad2doc2=function(E,_){return new m.Vector3(E,_,0)},g.prototype.onNotifyOsnap=function(E,_){if(this.mcObjectImp){this.m_lOsnapCallCount++,this.m_retCall=_,1e5<this.m_lOsnapCallCount&&(this.m_lOsnapCallCount=1);var k,U=this.doc2cad2(E.ptx,E.pty);E.isValidPrvInputPoint&&(k=this.doc2cad2(E.prvPtx,E.prvPty)),this.mcObjectImp.Osnap_NotifyOsnap(U.x,U.y,E.isValidPrvInputPoint,E.isValidPrvInputPoint?k.x:0,E.isValidPrvInputPoint?k.y:0,E.osmode,E.SearchRnge,this.m_lOsnapCallCount)}},g.prototype.DrawEntity=function(E,_,k){E&&this.mcObjectImp&&(_&&E.SetTrueColor(this.THREEColor2MdCmColor(_)),this.mcObjectImp.DrawEntity(E,k))},g.prototype.onJigDrawEntityDisplay=function(E,_,k){E&&this.mcObjectImp&&(_&&E.SetTrueColor(this.THREEColor2MdCmColor(_)),this.mcObjectImp.EntityTempWordDraw_onJigDrawEntityDisplay(E,k===!0))},g.prototype.THREEColor2MdCmColor=function(E){var _=new m.Color(E),k=new this.mxcppImp.MdCmColor;return k.setRGB(255*_.r,255*_.g,255*_.b),k},g.prototype.onJigDrawEntityDisplay_line=function(E,_,k,U,C,S,Y){if(this.mcObjectImp){var G=new this.mxcppImp.MdDbLine,T=new this.mxcppImp.MdGePoint3d;T.x=E,T.y=_,T.z=k,G.setStartPoint(T);var B=new this.mxcppImp.MdGePoint3d;B.x=U,B.y=C,B.z=S,G.setEndPoint(B),G.SetTrueColor(this.THREEColor2MdCmColor(Y)),this.mcObjectImp.EntityTempWordDraw_onJigDrawEntityDisplay(G,!1)}},g.prototype.DrawLine=function(E,_,k,U,C,S,Y){if(this.mcObjectImp){var G=new this.mxcppImp.MdDbLine,T=new this.mxcppImp.MdGePoint3d;T.x=E,T.y=_,T.z=k,G.setStartPoint(T);var B=new this.mxcppImp.MdGePoint3d;B.x=U,B.y=C,B.z=S,G.setEndPoint(B),G.SetTrueColor(this.THREEColor2MdCmColor(Y)),this.mcObjectImp.DrawEntity(G,!1)}},g.prototype.HighlightEntity=function(E,_){if(!this.mcDrawUtility)return!1;this.mcDrawUtility.highlightEntity(E,_)},g.prototype.onReadyJigUpdateDispla=function(E,_,k){E===void 0&&(E=0),_===void 0&&(_=void 0),k===void 0&&(k=-1),this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onReadyJigUpdateDispla(E,_?_.x:0,_?_.y:0,k)},g.prototype.onJigClearDisplay=function(){this.mcObjectImp&&this.mcObjectImp.EntityTempWordDraw_onJigClearDisplay()},g.prototype.ObjectIdToObject=function(E){return this.mcObject?this.mxcpp.App.objectIdToObject(E):null},g.prototype.initMxObject=function(E){this.mxObject=E},g.prototype.init=function(E,_){_.initMxObject(E),this.mxObject=E,this.mcObject=_,this.mcObjectImp=_.getImp(),this.mxcpp=_.getMxCpp(),this.mxcppImp=this.mxcpp.mxcadassemblyimp,this.mxapp=this.mxcpp.App,this.mxappimp=this.mxapp.getImp(),this.grip=new x.McDrawGrip(E,this),this.mcDrawUtility=new this.mxcppImp.McDrawUtility,this.textureManager=new A.McTextureManager(this,E.getRenderer().getContext());var k=this;this.mxObject.addEvent("dragWillEnd",function(){k.mcObjectImp.fireEventDragWillEnd()})},g.prototype.setSize=function(E,_){if(!this.mcObjectImp)return!1;this.mcObjectImp.fireEventWindowSize(E,_)},g.prototype.getGripManager=function(){return this.grip},g.prototype.updateDisplayRange=function(E){if(E===void 0&&(E=!1),this.mcObjectImp){var _=this.mcObjectImp.getViewDataJsonParam(E);_=_.replace(/\\/g,"\\\\");try{var k=JSON.parse(_),U=this.mxObject;if(k!=null){k.is3d?this.mxdraw3d.is3DMode()||(this.mxdraw3d=new H.McDraw3d,this.mxdraw3d.mcObject=this):this.mxdraw3d.is3DMode()&&(this.mxdraw3d=new H.McDraw2d,this.mxdraw3d.mcObject=this),this.mxdraw3d.initDisplayRange(k),U.initAllLayoutName(JSON.parse(k.layout)),U.updateDisplay(!0);var C=c.MxFun.getUiObj();C!=null&&(C.SetLayoutData(k.layout),C.UpDisplayLayout())}}catch{console.log("getViewDataJsonParam exception")}}},g.prototype.openFileComplete=function(E,_){this.updateDisplayRange(),this.mxObject.callOpenFileComplete(E,_)},g.prototype.updateDisplayMapBox=function(E){return!!this.mcObjectImp&&(this.mxObject.getScene().background!==null&&console.log("mxerror: background must be empty"),this.mcObjectImp_updateDisplay(new m.Matrix4().elements,E.elements))},g.prototype.mcObjectImp_updateDisplay=function(E,_){if(this.m_isCallingUpDisplay)return!0;var k=!(this.m_isCallingUpDisplay=!0);try{k=this.mcObjectImp.updateDisplay(E,_),this.m_isCallingUpDisplay=!1}catch(U){this.m_isCallingUpDisplay=!1,console.log(U)}return k},g.prototype.updateDisplay=function(){if(!this.mcObjectImp)return!1;var E=this.mxObject.getCamera();this.mxObject.getScene().background!==null&&console.log("mxerror: background must be empty");var _=new m.Matrix4;_.multiplyMatrices(E.matrixWorldInverse,this.mxObject.getDoc2World());var k=E.projectionMatrix;return this.mcObjectImp_updateDisplay(_.elements,k.elements)},g.prototype.updateDisplayMatrixData=function(E){if(this.mcObjectImp){var _=this.mxObject.getCamera(),k=new m.Matrix4;k.multiplyMatrices(_.matrixWorldInverse,this.mxObject.getDoc2World());var U=_.projectionMatrix;return this.mcObjectImp.updateDisplayMatrixData(k.elements,U.elements,!!E)}},g.prototype.setViewAngle=function(E){this.mcObjectImp&&this.mcObjectImp.fireViewAngleChange(E)},g.prototype.createTexture=function(){return this.mcObjectImp.createTexture()},g.prototype.deleteTexture=function(E){return this.mcObjectImp.deleteTexture(E)},g.prototype.bindTexture=function(E,_){return this.mcObjectImp.bindTexture(E,_)},g.prototype.allocTextureHandle=function(E){return this.mcObjectImp.allocTextureHandle(E)},g.prototype.registTexture=function(E,_){return this.mcObjectImp.registTexture(E,_)},g.prototype.makeCurrent=function(){this.mcObjectImp&&this.mcObjectImp.makeCurrent()},g);function g(){this.grip=null,this.mcObjectImp=null,this.mxcppImp=null,this.mxcpp=null,this.mcObject=null,this.mxapp=null,this.mxappimp=null,this.mcDrawUtility=null,this.m_lOsnapCallCount=1,this.m_retCall=null,this.matCad2doc=new m.Matrix4,this.matDoc2cad=new m.Matrix4,this.m_isCallingUpDisplay=!1,this.mxdraw3d=new H.McDraw2d,this.mxdraw3d.mcObject=this}o.McDrawObject=P},{"../MxFun":27,"../MxManager":29,"./McDraw3D":76,"./McDrawGrip":77,"./McTextureManager":79,three:19}],79:[function(b,n,o){Object.defineProperty(o,"__esModule",{value:!0}),o.McTextureManager=void 0;var a=b("three"),m=b("../MxManager"),c=(x.prototype.get=function(F){if(this.extensions[F]!==void 0)return this.extensions[F];var P;switch(F){case"WEBGL_depth_texture":P=this.gl.getExtension("WEBGL_depth_texture")||this.gl.getExtension("MOZ_WEBGL_depth_texture")||this.gl.getExtension("WEBKIT_WEBGL_depth_texture");break;case"EXT_texture_filter_anisotropic":P=this.gl.getExtension("EXT_texture_filter_anisotropic")||this.gl.getExtension("MOZ_EXT_texture_filter_anisotropic")||this.gl.getExtension("WEBKIT_EXT_texture_filter_anisotropic");break;case"WEBGL_compressed_texture_s3tc":P=this.gl.getExtension("WEBGL_compressed_texture_s3tc")||this.gl.getExtension("MOZ_WEBGL_compressed_texture_s3tc")||this.gl.getExtension("WEBKIT_WEBGL_compressed_texture_s3tc");break;case"WEBGL_compressed_texture_pvrtc":P=this.gl.getExtension("WEBGL_compressed_texture_pvrtc")||this.gl.getExtension("WEBKIT_WEBGL_compressed_texture_pvrtc");break;default:P=this.gl.getExtension(F)}return P===null&&console.warn("THREE.WebGLRenderer: "+F+" extension not supported."),this.extensions[F]=P},x);function x(F){this.extensions={},this.gl=F}var A=(H.prototype.allocHandle=function(F){return this.mcObject.allocTextureHandle(m.MxManager.getMxCpp().encodeToGb2312(F))},H.prototype.convert=function(F){var P;if(F===a.UnsignedByteType)return 5121;if(F===a.UnsignedShort4444Type)return 32819;if(F===a.UnsignedShort5551Type)return 32820;if(F===a.UnsignedShort565Type)return 33635;if(F===a.ByteType)return 5120;if(F===a.ShortType)return 5122;if(F===a.UnsignedShortType)return 5123;if(F===a.IntType)return 5124;if(F===a.UnsignedIntType)return 5125;if(F===a.FloatType)return 5126;if(F===a.HalfFloatType)return this.isWebGL2?5131:(P=this.extensions.get("OES_texture_half_float"))!==null?P.HALF_FLOAT_OES:null;if(F===a.AlphaFormat)return 6406;if(F===a.RGBFormat)return 6407;if(F===a.RGBAFormat)return 6408;if(F===a.LuminanceFormat)return 6409;if(F===a.LuminanceAlphaFormat)return 6410;if(F===a.DepthFormat)return 6402;if(F===a.DepthStencilFormat)return 34041;if(F===a.RedFormat)return 6403;if(F===a.RedIntegerFormat)return 36244;if(F===a.RGFormat)return 33319;if(F===a.RGIntegerFormat)return 33320;if(F===a.RGBIntegerFormat)return 36248;if(F===a.RGBAIntegerFormat)return 36249;if(F===a.RGB_S3TC_DXT1_Format||F===a.RGBA_S3TC_DXT1_Format||F===a.RGBA_S3TC_DXT3_Format||F===a.RGBA_S3TC_DXT5_Format){if((P=this.extensions.get("WEBGL_compressed_texture_s3tc"))===null)return null;if(F===a.RGB_S3TC_DXT1_Format)return P.COMPRESSED_RGB_S3TC_DXT1_EXT;if(F===a.RGBA_S3TC_DXT1_Format)return P.COMPRESSED_RGBA_S3TC_DXT1_EXT;if(F===a.RGBA_S3TC_DXT3_Format)return P.COMPRESSED_RGBA_S3TC_DXT3_EXT;if(F===a.RGBA_S3TC_DXT5_Format)return P.COMPRESSED_RGBA_S3TC_DXT5_EXT}if(F===a.RGB_PVRTC_4BPPV1_Format||F===a.RGB_PVRTC_2BPPV1_Format||F===a.RGBA_PVRTC_4BPPV1_Format||F===a.RGBA_PVRTC_2BPPV1_Format){if((P=this.extensions.get("WEBGL_compressed_texture_pvrtc"))===null)return null;if(F===a.RGB_PVRTC_4BPPV1_Format)return P.COMPRESSED_RGB_PVRTC_4BPPV1_IMG;if(F===a.RGB_PVRTC_2BPPV1_Format)return P.COMPRESSED_RGB_PVRTC_2BPPV1_IMG;if(F===a.RGBA_PVRTC_4BPPV1_Format)return P.COMPRESSED_RGBA_PVRTC_4BPPV1_IMG;if(F===a.RGBA_PVRTC_2BPPV1_Format)return P.COMPRESSED_RGBA_PVRTC_2BPPV1_IMG}return F===a.RGB_ETC1_Format?(P=this.extensions.get("WEBGL_compressed_texture_etc1"))!==null?P.COMPRESSED_RGB_ETC1_WEBGL:null:F===a.RGBA_ASTC_4x4_Format||F===a.RGBA_ASTC_5x4_Format||F===a.RGBA_ASTC_5x5_Format||F===a.RGBA_ASTC_6x5_Format||F===a.RGBA_ASTC_6x6_Format||F===a.RGBA_ASTC_8x5_Format||F===a.RGBA_ASTC_8x6_Format||F===a.RGBA_ASTC_8x8_Format||F===a.RGBA_ASTC_10x5_Format||F===a.RGBA_ASTC_10x6_Format||F===a.RGBA_ASTC_10x8_Format||F===a.RGBA_ASTC_10x10_Format||F===a.RGBA_ASTC_12x10_Format||F===a.RGBA_ASTC_12x12_Format?(P=this.extensions.get("WEBGL_compressed_texture_astc"))!==null?F:null:F===a.UnsignedInt248Type?this.isWebGL2?34042:(P=this.extensions.get("WEBGL_depth_texture"))!==null?P.UNSIGNED_INT_24_8_WEBGL:null:void 0},H.prototype.textureNeedsPowerOfTwo=function(F){return F.wrapS!==1001||F.wrapT!==1001||F.minFilter!==1003&&F.minFilter!==1006},H.prototype.createCanvas=function(F,P){return document.createElementNS("http://www.w3.org/1999/xhtml","canvas")},H.prototype.floorPowerOfTwo=function(F){return Math.pow(2,Math.floor(Math.log(F)/Math.LN2))},H.prototype.resizeImage=function(F,P,g,E){var _=1;if((F.width>E||F.height>E)&&(_=E/Math.max(F.width,F.height)),_<1||P===!0){if(typeof HTMLImageElement<"u"&&F instanceof HTMLImageElement||typeof HTMLCanvasElement<"u"&&F instanceof HTMLCanvasElement||typeof ImageBitmap<"u"&&F instanceof ImageBitmap){var k=P?this.floorPowerOfTwo:Math.floor,U=k(_*F.width),C=k(_*F.height);this._canvas===void 0&&(this._canvas=this.createCanvas(U,C));var S=g?this.createCanvas(U,C):this._canvas;return S.width=U,S.height=C,S.getContext("2d").drawImage(F,0,0,U,C),console.warn("THREE.WebGLRenderer: Texture has been resized from ("+F.width+"x"+F.height+") to ("+U+"x"+C+")."),S}return"data"in F&&console.warn("THREE.WebGLRenderer: Image in DataTexture is too big ("+F.width+"x"+F.height+")."),F}return F},H.prototype.mathIsPowerOfTwo=function(F){return(F&F-1)==0&&F!==0},H.prototype.isPowerOfTwo=function(F){return this.mathIsPowerOfTwo(F.width)&&this.mathIsPowerOfTwo(F.height)},H.prototype.getInternalFormat=function(F,P,g){if(this.isWebGL2===!1)return P;if(F!==null){if(this._gl[F]!==void 0)return this._gl[F];console.warn("THREE.WebGLRenderer: Attempt to use non-existing WebGL internal format '"+F+"'")}var E=P;return P===6403&&(g===5126&&(E=33326),g===5131&&(E=33325),g===5121&&(E=33321)),P===6407&&(g===5126&&(E=34837),g===5131&&(E=34843),g===5121&&(E=32849)),P===6408&&(g===5126&&(E=34836),g===5131&&(E=34842),g===5121&&(E=32856)),E===33325||E===33326||E===34842||E===34836?this.extensions.get("EXT_color_buffer_float"):E!==34843&&E!==34837||console.warn("THREE.WebGLRenderer: Floating point textures with RGB format not supported. Please use RGBA instead."),E},H.prototype.filterFallback=function(F){return F===a.NearestFilter||F===a.NearestMipmapNearestFilter||F===a.NearestMipmapLinearFilter?9728:9729},H.prototype.setTextureParameters=function(F,P,g){var E={};E[a.RepeatWrapping]=10497,E[a.ClampToEdgeWrapping]=33071,E[a.MirroredRepeatWrapping]=33648;var _={};_[a.NearestFilter]=9728,_[a.NearestMipmapNearestFilter]=9984,_[a.NearestMipmapLinearFilter]=9986,_[a.LinearFilter]=9729,_[a.LinearMipmapNearestFilter]=9985,_[a.LinearMipmapLinearFilter]=9987,g?(this._gl.texParameteri(F,10242,E[P.wrapS]),this._gl.texParameteri(F,10243,E[P.wrapT]),F!==32879&&F!==35866||this._gl.texParameteri(F,32882,E[P.wrapR]),this._gl.texParameteri(F,10240,_[P.magFilter]),this._gl.texParameteri(F,10241,_[P.minFilter])):(this._gl.texParameteri(F,10242,33071),this._gl.texParameteri(F,10243,33071),F!==32879&&F!==35866||this._gl.texParameteri(F,32882,33071),P.wrapS===a.ClampToEdgeWrapping&&P.wrapT===a.ClampToEdgeWrapping||console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.wrapS and Texture.wrapT should be set to THREE.ClampToEdgeWrapping."),this._gl.texParameteri(F,10240,this.filterFallback(P.magFilter)),this._gl.texParameteri(F,10241,this.filterFallback(P.minFilter)),P.minFilter!==a.NearestFilter&&P.minFilter!==a.LinearFilter&&console.warn("THREE.WebGLRenderer: Texture is not power of two. Texture.minFilter should be set to THREE.NearestFilter or THREE.LinearFilter."))},H.prototype.textureNeedsGenerateMipmaps=function(F,P){return F.generateMipmaps&&P&&F.minFilter!==a.NearestFilter&&F.minFilter!==a.LinearFilter},H.prototype.generateMipmap=function(F,P,g,E,_){this._gl.generateMipmap(P)},H.prototype.clear=function(){var F=this;Object.keys(this.mapImagePathToTexture).forEach(function(P){var g=F.mapImagePathToTexture[P];g&&g.webglTexture&&F.mcObject.deleteTexture(g.webglTexture)}),this.mapImagePathToTexture={}},H.prototype.loadImage=function(F,P,g){if(this.mapImagePathToTexture[F]){var E=this.mapImagePathToTexture[F];return E&&E.isload&&E.texture?g(!0,E.texture.image):g(!1,void 0),0}var _={isload:!1,texture:null,handle:this.allocHandle(P),webglTexture:void 0};this.mapImagePathToTexture[F]=_;var k=m.MxManager.getLoadImageFuction();return k&&k(F,function(U){_.isload=!0,_.texture=U,g(!0,U.image)},function(U){_.isload=!1,g(!1,void 0)})!=0||new a.TextureLoader().load(F,function(U){_.isload=!0,_.texture=U,g(!0,U.image)},void 0,function(U){_.isload=!1,g(!1,void 0)}),_.handle},H.prototype.loadImageBase64=function(F,P,g){if(this.mapImagePathToTexture[F]){var E=this.mapImagePathToTexture[F];return E&&E.isload&&E.texture?g(!0,E.texture.image):g(!1,void 0),0}var _={isload:!1,texture:null,handle:this.allocHandle(F),webglTexture:void 0};return this.mapImagePathToTexture[F]=_,new a.TextureLoader().load(P,function(k){_.isload=!0,_.texture=k,g(!0,k.image)},void 0,function(k){_.isload=!1,g(!1,void 0)}),_.handle},H.prototype.createOpenGLTexture=function(F){var P=this.mapImagePathToTexture[F];if(!P||!P.isload||P.webglTexture)return!1;var g=P.texture;P.webglTexture=this.mcObject.createTexture(),this._gl.activeTexture(33984),this.mcObject.bindTexture(3553,P.webglTexture),this._gl.pixelStorei(37440,g.flipY),this._gl.pixelStorei(37441,g.premultiplyAlpha),this._gl.pixelStorei(3317,g.unpackAlignment);var E=this._gl.getParameter(3379),_=this.textureNeedsPowerOfTwo(g)&&this.isPowerOfTwo(g.image)===!1,k=this.resizeImage(g.image,_,!1,E),U=this.isPowerOfTwo(k)||this.isWebGL2,C=this.convert(g.format),S=this.convert(g.type),Y=this.getInternalFormat(g.internalFormat,C,S);this.setTextureParameters(3553,g,U);var G,T=g.mipmaps;if(g.isDataTexture){var B=!0;if(this._gl.texStorage2D||(B=!1),0<T.length&&U){for(var D=0,N=T.length;D<N;D++)G=T[D],this._gl.texImage2D(3553,D,Y,G.width,G.height,0,C,S,G.data);g.generateMipmaps=!1}else B?(this._gl.texStorage2D(3553,1,Y,k.width,k.height),this._gl.texSubImage2D(3553,0,0,0,k.width,k.height,C,S,k.data)):this._gl.texImage2D(3553,0,Y,k.width,k.height,0,C,S,k.data)}else if(0<T.length&&U){for(D=0,N=T.length;D<N;D++)G=T[D],this._gl.texImage2D(3553,D,Y,C,S,G);g.generateMipmaps=!1}else this._gl.texImage2D(3553,0,Y,C,S,k);this.textureNeedsGenerateMipmaps(g,U)&&this.generateMipmap(P,3553,g,k.width,k.height),this.mcObject.registTexture(P.handle,P.webglTexture)},H);function H(F,P){this.mapImagePathToTexture={},this.mcObject=F,this._gl=P,this.extensions=new c(P),this.isWebGL2=typeof WebGL2RenderingContext<"u"&&P instanceof WebGL2RenderingContext}o.McTextureManager=A},{"../MxManager":29,three:19}]},{},[58])}function registerMxDbEntity(){store.events.emit("MxDbEntityRegister")}let registerList=[];function addRegisterMxDbEntity(b){b.isRegister=!1;const n=()=>{!b.isRegister&&b.register&&b.register(),store.events.off("stateChange",n)};registerList.push(n)}const callRegisterMxDbEntityLists=()=>{registerList.forEach(b=>{b&&b()}),registerList=[]};store.events.on("MxDbEntityRegister",callRegisterMxDbEntityLists);var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function unwrapExports(b){return b&&b.__esModule&&Object.prototype.hasOwnProperty.call(b,"default")?b.default:b}function createCommonjsModule(b,n){return b(n={exports:{}},n.exports),n.exports}var jquery=createCommonjsModule(function(b){var n,o;n=typeof window<"u"?window:commonjsGlobal,o=function(a,m){var c=[],x=Object.getPrototypeOf,A=c.slice,H=c.flat?function(y){return c.flat.call(y)}:function(y){return c.concat.apply([],y)},F=c.push,P=c.indexOf,g={},E=g.toString,_=g.hasOwnProperty,k=_.toString,U=k.call(Object),C={},S=function(y){return typeof y=="function"&&typeof y.nodeType!="number"&&typeof y.item!="function"},Y=function(y){return y!=null&&y===y.window},G=a.document,T={type:!0,src:!0,nonce:!0,noModule:!0};function B(y,O,K){var ie,pe,me=(K=K||G).createElement("script");if(me.text=y,O)for(ie in T)(pe=O[ie]||O.getAttribute&&O.getAttribute(ie))&&me.setAttribute(ie,pe);K.head.appendChild(me).parentNode.removeChild(me)}function D(y){return y==null?y+"":typeof y=="object"||typeof y=="function"?g[E.call(y)]||"object":typeof y}var N="3.7.0",I=/HTML$/i,h=function(y,O){return new h.fn.init(y,O)};function u(y){var O=!!y&&"length"in y&&y.length,K=D(y);return!S(y)&&!Y(y)&&(K==="array"||O===0||typeof O=="number"&&O>0&&O-1 in y)}function v(y,O){return y.nodeName&&y.nodeName.toLowerCase()===O.toLowerCase()}h.fn=h.prototype={jquery:N,constructor:h,length:0,toArray:function(){return A.call(this)},get:function(y){return y==null?A.call(this):y<0?this[y+this.length]:this[y]},pushStack:function(y){var O=h.merge(this.constructor(),y);return O.prevObject=this,O},each:function(y){return h.each(this,y)},map:function(y){return this.pushStack(h.map(this,function(O,K){return y.call(O,K,O)}))},slice:function(){return this.pushStack(A.apply(this,arguments))},first:function(){return this.eq(0)},last:function(){return this.eq(-1)},even:function(){return this.pushStack(h.grep(this,function(y,O){return(O+1)%2}))},odd:function(){return this.pushStack(h.grep(this,function(y,O){return O%2}))},eq:function(y){var O=this.length,K=+y+(y<0?O:0);return this.pushStack(K>=0&&K<O?[this[K]]:[])},end:function(){return this.prevObject||this.constructor()},push:F,sort:c.sort,splice:c.splice},h.extend=h.fn.extend=function(){var y,O,K,ie,pe,me,Te=arguments[0]||{},_e=1,Se=arguments.length,Fe=!1;for(typeof Te=="boolean"&&(Fe=Te,Te=arguments[_e]||{},_e++),typeof Te=="object"||S(Te)||(Te={}),_e===Se&&(Te=this,_e--);_e<Se;_e++)if((y=arguments[_e])!=null)for(O in y)ie=y[O],O!=="__proto__"&&Te!==ie&&(Fe&&ie&&(h.isPlainObject(ie)||(pe=Array.isArray(ie)))?(K=Te[O],me=pe&&!Array.isArray(K)?[]:pe||h.isPlainObject(K)?K:{},pe=!1,Te[O]=h.extend(Fe,me,ie)):ie!==void 0&&(Te[O]=ie));return Te},h.extend({expando:"jQuery"+(N+Math.random()).replace(/\D/g,""),isReady:!0,error:function(y){throw new Error(y)},noop:function(){},isPlainObject:function(y){var O,K;return!(!y||E.call(y)!=="[object Object]"||(O=x(y))&&(typeof(K=_.call(O,"constructor")&&O.constructor)!="function"||k.call(K)!==U))},isEmptyObject:function(y){var O;for(O in y)return!1;return!0},globalEval:function(y,O,K){B(y,{nonce:O&&O.nonce},K)},each:function(y,O){var K,ie=0;if(u(y))for(K=y.length;ie<K&&O.call(y[ie],ie,y[ie])!==!1;ie++);else for(ie in y)if(O.call(y[ie],ie,y[ie])===!1)break;return y},text:function(y){var O,K="",ie=0,pe=y.nodeType;if(pe){if(pe===1||pe===9||pe===11)return y.textContent;if(pe===3||pe===4)return y.nodeValue}else for(;O=y[ie++];)K+=h.text(O);return K},makeArray:function(y,O){var K=O||[];return y!=null&&(u(Object(y))?h.merge(K,typeof y=="string"?[y]:y):F.call(K,y)),K},inArray:function(y,O,K){return O==null?-1:P.call(O,y,K)},isXMLDoc:function(y){var O=y&&y.namespaceURI,K=y&&(y.ownerDocument||y).documentElement;return!I.test(O||K&&K.nodeName||"HTML")},merge:function(y,O){for(var K=+O.length,ie=0,pe=y.length;ie<K;ie++)y[pe++]=O[ie];return y.length=pe,y},grep:function(y,O,K){for(var ie=[],pe=0,me=y.length,Te=!K;pe<me;pe++)!O(y[pe],pe)!==Te&&ie.push(y[pe]);return ie},map:function(y,O,K){var ie,pe,me=0,Te=[];if(u(y))for(ie=y.length;me<ie;me++)(pe=O(y[me],me,K))!=null&&Te.push(pe);else for(me in y)(pe=O(y[me],me,K))!=null&&Te.push(pe);return H(Te)},guid:1,support:C}),typeof Symbol=="function"&&(h.fn[Symbol.iterator]=c[Symbol.iterator]),h.each("Boolean Number String Function Array Date RegExp Object Error Symbol".split(" "),function(y,O){g["[object "+O+"]"]=O.toLowerCase()});var M=c.pop,j=c.sort,z=c.splice,J="[\\x20\\t\\r\\n\\f]",te=new RegExp("^"+J+"+|((?:^|[^\\\\])(?:\\\\.)*)"+J+"+$","g");h.contains=function(y,O){var K=O&&O.parentNode;return y===K||!(!K||K.nodeType!==1||!(y.contains?y.contains(K):y.compareDocumentPosition&&16&y.compareDocumentPosition(K)))};var X=/([\0-\x1f\x7f]|^-?\d)|^-$|[^\x80-\uFFFF\w-]/g;function se(y,O){return O?y==="\0"?"�":y.slice(0,-1)+"\\"+y.charCodeAt(y.length-1).toString(16)+" ":"\\"+y}h.escapeSelector=function(y){return(y+"").replace(X,se)};var ve=G,Ee=F;(function(){var y,O,K,ie,pe,me,Te,_e,Se,Fe,rt=Ee,dt=h.expando,ut=0,Lt=0,Rr=li(),At=li(),Wr=li(),Zn=li(),Un=function(Ne,ot){return Ne===ot&&(pe=!0),0},la="checked|selected|async|autofocus|autoplay|controls|defer|disabled|hidden|ismap|loop|multiple|open|readonly|required|scoped",Ma="(?:\\\\[\\da-fA-F]{1,6}"+J+"?|\\\\[^\\r\\n\\f]|[\\w-]|[^\0-\\x7f])+",dn="\\["+J+"*("+Ma+")(?:"+J+"*([*^$|!~]?=)"+J+`*(?:'((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)"|(`+Ma+"))|)"+J+"*\\]",_a=":("+Ma+`)(?:\\((('((?:\\\\.|[^\\\\'])*)'|"((?:\\\\.|[^\\\\"])*)")|((?:\\\\.|[^\\\\()[\\]]|`+dn+")*)|.*)\\)|)",wn=new RegExp(J+"+","g"),Jr=new RegExp("^"+J+"*,"+J+"*"),so=new RegExp("^"+J+"*([>+~]|"+J+")"+J+"*"),Uo=new RegExp(J+"|>"),ua=new RegExp(_a),Ho=new RegExp("^"+Ma+"$"),Ta={ID:new RegExp("^#("+Ma+")"),CLASS:new RegExp("^\\.("+Ma+")"),TAG:new RegExp("^("+Ma+"|[*])"),ATTR:new RegExp("^"+dn),PSEUDO:new RegExp("^"+_a),CHILD:new RegExp("^:(only|first|last|nth|nth-last)-(child|of-type)(?:\\("+J+"*(even|odd|(([+-]|)(\\d*)n|)"+J+"*(?:([+-]|)"+J+"*(\\d+)|))"+J+"*\\)|)","i"),bool:new RegExp("^(?:"+la+")$","i"),needsContext:new RegExp("^"+J+"*[>+~]|:(even|odd|eq|gt|lt|nth|first|last)(?:\\("+J+"*((?:-\\d)?\\d*)"+J+"*\\)|)(?=[^-]|$)","i")},Zi=/^(?:input|select|textarea|button)$/i,lo=/^h\d$/i,zi=/^(?:#([\w-]+)|(\w+)|\.([\w-]+))$/,Kn=/[+~]/,$n=new RegExp("\\\\[\\da-fA-F]{1,6}"+J+"?|\\\\([^\\r\\n\\f])","g"),Li=function(Ne,ot){var Qe="0x"+Ne.slice(1)-65536;return ot||(Qe<0?String.fromCharCode(Qe+65536):String.fromCharCode(Qe>>10|55296,1023&Qe|56320))},Ua=function(){Ui()},_i=Ao(function(Ne){return Ne.disabled===!0&&v(Ne,"fieldset")},{dir:"parentNode",next:"legend"});try{rt.apply(c=A.call(ve.childNodes),ve.childNodes),c[ve.childNodes.length].nodeType}catch{rt={apply:function(ot,Qe){Ee.apply(ot,A.call(Qe))},call:function(ot){Ee.apply(ot,A.call(arguments,1))}}}function qr(Ne,ot,Qe,Ct){var jt,pr,dr,Er,kt,Dn,wr,Kt=ot&&ot.ownerDocument,jn=ot?ot.nodeType:9;if(Qe=Qe||[],typeof Ne!="string"||!Ne||jn!==1&&jn!==9&&jn!==11)return Qe;if(!Ct&&(Ui(ot),ot=ot||me,_e)){if(jn!==11&&(kt=zi.exec(Ne)))if(jt=kt[1]){if(jn===9){if(!(dr=ot.getElementById(jt)))return Qe;if(dr.id===jt)return rt.call(Qe,dr),Qe}else if(Kt&&(dr=Kt.getElementById(jt))&&qr.contains(ot,dr)&&dr.id===jt)return rt.call(Qe,dr),Qe}else{if(kt[2])return rt.apply(Qe,ot.getElementsByTagName(Ne)),Qe;if((jt=kt[3])&&ot.getElementsByClassName)return rt.apply(Qe,ot.getElementsByClassName(jt)),Qe}if(!(Zn[Ne+" "]||Se&&Se.test(Ne))){if(wr=Ne,Kt=ot,jn===1&&(Uo.test(Ne)||so.test(Ne))){for((Kt=Kn.test(Ne)&&ca(ot.parentNode)||ot)==ot&&C.scope||((Er=ot.getAttribute("id"))?Er=h.escapeSelector(Er):ot.setAttribute("id",Er=dt)),pr=(Dn=Ha(Ne)).length;pr--;)Dn[pr]=(Er?"#"+Er:":scope")+" "+wo(Dn[pr]);wr=Dn.join(",")}try{return rt.apply(Qe,Kt.querySelectorAll(wr)),Qe}catch{Zn(Ne,!0)}finally{Er===dt&&ot.removeAttribute("id")}}}return Dl(Ne.replace(te,"$1"),ot,Qe,Ct)}function li(){var Ne=[];return function ot(Qe,Ct){return Ne.push(Qe+" ")>O.cacheLength&&delete ot[Ne.shift()],ot[Qe+" "]=Ct}}function ni(Ne){return Ne[dt]=!0,Ne}function kn(Ne){var ot=me.createElement("fieldset");try{return!!Ne(ot)}catch{return!1}finally{ot.parentNode&&ot.parentNode.removeChild(ot),ot=null}}function Ca(Ne){return function(ot){return v(ot,"input")&&ot.type===Ne}}function _s(Ne){return function(ot){return(v(ot,"input")||v(ot,"button"))&&ot.type===Ne}}function Tl(Ne){return function(ot){return"form"in ot?ot.parentNode&&ot.disabled===!1?"label"in ot?"label"in ot.parentNode?ot.parentNode.disabled===Ne:ot.disabled===Ne:ot.isDisabled===Ne||ot.isDisabled!==!Ne&&_i(ot)===Ne:ot.disabled===Ne:"label"in ot&&ot.disabled===Ne}}function na(Ne){return ni(function(ot){return ot=+ot,ni(function(Qe,Ct){for(var jt,pr=Ne([],Qe.length,ot),dr=pr.length;dr--;)Qe[jt=pr[dr]]&&(Qe[jt]=!(Ct[jt]=Qe[jt]))})})}function ca(Ne){return Ne&&Ne.getElementsByTagName!==void 0&&Ne}function Ui(Ne){var ot,Qe=Ne?Ne.ownerDocument||Ne:ve;return Qe!=me&&Qe.nodeType===9&&Qe.documentElement&&(Te=(me=Qe).documentElement,_e=!h.isXMLDoc(me),Fe=Te.matches||Te.webkitMatchesSelector||Te.msMatchesSelector,ve!=me&&(ot=me.defaultView)&&ot.top!==ot&&ot.addEventListener("unload",Ua),C.getById=kn(function(Ct){return Te.appendChild(Ct).id=h.expando,!me.getElementsByName||!me.getElementsByName(h.expando).length}),C.disconnectedMatch=kn(function(Ct){return Fe.call(Ct,"*")}),C.scope=kn(function(){return me.querySelectorAll(":scope")}),C.cssHas=kn(function(){try{return me.querySelector(":has(*,:jqfake)"),!1}catch{return!0}}),C.getById?(O.filter.ID=function(Ct){var jt=Ct.replace($n,Li);return function(pr){return pr.getAttribute("id")===jt}},O.find.ID=function(Ct,jt){if(jt.getElementById!==void 0&&_e){var pr=jt.getElementById(Ct);return pr?[pr]:[]}}):(O.filter.ID=function(Ct){var jt=Ct.replace($n,Li);return function(pr){var dr=pr.getAttributeNode!==void 0&&pr.getAttributeNode("id");return dr&&dr.value===jt}},O.find.ID=function(Ct,jt){if(jt.getElementById!==void 0&&_e){var pr,dr,Er,kt=jt.getElementById(Ct);if(kt){if((pr=kt.getAttributeNode("id"))&&pr.value===Ct)return[kt];for(Er=jt.getElementsByName(Ct),dr=0;kt=Er[dr++];)if((pr=kt.getAttributeNode("id"))&&pr.value===Ct)return[kt]}return[]}}),O.find.TAG=function(Ct,jt){return jt.getElementsByTagName!==void 0?jt.getElementsByTagName(Ct):jt.querySelectorAll(Ct)},O.find.CLASS=function(Ct,jt){if(jt.getElementsByClassName!==void 0&&_e)return jt.getElementsByClassName(Ct)},Se=[],kn(function(Ct){var jt;Te.appendChild(Ct).innerHTML="<a id='"+dt+"' href='' disabled='disabled'></a><select id='"+dt+"-\r\\' disabled='disabled'><option selected=''></option></select>",Ct.querySelectorAll("[selected]").length||Se.push("\\["+J+"*(?:value|"+la+")"),Ct.querySelectorAll("[id~="+dt+"-]").length||Se.push("~="),Ct.querySelectorAll("a#"+dt+"+*").length||Se.push(".#.+[+~]"),Ct.querySelectorAll(":checked").length||Se.push(":checked"),(jt=me.createElement("input")).setAttribute("type","hidden"),Ct.appendChild(jt).setAttribute("name","D"),Te.appendChild(Ct).disabled=!0,Ct.querySelectorAll(":disabled").length!==2&&Se.push(":enabled",":disabled"),(jt=me.createElement("input")).setAttribute("name",""),Ct.appendChild(jt),Ct.querySelectorAll("[name='']").length||Se.push("\\["+J+"*name"+J+"*="+J+`*(?:''|"")`)}),C.cssHas||Se.push(":has"),Se=Se.length&&new RegExp(Se.join("|")),Un=function(Ct,jt){if(Ct===jt)return pe=!0,0;var pr=!Ct.compareDocumentPosition-!jt.compareDocumentPosition;return pr||(1&(pr=(Ct.ownerDocument||Ct)==(jt.ownerDocument||jt)?Ct.compareDocumentPosition(jt):1)||!C.sortDetached&&jt.compareDocumentPosition(Ct)===pr?Ct===me||Ct.ownerDocument==ve&&qr.contains(ve,Ct)?-1:jt===me||jt.ownerDocument==ve&&qr.contains(ve,jt)?1:ie?P.call(ie,Ct)-P.call(ie,jt):0:4&pr?-1:1)}),me}for(y in qr.matches=function(Ne,ot){return qr(Ne,null,null,ot)},qr.matchesSelector=function(Ne,ot){if(Ui(Ne),_e&&!Zn[ot+" "]&&(!Se||!Se.test(ot)))try{var Qe=Fe.call(Ne,ot);if(Qe||C.disconnectedMatch||Ne.document&&Ne.document.nodeType!==11)return Qe}catch{Zn(ot,!0)}return qr(ot,me,null,[Ne]).length>0},qr.contains=function(Ne,ot){return(Ne.ownerDocument||Ne)!=me&&Ui(Ne),h.contains(Ne,ot)},qr.attr=function(Ne,ot){(Ne.ownerDocument||Ne)!=me&&Ui(Ne);var Qe=O.attrHandle[ot.toLowerCase()],Ct=Qe&&_.call(O.attrHandle,ot.toLowerCase())?Qe(Ne,ot,!_e):void 0;return Ct!==void 0?Ct:Ne.getAttribute(ot)},qr.error=function(Ne){throw new Error("Syntax error, unrecognized expression: "+Ne)},h.uniqueSort=function(Ne){var ot,Qe=[],Ct=0,jt=0;if(pe=!C.sortStable,ie=!C.sortStable&&A.call(Ne,0),j.call(Ne,Un),pe){for(;ot=Ne[jt++];)ot===Ne[jt]&&(Ct=Qe.push(jt));for(;Ct--;)z.call(Ne,Qe[Ct],1)}return ie=null,Ne},h.fn.uniqueSort=function(){return this.pushStack(h.uniqueSort(A.apply(this)))},(O=h.expr={cacheLength:50,createPseudo:ni,match:Ta,attrHandle:{},find:{},relative:{">":{dir:"parentNode",first:!0}," ":{dir:"parentNode"},"+":{dir:"previousSibling",first:!0},"~":{dir:"previousSibling"}},preFilter:{ATTR:function(Ne){return Ne[1]=Ne[1].replace($n,Li),Ne[3]=(Ne[3]||Ne[4]||Ne[5]||"").replace($n,Li),Ne[2]==="~="&&(Ne[3]=" "+Ne[3]+" "),Ne.slice(0,4)},CHILD:function(Ne){return Ne[1]=Ne[1].toLowerCase(),Ne[1].slice(0,3)==="nth"?(Ne[3]||qr.error(Ne[0]),Ne[4]=+(Ne[4]?Ne[5]+(Ne[6]||1):2*(Ne[3]==="even"||Ne[3]==="odd")),Ne[5]=+(Ne[7]+Ne[8]||Ne[3]==="odd")):Ne[3]&&qr.error(Ne[0]),Ne},PSEUDO:function(Ne){var ot,Qe=!Ne[6]&&Ne[2];return Ta.CHILD.test(Ne[0])?null:(Ne[3]?Ne[2]=Ne[4]||Ne[5]||"":Qe&&ua.test(Qe)&&(ot=Ha(Qe,!0))&&(ot=Qe.indexOf(")",Qe.length-ot)-Qe.length)&&(Ne[0]=Ne[0].slice(0,ot),Ne[2]=Qe.slice(0,ot)),Ne.slice(0,3))}},filter:{TAG:function(Ne){var ot=Ne.replace($n,Li).toLowerCase();return Ne==="*"?function(){return!0}:function(Qe){return v(Qe,ot)}},CLASS:function(Ne){var ot=Rr[Ne+" "];return ot||(ot=new RegExp("(^|"+J+")"+Ne+"("+J+"|$)"))&&Rr(Ne,function(Qe){return ot.test(typeof Qe.className=="string"&&Qe.className||Qe.getAttribute!==void 0&&Qe.getAttribute("class")||"")})},ATTR:function(Ne,ot,Qe){return function(Ct){var jt=qr.attr(Ct,Ne);return jt==null?ot==="!=":!ot||(jt+="",ot==="="?jt===Qe:ot==="!="?jt!==Qe:ot==="^="?Qe&&jt.indexOf(Qe)===0:ot==="*="?Qe&&jt.indexOf(Qe)>-1:ot==="$="?Qe&&jt.slice(-Qe.length)===Qe:ot==="~="?(" "+jt.replace(wn," ")+" ").indexOf(Qe)>-1:ot==="|="&&(jt===Qe||jt.slice(0,Qe.length+1)===Qe+"-"))}},CHILD:function(Ne,ot,Qe,Ct,jt){var pr=Ne.slice(0,3)!=="nth",dr=Ne.slice(-4)!=="last",Er=ot==="of-type";return Ct===1&&jt===0?function(kt){return!!kt.parentNode}:function(kt,Dn,wr){var Kt,jn,tn,ui,Ti,mi=pr!==dr?"nextSibling":"previousSibling",be=kt.parentNode,Ci=Er&&kt.nodeName.toLowerCase(),tr=!wr&&!Er,En=!1;if(be){if(pr){for(;mi;){for(tn=kt;tn=tn[mi];)if(Er?v(tn,Ci):tn.nodeType===1)return!1;Ti=mi=Ne==="only"&&!Ti&&"nextSibling"}return!0}if(Ti=[dr?be.firstChild:be.lastChild],dr&&tr){for(En=(ui=(Kt=(jn=be[dt]||(be[dt]={}))[Ne]||[])[0]===ut&&Kt[1])&&Kt[2],tn=ui&&be.childNodes[ui];tn=++ui&&tn&&tn[mi]||(En=ui=0)||Ti.pop();)if(tn.nodeType===1&&++En&&tn===kt){jn[Ne]=[ut,ui,En];break}}else if(tr&&(En=ui=(Kt=(jn=kt[dt]||(kt[dt]={}))[Ne]||[])[0]===ut&&Kt[1]),En===!1)for(;(tn=++ui&&tn&&tn[mi]||(En=ui=0)||Ti.pop())&&(!(Er?v(tn,Ci):tn.nodeType===1)||!++En||(tr&&((jn=tn[dt]||(tn[dt]={}))[Ne]=[ut,En]),tn!==kt)););return(En-=jt)===Ct||En%Ct==0&&En/Ct>=0}}},PSEUDO:function(Ne,ot){var Qe,Ct=O.pseudos[Ne]||O.setFilters[Ne.toLowerCase()]||qr.error("unsupported pseudo: "+Ne);return Ct[dt]?Ct(ot):Ct.length>1?(Qe=[Ne,Ne,"",ot],O.setFilters.hasOwnProperty(Ne.toLowerCase())?ni(function(jt,pr){for(var dr,Er=Ct(jt,ot),kt=Er.length;kt--;)jt[dr=P.call(jt,Er[kt])]=!(pr[dr]=Er[kt])}):function(jt){return Ct(jt,0,Qe)}):Ct}},pseudos:{not:ni(function(Ne){var ot=[],Qe=[],Ct=ki(Ne.replace(te,"$1"));return Ct[dt]?ni(function(jt,pr,dr,Er){for(var kt,Dn=Ct(jt,null,Er,[]),wr=jt.length;wr--;)(kt=Dn[wr])&&(jt[wr]=!(pr[wr]=kt))}):function(jt,pr,dr){return ot[0]=jt,Ct(ot,null,dr,Qe),ot[0]=null,!Qe.pop()}}),has:ni(function(Ne){return function(ot){return qr(Ne,ot).length>0}}),contains:ni(function(Ne){return Ne=Ne.replace($n,Li),function(ot){return(ot.textContent||h.text(ot)).indexOf(Ne)>-1}}),lang:ni(function(Ne){return Ho.test(Ne||"")||qr.error("unsupported lang: "+Ne),Ne=Ne.replace($n,Li).toLowerCase(),function(ot){var Qe;do if(Qe=_e?ot.lang:ot.getAttribute("xml:lang")||ot.getAttribute("lang"))return(Qe=Qe.toLowerCase())===Ne||Qe.indexOf(Ne+"-")===0;while((ot=ot.parentNode)&&ot.nodeType===1);return!1}}),target:function(Ne){var ot=a.location&&a.location.hash;return ot&&ot.slice(1)===Ne.id},root:function(Ne){return Ne===Te},focus:function(Ne){return Ne===function(){try{return me.activeElement}catch{}}()&&me.hasFocus()&&!!(Ne.type||Ne.href||~Ne.tabIndex)},enabled:Tl(!1),disabled:Tl(!0),checked:function(Ne){return v(Ne,"input")&&!!Ne.checked||v(Ne,"option")&&!!Ne.selected},selected:function(Ne){return Ne.parentNode&&Ne.parentNode.selectedIndex,Ne.selected===!0},empty:function(Ne){for(Ne=Ne.firstChild;Ne;Ne=Ne.nextSibling)if(Ne.nodeType<6)return!1;return!0},parent:function(Ne){return!O.pseudos.empty(Ne)},header:function(Ne){return lo.test(Ne.nodeName)},input:function(Ne){return Zi.test(Ne.nodeName)},button:function(Ne){return v(Ne,"input")&&Ne.type==="button"||v(Ne,"button")},text:function(Ne){var ot;return v(Ne,"input")&&Ne.type==="text"&&((ot=Ne.getAttribute("type"))==null||ot.toLowerCase()==="text")},first:na(function(){return[0]}),last:na(function(Ne,ot){return[ot-1]}),eq:na(function(Ne,ot,Qe){return[Qe<0?Qe+ot:Qe]}),even:na(function(Ne,ot){for(var Qe=0;Qe<ot;Qe+=2)Ne.push(Qe);return Ne}),odd:na(function(Ne,ot){for(var Qe=1;Qe<ot;Qe+=2)Ne.push(Qe);return Ne}),lt:na(function(Ne,ot,Qe){var Ct;for(Ct=Qe<0?Qe+ot:Qe>ot?ot:Qe;--Ct>=0;)Ne.push(Ct);return Ne}),gt:na(function(Ne,ot,Qe){for(var Ct=Qe<0?Qe+ot:Qe;++Ct<ot;)Ne.push(Ct);return Ne})}}).pseudos.nth=O.pseudos.eq,{radio:!0,checkbox:!0,file:!0,password:!0,image:!0})O.pseudos[y]=Ca(y);for(y in{submit:!0,reset:!0})O.pseudos[y]=_s(y);function Ts(){}function Ha(Ne,ot){var Qe,Ct,jt,pr,dr,Er,kt,Dn=At[Ne+" "];if(Dn)return ot?0:Dn.slice(0);for(dr=Ne,Er=[],kt=O.preFilter;dr;){for(pr in Qe&&!(Ct=Jr.exec(dr))||(Ct&&(dr=dr.slice(Ct[0].length)||dr),Er.push(jt=[])),Qe=!1,(Ct=so.exec(dr))&&(Qe=Ct.shift(),jt.push({value:Qe,type:Ct[0].replace(te," ")}),dr=dr.slice(Qe.length)),O.filter)!(Ct=Ta[pr].exec(dr))||kt[pr]&&!(Ct=kt[pr](Ct))||(Qe=Ct.shift(),jt.push({value:Qe,type:pr,matches:Ct}),dr=dr.slice(Qe.length));if(!Qe)break}return ot?dr.length:dr?qr.error(Ne):At(Ne,Er).slice(0)}function wo(Ne){for(var ot=0,Qe=Ne.length,Ct="";ot<Qe;ot++)Ct+=Ne[ot].value;return Ct}function Ao(Ne,ot,Qe){var Ct=ot.dir,jt=ot.next,pr=jt||Ct,dr=Qe&&pr==="parentNode",Er=Lt++;return ot.first?function(kt,Dn,wr){for(;kt=kt[Ct];)if(kt.nodeType===1||dr)return Ne(kt,Dn,wr);return!1}:function(kt,Dn,wr){var Kt,jn,tn=[ut,Er];if(wr){for(;kt=kt[Ct];)if((kt.nodeType===1||dr)&&Ne(kt,Dn,wr))return!0}else for(;kt=kt[Ct];)if(kt.nodeType===1||dr)if(jn=kt[dt]||(kt[dt]={}),jt&&v(kt,jt))kt=kt[Ct]||kt;else{if((Kt=jn[pr])&&Kt[0]===ut&&Kt[1]===Er)return tn[2]=Kt[2];if(jn[pr]=tn,tn[2]=Ne(kt,Dn,wr))return!0}return!1}}function Cl(Ne){return Ne.length>1?function(ot,Qe,Ct){for(var jt=Ne.length;jt--;)if(!Ne[jt](ot,Qe,Ct))return!1;return!0}:Ne[0]}function fi(Ne,ot,Qe,Ct,jt){for(var pr,dr=[],Er=0,kt=Ne.length,Dn=ot!=null;Er<kt;Er++)(pr=Ne[Er])&&(Qe&&!Qe(pr,Ct,jt)||(dr.push(pr),Dn&&ot.push(Er)));return dr}function Ii(Ne,ot,Qe,Ct,jt,pr){return Ct&&!Ct[dt]&&(Ct=Ii(Ct)),jt&&!jt[dt]&&(jt=Ii(jt,pr)),ni(function(dr,Er,kt,Dn){var wr,Kt,jn,tn,ui=[],Ti=[],mi=Er.length,be=dr||function(tr,En,bn){for(var Ki=0,Wa=En.length;Ki<Wa;Ki++)qr(tr,En[Ki],bn);return bn}(ot||"*",kt.nodeType?[kt]:kt,[]),Ci=!Ne||!dr&&ot?be:fi(be,ui,Ne,kt,Dn);if(Qe?Qe(Ci,tn=jt||(dr?Ne:mi||Ct)?[]:Er,kt,Dn):tn=Ci,Ct)for(wr=fi(tn,Ti),Ct(wr,[],kt,Dn),Kt=wr.length;Kt--;)(jn=wr[Kt])&&(tn[Ti[Kt]]=!(Ci[Ti[Kt]]=jn));if(dr){if(jt||Ne){if(jt){for(wr=[],Kt=tn.length;Kt--;)(jn=tn[Kt])&&wr.push(Ci[Kt]=jn);jt(null,tn=[],wr,Dn)}for(Kt=tn.length;Kt--;)(jn=tn[Kt])&&(wr=jt?P.call(dr,jn):ui[Kt])>-1&&(dr[wr]=!(Er[wr]=jn))}}else tn=fi(tn===Er?tn.splice(mi,tn.length):tn),jt?jt(null,Er,tn,Dn):rt.apply(Er,tn)})}function Ws(Ne){for(var ot,Qe,Ct,jt=Ne.length,pr=O.relative[Ne[0].type],dr=pr||O.relative[" "],Er=pr?1:0,kt=Ao(function(Kt){return Kt===ot},dr,!0),Dn=Ao(function(Kt){return P.call(ot,Kt)>-1},dr,!0),wr=[function(Kt,jn,tn){var ui=!pr&&(tn||jn!=K)||((ot=jn).nodeType?kt(Kt,jn,tn):Dn(Kt,jn,tn));return ot=null,ui}];Er<jt;Er++)if(Qe=O.relative[Ne[Er].type])wr=[Ao(Cl(wr),Qe)];else{if((Qe=O.filter[Ne[Er].type].apply(null,Ne[Er].matches))[dt]){for(Ct=++Er;Ct<jt&&!O.relative[Ne[Ct].type];Ct++);return Ii(Er>1&&Cl(wr),Er>1&&wo(Ne.slice(0,Er-1).concat({value:Ne[Er-2].type===" "?"*":""})).replace(te,"$1"),Qe,Er<Ct&&Ws(Ne.slice(Er,Ct)),Ct<jt&&Ws(Ne=Ne.slice(Ct)),Ct<jt&&wo(Ne))}wr.push(Qe)}return Cl(wr)}function ki(Ne,ot){var Qe,Ct=[],jt=[],pr=Wr[Ne+" "];if(!pr){for(ot||(ot=Ha(Ne)),Qe=ot.length;Qe--;)(pr=Ws(ot[Qe]))[dt]?Ct.push(pr):jt.push(pr);(pr=Wr(Ne,function(dr,Er){var kt=Er.length>0,Dn=dr.length>0,wr=function(Kt,jn,tn,ui,Ti){var mi,be,Ci,tr=0,En="0",bn=Kt&&[],Ki=[],Wa=K,Hi=Kt||Dn&&O.find.TAG("*",Ti),bo=ut+=Wa==null?1:Math.random()||.1,ha=Hi.length;for(Ti&&(K=jn==me||jn||Ti);En!==ha&&(mi=Hi[En])!=null;En++){if(Dn&&mi){for(be=0,jn||mi.ownerDocument==me||(Ui(mi),tn=!_e);Ci=dr[be++];)if(Ci(mi,jn||me,tn)){rt.call(ui,mi);break}Ti&&(ut=bo)}kt&&((mi=!Ci&&mi)&&tr--,Kt&&bn.push(mi))}if(tr+=En,kt&&En!==tr){for(be=0;Ci=Er[be++];)Ci(bn,Ki,jn,tn);if(Kt){if(tr>0)for(;En--;)bn[En]||Ki[En]||(Ki[En]=M.call(ui));Ki=fi(Ki)}rt.apply(ui,Ki),Ti&&!Kt&&Ki.length>0&&tr+Er.length>1&&h.uniqueSort(ui)}return Ti&&(ut=bo,K=Wa),bn};return kt?ni(wr):wr}(jt,Ct))).selector=Ne}return pr}function Dl(Ne,ot,Qe,Ct){var jt,pr,dr,Er,kt,Dn=typeof Ne=="function"&&Ne,wr=!Ct&&Ha(Ne=Dn.selector||Ne);if(Qe=Qe||[],wr.length===1){if((pr=wr[0]=wr[0].slice(0)).length>2&&(dr=pr[0]).type==="ID"&&ot.nodeType===9&&_e&&O.relative[pr[1].type]){if(!(ot=(O.find.ID(dr.matches[0].replace($n,Li),ot)||[])[0]))return Qe;Dn&&(ot=ot.parentNode),Ne=Ne.slice(pr.shift().value.length)}for(jt=Ta.needsContext.test(Ne)?0:pr.length;jt--&&(dr=pr[jt],!O.relative[Er=dr.type]);)if((kt=O.find[Er])&&(Ct=kt(dr.matches[0].replace($n,Li),Kn.test(pr[0].type)&&ca(ot.parentNode)||ot))){if(pr.splice(jt,1),!(Ne=Ct.length&&wo(pr)))return rt.apply(Qe,Ct),Qe;break}}return(Dn||ki(Ne,wr))(Ct,ot,!_e,Qe,!ot||Kn.test(Ne)&&ca(ot.parentNode)||ot),Qe}Ts.prototype=O.filters=O.pseudos,O.setFilters=new Ts,C.sortStable=dt.split("").sort(Un).join("")===dt,Ui(),C.sortDetached=kn(function(Ne){return 1&Ne.compareDocumentPosition(me.createElement("fieldset"))}),h.find=qr,h.expr[":"]=h.expr.pseudos,h.unique=h.uniqueSort,qr.compile=ki,qr.select=Dl,qr.setDocument=Ui,qr.escape=h.escapeSelector,qr.getText=h.text,qr.isXML=h.isXMLDoc,qr.selectors=h.expr,qr.support=h.support,qr.uniqueSort=h.uniqueSort})();var we=function(y,O,K){for(var ie=[],pe=K!==void 0;(y=y[O])&&y.nodeType!==9;)if(y.nodeType===1){if(pe&&h(y).is(K))break;ie.push(y)}return ie},Be=function(y,O){for(var K=[];y;y=y.nextSibling)y.nodeType===1&&y!==O&&K.push(y);return K},re=h.expr.match.needsContext,fe=/^<([a-z][^\/\0>:\x20\t\r\n\f]*)[\x20\t\r\n\f]*\/?>(?:<\/\1>|)$/i;function ne(y,O,K){return S(O)?h.grep(y,function(ie,pe){return!!O.call(ie,pe,ie)!==K}):O.nodeType?h.grep(y,function(ie){return ie===O!==K}):typeof O!="string"?h.grep(y,function(ie){return P.call(O,ie)>-1!==K}):h.filter(O,y,K)}h.filter=function(y,O,K){var ie=O[0];return K&&(y=":not("+y+")"),O.length===1&&ie.nodeType===1?h.find.matchesSelector(ie,y)?[ie]:[]:h.find.matches(y,h.grep(O,function(pe){return pe.nodeType===1}))},h.fn.extend({find:function(y){var O,K,ie=this.length,pe=this;if(typeof y!="string")return this.pushStack(h(y).filter(function(){for(O=0;O<ie;O++)if(h.contains(pe[O],this))return!0}));for(K=this.pushStack([]),O=0;O<ie;O++)h.find(y,pe[O],K);return ie>1?h.uniqueSort(K):K},filter:function(y){return this.pushStack(ne(this,y||[],!1))},not:function(y){return this.pushStack(ne(this,y||[],!0))},is:function(y){return!!ne(this,typeof y=="string"&&re.test(y)?h(y):y||[],!1).length}});var le,Re=/^(?:\s*(<[\w\W]+>)[^>]*|#([\w-]+))$/;(h.fn.init=function(y,O,K){var ie,pe;if(!y)return this;if(K=K||le,typeof y=="string"){if(!(ie=y[0]==="<"&&y[y.length-1]===">"&&y.length>=3?[null,y,null]:Re.exec(y))||!ie[1]&&O)return!O||O.jquery?(O||K).find(y):this.constructor(O).find(y);if(ie[1]){if(O=O instanceof h?O[0]:O,h.merge(this,h.parseHTML(ie[1],O&&O.nodeType?O.ownerDocument||O:G,!0)),fe.test(ie[1])&&h.isPlainObject(O))for(ie in O)S(this[ie])?this[ie](O[ie]):this.attr(ie,O[ie]);return this}return(pe=G.getElementById(ie[2]))&&(this[0]=pe,this.length=1),this}return y.nodeType?(this[0]=y,this.length=1,this):S(y)?K.ready!==void 0?K.ready(y):y(h):h.makeArray(y,this)}).prototype=h.fn,le=h(G);var at=/^(?:parents|prev(?:Until|All))/,ze={children:!0,contents:!0,next:!0,prev:!0};function Ie(y,O){for(;(y=y[O])&&y.nodeType!==1;);return y}h.fn.extend({has:function(y){var O=h(y,this),K=O.length;return this.filter(function(){for(var ie=0;ie<K;ie++)if(h.contains(this,O[ie]))return!0})},closest:function(y,O){var K,ie=0,pe=this.length,me=[],Te=typeof y!="string"&&h(y);if(!re.test(y)){for(;ie<pe;ie++)for(K=this[ie];K&&K!==O;K=K.parentNode)if(K.nodeType<11&&(Te?Te.index(K)>-1:K.nodeType===1&&h.find.matchesSelector(K,y))){me.push(K);break}}return this.pushStack(me.length>1?h.uniqueSort(me):me)},index:function(y){return y?typeof y=="string"?P.call(h(y),this[0]):P.call(this,y.jquery?y[0]:y):this[0]&&this[0].parentNode?this.first().prevAll().length:-1},add:function(y,O){return this.pushStack(h.uniqueSort(h.merge(this.get(),h(y,O))))},addBack:function(y){return this.add(y==null?this.prevObject:this.prevObject.filter(y))}}),h.each({parent:function(y){var O=y.parentNode;return O&&O.nodeType!==11?O:null},parents:function(y){return we(y,"parentNode")},parentsUntil:function(y,O,K){return we(y,"parentNode",K)},next:function(y){return Ie(y,"nextSibling")},prev:function(y){return Ie(y,"previousSibling")},nextAll:function(y){return we(y,"nextSibling")},prevAll:function(y){return we(y,"previousSibling")},nextUntil:function(y,O,K){return we(y,"nextSibling",K)},prevUntil:function(y,O,K){return we(y,"previousSibling",K)},siblings:function(y){return Be((y.parentNode||{}).firstChild,y)},children:function(y){return Be(y.firstChild)},contents:function(y){return y.contentDocument!=null&&x(y.contentDocument)?y.contentDocument:(v(y,"template")&&(y=y.content||y),h.merge([],y.childNodes))}},function(y,O){h.fn[y]=function(K,ie){var pe=h.map(this,O,K);return y.slice(-5)!=="Until"&&(ie=K),ie&&typeof ie=="string"&&(pe=h.filter(ie,pe)),this.length>1&&(ze[y]||h.uniqueSort(pe),at.test(y)&&pe.reverse()),this.pushStack(pe)}});var ue=/[^\x20\t\r\n\f]+/g;function Me(y){return y}function Je(y){throw y}function $e(y,O,K,ie){var pe;try{y&&S(pe=y.promise)?pe.call(y).done(O).fail(K):y&&S(pe=y.then)?pe.call(y,O,K):O.apply(void 0,[y].slice(ie))}catch(me){K.apply(void 0,[me])}}h.Callbacks=function(y){y=typeof y=="string"?function(rt){var dt={};return h.each(rt.match(ue)||[],function(ut,Lt){dt[Lt]=!0}),dt}(y):h.extend({},y);var O,K,ie,pe,me=[],Te=[],_e=-1,Se=function(){for(pe=pe||y.once,ie=O=!0;Te.length;_e=-1)for(K=Te.shift();++_e<me.length;)me[_e].apply(K[0],K[1])===!1&&y.stopOnFalse&&(_e=me.length,K=!1);y.memory||(K=!1),O=!1,pe&&(me=K?[]:"")},Fe={add:function(){return me&&(K&&!O&&(_e=me.length-1,Te.push(K)),function rt(dt){h.each(dt,function(ut,Lt){S(Lt)?y.unique&&Fe.has(Lt)||me.push(Lt):Lt&&Lt.length&&D(Lt)!=="string"&&rt(Lt)})}(arguments),K&&!O&&Se()),this},remove:function(){return h.each(arguments,function(rt,dt){for(var ut;(ut=h.inArray(dt,me,ut))>-1;)me.splice(ut,1),ut<=_e&&_e--}),this},has:function(rt){return rt?h.inArray(rt,me)>-1:me.length>0},empty:function(){return me&&(me=[]),this},disable:function(){return pe=Te=[],me=K="",this},disabled:function(){return!me},lock:function(){return pe=Te=[],K||O||(me=K=""),this},locked:function(){return!!pe},fireWith:function(rt,dt){return pe||(dt=[rt,(dt=dt||[]).slice?dt.slice():dt],Te.push(dt),O||Se()),this},fire:function(){return Fe.fireWith(this,arguments),this},fired:function(){return!!ie}};return Fe},h.extend({Deferred:function(y){var O=[["notify","progress",h.Callbacks("memory"),h.Callbacks("memory"),2],["resolve","done",h.Callbacks("once memory"),h.Callbacks("once memory"),0,"resolved"],["reject","fail",h.Callbacks("once memory"),h.Callbacks("once memory"),1,"rejected"]],K="pending",ie={state:function(){return K},always:function(){return pe.done(arguments).fail(arguments),this},catch:function(me){return ie.then(null,me)},pipe:function(){var me=arguments;return h.Deferred(function(Te){h.each(O,function(_e,Se){var Fe=S(me[Se[4]])&&me[Se[4]];pe[Se[1]](function(){var rt=Fe&&Fe.apply(this,arguments);rt&&S(rt.promise)?rt.promise().progress(Te.notify).done(Te.resolve).fail(Te.reject):Te[Se[0]+"With"](this,Fe?[rt]:arguments)})}),me=null}).promise()},then:function(me,Te,_e){var Se=0;function Fe(rt,dt,ut,Lt){return function(){var Rr=this,At=arguments,Wr=function(){var Un,la;if(!(rt<Se)){if((Un=ut.apply(Rr,At))===dt.promise())throw new TypeError("Thenable self-resolution");la=Un&&(typeof Un=="object"||typeof Un=="function")&&Un.then,S(la)?Lt?la.call(Un,Fe(Se,dt,Me,Lt),Fe(Se,dt,Je,Lt)):(Se++,la.call(Un,Fe(Se,dt,Me,Lt),Fe(Se,dt,Je,Lt),Fe(Se,dt,Me,dt.notifyWith))):(ut!==Me&&(Rr=void 0,At=[Un]),(Lt||dt.resolveWith)(Rr,At))}},Zn=Lt?Wr:function(){try{Wr()}catch(Un){h.Deferred.exceptionHook&&h.Deferred.exceptionHook(Un,Zn.error),rt+1>=Se&&(ut!==Je&&(Rr=void 0,At=[Un]),dt.rejectWith(Rr,At))}};rt?Zn():(h.Deferred.getErrorHook?Zn.error=h.Deferred.getErrorHook():h.Deferred.getStackHook&&(Zn.error=h.Deferred.getStackHook()),a.setTimeout(Zn))}}return h.Deferred(function(rt){O[0][3].add(Fe(0,rt,S(_e)?_e:Me,rt.notifyWith)),O[1][3].add(Fe(0,rt,S(me)?me:Me)),O[2][3].add(Fe(0,rt,S(Te)?Te:Je))}).promise()},promise:function(me){return me!=null?h.extend(me,ie):ie}},pe={};return h.each(O,function(me,Te){var _e=Te[2],Se=Te[5];ie[Te[1]]=_e.add,Se&&_e.add(function(){K=Se},O[3-me][2].disable,O[3-me][3].disable,O[0][2].lock,O[0][3].lock),_e.add(Te[3].fire),pe[Te[0]]=function(){return pe[Te[0]+"With"](this===pe?void 0:this,arguments),this},pe[Te[0]+"With"]=_e.fireWith}),ie.promise(pe),y&&y.call(pe,pe),pe},when:function(y){var O=arguments.length,K=O,ie=Array(K),pe=A.call(arguments),me=h.Deferred(),Te=function(_e){return function(Se){ie[_e]=this,pe[_e]=arguments.length>1?A.call(arguments):Se,--O||me.resolveWith(ie,pe)}};if(O<=1&&($e(y,me.done(Te(K)).resolve,me.reject,!O),me.state()==="pending"||S(pe[K]&&pe[K].then)))return me.then();for(;K--;)$e(pe[K],Te(K),me.reject);return me.promise()}});var ft=/^(Eval|Internal|Range|Reference|Syntax|Type|URI)Error$/;h.Deferred.exceptionHook=function(y,O){a.console&&a.console.warn&&y&&ft.test(y.name)&&a.console.warn("jQuery.Deferred exception: "+y.message,y.stack,O)},h.readyException=function(y){a.setTimeout(function(){throw y})};var Pt=h.Deferred();function _t(){G.removeEventListener("DOMContentLoaded",_t),a.removeEventListener("load",_t),h.ready()}h.fn.ready=function(y){return Pt.then(y).catch(function(O){h.readyException(O)}),this},h.extend({isReady:!1,readyWait:1,ready:function(y){(y===!0?--h.readyWait:h.isReady)||(h.isReady=!0,y!==!0&&--h.readyWait>0||Pt.resolveWith(G,[h]))}}),h.ready.then=Pt.then,G.readyState==="complete"||G.readyState!=="loading"&&!G.documentElement.doScroll?a.setTimeout(h.ready):(G.addEventListener("DOMContentLoaded",_t),a.addEventListener("load",_t));var Ue=function(y,O,K,ie,pe,me,Te){var _e=0,Se=y.length,Fe=K==null;if(D(K)==="object")for(_e in pe=!0,K)Ue(y,O,_e,K[_e],!0,me,Te);else if(ie!==void 0&&(pe=!0,S(ie)||(Te=!0),Fe&&(Te?(O.call(y,ie),O=null):(Fe=O,O=function(rt,dt,ut){return Fe.call(h(rt),ut)})),O))for(;_e<Se;_e++)O(y[_e],K,Te?ie:ie.call(y[_e],_e,O(y[_e],K)));return pe?y:Fe?O.call(y):Se?O(y[0],K):me},Rt=/^-ms-/,It=/-([a-z])/g;function Nr(y,O){return O.toUpperCase()}function Qt(y){return y.replace(Rt,"ms-").replace(It,Nr)}var Ur=function(y){return y.nodeType===1||y.nodeType===9||!+y.nodeType};function gt(){this.expando=h.expando+gt.uid++}gt.uid=1,gt.prototype={cache:function(y){var O=y[this.expando];return O||(O={},Ur(y)&&(y.nodeType?y[this.expando]=O:Object.defineProperty(y,this.expando,{value:O,configurable:!0}))),O},set:function(y,O,K){var ie,pe=this.cache(y);if(typeof O=="string")pe[Qt(O)]=K;else for(ie in O)pe[Qt(ie)]=O[ie];return pe},get:function(y,O){return O===void 0?this.cache(y):y[this.expando]&&y[this.expando][Qt(O)]},access:function(y,O,K){return O===void 0||O&&typeof O=="string"&&K===void 0?this.get(y,O):(this.set(y,O,K),K!==void 0?K:O)},remove:function(y,O){var K,ie=y[this.expando];if(ie!==void 0){if(O!==void 0)for(K=(O=Array.isArray(O)?O.map(Qt):(O=Qt(O))in ie?[O]:O.match(ue)||[]).length;K--;)delete ie[O[K]];(O===void 0||h.isEmptyObject(ie))&&(y.nodeType?y[this.expando]=void 0:delete y[this.expando])}},hasData:function(y){var O=y[this.expando];return O!==void 0&&!h.isEmptyObject(O)}};var We=new gt,Yt=new gt,Or=/^(?:\{[\w\W]*\}|\[[\w\W]*\])$/,Yr=/[A-Z]/g;function ct(y,O,K){var ie;if(K===void 0&&y.nodeType===1)if(ie="data-"+O.replace(Yr,"-$&").toLowerCase(),typeof(K=y.getAttribute(ie))=="string"){try{K=function(pe){return pe==="true"||pe!=="false"&&(pe==="null"?null:pe===+pe+""?+pe:Or.test(pe)?JSON.parse(pe):pe)}(K)}catch{}Yt.set(y,O,K)}else K=void 0;return K}h.extend({hasData:function(y){return Yt.hasData(y)||We.hasData(y)},data:function(y,O,K){return Yt.access(y,O,K)},removeData:function(y,O){Yt.remove(y,O)},_data:function(y,O,K){return We.access(y,O,K)},_removeData:function(y,O){We.remove(y,O)}}),h.fn.extend({data:function(y,O){var K,ie,pe,me=this[0],Te=me&&me.attributes;if(y===void 0){if(this.length&&(pe=Yt.get(me),me.nodeType===1&&!We.get(me,"hasDataAttrs"))){for(K=Te.length;K--;)Te[K]&&(ie=Te[K].name).indexOf("data-")===0&&(ie=Qt(ie.slice(5)),ct(me,ie,pe[ie]));We.set(me,"hasDataAttrs",!0)}return pe}return typeof y=="object"?this.each(function(){Yt.set(this,y)}):Ue(this,function(_e){var Se;if(me&&_e===void 0)return(Se=Yt.get(me,y))!==void 0||(Se=ct(me,y))!==void 0?Se:void 0;this.each(function(){Yt.set(this,y,_e)})},null,O,arguments.length>1,null,!0)},removeData:function(y){return this.each(function(){Yt.remove(this,y)})}}),h.extend({queue:function(y,O,K){var ie;if(y)return O=(O||"fx")+"queue",ie=We.get(y,O),K&&(!ie||Array.isArray(K)?ie=We.access(y,O,h.makeArray(K)):ie.push(K)),ie||[]},dequeue:function(y,O){O=O||"fx";var K=h.queue(y,O),ie=K.length,pe=K.shift(),me=h._queueHooks(y,O);pe==="inprogress"&&(pe=K.shift(),ie--),pe&&(O==="fx"&&K.unshift("inprogress"),delete me.stop,pe.call(y,function(){h.dequeue(y,O)},me)),!ie&&me&&me.empty.fire()},_queueHooks:function(y,O){var K=O+"queueHooks";return We.get(y,K)||We.access(y,K,{empty:h.Callbacks("once memory").add(function(){We.remove(y,[O+"queue",K])})})}}),h.fn.extend({queue:function(y,O){var K=2;return typeof y!="string"&&(O=y,y="fx",K--),arguments.length<K?h.queue(this[0],y):O===void 0?this:this.each(function(){var ie=h.queue(this,y,O);h._queueHooks(this,y),y==="fx"&&ie[0]!=="inprogress"&&h.dequeue(this,y)})},dequeue:function(y){return this.each(function(){h.dequeue(this,y)})},clearQueue:function(y){return this.queue(y||"fx",[])},promise:function(y,O){var K,ie=1,pe=h.Deferred(),me=this,Te=this.length,_e=function(){--ie||pe.resolveWith(me,[me])};for(typeof y!="string"&&(O=y,y=void 0),y=y||"fx";Te--;)(K=We.get(me[Te],y+"queueHooks"))&&K.empty&&(ie++,K.empty.add(_e));return _e(),pe.promise(O)}});var st=/[+-]?(?:\d*\.|)\d+(?:[eE][+-]?\d+|)/.source,qt=new RegExp("^(?:([+-])=|)("+st+")([a-z%]*)$","i"),Tr=["Top","Right","Bottom","Left"],ir=G.documentElement,Hr=function(y){return h.contains(y.ownerDocument,y)},vn={composed:!0};ir.getRootNode&&(Hr=function(y){return h.contains(y.ownerDocument,y)||y.getRootNode(vn)===y.ownerDocument});var In=function(y,O){return(y=O||y).style.display==="none"||y.style.display===""&&Hr(y)&&h.css(y,"display")==="none"};function Zr(y,O,K,ie){var pe,me,Te=20,_e=ie?function(){return ie.cur()}:function(){return h.css(y,O,"")},Se=_e(),Fe=K&&K[3]||(h.cssNumber[O]?"":"px"),rt=y.nodeType&&(h.cssNumber[O]||Fe!=="px"&&+Se)&&qt.exec(h.css(y,O));if(rt&&rt[3]!==Fe){for(Se/=2,Fe=Fe||rt[3],rt=+Se||1;Te--;)h.style(y,O,rt+Fe),(1-me)*(1-(me=_e()/Se||.5))<=0&&(Te=0),rt/=me;rt*=2,h.style(y,O,rt+Fe),K=K||[]}return K&&(rt=+rt||+Se||0,pe=K[1]?rt+(K[1]+1)*K[2]:+K[2],ie&&(ie.unit=Fe,ie.start=rt,ie.end=pe)),pe}var Gn={};function lt(y){var O,K=y.ownerDocument,ie=y.nodeName,pe=Gn[ie];return pe||(O=K.body.appendChild(K.createElement(ie)),pe=h.css(O,"display"),O.parentNode.removeChild(O),pe==="none"&&(pe="block"),Gn[ie]=pe,pe)}function xe(y,O){for(var K,ie,pe=[],me=0,Te=y.length;me<Te;me++)(ie=y[me]).style&&(K=ie.style.display,O?(K==="none"&&(pe[me]=We.get(ie,"display")||null,pe[me]||(ie.style.display="")),ie.style.display===""&&In(ie)&&(pe[me]=lt(ie))):K!=="none"&&(pe[me]="none",We.set(ie,"display",K)));for(me=0;me<Te;me++)pe[me]!=null&&(y[me].style.display=pe[me]);return y}h.fn.extend({show:function(){return xe(this,!0)},hide:function(){return xe(this)},toggle:function(y){return typeof y=="boolean"?y?this.show():this.hide():this.each(function(){In(this)?h(this).show():h(this).hide()})}});var ke,bt,er=/^(?:checkbox|radio)$/i,Ar=/<([a-z][^\/\0>\x20\t\r\n\f]*)/i,Cr=/^$|^module$|\/(?:java|ecma)script/i;ke=G.createDocumentFragment().appendChild(G.createElement("div")),(bt=G.createElement("input")).setAttribute("type","radio"),bt.setAttribute("checked","checked"),bt.setAttribute("name","t"),ke.appendChild(bt),C.checkClone=ke.cloneNode(!0).cloneNode(!0).lastChild.checked,ke.innerHTML="<textarea>x</textarea>",C.noCloneChecked=!!ke.cloneNode(!0).lastChild.defaultValue,ke.innerHTML="<option></option>",C.option=!!ke.lastChild;var Kr={thead:[1,"<table>","</table>"],col:[2,"<table><colgroup>","</colgroup></table>"],tr:[2,"<table><tbody>","</tbody></table>"],td:[3,"<table><tbody><tr>","</tr></tbody></table>"],_default:[0,"",""]};function _n(y,O){var K;return K=y.getElementsByTagName!==void 0?y.getElementsByTagName(O||"*"):y.querySelectorAll!==void 0?y.querySelectorAll(O||"*"):[],O===void 0||O&&v(y,O)?h.merge([y],K):K}function Sn(y,O){for(var K=0,ie=y.length;K<ie;K++)We.set(y[K],"globalEval",!O||We.get(O[K],"globalEval"))}Kr.tbody=Kr.tfoot=Kr.colgroup=Kr.caption=Kr.thead,Kr.th=Kr.td,C.option||(Kr.optgroup=Kr.option=[1,"<select multiple='multiple'>","</select>"]);var Tn=/<|&#?\w+;/;function Sa(y,O,K,ie,pe){for(var me,Te,_e,Se,Fe,rt,dt=O.createDocumentFragment(),ut=[],Lt=0,Rr=y.length;Lt<Rr;Lt++)if((me=y[Lt])||me===0)if(D(me)==="object")h.merge(ut,me.nodeType?[me]:me);else if(Tn.test(me)){for(Te=Te||dt.appendChild(O.createElement("div")),_e=(Ar.exec(me)||["",""])[1].toLowerCase(),Se=Kr[_e]||Kr._default,Te.innerHTML=Se[1]+h.htmlPrefilter(me)+Se[2],rt=Se[0];rt--;)Te=Te.lastChild;h.merge(ut,Te.childNodes),(Te=dt.firstChild).textContent=""}else ut.push(O.createTextNode(me));for(dt.textContent="",Lt=0;me=ut[Lt++];)if(ie&&h.inArray(me,ie)>-1)pe&&pe.push(me);else if(Fe=Hr(me),Te=_n(dt.appendChild(me),"script"),Fe&&Sn(Te),K)for(rt=0;me=Te[rt++];)Cr.test(me.type||"")&&K.push(me);return dt}var hi=/^([^.]*)(?:\.(.+)|)/;function ri(){return!0}function an(){return!1}function Mi(y,O,K,ie,pe,me){var Te,_e;if(typeof O=="object"){for(_e in typeof K!="string"&&(ie=ie||K,K=void 0),O)Mi(y,_e,K,ie,O[_e],me);return y}if(ie==null&&pe==null?(pe=K,ie=K=void 0):pe==null&&(typeof K=="string"?(pe=ie,ie=void 0):(pe=ie,ie=K,K=void 0)),pe===!1)pe=an;else if(!pe)return y;return me===1&&(Te=pe,(pe=function(Se){return h().off(Se),Te.apply(this,arguments)}).guid=Te.guid||(Te.guid=h.guid++)),y.each(function(){h.event.add(this,O,pe,ie,K)})}function q(y,O,K){K?(We.set(y,O,!1),h.event.add(y,O,{namespace:!1,handler:function(ie){var pe,me=We.get(this,O);if(1&ie.isTrigger&&this[O]){if(me)(h.event.special[O]||{}).delegateType&&ie.stopPropagation();else if(me=A.call(arguments),We.set(this,O,me),this[O](),pe=We.get(this,O),We.set(this,O,!1),me!==pe)return ie.stopImmediatePropagation(),ie.preventDefault(),pe}else me&&(We.set(this,O,h.event.trigger(me[0],me.slice(1),this)),ie.stopPropagation(),ie.isImmediatePropagationStopped=ri)}})):We.get(y,O)===void 0&&h.event.add(y,O,ri)}h.event={global:{},add:function(y,O,K,ie,pe){var me,Te,_e,Se,Fe,rt,dt,ut,Lt,Rr,At,Wr=We.get(y);if(Ur(y))for(K.handler&&(K=(me=K).handler,pe=me.selector),pe&&h.find.matchesSelector(ir,pe),K.guid||(K.guid=h.guid++),(Se=Wr.events)||(Se=Wr.events=Object.create(null)),(Te=Wr.handle)||(Te=Wr.handle=function(Zn){return h!==void 0&&h.event.triggered!==Zn.type?h.event.dispatch.apply(y,arguments):void 0}),Fe=(O=(O||"").match(ue)||[""]).length;Fe--;)Lt=At=(_e=hi.exec(O[Fe])||[])[1],Rr=(_e[2]||"").split(".").sort(),Lt&&(dt=h.event.special[Lt]||{},Lt=(pe?dt.delegateType:dt.bindType)||Lt,dt=h.event.special[Lt]||{},rt=h.extend({type:Lt,origType:At,data:ie,handler:K,guid:K.guid,selector:pe,needsContext:pe&&h.expr.match.needsContext.test(pe),namespace:Rr.join(".")},me),(ut=Se[Lt])||((ut=Se[Lt]=[]).delegateCount=0,dt.setup&&dt.setup.call(y,ie,Rr,Te)!==!1||y.addEventListener&&y.addEventListener(Lt,Te)),dt.add&&(dt.add.call(y,rt),rt.handler.guid||(rt.handler.guid=K.guid)),pe?ut.splice(ut.delegateCount++,0,rt):ut.push(rt),h.event.global[Lt]=!0)},remove:function(y,O,K,ie,pe){var me,Te,_e,Se,Fe,rt,dt,ut,Lt,Rr,At,Wr=We.hasData(y)&&We.get(y);if(Wr&&(Se=Wr.events)){for(Fe=(O=(O||"").match(ue)||[""]).length;Fe--;)if(Lt=At=(_e=hi.exec(O[Fe])||[])[1],Rr=(_e[2]||"").split(".").sort(),Lt){for(dt=h.event.special[Lt]||{},ut=Se[Lt=(ie?dt.delegateType:dt.bindType)||Lt]||[],_e=_e[2]&&new RegExp("(^|\\.)"+Rr.join("\\.(?:.*\\.|)")+"(\\.|$)"),Te=me=ut.length;me--;)rt=ut[me],!pe&&At!==rt.origType||K&&K.guid!==rt.guid||_e&&!_e.test(rt.namespace)||ie&&ie!==rt.selector&&(ie!=="**"||!rt.selector)||(ut.splice(me,1),rt.selector&&ut.delegateCount--,dt.remove&&dt.remove.call(y,rt));Te&&!ut.length&&(dt.teardown&&dt.teardown.call(y,Rr,Wr.handle)!==!1||h.removeEvent(y,Lt,Wr.handle),delete Se[Lt])}else for(Lt in Se)h.event.remove(y,Lt+O[Fe],K,ie,!0);h.isEmptyObject(Se)&&We.remove(y,"handle events")}},dispatch:function(y){var O,K,ie,pe,me,Te,_e=new Array(arguments.length),Se=h.event.fix(y),Fe=(We.get(this,"events")||Object.create(null))[Se.type]||[],rt=h.event.special[Se.type]||{};for(_e[0]=Se,O=1;O<arguments.length;O++)_e[O]=arguments[O];if(Se.delegateTarget=this,!rt.preDispatch||rt.preDispatch.call(this,Se)!==!1){for(Te=h.event.handlers.call(this,Se,Fe),O=0;(pe=Te[O++])&&!Se.isPropagationStopped();)for(Se.currentTarget=pe.elem,K=0;(me=pe.handlers[K++])&&!Se.isImmediatePropagationStopped();)Se.rnamespace&&me.namespace!==!1&&!Se.rnamespace.test(me.namespace)||(Se.handleObj=me,Se.data=me.data,(ie=((h.event.special[me.origType]||{}).handle||me.handler).apply(pe.elem,_e))!==void 0&&(Se.result=ie)===!1&&(Se.preventDefault(),Se.stopPropagation()));return rt.postDispatch&&rt.postDispatch.call(this,Se),Se.result}},handlers:function(y,O){var K,ie,pe,me,Te,_e=[],Se=O.delegateCount,Fe=y.target;if(Se&&Fe.nodeType&&!(y.type==="click"&&y.button>=1)){for(;Fe!==this;Fe=Fe.parentNode||this)if(Fe.nodeType===1&&(y.type!=="click"||Fe.disabled!==!0)){for(me=[],Te={},K=0;K<Se;K++)Te[pe=(ie=O[K]).selector+" "]===void 0&&(Te[pe]=ie.needsContext?h(pe,this).index(Fe)>-1:h.find(pe,this,null,[Fe]).length),Te[pe]&&me.push(ie);me.length&&_e.push({elem:Fe,handlers:me})}}return Fe=this,Se<O.length&&_e.push({elem:Fe,handlers:O.slice(Se)}),_e},addProp:function(y,O){Object.defineProperty(h.Event.prototype,y,{enumerable:!0,configurable:!0,get:S(O)?function(){if(this.originalEvent)return O(this.originalEvent)}:function(){if(this.originalEvent)return this.originalEvent[y]},set:function(K){Object.defineProperty(this,y,{enumerable:!0,configurable:!0,writable:!0,value:K})}})},fix:function(y){return y[h.expando]?y:new h.Event(y)},special:{load:{noBubble:!0},click:{setup:function(y){var O=this||y;return er.test(O.type)&&O.click&&v(O,"input")&&q(O,"click",!0),!1},trigger:function(y){var O=this||y;return er.test(O.type)&&O.click&&v(O,"input")&&q(O,"click"),!0},_default:function(y){var O=y.target;return er.test(O.type)&&O.click&&v(O,"input")&&We.get(O,"click")||v(O,"a")}},beforeunload:{postDispatch:function(y){y.result!==void 0&&y.originalEvent&&(y.originalEvent.returnValue=y.result)}}}},h.removeEvent=function(y,O,K){y.removeEventListener&&y.removeEventListener(O,K)},h.Event=function(y,O){if(!(this instanceof h.Event))return new h.Event(y,O);y&&y.type?(this.originalEvent=y,this.type=y.type,this.isDefaultPrevented=y.defaultPrevented||y.defaultPrevented===void 0&&y.returnValue===!1?ri:an,this.target=y.target&&y.target.nodeType===3?y.target.parentNode:y.target,this.currentTarget=y.currentTarget,this.relatedTarget=y.relatedTarget):this.type=y,O&&h.extend(this,O),this.timeStamp=y&&y.timeStamp||Date.now(),this[h.expando]=!0},h.Event.prototype={constructor:h.Event,isDefaultPrevented:an,isPropagationStopped:an,isImmediatePropagationStopped:an,isSimulated:!1,preventDefault:function(){var y=this.originalEvent;this.isDefaultPrevented=ri,y&&!this.isSimulated&&y.preventDefault()},stopPropagation:function(){var y=this.originalEvent;this.isPropagationStopped=ri,y&&!this.isSimulated&&y.stopPropagation()},stopImmediatePropagation:function(){var y=this.originalEvent;this.isImmediatePropagationStopped=ri,y&&!this.isSimulated&&y.stopImmediatePropagation(),this.stopPropagation()}},h.each({altKey:!0,bubbles:!0,cancelable:!0,changedTouches:!0,ctrlKey:!0,detail:!0,eventPhase:!0,metaKey:!0,pageX:!0,pageY:!0,shiftKey:!0,view:!0,char:!0,code:!0,charCode:!0,key:!0,keyCode:!0,button:!0,buttons:!0,clientX:!0,clientY:!0,offsetX:!0,offsetY:!0,pointerId:!0,pointerType:!0,screenX:!0,screenY:!0,targetTouches:!0,toElement:!0,touches:!0,which:!0},h.event.addProp),h.each({focus:"focusin",blur:"focusout"},function(y,O){function K(ie){if(G.documentMode){var pe=We.get(this,"handle"),me=h.event.fix(ie);me.type=ie.type==="focusin"?"focus":"blur",me.isSimulated=!0,pe(ie),me.target===me.currentTarget&&pe(me)}else h.event.simulate(O,ie.target,h.event.fix(ie))}h.event.special[y]={setup:function(){var ie;if(q(this,y,!0),!G.documentMode)return!1;(ie=We.get(this,O))||this.addEventListener(O,K),We.set(this,O,(ie||0)+1)},trigger:function(){return q(this,y),!0},teardown:function(){var ie;if(!G.documentMode)return!1;(ie=We.get(this,O)-1)?We.set(this,O,ie):(this.removeEventListener(O,K),We.remove(this,O))},_default:function(ie){return We.get(ie.target,y)},delegateType:O},h.event.special[O]={setup:function(){var ie=this.ownerDocument||this.document||this,pe=G.documentMode?this:ie,me=We.get(pe,O);me||(G.documentMode?this.addEventListener(O,K):ie.addEventListener(y,K,!0)),We.set(pe,O,(me||0)+1)},teardown:function(){var ie=this.ownerDocument||this.document||this,pe=G.documentMode?this:ie,me=We.get(pe,O)-1;me?We.set(pe,O,me):(G.documentMode?this.removeEventListener(O,K):ie.removeEventListener(y,K,!0),We.remove(pe,O))}}}),h.each({mouseenter:"mouseover",mouseleave:"mouseout",pointerenter:"pointerover",pointerleave:"pointerout"},function(y,O){h.event.special[y]={delegateType:O,bindType:O,handle:function(K){var ie,pe=K.relatedTarget,me=K.handleObj;return pe&&(pe===this||h.contains(this,pe))||(K.type=me.origType,ie=me.handler.apply(this,arguments),K.type=O),ie}}}),h.fn.extend({on:function(y,O,K,ie){return Mi(this,y,O,K,ie)},one:function(y,O,K,ie){return Mi(this,y,O,K,ie,1)},off:function(y,O,K){var ie,pe;if(y&&y.preventDefault&&y.handleObj)return ie=y.handleObj,h(y.delegateTarget).off(ie.namespace?ie.origType+"."+ie.namespace:ie.origType,ie.selector,ie.handler),this;if(typeof y=="object"){for(pe in y)this.off(pe,O,y[pe]);return this}return O!==!1&&typeof O!="function"||(K=O,O=void 0),K===!1&&(K=an),this.each(function(){h.event.remove(this,y,K,O)})}});var Cn=/<script|<style|<link/i,pi=/checked\s*(?:[^=]|=\s*.checked.)/i,Fr=/^\s*<!\[CDATA\[|\]\]>\s*$/g;function Ei(y,O){return v(y,"table")&&v(O.nodeType!==11?O:O.firstChild,"tr")&&h(y).children("tbody")[0]||y}function vo(y){return y.type=(y.getAttribute("type")!==null)+"/"+y.type,y}function ts(y){return(y.type||"").slice(0,5)==="true/"?y.type=y.type.slice(5):y.removeAttribute("type"),y}function Do(y,O){var K,ie,pe,me,Te,_e;if(O.nodeType===1){if(We.hasData(y)&&(_e=We.get(y).events))for(pe in We.remove(O,"handle events"),_e)for(K=0,ie=_e[pe].length;K<ie;K++)h.event.add(O,pe,_e[pe][K]);Yt.hasData(y)&&(me=Yt.access(y),Te=h.extend({},me),Yt.set(O,Te))}}function ms(y,O){var K=O.nodeName.toLowerCase();K==="input"&&er.test(y.type)?O.checked=y.checked:K!=="input"&&K!=="textarea"||(O.defaultValue=y.defaultValue)}function to(y,O,K,ie){O=H(O);var pe,me,Te,_e,Se,Fe,rt=0,dt=y.length,ut=dt-1,Lt=O[0],Rr=S(Lt);if(Rr||dt>1&&typeof Lt=="string"&&!C.checkClone&&pi.test(Lt))return y.each(function(At){var Wr=y.eq(At);Rr&&(O[0]=Lt.call(this,At,Wr.html())),to(Wr,O,K,ie)});if(dt&&(me=(pe=Sa(O,y[0].ownerDocument,!1,y,ie)).firstChild,pe.childNodes.length===1&&(pe=me),me||ie)){for(_e=(Te=h.map(_n(pe,"script"),vo)).length;rt<dt;rt++)Se=pe,rt!==ut&&(Se=h.clone(Se,!0,!0),_e&&h.merge(Te,_n(Se,"script"))),K.call(y[rt],Se,rt);if(_e)for(Fe=Te[Te.length-1].ownerDocument,h.map(Te,ts),rt=0;rt<_e;rt++)Se=Te[rt],Cr.test(Se.type||"")&&!We.access(Se,"globalEval")&&h.contains(Fe,Se)&&(Se.src&&(Se.type||"").toLowerCase()!=="module"?h._evalUrl&&!Se.noModule&&h._evalUrl(Se.src,{nonce:Se.nonce||Se.getAttribute("nonce")},Fe):B(Se.textContent.replace(Fr,""),Se,Fe))}return y}function rs(y,O,K){for(var ie,pe=O?h.filter(O,y):y,me=0;(ie=pe[me])!=null;me++)K||ie.nodeType!==1||h.cleanData(_n(ie)),ie.parentNode&&(K&&Hr(ie)&&Sn(_n(ie,"script")),ie.parentNode.removeChild(ie));return y}h.extend({htmlPrefilter:function(y){return y},clone:function(y,O,K){var ie,pe,me,Te,_e=y.cloneNode(!0),Se=Hr(y);if(!(C.noCloneChecked||y.nodeType!==1&&y.nodeType!==11||h.isXMLDoc(y)))for(Te=_n(_e),ie=0,pe=(me=_n(y)).length;ie<pe;ie++)ms(me[ie],Te[ie]);if(O)if(K)for(me=me||_n(y),Te=Te||_n(_e),ie=0,pe=me.length;ie<pe;ie++)Do(me[ie],Te[ie]);else Do(y,_e);return(Te=_n(_e,"script")).length>0&&Sn(Te,!Se&&_n(y,"script")),_e},cleanData:function(y){for(var O,K,ie,pe=h.event.special,me=0;(K=y[me])!==void 0;me++)if(Ur(K)){if(O=K[We.expando]){if(O.events)for(ie in O.events)pe[ie]?h.event.remove(K,ie):h.removeEvent(K,ie,O.handle);K[We.expando]=void 0}K[Yt.expando]&&(K[Yt.expando]=void 0)}}}),h.fn.extend({detach:function(y){return rs(this,y,!0)},remove:function(y){return rs(this,y)},text:function(y){return Ue(this,function(O){return O===void 0?h.text(this):this.empty().each(function(){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||(this.textContent=O)})},null,y,arguments.length)},append:function(){return to(this,arguments,function(y){this.nodeType!==1&&this.nodeType!==11&&this.nodeType!==9||Ei(this,y).appendChild(y)})},prepend:function(){return to(this,arguments,function(y){if(this.nodeType===1||this.nodeType===11||this.nodeType===9){var O=Ei(this,y);O.insertBefore(y,O.firstChild)}})},before:function(){return to(this,arguments,function(y){this.parentNode&&this.parentNode.insertBefore(y,this)})},after:function(){return to(this,arguments,function(y){this.parentNode&&this.parentNode.insertBefore(y,this.nextSibling)})},empty:function(){for(var y,O=0;(y=this[O])!=null;O++)y.nodeType===1&&(h.cleanData(_n(y,!1)),y.textContent="");return this},clone:function(y,O){return y=y!=null&&y,O=O??y,this.map(function(){return h.clone(this,y,O)})},html:function(y){return Ue(this,function(O){var K=this[0]||{},ie=0,pe=this.length;if(O===void 0&&K.nodeType===1)return K.innerHTML;if(typeof O=="string"&&!Cn.test(O)&&!Kr[(Ar.exec(O)||["",""])[1].toLowerCase()]){O=h.htmlPrefilter(O);try{for(;ie<pe;ie++)(K=this[ie]||{}).nodeType===1&&(h.cleanData(_n(K,!1)),K.innerHTML=O);K=0}catch{}}K&&this.empty().append(O)},null,y,arguments.length)},replaceWith:function(){var y=[];return to(this,arguments,function(O){var K=this.parentNode;h.inArray(this,y)<0&&(h.cleanData(_n(this)),K&&K.replaceChild(O,this))},y)}}),h.each({appendTo:"append",prependTo:"prepend",insertBefore:"before",insertAfter:"after",replaceAll:"replaceWith"},function(y,O){h.fn[y]=function(K){for(var ie,pe=[],me=h(K),Te=me.length-1,_e=0;_e<=Te;_e++)ie=_e===Te?this:this.clone(!0),h(me[_e])[O](ie),F.apply(pe,ie.get());return this.pushStack(pe)}});var sa=new RegExp("^("+st+")(?!px)[a-z%]+$","i"),Fo=/^--/,Ea=function(y){var O=y.ownerDocument.defaultView;return O&&O.opener||(O=a),O.getComputedStyle(y)},gs=function(y,O,K){var ie,pe,me={};for(pe in O)me[pe]=y.style[pe],y.style[pe]=O[pe];for(pe in ie=K.call(y),O)y.style[pe]=me[pe];return ie},Bs=new RegExp(Tr.join("|"),"i");function ro(y,O,K){var ie,pe,me,Te,_e=Fo.test(O),Se=y.style;return(K=K||Ea(y))&&(Te=K.getPropertyValue(O)||K[O],_e&&Te&&(Te=Te.replace(te,"$1")||void 0),Te!==""||Hr(y)||(Te=h.style(y,O)),!C.pixelBoxStyles()&&sa.test(Te)&&Bs.test(O)&&(ie=Se.width,pe=Se.minWidth,me=Se.maxWidth,Se.minWidth=Se.maxWidth=Se.width=Te,Te=K.width,Se.width=ie,Se.minWidth=pe,Se.maxWidth=me)),Te!==void 0?Te+"":Te}function ys(y,O){return{get:function(){if(!y())return(this.get=O).apply(this,arguments);delete this.get}}}(function(){function y(){if(Fe){Se.style.cssText="position:absolute;left:-11111px;width:60px;margin-top:1px;padding:0;border:0",Fe.style.cssText="position:relative;display:block;box-sizing:border-box;overflow:scroll;margin:auto;border:1px;padding:1px;width:60%;top:1%",ir.appendChild(Se).appendChild(Fe);var rt=a.getComputedStyle(Fe);K=rt.top!=="1%",_e=O(rt.marginLeft)===12,Fe.style.right="60%",me=O(rt.right)===36,ie=O(rt.width)===36,Fe.style.position="absolute",pe=O(Fe.offsetWidth/3)===12,ir.removeChild(Se),Fe=null}}function O(rt){return Math.round(parseFloat(rt))}var K,ie,pe,me,Te,_e,Se=G.createElement("div"),Fe=G.createElement("div");Fe.style&&(Fe.style.backgroundClip="content-box",Fe.cloneNode(!0).style.backgroundClip="",C.clearCloneStyle=Fe.style.backgroundClip==="content-box",h.extend(C,{boxSizingReliable:function(){return y(),ie},pixelBoxStyles:function(){return y(),me},pixelPosition:function(){return y(),K},reliableMarginLeft:function(){return y(),_e},scrollboxSize:function(){return y(),pe},reliableTrDimensions:function(){var rt,dt,ut,Lt;return Te==null&&(rt=G.createElement("table"),dt=G.createElement("tr"),ut=G.createElement("div"),rt.style.cssText="position:absolute;left:-11111px;border-collapse:separate",dt.style.cssText="border:1px solid",dt.style.height="1px",ut.style.height="9px",ut.style.display="block",ir.appendChild(rt).appendChild(dt).appendChild(ut),Lt=a.getComputedStyle(dt),Te=parseInt(Lt.height,10)+parseInt(Lt.borderTopWidth,10)+parseInt(Lt.borderBottomWidth,10)===dt.offsetHeight,ir.removeChild(rt)),Te}}))})();var Oa=["Webkit","Moz","ms"],vs=G.createElement("div").style,no={};function io(y){return h.cssProps[y]||no[y]||(y in vs?y:no[y]=function(O){for(var K=O[0].toUpperCase()+O.slice(1),ie=Oa.length;ie--;)if((O=Oa[ie]+K)in vs)return O}(y)||y)}var Xn=/^(none|table(?!-c[ea]).+)/,An={position:"absolute",visibility:"hidden",display:"block"},ns={letterSpacing:"0",fontWeight:"400"};function xs(y,O,K){var ie=qt.exec(O);return ie?Math.max(0,ie[2]-(K||0))+(ie[3]||"px"):O}function is(y,O,K,ie,pe,me){var Te=O==="width"?1:0,_e=0,Se=0,Fe=0;if(K===(ie?"border":"content"))return 0;for(;Te<4;Te+=2)K==="margin"&&(Fe+=h.css(y,K+Tr[Te],!0,pe)),ie?(K==="content"&&(Se-=h.css(y,"padding"+Tr[Te],!0,pe)),K!=="margin"&&(Se-=h.css(y,"border"+Tr[Te]+"Width",!0,pe))):(Se+=h.css(y,"padding"+Tr[Te],!0,pe),K!=="padding"?Se+=h.css(y,"border"+Tr[Te]+"Width",!0,pe):_e+=h.css(y,"border"+Tr[Te]+"Width",!0,pe));return!ie&&me>=0&&(Se+=Math.max(0,Math.ceil(y["offset"+O[0].toUpperCase()+O.slice(1)]-me-Se-_e-.5))||0),Se+Fe}function Bo(y,O,K){var ie=Ea(y),pe=(!C.boxSizingReliable()||K)&&h.css(y,"boxSizing",!1,ie)==="border-box",me=pe,Te=ro(y,O,ie),_e="offset"+O[0].toUpperCase()+O.slice(1);if(sa.test(Te)){if(!K)return Te;Te="auto"}return(!C.boxSizingReliable()&&pe||!C.reliableTrDimensions()&&v(y,"tr")||Te==="auto"||!parseFloat(Te)&&h.css(y,"display",!1,ie)==="inline")&&y.getClientRects().length&&(pe=h.css(y,"boxSizing",!1,ie)==="border-box",(me=_e in y)&&(Te=y[_e])),(Te=parseFloat(Te)||0)+is(y,O,K||(pe?"border":"content"),me,ie,Te)+"px"}function Xi(y,O,K,ie,pe){return new Xi.prototype.init(y,O,K,ie,pe)}h.extend({cssHooks:{opacity:{get:function(y,O){if(O){var K=ro(y,"opacity");return K===""?"1":K}}}},cssNumber:{animationIterationCount:!0,aspectRatio:!0,borderImageSlice:!0,columnCount:!0,flexGrow:!0,flexShrink:!0,fontWeight:!0,gridArea:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnStart:!0,gridRow:!0,gridRowEnd:!0,gridRowStart:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,scale:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeMiterlimit:!0,strokeOpacity:!0},cssProps:{},style:function(y,O,K,ie){if(y&&y.nodeType!==3&&y.nodeType!==8&&y.style){var pe,me,Te,_e=Qt(O),Se=Fo.test(O),Fe=y.style;if(Se||(O=io(_e)),Te=h.cssHooks[O]||h.cssHooks[_e],K===void 0)return Te&&"get"in Te&&(pe=Te.get(y,!1,ie))!==void 0?pe:Fe[O];(me=typeof K)=="string"&&(pe=qt.exec(K))&&pe[1]&&(K=Zr(y,O,pe),me="number"),K!=null&&K==K&&(me!=="number"||Se||(K+=pe&&pe[3]||(h.cssNumber[_e]?"":"px")),C.clearCloneStyle||K!==""||O.indexOf("background")!==0||(Fe[O]="inherit"),Te&&"set"in Te&&(K=Te.set(y,K,ie))===void 0||(Se?Fe.setProperty(O,K):Fe[O]=K))}},css:function(y,O,K,ie){var pe,me,Te,_e=Qt(O);return Fo.test(O)||(O=io(_e)),(Te=h.cssHooks[O]||h.cssHooks[_e])&&"get"in Te&&(pe=Te.get(y,!0,K)),pe===void 0&&(pe=ro(y,O,ie)),pe==="normal"&&O in ns&&(pe=ns[O]),K===""||K?(me=parseFloat(pe),K===!0||isFinite(me)?me||0:pe):pe}}),h.each(["height","width"],function(y,O){h.cssHooks[O]={get:function(K,ie,pe){if(ie)return!Xn.test(h.css(K,"display"))||K.getClientRects().length&&K.getBoundingClientRect().width?Bo(K,O,pe):gs(K,An,function(){return Bo(K,O,pe)})},set:function(K,ie,pe){var me,Te=Ea(K),_e=!C.scrollboxSize()&&Te.position==="absolute",Se=(_e||pe)&&h.css(K,"boxSizing",!1,Te)==="border-box",Fe=pe?is(K,O,pe,Se,Te):0;return Se&&_e&&(Fe-=Math.ceil(K["offset"+O[0].toUpperCase()+O.slice(1)]-parseFloat(Te[O])-is(K,O,"border",!1,Te)-.5)),Fe&&(me=qt.exec(ie))&&(me[3]||"px")!=="px"&&(K.style[O]=ie,ie=h.css(K,O)),xs(0,ie,Fe)}}}),h.cssHooks.marginLeft=ys(C.reliableMarginLeft,function(y,O){if(O)return(parseFloat(ro(y,"marginLeft"))||y.getBoundingClientRect().left-gs(y,{marginLeft:0},function(){return y.getBoundingClientRect().left}))+"px"}),h.each({margin:"",padding:"",border:"Width"},function(y,O){h.cssHooks[y+O]={expand:function(K){for(var ie=0,pe={},me=typeof K=="string"?K.split(" "):[K];ie<4;ie++)pe[y+Tr[ie]+O]=me[ie]||me[ie-2]||me[0];return pe}},y!=="margin"&&(h.cssHooks[y+O].set=xs)}),h.fn.extend({css:function(y,O){return Ue(this,function(K,ie,pe){var me,Te,_e={},Se=0;if(Array.isArray(ie)){for(me=Ea(K),Te=ie.length;Se<Te;Se++)_e[ie[Se]]=h.css(K,ie[Se],!1,me);return _e}return pe!==void 0?h.style(K,ie,pe):h.css(K,ie)},y,O,arguments.length>1)}}),h.Tween=Xi,Xi.prototype={constructor:Xi,init:function(y,O,K,ie,pe,me){this.elem=y,this.prop=K,this.easing=pe||h.easing._default,this.options=O,this.start=this.now=this.cur(),this.end=ie,this.unit=me||(h.cssNumber[K]?"":"px")},cur:function(){var y=Xi.propHooks[this.prop];return y&&y.get?y.get(this):Xi.propHooks._default.get(this)},run:function(y){var O,K=Xi.propHooks[this.prop];return this.options.duration?this.pos=O=h.easing[this.easing](y,this.options.duration*y,0,1,this.options.duration):this.pos=O=y,this.now=(this.end-this.start)*O+this.start,this.options.step&&this.options.step.call(this.elem,this.now,this),K&&K.set?K.set(this):Xi.propHooks._default.set(this),this}},Xi.prototype.init.prototype=Xi.prototype,Xi.propHooks={_default:{get:function(y){var O;return y.elem.nodeType!==1||y.elem[y.prop]!=null&&y.elem.style[y.prop]==null?y.elem[y.prop]:(O=h.css(y.elem,y.prop,""))&&O!=="auto"?O:0},set:function(y){h.fx.step[y.prop]?h.fx.step[y.prop](y):y.elem.nodeType!==1||!h.cssHooks[y.prop]&&y.elem.style[io(y.prop)]==null?y.elem[y.prop]=y.now:h.style(y.elem,y.prop,y.now+y.unit)}}},Xi.propHooks.scrollTop=Xi.propHooks.scrollLeft={set:function(y){y.elem.nodeType&&y.elem.parentNode&&(y.elem[y.prop]=y.now)}},h.easing={linear:function(y){return y},swing:function(y){return .5-Math.cos(y*Math.PI)/2},_default:"swing"},h.fx=Xi.prototype.init,h.fx.step={};var Fn,Q,De=/^(?:toggle|show|hide)$/,ce=/queueHooks$/;function Ce(){Q&&(G.hidden===!1&&a.requestAnimationFrame?a.requestAnimationFrame(Ce):a.setTimeout(Ce,h.fx.interval),h.fx.tick())}function Ke(){return a.setTimeout(function(){Fn=void 0}),Fn=Date.now()}function yt(y,O){var K,ie=0,pe={height:y};for(O=O?1:0;ie<4;ie+=2-O)pe["margin"+(K=Tr[ie])]=pe["padding"+K]=y;return O&&(pe.opacity=pe.width=y),pe}function Vt(y,O,K){for(var ie,pe=(Wt.tweeners[O]||[]).concat(Wt.tweeners["*"]),me=0,Te=pe.length;me<Te;me++)if(ie=pe[me].call(K,O,y))return ie}function Wt(y,O,K){var ie,pe,me=0,Te=Wt.prefilters.length,_e=h.Deferred().always(function(){delete Se.elem}),Se=function(){if(pe)return!1;for(var dt=Fn||Ke(),ut=Math.max(0,Fe.startTime+Fe.duration-dt),Lt=1-(ut/Fe.duration||0),Rr=0,At=Fe.tweens.length;Rr<At;Rr++)Fe.tweens[Rr].run(Lt);return _e.notifyWith(y,[Fe,Lt,ut]),Lt<1&&At?ut:(At||_e.notifyWith(y,[Fe,1,0]),_e.resolveWith(y,[Fe]),!1)},Fe=_e.promise({elem:y,props:h.extend({},O),opts:h.extend(!0,{specialEasing:{},easing:h.easing._default},K),originalProperties:O,originalOptions:K,startTime:Fn||Ke(),duration:K.duration,tweens:[],createTween:function(dt,ut){var Lt=h.Tween(y,Fe.opts,dt,ut,Fe.opts.specialEasing[dt]||Fe.opts.easing);return Fe.tweens.push(Lt),Lt},stop:function(dt){var ut=0,Lt=dt?Fe.tweens.length:0;if(pe)return this;for(pe=!0;ut<Lt;ut++)Fe.tweens[ut].run(1);return dt?(_e.notifyWith(y,[Fe,1,0]),_e.resolveWith(y,[Fe,dt])):_e.rejectWith(y,[Fe,dt]),this}}),rt=Fe.props;for(function(dt,ut){var Lt,Rr,At,Wr,Zn;for(Lt in dt)if(At=ut[Rr=Qt(Lt)],Wr=dt[Lt],Array.isArray(Wr)&&(At=Wr[1],Wr=dt[Lt]=Wr[0]),Lt!==Rr&&(dt[Rr]=Wr,delete dt[Lt]),(Zn=h.cssHooks[Rr])&&"expand"in Zn)for(Lt in Wr=Zn.expand(Wr),delete dt[Rr],Wr)Lt in dt||(dt[Lt]=Wr[Lt],ut[Lt]=At);else ut[Rr]=At}(rt,Fe.opts.specialEasing);me<Te;me++)if(ie=Wt.prefilters[me].call(Fe,y,rt,Fe.opts))return S(ie.stop)&&(h._queueHooks(Fe.elem,Fe.opts.queue).stop=ie.stop.bind(ie)),ie;return h.map(rt,Vt,Fe),S(Fe.opts.start)&&Fe.opts.start.call(y,Fe),Fe.progress(Fe.opts.progress).done(Fe.opts.done,Fe.opts.complete).fail(Fe.opts.fail).always(Fe.opts.always),h.fx.timer(h.extend(Se,{elem:y,anim:Fe,queue:Fe.opts.queue})),Fe}h.Animation=h.extend(Wt,{tweeners:{"*":[function(y,O){var K=this.createTween(y,O);return Zr(K.elem,y,qt.exec(O),K),K}]},tweener:function(y,O){S(y)?(O=y,y=["*"]):y=y.match(ue);for(var K,ie=0,pe=y.length;ie<pe;ie++)K=y[ie],Wt.tweeners[K]=Wt.tweeners[K]||[],Wt.tweeners[K].unshift(O)},prefilters:[function(y,O,K){var ie,pe,me,Te,_e,Se,Fe,rt,dt="width"in O||"height"in O,ut=this,Lt={},Rr=y.style,At=y.nodeType&&In(y),Wr=We.get(y,"fxshow");for(ie in K.queue||((Te=h._queueHooks(y,"fx")).unqueued==null&&(Te.unqueued=0,_e=Te.empty.fire,Te.empty.fire=function(){Te.unqueued||_e()}),Te.unqueued++,ut.always(function(){ut.always(function(){Te.unqueued--,h.queue(y,"fx").length||Te.empty.fire()})})),O)if(pe=O[ie],De.test(pe)){if(delete O[ie],me=me||pe==="toggle",pe===(At?"hide":"show")){if(pe!=="show"||!Wr||Wr[ie]===void 0)continue;At=!0}Lt[ie]=Wr&&Wr[ie]||h.style(y,ie)}if((Se=!h.isEmptyObject(O))||!h.isEmptyObject(Lt))for(ie in dt&&y.nodeType===1&&(K.overflow=[Rr.overflow,Rr.overflowX,Rr.overflowY],(Fe=Wr&&Wr.display)==null&&(Fe=We.get(y,"display")),(rt=h.css(y,"display"))==="none"&&(Fe?rt=Fe:(xe([y],!0),Fe=y.style.display||Fe,rt=h.css(y,"display"),xe([y]))),(rt==="inline"||rt==="inline-block"&&Fe!=null)&&h.css(y,"float")==="none"&&(Se||(ut.done(function(){Rr.display=Fe}),Fe==null&&(rt=Rr.display,Fe=rt==="none"?"":rt)),Rr.display="inline-block")),K.overflow&&(Rr.overflow="hidden",ut.always(function(){Rr.overflow=K.overflow[0],Rr.overflowX=K.overflow[1],Rr.overflowY=K.overflow[2]})),Se=!1,Lt)Se||(Wr?"hidden"in Wr&&(At=Wr.hidden):Wr=We.access(y,"fxshow",{display:Fe}),me&&(Wr.hidden=!At),At&&xe([y],!0),ut.done(function(){for(ie in At||xe([y]),We.remove(y,"fxshow"),Lt)h.style(y,ie,Lt[ie])})),Se=Vt(At?Wr[ie]:0,ie,ut),ie in Wr||(Wr[ie]=Se.start,At&&(Se.end=Se.start,Se.start=0))}],prefilter:function(y,O){O?Wt.prefilters.unshift(y):Wt.prefilters.push(y)}}),h.speed=function(y,O,K){var ie=y&&typeof y=="object"?h.extend({},y):{complete:K||!K&&O||S(y)&&y,duration:y,easing:K&&O||O&&!S(O)&&O};return h.fx.off?ie.duration=0:typeof ie.duration!="number"&&(ie.duration in h.fx.speeds?ie.duration=h.fx.speeds[ie.duration]:ie.duration=h.fx.speeds._default),ie.queue!=null&&ie.queue!==!0||(ie.queue="fx"),ie.old=ie.complete,ie.complete=function(){S(ie.old)&&ie.old.call(this),ie.queue&&h.dequeue(this,ie.queue)},ie},h.fn.extend({fadeTo:function(y,O,K,ie){return this.filter(In).css("opacity",0).show().end().animate({opacity:O},y,K,ie)},animate:function(y,O,K,ie){var pe=h.isEmptyObject(y),me=h.speed(O,K,ie),Te=function(){var _e=Wt(this,h.extend({},y),me);(pe||We.get(this,"finish"))&&_e.stop(!0)};return Te.finish=Te,pe||me.queue===!1?this.each(Te):this.queue(me.queue,Te)},stop:function(y,O,K){var ie=function(pe){var me=pe.stop;delete pe.stop,me(K)};return typeof y!="string"&&(K=O,O=y,y=void 0),O&&this.queue(y||"fx",[]),this.each(function(){var pe=!0,me=y!=null&&y+"queueHooks",Te=h.timers,_e=We.get(this);if(me)_e[me]&&_e[me].stop&&ie(_e[me]);else for(me in _e)_e[me]&&_e[me].stop&&ce.test(me)&&ie(_e[me]);for(me=Te.length;me--;)Te[me].elem!==this||y!=null&&Te[me].queue!==y||(Te[me].anim.stop(K),pe=!1,Te.splice(me,1));!pe&&K||h.dequeue(this,y)})},finish:function(y){return y!==!1&&(y=y||"fx"),this.each(function(){var O,K=We.get(this),ie=K[y+"queue"],pe=K[y+"queueHooks"],me=h.timers,Te=ie?ie.length:0;for(K.finish=!0,h.queue(this,y,[]),pe&&pe.stop&&pe.stop.call(this,!0),O=me.length;O--;)me[O].elem===this&&me[O].queue===y&&(me[O].anim.stop(!0),me.splice(O,1));for(O=0;O<Te;O++)ie[O]&&ie[O].finish&&ie[O].finish.call(this);delete K.finish})}}),h.each(["toggle","show","hide"],function(y,O){var K=h.fn[O];h.fn[O]=function(ie,pe,me){return ie==null||typeof ie=="boolean"?K.apply(this,arguments):this.animate(yt(O,!0),ie,pe,me)}}),h.each({slideDown:yt("show"),slideUp:yt("hide"),slideToggle:yt("toggle"),fadeIn:{opacity:"show"},fadeOut:{opacity:"hide"},fadeToggle:{opacity:"toggle"}},function(y,O){h.fn[y]=function(K,ie,pe){return this.animate(O,K,ie,pe)}}),h.timers=[],h.fx.tick=function(){var y,O=0,K=h.timers;for(Fn=Date.now();O<K.length;O++)(y=K[O])()||K[O]!==y||K.splice(O--,1);K.length||h.fx.stop(),Fn=void 0},h.fx.timer=function(y){h.timers.push(y),h.fx.start()},h.fx.interval=13,h.fx.start=function(){Q||(Q=!0,Ce())},h.fx.stop=function(){Q=null},h.fx.speeds={slow:600,fast:200,_default:400},h.fn.delay=function(y,O){return y=h.fx&&h.fx.speeds[y]||y,O=O||"fx",this.queue(O,function(K,ie){var pe=a.setTimeout(K,y);ie.stop=function(){a.clearTimeout(pe)}})},function(){var y=G.createElement("input"),O=G.createElement("select").appendChild(G.createElement("option"));y.type="checkbox",C.checkOn=y.value!=="",C.optSelected=O.selected,(y=G.createElement("input")).value="t",y.type="radio",C.radioValue=y.value==="t"}();var Pr,Br=h.expr.attrHandle;h.fn.extend({attr:function(y,O){return Ue(this,h.attr,y,O,arguments.length>1)},removeAttr:function(y){return this.each(function(){h.removeAttr(this,y)})}}),h.extend({attr:function(y,O,K){var ie,pe,me=y.nodeType;if(me!==3&&me!==8&&me!==2)return y.getAttribute===void 0?h.prop(y,O,K):(me===1&&h.isXMLDoc(y)||(pe=h.attrHooks[O.toLowerCase()]||(h.expr.match.bool.test(O)?Pr:void 0)),K!==void 0?K===null?void h.removeAttr(y,O):pe&&"set"in pe&&(ie=pe.set(y,K,O))!==void 0?ie:(y.setAttribute(O,K+""),K):pe&&"get"in pe&&(ie=pe.get(y,O))!==null?ie:(ie=h.find.attr(y,O))==null?void 0:ie)},attrHooks:{type:{set:function(y,O){if(!C.radioValue&&O==="radio"&&v(y,"input")){var K=y.value;return y.setAttribute("type",O),K&&(y.value=K),O}}}},removeAttr:function(y,O){var K,ie=0,pe=O&&O.match(ue);if(pe&&y.nodeType===1)for(;K=pe[ie++];)y.removeAttribute(K)}}),Pr={set:function(y,O,K){return O===!1?h.removeAttr(y,K):y.setAttribute(K,K),K}},h.each(h.expr.match.bool.source.match(/\w+/g),function(y,O){var K=Br[O]||h.find.attr;Br[O]=function(ie,pe,me){var Te,_e,Se=pe.toLowerCase();return me||(_e=Br[Se],Br[Se]=Te,Te=K(ie,pe,me)!=null?Se:null,Br[Se]=_e),Te}});var ln=/^(?:input|select|textarea|button)$/i,di=/^(?:a|area)$/i;function ao(y){return(y.match(ue)||[]).join(" ")}function Oi(y){return y.getAttribute&&y.getAttribute("class")||""}function xo(y){return Array.isArray(y)?y:typeof y=="string"&&y.match(ue)||[]}h.fn.extend({prop:function(y,O){return Ue(this,h.prop,y,O,arguments.length>1)},removeProp:function(y){return this.each(function(){delete this[h.propFix[y]||y]})}}),h.extend({prop:function(y,O,K){var ie,pe,me=y.nodeType;if(me!==3&&me!==8&&me!==2)return me===1&&h.isXMLDoc(y)||(O=h.propFix[O]||O,pe=h.propHooks[O]),K!==void 0?pe&&"set"in pe&&(ie=pe.set(y,K,O))!==void 0?ie:y[O]=K:pe&&"get"in pe&&(ie=pe.get(y,O))!==null?ie:y[O]},propHooks:{tabIndex:{get:function(y){var O=h.find.attr(y,"tabindex");return O?parseInt(O,10):ln.test(y.nodeName)||di.test(y.nodeName)&&y.href?0:-1}}},propFix:{for:"htmlFor",class:"className"}}),C.optSelected||(h.propHooks.selected={get:function(y){var O=y.parentNode;return O&&O.parentNode&&O.parentNode.selectedIndex,null},set:function(y){var O=y.parentNode;O&&(O.selectedIndex,O.parentNode&&O.parentNode.selectedIndex)}}),h.each(["tabIndex","readOnly","maxLength","cellSpacing","cellPadding","rowSpan","colSpan","useMap","frameBorder","contentEditable"],function(){h.propFix[this.toLowerCase()]=this}),h.fn.extend({addClass:function(y){var O,K,ie,pe,me,Te;return S(y)?this.each(function(_e){h(this).addClass(y.call(this,_e,Oi(this)))}):(O=xo(y)).length?this.each(function(){if(ie=Oi(this),K=this.nodeType===1&&" "+ao(ie)+" "){for(me=0;me<O.length;me++)pe=O[me],K.indexOf(" "+pe+" ")<0&&(K+=pe+" ");Te=ao(K),ie!==Te&&this.setAttribute("class",Te)}}):this},removeClass:function(y){var O,K,ie,pe,me,Te;return S(y)?this.each(function(_e){h(this).removeClass(y.call(this,_e,Oi(this)))}):arguments.length?(O=xo(y)).length?this.each(function(){if(ie=Oi(this),K=this.nodeType===1&&" "+ao(ie)+" "){for(me=0;me<O.length;me++)for(pe=O[me];K.indexOf(" "+pe+" ")>-1;)K=K.replace(" "+pe+" "," ");Te=ao(K),ie!==Te&&this.setAttribute("class",Te)}}):this:this.attr("class","")},toggleClass:function(y,O){var K,ie,pe,me,Te=typeof y,_e=Te==="string"||Array.isArray(y);return S(y)?this.each(function(Se){h(this).toggleClass(y.call(this,Se,Oi(this),O),O)}):typeof O=="boolean"&&_e?O?this.addClass(y):this.removeClass(y):(K=xo(y),this.each(function(){if(_e)for(me=h(this),pe=0;pe<K.length;pe++)ie=K[pe],me.hasClass(ie)?me.removeClass(ie):me.addClass(ie);else y!==void 0&&Te!=="boolean"||((ie=Oi(this))&&We.set(this,"__className__",ie),this.setAttribute&&this.setAttribute("class",ie||y===!1?"":We.get(this,"__className__")||""))}))},hasClass:function(y){var O,K,ie=0;for(O=" "+y+" ";K=this[ie++];)if(K.nodeType===1&&(" "+ao(Oi(K))+" ").indexOf(O)>-1)return!0;return!1}});var So=/\r/g;h.fn.extend({val:function(y){var O,K,ie,pe=this[0];return arguments.length?(ie=S(y),this.each(function(me){var Te;this.nodeType===1&&((Te=ie?y.call(this,me,h(this).val()):y)==null?Te="":typeof Te=="number"?Te+="":Array.isArray(Te)&&(Te=h.map(Te,function(_e){return _e==null?"":_e+""})),(O=h.valHooks[this.type]||h.valHooks[this.nodeName.toLowerCase()])&&"set"in O&&O.set(this,Te,"value")!==void 0||(this.value=Te))})):pe?(O=h.valHooks[pe.type]||h.valHooks[pe.nodeName.toLowerCase()])&&"get"in O&&(K=O.get(pe,"value"))!==void 0?K:typeof(K=pe.value)=="string"?K.replace(So,""):K??"":void 0}}),h.extend({valHooks:{option:{get:function(y){var O=h.find.attr(y,"value");return O??ao(h.text(y))}},select:{get:function(y){var O,K,ie,pe=y.options,me=y.selectedIndex,Te=y.type==="select-one",_e=Te?null:[],Se=Te?me+1:pe.length;for(ie=me<0?Se:Te?me:0;ie<Se;ie++)if(((K=pe[ie]).selected||ie===me)&&!K.disabled&&(!K.parentNode.disabled||!v(K.parentNode,"optgroup"))){if(O=h(K).val(),Te)return O;_e.push(O)}return _e},set:function(y,O){for(var K,ie,pe=y.options,me=h.makeArray(O),Te=pe.length;Te--;)((ie=pe[Te]).selected=h.inArray(h.valHooks.option.get(ie),me)>-1)&&(K=!0);return K||(y.selectedIndex=-1),me}}}}),h.each(["radio","checkbox"],function(){h.valHooks[this]={set:function(y,O){if(Array.isArray(O))return y.checked=h.inArray(h(y).val(),O)>-1}},C.checkOn||(h.valHooks[this].get=function(y){return y.getAttribute("value")===null?"on":y.value})});var oo=a.location,Gs={guid:Date.now()},Jn=/\?/;h.parseXML=function(y){var O,K;if(!y||typeof y!="string")return null;try{O=new a.DOMParser().parseFromString(y,"text/xml")}catch{}return K=O&&O.getElementsByTagName("parsererror")[0],O&&!K||h.error("Invalid XML: "+(K?h.map(K.childNodes,function(ie){return ie.textContent}).join(`
`):y)),O};var wa=/^(?:focusinfocus|focusoutblur)$/,Ia=function(y){y.stopPropagation()};h.extend(h.event,{trigger:function(y,O,K,ie){var pe,me,Te,_e,Se,Fe,rt,dt,ut=[K||G],Lt=_.call(y,"type")?y.type:y,Rr=_.call(y,"namespace")?y.namespace.split("."):[];if(me=dt=Te=K=K||G,K.nodeType!==3&&K.nodeType!==8&&!wa.test(Lt+h.event.triggered)&&(Lt.indexOf(".")>-1&&(Lt=(Rr=Lt.split(".")).shift(),Rr.sort()),Se=Lt.indexOf(":")<0&&"on"+Lt,(y=y[h.expando]?y:new h.Event(Lt,typeof y=="object"&&y)).isTrigger=ie?2:3,y.namespace=Rr.join("."),y.rnamespace=y.namespace?new RegExp("(^|\\.)"+Rr.join("\\.(?:.*\\.|)")+"(\\.|$)"):null,y.result=void 0,y.target||(y.target=K),O=O==null?[y]:h.makeArray(O,[y]),rt=h.event.special[Lt]||{},ie||!rt.trigger||rt.trigger.apply(K,O)!==!1)){if(!ie&&!rt.noBubble&&!Y(K)){for(_e=rt.delegateType||Lt,wa.test(_e+Lt)||(me=me.parentNode);me;me=me.parentNode)ut.push(me),Te=me;Te===(K.ownerDocument||G)&&ut.push(Te.defaultView||Te.parentWindow||a)}for(pe=0;(me=ut[pe++])&&!y.isPropagationStopped();)dt=me,y.type=pe>1?_e:rt.bindType||Lt,(Fe=(We.get(me,"events")||Object.create(null))[y.type]&&We.get(me,"handle"))&&Fe.apply(me,O),(Fe=Se&&me[Se])&&Fe.apply&&Ur(me)&&(y.result=Fe.apply(me,O),y.result===!1&&y.preventDefault());return y.type=Lt,ie||y.isDefaultPrevented()||rt._default&&rt._default.apply(ut.pop(),O)!==!1||!Ur(K)||Se&&S(K[Lt])&&!Y(K)&&((Te=K[Se])&&(K[Se]=null),h.event.triggered=Lt,y.isPropagationStopped()&&dt.addEventListener(Lt,Ia),K[Lt](),y.isPropagationStopped()&&dt.removeEventListener(Lt,Ia),h.event.triggered=void 0,Te&&(K[Se]=Te)),y.result}},simulate:function(y,O,K){var ie=h.extend(new h.Event,K,{type:y,isSimulated:!0});h.event.trigger(ie,null,O)}}),h.fn.extend({trigger:function(y,O){return this.each(function(){h.event.trigger(y,O,this)})},triggerHandler:function(y,O){var K=this[0];if(K)return h.event.trigger(y,O,K,!0)}});var ta=/\[\]$/,Go=/\r?\n/g,ws=/^(?:submit|button|image|reset|file)$/i,xn=/^(?:input|select|textarea|keygen)/i;function Gt(y,O,K,ie){var pe;if(Array.isArray(O))h.each(O,function(me,Te){K||ta.test(y)?ie(y,Te):Gt(y+"["+(typeof Te=="object"&&Te!=null?me:"")+"]",Te,K,ie)});else if(K||D(O)!=="object")ie(y,O);else for(pe in O)Gt(y+"["+pe+"]",O[pe],K,ie)}h.param=function(y,O){var K,ie=[],pe=function(me,Te){var _e=S(Te)?Te():Te;ie[ie.length]=encodeURIComponent(me)+"="+encodeURIComponent(_e??"")};if(y==null)return"";if(Array.isArray(y)||y.jquery&&!h.isPlainObject(y))h.each(y,function(){pe(this.name,this.value)});else for(K in y)Gt(K,y[K],O,pe);return ie.join("&")},h.fn.extend({serialize:function(){return h.param(this.serializeArray())},serializeArray:function(){return this.map(function(){var y=h.prop(this,"elements");return y?h.makeArray(y):this}).filter(function(){var y=this.type;return this.name&&!h(this).is(":disabled")&&xn.test(this.nodeName)&&!ws.test(y)&&(this.checked||!er.test(y))}).map(function(y,O){var K=h(this).val();return K==null?null:Array.isArray(K)?h.map(K,function(ie){return{name:O.name,value:ie.replace(Go,`\r
`)}}):{name:O.name,value:K.replace(Go,`\r
`)}}).get()}});var Ai=/%20/g,zo=/#.*$/,lc=/([?&])_=[^&]*/,Yn=/^(.*?):[ \t]*([^\r\n]*)$/gm,qn=/^(?:GET|HEAD)$/,Yi=/^\/\//,zs={},Gi={},bs="*/".concat("*"),Us=G.createElement("a");function Le(y){return function(O,K){typeof O!="string"&&(K=O,O="*");var ie,pe=0,me=O.toLowerCase().match(ue)||[];if(S(K))for(;ie=me[pe++];)ie[0]==="+"?(ie=ie.slice(1)||"*",(y[ie]=y[ie]||[]).unshift(K)):(y[ie]=y[ie]||[]).push(K)}}function Eo(y,O,K,ie){var pe={},me=y===Gi;function Te(_e){var Se;return pe[_e]=!0,h.each(y[_e]||[],function(Fe,rt){var dt=rt(O,K,ie);return typeof dt!="string"||me||pe[dt]?me?!(Se=dt):void 0:(O.dataTypes.unshift(dt),Te(dt),!1)}),Se}return Te(O.dataTypes[0])||!pe["*"]&&Te("*")}function ra(y,O){var K,ie,pe=h.ajaxSettings.flatOptions||{};for(K in O)O[K]!==void 0&&((pe[K]?y:ie||(ie={}))[K]=O[K]);return ie&&h.extend(!0,y,ie),y}Us.href=oo.href,h.extend({active:0,lastModified:{},etag:{},ajaxSettings:{url:oo.href,type:"GET",isLocal:/^(?:about|app|app-storage|.+-extension|file|res|widget):$/.test(oo.protocol),global:!0,processData:!0,async:!0,contentType:"application/x-www-form-urlencoded; charset=UTF-8",accepts:{"*":bs,text:"text/plain",html:"text/html",xml:"application/xml, text/xml",json:"application/json, text/javascript"},contents:{xml:/\bxml\b/,html:/\bhtml/,json:/\bjson\b/},responseFields:{xml:"responseXML",text:"responseText",json:"responseJSON"},converters:{"* text":String,"text html":!0,"text json":JSON.parse,"text xml":h.parseXML},flatOptions:{url:!0,context:!0}},ajaxSetup:function(y,O){return O?ra(ra(y,h.ajaxSettings),O):ra(h.ajaxSettings,y)},ajaxPrefilter:Le(zs),ajaxTransport:Le(Gi),ajax:function(y,O){typeof y=="object"&&(O=y,y=void 0),O=O||{};var K,ie,pe,me,Te,_e,Se,Fe,rt,dt,ut=h.ajaxSetup({},O),Lt=ut.context||ut,Rr=ut.context&&(Lt.nodeType||Lt.jquery)?h(Lt):h.event,At=h.Deferred(),Wr=h.Callbacks("once memory"),Zn=ut.statusCode||{},Un={},la={},Ma="canceled",dn={readyState:0,getResponseHeader:function(wn){var Jr;if(Se){if(!me)for(me={};Jr=Yn.exec(pe);)me[Jr[1].toLowerCase()+" "]=(me[Jr[1].toLowerCase()+" "]||[]).concat(Jr[2]);Jr=me[wn.toLowerCase()+" "]}return Jr==null?null:Jr.join(", ")},getAllResponseHeaders:function(){return Se?pe:null},setRequestHeader:function(wn,Jr){return Se==null&&(wn=la[wn.toLowerCase()]=la[wn.toLowerCase()]||wn,Un[wn]=Jr),this},overrideMimeType:function(wn){return Se==null&&(ut.mimeType=wn),this},statusCode:function(wn){var Jr;if(wn)if(Se)dn.always(wn[dn.status]);else for(Jr in wn)Zn[Jr]=[Zn[Jr],wn[Jr]];return this},abort:function(wn){var Jr=wn||Ma;return K&&K.abort(Jr),_a(0,Jr),this}};if(At.promise(dn),ut.url=((y||ut.url||oo.href)+"").replace(Yi,oo.protocol+"//"),ut.type=O.method||O.type||ut.method||ut.type,ut.dataTypes=(ut.dataType||"*").toLowerCase().match(ue)||[""],ut.crossDomain==null){_e=G.createElement("a");try{_e.href=ut.url,_e.href=_e.href,ut.crossDomain=Us.protocol+"//"+Us.host!=_e.protocol+"//"+_e.host}catch{ut.crossDomain=!0}}if(ut.data&&ut.processData&&typeof ut.data!="string"&&(ut.data=h.param(ut.data,ut.traditional)),Eo(zs,ut,O,dn),Se)return dn;for(rt in(Fe=h.event&&ut.global)&&h.active++==0&&h.event.trigger("ajaxStart"),ut.type=ut.type.toUpperCase(),ut.hasContent=!qn.test(ut.type),ie=ut.url.replace(zo,""),ut.hasContent?ut.data&&ut.processData&&(ut.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&(ut.data=ut.data.replace(Ai,"+")):(dt=ut.url.slice(ie.length),ut.data&&(ut.processData||typeof ut.data=="string")&&(ie+=(Jn.test(ie)?"&":"?")+ut.data,delete ut.data),ut.cache===!1&&(ie=ie.replace(lc,"$1"),dt=(Jn.test(ie)?"&":"?")+"_="+Gs.guid+++dt),ut.url=ie+dt),ut.ifModified&&(h.lastModified[ie]&&dn.setRequestHeader("If-Modified-Since",h.lastModified[ie]),h.etag[ie]&&dn.setRequestHeader("If-None-Match",h.etag[ie])),(ut.data&&ut.hasContent&&ut.contentType!==!1||O.contentType)&&dn.setRequestHeader("Content-Type",ut.contentType),dn.setRequestHeader("Accept",ut.dataTypes[0]&&ut.accepts[ut.dataTypes[0]]?ut.accepts[ut.dataTypes[0]]+(ut.dataTypes[0]!=="*"?", "+bs+"; q=0.01":""):ut.accepts["*"]),ut.headers)dn.setRequestHeader(rt,ut.headers[rt]);if(ut.beforeSend&&(ut.beforeSend.call(Lt,dn,ut)===!1||Se))return dn.abort();if(Ma="abort",Wr.add(ut.complete),dn.done(ut.success),dn.fail(ut.error),K=Eo(Gi,ut,O,dn)){if(dn.readyState=1,Fe&&Rr.trigger("ajaxSend",[dn,ut]),Se)return dn;ut.async&&ut.timeout>0&&(Te=a.setTimeout(function(){dn.abort("timeout")},ut.timeout));try{Se=!1,K.send(Un,_a)}catch(wn){if(Se)throw wn;_a(-1,wn)}}else _a(-1,"No Transport");function _a(wn,Jr,so,Uo){var ua,Ho,Ta,Zi,lo,zi=Jr;Se||(Se=!0,Te&&a.clearTimeout(Te),K=void 0,pe=Uo||"",dn.readyState=wn>0?4:0,ua=wn>=200&&wn<300||wn===304,so&&(Zi=function(Kn,$n,Li){for(var Ua,_i,qr,li,ni=Kn.contents,kn=Kn.dataTypes;kn[0]==="*";)kn.shift(),Ua===void 0&&(Ua=Kn.mimeType||$n.getResponseHeader("Content-Type"));if(Ua){for(_i in ni)if(ni[_i]&&ni[_i].test(Ua)){kn.unshift(_i);break}}if(kn[0]in Li)qr=kn[0];else{for(_i in Li){if(!kn[0]||Kn.converters[_i+" "+kn[0]]){qr=_i;break}li||(li=_i)}qr=qr||li}if(qr)return qr!==kn[0]&&kn.unshift(qr),Li[qr]}(ut,dn,so)),!ua&&h.inArray("script",ut.dataTypes)>-1&&h.inArray("json",ut.dataTypes)<0&&(ut.converters["text script"]=function(){}),Zi=function(Kn,$n,Li,Ua){var _i,qr,li,ni,kn,Ca={},_s=Kn.dataTypes.slice();if(_s[1])for(li in Kn.converters)Ca[li.toLowerCase()]=Kn.converters[li];for(qr=_s.shift();qr;)if(Kn.responseFields[qr]&&(Li[Kn.responseFields[qr]]=$n),!kn&&Ua&&Kn.dataFilter&&($n=Kn.dataFilter($n,Kn.dataType)),kn=qr,qr=_s.shift()){if(qr==="*")qr=kn;else if(kn!=="*"&&kn!==qr){if(!(li=Ca[kn+" "+qr]||Ca["* "+qr])){for(_i in Ca)if((ni=_i.split(" "))[1]===qr&&(li=Ca[kn+" "+ni[0]]||Ca["* "+ni[0]])){li===!0?li=Ca[_i]:Ca[_i]!==!0&&(qr=ni[0],_s.unshift(ni[1]));break}}if(li!==!0)if(li&&Kn.throws)$n=li($n);else try{$n=li($n)}catch(Tl){return{state:"parsererror",error:li?Tl:"No conversion from "+kn+" to "+qr}}}}return{state:"success",data:$n}}(ut,Zi,dn,ua),ua?(ut.ifModified&&((lo=dn.getResponseHeader("Last-Modified"))&&(h.lastModified[ie]=lo),(lo=dn.getResponseHeader("etag"))&&(h.etag[ie]=lo)),wn===204||ut.type==="HEAD"?zi="nocontent":wn===304?zi="notmodified":(zi=Zi.state,Ho=Zi.data,ua=!(Ta=Zi.error))):(Ta=zi,!wn&&zi||(zi="error",wn<0&&(wn=0))),dn.status=wn,dn.statusText=(Jr||zi)+"",ua?At.resolveWith(Lt,[Ho,zi,dn]):At.rejectWith(Lt,[dn,zi,Ta]),dn.statusCode(Zn),Zn=void 0,Fe&&Rr.trigger(ua?"ajaxSuccess":"ajaxError",[dn,ut,ua?Ho:Ta]),Wr.fireWith(Lt,[dn,zi]),Fe&&(Rr.trigger("ajaxComplete",[dn,ut]),--h.active||h.event.trigger("ajaxStop")))}return dn},getJSON:function(y,O,K){return h.get(y,O,K,"json")},getScript:function(y,O){return h.get(y,void 0,O,"script")}}),h.each(["get","post"],function(y,O){h[O]=function(K,ie,pe,me){return S(ie)&&(me=me||pe,pe=ie,ie=void 0),h.ajax(h.extend({url:K,type:O,dataType:me,data:ie,success:pe},h.isPlainObject(K)&&K))}}),h.ajaxPrefilter(function(y){var O;for(O in y.headers)O.toLowerCase()==="content-type"&&(y.contentType=y.headers[O]||"")}),h._evalUrl=function(y,O,K){return h.ajax({url:y,type:"GET",dataType:"script",cache:!0,async:!1,global:!1,converters:{"text script":function(){}},dataFilter:function(ie){h.globalEval(ie,O,K)}})},h.fn.extend({wrapAll:function(y){var O;return this[0]&&(S(y)&&(y=y.call(this[0])),O=h(y,this[0].ownerDocument).eq(0).clone(!0),this[0].parentNode&&O.insertBefore(this[0]),O.map(function(){for(var K=this;K.firstElementChild;)K=K.firstElementChild;return K}).append(this)),this},wrapInner:function(y){return S(y)?this.each(function(O){h(this).wrapInner(y.call(this,O))}):this.each(function(){var O=h(this),K=O.contents();K.length?K.wrapAll(y):O.append(y)})},wrap:function(y){var O=S(y);return this.each(function(K){h(this).wrapAll(O?y.call(this,K):y)})},unwrap:function(y){return this.parent(y).not("body").each(function(){h(this).replaceWith(this.childNodes)}),this}}),h.expr.pseudos.hidden=function(y){return!h.expr.pseudos.visible(y)},h.expr.pseudos.visible=function(y){return!!(y.offsetWidth||y.offsetHeight||y.getClientRects().length)},h.ajaxSettings.xhr=function(){try{return new a.XMLHttpRequest}catch{}};var uc={0:200,1223:204},Ms=h.ajaxSettings.xhr();C.cors=!!Ms&&"withCredentials"in Ms,C.ajax=Ms=!!Ms,h.ajaxTransport(function(y){var O,K;if(C.cors||Ms&&!y.crossDomain)return{send:function(ie,pe){var me,Te=y.xhr();if(Te.open(y.type,y.url,y.async,y.username,y.password),y.xhrFields)for(me in y.xhrFields)Te[me]=y.xhrFields[me];for(me in y.mimeType&&Te.overrideMimeType&&Te.overrideMimeType(y.mimeType),y.crossDomain||ie["X-Requested-With"]||(ie["X-Requested-With"]="XMLHttpRequest"),ie)Te.setRequestHeader(me,ie[me]);O=function(_e){return function(){O&&(O=K=Te.onload=Te.onerror=Te.onabort=Te.ontimeout=Te.onreadystatechange=null,_e==="abort"?Te.abort():_e==="error"?typeof Te.status!="number"?pe(0,"error"):pe(Te.status,Te.statusText):pe(uc[Te.status]||Te.status,Te.statusText,(Te.responseType||"text")!=="text"||typeof Te.responseText!="string"?{binary:Te.response}:{text:Te.responseText},Te.getAllResponseHeaders()))}},Te.onload=O(),K=Te.onerror=Te.ontimeout=O("error"),Te.onabort!==void 0?Te.onabort=K:Te.onreadystatechange=function(){Te.readyState===4&&a.setTimeout(function(){O&&K()})},O=O("abort");try{Te.send(y.hasContent&&y.data||null)}catch(_e){if(O)throw _e}},abort:function(){O&&O()}}}),h.ajaxPrefilter(function(y){y.crossDomain&&(y.contents.script=!1)}),h.ajaxSetup({accepts:{script:"text/javascript, application/javascript, application/ecmascript, application/x-ecmascript"},contents:{script:/\b(?:java|ecma)script\b/},converters:{"text script":function(y){return h.globalEval(y),y}}}),h.ajaxPrefilter("script",function(y){y.cache===void 0&&(y.cache=!1),y.crossDomain&&(y.type="GET")}),h.ajaxTransport("script",function(y){var O,K;if(y.crossDomain||y.scriptAttrs)return{send:function(ie,pe){O=h("<script>").attr(y.scriptAttrs||{}).prop({charset:y.scriptCharset,src:y.url}).on("load error",K=function(me){O.remove(),K=null,me&&pe(me.type==="error"?404:200,me.type)}),G.head.appendChild(O[0])},abort:function(){K&&K()}}});var Oo,Hs=[],ba=/(=)\?(?=&|$)|\?\?/;h.ajaxSetup({jsonp:"callback",jsonpCallback:function(){var y=Hs.pop()||h.expando+"_"+Gs.guid++;return this[y]=!0,y}}),h.ajaxPrefilter("json jsonp",function(y,O,K){var ie,pe,me,Te=y.jsonp!==!1&&(ba.test(y.url)?"url":typeof y.data=="string"&&(y.contentType||"").indexOf("application/x-www-form-urlencoded")===0&&ba.test(y.data)&&"data");if(Te||y.dataTypes[0]==="jsonp")return ie=y.jsonpCallback=S(y.jsonpCallback)?y.jsonpCallback():y.jsonpCallback,Te?y[Te]=y[Te].replace(ba,"$1"+ie):y.jsonp!==!1&&(y.url+=(Jn.test(y.url)?"&":"?")+y.jsonp+"="+ie),y.converters["script json"]=function(){return me||h.error(ie+" was not called"),me[0]},y.dataTypes[0]="json",pe=a[ie],a[ie]=function(){me=arguments},K.always(function(){pe===void 0?h(a).removeProp(ie):a[ie]=pe,y[ie]&&(y.jsonpCallback=O.jsonpCallback,Hs.push(ie)),me&&S(pe)&&pe(me[0]),me=pe=void 0}),"script"}),C.createHTMLDocument=((Oo=G.implementation.createHTMLDocument("").body).innerHTML="<form></form><form></form>",Oo.childNodes.length===2),h.parseHTML=function(y,O,K){return typeof y!="string"?[]:(typeof O=="boolean"&&(K=O,O=!1),O||(C.createHTMLDocument?((ie=(O=G.implementation.createHTMLDocument("")).createElement("base")).href=G.location.href,O.head.appendChild(ie)):O=G),me=!K&&[],(pe=fe.exec(y))?[O.createElement(pe[1])]:(pe=Sa([y],O,me),me&&me.length&&h(me).remove(),h.merge([],pe.childNodes)));var ie,pe,me},h.fn.load=function(y,O,K){var ie,pe,me,Te=this,_e=y.indexOf(" ");return _e>-1&&(ie=ao(y.slice(_e)),y=y.slice(0,_e)),S(O)?(K=O,O=void 0):O&&typeof O=="object"&&(pe="POST"),Te.length>0&&h.ajax({url:y,type:pe||"GET",dataType:"html",data:O}).done(function(Se){me=arguments,Te.html(ie?h("<div>").append(h.parseHTML(Se)).find(ie):Se)}).always(K&&function(Se,Fe){Te.each(function(){K.apply(this,me||[Se.responseText,Fe,Se])})}),this},h.expr.pseudos.animated=function(y){return h.grep(h.timers,function(O){return y===O.elem}).length},h.offset={setOffset:function(y,O,K){var ie,pe,me,Te,_e,Se,Fe=h.css(y,"position"),rt=h(y),dt={};Fe==="static"&&(y.style.position="relative"),_e=rt.offset(),me=h.css(y,"top"),Se=h.css(y,"left"),(Fe==="absolute"||Fe==="fixed")&&(me+Se).indexOf("auto")>-1?(Te=(ie=rt.position()).top,pe=ie.left):(Te=parseFloat(me)||0,pe=parseFloat(Se)||0),S(O)&&(O=O.call(y,K,h.extend({},_e))),O.top!=null&&(dt.top=O.top-_e.top+Te),O.left!=null&&(dt.left=O.left-_e.left+pe),"using"in O?O.using.call(y,dt):rt.css(dt)}},h.fn.extend({offset:function(y){if(arguments.length)return y===void 0?this:this.each(function(pe){h.offset.setOffset(this,y,pe)});var O,K,ie=this[0];return ie?ie.getClientRects().length?(O=ie.getBoundingClientRect(),K=ie.ownerDocument.defaultView,{top:O.top+K.pageYOffset,left:O.left+K.pageXOffset}):{top:0,left:0}:void 0},position:function(){if(this[0]){var y,O,K,ie=this[0],pe={top:0,left:0};if(h.css(ie,"position")==="fixed")O=ie.getBoundingClientRect();else{for(O=this.offset(),K=ie.ownerDocument,y=ie.offsetParent||K.documentElement;y&&(y===K.body||y===K.documentElement)&&h.css(y,"position")==="static";)y=y.parentNode;y&&y!==ie&&y.nodeType===1&&((pe=h(y).offset()).top+=h.css(y,"borderTopWidth",!0),pe.left+=h.css(y,"borderLeftWidth",!0))}return{top:O.top-pe.top-h.css(ie,"marginTop",!0),left:O.left-pe.left-h.css(ie,"marginLeft",!0)}}},offsetParent:function(){return this.map(function(){for(var y=this.offsetParent;y&&h.css(y,"position")==="static";)y=y.offsetParent;return y||ir})}}),h.each({scrollLeft:"pageXOffset",scrollTop:"pageYOffset"},function(y,O){var K=O==="pageYOffset";h.fn[y]=function(ie){return Ue(this,function(pe,me,Te){var _e;if(Y(pe)?_e=pe:pe.nodeType===9&&(_e=pe.defaultView),Te===void 0)return _e?_e[O]:pe[me];_e?_e.scrollTo(K?_e.pageXOffset:Te,K?Te:_e.pageYOffset):pe[me]=Te},y,ie,arguments.length)}}),h.each(["top","left"],function(y,O){h.cssHooks[O]=ys(C.pixelPosition,function(K,ie){if(ie)return ie=ro(K,O),sa.test(ie)?h(K).position()[O]+"px":ie})}),h.each({Height:"height",Width:"width"},function(y,O){h.each({padding:"inner"+y,content:O,"":"outer"+y},function(K,ie){h.fn[ie]=function(pe,me){var Te=arguments.length&&(K||typeof pe!="boolean"),_e=K||(pe===!0||me===!0?"margin":"border");return Ue(this,function(Se,Fe,rt){var dt;return Y(Se)?ie.indexOf("outer")===0?Se["inner"+y]:Se.document.documentElement["client"+y]:Se.nodeType===9?(dt=Se.documentElement,Math.max(Se.body["scroll"+y],dt["scroll"+y],Se.body["offset"+y],dt["offset"+y],dt["client"+y])):rt===void 0?h.css(Se,Fe,_e):h.style(Se,Fe,rt,_e)},O,Te?pe:void 0,Te)}})}),h.each(["ajaxStart","ajaxStop","ajaxComplete","ajaxError","ajaxSuccess","ajaxSend"],function(y,O){h.fn[O]=function(K){return this.on(O,K)}}),h.fn.extend({bind:function(y,O,K){return this.on(y,null,O,K)},unbind:function(y,O){return this.off(y,null,O)},delegate:function(y,O,K,ie){return this.on(O,y,K,ie)},undelegate:function(y,O,K){return arguments.length===1?this.off(y,"**"):this.off(O,y||"**",K)},hover:function(y,O){return this.mouseenter(y).mouseleave(O||y)}}),h.each("blur focus focusin focusout resize scroll click dblclick mousedown mouseup mousemove mouseover mouseout mouseenter mouseleave change select submit keydown keypress keyup contextmenu".split(" "),function(y,O){h.fn[O]=function(K,ie){return arguments.length>0?this.on(O,null,K,ie):this.trigger(O)}});var mn=/^[\s\uFEFF\xA0]+|([^\s\uFEFF\xA0])[\s\uFEFF\xA0]+$/g;h.proxy=function(y,O){var K,ie,pe;if(typeof O=="string"&&(K=y[O],O=y,y=K),S(y))return ie=A.call(arguments,2),(pe=function(){return y.apply(O||this,ie.concat(A.call(arguments)))}).guid=y.guid=y.guid||h.guid++,pe},h.holdReady=function(y){y?h.readyWait++:h.ready(!0)},h.isArray=Array.isArray,h.parseJSON=JSON.parse,h.nodeName=v,h.isFunction=S,h.isWindow=Y,h.camelCase=Qt,h.type=D,h.now=Date.now,h.isNumeric=function(y){var O=h.type(y);return(O==="number"||O==="string")&&!isNaN(y-parseFloat(y))},h.trim=function(y){return y==null?"":(y+"").replace(mn,"$1")};var _l=a.jQuery,au=a.$;return h.noConflict=function(y){return a.$===h&&(a.$=au),y&&a.jQuery===h&&(a.jQuery=_l),h},m===void 0&&(a.jQuery=a.$=h),h},b.exports=n.document?o(n,!0):function(a){if(!a.document)throw new Error("jQuery requires a window with a document");return o(a)}}),jquery$1=Object.freeze({__proto__:null,default:jquery,__moduleExports:jquery});function mxcadassemblyinit(){var b,n=(b=typeof document<"u"&&document.currentScript?document.currentScript.src:void 0,typeof __filename<"u"&&(b=b||__filename),function(o){var a,m,c;o=o||{},a||(a=o!==void 0?o:{}),a.ready=new Promise(function(xe,ke){m=xe,c=ke});var x,A,H,F,P,g,E=Object.assign({},a),_=typeof window=="object",k=typeof importScripts=="function",U=typeof process=="object"&&typeof process.versions=="object"&&typeof process.versions.node=="string",C="";U?(C=k?xxxxx("path").dirname(C)+"/":__dirname+"/",g=()=>{P||(F=xxxxx("fs"),P=xxxxx("path"))},x=function(xe,ke){var bt=ze(xe);return bt?ke?bt:bt.toString():(g(),xe=P.normalize(xe),F.readFileSync(xe,ke?void 0:"utf8"))},H=xe=>((xe=x(xe,!0)).buffer||(xe=new Uint8Array(xe)),xe),A=(xe,ke,bt)=>{var er=ze(xe);er&&ke(er),g(),xe=P.normalize(xe),F.readFile(xe,function(Ar,Cr){Ar?bt(Ar):ke(Cr.buffer)})},1<process.argv.length&&process.argv[1].replace(/\\/g,"/"),process.argv.slice(2),process.on("uncaughtException",function(xe){throw xe}),process.on("unhandledRejection",function(xe){throw xe}),a.inspect=function(){return"[Emscripten Module object]"}):(_||k)&&(k?C=self.location.href:typeof document<"u"&&document.currentScript&&(C=document.currentScript.src),b&&(C=b),C=C.indexOf("blob:")!==0?C.substr(0,C.replace(/[?#].*/,"").lastIndexOf("/")+1):"",x=xe=>{try{var ke=new XMLHttpRequest;return ke.open("GET",xe,!1),ke.send(null),ke.responseText}catch(Ar){if(xe=ze(xe)){ke=[];for(var bt=0;bt<xe.length;bt++){var er=xe[bt];255<er&&(er&=255),ke.push(String.fromCharCode(er))}return ke.join("")}throw Ar}},k&&(H=xe=>{try{var ke=new XMLHttpRequest;return ke.open("GET",xe,!1),ke.responseType="arraybuffer",ke.send(null),new Uint8Array(ke.response)}catch(bt){if(xe=ze(xe))return xe;throw bt}}),A=(xe,ke,bt)=>{var er=new XMLHttpRequest;er.open("GET",xe,!0),er.responseType="arraybuffer",er.onload=()=>{if(er.status==200||er.status==0&&er.response)ke(er.response);else{var Ar=ze(xe);Ar?ke(Ar.buffer):bt()}},er.onerror=bt,er.send(null)}),a.print||console.log.bind(console);var S,Y=a.printErr||console.warn.bind(console);Object.assign(a,E),E=null,a.wasmBinary&&(S=a.wasmBinary),a.noExitRuntime;var G=Error,T={};S=[],typeof T!="object"&&Ee("no native wasm support detected");var B,D,N,I,h,u=!1,v=a.INITIAL_MEMORY||16777216;(B=a.wasmMemory?a.wasmMemory:new function(){this.buffer=new ArrayBuffer(v/65536*65536)})&&(D=B.buffer),v=D.byteLength;var M=D;D=M,a.HEAP8=N=new Int8Array(M),a.HEAP16=new Int16Array(M),a.HEAP32=h=new Int32Array(M),a.HEAPU8=I=new Uint8Array(M),a.HEAPU16=new Uint16Array(M),a.HEAPU32=new Uint32Array(M),a.HEAPF32=new Float32Array(M),a.HEAPF64=new Float64Array(M);var j,z=[],J=[],te=[];function X(){var xe=a.preRun.shift();z.unshift(xe)}var se=0,ve=null;function Ee(xe){throw a.onAbort&&a.onAbort(xe),Y(xe="Aborted("+xe+")"),u=!0,xe=new G(xe+". Build with -s ASSERTIONS=1 for more info."),c(xe),xe}a.preloadedImages={},a.preloadedAudios={};var we,Be="data:application/octet-stream;base64,";if(!(we="mxcadassembly_min.wasm").startsWith(Be)){var re=we;we=a.locateFile?a.locateFile(re,C):C+re}function fe(){var xe=we;try{if(xe==we&&S)return new Uint8Array(S);var ke=ze(xe);if(ke)return ke;if(H)return H(xe);throw"both async and sync fetching of the wasm failed"}catch(bt){Ee(bt)}}function ne(xe){for(;0<xe.length;){var ke=xe.shift();if(typeof ke=="function")ke(a);else{var bt=ke.U;typeof bt=="number"?ke.G===void 0?Re(bt)():Re(bt)(ke.G):bt(ke.G===void 0?null:ke.G)}}}var le=[];function Re(xe){var ke=le[xe];return ke||(xe>=le.length&&(le.length=xe+1),le[xe]=ke=j.get(xe)),ke}var at=typeof atob=="function"?atob:function(xe){var ke="",bt=0;xe=xe.replace(/[^A-Za-z0-9\+\/=]/g,"");do{var er="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(xe.charAt(bt++)),Ar="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(xe.charAt(bt++)),Cr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(xe.charAt(bt++)),Kr="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(xe.charAt(bt++));er=er<<2|Ar>>4,Ar=(15&Ar)<<4|Cr>>2;var _n=(3&Cr)<<6|Kr;ke+=String.fromCharCode(er),Cr!==64&&(ke+=String.fromCharCode(Ar)),Kr!==64&&(ke+=String.fromCharCode(_n))}while(bt<xe.length);return ke};function ze(xe){if(xe.startsWith(Be)){if(xe=xe.slice(Be.length),typeof U=="boolean"&&U){var ke=Buffer.from(xe,"base64");ke=new Uint8Array(ke.buffer,ke.byteOffset,ke.byteLength)}else try{var bt=at(xe),er=new Uint8Array(bt.length);for(xe=0;xe<bt.length;++xe)er[xe]=bt.charCodeAt(xe);ke=er}catch{throw Error("Converting base64 string to bytes failed.")}return ke}}var Ie={f:function(xe){return qt(xe+16)+16},e:function(xe,ke,bt){throw new function(er){this.C=er-16,this.P=function(Ar){h[this.C+4>>2]=Ar},this.M=function(Ar){h[this.C+8>>2]=Ar},this.N=function(){h[this.C>>2]=0},this.L=function(){N[this.C+12>>0]=0},this.O=function(){N[this.C+13>>0]=0},this.K=function(Ar,Cr){this.P(Ar),this.M(Cr),this.N(),this.L(),this.O()}}(xe).K(ke,bt),xe},c:function(){Ee("")},d:function(xe,ke,bt){I.copyWithin(xe,ke,ke+bt)},b:function(){Ee("OOM")},a:B};(function(){function xe(Ar){a.asm=Ar.exports,j=a.asm.A,J.unshift(a.asm.g),se--,a.monitorRunDependencies&&a.monitorRunDependencies(se),se==0&&ve&&(Ar=ve,ve=null,Ar())}function ke(Ar){xe(Ar.instance)}function bt(Ar){return function(){if(!S&&(_||k)){if(typeof fetch=="function"&&!we.startsWith("file://"))return fetch(we,{credentials:"same-origin"}).then(function(Cr){if(!Cr.ok)throw"failed to load wasm binary file at '"+we+"'";return Cr.arrayBuffer()}).catch(function(){return fe()});if(A)return new Promise(function(Cr,Kr){A(we,function(_n){Cr(new Uint8Array(_n))},Kr)})}return Promise.resolve().then(function(){return fe()})}().then(function(){return{then:function(Cr){Cr({instance:new function(){this.exports=function(Kr){for(var _n,Sn=new Uint8Array(123),Tn=25;Tn>=0;--Tn)Sn[48+Tn]=52+Tn,Sn[65+Tn]=Tn,Sn[97+Tn]=26+Tn;function Sa(hi,ri,an){for(var Mi,q,Cn=0,pi=ri,Fr=an.length,Ei=ri+(3*Fr>>2)-(an[Fr-2]=="=")-(an[Fr-1]=="=");Cn<Fr;Cn+=4)Mi=Sn[an.charCodeAt(Cn+1)],q=Sn[an.charCodeAt(Cn+2)],hi[pi++]=Sn[an.charCodeAt(Cn)]<<2|Mi>>4,pi<Ei&&(hi[pi++]=Mi<<4|q>>2),pi<Ei&&(hi[pi++]=q<<6|Sn[an.charCodeAt(Cn+3)])}return Sn[43]=62,Sn[47]=63,function(hi){var ri=hi.a.buffer,an=new Int8Array(ri),Mi=new Int16Array(ri),q=new Int32Array(ri),Cn=new Uint8Array(ri),pi=new Uint32Array(ri),Fr=new Float64Array(ri),Ei=Math.imul,vo=hi.abort,ts=hi.b,Do=hi.c,ms=hi.d,to=hi.e,rs=hi.f,sa=5245008;function Fo(Q){var De,ce=0,Ce=0,Ke=0,yt=0,Vt=0,Wt=0,Pr=0,Br=0,ln=0,di=0;sa=De=sa-16|0;e:{t:{r:{a:{i:{l:{n:{u:{c:{s:{o:{if((Q|=0)>>>0<=244){if(3&(ce=(yt=q[404])>>>(Ce=(Wt=Q>>>0<11?16:Q+11&-8)>>>3|0)|0)){Q=(Vt=q[1664+(ce=(Ke=Ce+(1&(-1^ce))|0)<<3)>>2])+8|0,(0|(Ce=q[Vt+8>>2]))!=(0|(ce=ce+1656|0))?(q[Ce+12>>2]=ce,q[ce+8>>2]=Ce):q[404]=An(Ke)&yt,ce=Ke<<3,q[Vt+4>>2]=3|ce,q[4+(ce=ce+Vt|0)>>2]=1|q[ce+4>>2];break e}if((di=q[406])>>>0>=Wt>>>0)break o;if(ce){Ce=Q=(ce=(0-(Q=(0-(Q=2<<Ce)|Q)&ce<<Ce)&Q)-1|0)>>>12&16,Ce|=Q=(ce=ce>>>Q|0)>>>5&8,Ce|=Q=(ce=ce>>>Q|0)>>>2&4,ln=q[1664+(Q=(Ce=((Ce|=Q=(ce=ce>>>Q|0)>>>1&2)|(Q=(ce=ce>>>Q|0)>>>1&1))+(ce>>>Q|0)|0)<<3)>>2],(0|(ce=q[ln+8>>2]))!=(0|(Q=Q+1656|0))?(q[ce+12>>2]=Q,q[Q+8>>2]=ce):(yt=An(Ce)&yt,q[404]=yt),Q=ln+8|0,q[ln+4>>2]=3|Wt,Vt=(ce=Ce<<3)-Wt|0,q[4+(Ke=Wt+ln|0)>>2]=1|Vt,q[ce+ln>>2]=Vt,di&&(Ce=1656+((ce=di>>>3|0)<<3)|0,ln=q[409],(ce=1<<ce)&yt?ce=q[Ce+8>>2]:(q[404]=ce|yt,ce=Ce),q[Ce+8>>2]=ln,q[ce+12>>2]=ln,q[ln+12>>2]=Ce,q[ln+8>>2]=ce),q[409]=Ke,q[406]=Vt;break e}if(!(Pr=q[405]))break o;for(Ce=Q=(ce=(0-Pr&Pr)-1|0)>>>12&16,Ce|=Q=(ce=ce>>>Q|0)>>>5&8,Ce|=Q=(ce=ce>>>Q|0)>>>2&4,ce=q[1920+(((Ce|=Q=(ce=ce>>>Q|0)>>>1&2)|(Q=(ce=ce>>>Q|0)>>>1&1))+(ce>>>Q|0)<<2)>>2],Ke=(-8&q[ce+4>>2])-Wt|0,Ce=ce;(Q=q[Ce+16>>2])||(Q=q[Ce+20>>2]);)Ke=(Vt=(Ce=(-8&q[Q+4>>2])-Wt|0)>>>0<Ke>>>0)?Ce:Ke,ce=Vt?Q:ce,Ce=Q;if(Br=q[ce+24>>2],(0|(Vt=q[ce+12>>2]))!=(0|ce)){Q=q[ce+8>>2],q[Q+12>>2]=Vt,q[Vt+8>>2]=Q;break t}if(!(Q=q[(Ce=ce+20|0)>>2])){if(!(Q=q[ce+16>>2]))break s;Ce=ce+16|0}for(;ln=Ce,Vt=Q,(Q=q[(Ce=Q+20|0)>>2])||(Ce=Vt+16|0,Q=q[Vt+16>>2]););q[ln>>2]=0;break t}if(Wt=-1,!(Q>>>0>4294967231)&&(Wt=-8&(Q=Q+11|0),Br=q[405])){Ke=0-Wt|0,yt=0,Wt>>>0<256||(yt=31,Wt>>>0>16777215||(Q=Q>>>8|0,Q<<=ln=Q+1048320>>>16&8,yt=28+((Q=((Q<<=Ce=Q+520192>>>16&4)<<(ce=Q+245760>>>16&2)>>>15|0)-(ce|Ce|ln)|0)<<1|Wt>>>Q+21&1)|0));h:{p:{if(Ce=q[1920+(yt<<2)>>2])for(Q=0,ce=Wt<<((0|yt)==31?0:25-(yt>>>1|0)|0);;){if(!((ln=(Pr=-8&q[Ce+4>>2])-Wt|0)>>>0>=Ke>>>0)&&(Ke=ln,Vt=Ce,(0|Wt)==(0|Pr))){Ke=0,Q=Ce;break p}if(ln=q[Ce+20>>2],Ce=q[16+((ce>>>29&4)+Ce|0)>>2],Q=ln?(0|ln)==(0|Ce)?Q:ln:Q,ce<<=1,!Ce)break}else Q=0;if(!(Q|Vt)){if(Vt=0,!(Q=(0-(Q=2<<yt)|Q)&Br))break o;Ce=Q=(ce=(Q&0-Q)-1|0)>>>12&16,Ce|=Q=(ce=ce>>>Q|0)>>>5&8,Ce|=Q=(ce=ce>>>Q|0)>>>2&4,Q=q[1920+(((Ce|=Q=(ce=ce>>>Q|0)>>>1&2)|(Q=(ce=ce>>>Q|0)>>>1&1))+(ce>>>Q|0)<<2)>>2]}if(!Q)break h}for(;Ke=(Ce=(ce=(-8&q[Q+4>>2])-Wt|0)>>>0<Ke>>>0)?ce:Ke,Vt=Ce?Q:Vt,Q=(ce=q[Q+16>>2])||q[Q+20>>2];);}if(!(!Vt|q[406]-Wt>>>0<=Ke>>>0)){if(yt=q[Vt+24>>2],(0|Vt)!=(0|(ce=q[Vt+12>>2]))){Q=q[Vt+8>>2],q[Q+12>>2]=ce,q[ce+8>>2]=Q;break r}if(!(Q=q[(Ce=Vt+20|0)>>2])){if(!(Q=q[Vt+16>>2]))break c;Ce=Vt+16|0}for(;ln=Ce,ce=Q,(Q=q[(Ce=Q+20|0)>>2])||(Ce=ce+16|0,Q=q[ce+16>>2]););q[ln>>2]=0;break r}}}if((Ce=q[406])>>>0>=Wt>>>0){Ke=q[409],(ce=Ce-Wt|0)>>>0>=16?(q[406]=ce,Q=Ke+Wt|0,q[409]=Q,q[Q+4>>2]=1|ce,q[Ce+Ke>>2]=ce,q[Ke+4>>2]=3|Wt):(q[409]=0,q[406]=0,q[Ke+4>>2]=3|Ce,q[4+(Q=Ce+Ke|0)>>2]=1|q[Q+4>>2]),Q=Ke+8|0;break e}if((Br=q[407])>>>0>Wt>>>0){ce=Br-Wt|0,q[407]=ce,Q=(Ce=q[410])+Wt|0,q[410]=Q,q[Q+4>>2]=1|ce,q[Ce+4>>2]=3|Wt,Q=Ce+8|0;break e}if(Q=0,Pr=Wt+47|0,q[522]?Ce=q[524]:(q[525]=-1,q[526]=-1,q[523]=4096,q[524]=4096,q[522]=De+12&-16^1431655768,q[527]=0,q[515]=0,Ce=4096),(Ce=(ln=Pr+Ce|0)&(Vt=0-Ce|0))>>>0<=Wt>>>0||(Ke=q[514])&&(yt=(ce=q[512])+Ce|0)>>>0>Ke>>>0|ce>>>0>=yt>>>0)break e;if(4&Cn[2060])break l;o:{h:{if(Ke=q[410])for(Q=2064;;){if((ce=q[Q>>2])>>>0<=Ke>>>0&Ke>>>0<ce+q[Q+4>>2]>>>0)break h;if(!(Q=q[Q+8>>2]))break}if((0|(ce=no(0)))==-1||(yt=Ce,(Q=(Ke=q[523])-1|0)&ce&&(yt=(Ce-ce|0)+(Q+ce&0-Ke)|0),yt>>>0<=Wt>>>0|yt>>>0>2147483646)||(Ke=q[514])&&Ke>>>0<(Vt=(Q=q[512])+yt|0)>>>0|Q>>>0>=Vt>>>0)break n;if((0|ce)!=(0|(Q=no(yt))))break o;break i}if((yt=Vt&ln-Br)>>>0>2147483646)break n;if((0|(ce=no(yt)))==(q[Q>>2]+q[Q+4>>2]|0))break u;Q=ce}if(!((0|Q)==-1|Wt+48>>>0<=yt>>>0)){if((ce=(ce=q[524])+(Pr-yt|0)&0-ce)>>>0>2147483646){ce=Q;break i}if((0|no(ce))!=-1){yt=ce+yt|0,ce=Q;break i}no(0-yt|0);break n}if(ce=Q,(0|Q)!=-1)break i;break n}Vt=0;break t}ce=0;break r}if((0|ce)!=-1)break i}q[515]=4|q[515]}if(Ce>>>0>2147483646||(0|(ce=no(Ce)))==-1|(0|(Q=no(0)))==-1|Q>>>0<=ce>>>0||(yt=Q-ce|0)>>>0<=Wt+40>>>0)break a}Q=q[512]+yt|0,q[512]=Q,Q>>>0>pi[513]&&(q[513]=Q);i:{l:{n:{if(Pr=q[410]){for(Q=2064;;){if(((Ke=q[Q>>2])+(Ce=q[Q+4>>2])|0)==(0|ce))break n;if(!(Q=q[Q+8>>2]))break}break l}for((Q=q[408])>>>0<=ce>>>0&&Q||(q[408]=ce),Q=0,q[517]=yt,q[516]=ce,q[412]=-1,q[413]=q[522],q[519]=0;Ce=1656+(Ke=Q<<3)|0,q[Ke+1664>>2]=Ce,q[Ke+1668>>2]=Ce,(0|(Q=Q+1|0))!=32;);Ce=(Ke=yt-40|0)-(Q=ce+8&7?-8-ce&7:0)|0,q[407]=Ce,Q=Q+ce|0,q[410]=Q,q[Q+4>>2]=1|Ce,q[4+(ce+Ke|0)>>2]=40,q[411]=q[526];break i}if(!(8&Cn[Q+12|0]|Ke>>>0>Pr>>>0|ce>>>0<=Pr>>>0)){q[Q+4>>2]=Ce+yt,Ce=(Q=Pr+8&7?-8-Pr&7:0)+Pr|0,q[410]=Ce,Q=(ce=q[407]+yt|0)-Q|0,q[407]=Q,q[Ce+4>>2]=1|Q,q[4+(ce+Pr|0)>>2]=40,q[411]=q[526];break i}}pi[408]>ce>>>0&&(q[408]=ce),Ce=ce+yt|0,Q=2064;l:{n:{u:{c:{s:{o:{for(;;){if((0|Ce)!=q[Q>>2]){if(Q=q[Q+8>>2])continue;break o}break}if(!(8&Cn[Q+12|0]))break s}for(Q=2064;;){if((Ce=q[Q>>2])>>>0<=Pr>>>0&&(Vt=Ce+q[Q+4>>2]|0)>>>0>Pr>>>0)break c;Q=q[Q+8>>2]}}if(q[Q>>2]=ce,q[Q+4>>2]=q[Q+4>>2]+yt,q[4+(ln=(ce+8&7?-8-ce&7:0)+ce|0)>>2]=3|Wt,Wt=(yt=Ce+(Ce+8&7?-8-Ce&7:0)|0)-(Br=Wt+ln|0)|0,(0|yt)==(0|Pr)){q[410]=Br,Q=q[407]+Wt|0,q[407]=Q,q[Br+4>>2]=1|Q;break n}if(q[409]==(0|yt)){q[409]=Br,Q=q[406]+Wt|0,q[406]=Q,q[Br+4>>2]=1|Q,q[Q+Br>>2]=Q;break n}if((3&(Q=q[yt+4>>2]))==1){Vt=-8&Q;s:if(Q>>>0<=255){if(Ce=q[yt+8>>2],Q=Q>>>3|0,(0|(ce=q[yt+12>>2]))==(0|Ce)){q[404]=q[404]&An(Q);break s}q[Ce+12>>2]=ce,q[ce+8>>2]=Ce}else{if(Pr=q[yt+24>>2],(0|yt)==(0|(ce=q[yt+12>>2])))if((Ke=q[(Q=yt+20|0)>>2])||(Ke=q[(Q=yt+16|0)>>2])){for(;Ce=Q,(Ke=q[(Q=(ce=Ke)+20|0)>>2])||(Q=ce+16|0,Ke=q[ce+16>>2]););q[Ce>>2]=0}else ce=0;else Q=q[yt+8>>2],q[Q+12>>2]=ce,q[ce+8>>2]=Q;if(Pr){Ce=q[yt+28>>2];o:{if(q[(Q=1920+(Ce<<2)|0)>>2]==(0|yt)){if(q[Q>>2]=ce,ce)break o;q[405]=q[405]&An(Ce);break s}if(q[Pr+(q[Pr+16>>2]==(0|yt)?16:20)>>2]=ce,!ce)break s}q[ce+24>>2]=Pr,(Q=q[yt+16>>2])&&(q[ce+16>>2]=Q,q[Q+24>>2]=ce),(Q=q[yt+20>>2])&&(q[ce+20>>2]=Q,q[Q+24>>2]=ce)}}Wt=Vt+Wt|0,yt=yt+Vt|0}if(q[yt+4>>2]=-2&q[yt+4>>2],q[Br+4>>2]=1|Wt,q[Wt+Br>>2]=Wt,Wt>>>0<=255){ce=1656+((Q=Wt>>>3|0)<<3)|0,(Ce=q[404])&(Q=1<<Q)?Q=q[ce+8>>2]:(q[404]=Q|Ce,Q=ce),q[ce+8>>2]=Br,q[Q+12>>2]=Br,q[Br+12>>2]=ce,q[Br+8>>2]=Q;break n}if(Q=31,Wt>>>0<=16777215&&(Q=Wt>>>8|0,Q<<=Ke=Q+1048320>>>16&8,Q=28+((Q=((Q<<=Ce=Q+520192>>>16&4)<<(ce=Q+245760>>>16&2)>>>15|0)-(ce|Ce|Ke)|0)<<1|Wt>>>Q+21&1)|0),q[Br+28>>2]=Q,q[Br+16>>2]=0,q[Br+20>>2]=0,Ke=1920+(Q<<2)|0,(Ce=q[405])&(ce=1<<Q)){for(Q=Wt<<((0|Q)==31?0:25-(Q>>>1|0)|0),ce=q[Ke>>2];;){if(Ce=ce,(-8&q[ce+4>>2])==(0|Wt))break u;if(ce=Q>>>29|0,Q<<=1,!(ce=q[16+(Ke=Ce+(4&ce)|0)>>2]))break}q[Ke+16>>2]=Br,q[Br+24>>2]=Ce}else q[405]=ce|Ce,q[Ke>>2]=Br,q[Br+24>>2]=Ke;q[Br+12>>2]=Br,q[Br+8>>2]=Br;break n}for(Ce=(Ke=yt-40|0)-(Q=ce+8&7?-8-ce&7:0)|0,q[407]=Ce,Q=Q+ce|0,q[410]=Q,q[Q+4>>2]=1|Ce,q[4+(ce+Ke|0)>>2]=40,q[411]=q[526],q[(Ce=(Q=(Vt+(Vt-39&7?39-Vt&7:0)|0)-47|0)>>>0<Pr+16>>>0?Pr:Q)+4>>2]=27,Q=q[519],q[Ce+16>>2]=q[518],q[Ce+20>>2]=Q,Q=q[517],q[Ce+8>>2]=q[516],q[Ce+12>>2]=Q,q[518]=Ce+8,q[517]=yt,q[516]=ce,q[519]=0,Q=Ce+24|0;q[Q+4>>2]=7,ce=Q+8|0,Q=Q+4|0,ce>>>0<Vt>>>0;);if((0|Ce)==(0|Pr))break i;if(q[Ce+4>>2]=-2&q[Ce+4>>2],Vt=Ce-Pr|0,q[Pr+4>>2]=1|Vt,q[Ce>>2]=Vt,Vt>>>0<=255){ce=1656+((Q=Vt>>>3|0)<<3)|0,(Ce=q[404])&(Q=1<<Q)?Q=q[ce+8>>2]:(q[404]=Q|Ce,Q=ce),q[ce+8>>2]=Pr,q[Q+12>>2]=Pr,q[Pr+12>>2]=ce,q[Pr+8>>2]=Q;break i}if(Q=31,q[Pr+16>>2]=0,q[Pr+20>>2]=0,Vt>>>0<=16777215&&(Q=Vt>>>8|0,Q<<=Ke=Q+1048320>>>16&8,Q=28+((Q=((Q<<=Ce=Q+520192>>>16&4)<<(ce=Q+245760>>>16&2)>>>15|0)-(ce|Ce|Ke)|0)<<1|Vt>>>Q+21&1)|0),q[Pr+28>>2]=Q,Ke=1920+(Q<<2)|0,(Ce=q[405])&(ce=1<<Q)){for(Q=Vt<<((0|Q)==31?0:25-(Q>>>1|0)|0),ce=q[Ke>>2];;){if(Ce=ce,(0|Vt)==(-8&q[ce+4>>2]))break l;if(ce=Q>>>29|0,Q<<=1,!(ce=q[16+(Ke=Ce+(4&ce)|0)>>2]))break}q[Ke+16>>2]=Pr,q[Pr+24>>2]=Ce}else q[405]=ce|Ce,q[Ke>>2]=Pr,q[Pr+24>>2]=Ke;q[Pr+12>>2]=Pr,q[Pr+8>>2]=Pr;break i}Q=q[Ce+8>>2],q[Q+12>>2]=Br,q[Ce+8>>2]=Br,q[Br+24>>2]=0,q[Br+12>>2]=Ce,q[Br+8>>2]=Q}Q=ln+8|0;break e}Q=q[Ce+8>>2],q[Q+12>>2]=Pr,q[Ce+8>>2]=Pr,q[Pr+24>>2]=0,q[Pr+12>>2]=Ce,q[Pr+8>>2]=Q}if(!((Q=q[407])>>>0<=Wt>>>0)){ce=Q-Wt|0,q[407]=ce,Q=(Ce=q[410])+Wt|0,q[410]=Q,q[Q+4>>2]=1|ce,q[Ce+4>>2]=3|Wt,Q=Ce+8|0;break e}}q[403]=48,Q=0;break e}r:if(yt){Ce=q[Vt+28>>2];a:{if(q[(Q=1920+(Ce<<2)|0)>>2]==(0|Vt)){if(q[Q>>2]=ce,ce)break a;Br=An(Ce)&Br,q[405]=Br;break r}if(q[yt+(q[yt+16>>2]==(0|Vt)?16:20)>>2]=ce,!ce)break r}q[ce+24>>2]=yt,(Q=q[Vt+16>>2])&&(q[ce+16>>2]=Q,q[Q+24>>2]=ce),(Q=q[Vt+20>>2])&&(q[ce+20>>2]=Q,q[Q+24>>2]=ce)}r:if(Ke>>>0<=15)Q=Ke+Wt|0,q[Vt+4>>2]=3|Q,q[4+(Q=Q+Vt|0)>>2]=1|q[Q+4>>2];else if(q[Vt+4>>2]=3|Wt,q[4+(yt=Vt+Wt|0)>>2]=1|Ke,q[yt+Ke>>2]=Ke,Ke>>>0<=255)ce=1656+((Q=Ke>>>3|0)<<3)|0,(Ce=q[404])&(Q=1<<Q)?Q=q[ce+8>>2]:(q[404]=Q|Ce,Q=ce),q[ce+8>>2]=yt,q[Q+12>>2]=yt,q[yt+12>>2]=ce,q[yt+8>>2]=Q;else{Q=31,Ke>>>0<=16777215&&(Q=Ke>>>8|0,Q<<=ln=Q+1048320>>>16&8,Q=28+((Q=((Q<<=Ce=Q+520192>>>16&4)<<(ce=Q+245760>>>16&2)>>>15|0)-(ce|Ce|ln)|0)<<1|Ke>>>Q+21&1)|0),q[yt+28>>2]=Q,q[yt+16>>2]=0,q[yt+20>>2]=0,ce=1920+(Q<<2)|0;a:{if((Ce=1<<Q)&Br){for(Q=Ke<<((0|Q)==31?0:25-(Q>>>1|0)|0),Ce=q[ce>>2];;){if((-8&q[(ce=Ce)+4>>2])==(0|Ke))break a;if(Ce=Q>>>29|0,Q<<=1,!(Ce=q[16+(ln=(4&Ce)+ce|0)>>2]))break}q[ln+16>>2]=yt}else q[405]=Ce|Br,q[ce>>2]=yt;q[yt+24>>2]=ce,q[yt+12>>2]=yt,q[yt+8>>2]=yt;break r}Q=q[ce+8>>2],q[Q+12>>2]=yt,q[ce+8>>2]=yt,q[yt+24>>2]=0,q[yt+12>>2]=ce,q[yt+8>>2]=Q}Q=Vt+8|0;break e}t:if(Br){Ce=q[ce+28>>2];r:{if(q[(Q=1920+(Ce<<2)|0)>>2]==(0|ce)){if(q[Q>>2]=Vt,Vt)break r;q[405]=An(Ce)&Pr;break t}if(q[Br+(q[Br+16>>2]==(0|ce)?16:20)>>2]=Vt,!Vt)break t}q[Vt+24>>2]=Br,(Q=q[ce+16>>2])&&(q[Vt+16>>2]=Q,q[Q+24>>2]=Vt),(Q=q[ce+20>>2])&&(q[Vt+20>>2]=Q,q[Q+24>>2]=Vt)}Ke>>>0<=15?(Q=Ke+Wt|0,q[ce+4>>2]=3|Q,q[4+(Q=Q+ce|0)>>2]=1|q[Q+4>>2]):(q[ce+4>>2]=3|Wt,q[4+(Vt=ce+Wt|0)>>2]=1|Ke,q[Ke+Vt>>2]=Ke,di&&(Ce=1656+((Q=di>>>3|0)<<3)|0,ln=q[409],(Q=1<<Q)&yt?Q=q[Ce+8>>2]:(q[404]=Q|yt,Q=Ce),q[Ce+8>>2]=ln,q[Q+12>>2]=ln,q[ln+12>>2]=Ce,q[ln+8>>2]=Q),q[409]=Vt,q[406]=Ke),Q=ce+8|0}return sa=De+16|0,0|Q}function Ea(Q){var De=0,ce=0,Ce=0,Ke=0,yt=0,Vt=0,Wt=0;e:if(Q){yt=(Ce=Q-8|0)+(Q=-8&(De=q[Q-4>>2]))|0;t:if(!(1&De)){if(!(3&De)||(Ce=Ce-(De=q[Ce>>2])|0)>>>0<pi[408])break e;if(Q=Q+De|0,q[409]==(0|Ce)){if((3&(De=q[yt+4>>2]))==3)return q[406]=Q,q[yt+4>>2]=-2&De,q[Ce+4>>2]=1|Q,void(q[Q+Ce>>2]=Q)}else{if(De>>>0<=255){if(Ke=q[Ce+8>>2],De=De>>>3|0,(0|(ce=q[Ce+12>>2]))==(0|Ke)){q[404]=q[404]&An(De);break t}q[Ke+12>>2]=ce,q[ce+8>>2]=Ke;break t}if(Wt=q[Ce+24>>2],(0|Ce)==(0|(De=q[Ce+12>>2])))if((ce=q[(Ke=Ce+20|0)>>2])||(ce=q[(Ke=Ce+16|0)>>2])){for(;Vt=Ke,(ce=q[(Ke=(De=ce)+20|0)>>2])||(Ke=De+16|0,ce=q[De+16>>2]););q[Vt>>2]=0}else De=0;else ce=q[Ce+8>>2],q[ce+12>>2]=De,q[De+8>>2]=ce;if(!Wt)break t;Ke=q[Ce+28>>2];r:{if(q[(ce=1920+(Ke<<2)|0)>>2]==(0|Ce)){if(q[ce>>2]=De,De)break r;q[405]=q[405]&An(Ke);break t}if(q[Wt+(q[Wt+16>>2]==(0|Ce)?16:20)>>2]=De,!De)break t}if(q[De+24>>2]=Wt,(ce=q[Ce+16>>2])&&(q[De+16>>2]=ce,q[ce+24>>2]=De),!(ce=q[Ce+20>>2]))break t;q[De+20>>2]=ce,q[ce+24>>2]=De}}if(!(Ce>>>0>=yt>>>0)&&1&(De=q[yt+4>>2])){t:{if(!(2&De)){if(q[410]==(0|yt)){if(q[410]=Ce,Q=q[407]+Q|0,q[407]=Q,q[Ce+4>>2]=1|Q,q[409]!=(0|Ce))break e;return q[406]=0,void(q[409]=0)}if(q[409]==(0|yt))return q[409]=Ce,Q=q[406]+Q|0,q[406]=Q,q[Ce+4>>2]=1|Q,void(q[Q+Ce>>2]=Q);Q=(-8&De)+Q|0;r:if(De>>>0<=255){if(Ke=q[yt+8>>2],De=De>>>3|0,(0|(ce=q[yt+12>>2]))==(0|Ke)){q[404]=q[404]&An(De);break r}q[Ke+12>>2]=ce,q[ce+8>>2]=Ke}else{if(Wt=q[yt+24>>2],(0|yt)==(0|(De=q[yt+12>>2])))if((ce=q[(Ke=yt+20|0)>>2])||(ce=q[(Ke=yt+16|0)>>2])){for(;Vt=Ke,(ce=q[(Ke=(De=ce)+20|0)>>2])||(Ke=De+16|0,ce=q[De+16>>2]););q[Vt>>2]=0}else De=0;else ce=q[yt+8>>2],q[ce+12>>2]=De,q[De+8>>2]=ce;if(Wt){Ke=q[yt+28>>2];a:{if(q[(ce=1920+(Ke<<2)|0)>>2]==(0|yt)){if(q[ce>>2]=De,De)break a;q[405]=q[405]&An(Ke);break r}if(q[Wt+(q[Wt+16>>2]==(0|yt)?16:20)>>2]=De,!De)break r}q[De+24>>2]=Wt,(ce=q[yt+16>>2])&&(q[De+16>>2]=ce,q[ce+24>>2]=De),(ce=q[yt+20>>2])&&(q[De+20>>2]=ce,q[ce+24>>2]=De)}}if(q[Ce+4>>2]=1|Q,q[Q+Ce>>2]=Q,q[409]!=(0|Ce))break t;return void(q[406]=Q)}q[yt+4>>2]=-2&De,q[Ce+4>>2]=1|Q,q[Q+Ce>>2]=Q}if(Q>>>0<=255)return De=1656+((Q=Q>>>3|0)<<3)|0,(ce=q[404])&(Q=1<<Q)?Q=q[De+8>>2]:(q[404]=Q|ce,Q=De),q[De+8>>2]=Ce,q[Q+12>>2]=Ce,q[Ce+12>>2]=De,void(q[Ce+8>>2]=Q);Ke=31,q[Ce+16>>2]=0,q[Ce+20>>2]=0,Q>>>0<=16777215&&(De=Q>>>8|0,De<<=Vt=De+1048320>>>16&8,Ke=28+((De=((De<<=Ke=De+520192>>>16&4)<<(ce=De+245760>>>16&2)>>>15|0)-(ce|Ke|Vt)|0)<<1|Q>>>De+21&1)|0),q[Ce+28>>2]=Ke,Vt=1920+(Ke<<2)|0;t:{r:{if((ce=q[405])&(De=1<<Ke)){for(Ke=Q<<((0|Ke)==31?0:25-(Ke>>>1|0)|0),De=q[Vt>>2];;){if(ce=De,(-8&q[De+4>>2])==(0|Q))break r;if(De=Ke>>>29|0,Ke<<=1,!(De=q[16+(Vt=ce+(4&De)|0)>>2]))break}q[Vt+16>>2]=Ce,q[Ce+24>>2]=ce}else q[405]=De|ce,q[Vt>>2]=Ce,q[Ce+24>>2]=Vt;q[Ce+12>>2]=Ce,q[Ce+8>>2]=Ce;break t}Q=q[ce+8>>2],q[Q+12>>2]=Ce,q[ce+8>>2]=Ce,q[Ce+24>>2]=0,q[Ce+12>>2]=ce,q[Ce+8>>2]=Q}Q=q[412]-1|0,q[412]=Q||-1}}}function gs(Q,De,ce){var Ce,Ke=0,yt=0;if(ce>>>0>=512)return ms(0|Q,0|De,0|ce),Q;Ce=Q+ce|0;e:if(3&(Q^De))if(Ce>>>0<4)ce=Q;else if((Ke=Ce-4|0)>>>0<Q>>>0)ce=Q;else for(ce=Q;an[0|ce]=Cn[0|De],an[ce+1|0]=Cn[De+1|0],an[ce+2|0]=Cn[De+2|0],an[ce+3|0]=Cn[De+3|0],De=De+4|0,Ke>>>0>=(ce=ce+4|0)>>>0;);else{t:if(3&Q)if(ce)for(ce=Q;;){if(an[0|ce]=Cn[0|De],De=De+1|0,!(3&(ce=ce+1|0)))break t;if(!(ce>>>0<Ce>>>0))break}else ce=Q;else ce=Q;if(!((Ke=-4&Ce)>>>0<64||(yt=Ke+-64|0)>>>0<ce>>>0))for(;q[ce>>2]=q[De>>2],q[ce+4>>2]=q[De+4>>2],q[ce+8>>2]=q[De+8>>2],q[ce+12>>2]=q[De+12>>2],q[ce+16>>2]=q[De+16>>2],q[ce+20>>2]=q[De+20>>2],q[ce+24>>2]=q[De+24>>2],q[ce+28>>2]=q[De+28>>2],q[ce+32>>2]=q[De+32>>2],q[ce+36>>2]=q[De+36>>2],q[ce+40>>2]=q[De+40>>2],q[ce+44>>2]=q[De+44>>2],q[ce+48>>2]=q[De+48>>2],q[ce+52>>2]=q[De+52>>2],q[ce+56>>2]=q[De+56>>2],q[ce+60>>2]=q[De+60>>2],De=De- -64|0,yt>>>0>=(ce=ce- -64|0)>>>0;);if(ce>>>0>=Ke>>>0)break e;for(;q[ce>>2]=q[De>>2],De=De+4|0,Ke>>>0>(ce=ce+4|0)>>>0;);}if(ce>>>0<Ce>>>0)for(;an[0|ce]=Cn[0|De],De=De+1|0,(0|Ce)!=(0|(ce=ce+1|0)););return Q}function Bs(Q,De){var ce=0;if(De&&(an[0|Q]=0,an[(ce=Q+De|0)-1|0]=0,!(De>>>0<3||(an[Q+2|0]=0,an[Q+1|0]=0,an[ce-3|0]=0,an[ce-2|0]=0,De>>>0<7||(an[Q+3|0]=0,an[ce-4|0]=0,De>>>0<9||(q[(Q=(ce=0-Q&3)+Q|0)>>2]=0,q[(De=(ce=De-ce&-4)+Q|0)-4>>2]=0,ce>>>0<9||(q[Q+8>>2]=0,q[Q+4>>2]=0,q[De-8>>2]=0,q[De-12>>2]=0,ce>>>0<25||(q[Q+24>>2]=0,q[Q+20>>2]=0,q[Q+16>>2]=0,q[Q+12>>2]=0,q[De-16>>2]=0,q[De-20>>2]=0,q[De-24>>2]=0,q[De-28>>2]=0,(De=(De=ce)-(ce=4&Q|24)|0)>>>0<32))))))))for(Q=Q+ce|0;q[Q+24>>2]=0,q[Q+28>>2]=0,q[Q+16>>2]=0,q[Q+20>>2]=0,q[Q+8>>2]=0,q[Q+12>>2]=0,q[Q>>2]=0,q[Q+4>>2]=0,Q=Q+32|0,(De=De-32|0)>>>0>31;);}function ro(Q){var De,ce=0,Ce=0,Ke=0;De=0|rs(8),q[De>>2]=1348,q[De>>2]=1392;e:{t:{if(3&(ce=Q))for(;;){if(!Cn[0|ce])break t;if(!(3&(ce=ce+1|0)))break}for(;Ce=ce,ce=ce+4|0,!((-1^(Ke=q[Ce>>2]))&Ke-16843009&-2139062144););if(ce=Ce-Q|0,!(255&Ke))break e;for(;Ke=Cn[Ce+1|0],Ce=ce=Ce+1|0,Ke;);}ce=ce-Q|0}Ce=io(ce+13|0),q[Ce+8>>2]=0,q[Ce+4>>2]=ce,q[Ce>>2]=ce,q[De+4>>2]=gs(Ce+12|0,Q,ce+1|0),q[De>>2]=1440,to(0|De,1472,1),vo()}function ys(Q,De,ce,Ce){an[Q+53|0]=1;e:if(q[Q+4>>2]==(0|ce)){an[Q+52|0]=1;t:{if(!(ce=q[Q+16>>2])){if(q[Q+36>>2]=1,q[Q+24>>2]=Ce,q[Q+16>>2]=De,(0|Ce)!=1)break e;if(q[Q+48>>2]==1)break t;break e}if((0|De)==(0|ce)){if((0|(ce=q[Q+24>>2]))==2&&(q[Q+24>>2]=Ce,ce=Ce),q[Q+48>>2]!=1)break e;if((0|ce)==1)break t;break e}q[Q+36>>2]=q[Q+36>>2]+1}an[Q+54|0]=1}}function Oa(Q,De,ce){var Ce=0;if(!ce)return q[Q+4>>2]==q[De+4>>2];if((0|Q)==(0|De))return 1;Ce=q[Q+4>>2],Q=Cn[0|Ce],ce=q[De+4>>2];e:if(!(!Q|(0|(De=Cn[0|ce]))!=(0|Q)))for(;;){if(De=Cn[ce+1|0],!(Q=Cn[Ce+1|0]))break e;if(ce=ce+1|0,Ce=Ce+1|0,(0|Q)!=(0|De))break}return(0|Q)==(0|De)}function vs(Q,De,ce){var Ce;if(!(Ce=q[Q+16>>2]))return q[Q+36>>2]=1,q[Q+24>>2]=ce,void(q[Q+16>>2]=De);e:{if((0|De)==(0|Ce)){if(q[Q+24>>2]!=2)break e;return void(q[Q+24>>2]=ce)}an[Q+54|0]=1,q[Q+24>>2]=2,q[Q+36>>2]=q[Q+36>>2]+1}}function no(Q){var De,ce;return(Q=(De=q[377])+(ce=Q+3&-4)|0)>>>0<=De>>>0&&ce||Q>>>0>(ri.byteLength/65536|0)<<16>>>0&&!(0|ts(0|Q))?(q[403]=48,-1):(q[377]=Q,De)}function io(Q){var De=0;Q=Q||1;e:{for(;;){if(De=Fo(Q))break e;if(!(De=q[528]))break;Fn[0|De]()}Do(),vo()}return De}function Xn(Q){var De,ce;return q[(Q|=0)>>2]=1392,De=q[Q+4>>2]-12|0,ce=q[De+8>>2]-1|0,q[De+8>>2]=ce,(0|ce)<0&&Ea(De),0|Q}function An(Q){var De;return(-1>>>(De=31&Q)&-2)<<De|(-1<<(Q=0-Q&31)&-2)>>>Q}function ns(Q){(Q|=0)&&Ea(Q)}function xs(Q){Xn(Q|=0),Ea(Q)}function is(Q){return 0|Q}function Bo(Q){Ea(Q|=0)}function Xi(Q){}Sa(_n=Cn,1024,"dmVjdG9yAHN0ZDo6ZXhjZXB0aW9uAGFsbG9jYXRvcjxUPjo6YWxsb2NhdGUoc2l6ZV90IG4pICduJyBleGNlZWRzIG1heGltdW0gc3VwcG9ydGVkIHNpemUATjEwX19jeHhhYml2MTE2X19zaGltX3R5cGVfaW5mb0UAAOgEAABaBAAA3AUAAE4xMF9fY3h4YWJpdjExN19fY2xhc3NfdHlwZV9pbmZvRQAAAOgEAACIBAAAfAQAAAAAAACsBAAAAgAAAAMAAAAEAAAABQAAAAYAAAAHAAAACAAAAAkAAAAAAAAAMAUAAAIAAAAKAAAABAAAAAUAAAAGAAAACwAAAAwAAAANAAAATjEwX19jeHhhYml2MTIwX19zaV9jbGFzc190eXBlX2luZm9FAAAAAOgEAAAIBQAArAQAAAAAAABgBQAADgAAAA8AAAAQAAAAU3Q5ZXhjZXB0aW9uAAAAAMAEAABQBQAAAAAAAIwFAAABAAAAEQAAABIAAABTdDExbG9naWNfZXJyb3IA6AQAAHwFAABgBQAAAAAAAMAFAAABAAAAEwAAABIAAABTdDEybGVuZ3RoX2Vycm9yAAAAAOgEAACsBQAAjAUAAFN0OXR5cGVfaW5mbwAAAADABAAAzAU="),Sa(_n,1508,"UAhQ");var Fn=function(Q){return Q.grow=function(De){var ce=this.length;return this.length=this.length+De,ce},Q.set=function(De,ce){this[De]=ce},Q.get=function(De){return this[De]},Q}([null,Xn,is,Bo,Xi,Xi,function(Q,De,ce){ce|=0;var Ce,Ke=0,yt=0,Vt=0,Wt=0;if(sa=Ce=sa+-64|0,Ke=1,!Oa(Q|=0,De|=0,0)&&(Ke=0,De)){sa=Ke=sa+-64|0,yt=q[De>>2],Vt=q[yt-4>>2],Wt=q[yt-8>>2],q[Ke+20>>2]=0,q[Ke+16>>2]=1148,q[Ke+12>>2]=De,q[Ke+8>>2]=1196,yt=0,Bs(Ke+24|0,39),De=De+Wt|0;e:if(Oa(Vt,1196,0))q[Ke+56>>2]=1,Fn[q[q[Vt>>2]+20>>2]](Vt,Ke+8|0,De,De,1,0),yt=q[Ke+32>>2]==1?De:0;else{Fn[q[q[Vt>>2]+24>>2]](Vt,Ke+8|0,De,1,0);t:switch(q[Ke+44>>2]){case 0:yt=q[Ke+48>>2]==1&&q[Ke+36>>2]==1&&q[Ke+40>>2]==1?q[Ke+28>>2]:0;break e;case 1:break t;default:break e}q[Ke+32>>2]!=1&&q[Ke+48>>2]|q[Ke+36>>2]!=1|q[Ke+40>>2]!=1||(yt=q[Ke+24>>2])}sa=Ke- -64|0,Ke=0,yt&&(Bs(4|(De=Ce+8|0),52),q[Ce+56>>2]=1,q[Ce+20>>2]=-1,q[Ce+16>>2]=Q,q[Ce+8>>2]=yt,Fn[q[q[yt>>2]+28>>2]](yt,De,q[ce>>2],1),(0|(Q=q[Ce+32>>2]))==1&&(q[ce>>2]=q[Ce+24>>2]),Ke=(0|Q)==1)}return sa=Ce- -64|0,0|Ke},function(Q,De,ce,Ce,Ke,yt){ce|=0,Ce|=0,Ke|=0,yt|=0,Oa(Q|=0,q[8+(De|=0)>>2],yt)&&ys(De,ce,Ce,Ke)},function(Q,De,ce,Ce,Ke){if(ce|=0,Ce|=0,Ke|=0,Oa(Q|=0,q[8+(De|=0)>>2],Ke))q[De+28>>2]==1|q[De+4>>2]!=(0|ce)||(q[De+28>>2]=Ce);else e:if(Oa(Q,q[De>>2],Ke)){if(!(q[De+16>>2]!=(0|ce)&q[De+20>>2]!=(0|ce))){if((0|Ce)!=1)break e;return void(q[De+32>>2]=1)}q[De+20>>2]=ce,q[De+32>>2]=Ce,q[De+40>>2]=q[De+40>>2]+1,q[De+36>>2]!=1|q[De+24>>2]!=2||(an[De+54|0]=1),q[De+44>>2]=4}},function(Q,De,ce,Ce){ce|=0,Ce|=0,Oa(Q|=0,q[8+(De|=0)>>2],0)&&vs(De,ce,Ce)},Bo,function(Q,De,ce,Ce,Ke,yt){ce|=0,Ce|=0,Ke|=0,yt|=0,Oa(Q|=0,q[8+(De|=0)>>2],yt)?ys(De,ce,Ce,Ke):(Q=q[Q+8>>2],Fn[q[q[Q>>2]+20>>2]](Q,De,ce,Ce,Ke,yt))},function(Q,De,ce,Ce,Ke){if(ce|=0,Ce|=0,Ke|=0,Oa(Q|=0,q[8+(De|=0)>>2],Ke))q[De+28>>2]==1|q[De+4>>2]!=(0|ce)||(q[De+28>>2]=Ce);else e:{if(Oa(Q,q[De>>2],Ke)){if(!(q[De+16>>2]!=(0|ce)&q[De+20>>2]!=(0|ce))){if((0|Ce)!=1)break e;return void(q[De+32>>2]=1)}q[De+32>>2]=Ce;t:if(q[De+44>>2]!=4){if(Mi[De+52>>1]=0,Q=q[Q+8>>2],Fn[q[q[Q>>2]+20>>2]](Q,De,ce,ce,1,Ke),Cn[De+53|0]){if(q[De+44>>2]=3,!Cn[De+52|0])break t;break e}q[De+44>>2]=4}if(q[De+20>>2]=ce,q[De+40>>2]=q[De+40>>2]+1,q[De+36>>2]!=1|q[De+24>>2]!=2)break e;return void(an[De+54|0]=1)}Q=q[Q+8>>2],Fn[q[q[Q>>2]+24>>2]](Q,De,ce,Ce,Ke)}},function(Q,De,ce,Ce){ce|=0,Ce|=0,Oa(Q|=0,q[8+(De|=0)>>2],0)?vs(De,ce,Ce):(Q=q[Q+8>>2],Fn[q[q[Q>>2]+28>>2]](Q,De,ce,Ce))},is,Bo,function(Q){return 1031},xs,function(Q){return q[4+(Q|=0)>>2]},xs]);return{g:function(){},h:ns,i:function(){var Q;return Q=io(24),q[Q>>2]=0,q[Q+4>>2]=0,q[Q+16>>2]=0,q[Q+20>>2]=0,q[Q+8>>2]=0,q[Q+12>>2]=0,0|Q},j:function(Q,De,ce){var Ce;return Q=+Q,De=+De,ce=+ce,Ce=io(24),Fr[Ce+16>>3]=ce,Fr[Ce+8>>3]=De,Fr[Ce>>3]=Q,0|Ce},k:function(Q,De){De|=0,Fr[(Q|=0)>>3]=Fr[Q>>3]+Fr[De>>3],Fr[Q+8>>3]=Fr[Q+8>>3]+Fr[De+8>>3],Fr[Q+16>>3]=Fr[Q+16>>3]+Fr[De+16>>3]},l:function(Q,De){De|=0,Fr[(Q|=0)>>3]=Fr[Q>>3]-Fr[De>>3],Fr[Q+8>>3]=Fr[Q+8>>3]-Fr[De+8>>3],Fr[Q+16>>3]=Fr[Q+16>>3]-Fr[De+16>>3]},m:function(Q){return+Fr[(Q|=0)>>3]},n:function(Q,De){De=+De,Fr[(Q|=0)>>3]=De},o:function(Q){return+Fr[8+(Q|=0)>>3]},p:function(Q,De){De=+De,Fr[8+(Q|=0)>>3]=De},q:function(Q){return+Fr[16+(Q|=0)>>3]},r:function(Q,De){De=+De,Fr[16+(Q|=0)>>3]=De},s:ns,t:function(){var Q;return Q=io(12),q[Q+8>>2]=0,q[Q>>2]=0,q[Q+4>>2]=0,0|Q},u:function(Q,De){De|=0;var ce=0,Ce=0,Ke=0,yt=0,Vt=0,Wt=0;e:if((0|(ce=q[4+(Q|=0)>>2]))==q[Q+8>>2]){t:{if((Ke=1+(ce=(0|(Wt=ce-(Ce=q[Q>>2])|0))/24|0)|0)>>>0<178956971){if(yt=ce<<1,Ke=ce>>>0<89478485?Ke>>>0<yt>>>0?yt:Ke:178956970){if(Ke>>>0>=178956971)break t;yt=io(Ei(Ke,24))}else yt=0;ce=yt+Ei(ce,24)|0,Vt=q[De+4>>2],q[ce>>2]=q[De>>2],q[ce+4>>2]=Vt,Vt=q[De+20>>2],q[ce+16>>2]=q[De+16>>2],q[ce+20>>2]=Vt,Vt=q[De+12>>2],q[ce+8>>2]=q[De+8>>2],q[ce+12>>2]=Vt,De=ce+Ei((0|Wt)/-24|0,24)|0,(0|Wt)>0&&gs(De,Ce,Wt),q[Q+8>>2]=yt+Ei(Ke,24),q[Q+4>>2]=ce+24,q[Q>>2]=De,Ce&&Ea(Ce);break e}ro(1024),vo()}ro(1046),vo()}else Ce=q[De+4>>2],q[ce>>2]=q[De>>2],q[ce+4>>2]=Ce,Ce=q[De+20>>2],q[ce+16>>2]=q[De+16>>2],q[ce+20>>2]=Ce,Ce=q[De+12>>2],q[ce+8>>2]=q[De+8>>2],q[ce+12>>2]=Ce,q[Q+4>>2]=ce+24},v:function(Q){var De=0;(Q|=0)&&((De=q[Q>>2])&&(q[Q+4>>2]=De,Ea(De)),Ea(Q))},w:function(){return 0|io(1)},x:function(Q,De){Q|=0;var ce=0,Ce=0,Ke=0,yt=0,Vt=0,Wt=0,Pr=0,Br=0,ln=0,di=0,ao=0,Oi=0;if(Q=q[(De|=0)>>2],(Ce=(0|(Ke=q[De+4>>2]-Q|0))/24|0)>>>0>=2){if(!(Ke-24>>>0<24)){if(ce=Fr[Q+8>>3],De=1,ao=1&(Ce=Ce-1|0),Vt=Fr[Q>>3],Ke-48>>>0<24)Wt=ce;else for(Oi=-2&Ce,Ce=0,Pr=Vt,Br=ce;Ke=Q+Ei(De,24)|0,yt=.5*((Vt=Fr[Ke+24>>3])-(ln=Fr[Ke>>3]))*((di=Fr[Ke+8>>3]-ce)+((Wt=Fr[Ke+32>>3])-ce))+(.5*(ln-Pr)*(Br-ce+di)+yt),De=De+2|0,Pr=Vt,Br=Wt,(0|Oi)!=(0|(Ce=Ce+2|0)););ao&&(Q=Q+Ei(De,24)|0,yt=.5*(Fr[Q>>3]-Vt)*(Wt-ce+(Fr[Q+8>>3]-ce))+yt)}ce=yt<0?-yt:yt}else ce=0;return+ce},y:function(Q,De,ce){Q|=0,De|=0;var Ce,Ke=0,yt=0,Vt=0,Wt=0,Pr=0,Br=0,ln=0;if((Ce=((Q=q[4+(ce|=0)>>2])-(ce=q[ce>>2])|0)/24|0)>>>0>=3)for(Q=Ce-1|0,Ke=Fr[De+8>>3],ln=Fr[De>>3],De=0;Wt=ce+Ei(Q,24)|0,Vt=Fr[Wt+8>>3],Q=De,De=ce+Ei(De,24)|0,!(Ke<Vt&(yt=Fr[De+8>>3])<=Ke)&(!(Ke>=Vt)|!(Ke<yt))||ln-(Pr=Fr[De>>3])<(Ke-yt)*(Fr[Wt>>3]-Pr)/(Vt-yt)&&(Br^=1),(0|Ce)!=(0|(De=Q+1|0)););return 1&Br},z:ns,A:Fn,B:Fo}}(Kr)}(Ie)}})}}}).then(function(Cr){return Cr}).then(Ar,function(Cr){Y("failed to asynchronously prepare wasm: "+Cr),Ee(Cr)})}var er={a:Ie};if(se++,a.monitorRunDependencies&&a.monitorRunDependencies(se),a.instantiateWasm)try{return a.instantiateWasm(er,xe)}catch(Ar){return Y("Module.instantiateWasm callback failed with error: "+Ar),!1}(S||typeof T.instantiateStreaming!="function"||we.startsWith(Be)||we.startsWith("file://")||typeof fetch!="function"?bt(ke):fetch(we,{credentials:"same-origin"}).then(function(Ar){return T.instantiateStreaming(Ar,er).then(ke,function(Cr){return Y("wasm streaming compile failed: "+Cr),Y("falling back to ArrayBuffer instantiation"),bt(ke)})})).catch(c)})(),a.___wasm_call_ctors=function(){return(a.___wasm_call_ctors=a.asm.g).apply(null,arguments)};var ue,Me=a._emscripten_bind_VoidPtr___destroy___0=function(){return(Me=a._emscripten_bind_VoidPtr___destroy___0=a.asm.h).apply(null,arguments)},Je=a._emscripten_bind_McGePoint3d_McGePoint3d_0=function(){return(Je=a._emscripten_bind_McGePoint3d_McGePoint3d_0=a.asm.i).apply(null,arguments)},$e=a._emscripten_bind_McGePoint3d_McGePoint3d_3=function(){return($e=a._emscripten_bind_McGePoint3d_McGePoint3d_3=a.asm.j).apply(null,arguments)},ft=a._emscripten_bind_McGePoint3d_op_add_1=function(){return(ft=a._emscripten_bind_McGePoint3d_op_add_1=a.asm.k).apply(null,arguments)},Pt=a._emscripten_bind_McGePoint3d_op_sub_1=function(){return(Pt=a._emscripten_bind_McGePoint3d_op_sub_1=a.asm.l).apply(null,arguments)},_t=a._emscripten_bind_McGePoint3d_get_x_0=function(){return(_t=a._emscripten_bind_McGePoint3d_get_x_0=a.asm.m).apply(null,arguments)},Ue=a._emscripten_bind_McGePoint3d_set_x_1=function(){return(Ue=a._emscripten_bind_McGePoint3d_set_x_1=a.asm.n).apply(null,arguments)},Rt=a._emscripten_bind_McGePoint3d_get_y_0=function(){return(Rt=a._emscripten_bind_McGePoint3d_get_y_0=a.asm.o).apply(null,arguments)},It=a._emscripten_bind_McGePoint3d_set_y_1=function(){return(It=a._emscripten_bind_McGePoint3d_set_y_1=a.asm.p).apply(null,arguments)},Nr=a._emscripten_bind_McGePoint3d_get_z_0=function(){return(Nr=a._emscripten_bind_McGePoint3d_get_z_0=a.asm.q).apply(null,arguments)},Qt=a._emscripten_bind_McGePoint3d_set_z_1=function(){return(Qt=a._emscripten_bind_McGePoint3d_set_z_1=a.asm.r).apply(null,arguments)},Ur=a._emscripten_bind_McGePoint3d___destroy___0=function(){return(Ur=a._emscripten_bind_McGePoint3d___destroy___0=a.asm.s).apply(null,arguments)},gt=a._emscripten_bind_McGePoint3dArray_McGePoint3dArray_0=function(){return(gt=a._emscripten_bind_McGePoint3dArray_McGePoint3dArray_0=a.asm.t).apply(null,arguments)},We=a._emscripten_bind_McGePoint3dArray_append_1=function(){return(We=a._emscripten_bind_McGePoint3dArray_append_1=a.asm.u).apply(null,arguments)},Yt=a._emscripten_bind_McGePoint3dArray___destroy___0=function(){return(Yt=a._emscripten_bind_McGePoint3dArray___destroy___0=a.asm.v).apply(null,arguments)},Or=a._emscripten_bind_McGeTool_McGeTool_0=function(){return(Or=a._emscripten_bind_McGeTool_McGeTool_0=a.asm.w).apply(null,arguments)},Yr=a._emscripten_bind_McGeTool_calcArea_1=function(){return(Yr=a._emscripten_bind_McGeTool_calcArea_1=a.asm.x).apply(null,arguments)},ct=a._emscripten_bind_McGeTool_pointInPolyline_2=function(){return(ct=a._emscripten_bind_McGeTool_pointInPolyline_2=a.asm.y).apply(null,arguments)},st=a._emscripten_bind_McGeTool___destroy___0=function(){return(st=a._emscripten_bind_McGeTool___destroy___0=a.asm.z).apply(null,arguments)},qt=a._malloc=function(){return(qt=a._malloc=a.asm.B).apply(null,arguments)};function Tr(){function xe(){if(!ue&&(ue=!0,a.calledRun=!0,!u)){if(ne(J),m(a),a.onRuntimeInitialized&&a.onRuntimeInitialized(),a.postRun)for(typeof a.postRun=="function"&&(a.postRun=[a.postRun]);a.postRun.length;){var ke=a.postRun.shift();te.unshift(ke)}ne(te)}}if(!(0<se)){if(a.preRun)for(typeof a.preRun=="function"&&(a.preRun=[a.preRun]);a.preRun.length;)X();ne(z),0<se||(a.setStatus?(a.setStatus("Running..."),setTimeout(function(){setTimeout(function(){a.setStatus("")},1),xe()},1)):xe())}}if(ve=function xe(){ue||Tr(),ue||(ve=xe)},a.run=Tr,a.preInit)for(typeof a.preInit=="function"&&(a.preInit=[a.preInit]);0<a.preInit.length;)a.preInit.pop()();function ir(){}function Hr(xe){return(xe||ir).F}function vn(xe,ke){var bt=Hr(ke),er=bt[xe];return er||((er=Object.create((ke||ir).prototype)).C=xe,bt[xe]=er)}function In(){throw"cannot construct a VoidPtr, no constructor in IDL"}function Zr(xe,ke,bt){xe&&typeof xe=="object"&&(xe=xe.C),ke&&typeof ke=="object"&&(ke=ke.C),bt&&typeof bt=="object"&&(bt=bt.C),this.C=xe===void 0?Je():ke===void 0?_emscripten_bind_McGePoint3d_McGePoint3d_1(xe):bt===void 0?_emscripten_bind_McGePoint3d_McGePoint3d_2(xe,ke):$e(xe,ke,bt),Hr(Zr)[this.C]=this}function Gn(){this.C=gt(),Hr(Gn)[this.C]=this}function lt(){this.C=Or(),Hr(lt)[this.C]=this}return Tr(),ir.prototype=Object.create(ir.prototype),ir.prototype.constructor=ir,ir.prototype.D=ir,ir.F={},a.WrapperObject=ir,a.getCache=Hr,a.wrapPointer=vn,a.castObject=function(xe,ke){return vn(xe.C,ke)},a.NULL=vn(0),a.destroy=function(xe){if(!xe.__destroy__)throw"Error: Cannot destroy object. (Did you create it yourself?)";xe.__destroy__(),delete Hr(xe.D)[xe.C]},a.compare=function(xe,ke){return xe.C===ke.C},a.getPointer=function(xe){return xe.C},a.getClass=function(xe){return xe.D},In.prototype=Object.create(ir.prototype),In.prototype.constructor=In,In.prototype.D=In,In.F={},a.VoidPtr=In,In.prototype.__destroy__=function(){Me(this.C)},Zr.prototype=Object.create(ir.prototype),Zr.prototype.constructor=Zr,Zr.prototype.D=Zr,Zr.F={},a.McGePoint3d=Zr,Zr.prototype.op_add=function(xe){var ke=this.C;xe&&typeof xe=="object"&&(xe=xe.C),ft(ke,xe)},Zr.prototype.op_sub=function(xe){var ke=this.C;xe&&typeof xe=="object"&&(xe=xe.C),Pt(ke,xe)},Zr.prototype.get_x=Zr.prototype.H=function(){return _t(this.C)},Zr.prototype.set_x=Zr.prototype.R=function(xe){var ke=this.C;xe&&typeof xe=="object"&&(xe=xe.C),Ue(ke,xe)},Object.defineProperty(Zr.prototype,"x",{get:Zr.prototype.H,set:Zr.prototype.R}),Zr.prototype.get_y=Zr.prototype.I=function(){return Rt(this.C)},Zr.prototype.set_y=Zr.prototype.S=function(xe){var ke=this.C;xe&&typeof xe=="object"&&(xe=xe.C),It(ke,xe)},Object.defineProperty(Zr.prototype,"y",{get:Zr.prototype.I,set:Zr.prototype.S}),Zr.prototype.get_z=Zr.prototype.J=function(){return Nr(this.C)},Zr.prototype.set_z=Zr.prototype.T=function(xe){var ke=this.C;xe&&typeof xe=="object"&&(xe=xe.C),Qt(ke,xe)},Object.defineProperty(Zr.prototype,"z",{get:Zr.prototype.J,set:Zr.prototype.T}),Zr.prototype.__destroy__=function(){Ur(this.C)},Gn.prototype=Object.create(ir.prototype),Gn.prototype.constructor=Gn,Gn.prototype.D=Gn,Gn.F={},a.McGePoint3dArray=Gn,Gn.prototype.append=Gn.prototype.append=function(xe){var ke=this.C;xe&&typeof xe=="object"&&(xe=xe.C),We(ke,xe)},Gn.prototype.__destroy__=function(){Yt(this.C)},lt.prototype=Object.create(ir.prototype),lt.prototype.constructor=lt,lt.prototype.D=lt,lt.F={},a.McGeTool=lt,lt.prototype.calcArea=function(xe){var ke=this.C;return xe&&typeof xe=="object"&&(xe=xe.C),Yr(ke,xe)},lt.prototype.pointInPolyline=function(xe,ke){var bt=this.C;return xe&&typeof xe=="object"&&(xe=xe.C),ke&&typeof ke=="object"&&(ke=ke.C),!!ct(bt,xe,ke)},lt.prototype.__destroy__=function(){st(this.C)},o.ready});return typeof exports=="object"&&typeof module=="object"?module.exports=n:typeof define=="function"&&define.amd?define([],function(){return n}):typeof exports=="object"&&(exports.mxcadassembly=n),n()}function loadMxcadAssembly(){mxcadassemblyinit().then(function(b){store.commit("setMxassembly",b)})}function _load(b){window.MxDocumentReady=void 0,window.MxUiMain=n=>{const o=n("./MxFun").MxFun;window.THREE=o.getTHREE(),store.commit("setMxFun",o),store.events.emit("MxUiMain",n),window.MxUiMain=void 0},window.MxMain=n=>(store.events.emit("MxMain",n),window.MxMain=void 0,registerMxDbEntity(),b(),0),mxfun(),loadMxcadAssembly()}async function loadCoreCode(){return new Promise(async(b,n)=>{try{if(store.state.MxFun)return console.warn("程序已自动调用loadCoreCode 无需主动调用 | The program has automatically called loadCoreCode without actively calling it"),void b();_load(b)}catch(o){n({code:"error",msg:o})}})}function createCanvas(b="mx-canvas"){let n=document.getElementById(b);return n||((n=document.createElement("canvas")).id=b),n}function createCanvasParent(b=createCanvas()){let n;return b||(b=createCanvas()),b.parentNode?n=b.parentNode:((n=document.createElement("div")).style.height="80vh",n.appendChild(b)),n}async function dynamicImport(b){let n;switch(b){case"jquery":n=await dynamicImportJquery();break;case"element-resize-event-polyfill":n=await dynamicImportResize()}return n}async function dynamicImportResize(){try{const b=await Promise.resolve().then(function(){return elementResizeEventPolyfill_umd_min$2});return b.default?b.default:b}catch(b){console.log("import动态导入：element-resize-event-polyfill失败！",b)}}async function dynamicImportJquery(){try{const b=await Promise.resolve().then(function(){return jquery$1});return b.default?b.default:b}catch(b){console.log("import动态导入：jquery失败！",b)}}window.$=window.jQuery=jquery,_load(()=>{});var lodash=createCommonjsModule(function(b,n){(function(){var o,a="Expected a function",m="__lodash_hash_undefined__",c="__lodash_placeholder__",x=16,A=32,H=64,F=128,P=256,g=1/0,E=9007199254740991,_=NaN,k=4294967295,U=[["ary",F],["bind",1],["bindKey",2],["curry",8],["curryRight",x],["flip",512],["partial",A],["partialRight",H],["rearg",P]],C="[object Arguments]",S="[object Array]",Y="[object Boolean]",G="[object Date]",T="[object Error]",B="[object Function]",D="[object GeneratorFunction]",N="[object Map]",I="[object Number]",h="[object Object]",u="[object Promise]",v="[object RegExp]",M="[object Set]",j="[object String]",z="[object Symbol]",J="[object WeakMap]",te="[object ArrayBuffer]",X="[object DataView]",se="[object Float32Array]",ve="[object Float64Array]",Ee="[object Int8Array]",we="[object Int16Array]",Be="[object Int32Array]",re="[object Uint8Array]",fe="[object Uint8ClampedArray]",ne="[object Uint16Array]",le="[object Uint32Array]",Re=/\b__p \+= '';/g,at=/\b(__p \+=) '' \+/g,ze=/(__e\(.*?\)|\b__t\)) \+\n'';/g,Ie=/&(?:amp|lt|gt|quot|#39);/g,ue=/[&<>"']/g,Me=RegExp(Ie.source),Je=RegExp(ue.source),$e=/<%-([\s\S]+?)%>/g,ft=/<%([\s\S]+?)%>/g,Pt=/<%=([\s\S]+?)%>/g,_t=/\.|\[(?:[^[\]]*|(["'])(?:(?!\1)[^\\]|\\.)*?\1)\]/,Ue=/^\w*$/,Rt=/[^.[\]]+|\[(?:(-?\d+(?:\.\d+)?)|(["'])((?:(?!\2)[^\\]|\\.)*?)\2)\]|(?=(?:\.|\[\])(?:\.|\[\]|$))/g,It=/[\\^$.*+?()[\]{}|]/g,Nr=RegExp(It.source),Qt=/^\s+/,Ur=/\s/,gt=/\{(?:\n\/\* \[wrapped with .+\] \*\/)?\n?/,We=/\{\n\/\* \[wrapped with (.+)\] \*/,Yt=/,? & /,Or=/[^\x00-\x2f\x3a-\x40\x5b-\x60\x7b-\x7f]+/g,Yr=/[()=,{}\[\]\/\s]/,ct=/\\(\\)?/g,st=/\$\{([^\\}]*(?:\\.[^\\}]*)*)\}/g,qt=/\w*$/,Tr=/^[-+]0x[0-9a-f]+$/i,ir=/^0b[01]+$/i,Hr=/^\[object .+?Constructor\]$/,vn=/^0o[0-7]+$/i,In=/^(?:0|[1-9]\d*)$/,Zr=/[\xc0-\xd6\xd8-\xf6\xf8-\xff\u0100-\u017f]/g,Gn=/($^)/,lt=/['\n\r\u2028\u2029\\]/g,xe="\\ud800-\\udfff",ke="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",bt="\\u2700-\\u27bf",er="a-z\\xdf-\\xf6\\xf8-\\xff",Ar="A-Z\\xc0-\\xd6\\xd8-\\xde",Cr="\\ufe0e\\ufe0f",Kr="\\xac\\xb1\\xd7\\xf7\\x00-\\x2f\\x3a-\\x40\\x5b-\\x60\\x7b-\\xbf\\u2000-\\u206f \\t\\x0b\\f\\xa0\\ufeff\\n\\r\\u2028\\u2029\\u1680\\u180e\\u2000\\u2001\\u2002\\u2003\\u2004\\u2005\\u2006\\u2007\\u2008\\u2009\\u200a\\u202f\\u205f\\u3000",_n="["+xe+"]",Sn="["+Kr+"]",Tn="["+ke+"]",Sa="\\d+",hi="["+bt+"]",ri="["+er+"]",an="[^"+xe+Kr+Sa+bt+er+Ar+"]",Mi="\\ud83c[\\udffb-\\udfff]",q="[^"+xe+"]",Cn="(?:\\ud83c[\\udde6-\\uddff]){2}",pi="[\\ud800-\\udbff][\\udc00-\\udfff]",Fr="["+Ar+"]",Ei="\\u200d",vo="(?:"+ri+"|"+an+")",ts="(?:"+Fr+"|"+an+")",Do="(?:['’](?:d|ll|m|re|s|t|ve))?",ms="(?:['’](?:D|LL|M|RE|S|T|VE))?",to="(?:"+Tn+"|"+Mi+")?",rs="["+Cr+"]?",sa=rs+to+"(?:"+Ei+"(?:"+[q,Cn,pi].join("|")+")"+rs+to+")*",Fo="(?:"+[hi,Cn,pi].join("|")+")"+sa,Ea="(?:"+[q+Tn+"?",Tn,Cn,pi,_n].join("|")+")",gs=RegExp("['’]","g"),Bs=RegExp(Tn,"g"),ro=RegExp(Mi+"(?="+Mi+")|"+Ea+sa,"g"),ys=RegExp([Fr+"?"+ri+"+"+Do+"(?="+[Sn,Fr,"$"].join("|")+")",ts+"+"+ms+"(?="+[Sn,Fr+vo,"$"].join("|")+")",Fr+"?"+vo+"+"+Do,Fr+"+"+ms,"\\d*(?:1ST|2ND|3RD|(?![123])\\dTH)(?=\\b|[a-z_])","\\d*(?:1st|2nd|3rd|(?![123])\\dth)(?=\\b|[A-Z_])",Sa,Fo].join("|"),"g"),Oa=RegExp("["+Ei+xe+ke+Cr+"]"),vs=/[a-z][A-Z]|[A-Z]{2}[a-z]|[0-9][a-zA-Z]|[a-zA-Z][0-9]|[^a-zA-Z0-9 ]/,no=["Array","Buffer","DataView","Date","Error","Float32Array","Float64Array","Function","Int8Array","Int16Array","Int32Array","Map","Math","Object","Promise","RegExp","Set","String","Symbol","TypeError","Uint8Array","Uint8ClampedArray","Uint16Array","Uint32Array","WeakMap","_","clearTimeout","isFinite","parseInt","setTimeout"],io=-1,Xn={};Xn[se]=Xn[ve]=Xn[Ee]=Xn[we]=Xn[Be]=Xn[re]=Xn[fe]=Xn[ne]=Xn[le]=!0,Xn[C]=Xn[S]=Xn[te]=Xn[Y]=Xn[X]=Xn[G]=Xn[T]=Xn[B]=Xn[N]=Xn[I]=Xn[h]=Xn[v]=Xn[M]=Xn[j]=Xn[J]=!1;var An={};An[C]=An[S]=An[te]=An[X]=An[Y]=An[G]=An[se]=An[ve]=An[Ee]=An[we]=An[Be]=An[N]=An[I]=An[h]=An[v]=An[M]=An[j]=An[z]=An[re]=An[fe]=An[ne]=An[le]=!0,An[T]=An[B]=An[J]=!1;var ns={"\\":"\\","'":"'","\n":"n","\r":"r","\u2028":"u2028","\u2029":"u2029"},xs=parseFloat,is=parseInt,Bo=typeof commonjsGlobal=="object"&&commonjsGlobal&&commonjsGlobal.Object===Object&&commonjsGlobal,Xi=typeof self=="object"&&self&&self.Object===Object&&self,Fn=Bo||Xi||Function("return this")(),Q=n&&!n.nodeType&&n,De=Q&&b&&!b.nodeType&&b,ce=De&&De.exports===Q,Ce=ce&&Bo.process,Ke=function(){try{return De&&De.require&&De.require("util").types||Ce&&Ce.binding&&Ce.binding("util")}catch{}}(),yt=Ke&&Ke.isArrayBuffer,Vt=Ke&&Ke.isDate,Wt=Ke&&Ke.isMap,Pr=Ke&&Ke.isRegExp,Br=Ke&&Ke.isSet,ln=Ke&&Ke.isTypedArray;function di(_e,Se,Fe){switch(Fe.length){case 0:return _e.call(Se);case 1:return _e.call(Se,Fe[0]);case 2:return _e.call(Se,Fe[0],Fe[1]);case 3:return _e.call(Se,Fe[0],Fe[1],Fe[2])}return _e.apply(Se,Fe)}function ao(_e,Se,Fe,rt){for(var dt=-1,ut=_e==null?0:_e.length;++dt<ut;){var Lt=_e[dt];Se(rt,Lt,Fe(Lt),_e)}return rt}function Oi(_e,Se){for(var Fe=-1,rt=_e==null?0:_e.length;++Fe<rt&&Se(_e[Fe],Fe,_e)!==!1;);return _e}function xo(_e,Se){for(var Fe=-1,rt=_e==null?0:_e.length;++Fe<rt;)if(!Se(_e[Fe],Fe,_e))return!1;return!0}function So(_e,Se){for(var Fe=-1,rt=_e==null?0:_e.length,dt=0,ut=[];++Fe<rt;){var Lt=_e[Fe];Se(Lt,Fe,_e)&&(ut[dt++]=Lt)}return ut}function oo(_e,Se){return!(_e==null||!_e.length)&&Ai(_e,Se,0)>-1}function Gs(_e,Se,Fe){for(var rt=-1,dt=_e==null?0:_e.length;++rt<dt;)if(Fe(Se,_e[rt]))return!0;return!1}function Jn(_e,Se){for(var Fe=-1,rt=_e==null?0:_e.length,dt=Array(rt);++Fe<rt;)dt[Fe]=Se(_e[Fe],Fe,_e);return dt}function wa(_e,Se){for(var Fe=-1,rt=Se.length,dt=_e.length;++Fe<rt;)_e[dt+Fe]=Se[Fe];return _e}function Ia(_e,Se,Fe,rt){var dt=-1,ut=_e==null?0:_e.length;for(rt&&ut&&(Fe=_e[++dt]);++dt<ut;)Fe=Se(Fe,_e[dt],dt,_e);return Fe}function ta(_e,Se,Fe,rt){var dt=_e==null?0:_e.length;for(rt&&dt&&(Fe=_e[--dt]);dt--;)Fe=Se(Fe,_e[dt],dt,_e);return Fe}function Go(_e,Se){for(var Fe=-1,rt=_e==null?0:_e.length;++Fe<rt;)if(Se(_e[Fe],Fe,_e))return!0;return!1}var ws=qn("length");function xn(_e,Se,Fe){var rt;return Fe(_e,function(dt,ut,Lt){if(Se(dt,ut,Lt))return rt=ut,!1}),rt}function Gt(_e,Se,Fe,rt){for(var dt=_e.length,ut=Fe+(rt?1:-1);rt?ut--:++ut<dt;)if(Se(_e[ut],ut,_e))return ut;return-1}function Ai(_e,Se,Fe){return Se==Se?function(rt,dt,ut){for(var Lt=ut-1,Rr=rt.length;++Lt<Rr;)if(rt[Lt]===dt)return Lt;return-1}(_e,Se,Fe):Gt(_e,lc,Fe)}function zo(_e,Se,Fe,rt){for(var dt=Fe-1,ut=_e.length;++dt<ut;)if(rt(_e[dt],Se))return dt;return-1}function lc(_e){return _e!=_e}function Yn(_e,Se){var Fe=_e==null?0:_e.length;return Fe?Gi(_e,Se)/Fe:_}function qn(_e){return function(Se){return Se==null?o:Se[_e]}}function Yi(_e){return function(Se){return _e==null?o:_e[Se]}}function zs(_e,Se,Fe,rt,dt){return dt(_e,function(ut,Lt,Rr){Fe=rt?(rt=!1,ut):Se(Fe,ut,Lt,Rr)}),Fe}function Gi(_e,Se){for(var Fe,rt=-1,dt=_e.length;++rt<dt;){var ut=Se(_e[rt]);ut!==o&&(Fe=Fe===o?ut:Fe+ut)}return Fe}function bs(_e,Se){for(var Fe=-1,rt=Array(_e);++Fe<_e;)rt[Fe]=Se(Fe);return rt}function Us(_e){return _e&&_e.slice(0,pe(_e)+1).replace(Qt,"")}function Le(_e){return function(Se){return _e(Se)}}function Eo(_e,Se){return Jn(Se,function(Fe){return _e[Fe]})}function ra(_e,Se){return _e.has(Se)}function uc(_e,Se){for(var Fe=-1,rt=_e.length;++Fe<rt&&Ai(Se,_e[Fe],0)>-1;);return Fe}function Ms(_e,Se){for(var Fe=_e.length;Fe--&&Ai(Se,_e[Fe],0)>-1;);return Fe}var Oo=Yi({À:"A",Á:"A",Â:"A",Ã:"A",Ä:"A",Å:"A",à:"a",á:"a",â:"a",ã:"a",ä:"a",å:"a",Ç:"C",ç:"c",Ð:"D",ð:"d",È:"E",É:"E",Ê:"E",Ë:"E",è:"e",é:"e",ê:"e",ë:"e",Ì:"I",Í:"I",Î:"I",Ï:"I",ì:"i",í:"i",î:"i",ï:"i",Ñ:"N",ñ:"n",Ò:"O",Ó:"O",Ô:"O",Õ:"O",Ö:"O",Ø:"O",ò:"o",ó:"o",ô:"o",õ:"o",ö:"o",ø:"o",Ù:"U",Ú:"U",Û:"U",Ü:"U",ù:"u",ú:"u",û:"u",ü:"u",Ý:"Y",ý:"y",ÿ:"y",Æ:"Ae",æ:"ae",Þ:"Th",þ:"th",ß:"ss",Ā:"A",Ă:"A",Ą:"A",ā:"a",ă:"a",ą:"a",Ć:"C",Ĉ:"C",Ċ:"C",Č:"C",ć:"c",ĉ:"c",ċ:"c",č:"c",Ď:"D",Đ:"D",ď:"d",đ:"d",Ē:"E",Ĕ:"E",Ė:"E",Ę:"E",Ě:"E",ē:"e",ĕ:"e",ė:"e",ę:"e",ě:"e",Ĝ:"G",Ğ:"G",Ġ:"G",Ģ:"G",ĝ:"g",ğ:"g",ġ:"g",ģ:"g",Ĥ:"H",Ħ:"H",ĥ:"h",ħ:"h",Ĩ:"I",Ī:"I",Ĭ:"I",Į:"I",İ:"I",ĩ:"i",ī:"i",ĭ:"i",į:"i",ı:"i",Ĵ:"J",ĵ:"j",Ķ:"K",ķ:"k",ĸ:"k",Ĺ:"L",Ļ:"L",Ľ:"L",Ŀ:"L",Ł:"L",ĺ:"l",ļ:"l",ľ:"l",ŀ:"l",ł:"l",Ń:"N",Ņ:"N",Ň:"N",Ŋ:"N",ń:"n",ņ:"n",ň:"n",ŋ:"n",Ō:"O",Ŏ:"O",Ő:"O",ō:"o",ŏ:"o",ő:"o",Ŕ:"R",Ŗ:"R",Ř:"R",ŕ:"r",ŗ:"r",ř:"r",Ś:"S",Ŝ:"S",Ş:"S",Š:"S",ś:"s",ŝ:"s",ş:"s",š:"s",Ţ:"T",Ť:"T",Ŧ:"T",ţ:"t",ť:"t",ŧ:"t",Ũ:"U",Ū:"U",Ŭ:"U",Ů:"U",Ű:"U",Ų:"U",ũ:"u",ū:"u",ŭ:"u",ů:"u",ű:"u",ų:"u",Ŵ:"W",ŵ:"w",Ŷ:"Y",ŷ:"y",Ÿ:"Y",Ź:"Z",Ż:"Z",Ž:"Z",ź:"z",ż:"z",ž:"z",Ĳ:"IJ",ĳ:"ij",Œ:"Oe",œ:"oe",ŉ:"'n",ſ:"s"}),Hs=Yi({"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#39;"});function ba(_e){return"\\"+ns[_e]}function mn(_e){return Oa.test(_e)}function _l(_e){var Se=-1,Fe=Array(_e.size);return _e.forEach(function(rt,dt){Fe[++Se]=[dt,rt]}),Fe}function au(_e,Se){return function(Fe){return _e(Se(Fe))}}function y(_e,Se){for(var Fe=-1,rt=_e.length,dt=0,ut=[];++Fe<rt;){var Lt=_e[Fe];Lt!==Se&&Lt!==c||(_e[Fe]=c,ut[dt++]=Fe)}return ut}function O(_e){var Se=-1,Fe=Array(_e.size);return _e.forEach(function(rt){Fe[++Se]=rt}),Fe}function K(_e){return mn(_e)?function(Se){for(var Fe=ro.lastIndex=0;ro.test(Se);)++Fe;return Fe}(_e):ws(_e)}function ie(_e){return mn(_e)?function(Se){return Se.match(ro)||[]}(_e):function(Se){return Se.split("")}(_e)}function pe(_e){for(var Se=_e.length;Se--&&Ur.test(_e.charAt(Se)););return Se}var me=Yi({"&amp;":"&","&lt;":"<","&gt;":">","&quot;":'"',"&#39;":"'"}),Te=function _e(Se){var Fe,rt=(Se=Se==null?Fn:Te.defaults(Fn.Object(),Se,Te.pick(Fn,no))).Array,dt=Se.Date,ut=Se.Error,Lt=Se.Function,Rr=Se.Math,At=Se.Object,Wr=Se.RegExp,Zn=Se.String,Un=Se.TypeError,la=rt.prototype,Ma=Lt.prototype,dn=At.prototype,_a=Se["__core-js_shared__"],wn=Ma.toString,Jr=dn.hasOwnProperty,so=0,Uo=(Fe=/[^.]+$/.exec(_a&&_a.keys&&_a.keys.IE_PROTO||""))?"Symbol(src)_1."+Fe:"",ua=dn.toString,Ho=wn.call(At),Ta=Fn._,Zi=Wr("^"+wn.call(Jr).replace(It,"\\$&").replace(/hasOwnProperty|(function).*?(?=\\\()| for .+?(?=\\\])/g,"$1.*?")+"$"),lo=ce?Se.Buffer:o,zi=Se.Symbol,Kn=Se.Uint8Array,$n=lo?lo.allocUnsafe:o,Li=au(At.getPrototypeOf,At),Ua=At.create,_i=dn.propertyIsEnumerable,qr=la.splice,li=zi?zi.isConcatSpreadable:o,ni=zi?zi.iterator:o,kn=zi?zi.toStringTag:o,Ca=function(){try{var s=As(At,"defineProperty");return s({},"",{}),s}catch{}}(),_s=Se.clearTimeout!==Fn.clearTimeout&&Se.clearTimeout,Tl=dt&&dt.now!==Fn.Date.now&&dt.now,na=Se.setTimeout!==Fn.setTimeout&&Se.setTimeout,ca=Rr.ceil,Ui=Rr.floor,Ts=At.getOwnPropertySymbols,Ha=lo?lo.isBuffer:o,wo=Se.isFinite,Ao=la.join,Cl=au(At.keys,At),fi=Rr.max,Ii=Rr.min,Ws=dt.now,ki=Se.parseInt,Dl=Rr.random,Ne=la.reverse,ot=As(Se,"DataView"),Qe=As(Se,"Map"),Ct=As(Se,"Promise"),jt=As(Se,"Set"),pr=As(Se,"WeakMap"),dr=As(At,"create"),Er=pr&&new pr,kt={},Dn=Yo(ot),wr=Yo(Qe),Kt=Yo(Ct),jn=Yo(jt),tn=Yo(pr),ui=zi?zi.prototype:o,Ti=ui?ui.valueOf:o,mi=ui?ui.toString:o;function be(s){if(xi(s)&&!yn(s)&&!(s instanceof bn)){if(s instanceof En)return s;if(Jr.call(s,"__wrapped__"))return Zo(s)}return new En(s)}var Ci=function(){function s(){}return function(d){if(!vi(d))return{};if(Ua)return Ua(d);s.prototype=d;var R=new s;return s.prototype=o,R}}();function tr(){}function En(s,d){this.__wrapped__=s,this.__actions__=[],this.__chain__=!!d,this.__index__=0,this.__values__=o}function bn(s){this.__wrapped__=s,this.__actions__=[],this.__dir__=1,this.__filtered__=!1,this.__iteratees__=[],this.__takeCount__=k,this.__views__=[]}function Ki(s){var d=-1,R=s==null?0:s.length;for(this.clear();++d<R;){var oe=s[d];this.set(oe[0],oe[1])}}function Wa(s){var d=-1,R=s==null?0:s.length;for(this.clear();++d<R;){var oe=s[d];this.set(oe[0],oe[1])}}function Hi(s){var d=-1,R=s==null?0:s.length;for(this.clear();++d<R;){var oe=s[d];this.set(oe[0],oe[1])}}function bo(s){var d=-1,R=s==null?0:s.length;for(this.__data__=new Hi;++d<R;)this.add(s[d])}function ha(s){var d=this.__data__=new Wa(s);this.size=d.size}function Ja(s,d){var R=yn(s),oe=!R&&ia(s),de=!R&&!oe&&Io(s),Pe=!R&&!oe&&!de&&Yl(s),Ye=R||oe||de||Pe,nt=Ye?bs(s.length,Zn):[],xt=nt.length;for(var mt in s)!d&&!Jr.call(s,mt)||Ye&&(mt=="length"||de&&(mt=="offset"||mt=="parent")||Pe&&(mt=="buffer"||mt=="byteLength"||mt=="byteOffset")||qo(mt,xt))||nt.push(mt);return nt}function Sl(s){var d=s.length;return d?s[Pn(0,d-1)]:o}function ji(s,d,R){(R!==o&&!Ka(s[d],R)||R===o&&!(d in s))&&ka(s,d,R)}function br(s,d,R){var oe=s[d];Jr.call(s,d)&&Ka(oe,R)&&(R!==o||d in s)||ka(s,d,R)}function ou(s,d){for(var R=s.length;R--;)if(Ka(s[R][0],d))return R;return-1}function Js(s,d,R,oe){return Po(s,function(de,Pe,Ye){d(oe,de,R(de),Ye)}),oe}function cc(s,d){return s&&Wo(d,Ji(d),s)}function ka(s,d,R){d=="__proto__"&&Ca?Ca(s,d,{configurable:!0,enumerable:!0,value:R,writable:!0}):s[d]=R}function as(s,d){for(var R=-1,oe=d.length,de=rt(oe),Pe=s==null;++R<oe;)de[R]=Pe?o:Gc(s,d[R]);return de}function uo(s,d,R){return s==s&&(R!==o&&(s=s<=R?s:R),d!==o&&(s=s>=d?s:d)),s}function qa(s,d,R,oe,de,Pe){var Ye,nt=1&d,xt=2&d,mt=4&d;if(R&&(Ye=de?R(s,oe,de,Pe):R(s)),Ye!==o)return Ye;if(!vi(s))return s;var Nt=yn(s);if(Nt){if(Ye=function(zt){var rr=zt.length,Ir=new zt.constructor(rr);return rr&&typeof zt[0]=="string"&&Jr.call(zt,"index")&&(Ir.index=zt.index,Ir.input=zt.input),Ir}(s),!nt)return Za(s,Ye)}else{var Zt=Pa(s),Sr=Zt==B||Zt==D;if(Io(s))return Uh(s,nt);if(Zt==h||Zt==C||Sr&&!de){if(Ye=xt||Sr?{}:rp(s),!nt)return xt?function(zt,rr){return Wo(zt,Dh(zt),rr)}(s,function(zt,rr){return zt&&Wo(rr,da(rr),zt)}(Ye,s)):function(zt,rr){return Wo(zt,Ch(zt),rr)}(s,cc(Ye,s))}else{if(!An[Zt])return de?s:{};Ye=function(zt,rr,Ir){var mr,fn=zt.constructor;switch(rr){case te:return yh(zt);case Y:case G:return new fn(+zt);case X:return function(cn,Rn){var kr=Rn?yh(cn.buffer):cn.buffer;return new cn.constructor(kr,cn.byteOffset,cn.byteLength)}(zt,Ir);case se:case ve:case Ee:case we:case Be:case re:case fe:case ne:case le:return Hh(zt,Ir);case N:return new fn;case I:case j:return new fn(zt);case v:return function(cn){var Rn=new cn.constructor(cn.source,qt.exec(cn));return Rn.lastIndex=cn.lastIndex,Rn}(zt);case M:return new fn;case z:return mr=zt,Ti?At(Ti.call(mr)):{}}}(s,Zt,nt)}}Pe||(Pe=new ha);var Lr=Pe.get(s);if(Lr)return Lr;Pe.set(s,Ye),Xl(s)?s.forEach(function(zt){Ye.add(qa(zt,d,R,zt,s,Pe))}):Iu(s)&&s.forEach(function(zt,rr){Ye.set(rr,qa(zt,d,R,rr,s,Pe))});var en=Nt?o:(mt?xt?tl:el:xt?da:Ji)(s);return Oi(en||s,function(zt,rr){en&&(zt=s[rr=zt]),br(Ye,rr,qa(zt,d,R,rr,s,Pe))}),Ye}function hc(s,d,R){var oe=R.length;if(s==null)return!oe;for(s=At(s);oe--;){var de=R[oe],Pe=d[de],Ye=s[de];if(Ye===o&&!(de in s)||!Pe(Ye))return!1}return!0}function pc(s,d,R){if(typeof s!="function")throw new Un(a);return jl(function(){s.apply(o,R)},d)}function Cs(s,d,R,oe){var de=-1,Pe=oo,Ye=!0,nt=s.length,xt=[],mt=d.length;if(!nt)return xt;R&&(d=Jn(d,Le(R))),oe?(Pe=Gs,Ye=!1):d.length>=200&&(Pe=ra,Ye=!1,d=new bo(d));e:for(;++de<nt;){var Nt=s[de],Zt=R==null?Nt:R(Nt);if(Nt=oe||Nt!==0?Nt:0,Ye&&Zt==Zt){for(var Sr=mt;Sr--;)if(d[Sr]===Zt)continue e;xt.push(Nt)}else Pe(d,Zt,oe)||xt.push(Nt)}return xt}be.templateSettings={escape:$e,evaluate:ft,interpolate:Pt,variable:"",imports:{_:be}},be.prototype=tr.prototype,be.prototype.constructor=be,En.prototype=Ci(tr.prototype),En.prototype.constructor=En,bn.prototype=Ci(tr.prototype),bn.prototype.constructor=bn,Ki.prototype.clear=function(){this.__data__=dr?dr(null):{},this.size=0},Ki.prototype.delete=function(s){var d=this.has(s)&&delete this.__data__[s];return this.size-=d?1:0,d},Ki.prototype.get=function(s){var d=this.__data__;if(dr){var R=d[s];return R===m?o:R}return Jr.call(d,s)?d[s]:o},Ki.prototype.has=function(s){var d=this.__data__;return dr?d[s]!==o:Jr.call(d,s)},Ki.prototype.set=function(s,d){var R=this.__data__;return this.size+=this.has(s)?0:1,R[s]=dr&&d===o?m:d,this},Wa.prototype.clear=function(){this.__data__=[],this.size=0},Wa.prototype.delete=function(s){var d=this.__data__,R=ou(d,s);return!(R<0||(R==d.length-1?d.pop():qr.call(d,R,1),--this.size,0))},Wa.prototype.get=function(s){var d=this.__data__,R=ou(d,s);return R<0?o:d[R][1]},Wa.prototype.has=function(s){return ou(this.__data__,s)>-1},Wa.prototype.set=function(s,d){var R=this.__data__,oe=ou(R,s);return oe<0?(++this.size,R.push([s,d])):R[oe][1]=d,this},Hi.prototype.clear=function(){this.size=0,this.__data__={hash:new Ki,map:new(Qe||Wa),string:new Ki}},Hi.prototype.delete=function(s){var d=Cc(this,s).delete(s);return this.size-=d?1:0,d},Hi.prototype.get=function(s){return Cc(this,s).get(s)},Hi.prototype.has=function(s){return Cc(this,s).has(s)},Hi.prototype.set=function(s,d){var R=Cc(this,s),oe=R.size;return R.set(s,d),this.size+=R.size==oe?0:1,this},bo.prototype.add=bo.prototype.push=function(s){return this.__data__.set(s,m),this},bo.prototype.has=function(s){return this.__data__.has(s)},ha.prototype.clear=function(){this.__data__=new Wa,this.size=0},ha.prototype.delete=function(s){var d=this.__data__,R=d.delete(s);return this.size=d.size,R},ha.prototype.get=function(s){return this.__data__.get(s)},ha.prototype.has=function(s){return this.__data__.has(s)},ha.prototype.set=function(s,d){var R=this.__data__;if(R instanceof Wa){var oe=R.__data__;if(!Qe||oe.length<199)return oe.push([s,d]),this.size=++R.size,this;R=this.__data__=new Hi(oe)}return R.set(s,d),this.size=R.size,this};var Po=Xh(Ro),su=Xh(Al,!0);function El(s,d){var R=!0;return Po(s,function(oe,de,Pe){return R=!!d(oe,de,Pe)}),R}function os(s,d,R){for(var oe=-1,de=s.length;++oe<de;){var Pe=s[oe],Ye=d(Pe);if(Ye!=null&&(nt===o?Ye==Ye&&!fo(Ye):R(Ye,nt)))var nt=Ye,xt=Pe}return xt}function qs(s,d){var R=[];return Po(s,function(oe,de,Pe){d(oe,de,Pe)&&R.push(oe)}),R}function Wi(s,d,R,oe,de){var Pe=-1,Ye=s.length;for(R||(R=qp),de||(de=[]);++Pe<Ye;){var nt=s[Pe];d>0&&R(nt)?d>1?Wi(nt,d-1,R,oe,de):wa(de,nt):oe||(de[de.length]=nt)}return de}var Ol=Yh(),Di=Yh(!0);function Ro(s,d){return s&&Ol(s,d,Ji)}function Al(s,d){return s&&Di(s,d,Ji)}function dc(s,d){return So(d,function(R){return po(s[R])})}function Aa(s,d){for(var R=0,oe=(d=Es(d,s)).length;s!=null&&R<oe;)s=s[ho(d[R++])];return R&&R==oe?s:o}function fc(s,d,R){var oe=d(s);return yn(s)?oe:wa(oe,R(s))}function pa(s){return s==null?s===o?"[object Undefined]":"[object Null]":kn&&kn in At(s)?function(d){var R=Jr.call(d,kn),oe=d[kn];try{d[kn]=o;var de=!0}catch{}var Pe=ua.call(d);return de&&(R?d[kn]=oe:delete d[kn]),Pe}(s):function(d){return ua.call(d)}(s)}function un(s,d){return s>d}function oh(s,d){return s!=null&&Jr.call(s,d)}function lu(s,d){return s!=null&&d in At(s)}function Ds(s,d,R){for(var oe=R?Gs:oo,de=s[0].length,Pe=s.length,Ye=Pe,nt=rt(Pe),xt=1/0,mt=[];Ye--;){var Nt=s[Ye];Ye&&d&&(Nt=Jn(Nt,Le(d))),xt=Ii(Nt.length,xt),nt[Ye]=!R&&(d||de>=120&&Nt.length>=120)?new bo(Ye&&Nt):o}Nt=s[0];var Zt=-1,Sr=nt[0];e:for(;++Zt<de&&mt.length<xt;){var Lr=Nt[Zt],en=d?d(Lr):Lr;if(Lr=R||Lr!==0?Lr:0,!(Sr?ra(Sr,en):oe(mt,en,R))){for(Ye=Pe;--Ye;){var zt=nt[Ye];if(!(zt?ra(zt,en):oe(s[Ye],en,R)))continue e}Sr&&Sr.push(en),mt.push(Lr)}}return mt}function $i(s,d,R){var oe=(s=Oh(s,d=Es(d,s)))==null?s:s[ho(Fa(d))];return oe==null?o:di(oe,s,R)}function sh(s){return xi(s)&&pa(s)==C}function uu(s,d,R,oe,de){return s===d||(s==null||d==null||!xi(s)&&!xi(d)?s!=s&&d!=d:function(Pe,Ye,nt,xt,mt,Nt){var Zt=yn(Pe),Sr=yn(Ye),Lr=Zt?S:Pa(Pe),en=Sr?S:Pa(Ye),zt=(Lr=Lr==C?h:Lr)==h,rr=(en=en==C?h:en)==h,Ir=Lr==en;if(Ir&&Io(Pe)){if(!Io(Ye))return!1;Zt=!0,zt=!1}if(Ir&&!zt)return Nt||(Nt=new ha),Zt||Yl(Pe)?_h(Pe,Ye,nt,xt,mt,Nt):function(kr,Gr,ci,ii,Fi,Wn,ga){switch(ci){case X:if(kr.byteLength!=Gr.byteLength||kr.byteOffset!=Gr.byteOffset)return!1;kr=kr.buffer,Gr=Gr.buffer;case te:return!(kr.byteLength!=Gr.byteLength||!Wn(new Kn(kr),new Kn(Gr)));case Y:case G:case I:return Ka(+kr,+Gr);case T:return kr.name==Gr.name&&kr.message==Gr.message;case v:case j:return kr==Gr+"";case N:var ya=_l;case M:var va=1&ii;if(ya||(ya=O),kr.size!=Gr.size&&!va)return!1;var $a=ga.get(kr);if($a)return $a==Gr;ii|=2,ga.set(kr,Gr);var Hn=_h(ya(kr),ya(Gr),ii,Fi,Wn,ga);return ga.delete(kr),Hn;case z:if(Ti)return Ti.call(kr)==Ti.call(Gr)}return!1}(Pe,Ye,Lr,nt,xt,mt,Nt);if(!(1&nt)){var mr=zt&&Jr.call(Pe,"__wrapped__"),fn=rr&&Jr.call(Ye,"__wrapped__");if(mr||fn){var cn=mr?Pe.value():Pe,Rn=fn?Ye.value():Ye;return Nt||(Nt=new ha),mt(cn,Rn,nt,xt,Nt)}}return!!Ir&&(Nt||(Nt=new ha),function(kr,Gr,ci,ii,Fi,Wn){var ga=1&ci,ya=el(kr),va=ya.length;if(va!=el(Gr).length&&!ga)return!1;for(var $a=va;$a--;){var Hn=ya[$a];if(!(ga?Hn in Gr:Jr.call(Gr,Hn)))return!1}var Ju=Wn.get(kr),jo=Wn.get(Gr);if(Ju&&jo)return Ju==Gr&&jo==kr;var yl=!0;Wn.set(kr,Gr),Wn.set(Gr,kr);for(var tu=ga;++$a<va;){var ru=kr[Hn=ya[$a]],vl=Gr[Hn];if(ii)var xl=ga?ii(vl,ru,Hn,Gr,kr,Wn):ii(ru,vl,Hn,kr,Gr,Wn);if(!(xl===o?ru===vl||Fi(ru,vl,ci,ii,Wn):xl)){yl=!1;break}tu||(tu=Hn=="constructor")}if(yl&&!tu){var wl=kr.constructor,bl=Gr.constructor;wl==bl||!("constructor"in kr)||!("constructor"in Gr)||typeof wl=="function"&&wl instanceof wl&&typeof bl=="function"&&bl instanceof bl||(yl=!1)}return Wn.delete(kr),Wn.delete(Gr),yl}(Pe,Ye,nt,xt,mt,Nt))}(s,d,R,oe,uu,de))}function lh(s,d,R,oe){var de=R.length,Pe=de,Ye=!oe;if(s==null)return!Pe;for(s=At(s);de--;){var nt=R[de];if(Ye&&nt[2]?nt[1]!==s[nt[0]]:!(nt[0]in s))return!1}for(;++de<Pe;){var xt=(nt=R[de])[0],mt=s[xt],Nt=nt[1];if(Ye&&nt[2]){if(mt===o&&!(xt in s))return!1}else{var Zt=new ha;if(oe)var Sr=oe(mt,Nt,xt,s,d,Zt);if(!(Sr===o?uu(Nt,mt,3,oe,Zt):Sr))return!1}}return!0}function Xa(s){return!(!vi(s)||(d=s,Uo&&Uo in d))&&(po(s)?Zi:Hr).test(Yo(s));var d}function Lo(s){return typeof s=="function"?s:s==null?fa:typeof s=="object"?yn(s)?Zs(s[0],s[1]):Pl(s):ma(s)}function Ni(s){if(!Xo(s))return Cl(s);var d=[];for(var R in At(s))Jr.call(s,R)&&R!="constructor"&&d.push(R);return d}function Xs(s,d){return s<d}function Ys(s,d){var R=-1,oe=Da(s)?rt(s.length):[];return Po(s,function(de,Pe,Ye){oe[++R]=d(de,Pe,Ye)}),oe}function Pl(s){var d=Th(s);return d.length==1&&d[0][2]?ip(d[0][0],d[0][1]):function(R){return R===s||lh(R,s,d)}}function Zs(s,d){return Sh(s)&&rl(d)?ip(ho(s),d):function(R){var oe=Gc(R,s);return oe===o&&oe===d?cl(R,s):uu(d,oe,3)}}function Ks(s,d,R,oe,de){s!==d&&Ol(d,function(Pe,Ye){if(de||(de=new ha),vi(Pe))(function(xt,mt,Nt,Zt,Sr,Lr,en){var zt=Ah(xt,Nt),rr=Ah(mt,Nt),Ir=en.get(rr);if(Ir)ji(xt,Nt,Ir);else{var mr=Lr?Lr(zt,rr,Nt+"",xt,mt,en):o,fn=mr===o;if(fn){var cn=yn(rr),Rn=!cn&&Io(rr),kr=!cn&&!Rn&&Yl(rr);mr=rr,cn||Rn||kr?yn(zt)?mr=zt:yi(zt)?mr=Za(zt):Rn?(fn=!1,mr=Uh(rr,!0)):kr?(fn=!1,mr=Hh(rr,!0)):mr=[]:ql(rr)||ia(rr)?(mr=zt,ia(zt)?mr=Rs(zt):vi(zt)&&!po(zt)||(mr=rp(rr))):fn=!1}fn&&(en.set(rr,mr),Sr(mr,rr,Zt,Lr,en),en.delete(rr)),ji(xt,Nt,mr)}})(s,d,Ye,R,Ks,oe,de);else{var nt=oe?oe(Ah(s,Ye),Pe,Ye+"",s,d,de):o;nt===o&&(nt=Pe),ji(s,Ye,nt)}},da)}function $s(s,d){var R=s.length;if(R)return qo(d+=d<0?R:0,R)?s[d]:o}function gr(s,d,R){var oe=-1;return d=Jn(d=d.length?Jn(d,function(de){return yn(de)?function(Pe){return Aa(Pe,de.length===1?de[0]:de)}:de}):[fa],Le(rn())),function(de,Pe){var Ye=de.length;for(de.sort(Pe);Ye--;)de[Ye]=de[Ye].value;return de}(Ys(s,function(de,Pe,Ye){return{criteria:Jn(d,function(nt){return nt(de)}),index:++oe,value:de}}),function(de,Pe){return function(Ye,nt,xt){for(var mt=-1,Nt=Ye.criteria,Zt=nt.criteria,Sr=Nt.length,Lr=xt.length;++mt<Sr;){var en=Wh(Nt[mt],Zt[mt]);if(en)return mt>=Lr?en:en*(xt[mt]=="desc"?-1:1)}return Ye.index-nt.index}(de,Pe,R)})}function uh(s,d,R){for(var oe=-1,de=d.length,Pe={};++oe<de;){var Ye=d[oe],nt=Aa(s,Ye);R(nt,Ye)&&cu(Pe,Es(Ye,s),nt)}return Pe}function Rl(s,d,R,oe){var de=oe?zo:Ai,Pe=-1,Ye=d.length,nt=s;for(s===d&&(d=Za(d)),R&&(nt=Jn(s,Le(R)));++Pe<Ye;)for(var xt=0,mt=d[Pe],Nt=R?R(mt):mt;(xt=de(nt,Nt,xt,oe))>-1;)nt!==s&&qr.call(nt,xt,1),qr.call(s,xt,1);return s}function Qs(s,d){for(var R=s?d.length:0,oe=R-1;R--;){var de=d[R];if(R==oe||de!==Pe){var Pe=de;qo(de)?qr.call(s,de,1):yc(s,de)}}return s}function Pn(s,d){return s+Ui(Dl()*(d-s+1))}function Mo(s,d){var R="";if(!s||d<1||d>E)return R;do d%2&&(R+=s),(d=Ui(d/2))&&(s+=s);while(d);return R}function Nn(s,d){return du(ap(s,d,fa),s+"")}function cu(s,d,R,oe){if(!vi(s))return s;for(var de=-1,Pe=(d=Es(d,s)).length,Ye=Pe-1,nt=s;nt!=null&&++de<Pe;){var xt=ho(d[de]),mt=R;if(xt==="__proto__"||xt==="constructor"||xt==="prototype")return s;if(de!=Ye){var Nt=nt[xt];(mt=oe?oe(Nt,xt,nt):o)===o&&(mt=vi(Nt)?Nt:qo(d[de+1])?[]:{})}br(nt,xt,mt),nt=nt[xt]}return s}var Ss=Er?function(s,d){return Er.set(s,d),s}:fa,mc=Ca?function(s,d){return Ca(s,"toString",{configurable:!0,enumerable:!1,value:js(d),writable:!0})}:fa;function ja(s,d,R){var oe=-1,de=s.length;d<0&&(d=-d>de?0:de+d),(R=R>de?de:R)<0&&(R+=de),de=d>R?0:R-d>>>0,d>>>=0;for(var Pe=rt(de);++oe<de;)Pe[oe]=s[oe+d];return Pe}function Gh(s,d){var R;return Po(s,function(oe,de,Pe){return!(R=d(oe,de,Pe))}),!!R}function gc(s,d,R){var oe=0,de=s==null?oe:s.length;if(typeof d=="number"&&d==d&&de<=2147483647){for(;oe<de;){var Pe=oe+de>>>1,Ye=s[Pe];Ye!==null&&!fo(Ye)&&(R?Ye<=d:Ye<d)?oe=Pe+1:de=Pe}return de}return ch(s,d,fa,R)}function ch(s,d,R,oe){var de=0,Pe=s==null?0:s.length;if(Pe===0)return 0;for(var Ye=(d=R(d))!=d,nt=d===null,xt=fo(d),mt=d===o;de<Pe;){var Nt=Ui((de+Pe)/2),Zt=R(s[Nt]),Sr=Zt!==o,Lr=Zt===null,en=Zt==Zt,zt=fo(Zt);if(Ye)var rr=oe||en;else rr=mt?en&&(oe||Sr):nt?en&&Sr&&(oe||!Lr):xt?en&&Sr&&!Lr&&(oe||!zt):!Lr&&!zt&&(oe?Zt<=d:Zt<d);rr?de=Nt+1:Pe=Nt}return Ii(Pe,4294967294)}function hh(s,d){for(var R=-1,oe=s.length,de=0,Pe=[];++R<oe;){var Ye=s[R],nt=d?d(Ye):Ye;if(!R||!Ka(nt,xt)){var xt=nt;Pe[de++]=Ye===0?0:Ye}}return Pe}function ph(s){return typeof s=="number"?s:fo(s)?_:+s}function Ya(s){if(typeof s=="string")return s;if(yn(s))return Jn(s,Ya)+"";if(fo(s))return mi?mi.call(s):"";var d=s+"";return d=="0"&&1/s==-1/0?"-0":d}function ss(s,d,R){var oe=-1,de=oo,Pe=s.length,Ye=!0,nt=[],xt=nt;if(R)Ye=!1,de=Gs;else if(Pe>=200){var mt=d?null:wh(s);if(mt)return O(mt);Ye=!1,de=ra,xt=new bo}else xt=d?[]:nt;e:for(;++oe<Pe;){var Nt=s[oe],Zt=d?d(Nt):Nt;if(Nt=R||Nt!==0?Nt:0,Ye&&Zt==Zt){for(var Sr=xt.length;Sr--;)if(xt[Sr]===Zt)continue e;d&&xt.push(Zt),nt.push(Nt)}else de(xt,Zt,R)||(xt!==nt&&xt.push(Zt),nt.push(Nt))}return nt}function yc(s,d){return(s=Oh(s,d=Es(d,s)))==null||delete s[ho(Fa(d))]}function dh(s,d,R,oe){return cu(s,d,R(Aa(s,d)),oe)}function ls(s,d,R,oe){for(var de=s.length,Pe=oe?de:-1;(oe?Pe--:++Pe<de)&&d(s[Pe],Pe,s););return R?ja(s,oe?0:Pe,oe?Pe+1:de):ja(s,oe?Pe+1:0,oe?de:Pe)}function co(s,d){var R=s;return R instanceof bn&&(R=R.value()),Ia(d,function(oe,de){return de.func.apply(de.thisArg,wa([oe],de.args))},R)}function Na(s,d,R){var oe=s.length;if(oe<2)return oe?ss(s[0]):[];for(var de=-1,Pe=rt(oe);++de<oe;)for(var Ye=s[de],nt=-1;++nt<oe;)nt!=de&&(Pe[de]=Cs(Pe[de]||Ye,s[nt],d,R));return ss(Wi(Pe,1),d,R)}function fh(s,d,R){for(var oe=-1,de=s.length,Pe=d.length,Ye={};++oe<de;){var nt=oe<Pe?d[oe]:o;R(Ye,s[oe],nt)}return Ye}function mh(s){return yi(s)?s:[]}function gh(s){return typeof s=="function"?s:fa}function Es(s,d){return yn(s)?s:Sh(s,d)?[s]:Dc(Qn(s))}var Wp=Nn;function Os(s,d,R){var oe=s.length;return R=R===o?oe:R,!d&&R>=oe?s:ja(s,d,R)}var zh=_s||function(s){return Fn.clearTimeout(s)};function Uh(s,d){if(d)return s.slice();var R=s.length,oe=$n?$n(R):new s.constructor(R);return s.copy(oe),oe}function yh(s){var d=new s.constructor(s.byteLength);return new Kn(d).set(new Kn(s)),d}function Hh(s,d){var R=d?yh(s.buffer):s.buffer;return new s.constructor(R,s.byteOffset,s.length)}function Wh(s,d){if(s!==d){var R=s!==o,oe=s===null,de=s==s,Pe=fo(s),Ye=d!==o,nt=d===null,xt=d==d,mt=fo(d);if(!nt&&!mt&&!Pe&&s>d||Pe&&Ye&&xt&&!nt&&!mt||oe&&Ye&&xt||!R&&xt||!de)return 1;if(!oe&&!Pe&&!mt&&s<d||mt&&R&&de&&!oe&&!Pe||nt&&R&&de||!Ye&&de||!xt)return-1}return 0}function Jh(s,d,R,oe){for(var de=-1,Pe=s.length,Ye=R.length,nt=-1,xt=d.length,mt=fi(Pe-Ye,0),Nt=rt(xt+mt),Zt=!oe;++nt<xt;)Nt[nt]=d[nt];for(;++de<Ye;)(Zt||de<Pe)&&(Nt[R[de]]=s[de]);for(;mt--;)Nt[nt++]=s[de++];return Nt}function qh(s,d,R,oe){for(var de=-1,Pe=s.length,Ye=-1,nt=R.length,xt=-1,mt=d.length,Nt=fi(Pe-nt,0),Zt=rt(Nt+mt),Sr=!oe;++de<Nt;)Zt[de]=s[de];for(var Lr=de;++xt<mt;)Zt[Lr+xt]=d[xt];for(;++Ye<nt;)(Sr||de<Pe)&&(Zt[Lr+R[Ye]]=s[de++]);return Zt}function Za(s,d){var R=-1,oe=s.length;for(d||(d=rt(oe));++R<oe;)d[R]=s[R];return d}function Wo(s,d,R,oe){var de=!R;R||(R={});for(var Pe=-1,Ye=d.length;++Pe<Ye;){var nt=d[Pe],xt=oe?oe(R[nt],s[nt],nt,R,s):o;xt===o&&(xt=s[nt]),de?ka(R,nt,xt):br(R,nt,xt)}return R}function vc(s,d){return function(R,oe){var de=yn(R)?ao:Js,Pe=d?d():{};return de(R,s,rn(oe,2),Pe)}}function Ll(s){return Nn(function(d,R){var oe=-1,de=R.length,Pe=de>1?R[de-1]:o,Ye=de>2?R[2]:o;for(Pe=s.length>3&&typeof Pe=="function"?(de--,Pe):o,Ye&&Va(R[0],R[1],Ye)&&(Pe=de<3?o:Pe,de=1),d=At(d);++oe<de;){var nt=R[oe];nt&&s(d,nt,oe,Pe)}return d})}function Xh(s,d){return function(R,oe){if(R==null)return R;if(!Da(R))return s(R,oe);for(var de=R.length,Pe=d?de:-1,Ye=At(R);(d?Pe--:++Pe<de)&&oe(Ye[Pe],Pe,Ye)!==!1;);return R}}function Yh(s){return function(d,R,oe){for(var de=-1,Pe=At(d),Ye=oe(d),nt=Ye.length;nt--;){var xt=Ye[s?nt:++de];if(R(Pe[xt],xt,Pe)===!1)break}return d}}function Zh(s){return function(d){var R=mn(d=Qn(d))?ie(d):o,oe=R?R[0]:d.charAt(0),de=R?Os(R,1).join(""):d.slice(1);return oe[s]()+de}}function Il(s){return function(d){return Ia(ks(pl(d).replace(gs,"")),s,"")}}function hu(s){return function(){var d=arguments;switch(d.length){case 0:return new s;case 1:return new s(d[0]);case 2:return new s(d[0],d[1]);case 3:return new s(d[0],d[1],d[2]);case 4:return new s(d[0],d[1],d[2],d[3]);case 5:return new s(d[0],d[1],d[2],d[3],d[4]);case 6:return new s(d[0],d[1],d[2],d[3],d[4],d[5]);case 7:return new s(d[0],d[1],d[2],d[3],d[4],d[5],d[6])}var R=Ci(s.prototype),oe=s.apply(R,d);return vi(oe)?oe:R}}function Kh(s){return function(d,R,oe){var de=At(d);if(!Da(d)){var Pe=rn(R,3);d=Ji(d),R=function(nt){return Pe(de[nt],nt,de)}}var Ye=s(d,R,oe);return Ye>-1?de[Pe?d[Ye]:Ye]:o}}function $h(s){return Jo(function(d){var R=d.length,oe=R,de=En.prototype.thru;for(s&&d.reverse();oe--;){var Pe=d[oe];if(typeof Pe!="function")throw new Un(a);if(de&&!Ye&&pu(Pe)=="wrapper")var Ye=new En([],!0)}for(oe=Ye?oe:R;++oe<R;){var nt=pu(Pe=d[oe]),xt=nt=="wrapper"?Tc(Pe):o;Ye=xt&&Eh(xt[0])&&xt[1]==424&&!xt[4].length&&xt[9]==1?Ye[pu(xt[0])].apply(Ye,xt[3]):Pe.length==1&&Eh(Pe)?Ye[nt]():Ye.thru(Pe)}return function(){var mt=arguments,Nt=mt[0];if(Ye&&mt.length==1&&yn(Nt))return Ye.plant(Nt).value();for(var Zt=0,Sr=R?d[Zt].apply(this,mt):Nt;++Zt<R;)Sr=d[Zt].call(this,Sr);return Sr}})}function xc(s,d,R,oe,de,Pe,Ye,nt,xt,mt){var Nt=d&F,Zt=1&d,Sr=2&d,Lr=24&d,en=512&d,zt=Sr?o:hu(s);return function rr(){for(var Ir=arguments.length,mr=rt(Ir),fn=Ir;fn--;)mr[fn]=arguments[fn];if(Lr)var cn=kl(rr),Rn=function(ii,Fi){for(var Wn=ii.length,ga=0;Wn--;)ii[Wn]===Fi&&++ga;return ga}(mr,cn);if(oe&&(mr=Jh(mr,oe,de,Lr)),Pe&&(mr=qh(mr,Pe,Ye,Lr)),Ir-=Rn,Lr&&Ir<mt){var kr=y(mr,cn);return xh(s,d,xc,rr.placeholder,R,mr,kr,nt,xt,mt-Ir)}var Gr=Zt?R:this,ci=Sr?Gr[s]:s;return Ir=mr.length,nt?mr=function(ii,Fi){for(var Wn=ii.length,ga=Ii(Fi.length,Wn),ya=Za(ii);ga--;){var va=Fi[ga];ii[ga]=qo(va,Wn)?ya[va]:o}return ii}(mr,nt):en&&Ir>1&&mr.reverse(),Nt&&xt<Ir&&(mr.length=xt),this&&this!==Fn&&this instanceof rr&&(ci=zt||hu(ci)),ci.apply(Gr,mr)}}function Qh(s,d){return function(R,oe){return function(de,Pe,Ye,nt){return Ro(de,function(xt,mt,Nt){Pe(nt,Ye(xt),mt,Nt)}),nt}(R,s,d(oe),{})}}function wc(s,d){return function(R,oe){var de;if(R===o&&oe===o)return d;if(R!==o&&(de=R),oe!==o){if(de===o)return oe;typeof R=="string"||typeof oe=="string"?(R=Ya(R),oe=Ya(oe)):(R=ph(R),oe=ph(oe)),de=s(R,oe)}return de}}function vh(s){return Jo(function(d){return d=Jn(d,Le(rn())),Nn(function(R){var oe=this;return s(d,function(de){return di(de,oe,R)})})})}function bc(s,d){var R=(d=d===o?" ":Ya(d)).length;if(R<2)return R?Mo(d,s):d;var oe=Mo(d,ca(s/K(d)));return mn(d)?Os(ie(oe),0,s).join(""):oe.slice(0,s)}function ep(s){return function(d,R,oe){return oe&&typeof oe!="number"&&Va(d,R,oe)&&(R=oe=o),d=ko(d),R===o?(R=d,d=0):R=ko(R),function(de,Pe,Ye,nt){for(var xt=-1,mt=fi(ca((Pe-de)/(Ye||1)),0),Nt=rt(mt);mt--;)Nt[nt?mt:++xt]=de,de+=Ye;return Nt}(d,R,oe=oe===o?d<R?1:-1:ko(oe),s)}}function Mc(s){return function(d,R){return typeof d=="string"&&typeof R=="string"||(d=oi(d),R=oi(R)),s(d,R)}}function xh(s,d,R,oe,de,Pe,Ye,nt,xt,mt){var Nt=8&d;d|=Nt?A:H,4&(d&=~(Nt?H:A))||(d&=-4);var Zt=[s,d,de,Nt?Pe:o,Nt?Ye:o,Nt?o:Pe,Nt?o:Ye,nt,xt,mt],Sr=R.apply(o,Zt);return Eh(s)&&op(Sr,Zt),Sr.placeholder=oe,fu(Sr,s,d)}function _c(s){var d=Rr[s];return function(R,oe){if(R=oi(R),(oe=oe==null?0:Ii(On(oe),292))&&wo(R)){var de=(Qn(R)+"e").split("e");return+((de=(Qn(d(de[0]+"e"+(+de[1]+oe)))+"e").split("e"))[0]+"e"+(+de[1]-oe))}return d(R)}}var wh=jt&&1/O(new jt([,-0]))[1]==g?function(s){return new jt(s)}:Ga;function bh(s){return function(d){var R=Pa(d);return R==N?_l(d):R==M?function(oe){var de=-1,Pe=Array(oe.size);return oe.forEach(function(Ye){Pe[++de]=[Ye,Ye]}),Pe}(d):function(oe,de){return Jn(de,function(Pe){return[Pe,oe[Pe]]})}(d,s(d))}}function us(s,d,R,oe,de,Pe,Ye,nt){var xt=2&d;if(!xt&&typeof s!="function")throw new Un(a);var mt=oe?oe.length:0;if(mt||(d&=-97,oe=de=o),Ye=Ye===o?Ye:fi(On(Ye),0),nt=nt===o?nt:On(nt),mt-=de?de.length:0,d&H){var Nt=oe,Zt=de;oe=de=o}var Sr=xt?o:Tc(s),Lr=[s,d,R,oe,de,Nt,Zt,Pe,Ye,nt];if(Sr&&function(zt,rr){var Ir=zt[1],mr=rr[1],fn=Ir|mr,cn=fn<131,Rn=mr==F&&Ir==8||mr==F&&Ir==P&&zt[7].length<=rr[8]||mr==384&&rr[7].length<=rr[8]&&Ir==8;if(!cn&&!Rn)return zt;1&mr&&(zt[2]=rr[2],fn|=1&Ir?0:4);var kr=rr[3];if(kr){var Gr=zt[3];zt[3]=Gr?Jh(Gr,kr,rr[4]):kr,zt[4]=Gr?y(zt[3],c):rr[4]}(kr=rr[5])&&(Gr=zt[5],zt[5]=Gr?qh(Gr,kr,rr[6]):kr,zt[6]=Gr?y(zt[5],c):rr[6]),(kr=rr[7])&&(zt[7]=kr),mr&F&&(zt[8]=zt[8]==null?rr[8]:Ii(zt[8],rr[8])),zt[9]==null&&(zt[9]=rr[9]),zt[0]=rr[0],zt[1]=fn}(Lr,Sr),s=Lr[0],d=Lr[1],R=Lr[2],oe=Lr[3],de=Lr[4],!(nt=Lr[9]=Lr[9]===o?xt?0:s.length:fi(Lr[9]-mt,0))&&24&d&&(d&=-25),d&&d!=1)en=d==8||d==x?function(zt,rr,Ir){var mr=hu(zt);return function fn(){for(var cn=arguments.length,Rn=rt(cn),kr=cn,Gr=kl(fn);kr--;)Rn[kr]=arguments[kr];var ci=cn<3&&Rn[0]!==Gr&&Rn[cn-1]!==Gr?[]:y(Rn,Gr);return(cn-=ci.length)<Ir?xh(zt,rr,xc,fn.placeholder,o,Rn,ci,o,o,Ir-cn):di(this&&this!==Fn&&this instanceof fn?mr:zt,this,Rn)}}(s,d,nt):d!=A&&d!=33||de.length?xc.apply(o,Lr):function(zt,rr,Ir,mr){var fn=1&rr,cn=hu(zt);return function Rn(){for(var kr=-1,Gr=arguments.length,ci=-1,ii=mr.length,Fi=rt(ii+Gr),Wn=this&&this!==Fn&&this instanceof Rn?cn:zt;++ci<ii;)Fi[ci]=mr[ci];for(;Gr--;)Fi[ci++]=arguments[++kr];return di(Wn,fn?Ir:this,Fi)}}(s,d,R,oe);else var en=function(zt,rr,Ir){var mr=1&rr,fn=hu(zt);return function cn(){return(this&&this!==Fn&&this instanceof cn?fn:zt).apply(mr?Ir:this,arguments)}}(s,d,R);return fu((Sr?Ss:op)(en,Lr),s,d)}function cs(s,d,R,oe){return s===o||Ka(s,dn[R])&&!Jr.call(oe,R)?d:s}function Mh(s,d,R,oe,de,Pe){return vi(s)&&vi(d)&&(Pe.set(d,s),Ks(s,d,o,Mh,Pe),Pe.delete(d)),s}function Jp(s){return ql(s)?o:s}function _h(s,d,R,oe,de,Pe){var Ye=1&R,nt=s.length,xt=d.length;if(nt!=xt&&!(Ye&&xt>nt))return!1;var mt=Pe.get(s),Nt=Pe.get(d);if(mt&&Nt)return mt==d&&Nt==s;var Zt=-1,Sr=!0,Lr=2&R?new bo:o;for(Pe.set(s,d),Pe.set(d,s);++Zt<nt;){var en=s[Zt],zt=d[Zt];if(oe)var rr=Ye?oe(zt,en,Zt,d,s,Pe):oe(en,zt,Zt,s,d,Pe);if(rr!==o){if(rr)continue;Sr=!1;break}if(Lr){if(!Go(d,function(Ir,mr){if(!ra(Lr,mr)&&(en===Ir||de(en,Ir,R,oe,Pe)))return Lr.push(mr)})){Sr=!1;break}}else if(en!==zt&&!de(en,zt,R,oe,Pe)){Sr=!1;break}}return Pe.delete(s),Pe.delete(d),Sr}function Jo(s){return du(ap(s,o,ol),s+"")}function el(s){return fc(s,Ji,Ch)}function tl(s){return fc(s,da,Dh)}var Tc=Er?function(s){return Er.get(s)}:Ga;function pu(s){for(var d=s.name+"",R=kt[d],oe=Jr.call(kt,d)?R.length:0;oe--;){var de=R[oe],Pe=de.func;if(Pe==null||Pe==s)return de.name}return d}function kl(s){return(Jr.call(be,"placeholder")?be:s).placeholder}function rn(){var s=be.iteratee||fl;return s=s===fl?Lo:s,arguments.length?s(arguments[0],arguments[1]):s}function Cc(s,d){var R,oe,de=s.__data__;return((oe=typeof(R=d))=="string"||oe=="number"||oe=="symbol"||oe=="boolean"?R!=="__proto__":R===null)?de[typeof d=="string"?"string":"hash"]:de.map}function Th(s){for(var d=Ji(s),R=d.length;R--;){var oe=d[R],de=s[oe];d[R]=[oe,de,rl(de)]}return d}function As(s,d){var R=function(oe,de){return oe==null?o:oe[de]}(s,d);return Xa(R)?R:o}var Ch=Ts?function(s){return s==null?[]:(s=At(s),So(Ts(s),function(d){return _i.call(s,d)}))}:Ns,Dh=Ts?function(s){for(var d=[];s;)wa(d,Ch(s)),s=Li(s);return d}:Ns,Pa=pa;function tp(s,d,R){for(var oe=-1,de=(d=Es(d,s)).length,Pe=!1;++oe<de;){var Ye=ho(d[oe]);if(!(Pe=s!=null&&R(s,Ye)))break;s=s[Ye]}return Pe||++oe!=de?Pe:!!(de=s==null?0:s.length)&&Ps(de)&&qo(Ye,de)&&(yn(s)||ia(s))}function rp(s){return typeof s.constructor!="function"||Xo(s)?{}:Ci(Li(s))}function qp(s){return yn(s)||ia(s)||!!(li&&s&&s[li])}function qo(s,d){var R=typeof s;return!!(d=d??E)&&(R=="number"||R!="symbol"&&In.test(s))&&s>-1&&s%1==0&&s<d}function Va(s,d,R){if(!vi(R))return!1;var oe=typeof d;return!!(oe=="number"?Da(R)&&qo(d,R.length):oe=="string"&&d in R)&&Ka(R[d],s)}function Sh(s,d){if(yn(s))return!1;var R=typeof s;return!(R!="number"&&R!="symbol"&&R!="boolean"&&s!=null&&!fo(s))||Ue.test(s)||!_t.test(s)||d!=null&&s in At(d)}function Eh(s){var d=pu(s),R=be[d];if(typeof R!="function"||!(d in bn.prototype))return!1;if(s===R)return!0;var oe=Tc(R);return!!oe&&s===oe[0]}(ot&&Pa(new ot(new ArrayBuffer(1)))!=X||Qe&&Pa(new Qe)!=N||Ct&&Pa(Ct.resolve())!=u||jt&&Pa(new jt)!=M||pr&&Pa(new pr)!=J)&&(Pa=function(s){var d=pa(s),R=d==h?s.constructor:o,oe=R?Yo(R):"";if(oe)switch(oe){case Dn:return X;case wr:return N;case Kt:return u;case jn:return M;case tn:return J}return d});var np=_a?po:Ql;function Xo(s){var d=s&&s.constructor;return s===(typeof d=="function"&&d.prototype||dn)}function rl(s){return s==s&&!vi(s)}function ip(s,d){return function(R){return R!=null&&R[s]===d&&(d!==o||s in At(R))}}function ap(s,d,R){return d=fi(d===o?s.length-1:d,0),function(){for(var oe=arguments,de=-1,Pe=fi(oe.length-d,0),Ye=rt(Pe);++de<Pe;)Ye[de]=oe[d+de];de=-1;for(var nt=rt(d+1);++de<d;)nt[de]=oe[de];return nt[d]=R(Ye),di(s,this,nt)}}function Oh(s,d){return d.length<2?s:Aa(s,ja(d,0,-1))}function Ah(s,d){if((d!=="constructor"||typeof s[d]!="function")&&d!="__proto__")return s[d]}var op=nl(Ss),jl=na||function(s,d){return Fn.setTimeout(s,d)},du=nl(mc);function fu(s,d,R){var oe=d+"";return du(s,function(de,Pe){var Ye=Pe.length;if(!Ye)return de;var nt=Ye-1;return Pe[nt]=(Ye>1?"& ":"")+Pe[nt],Pe=Pe.join(Ye>2?", ":" "),de.replace(gt,`{
/* [wrapped with `+Pe+`] */
`)}(oe,function(de,Pe){return Oi(U,function(Ye){var nt="_."+Ye[0];Pe&Ye[1]&&!oo(de,nt)&&de.push(nt)}),de.sort()}(function(de){var Pe=oe.match(We);return Pe?Pe[1].split(Yt):[]}(),R)))}function nl(s){var d=0,R=0;return function(){var oe=Ws(),de=16-(oe-R);if(R=oe,de>0){if(++d>=800)return arguments[0]}else d=0;return s.apply(o,arguments)}}function mu(s,d){var R=-1,oe=s.length,de=oe-1;for(d=d===o?oe:d;++R<d;){var Pe=Pn(R,de),Ye=s[Pe];s[Pe]=s[R],s[R]=Ye}return s.length=d,s}var Dc=function(s){var d=Ul(function(oe){var de=[];return oe.charCodeAt(0)===46&&de.push(""),oe.replace(Rt,function(Pe,Ye,nt,xt){de.push(nt?xt.replace(ct,"$1"):Ye||Pe)}),de},function(oe){return R.size===500&&R.clear(),oe}),R=d.cache;return d}();function ho(s){if(typeof s=="string"||fo(s))return s;var d=s+"";return d=="0"&&1/s==-1/0?"-0":d}function Yo(s){if(s!=null){try{return wn.call(s)}catch{}try{return s+""}catch{}}return""}function Zo(s){if(s instanceof bn)return s.clone();var d=new En(s.__wrapped__,s.__chain__);return d.__actions__=Za(s.__actions__),d.__index__=s.__index__,d.__values__=s.__values__,d}var Nl=Nn(function(s,d){return yi(s)?Cs(s,Wi(d,1,yi,!0)):[]}),il=Nn(function(s,d){var R=Fa(d);return yi(R)&&(R=o),yi(s)?Cs(s,Wi(d,1,yi,!0),rn(R,2)):[]}),gu=Nn(function(s,d){var R=Fa(d);return yi(R)&&(R=o),yi(s)?Cs(s,Wi(d,1,yi,!0),o,R):[]});function al(s,d,R){var oe=s==null?0:s.length;if(!oe)return-1;var de=R==null?0:On(R);return de<0&&(de=fi(oe+de,0)),Gt(s,rn(d,3),de)}function Vl(s,d,R){var oe=s==null?0:s.length;if(!oe)return-1;var de=oe-1;return R!==o&&(de=On(R),de=R<0?fi(oe+de,0):Ii(de,oe-1)),Gt(s,rn(d,3),de,!0)}function ol(s){return s!=null&&s.length?Wi(s,1):[]}function sl(s){return s&&s.length?s[0]:o}var Fl=Nn(function(s){var d=Jn(s,mh);return d.length&&d[0]===s[0]?Ds(d):[]}),yu=Nn(function(s){var d=Fa(s),R=Jn(s,mh);return d===Fa(R)?d=o:R.pop(),R.length&&R[0]===s[0]?Ds(R,rn(d,2)):[]}),sp=Nn(function(s){var d=Fa(s),R=Jn(s,mh);return(d=typeof d=="function"?d:o)&&R.pop(),R.length&&R[0]===s[0]?Ds(R,o,d):[]});function Fa(s){var d=s==null?0:s.length;return d?s[d-1]:o}var vu=Nn(xu);function xu(s,d){return s&&s.length&&d&&d.length?Rl(s,d):s}var lp=Jo(function(s,d){var R=s==null?0:s.length,oe=as(s,d);return Qs(s,Jn(d,function(de){return qo(de,R)?+de:de}).sort(Wh)),oe});function wu(s){return s==null?s:Ne.call(s)}var up=Nn(function(s){return ss(Wi(s,1,yi,!0))}),bu=Nn(function(s){var d=Fa(s);return yi(d)&&(d=o),ss(Wi(s,1,yi,!0),rn(d,2))}),Sc=Nn(function(s){var d=Fa(s);return d=typeof d=="function"?d:o,ss(Wi(s,1,yi,!0),o,d)});function Bl(s){if(!s||!s.length)return[];var d=0;return s=So(s,function(R){if(yi(R))return d=fi(R.length,d),!0}),bs(d,function(R){return Jn(s,qn(R))})}function Ph(s,d){if(!s||!s.length)return[];var R=Bl(s);return d==null?R:Jn(R,function(oe){return di(d,o,oe)})}var Mu=Nn(function(s,d){return yi(s)?Cs(s,d):[]}),_u=Nn(function(s){return Na(So(s,yi))}),cp=Nn(function(s){var d=Fa(s);return yi(d)&&(d=o),Na(So(s,yi),rn(d,2))}),Xp=Nn(function(s){var d=Fa(s);return d=typeof d=="function"?d:o,Na(So(s,yi),o,d)}),Ec=Nn(Bl),Rh=Nn(function(s){var d=s.length,R=d>1?s[d-1]:o;return Ph(s,R=typeof R=="function"?(s.pop(),R):o)});function Lh(s){var d=be(s);return d.__chain__=!0,d}function Tu(s,d){return d(s)}var Gl=Jo(function(s){var d=s.length,R=d?s[0]:0,oe=this.__wrapped__,de=function(Pe){return as(Pe,s)};return!(d>1||this.__actions__.length)&&oe instanceof bn&&qo(R)?((oe=oe.slice(R,+R+(d?1:0))).__actions__.push({func:Tu,args:[de],thisArg:o}),new En(oe,this.__chain__).thru(function(Pe){return d&&!Pe.length&&Pe.push(o),Pe})):this.thru(de)}),Cu=vc(function(s,d,R){Jr.call(s,R)?++s[R]:ka(s,R,1)}),Oc=Kh(al),Vi=Kh(Vl);function Ih(s,d){return(yn(s)?Oi:Po)(s,rn(d,3))}function kh(s,d){return(yn(s)?function(R,oe){for(var de=R==null?0:R.length;de--&&oe(R[de],de,R)!==!1;);return R}:su)(s,rn(d,3))}var hp=vc(function(s,d,R){Jr.call(s,R)?s[R].push(d):ka(s,R,[d])}),Ac=Nn(function(s,d,R){var oe=-1,de=typeof d=="function",Pe=Da(s)?rt(s.length):[];return Po(s,function(Ye){Pe[++oe]=de?di(d,Ye,R):$i(Ye,d,R)}),Pe}),Pc=vc(function(s,d,R){ka(s,R,d)});function Ra(s,d){return(yn(s)?Jn:Ys)(s,rn(d,3))}var Rc=vc(function(s,d,R){s[R?0:1].push(d)},function(){return[[],[]]}),Lc=Nn(function(s,d){if(s==null)return[];var R=d.length;return R>1&&Va(s,d[0],d[1])?d=[]:R>2&&Va(d[0],d[1],d[2])&&(d=[d[0]]),gr(s,Wi(d,1),[])}),gi=Tl||function(){return Fn.Date.now()};function Du(s,d,R){return d=R?o:d,d=s&&d==null?s.length:d,us(s,F,o,o,o,o,d)}function Ko(s,d){var R;if(typeof d!="function")throw new Un(a);return s=On(s),function(){return--s>0&&(R=d.apply(this,arguments)),s<=1&&(d=o),R}}var Ic=Nn(function(s,d,R){var oe=1;if(R.length){var de=y(R,kl(Ic));oe|=A}return us(s,oe,d,R,de)}),kc=Nn(function(s,d,R){var oe=3;if(R.length){var de=y(R,kl(kc));oe|=A}return us(d,oe,s,R,de)});function Su(s,d,R){var oe,de,Pe,Ye,nt,xt,mt=0,Nt=!1,Zt=!1,Sr=!0;if(typeof s!="function")throw new Un(a);function Lr(mr){var fn=oe,cn=de;return oe=de=o,mt=mr,Ye=s.apply(cn,fn)}function en(mr){var fn=mr-xt;return xt===o||fn>=d||fn<0||Zt&&mr-mt>=Pe}function zt(){var mr=gi();if(en(mr))return rr(mr);nt=jl(zt,function(fn){var cn=d-(fn-xt);return Zt?Ii(cn,Pe-(fn-mt)):cn}(mr))}function rr(mr){return nt=o,Sr&&oe?Lr(mr):(oe=de=o,Ye)}function Ir(){var mr=gi(),fn=en(mr);if(oe=arguments,de=this,xt=mr,fn){if(nt===o)return function(cn){return mt=cn,nt=jl(zt,d),Nt?Lr(cn):Ye}(xt);if(Zt)return zh(nt),nt=jl(zt,d),Lr(xt)}return nt===o&&(nt=jl(zt,d)),Ye}return d=oi(d)||0,vi(R)&&(Nt=!!R.leading,Pe=(Zt="maxWait"in R)?fi(oi(R.maxWait)||0,d):Pe,Sr="trailing"in R?!!R.trailing:Sr),Ir.cancel=function(){nt!==o&&zh(nt),mt=0,oe=xt=de=nt=o},Ir.flush=function(){return nt===o?Ye:rr(gi())},Ir}var jc=Nn(function(s,d){return pc(s,1,d)}),zl=Nn(function(s,d,R){return pc(s,oi(d)||0,R)});function Ul(s,d){if(typeof s!="function"||d!=null&&typeof d!="function")throw new Un(a);var R=function(){var oe=arguments,de=d?d.apply(this,oe):oe[0],Pe=R.cache;if(Pe.has(de))return Pe.get(de);var Ye=s.apply(this,oe);return R.cache=Pe.set(de,Ye)||Pe,Ye};return R.cache=new(Ul.Cache||Hi),R}function Hl(s){if(typeof s!="function")throw new Un(a);return function(){var d=arguments;switch(d.length){case 0:return!s.call(this);case 1:return!s.call(this,d[0]);case 2:return!s.call(this,d[0],d[1]);case 3:return!s.call(this,d[0],d[1],d[2])}return!s.apply(this,d)}}Ul.Cache=Hi;var Nc=Wp(function(s,d){var R=(d=d.length==1&&yn(d[0])?Jn(d[0],Le(rn())):Jn(Wi(d,1),Le(rn()))).length;return Nn(function(oe){for(var de=-1,Pe=Ii(oe.length,R);++de<Pe;)oe[de]=d[de].call(this,oe[de]);return di(s,this,oe)})}),Eu=Nn(function(s,d){var R=y(d,kl(Eu));return us(s,A,o,d,R)}),Vc=Nn(function(s,d){var R=y(d,kl(Vc));return us(s,H,o,d,R)}),Ou=Jo(function(s,d){return us(s,P,o,o,o,d)});function Ka(s,d){return s===d||s!=s&&d!=d}var Au=Mc(un),Fc=Mc(function(s,d){return s>=d}),ia=sh(function(){return arguments}())?sh:function(s){return xi(s)&&Jr.call(s,"callee")&&!_i.call(s,"callee")},yn=rt.isArray,Pu=yt?Le(yt):function(s){return xi(s)&&pa(s)==te};function Da(s){return s!=null&&Ps(s.length)&&!po(s)}function yi(s){return xi(s)&&Da(s)}var Io=Ha||Ql,Ru=Vt?Le(Vt):function(s){return xi(s)&&pa(s)==G};function Wl(s){if(!xi(s))return!1;var d=pa(s);return d==T||d=="[object DOMException]"||typeof s.message=="string"&&typeof s.name=="string"&&!ql(s)}function po(s){if(!vi(s))return!1;var d=pa(s);return d==B||d==D||d=="[object AsyncFunction]"||d=="[object Proxy]"}function Lu(s){return typeof s=="number"&&s==On(s)}function Ps(s){return typeof s=="number"&&s>-1&&s%1==0&&s<=E}function vi(s){var d=typeof s;return s!=null&&(d=="object"||d=="function")}function xi(s){return s!=null&&typeof s=="object"}var Iu=Wt?Le(Wt):function(s){return xi(s)&&Pa(s)==N};function Jl(s){return typeof s=="number"||xi(s)&&pa(s)==I}function ql(s){if(!xi(s)||pa(s)!=h)return!1;var d=Li(s);if(d===null)return!0;var R=Jr.call(d,"constructor")&&d.constructor;return typeof R=="function"&&R instanceof R&&wn.call(R)==Ho}var ll=Pr?Le(Pr):function(s){return xi(s)&&pa(s)==v},Xl=Br?Le(Br):function(s){return xi(s)&&Pa(s)==M};function Bc(s){return typeof s=="string"||!yn(s)&&xi(s)&&pa(s)==j}function fo(s){return typeof s=="symbol"||xi(s)&&pa(s)==z}var Yl=ln?Le(ln):function(s){return xi(s)&&Ps(s.length)&&!!Xn[pa(s)]},Yp=Mc(Xs),Zp=Mc(function(s,d){return s<=d});function pp(s){if(!s)return[];if(Da(s))return Bc(s)?ie(s):Za(s);if(ni&&s[ni])return function(R){for(var oe,de=[];!(oe=R.next()).done;)de.push(oe.value);return de}(s[ni]());var d=Pa(s);return(d==N?_l:d==M?O:$o)(s)}function ko(s){return s?(s=oi(s))===g||s===-1/0?17976931348623157e292*(s<0?-1:1):s==s?s:0:s===0?s:0}function On(s){var d=ko(s),R=d%1;return d==d?R?d-R:d:0}function ul(s){return s?uo(On(s),0,k):0}function oi(s){if(typeof s=="number")return s;if(fo(s))return _;if(vi(s)){var d=typeof s.valueOf=="function"?s.valueOf():s;s=vi(d)?d+"":d}if(typeof s!="string")return s===0?s:+s;s=Us(s);var R=ir.test(s);return R||vn.test(s)?is(s.slice(2),R?2:8):Tr.test(s)?_:+s}function Rs(s){return Wo(s,da(s))}function Qn(s){return s==null?"":Ya(s)}var ku=Ll(function(s,d){if(Xo(d)||Da(d))Wo(d,Ji(d),s);else for(var R in d)Jr.call(d,R)&&br(s,R,d[R])}),jh=Ll(function(s,d){Wo(d,da(d),s)}),ju=Ll(function(s,d,R,oe){Wo(d,da(d),s,oe)}),Nu=Ll(function(s,d,R,oe){Wo(d,Ji(d),s,oe)}),Nh=Jo(as),hs=Nn(function(s,d){s=At(s);var R=-1,oe=d.length,de=oe>2?d[2]:o;for(de&&Va(d[0],d[1],de)&&(oe=1);++R<oe;)for(var Pe=d[R],Ye=da(Pe),nt=-1,xt=Ye.length;++nt<xt;){var mt=Ye[nt],Nt=s[mt];(Nt===o||Ka(Nt,dn[mt])&&!Jr.call(s,mt))&&(s[mt]=Pe[mt])}return s}),dp=Nn(function(s){return s.push(o,Mh),di(hl,o,s)});function Gc(s,d,R){var oe=s==null?o:Aa(s,d);return oe===o?R:oe}function cl(s,d){return s!=null&&tp(s,d,lu)}var Ls=Qh(function(s,d,R){d!=null&&typeof d.toString!="function"&&(d=ua.call(d)),s[d]=R},js(fa)),Kp=Qh(function(s,d,R){d!=null&&typeof d.toString!="function"&&(d=ua.call(d)),Jr.call(s,d)?s[d].push(R):s[d]=[R]},rn),fp=Nn($i);function Ji(s){return Da(s)?Ja(s):Ni(s)}function da(s){return Da(s)?Ja(s,!0):function(d){if(!vi(d))return function(Pe){var Ye=[];if(Pe!=null)for(var nt in At(Pe))Ye.push(nt);return Ye}(d);var R=Xo(d),oe=[];for(var de in d)(de!="constructor"||!R&&Jr.call(d,de))&&oe.push(de);return oe}(s)}var zc=Ll(function(s,d,R){Ks(s,d,R)}),hl=Ll(function(s,d,R,oe){Ks(s,d,R,oe)}),Uc=Jo(function(s,d){var R={};if(s==null)return R;var oe=!1;d=Jn(d,function(Pe){return Pe=Es(Pe,s),oe||(oe=Pe.length>1),Pe}),Wo(s,tl(s),R),oe&&(R=qa(R,7,Jp));for(var de=d.length;de--;)yc(R,d[de]);return R}),Vu=Jo(function(s,d){return s==null?{}:function(R,oe){return uh(R,oe,function(de,Pe){return cl(R,Pe)})}(s,d)});function Fu(s,d){if(s==null)return{};var R=Jn(tl(s),function(oe){return[oe]});return d=rn(d),uh(s,R,function(oe,de){return d(oe,de[0])})}var Zl=bh(Ji),Kl=bh(da);function $o(s){return s==null?[]:Eo(s,Ji(s))}var mp=Il(function(s,d,R){return d=d.toLowerCase(),s+(R?$l(d):d)});function $l(s){return dl(Qn(s).toLowerCase())}function pl(s){return(s=Qn(s))&&s.replace(Zr,Oo).replace(Bs,"")}var Is=Il(function(s,d,R){return s+(R?"-":"")+d.toLowerCase()}),Hc=Il(function(s,d,R){return s+(R?" ":"")+d.toLowerCase()}),Wc=Zh("toLowerCase"),Jc=Il(function(s,d,R){return s+(R?"_":"")+d.toLowerCase()}),Bu=Il(function(s,d,R){return s+(R?" ":"")+dl(d)}),Ba=Il(function(s,d,R){return s+(R?" ":"")+d.toUpperCase()}),dl=Zh("toUpperCase");function ks(s,d,R){return s=Qn(s),(d=R?o:d)===o?function(oe){return vs.test(oe)}(s)?function(oe){return oe.match(ys)||[]}(s):function(oe){return oe.match(Or)||[]}(s):s.match(d)||[]}var ps=Nn(function(s,d){try{return di(s,o,d)}catch(R){return Wl(R)?R:new ut(R)}}),Gu=Jo(function(s,d){return Oi(d,function(R){R=ho(R),ka(s,R,Ic(s[R],s))}),s});function js(s){return function(){return s}}var zu=$h(),Uu=$h(!0);function fa(s){return s}function fl(s){return Lo(typeof s=="function"?s:qa(s,1))}var Hu=Nn(function(s,d){return function(R){return $i(R,s,d)}}),$p=Nn(function(s,d){return function(R){return $i(s,R,d)}});function Pi(s,d,R){var oe=Ji(d),de=dc(d,oe);R!=null||vi(d)&&(de.length||!oe.length)||(R=d,d=s,s=this,de=dc(d,Ji(d)));var Pe=!(vi(R)&&"chain"in R&&!R.chain),Ye=po(s);return Oi(de,function(nt){var xt=d[nt];s[nt]=xt,Ye&&(s.prototype[nt]=function(){var mt=this.__chain__;if(Pe||mt){var Nt=s(this.__wrapped__);return(Nt.__actions__=Za(this.__actions__)).push({func:xt,args:arguments,thisArg:s}),Nt.__chain__=mt,Nt}return xt.apply(s,wa([this.value()],arguments))})}),s}function Ga(){}var qc=vh(Jn),Wu=vh(xo),Xc=vh(Go);function ma(s){return Sh(s)?qn(ho(s)):function(d){return function(R){return Aa(R,d)}}(s)}var Yc=ep(),Zc=ep(!0);function Ns(){return[]}function Ql(){return!1}var ml,Kc=wc(function(s,d){return s+d},0),eu=_c("ceil"),_o=wc(function(s,d){return s/d},1),Qp=_c("floor"),gl=wc(function(s,d){return s*d},1),Vh=_c("round"),gp=wc(function(s,d){return s-d},0);return be.after=function(s,d){if(typeof d!="function")throw new Un(a);return s=On(s),function(){if(--s<1)return d.apply(this,arguments)}},be.ary=Du,be.assign=ku,be.assignIn=jh,be.assignInWith=ju,be.assignWith=Nu,be.at=Nh,be.before=Ko,be.bind=Ic,be.bindAll=Gu,be.bindKey=kc,be.castArray=function(){if(!arguments.length)return[];var s=arguments[0];return yn(s)?s:[s]},be.chain=Lh,be.chunk=function(s,d,R){d=(R?Va(s,d,R):d===o)?1:fi(On(d),0);var oe=s==null?0:s.length;if(!oe||d<1)return[];for(var de=0,Pe=0,Ye=rt(ca(oe/d));de<oe;)Ye[Pe++]=ja(s,de,de+=d);return Ye},be.compact=function(s){for(var d=-1,R=s==null?0:s.length,oe=0,de=[];++d<R;){var Pe=s[d];Pe&&(de[oe++]=Pe)}return de},be.concat=function(){var s=arguments.length;if(!s)return[];for(var d=rt(s-1),R=arguments[0],oe=s;oe--;)d[oe-1]=arguments[oe];return wa(yn(R)?Za(R):[R],Wi(d,1))},be.cond=function(s){var d=s==null?0:s.length,R=rn();return s=d?Jn(s,function(oe){if(typeof oe[1]!="function")throw new Un(a);return[R(oe[0]),oe[1]]}):[],Nn(function(oe){for(var de=-1;++de<d;){var Pe=s[de];if(di(Pe[0],this,oe))return di(Pe[1],this,oe)}})},be.conforms=function(s){return function(d){var R=Ji(d);return function(oe){return hc(oe,d,R)}}(qa(s,1))},be.constant=js,be.countBy=Cu,be.create=function(s,d){var R=Ci(s);return d==null?R:cc(R,d)},be.curry=function s(d,R,oe){var de=us(d,8,o,o,o,o,o,R=oe?o:R);return de.placeholder=s.placeholder,de},be.curryRight=function s(d,R,oe){var de=us(d,x,o,o,o,o,o,R=oe?o:R);return de.placeholder=s.placeholder,de},be.debounce=Su,be.defaults=hs,be.defaultsDeep=dp,be.defer=jc,be.delay=zl,be.difference=Nl,be.differenceBy=il,be.differenceWith=gu,be.drop=function(s,d,R){var oe=s==null?0:s.length;return oe?ja(s,(d=R||d===o?1:On(d))<0?0:d,oe):[]},be.dropRight=function(s,d,R){var oe=s==null?0:s.length;return oe?ja(s,0,(d=oe-(d=R||d===o?1:On(d)))<0?0:d):[]},be.dropRightWhile=function(s,d){return s&&s.length?ls(s,rn(d,3),!0,!0):[]},be.dropWhile=function(s,d){return s&&s.length?ls(s,rn(d,3),!0):[]},be.fill=function(s,d,R,oe){var de=s==null?0:s.length;return de?(R&&typeof R!="number"&&Va(s,d,R)&&(R=0,oe=de),function(Pe,Ye,nt,xt){var mt=Pe.length;for((nt=On(nt))<0&&(nt=-nt>mt?0:mt+nt),(xt=xt===o||xt>mt?mt:On(xt))<0&&(xt+=mt),xt=nt>xt?0:ul(xt);nt<xt;)Pe[nt++]=Ye;return Pe}(s,d,R,oe)):[]},be.filter=function(s,d){return(yn(s)?So:qs)(s,rn(d,3))},be.flatMap=function(s,d){return Wi(Ra(s,d),1)},be.flatMapDeep=function(s,d){return Wi(Ra(s,d),g)},be.flatMapDepth=function(s,d,R){return R=R===o?1:On(R),Wi(Ra(s,d),R)},be.flatten=ol,be.flattenDeep=function(s){return s!=null&&s.length?Wi(s,g):[]},be.flattenDepth=function(s,d){return s!=null&&s.length?Wi(s,d=d===o?1:On(d)):[]},be.flip=function(s){return us(s,512)},be.flow=zu,be.flowRight=Uu,be.fromPairs=function(s){for(var d=-1,R=s==null?0:s.length,oe={};++d<R;){var de=s[d];oe[de[0]]=de[1]}return oe},be.functions=function(s){return s==null?[]:dc(s,Ji(s))},be.functionsIn=function(s){return s==null?[]:dc(s,da(s))},be.groupBy=hp,be.initial=function(s){return s!=null&&s.length?ja(s,0,-1):[]},be.intersection=Fl,be.intersectionBy=yu,be.intersectionWith=sp,be.invert=Ls,be.invertBy=Kp,be.invokeMap=Ac,be.iteratee=fl,be.keyBy=Pc,be.keys=Ji,be.keysIn=da,be.map=Ra,be.mapKeys=function(s,d){var R={};return d=rn(d,3),Ro(s,function(oe,de,Pe){ka(R,d(oe,de,Pe),oe)}),R},be.mapValues=function(s,d){var R={};return d=rn(d,3),Ro(s,function(oe,de,Pe){ka(R,de,d(oe,de,Pe))}),R},be.matches=function(s){return Pl(qa(s,1))},be.matchesProperty=function(s,d){return Zs(s,qa(d,1))},be.memoize=Ul,be.merge=zc,be.mergeWith=hl,be.method=Hu,be.methodOf=$p,be.mixin=Pi,be.negate=Hl,be.nthArg=function(s){return s=On(s),Nn(function(d){return $s(d,s)})},be.omit=Uc,be.omitBy=function(s,d){return Fu(s,Hl(rn(d)))},be.once=function(s){return Ko(2,s)},be.orderBy=function(s,d,R,oe){return s==null?[]:(yn(d)||(d=d==null?[]:[d]),yn(R=oe?o:R)||(R=R==null?[]:[R]),gr(s,d,R))},be.over=qc,be.overArgs=Nc,be.overEvery=Wu,be.overSome=Xc,be.partial=Eu,be.partialRight=Vc,be.partition=Rc,be.pick=Vu,be.pickBy=Fu,be.property=ma,be.propertyOf=function(s){return function(d){return s==null?o:Aa(s,d)}},be.pull=vu,be.pullAll=xu,be.pullAllBy=function(s,d,R){return s&&s.length&&d&&d.length?Rl(s,d,rn(R,2)):s},be.pullAllWith=function(s,d,R){return s&&s.length&&d&&d.length?Rl(s,d,o,R):s},be.pullAt=lp,be.range=Yc,be.rangeRight=Zc,be.rearg=Ou,be.reject=function(s,d){return(yn(s)?So:qs)(s,Hl(rn(d,3)))},be.remove=function(s,d){var R=[];if(!s||!s.length)return R;var oe=-1,de=[],Pe=s.length;for(d=rn(d,3);++oe<Pe;){var Ye=s[oe];d(Ye,oe,s)&&(R.push(Ye),de.push(oe))}return Qs(s,de),R},be.rest=function(s,d){if(typeof s!="function")throw new Un(a);return Nn(s,d=d===o?d:On(d))},be.reverse=wu,be.sampleSize=function(s,d,R){return d=(R?Va(s,d,R):d===o)?1:On(d),(yn(s)?function(oe,de){return mu(Za(oe),uo(de,0,oe.length))}:function(oe,de){var Pe=$o(oe);return mu(Pe,uo(de,0,Pe.length))})(s,d)},be.set=function(s,d,R){return s==null?s:cu(s,d,R)},be.setWith=function(s,d,R,oe){return oe=typeof oe=="function"?oe:o,s==null?s:cu(s,d,R,oe)},be.shuffle=function(s){return(yn(s)?function(d){return mu(Za(d))}:function(d){return mu($o(d))})(s)},be.slice=function(s,d,R){var oe=s==null?0:s.length;return oe?(R&&typeof R!="number"&&Va(s,d,R)?(d=0,R=oe):(d=d==null?0:On(d),R=R===o?oe:On(R)),ja(s,d,R)):[]},be.sortBy=Lc,be.sortedUniq=function(s){return s&&s.length?hh(s):[]},be.sortedUniqBy=function(s,d){return s&&s.length?hh(s,rn(d,2)):[]},be.split=function(s,d,R){return R&&typeof R!="number"&&Va(s,d,R)&&(d=R=o),(R=R===o?k:R>>>0)?(s=Qn(s))&&(typeof d=="string"||d!=null&&!ll(d))&&!(d=Ya(d))&&mn(s)?Os(ie(s),0,R):s.split(d,R):[]},be.spread=function(s,d){if(typeof s!="function")throw new Un(a);return d=d==null?0:fi(On(d),0),Nn(function(R){var oe=R[d],de=Os(R,0,d);return oe&&wa(de,oe),di(s,this,de)})},be.tail=function(s){var d=s==null?0:s.length;return d?ja(s,1,d):[]},be.take=function(s,d,R){return s&&s.length?ja(s,0,(d=R||d===o?1:On(d))<0?0:d):[]},be.takeRight=function(s,d,R){var oe=s==null?0:s.length;return oe?ja(s,(d=oe-(d=R||d===o?1:On(d)))<0?0:d,oe):[]},be.takeRightWhile=function(s,d){return s&&s.length?ls(s,rn(d,3),!1,!0):[]},be.takeWhile=function(s,d){return s&&s.length?ls(s,rn(d,3)):[]},be.tap=function(s,d){return d(s),s},be.throttle=function(s,d,R){var oe=!0,de=!0;if(typeof s!="function")throw new Un(a);return vi(R)&&(oe="leading"in R?!!R.leading:oe,de="trailing"in R?!!R.trailing:de),Su(s,d,{leading:oe,maxWait:d,trailing:de})},be.thru=Tu,be.toArray=pp,be.toPairs=Zl,be.toPairsIn=Kl,be.toPath=function(s){return yn(s)?Jn(s,ho):fo(s)?[s]:Za(Dc(Qn(s)))},be.toPlainObject=Rs,be.transform=function(s,d,R){var oe=yn(s),de=oe||Io(s)||Yl(s);if(d=rn(d,4),R==null){var Pe=s&&s.constructor;R=de?oe?new Pe:[]:vi(s)&&po(Pe)?Ci(Li(s)):{}}return(de?Oi:Ro)(s,function(Ye,nt,xt){return d(R,Ye,nt,xt)}),R},be.unary=function(s){return Du(s,1)},be.union=up,be.unionBy=bu,be.unionWith=Sc,be.uniq=function(s){return s&&s.length?ss(s):[]},be.uniqBy=function(s,d){return s&&s.length?ss(s,rn(d,2)):[]},be.uniqWith=function(s,d){return d=typeof d=="function"?d:o,s&&s.length?ss(s,o,d):[]},be.unset=function(s,d){return s==null||yc(s,d)},be.unzip=Bl,be.unzipWith=Ph,be.update=function(s,d,R){return s==null?s:dh(s,d,gh(R))},be.updateWith=function(s,d,R,oe){return oe=typeof oe=="function"?oe:o,s==null?s:dh(s,d,gh(R),oe)},be.values=$o,be.valuesIn=function(s){return s==null?[]:Eo(s,da(s))},be.without=Mu,be.words=ks,be.wrap=function(s,d){return Eu(gh(d),s)},be.xor=_u,be.xorBy=cp,be.xorWith=Xp,be.zip=Ec,be.zipObject=function(s,d){return fh(s||[],d||[],br)},be.zipObjectDeep=function(s,d){return fh(s||[],d||[],cu)},be.zipWith=Rh,be.entries=Zl,be.entriesIn=Kl,be.extend=jh,be.extendWith=ju,Pi(be,be),be.add=Kc,be.attempt=ps,be.camelCase=mp,be.capitalize=$l,be.ceil=eu,be.clamp=function(s,d,R){return R===o&&(R=d,d=o),R!==o&&(R=(R=oi(R))==R?R:0),d!==o&&(d=(d=oi(d))==d?d:0),uo(oi(s),d,R)},be.clone=function(s){return qa(s,4)},be.cloneDeep=function(s){return qa(s,5)},be.cloneDeepWith=function(s,d){return qa(s,5,d=typeof d=="function"?d:o)},be.cloneWith=function(s,d){return qa(s,4,d=typeof d=="function"?d:o)},be.conformsTo=function(s,d){return d==null||hc(s,d,Ji(d))},be.deburr=pl,be.defaultTo=function(s,d){return s==null||s!=s?d:s},be.divide=_o,be.endsWith=function(s,d,R){s=Qn(s),d=Ya(d);var oe=s.length,de=R=R===o?oe:uo(On(R),0,oe);return(R-=d.length)>=0&&s.slice(R,de)==d},be.eq=Ka,be.escape=function(s){return(s=Qn(s))&&Je.test(s)?s.replace(ue,Hs):s},be.escapeRegExp=function(s){return(s=Qn(s))&&Nr.test(s)?s.replace(It,"\\$&"):s},be.every=function(s,d,R){var oe=yn(s)?xo:El;return R&&Va(s,d,R)&&(d=o),oe(s,rn(d,3))},be.find=Oc,be.findIndex=al,be.findKey=function(s,d){return xn(s,rn(d,3),Ro)},be.findLast=Vi,be.findLastIndex=Vl,be.findLastKey=function(s,d){return xn(s,rn(d,3),Al)},be.floor=Qp,be.forEach=Ih,be.forEachRight=kh,be.forIn=function(s,d){return s==null?s:Ol(s,rn(d,3),da)},be.forInRight=function(s,d){return s==null?s:Di(s,rn(d,3),da)},be.forOwn=function(s,d){return s&&Ro(s,rn(d,3))},be.forOwnRight=function(s,d){return s&&Al(s,rn(d,3))},be.get=Gc,be.gt=Au,be.gte=Fc,be.has=function(s,d){return s!=null&&tp(s,d,oh)},be.hasIn=cl,be.head=sl,be.identity=fa,be.includes=function(s,d,R,oe){s=Da(s)?s:$o(s),R=R&&!oe?On(R):0;var de=s.length;return R<0&&(R=fi(de+R,0)),Bc(s)?R<=de&&s.indexOf(d,R)>-1:!!de&&Ai(s,d,R)>-1},be.indexOf=function(s,d,R){var oe=s==null?0:s.length;if(!oe)return-1;var de=R==null?0:On(R);return de<0&&(de=fi(oe+de,0)),Ai(s,d,de)},be.inRange=function(s,d,R){return d=ko(d),R===o?(R=d,d=0):R=ko(R),function(oe,de,Pe){return oe>=Ii(de,Pe)&&oe<fi(de,Pe)}(s=oi(s),d,R)},be.invoke=fp,be.isArguments=ia,be.isArray=yn,be.isArrayBuffer=Pu,be.isArrayLike=Da,be.isArrayLikeObject=yi,be.isBoolean=function(s){return s===!0||s===!1||xi(s)&&pa(s)==Y},be.isBuffer=Io,be.isDate=Ru,be.isElement=function(s){return xi(s)&&s.nodeType===1&&!ql(s)},be.isEmpty=function(s){if(s==null)return!0;if(Da(s)&&(yn(s)||typeof s=="string"||typeof s.splice=="function"||Io(s)||Yl(s)||ia(s)))return!s.length;var d=Pa(s);if(d==N||d==M)return!s.size;if(Xo(s))return!Ni(s).length;for(var R in s)if(Jr.call(s,R))return!1;return!0},be.isEqual=function(s,d){return uu(s,d)},be.isEqualWith=function(s,d,R){var oe=(R=typeof R=="function"?R:o)?R(s,d):o;return oe===o?uu(s,d,o,R):!!oe},be.isError=Wl,be.isFinite=function(s){return typeof s=="number"&&wo(s)},be.isFunction=po,be.isInteger=Lu,be.isLength=Ps,be.isMap=Iu,be.isMatch=function(s,d){return s===d||lh(s,d,Th(d))},be.isMatchWith=function(s,d,R){return R=typeof R=="function"?R:o,lh(s,d,Th(d),R)},be.isNaN=function(s){return Jl(s)&&s!=+s},be.isNative=function(s){if(np(s))throw new ut("Unsupported core-js use. Try https://npms.io/search?q=ponyfill.");return Xa(s)},be.isNil=function(s){return s==null},be.isNull=function(s){return s===null},be.isNumber=Jl,be.isObject=vi,be.isObjectLike=xi,be.isPlainObject=ql,be.isRegExp=ll,be.isSafeInteger=function(s){return Lu(s)&&s>=-9007199254740991&&s<=E},be.isSet=Xl,be.isString=Bc,be.isSymbol=fo,be.isTypedArray=Yl,be.isUndefined=function(s){return s===o},be.isWeakMap=function(s){return xi(s)&&Pa(s)==J},be.isWeakSet=function(s){return xi(s)&&pa(s)=="[object WeakSet]"},be.join=function(s,d){return s==null?"":Ao.call(s,d)},be.kebabCase=Is,be.last=Fa,be.lastIndexOf=function(s,d,R){var oe=s==null?0:s.length;if(!oe)return-1;var de=oe;return R!==o&&(de=(de=On(R))<0?fi(oe+de,0):Ii(de,oe-1)),d==d?function(Pe,Ye,nt){for(var xt=de+1;xt--;)if(Pe[xt]===Ye)return xt;return xt}(s,d):Gt(s,lc,de,!0)},be.lowerCase=Hc,be.lowerFirst=Wc,be.lt=Yp,be.lte=Zp,be.max=function(s){return s&&s.length?os(s,fa,un):o},be.maxBy=function(s,d){return s&&s.length?os(s,rn(d,2),un):o},be.mean=function(s){return Yn(s,fa)},be.meanBy=function(s,d){return Yn(s,rn(d,2))},be.min=function(s){return s&&s.length?os(s,fa,Xs):o},be.minBy=function(s,d){return s&&s.length?os(s,rn(d,2),Xs):o},be.stubArray=Ns,be.stubFalse=Ql,be.stubObject=function(){return{}},be.stubString=function(){return""},be.stubTrue=function(){return!0},be.multiply=gl,be.nth=function(s,d){return s&&s.length?$s(s,On(d)):o},be.noConflict=function(){return Fn._===this&&(Fn._=Ta),this},be.noop=Ga,be.now=gi,be.pad=function(s,d,R){s=Qn(s);var oe=(d=On(d))?K(s):0;if(!d||oe>=d)return s;var de=(d-oe)/2;return bc(Ui(de),R)+s+bc(ca(de),R)},be.padEnd=function(s,d,R){s=Qn(s);var oe=(d=On(d))?K(s):0;return d&&oe<d?s+bc(d-oe,R):s},be.padStart=function(s,d,R){s=Qn(s);var oe=(d=On(d))?K(s):0;return d&&oe<d?bc(d-oe,R)+s:s},be.parseInt=function(s,d,R){return R||d==null?d=0:d&&(d=+d),ki(Qn(s).replace(Qt,""),d||0)},be.random=function(s,d,R){if(R&&typeof R!="boolean"&&Va(s,d,R)&&(d=R=o),R===o&&(typeof d=="boolean"?(R=d,d=o):typeof s=="boolean"&&(R=s,s=o)),s===o&&d===o?(s=0,d=1):(s=ko(s),d===o?(d=s,s=0):d=ko(d)),s>d){var oe=s;s=d,d=oe}if(R||s%1||d%1){var de=Dl();return Ii(s+de*(d-s+xs("1e-"+((de+"").length-1))),d)}return Pn(s,d)},be.reduce=function(s,d,R){var oe=yn(s)?Ia:zs,de=arguments.length<3;return oe(s,rn(d,4),R,de,Po)},be.reduceRight=function(s,d,R){var oe=yn(s)?ta:zs,de=arguments.length<3;return oe(s,rn(d,4),R,de,su)},be.repeat=function(s,d,R){return d=(R?Va(s,d,R):d===o)?1:On(d),Mo(Qn(s),d)},be.replace=function(){var s=arguments,d=Qn(s[0]);return s.length<3?d:d.replace(s[1],s[2])},be.result=function(s,d,R){var oe=-1,de=(d=Es(d,s)).length;for(de||(de=1,s=o);++oe<de;){var Pe=s==null?o:s[ho(d[oe])];Pe===o&&(oe=de,Pe=R),s=po(Pe)?Pe.call(s):Pe}return s},be.round=Vh,be.runInContext=_e,be.sample=function(s){return(yn(s)?Sl:function(d){return Sl($o(d))})(s)},be.size=function(s){if(s==null)return 0;if(Da(s))return Bc(s)?K(s):s.length;var d=Pa(s);return d==N||d==M?s.size:Ni(s).length},be.snakeCase=Jc,be.some=function(s,d,R){var oe=yn(s)?Go:Gh;return R&&Va(s,d,R)&&(d=o),oe(s,rn(d,3))},be.sortedIndex=function(s,d){return gc(s,d)},be.sortedIndexBy=function(s,d,R){return ch(s,d,rn(R,2))},be.sortedIndexOf=function(s,d){var R=s==null?0:s.length;if(R){var oe=gc(s,d);if(oe<R&&Ka(s[oe],d))return oe}return-1},be.sortedLastIndex=function(s,d){return gc(s,d,!0)},be.sortedLastIndexBy=function(s,d,R){return ch(s,d,rn(R,2),!0)},be.sortedLastIndexOf=function(s,d){if(s!=null&&s.length){var R=gc(s,d,!0)-1;if(Ka(s[R],d))return R}return-1},be.startCase=Bu,be.startsWith=function(s,d,R){return s=Qn(s),R=R==null?0:uo(On(R),0,s.length),d=Ya(d),s.slice(R,R+d.length)==d},be.subtract=gp,be.sum=function(s){return s&&s.length?Gi(s,fa):0},be.sumBy=function(s,d){return s&&s.length?Gi(s,rn(d,2)):0},be.template=function(s,d,R){var oe=be.templateSettings;R&&Va(s,d,R)&&(d=o),s=Qn(s),d=ju({},d,oe,cs);var de,Pe,Ye=ju({},d.imports,oe.imports,cs),nt=Ji(Ye),xt=Eo(Ye,nt),mt=0,Nt=d.interpolate||Gn,Zt="__p += '",Sr=Wr((d.escape||Gn).source+"|"+Nt.source+"|"+(Nt===Pt?st:Gn).source+"|"+(d.evaluate||Gn).source+"|$","g"),Lr="//# sourceURL="+(Jr.call(d,"sourceURL")?(d.sourceURL+"").replace(/\s/g," "):"lodash.templateSources["+ ++io+"]")+`
`;s.replace(Sr,function(rr,Ir,mr,fn,cn,Rn){return mr||(mr=fn),Zt+=s.slice(mt,Rn).replace(lt,ba),Ir&&(de=!0,Zt+=`' +
__e(`+Ir+`) +
'`),cn&&(Pe=!0,Zt+=`';
`+cn+`;
__p += '`),mr&&(Zt+=`' +
((__t = (`+mr+`)) == null ? '' : __t) +
'`),mt=Rn+rr.length,rr}),Zt+=`';
`;var en=Jr.call(d,"variable")&&d.variable;if(en){if(Yr.test(en))throw new ut("Invalid `variable` option passed into `_.template`")}else Zt=`with (obj) {
`+Zt+`
}
`;Zt=(Pe?Zt.replace(Re,""):Zt).replace(at,"$1").replace(ze,"$1;"),Zt="function("+(en||"obj")+`) {
`+(en?"":`obj || (obj = {});
`)+"var __t, __p = ''"+(de?", __e = _.escape":"")+(Pe?`, __j = Array.prototype.join;
function print() { __p += __j.call(arguments, '') }
`:`;
`)+Zt+`return __p
}`;var zt=ps(function(){return Lt(nt,Lr+"return "+Zt).apply(o,xt)});if(zt.source=Zt,Wl(zt))throw zt;return zt},be.times=function(s,d){if((s=On(s))<1||s>E)return[];var R=k,oe=Ii(s,k);d=rn(d),s-=k;for(var de=bs(oe,d);++R<s;)d(R);return de},be.toFinite=ko,be.toInteger=On,be.toLength=ul,be.toLower=function(s){return Qn(s).toLowerCase()},be.toNumber=oi,be.toSafeInteger=function(s){return s?uo(On(s),-9007199254740991,E):s===0?s:0},be.toString=Qn,be.toUpper=function(s){return Qn(s).toUpperCase()},be.trim=function(s,d,R){if((s=Qn(s))&&(R||d===o))return Us(s);if(!s||!(d=Ya(d)))return s;var oe=ie(s),de=ie(d);return Os(oe,uc(oe,de),Ms(oe,de)+1).join("")},be.trimEnd=function(s,d,R){if((s=Qn(s))&&(R||d===o))return s.slice(0,pe(s)+1);if(!s||!(d=Ya(d)))return s;var oe=ie(s);return Os(oe,0,Ms(oe,ie(d))+1).join("")},be.trimStart=function(s,d,R){if((s=Qn(s))&&(R||d===o))return s.replace(Qt,"");if(!s||!(d=Ya(d)))return s;var oe=ie(s);return Os(oe,uc(oe,ie(d))).join("")},be.truncate=function(s,d){var R=30,oe="...";if(vi(d)){var de="separator"in d?d.separator:de;R="length"in d?On(d.length):R,oe="omission"in d?Ya(d.omission):oe}var Pe=(s=Qn(s)).length;if(mn(s)){var Ye=ie(s);Pe=Ye.length}if(R>=Pe)return s;var nt=R-K(oe);if(nt<1)return oe;var xt=Ye?Os(Ye,0,nt).join(""):s.slice(0,nt);if(de===o)return xt+oe;if(Ye&&(nt+=xt.length-nt),ll(de)){if(s.slice(nt).search(de)){var mt,Nt=xt;for(de.global||(de=Wr(de.source,Qn(qt.exec(de))+"g")),de.lastIndex=0;mt=de.exec(Nt);)var Zt=mt.index;xt=xt.slice(0,Zt===o?nt:Zt)}}else if(s.indexOf(Ya(de),nt)!=nt){var Sr=xt.lastIndexOf(de);Sr>-1&&(xt=xt.slice(0,Sr))}return xt+oe},be.unescape=function(s){return(s=Qn(s))&&Me.test(s)?s.replace(Ie,me):s},be.uniqueId=function(s){var d=++so;return Qn(s)+d},be.upperCase=Ba,be.upperFirst=dl,be.each=Ih,be.eachRight=kh,be.first=sl,Pi(be,(ml={},Ro(be,function(s,d){Jr.call(be.prototype,d)||(ml[d]=s)}),ml),{chain:!1}),be.VERSION="4.17.21",Oi(["bind","bindKey","curry","curryRight","partial","partialRight"],function(s){be[s].placeholder=be}),Oi(["drop","take"],function(s,d){bn.prototype[s]=function(R){R=R===o?1:fi(On(R),0);var oe=this.__filtered__&&!d?new bn(this):this.clone();return oe.__filtered__?oe.__takeCount__=Ii(R,oe.__takeCount__):oe.__views__.push({size:Ii(R,k),type:s+(oe.__dir__<0?"Right":"")}),oe},bn.prototype[s+"Right"]=function(R){return this.reverse()[s](R).reverse()}}),Oi(["filter","map","takeWhile"],function(s,d){var R=d+1,oe=R==1||R==3;bn.prototype[s]=function(de){var Pe=this.clone();return Pe.__iteratees__.push({iteratee:rn(de,3),type:R}),Pe.__filtered__=Pe.__filtered__||oe,Pe}}),Oi(["head","last"],function(s,d){var R="take"+(d?"Right":"");bn.prototype[s]=function(){return this[R](1).value()[0]}}),Oi(["initial","tail"],function(s,d){var R="drop"+(d?"":"Right");bn.prototype[s]=function(){return this.__filtered__?new bn(this):this[R](1)}}),bn.prototype.compact=function(){return this.filter(fa)},bn.prototype.find=function(s){return this.filter(s).head()},bn.prototype.findLast=function(s){return this.reverse().find(s)},bn.prototype.invokeMap=Nn(function(s,d){return typeof s=="function"?new bn(this):this.map(function(R){return $i(R,s,d)})}),bn.prototype.reject=function(s){return this.filter(Hl(rn(s)))},bn.prototype.slice=function(s,d){s=On(s);var R=this;return R.__filtered__&&(s>0||d<0)?new bn(R):(s<0?R=R.takeRight(-s):s&&(R=R.drop(s)),d!==o&&(R=(d=On(d))<0?R.dropRight(-d):R.take(d-s)),R)},bn.prototype.takeRightWhile=function(s){return this.reverse().takeWhile(s).reverse()},bn.prototype.toArray=function(){return this.take(k)},Ro(bn.prototype,function(s,d){var R=/^(?:filter|find|map|reject)|While$/.test(d),oe=/^(?:head|last)$/.test(d),de=be[oe?"take"+(d=="last"?"Right":""):d],Pe=oe||/^find/.test(d);de&&(be.prototype[d]=function(){var Ye=this.__wrapped__,nt=oe?[1]:arguments,xt=Ye instanceof bn,mt=nt[0],Nt=xt||yn(Ye),Zt=function(Ir){var mr=de.apply(be,wa([Ir],nt));return oe&&Sr?mr[0]:mr};Nt&&R&&typeof mt=="function"&&mt.length!=1&&(xt=Nt=!1);var Sr=this.__chain__,Lr=!!this.__actions__.length,en=Pe&&!Sr,zt=xt&&!Lr;if(!Pe&&Nt){Ye=zt?Ye:new bn(this);var rr=s.apply(Ye,nt);return rr.__actions__.push({func:Tu,args:[Zt],thisArg:o}),new En(rr,Sr)}return en&&zt?s.apply(this,nt):(rr=this.thru(Zt),en?oe?rr.value()[0]:rr.value():rr)})}),Oi(["pop","push","shift","sort","splice","unshift"],function(s){var d=la[s],R=/^(?:push|sort|unshift)$/.test(s)?"tap":"thru",oe=/^(?:pop|shift)$/.test(s);be.prototype[s]=function(){var de=arguments;if(oe&&!this.__chain__){var Pe=this.value();return d.apply(yn(Pe)?Pe:[],de)}return this[R](function(Ye){return d.apply(yn(Ye)?Ye:[],de)})}}),Ro(bn.prototype,function(s,d){var R=be[d];if(R){var oe=R.name+"";Jr.call(kt,oe)||(kt[oe]=[]),kt[oe].push({name:d,func:R})}}),kt[xc(o,2).name]=[{name:"wrapper",func:o}],bn.prototype.clone=function(){var s=new bn(this.__wrapped__);return s.__actions__=Za(this.__actions__),s.__dir__=this.__dir__,s.__filtered__=this.__filtered__,s.__iteratees__=Za(this.__iteratees__),s.__takeCount__=this.__takeCount__,s.__views__=Za(this.__views__),s},bn.prototype.reverse=function(){if(this.__filtered__){var s=new bn(this);s.__dir__=-1,s.__filtered__=!0}else(s=this.clone()).__dir__*=-1;return s},bn.prototype.value=function(){var s=this.__wrapped__.value(),d=this.__dir__,R=yn(s),oe=d<0,de=R?s.length:0,Pe=function(Rn,kr,Gr){for(var ci=-1,ii=Gr.length;++ci<ii;){var Fi=Gr[ci],Wn=Fi.size;switch(Fi.type){case"drop":Rn+=Wn;break;case"dropRight":kr-=Wn;break;case"take":kr=Ii(kr,Rn+Wn);break;case"takeRight":Rn=fi(Rn,kr-Wn)}}return{start:Rn,end:kr}}(0,de,this.__views__),Ye=Pe.start,nt=Pe.end,xt=nt-Ye,mt=oe?nt:Ye-1,Nt=this.__iteratees__,Zt=Nt.length,Sr=0,Lr=Ii(xt,this.__takeCount__);if(!R||!oe&&de==xt&&Lr==xt)return co(s,this.__actions__);var en=[];e:for(;xt--&&Sr<Lr;){for(var zt=-1,rr=s[mt+=d];++zt<Zt;){var Ir=Nt[zt],mr=Ir.iteratee,fn=Ir.type,cn=mr(rr);if(fn==2)rr=cn;else if(!cn){if(fn==1)continue e;break e}}en[Sr++]=rr}return en},be.prototype.at=Gl,be.prototype.chain=function(){return Lh(this)},be.prototype.commit=function(){return new En(this.value(),this.__chain__)},be.prototype.next=function(){this.__values__===o&&(this.__values__=pp(this.value()));var s=this.__index__>=this.__values__.length;return{done:s,value:s?o:this.__values__[this.__index__++]}},be.prototype.plant=function(s){for(var d,R=this;R instanceof tr;){var oe=Zo(R);oe.__index__=0,oe.__values__=o,d?de.__wrapped__=oe:d=oe;var de=oe;R=R.__wrapped__}return de.__wrapped__=s,d},be.prototype.reverse=function(){var s=this.__wrapped__;if(s instanceof bn){var d=s;return this.__actions__.length&&(d=new bn(this)),(d=d.reverse()).__actions__.push({func:Tu,args:[wu],thisArg:o}),new En(d,this.__chain__)}return this.thru(wu)},be.prototype.toJSON=be.prototype.valueOf=be.prototype.value=function(){return co(this.__wrapped__,this.__actions__)},be.prototype.first=be.prototype.head,ni&&(be.prototype[ni]=function(){return this}),be}();De?((De.exports=Te)._=Te,Q._=Te):Fn._=Te}).call(commonjsGlobal)}),MrxDbgUiPrBaseReturn;async function useCanvasResizeListener(b,n,o=100){if(!store.state.MxFun)return void console.error("请先调用loadCoreCode方法! ");if(!b)return void console.error("请确保mxdrawObj参数 是通过调用MxFun.createMxObject的callback回调函数拿到的mxDraw对象");let a=b;if(!a.isLoadCanvasResizeListene){let m;a.isLoadCanvasResizeListene=!0,b.addEvent("addResizeEvent",x=>{m=x}),await dynamicImport("element-resize-event-polyfill");let c=createCanvasParent(n);c.addEventListener?c.addEventListener("resize",lodash.throttle(function(x){m&&m()},o),!1):console.log("mx: parentdiv[addEventListener] invalid")}}class McEdGetPointWorldDrawObject{constructor(){var n;this._McEdGetPointWorldDraw=new((n=store.state.MxFun)===null||n===void 0?void 0:n.getMxJigCmdManager().McEdGetPointWorldDrawObjectClass()),this._get=()=>this._McEdGetPointWorldDraw}drawCircle(n,o){return this._McEdGetPointWorldDraw.drawCircle(n,o)}drawLine(n,o){return this._McEdGetPointWorldDraw.drawLine(n,o)}drawSolid(n,o){this.drawSolid(n,o)}drawRect(n,o){return this._McEdGetPointWorldDraw.drawRect(n,o)}drawEntity(n,o){return this._McEdGetPointWorldDraw.drawEntity(n,o)}drawMcDbEntity(n,o){return this._McEdGetPointWorldDraw.drawMcDbEntity(n,o)}drawMcDbLine(n,o,a,m,c,x){return this._McEdGetPointWorldDraw.drawMcDbLine(n,o,a,m,c,x)}drawText(n,o,a,m){return this._McEdGetPointWorldDraw.drawText(n,o,a,m)}setDraw(n){return this._McEdGetPointWorldDraw.setDraw(n)}setColor(n){return this._McEdGetPointWorldDraw.setColor(n)}getColor(){return this._McEdGetPointWorldDraw.getColor()}drawCustomEntity(n,o){return this._McEdGetPointWorldDraw.drawCustomEntity(n,o)}}(function(b){b[b.kCancel=-2]="kCancel",b[b.kNone=-1]="kNone",b[b.kOk=0]="kOk",b[b.kKeyWord=1]="kKeyWord"})(MrxDbgUiPrBaseReturn||(MrxDbgUiPrBaseReturn={}));var MrxDbgUiPrBaseReturn$1=MrxDbgUiPrBaseReturn,MxCursorType,DynamicInputType,DetailedResult,UserInputControls;(function(b){b[b.kNormal=0]="kNormal",b[b.kRect=1]="kRect",b[b.kCross=2]="kCross"})(MxCursorType||(MxCursorType={})),function(b){b[b.kNoInput=0]="kNoInput",b[b.kXYCoordInput=1]="kXYCoordInput",b[b.kDistanceInput=2]="kDistanceInput",b[b.kDynTip=3]="kDynTip",b[b.kAutoInput=4]="kAutoInput"}(DynamicInputType||(DynamicInputType={})),function(b){b[b.kUnknown=1]="kUnknown",b[b.kTouchDownIn=2]="kTouchDownIn",b[b.kTouchUpIn=3]="kTouchUpIn",b[b.kMouseLeftIn=4]="kMouseLeftIn",b[b.kMouseLeftUpIn=5]="kMouseLeftUpIn",b[b.kMouseRightIn=6]="kMouseRightIn",b[b.kKeyIn=7]="kKeyIn",b[b.kCoordIn=8]="kCoordIn",b[b.kNullEnterIn=9]="kNullEnterIn",b[b.kNullSpaceIn=10]="kNullSpaceIn",b[b.kEcsIn=11]="kEcsIn",b[b.kNewCommadIn=12]="kNewCommadIn",b[b.kCodeAbort=13]="kCodeAbort"}(DetailedResult||(DetailedResult={})),function(b){b[b.kGovernedByOrthoMode=1]="kGovernedByOrthoMode",b[b.kNullResponseAccepted=2]="kNullResponseAccepted",b[b.kDontEchoCancelForCtrlC=4]="kDontEchoCancelForCtrlC",b[b.kDontUpdateLastPoint=8]="kDontUpdateLastPoint",b[b.kNoDwgLimitsChecking=16]="kNoDwgLimitsChecking",b[b.kNoZeroResponseAccepted=32]="kNoZeroResponseAccepted",b[b.kNoNegativeResponseAccepted=64]="kNoNegativeResponseAccepted",b[b.kAccept3dCoordinates=128]="kAccept3dCoordinates",b[b.kAcceptMouseUpAsPoint=256]="kAcceptMouseUpAsPoint",b[b.kAnyBlankTerminatesInput=512]="kAnyBlankTerminatesInput",b[b.kInitialBlankTerminatesInput=1024]="kInitialBlankTerminatesInput",b[b.kAcceptOtherInputString=2048]="kAcceptOtherInputString",b[b.kGovernedByUCSDetect=4096]="kGovernedByUCSDetect",b[b.kNoZDirectionOrtho=8192]="kNoZDirectionOrtho",b[b.kSpacesInAccepted=16384]="kSpacesInAccepted"}(UserInputControls||(UserInputControls={}));class MrxDbgUiPrBase{constructor(n){this.imp=n,this.status=MrxDbgUiPrBaseReturn$1.kCancel}keyWords(){return this.imp.keyWords()}setKeyWords(n){return this.imp.setKeyWords(n)}message(){return this.imp.message()}setMessage(n){return this.imp.setMessage(n)}clearLastInputPoint(){this.imp.clearLastInputPoint()}setLastInputPoint(n){this.imp.SetLASTPOINT(n)}keyWordPicked(){return this.imp.keyWordPicked()}isKeyWordPicked(n){return this.status==MrxDbgUiPrBaseReturn$1.kKeyWord&&this.imp.isKeyWordPicked(n)}setUserDraw(n){if(typeof n!="function")return this.imp.setUserDraw(n._get?n._get():n);{const o=new McEdGetPointWorldDrawObject;o.setDraw(n),this.imp.setUserDraw(o._get())}}getDetailedResult(){return this.imp.getDetailedResult()}getStatus(){return this.status}drawReserve(n){return this.imp.drawReserve(n)}setInputToucheType(n){return this.imp.setInputToucheType(n)}getInputToucheType(){return this.imp.getInputToucheType()}setCursorType(n){this.imp.setCursorType(n)}getCursorType(){return this.imp.getCursorType()}setDynamicInputType(n){this.imp.setDynamicInputType(n)}getDynamicInputType(){return this.imp.getDynamicInputType()}isDisableDynInput(){return this.imp.isDisableDynInput()}setDisableDynInput(n){return this.imp.setDisableDynInput(n)}setDisableOsnap(n){return this.imp.setDisableOsnap(n)}isOffsetInputPostion(){return this.imp.isOffsetInputPostion()}setOffsetInputPostion(n){return this.imp.setOffsetInputPostion(n)}isDisableOsnap(){return this.imp.isDisableOsnap()}setDisableDynamicTrace(n){this.imp.setDisableDynamicTrace(n)}isDisableDynamicTrace(){return this.imp.isDisableDynamicTrace()}setDisablePolarAxisTrace(n){this.imp.setDisablePolarAxisTrace(n)}isDisablePolarAxisTrace(){return this.imp.isDisablePolarAxisTrace()}setDisableGridTrace(n){this.imp.setDisableGridTrace(n)}isDisableGridTrace(){return this.imp.isDisableGridTrace()}setDisableOrthoTrace(n){this.imp.setDisableOrthoTrace(n)}isDisableOrthoTrace(){return this.imp.isDisableOrtho()}disableAllTrace(n=!0){this.imp.disableAllTrace(n)}userInputControls(){return this.imp.userInputControls()}setUserInputControls(n){this.imp.setUserInputControls(n)}}class MrxDbgUiPrPoint extends MrxDbgUiPrBase{constructor(){var n;super(new((n=store.state.MxFun)===null||n===void 0?void 0:n.getMxJigCmdManager().getMrxDbgUiPrPointClass()))}value(){return this.imp.value()}getCADValue(){return this.imp.getCADValue()}valueDocCoord(){return this.imp.valueDocCoord()}basePt(){return this.imp.basePt()}setBasePt(n){return this.imp.setBasePt(n)}setUseBasePt(n){return this.imp.setUseBasePt(n)}go(n){let o=this;return n?(o.imp.go(a=>{o.status=a,n(a)}),new Promise((a,m)=>{a(null)})):new Promise((a,m)=>{o.imp.go(c=>{o.status=c,a(c!=0?null:o.imp.value())})})}goWhile(n,o){return this.imp.goWhile(n,o)}abort(n){this.imp.abort(n)}}class MxVueComandLine{constructor(){this.msCmdText="",this.msCmdDisplay="",this.msCmdTip="",this.mxFunObject=void 0,this.mountUpDisplayFun=n=>{this.mUpDisplayFun=n},this.setCmdText=n=>{this.msCmdText=n},this.getCmdText=()=>this.msCmdText,this.getCmdDisplay=()=>this.msCmdDisplay,this.setCmdDisplay=n=>{this.msCmdDisplay=n},this.addCmdDisplay=n=>{this.msCmdDisplay.length>1024?(this.msCmdDisplay=this.msCmdDisplay.substring(this.msCmdDisplay.length-1024,this.msCmdDisplay.length),this.msCmdDisplay=this.msCmdDisplay+n):this.msCmdDisplay=this.msCmdDisplay+n},this.setCmdTip=n=>{this.msCmdTip=n},this.getCmdTip=()=>this.msCmdTip}upDisplay(){const{msCmdTip:n,msCmdDisplay:o,msCmdText:a}=this;this.mUpDisplayFun!=null&&this.mUpDisplayFun({msCmdTip:n,msCmdDisplay:o,msCmdText:a})}}const MxInputType={kNoInput:0,kXYCoordInput:1,kDistanceInput:2,kDynTip:3},MxInputPostionType={kRelative:0,kAbsolutely:1};class MxDynamicInput{constructor(){this.mType=MxInputType.kNoInput,this.mPos=[0,0],this.mTip="",this.mValue1="",this.mValue1Pos=[0,0],this.mValue2="",this.mValue2Pos=[0,0],this.misShow=!1,this.focusIndex=0,this.mLockValues=new Map,this.mOnKeydownEvent=void 0,this.mFocusValue="",this.setFocusValue=n=>{this.mFocusValue=n},this.getFocusValue=()=>this.mFocusValue,this.getFocusIndex=()=>this.focusIndex,this.setFocusIndex=n=>{this.focusIndex=n},this.mountKeydownEvent=n=>{this.mOnKeydownEvent=n},this.onKeydown=n=>this.mOnKeydownEvent==null?0:this.mOnKeydownEvent(n),this.setType=n=>{this.mType=n},this.getType=()=>this.mType,this.isShow=()=>this.misShow,this.setPos=n=>{this.mPos=n},this.setTip=n=>{this.mTip=n},this.setValue1=n=>{this.mValue1=n},this.getValue1=()=>this.mValue1,this.setValue1Pos=n=>{this.mValue1Pos=n},this.setValue2=n=>{this.mValue2=n},this.getValue2=()=>this.mValue2,this.setValue2Pos=n=>{this.mValue2Pos=n},this.setShow=n=>{this.misShow=n},this.getData=()=>{if(!this.misShow)return;let n={list:[{value:"",readonly:!0},{value:"",readonly:!1},{value:"",readonly:!1}],pos:this.mPos,postype:MxInputPostionType.kRelative};return this.mType!=MxInputType.kNoInput?(this.mType==MxInputType.kXYCoordInput?(n.list[0].show=!0,n.list[0].value=this.mTip,n.list[0].readonly=!0,n.list[1].show=!0,n.list[1].value=this.mValue1,n.list[1].readonly=!1,n.list[2].show=!0,n.list[2].value=this.mValue2,n.list[2].readonly=!1):this.mType==MxInputType.kDistanceInput?(n.list[0].show=!0,n.list[0].value=this.mTip,n.list[0].readonly=!0,n.list[1].show=!0,n.list[1].value=this.mValue1,n.list[1].readonly=!1,n.list[1].pos=this.mValue1Pos,n.list[2].show=!0,n.list[2].value=this.mValue2,n.list[2].readonly=!1,n.list[2].pos=this.mValue2Pos,n.postype=MxInputPostionType.kAbsolutely):this.mType==MxInputType.kDynTip?(n.list[0].show=!0,n.list[0].value=this.mTip,n.list[0].readonly=!0,n.list[1].show=!1,n.list[2].show=!1):n=void 0,n):void 0}}setLockValues(n,o){o.length==0?this.mLockValues.delete(n):this.mLockValues.set(n,o)}getLockValues(n){return this.mLockValues.has(n)?this.mLockValues.get(n):""}getLockValuesMap(){return this.mLockValues}clearLockValuesMap(){this.mLockValues.clear()}}const CursorType={kNormal:"Normal",kRect:"Rect",kCross:"Cross",kPan:"Pan"},RightMenuType={kDefautMenu:1,kCommandRuningMenu:2,kOsnapSetCommandRuningMenu:3};class MxVueInterface{constructor(){this.mSetCoordFun=void 0,this.mUpdateCursorFun=void 0,this.mOnKeydownEvent=void 0,this.mCursorType=CursorType.kNormal,this.mComandLine=new MxVueComandLine,this.mdynamicInput=new MxDynamicInput,this.mMxEvents={},this.mountSetCoordFun=n=>{this.mSetCoordFun=n},this.mountUpdateCursorFun=n=>{this.mUpdateCursorFun=n},this.mountKeydownEvent=n=>{this.mOnKeydownEvent=n},this.onKeydown=n=>{this.mOnKeydownEvent!=null&&this.mOnKeydownEvent(n)},this.mountsetRightMenuSnapTypeFun=n=>{this.mRightMenuSnapTypeFun=n},this.setTipCoord=n=>{this.mSetCoordFun!=null&&this.mSetCoordFun(n)},this.getCursorType=()=>this.mCursorType,this.setCursorType=n=>{if(typeof n=="number")switch(n){case 0:this.mCursorType=CursorType.kNormal;break;case 1:this.mCursorType=CursorType.kRect;break;case 2:this.mCursorType=CursorType.kCross;break;case 3:this.mCursorType=CursorType.kPan}else this.mCursorType=n;this.mUpdateCursorFun!=null&&this.mUpdateCursorFun(this.mCursorType)},this.getTitle=()=>this.mTitle,this.getTopButtonBarData=()=>this.mTopButtonBarData,this.getMenuBarData=()=>this.mMenuBarData,this.getRighButtonBarData=()=>this.mRighButtonBarData,this.getLeftButtonBarData=()=>this.mLeftButtonBarData,this.getTitleButtonBarData=()=>this.mTitleButtonBarData,this.getLayerComboxData=()=>this.mLayerComboxData,this.getColorComboxData=()=>this.mColorComboxData,this.getLinetypeComboxData=()=>this.mLinetypeComboxData,this.getFooterData=()=>this.mFooterData,this.sendStringToExecute=n=>{this.mxFunObject.sendStringToExecute(n)},this.getCmdLine=()=>this.mComandLine,this.getDynamicInput=()=>this.mdynamicInput,this.init=n=>{this.mxFunObject=n},this.OnMxEvent=n=>{const o=n.name;if(o==null)return;const a=this.mMxEvents[o];a!=null&&a(n.param)},this.mountMxEvent=(n,o)=>{this.mMxEvents[n]=o}}setRightMenuOSmodeValue(n){this.mRightMenuSnapTypeFun!=null&&this.mRightMenuSnapTypeFun(n)}executeOperations(n){this.mTsWeb_MxUiVue.executeOperations(n)}mountTsWeb_MxUiVue(n){this.mTsWeb_MxUiVue=n}getRightMenuType(n){let o=MxFun.getRunningCommand();return o?n&&o.isEnableOsnap()?RightMenuType.kOsnapSetCommandRuningMenu:RightMenuType.kCommandRuningMenu:RightMenuType.kDefautMenu}}const mxUiData$1=new MxVueInterface;function createReandomId(b=10){return new Number(Math.random().toString().substr(3,b)+Date.now()).toString(36)}class Node extends PubSub{constructor(){super(...arguments),this.parent=null,this.children=[]}add(...n){if(n.length>1){for(let a=0;a<n.length;a++){const m=n[a];this.add(m)}return this}const o=n[0];return o===this?(console.error("Node.add 不可以添加它自己"),this):(o&&(o.parent!==null&&o.parent.remove(o),o.parent=this,this.children.push(o)),this)}remove(...n){n.length>1&&n.forEach(m=>{this.remove(m)});const o=n[0],a=this.children.indexOf(o);return a!==-1&&(o.parent=null,this.children.splice(a,1)),this}removeFromParent(){const n=this.parent;return n!==null&&n.remove(this),this}clear(){for(let n=0;n<this.children.length;n++)this.children[n].parent=null;return this.children.length=0,this}getNodeByProperty(n,o){if(this[n]===o)return this;for(let a=0,m=this.children.length;a<m;a++){const c=this.children[a].getNodeByProperty(n,o);if(c!==void 0)return c}}getNodesByProperty(n,o){let a=[];this[n]===o&&a.push(this);for(let m=0,c=this.children.length;m<c;m++){const x=this.children[m].getNodesByProperty(n,o);x.length>0&&(a=a.concat(x))}return a}traverse(n){n(this);const o=this.children;for(let a=0,m=o.length;a<m;a++)o[a].traverse(n)}traverseParent(n){this.parent!==null&&n(this.parent)!==!1&&this.parent.traverseParent(n)}emit(n,...o){super.emit(n,...o),this.traverseParent(a=>(a.emit(n,...o),(o==null?void 0:o.isEventBubbling)!==!1&&void 0))}}class RenderOrderNode extends Node{constructor(){super(),this.renderOrder=30}setRenderOrder(n){this.renderOrder=n}getRenderOrder(){return this.renderOrder}top(){var n;if(!this.parent)return;let o=Math.max(...(n=this.parent)===null||n===void 0?void 0:n.children.map(({renderOrder:a})=>a));o!==this.renderOrder&&o++,this.setRenderOrder(o)}bottom(){var n;if(!this.parent)return;let o=Math.min(...(n=this.parent)===null||n===void 0?void 0:n.children.map(({renderOrder:a})=>a));o--,this.setRenderOrder(o)}restoreDefaultRenderOrder(){this.renderOrder=30}}class Layer extends RenderOrderNode{constructor(n){super(),this.isLayer=!0,this.getLayerMap=()=>this.getDatabase()._mxDatabase.mapNameToLayer,this.getEntityMap=()=>this.getDatabase()._mxDatabase.mapIdToEntity,this.getRootLayerName=()=>this.getNames()[0]||"0";const o=typeof n=="string"?n:Date.now()+Math.random().toString(36).substr(2,9);Object.defineProperty(this,"name",{get:()=>o,set(){throw new Error("不能修改Layer.name值, 因为它是Layer 实例的唯一标识")},configurable:!1});let a=this.renderOrder;Object.defineProperty(this,"renderOrder",{get:()=>a,set(m){this.getLayer().group.renderOrder=m,a=m,MxFun.updateDisplay()}})}get visible(){const n=this.getDatabase().getLayer(this.name);return!n||n.getVisible()}set visible(n){this.getDatabase().showLayer(this.name,n),MxFun.updateDisplay()}setVisible(n){this.visible=n}getDatabase(){return this._database||(this._database=MxFun.getCurrentDatabase()),this._database}getLayer(){return this.getDatabase().getLayer(this.name)||this.getDatabase().addLayer(this.name),this.getDatabase().getLayer(this.name)}getCurrentName(){return this.getDatabase()._mxDatabase.curLayer.toString()}async callLayerContextFun(n){const o=this.getCurrentName();this.getDatabase().setCurrentLayer(this.name);const a=await n();return this.getDatabase().setCurrentLayer(o),a}getNames(){return Array.from(this.getLayerMap().keys())}getAllEntity(){return Array.from(this.getEntityMap().values()).filter(({userObject:n})=>n.layer===this.name).map(({userObject:n})=>n)}add(...n){var o;const a=this.getLayer();return a.group.renderOrder!==this.renderOrder&&(a.group.renderOrder=this.renderOrder,this.children=this.getAllEntity()),this.parent||(this.parent=MxFun.getCurrentDraw(),(o=this.parent)===null||o===void 0||o.add(this)),super.add(...n),this.callLayerContextFun(()=>{n.forEach(m=>{m&&this.getDatabase().addEntity(m)})}),this}remove(...n){super.remove(...n);let o=this.getRootLayerName();return this.callLayerContextFun(()=>{n.forEach(a=>{a&&(a.setLayer(o),a.setNeedUpdateDisplay())})}),this}}class MxDbDatabase{constructor(n){this._mxDatabase=n}addLayer(n){return this._mxDatabase.addLayer(n)}showLayer(n,o){this._mxDatabase.showLayer(n,o)}setCurrentLayer(n){return this._mxDatabase.setCurrentLayer(n)}getLayer(n){return this._mxDatabase.getLayer(n)}addEntity(n){return this._mxDatabase.addMxEntity(n)}getGroup(n){return this._mxDatabase.getGroupDictionary().getAt(n)}addGroup(n){return this._mxDatabase.getGroupDictionary().add(n)}getEntityInGroup(n){return this._mxDatabase.getGroupDictionary().getEntityInGroup(n)}deleteGroup(n){return this._mxDatabase.getGroupDictionary().delete(n)}}class MxTempMarkDraw{constructor(n){this.imp=n}clear(){this.imp.clear()}drawLine(n,o,a=16777215,m=1){this.imp.drawLine(n,o,a,m)}drawCircle(n,o,a){this.imp.drawCircle(n,o,a)}drawEntity(n){this.imp.drawEntity(n)}drawCircleMark(n,o,a){this.imp.drawCircleMark(n,o,a)}}function setGeometrPostion(b,n){for(let o=0;o<b.vertices.length;o++)b.vertices[o].x+=n.x,b.vertices[o].y+=n.y,b.vertices[o].z+=n.z}function repairGeometryFaceVertexUvs(b){b.computeBoundingBox();const n=b.boundingBox.min,o=b.boundingBox.max,a=new THREE.Vector2(0-n.x,0-n.y),m=new THREE.Vector2(o.x-n.x,o.y-n.y);b.faceVertexUvs[0]=[];const c=b.faces;for(let x=0;x<c.length;x++){const A=c[x],H=b.vertices[A.a],F=b.vertices[A.b],P=b.vertices[A.c];b.faceVertexUvs[0].push([new THREE.Vector2((H.x+a.x)/m.x,(H.y+a.y)/m.y),new THREE.Vector2((F.x+a.x)/m.x,(F.y+a.y)/m.y),new THREE.Vector2((P.x+a.x)/m.x,(P.y+a.y)/m.y)])}return b.uvsNeedUpdate=!0,b}function insertPointsWithEqualSpacing(b){const n=[];if(b.length<2)return b;let o=Number.MAX_VALUE;for(let a=0;a<b.length-1;a++){const m=b[a].distanceTo(b[a+1]);m<o&&(o=m)}for(let a=0;a<b.length-1;a++){const m=b[a],c=b[a+1];n.push(m);const x=m.distanceTo(c);if(x>o){const A=Math.floor(x/o),H=c.clone().sub(m).normalize();for(let F=1;F<A;F++){const P=m.clone().add(H.clone().multiplyScalar(F*o));n.push(P)}}}return n.push(b[b.length-1]),n}function getToGenerateRoundedCorners(b,n,o=!0){const a=new THREE.CurvePath;if(b.length<2)throw new Error("Points should have at least 2 items");if(!n||n.length===0)return b;!o&&b[0].equals(b[b.length-1])&&b.pop(),o||b.push(b[0]);for(let c=0;c<b.length-1;c++){const x=n[c]||0;if(c===0&&!o){const _=b[0].clone().sub(b[1]);_.normalize();const k=b[1].clone();k.add(_.clone().multiplyScalar(x));const U=new THREE.LineCurve3(b[0],k);a.curves.push(U);continue}const A=!o||b[c-1]?b[c-1].clone().sub(b[c]):b[b.length-1].clone().sub(b[0]);A.normalize();const H=!o||b[c+1]?b[c+1].clone().sub(b[c]):b[1].clone().sub(b[0]);H.normalize();const F=b[c].clone().add(A.clone().multiplyScalar(x)),P=b[c].clone(),g=b[c].clone().add(H.clone().multiplyScalar(x)),E=new THREE.QuadraticBezierCurve3(F,P,g);if(c===b.length-2){const _=b[c].clone().add(H.clone().multiplyScalar(x)),k=b[c+1].clone();o?k.add(H.clone().multiplyScalar(-x)):k.add(H.clone());const U=new THREE.LineCurve3(_,k);a.curves.push(E,U)}else a.curves.push(E);c===0&&b.push(b[0])}let m=a.getPoints();return m=insertPointsWithEqualSpacing(m)}function computeRectPoints(b,n){return[b,b.clone().set(n.x,b.y,n.z),n,n.clone().set(b.x,n.y,b.z)]}function calculateArcOrigin(b,n,o){const a=b.x,m=n.x,c=o.x,x=b.y,A=n.y,H=o.y,F=a-m,P=x-A,g=a-c,E=x-H,_=(a*a-m*m+(x*x-A*A))/2,k=(a*a-c*c+(x*x-H*H))/2,U=P*g-F*E,C=-(E*_-P*k)/U,S=-(F*k-g*_)/U;return new THREE.Vector3(C,S,0)}function calculateRadiusArc(b,n){const o=b.x,a=b.y,m=n.x,c=n.y;return Math.sqrt((o-m)*(o-m)+(a-c)*(a-c))}function calculateArcAngle(b,n,o){const a=b.x,m=n.x;let c,x,A;return c=(b.y-n.y)/o,(x=(a-m)/o)>=.99999&&(x=.99999),x<=-.99999&&(x=-.99999),A=(A=Math.acos(x))/Math.PI*180,c<-.05&&(A=360-A),{sin:c,cos:x,angle:A}}function judgementArcRenderDirection(b,n,o){return(b<n?n-b:n-b+360)>(b<o?o-b:o-b+360)}function createThreePointArc(b,n,o,a=!1,m=!1,c=new THREE.Color("#ff0000")){const x=calculateArcOrigin(b,n,o),A=x.x,H=x.y,F=calculateRadiusArc(b,x),P=calculateArcAngle(b,x,F),g=calculateArcAngle(n,x,F),E=calculateArcAngle(o,x,F);let _,k,U=P.angle,C=g.angle,S=E.angle,Y=judgementArcRenderDirection(U,C,S);m&&(Y=!0),a?(k=new THREE.ArcCurve(A,H,F,THREE.MathUtils.degToRad(U),THREE.MathUtils.degToRad(C),!Y),_=Y?C>U?THREE.MathUtils.radToDeg(k.aEndAngle-k.aStartAngle):360-Math.abs(THREE.MathUtils.radToDeg(k.aEndAngle-k.aStartAngle)):U>C?Math.abs(THREE.MathUtils.radToDeg(k.aEndAngle-k.aStartAngle)):360-THREE.MathUtils.radToDeg(k.aEndAngle-k.aStartAngle)):(k=new THREE.ArcCurve(A,H,F,THREE.MathUtils.degToRad(U),THREE.MathUtils.degToRad(S),Y),_=Y?S>U?360-THREE.MathUtils.radToDeg(k.aEndAngle-k.aStartAngle):Math.abs(THREE.MathUtils.radToDeg(k.aEndAngle-k.aStartAngle)):U>S?360+THREE.MathUtils.radToDeg(k.aEndAngle-k.aStartAngle):THREE.MathUtils.radToDeg(k.aEndAngle-k.aStartAngle));const G=_*Math.PI*F/180,T=new THREE.BufferGeometry().setFromPoints(k.getPoints(50)),B=new THREE.LineBasicMaterial({color:c});return{arc:new THREE.Line(T,B),radius:F,angle:_,arcLength:G}}function computeRegularPolygonVertices(b=new THREE.Vector3,n=new THREE.Vector3,o=3){const a=[];o=Math.max(3,o),a.push(n);const m=2*Math.PI/o;for(let c=1;c<o;c++){const x=Math.cos(m*c),A=Math.sin(m*c),H=b.clone(),F=n.clone(),P=F.x-H.x,g=F.y-H.y,E=new THREE.Vector3(P*x-g*A+H.x,P*A+g*x+H.y);a.push(E)}return a}function computeBounding(b){if(b.length==0){let n=new THREE.Vector3;return{centerPoint:n,minPoint:n,maxPoint:n}}{let n=new THREE.Vector3(b[0].x,b[0].y,b[0].z||0),o=new THREE.Vector3(b[0].x,b[0].y,b[0].z||0),a=b.length;for(let m=1;m<a;m++){let c=b[m];n.x>c.x&&(n.x=c.x),n.y>c.y&&(n.y=c.y),o.x<c.x&&(o.x=c.x),o.y<c.y&&(o.y=c.y)}return{centerPoint:new THREE.Vector3(n.x+.5*(o.x-n.x),n.y+.5*(o.y-n.y),0),minPoint:n,maxPoint:o}}}function MxThreeJSMixin(b){return b.createImage=function(n,o,a,m,c){if(!c)return new Promise((x,A)=>{b.createImage.call(this,n,o,a,m,H=>x(H))});new THREE.TextureLoader().load(m,function(x){let A=new THREE.PlaneGeometry(o,a),H=new THREE.MeshLambertMaterial({map:x,transparent:!0,side:THREE.DoubleSide});H.map&&(H.map.needsUpdate=!0),setGeometrPostion(A,n);let F=new THREE.Mesh(A,H);F.material.depthTest=!1,c&&c(F)},void 0,function(x){console.log(x),c&&c(null)})},b.loadSVG=function(n,o,a,m){return a?(store.state.MxFun.loadSVG(n,o,a,m),new Promise(c=>{c(null)})):new Promise(c=>{store.state.MxFun.loadSVG(n,o,x=>{c(x)},m)})},b.clacTextSize=(n,o)=>store.state.MxFun.getMxThreeJS().clacTextSize(n,o),b.clacTextSpriteSize=(n,o,a)=>store.state.MxFun.getMxThreeJS().clacTextSpriteSize(n,o,a),b.creatTextSprite=(n,o,a,m,c)=>n.length===0?null:(c instanceof Object?c.getHex&&(c=c.getHex()):typeof c=="string"&&(c=parseInt(c)),store.state.MxFun.getMxThreeJS().creatTextSprite(n,o,a,m,c)),b}class MxThreeJS$1{createLine(n,o,a){const m=new THREE.Geometry,c=new THREE.LineBasicMaterial({color:a});return m.vertices.push(n,o),new THREE.Line(m,c)}createCircle(n,o,a){const m=new THREE.CircleGeometry(o,64,3,2*Math.PI),c=new THREE.LineBasicMaterial({color:a});m.vertices.shift();const x=new THREE.LineLoop(m,c),{x:A,y:H,z:F}=n;return x.position.set(A,H,F),x}createPoint(n,o,a=3){const m=new THREE.Geometry;m.vertices.push(n);const c=new THREE.PointsMaterial({color:o,size:a});return new THREE.Points(m,c)}createTriangle(n,o,a=1){if(n.length<3)return null;const m=n.length,c=new THREE.Geometry;for(let A=0;A+2<m;A+=3){c.vertices.push(n[A]),c.vertices.push(n[A+1]),c.vertices.push(n[A+2]);const H=new THREE.Face3(A,A+1,A+2);c.faces.push(H)}c.computeFaceNormals(),c.computeVertexNormals();const x=new THREE.MeshBasicMaterial({color:o,transparent:!0,depthTest:!1,side:THREE.DoubleSide,opacity:a});return new THREE.Mesh(c,x)}createLines(n,o){const a=new THREE.Geometry;a.vertices=n;const m=new THREE.LineBasicMaterial({color:o});return new THREE.Line(a,m)}createDashedLines(n,o,a,m){const c=new THREE.Geometry;c.vertices=n;const x=new THREE.Line(c,new THREE.LineDashedMaterial({color:o,dashSize:a,gapSize:m}));return x.computeLineDistances(),x}}const MxThreeJS=MxThreeJSMixin(new MxThreeJS$1);class MxDrawObject extends Node{constructor(n){super(),this.rootLayer=new Layer(n.m_mxDatabase.curLayer),this.add(this.rootLayer),this._mxdrawObj=n}getMxObjectImplement(){return this._mxdrawObj}getScene(){return this._mxdrawObj.getScene()}setMultipleSelect(n){this._mxdrawObj.isMultipleSelect=n}isMapBox(){return this._mxdrawObj.isMapBox()}getCamera(){return this._mxdrawObj.getCamera()}getRenderer(){return this._mxdrawObj.getRenderer()}setMouseRightRotate(n=!0){return this._mxdrawObj.setMouseRightRotate(n)}getFullDisplayRange(){return this._mxdrawObj.getFullDisplayRange()}getCanvas(){return this._mxdrawObj.getCanvas()}updateDisplay(n=!1){return this._mxdrawObj.updateDisplay(n)}createCanvasImageData(n,o){return this._mxdrawObj.createCanvasImageData(n,o)}setViewColor(n){return this._mxdrawObj.setViewColor(n)}getViewColor(){return this._mxdrawObj.getViewColor()}setSize(n,o){return this._mxdrawObj.setSize(n,o)}getIntersectObjects(n){return this._mxdrawObj.getIntersectObjects(n)}addObject(n,o=!0){return this._mxdrawObj.addObject(n,o)}addViewObject(n){return this._mxdrawObj.addViewObject(n)}getViewWidth(){return this._mxdrawObj.getViewWidth()}getViewHeight(){return this._mxdrawObj.getViewHeight()}removeObject(n,o=!0){return this._mxdrawObj.removeObject(n,o)}zoomInitialStates(){return this._mxdrawObj.zoomInitialStates()}zoomScale(n){return this._mxdrawObj.zoomScale(n)}zoomW(n,o,a,m,c){return this._mxdrawObj.zoomW(n,o,a,m,c)}saveZoom(){return this._mxdrawObj.saveZoom()}recoverZoom(){return this._mxdrawObj.recoverZoom()}zoomCenter(n,o){return this._mxdrawObj.zoomCenter(n,o)}initZoomW(n,o){return this._mxdrawObj.initZoomW(n,o)}addEvent(n,o){return this._mxdrawObj.addEvent(n,o)}on(n,o){return super.on(n,o),this._mxdrawObj.addEvent(n,o)}off(n,o){return super.off(n,o),this.removeEventFuction(n,o)}removeEventFuction(n,o){return this._mxdrawObj.removeEventFuction(n,o)}setIniset(n){return this._mxdrawObj.setIniset(n)}getViewDocCoord(){return this._mxdrawObj.getViewDocCoord()}screenCoord2World(n,o,a){return this._mxdrawObj.screenCoord2World(n,o,a)}worldCoord2Screen(n,o,a){return this._mxdrawObj.worldCoord2Screen(n,o,a)}screenCoord2Doc(n,o){return this._mxdrawObj.screenCoord2Doc(n,o,0)}worldCoordLong2Doc(n){return this._mxdrawObj.worldCoordLong2Doc(n)}docCoordLong2World(n){return this._mxdrawObj.docCoordLong2World(n)}docCoord2World(n,o,a){return this._mxdrawObj.docCoord2World(n,o,a)}docCoord2World2(n){return this._mxdrawObj.docCoord2World(n.x,n.y,n.z)}worldCoord2Doc(n,o,a){return this._mxdrawObj.worldCoord2Doc(n,o,a)}worldCoord2Doc2(n){return this._mxdrawObj.worldCoord2Doc(n.x,n.y,n.z)}docCoord2Screen(n,o){return this._mxdrawObj.docCoord2Screen(n,o,0)}screenCoordLong2Doc(n){return this._mxdrawObj.screenCoordLong2Doc(n)}docCoordLong2Screen(n){return this._mxdrawObj.docCoordLong2Screen(n)}screenCoordLong2World(n){return this._mxdrawObj.screenCoordLong2World(n)}worldCoordLong2Screen(n){return this._mxdrawObj.worldCoordLong2Screen(n)}initRendererParam(n){return this._mxdrawObj.initRendererParam(n)}addMxEntity(n){return this.rootLayer.add(n),n.objectId()}getMxCurrentSelect(){let n=this._mxdrawObj.getMxAllSelect();return n.length==0&&(n=this._mxdrawObj.getPrvCommandSelect()),n}getMxCADCurrentSelect(){let n=this._mxdrawObj.getMxCADAllSelect();return n.length==0&&(n=this._mxdrawObj.getPrvCommandMxCADSelect()),n}getSelectPoints(){return this._mxdrawObj.getSelectPoints()}addMxCurrentSelect(n,o=!0,a=!0){return this._mxdrawObj.addMxCurrentSelect(n,o,a)}addMxCADCurrentSelect(n,o=!0,a=!0){return this._mxdrawObj.addMxCADCurrentSelect(n,o,a)}fireSelectChange(n){this._mxdrawObj.fireSelectChange(n)}clearMxCurrentSelect(){return this._mxdrawObj.clearMxCurrentSelect()}getMxEntity(n){return this._mxdrawObj.getMxEntityUserObject(n)}findMxEntityAtPoint(n,o,a){return this._mxdrawObj.findMxEntityAtPoint(n,o,a)}getAllMxEntity(){return this._mxdrawObj.getAllMxEntity()}setViewMovementMethod(n){return this._mxdrawObj.setMouseMiddlePan(n)}setMouseMiddlePan(n){return this._mxdrawObj.setMouseMiddlePan(n)}resetThreeJSControls(){return this._mxdrawObj.resetThreeJSControls()}enableZoom(n){return this._mxdrawObj.enableZoom(n)}enablePan(n){return this._mxdrawObj.enablePan(n)}eraseMxEntity(n){return this._mxdrawObj.eraseMxEntity(n)}removeViewObject(n){this._mxdrawObj.removeViewObject(n)}saveMxEntityToJson(n){return JSON.stringify(this._mxdrawObj.saveMxEntityToJson(n))}saveMxEntityToObject(n){return this._mxdrawObj.saveMxEntityToJson(n)}async loadMxEntityFromJson(n,o=null){if(o){let a=o.length;for(let m=0;m<a;m++)await MxThreeJS.loadSVG(o[m])}return this.getAllMxEntity().forEach(a=>{for(let m in a)Reflect.deleteProperty(a,m)}),typeof n=="string"?this._mxdrawObj.loadMxEntityFromJson(JSON.parse(n)):this._mxdrawObj.loadMxEntityFromJson(n)}eraseAllMxEntity(){return this._mxdrawObj.eraseAllMxEntity()}makeCurrent(){this._mxdrawObj.makeCurrent()}getViewCenterDocCoord(){return this._mxdrawObj.getViewCenterDocCoord()}updateCanvasSize(){this._mxdrawObj.updateCanvasSize()}newFile(n,o,a,m){return this._mxdrawObj.newFile(n,o,a,m)}stopAllLoading(){this._mxdrawObj.stopAllLoading()}getOrbitControls(){return this._mxdrawObj.getOrbitControls()}enableViewControls(n){return this._mxdrawObj.enableViewControls(n)}getMxDatabase(){return new MxDbDatabase(this._mxdrawObj.getMxDatabase())}getTempMarkDraw(){return new MxTempMarkDraw(this._mxdrawObj.getTempMarkDraw())}setZoomSpeed(n){return this._mxdrawObj.setZoomSpeed(n)}resetRenderer(){return this._mxdrawObj.resetRenderer()}setRequestHeader(n){return this._mxdrawObj.setRequestHeader(n)}closeWebSocket(){return this._mxdrawObj.closeWebSocket()}cadCoord2Doc(n,o,a){return this._mxdrawObj.cadCoord2Doc(n,o,a)}cadCoord2Doc2(n){return this._mxdrawObj.cadCoord2Doc2(n)}toSmallcoord(n){return this._mxdrawObj.toSmallcoord(n)}toSmallcoord2(n,o,a=0){return this._mxdrawObj.toSmallcoord2(n,o,a)}docCoord2Cad(n,o,a){return this._mxdrawObj.docCoord2Cad(n,o,a)}docCoord2Cad2(n){return this._mxdrawObj.docCoord2Cad2(n)}viewCoord2Cad(n,o,a){return this._mxdrawObj.viewCoord2Cad(n,o,a)}cadCoord2View(n,o,a){return this._mxdrawObj.cadCoord2View(n,o,a)}cadCoordLong2View(n){return this._mxdrawObj.cadCoordLong2View(n)}viewCoordLong2Cad(n){return this._mxdrawObj.viewCoordLong2Cad(n)}docCoordLong2Cad(n){return this._mxdrawObj.docCoordLong2Cad(n)}cadCoordLong2Doc(n){return this._mxdrawObj.cadCoordLong2Doc(n)}setViewAngle(n){return this._mxdrawObj.setViewAngle(n)}getViewAngle(){return this._mxdrawObj.getViewAngle()}getSysVar(n){return this._mxdrawObj.sysVariable().getSysVar()}setSysVar(n,o){return this._mxdrawObj.sysVariable().setSysVar(n,o)}isMxCAD(){return this._mxdrawObj.isCppMxCAD()}getAllLayoutName(){return this._mxdrawObj.getAllLayoutName()}getDtabaseJsonString(){return this._mxdrawObj.getDtabaseJsonString()}gotoLayout(n){return this._mxdrawObj.gotoLayout(n)}initMxCpp(n){return this._mxdrawObj.initMxCpp(n)}isWebgl2(){return this._mxdrawObj.isWebgl2()}getId(){return this._mxdrawObj.getId()}addControlsEvent(n,o,a=!1){return this._mxdrawObj.addControlsEvent(n,o,a)}clearAllObject(){return this.rootLayer.clear(),this._mxdrawObj.clearAllObject()}setPointMultipleSelect(n=!0){return this._mxdrawObj.setPointMultipleSelect(n)}isWhiteViewColor(){return this._mxdrawObj.isWhiteViewColor()}automaticInversionColor(n){return this._mxdrawObj.automaticInversionColor(n)}renderLoop(n=!0){return this._mxdrawObj.renderLoop(n)}}const initEvents=b=>{let n=[];["click","mousedown","mouseup"].forEach(o=>{b.addEventListener(o,()=>{n.forEach(a=>{a.emit(o)})})}),b.addEventListener("mousemove",()=>{const o=MxFun.getCurrentDraw().findMxEntityAtPoint(MxFun.getCurrentMousePostion(),!1);o.forEach(a=>{a.emit("mousemove")}),o.length===0&&(n.length>0&&n.forEach(a=>{a.emit("mouseout")}),n=[]),n.length===0&&(n=o).forEach(a=>{a.emit("mouseover"),a.emit("hover")})})};function createMxObject({canvasId:b=createReandomId(),cadFile:n="",callback:o,isNewFile:a=!1,useWebsocket:m=!1,isAutoResize:c=!0,mapBox:x,isMxCAD:A=!1,userIdentitySign:H="emptyUserIdentity",isCPPMxCAD:F=!1}){if(this.initUiDataObject(mxUiData$1),!m&&a&&(a=!1),x)if(F){const P=x.canvas;store.state.MxFun.createMxObject(P,"",E=>{let _=new MxDrawObject(E);E.setMouseRightRotate(!1),E.setIniset({EnableOsnapFunction:!0}),o&&o(_,{canvas:P,canvasParent:void 0})},!0,!1,!1,x,F)}else{const P=x.canvas;store.state.MxFun.createMxObject(P,n,g=>{let E=new MxDrawObject(g);g.setIniset({EnableOsnapFunction:!0}),o&&o(E,{canvas:P,canvasParent:void 0})},void 0,a,m,x)}else if(F){const P=createCanvas(b),g=createCanvasParent(P);g.parentNode&&g.parentNode.nodeType!=11||document.body.appendChild(g),store.state.MxFun.createMxObject(b,"",_=>{let k=new MxDrawObject(_);_.setMouseRightRotate(!1),_.setIniset({EnableOsnapFunction:!0}),_.addEvent("onResize",()=>(g.tabindex=3,{width:g.clientWidth,height:g.clientHeight})),c&&useCanvasResizeListener(k,P),o&&o(k,{canvas:P,canvasParent:g})},!0,!1,!1,void 0,F)}else{const P=createCanvas(b),g=createCanvasParent(P);let E;g.parentNode&&g.parentNode.nodeType!=11||document.body.appendChild(g),A&&(E=!0,m=!0),store.state.MxFun.createMxObject(b,n,_=>{let k=new MxDrawObject(_);A&&(H.length==0&&(H="invalidUserIdentity"),_.initRunMode(2),_.initUserLoginData(H,"")),_.setMouseRightRotate(!1),_.setIniset({EnableOsnapFunction:!0}),_.addEvent("onResize",()=>(g.tabindex=3,{width:g.clientWidth,height:g.clientHeight})),c&&useCanvasResizeListener(k,P),initEvents(P),o&&o(k,{canvas:P,canvasParent:g})},E,a,m,void 0)}}let mxUiData=mxUiData$1,mxFunSyncInitialization;class MxFunClass{constructor(){this.createMxObject=createMxObject,this.getMxFunTHREE=()=>store.state.MxFun.getTHREE()}setMxServer(n="ws://localhost:5090"){store.state.MxFun.setMxServer(n)}setloadImageFuction(n){store.state.MxFun.setloadImageFuction(n)}onInitSync(n){mxFunSyncInitialization=n}callSyncInitialization(){return mxFunSyncInitialization!=null?mxFunSyncInitialization():new Promise(n=>{n(!0)})}screenCoord2Doc(n,o){return store.state.MxFun.screenCoord2Doc(n,o,0)}docCoord2Screen(n,o){return store.state.MxFun.docCoord2Screen(n,o,0)}getCurrentDraw(){const n=store.state.MxFun.getCurrentDraw();return n.tmp||(n.tmp=new MxDrawObject(n)),n.tmp}addToCurrentSpace(n){return MxFun.getCurrentDraw().addMxEntity(n)}initUiDataObject(n){return mxUiData=n,store.state.MxFun.initUiDataObject(n)}getUIData(){return mxUiData}getCurrentDatabase(){return MxFun.getCurrentDraw().getMxDatabase()}testMX(n){return 11}loadImageMaterial(n,o){return o?(store.state.MxFun.loadImageMaterial(n,o),new Promise((a,m)=>{a(null)})):new Promise((a,m)=>{store.state.MxFun.loadImageMaterial(n,c=>{a(c||null)})})}selectEnt(n,o=null){return new Promise((a,m)=>{const c=new MrxDbgUiPrPoint;c.setMessage(n),c.go(x=>{if(x!=0)return void a(0);const A=c.value();let H=MxFun.getCurrentDraw().findMxEntityAtPoint(A),F=0;for(;H.length!=0;){let P=H.length;for(let g=0;g<P;g++){let E=H[g];if(!o||!o.type||o.type==E.getTypeName()){F=E.objectId();break}}break}a(F)})})}listenForCommandLineInput(n){mxUiData.getCmdLine().mountUpDisplayFun(n)}setCommandLineInputData(n,o){mxUiData.getCmdLine().setCmdText(n),mxUiData.onKeydown(o)}listenForCoordTip(n){mxUiData.mountSetCoordFun(n)}listenForUpdateCursor(n){mxUiData.mountUpdateCursorFun(n)}getMxFunThreeTool(){return store.state.MxFun.getMxThreeJS()}ceneratecursor(n=128,o=10,a=!0,m){return store.state.MxFun.ceneratecursor(n,o,a,m)}getCurrentMousePostion(){let n=store.state.MxFun.getCurrentMousePostion();return new THREE.Vector3(n.x,n.y,0)}onUseCreateMxDbEntity(n){store.events.on("use:create:MxDbEntity",n)}}const _MxFun=new MxFunClass,MxFun=new Proxy({},{get:(b,n)=>typeof _MxFun[n]=="function"?_MxFun[n].bind(_MxFun):store.state.MxFun[n]});var MxCloneType,MxCommandFlag,MxDefaultRenderOrder,InputToucheType;(function(b){b[b.kClone=1]="kClone",b[b.kDragClone=2]="kDragClone",b[b.kMxFileClone=3]="kMxFileClone",b[b.kSaveDwgClone=4]="kSaveDwgClone"})(MxCloneType||(MxCloneType={})),function(b){b[b.MCRX_CMD_MODAL=0]="MCRX_CMD_MODAL",b[b.MCRX_CMD_TRANSPARENT=1]="MCRX_CMD_TRANSPARENT",b[b.MCRX_CMD_NO_UNDO_MARKER=2]="MCRX_CMD_NO_UNDO_MARKER",b[b.MCRX_CMD_NOPRV=4]="MCRX_CMD_NOPRV",b[b.MCRX_CMD_NO_RECORD_PRVCMD=8]="MCRX_CMD_NO_RECORD_PRVCMD",b[b.MCRX_CMD_NO_CLEAR_SELECT=16]="MCRX_CMD_NO_CLEAR_SELECT",b[b.MCRX_CMD_NO_CLEAR_SELECT_GRIP_POINT=32]="MCRX_CMD_NO_CLEAR_SELECT_GRIP_POINT"}(MxCommandFlag||(MxCommandFlag={})),function(b){b[b.kCADMeshRenderOrder=10]="kCADMeshRenderOrder",b[b.kCADCurveRenderOrder=20]="kCADCurveRenderOrder",b[b.kMxEntityRenderOrder=30]="kMxEntityRenderOrder",b[b.kGripRenderOrder=110]="kGripRenderOrder",b[b.kDynJigRenderOrder=120]="kDynJigRenderOrder"}(MxDefaultRenderOrder||(MxDefaultRenderOrder={})),function(b){b[b.kGetBegan=1]="kGetBegan",b[b.kGetEnd=2]="kGetEnd"}(InputToucheType||(InputToucheType={}));var MxType=Object.freeze({__proto__:null,get MxCloneType(){return MxCloneType},get MxCommandFlag(){return MxCommandFlag},get MxDefaultRenderOrder(){return MxDefaultRenderOrder},get InputToucheType(){return InputToucheType}});class MxassemblyClass{constructor(){this.mxassembly=null}initImp(){this.mxassembly||store.state.Mxassembly&&(this.mxassembly=store.state.Mxassembly)}NewMcGePoint3d(n,o,a){this.initImp();let m=new this.mxassembly.McGePoint3d;return n&&(m.x=n),o&&(m.y=o),a&&(m.z=a),m}NewMcGePoint3dArray(n){this.initImp();let o=new this.mxassembly.McGePoint3dArray;return n&&n.forEach(a=>{let m=this.NewMcGePoint3d();m.x=a.x,m.y=a.y,m.z=a.z,o.append(m)}),o}}const Mxassembly=new MxassemblyClass;class McGeToolClass{constructor(){this.mxgeTool=null}initImp(){this.mxgeTool||store.state.Mxassembly&&(this.mxgeTool=new store.state.Mxassembly.McGeTool)}calcArea(n){if(this.initImp(),!store.state.Mxassembly)return 0;if(n instanceof Array){let o=Mxassembly.NewMcGePoint3dArray(n);return this.mxgeTool.calcArea(o)}return this.mxgeTool.calcArea(n)}pointInPolyline(n,o){this.initImp();let a=o;o instanceof Array&&(a=Mxassembly.NewMcGePoint3dArray(o));let m=Mxassembly.NewMcGePoint3d(n.x,n.y,n.z);return this.mxgeTool.pointInPolyline(m,a)}}const McGeTool=new McGeToolClass;class MrxDbgUtilsClass{constructor(){this.imp=null}initImp(){if(!this.imp&&store.state.MxFun){let n=store.state.MxFun;this.imp=new n.getMrxDbgUtilsClass}}findEntAtPoint(n,o=null,a,m=!0,c){return this.initImp(),a||(a=MxFun.getCurrentDraw()),this.imp.findEntAtPoint(a.getMxObjectImplement(),n,o,m,c)}selectEnt(n,o){return this.initImp(),this.imp.selectEnt(n)}getCorner(n,o,a=!1,m,c=!1){return this.initImp(),this.imp.getCorner(n,o,a,m,c)}}const MrxDbgUtils=new MrxDbgUtilsClass,MxPaintBrushProps={},MxPaintBrush={getProps:()=>MxPaintBrushProps,setProps:b=>Object.assign(MxPaintBrushProps,b),use:b=>Object.assign(b,MxPaintBrushProps)};var DataType;(function(b){b[b.Default=0]="Default",b[b.Color=1]="Color",b[b.Vector2=2]="Vector2",b[b.Vector3=3]="Vector3",b[b.Vector4=4]="Vector4",b[b.Matrix3=5]="Matrix3",b[b.Matrix4=6]="Matrix4"})(DataType||(DataType={}));const MXDBDATATYPE="datatype";function getDwgKeyVal(b,n){let o,a="";return lodash.isObject(n)?(o=n.default,a=n.key):typeof n=="string"&&(a=n),[a,b[a]===void 0?o:b[a]]}class MxDbEntity extends RenderOrderNode{constructor(){super(),this.color=16777215,this.opacity=1,this.visible=!0,this.userData={},this.sGuid="",this.dLineWidth=0,this.lineWidthByPixels=!0,this.dDashArray=0,this.dDashRatio=0,this.layer="",this.use_smallcoord_display=!1,this.addEvent=this.on,this.removeEvent=this.off,this.callEvent=this.emit;const n=this.constructor;n.isPaintBrushDraw&&(MxPaintBrush.use(this),store.events.emit("use:create:MxDbEntity",this),n.isPaintBrushDraw=!1)}static register(){const n=this;n.isRegister||(n.cmd&&n.draw&&MxFun.addCommand(n.cmd,o=>n.use.call(n,void 0,o)),new n().rxInit(),n.isRegister=!0)}static async use(n,o){return new Promise((a,m)=>{const c=this;if(!c.isRegister&&c.register(),c.isPaintBrushDraw=!0,!c.cmd&&c.draw)return m();const x=A=>{a(A),n&&n(A),store.events.off("use:create:MxDbEntity",x)};store.events.on("use:create:MxDbEntity",x),c.draw(o)})}initGuid(n){this.sGuid.length>0?console.log("mx: init guid error"):this.sGuid=n}toSmallcoord2(n,o,a,m=0){return this.use_smallcoord_display?n.toSmallcoord2(o,a,m):new THREE.Vector3(o,a,m)}toSmallcoord(n,o){return this.use_smallcoord_display?n.toSmallcoord(o):o}isUseSmallcoordDisplay(){return this.use_smallcoord_display}setUseSmallcoordDisplay(n){this.use_smallcoord_display=n}dwgInHelp(n,o,a){let m=this;const c=n.type===MxType.MxCloneType.kMxFileClone||n.type===MxType.MxCloneType.kSaveDwgClone,x=H=>{if(!H)return;const{value:F,[MXDBDATATYPE]:P}=H;switch(P){case DataType.Color:return new THREE.Color(...F);case DataType.Vector2:return new THREE.Vector2(...F);case DataType.Vector3:return new THREE.Vector3(...F);case DataType.Vector4:return new THREE.Vector4(...F);case DataType.Matrix3:return new THREE.Matrix3().fromArray(F);case DataType.Matrix4:return new THREE.Matrix4().fromArray(F)}return a&&a.getCacheVal?a.getCacheVal(H):void 0};function A(H){return H instanceof THREE.Color||H instanceof THREE.Vector2||H instanceof THREE.Vector3||H instanceof THREE.Vector4||H instanceof THREE.Matrix3||H instanceof THREE.Matrix4?H.clone():a&&a.getVal?a.getVal(H):void 0}return o.forEach(H=>{const[F,P]=getDwgKeyVal(n,H);m[F]=lodash.cloneDeepWith(P,c?x:A)}),!0}dwgOutHelp(n,o){const a=x=>x instanceof THREE.Color?{[MXDBDATATYPE]:DataType.Color,value:x.toArray()}:x instanceof THREE.Vector2?{[MXDBDATATYPE]:DataType.Vector2,value:x.toArray()}:x instanceof THREE.Vector3?{[MXDBDATATYPE]:DataType.Vector3,value:x.toArray()}:x instanceof THREE.Vector4?{[MXDBDATATYPE]:DataType.Vector4,value:x.toArray()}:x instanceof THREE.Matrix3?{[MXDBDATATYPE]:DataType.Matrix3,value:x.toArray()}:x instanceof THREE.Matrix4?{[MXDBDATATYPE]:DataType.Matrix4,value:x.toArray()}:void 0;let m=this;const c=n.type===MxType.MxCloneType.kMxFileClone||n.type===MxType.MxCloneType.kSaveDwgClone;return o.forEach(x=>{const[A,H]=getDwgKeyVal(m,x);n[A]=c?lodash.cloneDeepWith(H,a):H}),n}create(n){return new this.constructor(n)}transformBy(n){}transformScale(n,o){let a=new THREE.Matrix4().makeTranslation(n.x,n.y,n.z).multiply(new THREE.Matrix4().makeScale(o,o,o)).multiply(new THREE.Matrix4().makeTranslation(-n.x,-n.y,-n.z));this.transformBy(a)}transformRotate(n,o){let a=new THREE.Matrix4().makeTranslation(n.x,n.y,n.z).multiply(new THREE.Matrix4().makeRotationZ(o)).multiply(new THREE.Matrix4().makeTranslation(-n.x,-n.y,-n.z));this.transformBy(a)}transformMove(n){let o=new THREE.Matrix4().makeTranslation(n.x,n.y,n.z);this.transformBy(o)}getGeomExtents(){return null}getClosestPointTo(n,o=0){return null}getImp(){return this.MxDbEntityImp}setNeedUpdateDisplay(n){let o=this.getImp();return!!o&&(n?o.upDisplay():o.setDirtyDisplay(!0),!0)}getMxObject(){let n=this.getImp();return n?n.getMxObject():null}onViewChange(){return!1}objectId(){let n=this.getImp();return n?n.objectId():0}erase(){let n=this.getImp();return!!n&&n.erase()}setLayer(n){let o=this.getImp();o&&o.nodifySetLayer(),this.layer=n}getLayer(){return this.layer}setColor(n){return this.color=n,this}getColor(){return this.color||16777215}clone(n){let o=this.create(),a={type:n||MxType.MxCloneType.kClone};return this.dwgOut(a),o.dwgIn(a),o.sGuid="",o}onDwgIn(n){this.color=n.color,this.renderOrder=n.renderOrder,this.opacity=n.opacity,this.visible=n.visible,n.userData?this.userData=JSON.parse(JSON.stringify(n.userData)):this.userData={},this.dLineWidth=n.lineWidth,this.lineWidthByPixels=n.lineWidthByPixels,this.dDashArray=n.dashArray,this.dDashRatio=n.dashRatio,this.layer=n.layer,n.guid&&(this.sGuid=n.guid)}onDwgOut(n){n.color=this.color,n.renderOrder=this.renderOrder,n.opacity=this.opacity,n.visible=this.visible,n.lineWidth=this.dLineWidth,n.lineWidthByPixels=this.lineWidthByPixels,n.dashArray=this.dDashArray,n.dashRatio=this.dDashRatio,n.layer=this.layer,n.guid=this.sGuid,Object.keys(this.userData).length>0&&(n.userData=this.userData)}rxInit(){MxFun.initMxDbEntityType(this)}setRenderOrder(n){this.renderOrder=n}getRenderOrder(){return this.renderOrder}setLineWidthByPixels(n){return this.lineWidthByPixels=n,this}getLineWidthByPixels(){return this.lineWidthByPixels}setLineWidth(n){return this.dLineWidth=n,this}getLineWidth(){return this.dLineWidth}getGetLength(){return 0}setDashLen(n){let o=this.getGetLength();if(o<1e-6||n<1e-6)return this;let a=Math.floor(o/n);return a<1e-6&&(this.dDashRatio=0),this.dDashArray=1/a,this}setDashRatio(n){return this.dDashRatio=n,this}setDashArray(n){return this.dDashArray=n,this}setDash(n,o){return this.dDashArray=n,this.dDashRatio=o,this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0),this}getDash(){return{dDashArray:this.dDashArray,dDashRatio:this.dDashRatio}}setDashLineDisplay(n){return n?(this.dDashArray<1e-5&&(this.dDashArray=.03),this.dDashRatio<1e-5&&(this.dDashRatio=.1),this.dLineWidth==0&&(this.dLineWidth=6,this.lineWidthByPixels=!0)):(this.dDashArray=0,this.dDashRatio=0),this}isDashLineDisplay(){return this.dDashArray>0&&this.dDashRatio>0}guid(){return this.sGuid}setGuid(n){return this.sGuid=n}onEndGripEidt(){this.callEvent("onEndGripEidt")}onStartGripEidt(){return this.callEvent("onStartGripEidt")}toJsonString(n=MxType.MxCloneType.kMxFileClone){let o={type:n};return this.dwgOut(o),o.TypeName=this.getTypeName(),JSON.stringify(o)}fromJsonString(n){let o=JSON.parse(n);return(o.type==MxType.MxCloneType.kMxFileClone||o.type==MxType.MxCloneType.kClone)&&this.dwgIn(o)}}function drawMxDbImage(){const b=new MrxDbgUiPrPoint;b.setMessage(`
指定插入点:`);let n=MxFun.getCurrentDraw();b.go(o=>{if(o!=0)return;let a=MxFun.screenCoordLong2Doc(300),m=MxFun.screenCoordLong2Doc(200);const c=b.value();let x=MxFun.screenCoord2Doc(10,10);c.z=x.z;let A=new MxDbImage;A.setRenderOrder(MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1),A.setPoint1(c);let H=new THREE.Vector3(c.x+a,c.y+m,c.z);A.setPoint2(H);let F=prompt("请填写图片网络地址","https://cdn.pixabay.com/photo/2022/11/15/12/23/winter-7593872_960_720.jpg");F&&(A.setImagePath(F),n.addMxEntity(A),A.addEvent("onStartGripEidt",()=>(A.visible=!1,A.setNeedUpdateDisplay(),{renderOrder:MxType.MxDefaultRenderOrder.kCADMeshRenderOrder-1})),A.addEvent("onEndGripEidt",()=>{A.visible=!0,A.setNeedUpdateDisplay()}))})}MxDbEntity.isRegister=!1;class MxDbImage extends MxDbEntity{constructor(){super(...arguments),this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3,this.imagePath="",this.isLoadMaterialFromPath=!0,this.material=null,this.angle=0}getTypeName(){return"MxDbImage"}getAngle(){return this.angle}setAngle(n){this.angle=n}worldDraw(n){let o=new THREE.Vector3(this.pt1.x,this.pt2.y),a=new THREE.Vector3(this.pt2.x,this.pt1.y);if(Math.abs(this.angle)>1e-5){let m=new THREE.Vector3(.5*(this.pt1.x-this.pt2.x)+this.pt2.x,.5*(this.pt1.y-this.pt2.y)+this.pt2.y),c=new THREE.Matrix4;c.makeRotationZ(this.angle);let x=new THREE.Matrix4().makeTranslation(m.x,m.y,m.z).multiply(c).multiply(new THREE.Matrix4().makeTranslation(-m.x,-m.y,-m.z));n.setMatrix(x)}if(n.getType()==1){if(n.drawSelectLine(this.pt1,o),n.drawSelectLine(o,this.pt2),n.drawSelectLine(this.pt2,a),n.drawSelectLine(a,this.pt1),this.material){let m=Math.abs(this.pt1.x-this.pt2.x),c=Math.abs(this.pt1.y-this.pt2.y),x=new THREE.PlaneGeometry(m,c),A=Math.min(this.pt1.x,this.pt2.x),H=Math.min(this.pt1.y,this.pt2.y);for(let P=0;P<x.vertices.length;P++)x.vertices[P].x+=A+.5*m,x.vertices[P].y+=H+.5*c,x.vertices[P].z=0;let F=new THREE.Mesh(x,this.material);F.material.depthTest=!1,n.drawEntity(F)}else if(this.imagePath.length>0&&this.isLoadMaterialFromPath){let m=this,c=n.getMxObject();const x=A=>{this.isLoadMaterialFromPath=!1,A&&(m.setMaterial(A),m.setNeedUpdateDisplay(),c.updateDisplay())};MxFun.loadImageMaterial(this.imagePath,A=>{x(A)})}}else if(this.material){let m=Math.abs(this.pt1.x-this.pt2.x),c=Math.abs(this.pt1.y-this.pt2.y),x=new THREE.PlaneGeometry(m,c),A=Math.min(this.pt1.x,this.pt2.x),H=Math.min(this.pt1.y,this.pt2.y);for(let P=0;P<x.vertices.length;P++)x.vertices[P].x+=A+.5*m,x.vertices[P].y+=H+.5*c,x.vertices[P].z=0;let F=new THREE.Mesh(x,this.material);F.material.depthTest=!1,n.drawEntity(F)}else n.drawLine(this.pt1,o),n.drawLine(o,this.pt2),n.drawLine(this.pt2,a),n.drawLine(a,this.pt1);n.setMatrix(null)}setImagePath(n){this.imagePath=n,this.isLoadMaterialFromPath=!0,this.material=null}getImagePath(){return this.imagePath}setMaterial(n){this.material=n}loadMaterial(n){n&&(this.imagePath=n),this.isLoadMaterialFromPath=!1,this.material=null;let o=this;MxFun.loadImageMaterial(this.imagePath,a=>{this.isLoadMaterialFromPath=!1,o.setMaterial(a)})}setPoint1(n){this.pt1=n}getPoint1(){return this.pt1}setPoint2(n){this.pt2=n}getPoint2(){return this.pt2}getGripPoints(){let n=[];n.push(this.pt1),n.push(this.pt2);let o=new THREE.Vector3(this.pt1.x+.5*(this.pt2.x-this.pt1.x),this.pt1.y+.5*(this.pt2.y-this.pt1.y));return n.push(o),n}moveGripPointsAt(n,o){return n==0?this.pt1.add(o):n==1?this.pt2.add(o):n==2&&(this.pt1.add(o),this.pt2.add(o)),!0}dwgIn(n){return this.onDwgIn(n),this.pt1.copy(n.pt1),this.pt2.copy(n.pt2),this.imagePath=n.imagePath.substr(0),this.isLoadMaterialFromPath=!0,n.angle&&(this.angle=n.angle),n.material&&(this.material=n.material),!0}dwgOut(n){return this.onDwgOut(n),n.pt1=this.pt1,n.pt2=this.pt2,n.imagePath=this.imagePath,n.angle=this.angle,n.type==MxType.MxCloneType.kDragClone&&(n.material=this.material),n}create(){return new MxDbImage}}var McGiWorldDrawType;MxDbImage.cmd="Mx_DrawImage",MxDbImage.draw=drawMxDbImage,addRegisterMxDbEntity(MxDbImage),function(b){b[b.kWorldDraw=1]="kWorldDraw",b[b.kDynDragDraw=2]="kDynDragDraw",b[b.kSelectDraw=3]="kSelectDraw"}(McGiWorldDrawType||(McGiWorldDrawType={}));var McGiWorldDrawType$1=McGiWorldDrawType;class MxDbSVGText{constructor(){this.txtPos=new THREE.Vector3,this.txt="",this.txtHeight=1,this.color=void 0,this._txtObject=null,this._txtAspectRatio=-1,this.move=!1,this.drawConnectingLine=!1,this._connectingLine=null,this.fontStyle="",this.underline=!1,this._underLine=null}}async function drawMxDbSVG(){const b=new MrxDbgUiPrPoint;b.setMessage(`
指定一点:`);let n=await b.go();if(!n)return;let o=new MxDbSVG,a=prompt("请输入svg图片网络或本地地址","https://img.alicdn.com/imgextra/i2/O1CN01FF1t1g1Q3PDWpSm4b_!!6000000001920-55-tps-508-135.svg");if(!a)return;o.setSvgPath(a),o.setSvgPostion(n),o.svgReverse=!0,o.svgMargin.x=.2,o.setSvgAlignmentRatio(new THREE.Vector2(.5,-1)),o.setRenderOrder(100),o.setSvgSize(new THREE.Vector2(50,0));let m=new MxDbSVGText;m.txt="A1",m.txtPos=new THREE.Vector3(0,-30,0),m.txtHeight=30,o.addText(m),o.fixedSize=!0,o.color=65297,MxFun.addToCurrentSpace(o)}class MxDbSVG extends MxDbEntity{constructor(){super(...arguments),this.svgPos=new THREE.Vector3,this.svg=null,this.svgPath="",this.svgSize=new THREE.Vector2(50,50),this.svgAlignmentRatio=new THREE.Vector2(0,0),this.imagePath="",this.isLoadMaterialFromPath=!0,this.material=null,this.svgRotate=0,this.svgReverse=!1,this.svgMirror=!1,this.svgChildColor=[],this.svgMargin=new THREE.Vector2(0,0),this.isSvgDirtyLocation=!1,this.isLoadFromPath=!0,this.aryText=[],this.svgBoxSize=null,this.fixedSize=!1,this.useSvgColor=!1}setSvgChildColor(n){if(this.svgChildColor=n,!this.useSvgColor&&this.svg){let o=new THREE.Color(this.getColor()),a=0,m=this;this.svg.traverse(function(c){c.material&&(a<m.svgChildColor.length?c.material.color=new THREE.Color(m.svgChildColor[a]):c.material.color=o,a++)}),this.setNeedUpdateDisplay(!0)}}getSvgChildColor(){return this.svgChildColor}calcVewSize(n){let o=this.svgSize.x,a=this.svgSize.y;return a<=0&&(a=this.svgBoxSize?this.svgBoxSize.y/this.svgBoxSize.x*o:o),this.fixedSize&&(o=n.screenCoordLong2Doc(o),a=n.screenCoordLong2Doc(a)),[o,a]}calcSvgDrawRect(n){if(!n)return;this.calcSvgPosition(n);let[o,a]=this.calcVewSize(n),m=new THREE.Matrix4;m.makeScale(this.svgMirror?-1:1,this.svgReverse?-1:1,1);let c=new THREE.Matrix4;c.makeRotationZ(this.svgRotate);let x=new THREE.Matrix4,A=new THREE.Vector3(this.svgPos.x-o*this.svgAlignmentRatio.x,this.svgPos.y-a*this.svgAlignmentRatio.y,0);x.makeTranslation(A.x,A.y,A.z),c.multiply(m),c.premultiply(x);let H=new THREE.Vector3(0,0,0),F=new THREE.Vector3(o,0,0),P=new THREE.Vector3(o,a,0),g=new THREE.Vector3(0,a,0);return H.applyMatrix4(c),F.applyMatrix4(c),P.applyMatrix4(c),g.applyMatrix4(c),{pt1:H,pt2:P,pt3:F,pt4:g,cenpt:P.clone().add(H.clone().sub(P).multiplyScalar(.5)),sizew:o,sizeh:a}}calcImageDrawRect(n){if(!n)return;this.calcSvgPosition(n);let[o,a]=this.calcVewSize(n),m=new THREE.Matrix4;m.makeScale(this.svgMirror?-1:1,this.svgReverse?-1:1,1);let c=new THREE.Matrix4,x=new THREE.Matrix4,A=new THREE.Vector3(this.svgPos.x-o*this.svgAlignmentRatio.x,this.svgPos.y-a*this.svgAlignmentRatio.y,0);x.makeTranslation(A.x,A.y,A.z),c.multiply(m),c.premultiply(x);let H=new THREE.Vector3(0,0,0),F=new THREE.Vector3(o,0,0),P=new THREE.Vector3(o,a,0),g=new THREE.Vector3(0,a,0);return H.applyMatrix4(c),F.applyMatrix4(c),P.applyMatrix4(c),g.applyMatrix4(c),{pt1:H,pt2:P,pt3:F,pt4:g,cenpt:P.clone().add(H.clone().sub(P).multiplyScalar(.5)),sizew:o,sizeh:a}}worldDraw(n){let o,a=n.getMxObject();if(this.imagePath.length>0){if(o=this.calcImageDrawRect(a),Math.abs(this.svgRotate)>1e-5){let g=new THREE.Vector3(.5*(o.pt1.x-o.pt2.x)+o.pt2.x,.5*(o.pt1.y-o.pt2.y)+o.pt2.y),E=new THREE.Matrix4;E.makeRotationZ(this.svgRotate);let _=new THREE.Matrix4().makeTranslation(g.x,g.y,g.z).multiply(E).multiply(new THREE.Matrix4().makeTranslation(-g.x,-g.y,-g.z));n.setMatrix(_)}}else o=this.calcSvgDrawRect(a);let m=o.pt1,c=o.pt2,x=o.pt3,A=o.pt4,H=o.cenpt,F=o.sizew,P=this;if(n.getType()!=McGiWorldDrawType$1.kSelectDraw&&this.aryText.forEach((g,E)=>{if(g.txt.length>0){let U,C=new THREE.Vector3(g.txtPos.x,g.txtPos.y,0);this.fixedSize&&(g.txtPos.x>0?C.x=this.svgPos.x+a.screenCoordLong2Doc(g.txtPos.x):C.x=this.svgPos.x-a.screenCoordLong2Doc(g.txtPos.x),g.txtPos.y>0?C.y=this.svgPos.y+a.screenCoordLong2Doc(g.txtPos.y):C.y=this.svgPos.y-a.screenCoordLong2Doc(g.txtPos.y)),g.color&&(U=n.getColor(),n.setColor(g.color));let S=g.txtHeight;P.fixedSize&&(S=a.screenCoordLong2Doc(g.txtHeight)),n.setXData({type:"text",txt:g.txt,index:E});let Y=n.drawText(g.txt,S,0,C,void 0,G=>g.fontStyle.length>0?`${g.fontStyle} ${G}px Arial`:`normal ${G}px Arial`);if(n.getType()==McGiWorldDrawType$1.kWorldDraw&&(g._txtObject=Y),g.underline&&g._txtObject){const G=new THREE.Box3;G.expandByObject(g._txtObject);let T=new THREE.Vector3(G.min.x,G.min.y+.1*S,0),B=new THREE.Vector3(G.max.x,G.min.y+.1*S,0);var _=new THREE.Geometry;let D=new THREE.LineBasicMaterial({color:n.getColor(),transparent:!0,depthTest:!1});_.vertices.push(T,B);var k=new THREE.Line(_,D);n.drawEntity(k),n.getType()==McGiWorldDrawType$1.kWorldDraw&&(g._underLine=k)}if(g._txtAspectRatio=-1,U&&n.setColor(U),g.drawConnectingLine){let G=H.clone().sub(C);if(G.length()>S+F){G.normalize();let T=H.clone().sub(G.clone().multiplyScalar(F)),B=C.clone().add(G.clone().multiplyScalar(S));_=new THREE.Geometry;let D=new THREE.LineBasicMaterial({color:n.getColor(),transparent:!0,depthTest:!1});_.vertices.push(T,B),k=new THREE.Line(_,D),n.setXData({type:"line"}),n.drawEntity(k),n.getType()==McGiWorldDrawType$1.kWorldDraw&&(g._connectingLine=k)}}}}),n.getType()==1){if(this.svg)n.setXData({type:"svg"}),n.drawEntity(this.svg);else if(this.svgPath.length>0&&this.isLoadFromPath){let g=this,E=n.getMxObject();MxThreeJS.loadSVG(this.svgPath,void 0,_=>{if(_){let k=_;if(k.boxSize)g.svgBoxSize=k.boxSize.clone();else{let G=new THREE.Box3().setFromObject(_);g.svgBoxSize||(g.svgBoxSize=new THREE.Vector3),g.svgBoxSize.x=G.max.x-G.min.x,g.svgBoxSize.y=G.max.y-G.min.y}let[U,C]=g.calcVewSize(a);g.svgBoxSize&&(_.scale.x=U/g.svgBoxSize.x,_.scale.y=C/g.svgBoxSize.y),_.scale.z=_.scale.x,g.svgReverse&&(_.scale.y*=-1),g.svgMirror&&(_.scale.x*=-1),_.rotateZ(g.svgRotate),g.isSvgDirtyLocation=!0;let S=new THREE.Color(n.getColor()),Y=0;_.traverse(function(G){G.material&&(G.material=G.material.clone(),G.material.transparent=!0,G.material.depthTest=!1,g.useSvgColor||(Y<g.svgChildColor.length?G.material.color=new THREE.Color(g.svgChildColor[Y]):G.material.color=S),Y++)}),g.svg=_,g.setNeedUpdateDisplay(),E.updateDisplay()}else console.log("mx LoadSVG:"+g.svgPath+" failed");g.isLoadFromPath=!1})}else if(this.material){let g=Math.abs(m.x-c.x),E=Math.abs(m.y-c.y),_=new THREE.PlaneGeometry(g,E),k=Math.min(m.x,c.x),U=Math.min(m.y,c.y);for(let S=0;S<_.vertices.length;S++)_.vertices[S].x+=k+.5*g,_.vertices[S].y+=U+.5*E,_.vertices[S].z=0;let C=new THREE.Mesh(_,this.material);C.material.depthTest=!1,n.drawEntity(C)}else if(this.isLoadMaterialFromPath&&this.imagePath.length>0){let g=this,E=n.getMxObject();MxFun.loadImageMaterial(this.imagePath,_=>{this.isLoadMaterialFromPath=!1,_&&(g.material=_,g.setNeedUpdateDisplay(),E.updateDisplay())})}this.fixedSize||(n.drawSelectLine(m,c),n.drawSelectLine(x,A),n.drawSelectLine(m,x),n.drawSelectLine(x,c),n.drawSelectLine(c,A),n.drawSelectLine(A,m))}else n.drawLine(m,x),n.drawLine(x,c),n.drawLine(c,A),n.drawLine(A,m);this.imagePath.length>0&&n.setMatrix(null)}async setSvgPath(n,o=!1){this.svgPath=n,this.svg=null,this.isLoadFromPath=!0,this.svgBoxSize=null,o&&await MxThreeJS.loadSVG(n)}getSvgPath(){return this.svgPath}setSvgPostion(n){this.svgPos=n.clone(),this.isSvgDirtyLocation=!0}setImagePath(n,o){this.imagePath=n,o?(this.material=o,this.isLoadMaterialFromPath=!1):(this.material=null,this.isLoadMaterialFromPath=!0)}getImagePath(){return this.imagePath}getSvgPostion(){return this.svgPos}setSvgSize(n){this.svgSize=n,this.isSvgDirtyLocation=!0}getSvgSize(){return this.svgSize}setSvgAlignmentRatio(n){this.svgAlignmentRatio=n,this.isSvgDirtyLocation=!0}getSvgAlignmentRatio(){return this.svgAlignmentRatio}getText(n){return n<this.aryText.length?this.aryText[n]:null}addText(n){this.aryText.push(n)}getGripPoints(){let n=[];n.push(this.svgPos);let o=0;for(;o<this.aryText.length;o++){let a=this.aryText[o];if(a.move){let m=new THREE.Vector3(a.txtPos.x,a.txtPos.y,0);if(this.fixedSize){let c=MxFun.getCurrentDraw();a.txtPos.x>0?m.x=this.svgPos.x+c.screenCoordLong2Doc(a.txtPos.x):m.x=this.svgPos.x-c.screenCoordLong2Doc(a.txtPos.x),a.txtPos.y>0?m.y=this.svgPos.y+c.screenCoordLong2Doc(a.txtPos.y):m.y=this.svgPos.y-c.screenCoordLong2Doc(a.txtPos.y)}n.push(m)}}return n}moveGripPointsAt(n,o){if(n==0)this.svgPos.add(o),this.fixedSize||this.aryText.forEach(a=>{a.txtPos.add(o)});else if(n-1>=0&&n-1<this.aryText.length){let a=this.aryText[n-1];if(a.move)if(this.fixedSize){let m=MxFun.getCurrentDraw();a.txtPos.x+=m.docCoordLong2Screen(o.x),a.txtPos.y+=m.docCoordLong2Screen(o.y)}else a.txtPos.add(o)}return this.isSvgDirtyLocation=!0,!0}calcSvgPosition(n){if(!this.svg||!this.isSvgDirtyLocation)return;this.isSvgDirtyLocation=!1;let[o,a]=this.calcVewSize(n);this.svg.position.x=this.svgPos.x-o*this.svgAlignmentRatio.x-this.svgMargin.x*o,this.svg.position.y=this.svgPos.y-a*this.svgAlignmentRatio.y-this.svgMargin.y*a}dwgIn(n){this.onDwgIn(n),this.fixedSize=n.fixedSize,this.fixedSize?this.svg=null:n.type==MxType.MxCloneType.kClone&&n.svg&&(this.svg=n.svg.clone()),this.svgPos.copy(n.svgPos),this.svgPath=n.svgPath.substr(0),this.svgSize.copy(n.svgSize),this.svgAlignmentRatio.copy(n.svgAlignmentRatio),this.isSvgDirtyLocation=!0,this.svg||(this.isLoadFromPath=!0),this.svgBoxSize=null;let o=n.txts;return this.aryText=[],o.forEach(a=>{let m=new MxDbSVGText;m.txt=a.txt,m.txtHeight=a.txtHeight,m.txtPos.copy(a.txtPos),m.move=a.move,m.drawConnectingLine=a.drawConnectingLine,this.aryText.push(m)}),this.svgRotate=n.svgRotate,this.useSvgColor=n.useSvgColor,this.svgReverse=n.svgReverse,this.svgMirror=n.svgMirror,this.svgMargin=n.svgMargin,n.svgChildColor?this.svgChildColor=n.svgChildColor:this.svgChildColor=[],this.imagePath=n.imagePath.substr(0),this.isLoadMaterialFromPath=!0,n.material&&(this.material=n.material),!0}dwgOut(n){this.onDwgOut(n);let o,a=this.getMxObject();return n.type==MxType.MxCloneType.kClone&&(n.svg=this.svg),n.svgPath=this.svgPath,n.svgPos=this.svgPos,n.svgSize=this.svgSize,n.svgAlignmentRatio=this.svgAlignmentRatio,n.txts=[],n.type==MxType.MxCloneType.kSaveDwgClone&&a&&(o=this.calcSvgDrawRect(a)),this.aryText.forEach(m=>{let c={txtPos:m.txtPos,txt:m.txt,txtHeight:m.txtHeight,color:m.color,_txtAspectRatio:m._txtAspectRatio,move:m.move,drawConnectingLine:m.drawConnectingLine};n.type==MxType.MxCloneType.kSaveDwgClone&&(m._connectingLine&&(c.connectingLine=m._connectingLine.geometry.vertice),m._underLine&&(c._underLine=m._underLine.geometry.vertice)),n.txts.push(c)}),n.fixedSize=this.fixedSize,n.svgRotate=this.svgRotate,n.useSvgColor=this.useSvgColor,n.svgReverse=this.svgReverse,n.svgMirror=this.svgMirror,n.svgMargin=this.svgMargin,n.svgChildColor=this.svgChildColor,n.type==MxType.MxCloneType.kSaveDwgClone&&(n.svgRect=o),n.imagePath=this.imagePath,n.type==MxType.MxCloneType.kDragClone&&(n.material=this.material),n}create(){return new MxDbSVG}transformBy(n){this.svgPos.applyMatrix4(n),this.isSvgDirtyLocation=!0,this.fixedSize||this.aryText.forEach(o=>{o.txtPos.applyMatrix4(n)})}getTypeName(){return"MxDbSVG"}setColor(n){if(super.setColor(n),this.svg){let o=new THREE.Color(this.color);this.svg.traverse(function(a){a.material&&(a.material.color=o)})}return this}setSvg(n){this.svg=n,this.isLoadFromPath=!1,this.svgBoxSize=null}calcSvgBoxSize(n){if(!this.svgBoxSize)if(n.boxSize)this.svgBoxSize=n.boxSize.clone();else{let o=new THREE.Box3().setFromObject(n);this.svgBoxSize||(this.svgBoxSize=new THREE.Vector3),this.svgBoxSize.x=o.max.x-o.min.x,this.svgBoxSize.y=o.max.y-o.min.y}}reComputeSVG(){if(!this.svg)return;let n=this.getMxObject();if(!n)return;this.calcSvgBoxSize(this.svg);let[o,a]=this.calcVewSize(n);this.svgBoxSize&&(this.svg.scale.x=o/this.svgBoxSize.x,this.svg.scale.y=a/this.svgBoxSize.y),this.svg.scale.z=this.svg.scale.x,this.svgReverse&&(this.svg.scale.y*=-1),this.svgMirror&&(this.svg.scale.x*=-1),this.isSvgDirtyLocation=!0,this.calcSvgPosition(n)}onViewChange(){if(!this.fixedSize)return!1;if(this.imagePath.length>0)return this.setNeedUpdateDisplay(!1),!0;let n=this.getMxObject();if(n==null)return!1;if(this.svg){this.calcSvgBoxSize(this.svg);let[x,A]=this.calcVewSize(n);this.svgBoxSize&&(this.svg.scale.x=x/this.svgBoxSize.x,this.svg.scale.y=A/this.svgBoxSize.y),this.svg.scale.z=this.svg.scale.x,this.svgReverse&&(this.svg.scale.y*=-1),this.svgMirror&&(this.svg.scale.x*=-1),this.isSvgDirtyLocation=!0,this.calcSvgPosition(n)}let o=this.calcSvgDrawRect(n),a=o.cenpt,m=o.sizew,c=this;return this.aryText.forEach(x=>{if(x._txtObject&&n){let H=n.screenCoordLong2Doc(x.txtHeight);if(H>1e-5){x._txtAspectRatio<=0&&(x._txtAspectRatio=x._txtObject.scale.x/x._txtObject.scale.y),x._txtObject.scale.set(x._txtAspectRatio*H*1.5,1.5*H,1),x.txtPos.x>0?x._txtObject.position.x=c.svgPos.x+n.screenCoordLong2Doc(x.txtPos.x):x._txtObject.position.x=c.svgPos.x-n.screenCoordLong2Doc(x.txtPos.x),x.txtPos.y>0?x._txtObject.position.y=c.svgPos.y+n.screenCoordLong2Doc(x.txtPos.y):x._txtObject.position.y=c.svgPos.y-n.screenCoordLong2Doc(x.txtPos.y);let F=x._txtObject.position;if(x._txtObject.updateMatrix(),x._underLine){const P=new THREE.Box3;let g=x._txtObject.parent;x._txtObject.parent=null,P.expandByObject(x._txtObject),x._txtObject.parent=g;let E=new THREE.Vector3(P.min.x,P.min.y+.1*H,0),_=new THREE.Vector3(P.max.x,P.min.y+.1*H,0);(A=new THREE.Geometry).vertices.push(E,_),x._underLine.geometry=A}if(x._connectingLine){let P=a.clone().sub(F);P.normalize();let g=a.clone().sub(P.clone().multiplyScalar(m)),E=F.clone().add(P.clone().multiplyScalar(H));var A;(A=new THREE.Geometry).vertices.push(g,E),x._connectingLine.geometry=A}}}}),!0}}function drawMxDbPolyline(){const b=new MrxDbgUiPrPoint;b.setMessage(`
指定第一点:`);let n,o=new MxDbPolyline;b.go(a=>{if(a!=0)return;let m=b.value();n||(n=m.clone());let c=m;const x=new McEdGetPointWorldDrawObject;x.setDraw((H,F)=>{F.setColor(16711680),F.drawLine(c,H),F.drawCustomEntity(o)}),b.setUserDraw(x),b.setMessage(`
指定下一点:`);let A=0;o.addVertexAt(m),b.goWhile(H=>{if(H==0)c=b.value(),o.addVertexAt(c),++A>=2?(b.setMessage(`
指定下一点:`),b.setKeyWords("[闭合(C)/放弃(U)]")):A>0?(b.setMessage(`
指定下一点:`),b.setKeyWords("[放弃(U)]")):(b.setMessage(`
指定第一点:`),b.setKeyWords(""));else if(H==1){if(b.isKeyWordPicked("C"))return{exit:!0};b.isKeyWordPicked("U")&&console.log("Mx_Line undo....")}},()=>{MxFun.getCurrentDraw().addMxEntity(o)})})}MxDbSVG.cmd="Mx_ModelFixedSvg",MxDbSVG.draw=drawMxDbSVG,addRegisterMxDbEntity(MxDbSVG);class MxDbPolyline extends MxDbEntity{constructor(){super(...arguments),this.points=[]}getTypeName(){return"MxDbPolyline"}worldDraw(n){this.points.length<2||n.drawLines(this.points)}getGripPoints(){return this.points}moveGripPointsAt(n,o){return!(n>=this.points.length||(this.points[n].add(o),0))}create(){return new MxDbPolyline}dwgIn(n){this.onDwgIn(n);let o=n.points;return this.points=[],o.forEach(a=>{this.points.push(new THREE.Vector3(a.x,a.y,a.z))}),!0}dwgOut(n){return this.onDwgOut(n),n.points=this.points,n}addVertexAt(n){this.points.push(n)}numVerts(){return this.points.length}getPointAt(n){return n<this.points.length?this.points[n]:null}setPointAt(n,o){return n<this.points.length&&(this.points[n]=o,!0)}}function drawMxDb2LineAngularDimension(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new MxDb2LineAngularDimension,a=new McEdGetPointWorldDrawObject;return b.setMessage(`
指定第一点:`),b.go(m=>{m===0&&(b.setMessage(`
指定第二个角度点:`),o.point1=b.value(),a.setDraw((c,x)=>{o.point2=c,a.drawLine(o.point1,c)}),b.setUserDraw(a),b.go(c=>{b.setMessage(`
指定最后一个点:`),c===0&&(o.point2=b.value(),a.setDraw((x,A)=>{o.point3=x,a.drawCustomEntity(o)}),b.go(x=>{x===0&&n.addMxEntity(o)}))}))}),o}MxDbPolyline.cmd="Mx_Lines",MxDbPolyline.draw=drawMxDbPolyline,addRegisterMxDbEntity(MxDbPolyline);const propertyDbKeys$6=["colors","point1","point2","point3"];class MxDb2LineAngularDimension extends MxDbEntity{constructor(n){if(super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.colors=[],n){const{points:o,colors:a}=n;o&&this.setPoints(o),a&&this.setColor(a)}}calculateLineAngle(n,o,a){const m=2*Math.PI/360;return{startAngle:180*Math.atan2(o.y-n.y,o.x-n.x)/Math.PI*m,endAngle:180*Math.atan2(a.y-n.y,a.x-n.x)/Math.PI*m}}setPoints(n){const[o,a,m]=n;return o&&(this.point1=o),a&&(this.point2=a),m&&(this.point3=m),this}setColor(n){return lodash.isArray(n)?this.colors=n:this.color=n,this}worldDraw(n){if(n.getType()==McGiWorldDrawType$1.kWorldDraw||n.getType()==McGiWorldDrawType$1.kDynDragDraw){const[o,a,m,c]=this.colors||[],x=this.getColor(),A=n.getMxObject();n.setOpacity(this.opacity),n.setColor(o||x),n.drawLine(this.point1,this.point2),n.setColor(a||x),n.drawLine(this.point2,this.point3);const{startAngle:H,endAngle:F}=this.calculateLineAngle(this.point2,this.point1,this.point3),P=this.point2.distanceTo(this.point1),g=this.point2.distanceTo(this.point3),E=Math.min(P,g)/4;let _=THREE.MathUtils.radToDeg(H-F);_<0&&(_+=360);let k=A.screenCoordLong2Doc(50);const U=new THREE.ArcCurve(this.point2.x,this.point2.y,E,H,F,!0),C=new THREE.Geometry().setFromPoints(U.getPoints(50));n.setColor(m||x),n.drawGeometryLines(C);const S=U.getPoint(.5);let Y=new THREE.Vector3(S.x,S.y,0);const G=Y.sub(this.point2),T=G.length()+.5*k;G.normalize().multiplyScalar(T),Y=this.point2.clone().add(G),n.setColor(c||x),n.drawText(_.toFixed(3)+"°",.5*k,0,Y)}else n.drawLine(this.point1,this.point2),n.drawLine(this.point3,this.point2)}getGripPoints(){return[this.point1,this.point2,this.point3]}moveGripPointsAt(n,o){return n===0?this.point1.add(o):n===1?this.point2.add(o):n===2&&this.point3.add(o),!0}dwgIn(n){return this.onDwgIn(n),this.dwgInHelp(n,propertyDbKeys$6),!0}dwgOut(n){return this.onDwgOut(n),this.dwgOutHelp(n,propertyDbKeys$6),n}create(){return new MxDb2LineAngularDimension}transformBy(n){this.point1.applyMatrix4(n),this.point2.applyMatrix4(n)}getTypeName(){return"MxDb2LineAngularDimension"}}MxDb2LineAngularDimension.cmd="Mx_AngleSurveying",MxDb2LineAngularDimension.draw=drawMxDb2LineAngularDimension,addRegisterMxDbEntity(MxDb2LineAngularDimension);class MxFilters{constructor(){this.uniformObj={},this.filtersStr="",this.filtersTypes="",this.VSHADER_SOURCE=`
  varying vec2 v_Uv;
  void main () {
      v_Uv = uv;
      gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
  `,this.FSHADER_SOURCE=`
  varying vec2 v_Uv;
  uniform sampler2D e_Texture;
  uniform mat4 colorMatrix;
  ${this.filtersStr}
  void main () {
    vec4 color = texture2D( e_Texture, v_Uv );
    color = color * colorMatrix;
    ${this.filtersTypes}
    gl_FragColor = color;
  }`,this._matrix=new THREE.Matrix4}channel({r:n=1,g:o=1,b:a=1}){return this._matrix=new THREE.Matrix4().set(n,0,0,0,0,o,0,0,0,0,a,0,0,0,0,1).multiply(this._matrix),this}brightness(n){return this._matrix=new THREE.Matrix4().set(n,0,0,0,0,n,0,0,0,0,n,0,0,0,0,1).multiply(this._matrix),this}saturate(n){const o=.2126*(1-n),a=.7152*(1-n),m=.0722*(1-n);return this._matrix=new THREE.Matrix4().set(o+n,a,m,0,o,a+n,m,0,o,a,m+n,0,0,0,0,1).multiply(this._matrix),this}contrast(n){const o=.5*(1-n);return this._matrix=new THREE.Matrix4().set(n,0,0,0,0,n,0,0,0,0,n,0,o,o,o,1).multiply(this._matrix),this}opacity(n){return this._matrix=new THREE.Matrix4().set(1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,n).multiply(this._matrix),this}invert(n){const o=1-2*n;return this._matrix=new THREE.Matrix4().set(o,0,0,0,0,o,0,0,0,0,o,0,n,n,n,1).multiply(this._matrix),this}grayscale(n=1){const o=.2126*n,a=.7152*n,m=.0722*n;return this._matrix=new THREE.Matrix4().set(o+1-n,a,m,0,o,a+1-n,m,0,o,a,m+1-n,0,0,0,0,1).multiply(this._matrix),this}sepia(n=1){return this._matrix=new THREE.Matrix4().set(1-.607*n,.769*n,.189*n,0,.349*n,1-.314*n,.168*n,0,.272*n,.534*n,1-.869*n,0,0,0,0,1).multiply(this._matrix),this}hueRotate(n){const o=n/180*Math.PI,a=Math.cos(o),m=Math.sin(o),c=.2126,x=.7152,A=.0722;return this._matrix=new THREE.Matrix4().set(c+.7874*a+m*-c,x+a*-x+m*-x,A+a*-A+.9278*m,0,c+a*-c+.143*m,x+a*(1-x)+.14*m,A+a*-A+-.283*m,0,c+a*-c+-.7874*m,x+a*-x+m*x,A+.9278*a+m*A,0,0,0,0,1).multiply(this._matrix),this}convolution(n,o=1/9,a=521){return this.uniformObj=Object.assign(Object.assign({},this.uniformObj),{cKernel:{value:n.toArray()},stStep:{value:o},scaleFactor:{value:a}}),this.filtersTypes.indexOf("convolutionTextureColor")<0&&(this.filtersStr+=`
        uniform float cKernel[9];
        uniform float stStep;
        uniform float scaleFactor;
        vec4 convolutionTextureColor(vec4 color) {
            vec2 offsets[9];
            offsets[0] = vec2(-1.0,-1.0);
            offsets[1] =  vec2(0.0,-1.0);
            offsets[2] = vec2(1.0,-1.0);
            offsets[3] =  vec2(-1.0,0.0);
            offsets[4] = vec2(0.0,0.0);
            offsets[5] = vec2(1.0,0.0);
            offsets[6] =  vec2(-1.0,1.0);
            offsets[7] = vec2(0.0,1.0);
            offsets[8] = vec2(1.0,1.0);

            vec4 sum = color;
            for(int i = 0; i < 9; i++) {
                sum = sum + cKernel[i] * scaleFactor * texture2D(e_Texture, v_Uv + offsets[i] / stStep);
            };
            return sum;
        }`,this.filtersTypes+=`color = convolutionTextureColor(color);
`),this}reset(){return this.uniformObj={},this.filtersStr="",this.filtersTypes="",this._matrix=new THREE.Matrix4,this}_getFilterShaderData(n){return{uniforms:Object.assign({e_Texture:{value:n},colorMatrix:{value:this._matrix}},this.uniformObj),vertexShader:this.VSHADER_SOURCE,fragmentShader:this.FSHADER_SOURCE}}_getFilterColor(n="#000000",o=1){n=new THREE.Color(n);let{r:a,g:m,b:c}=n;const x=this._matrix.toArray();x[12],x[13],x[14],x[15];const A=x[0]*a+x[1]*a+x[2]*a+x[3]*o,H=x[4]*m+x[5]*m+x[6]*m+x[7]*o,F=x[8]*c+x[9]*c+x[10]*c+x[11]*o;return n.setRGB(A,H,F),n}toJSON(){return JSON.stringify({matrix:this._matrix.toArray(),uniformObj:this.uniformObj,filtersStr:this.filtersStr,filtersTypes:this.filtersTypes})}static fromJSON(n){const{matrix:o,uniformObj:a,filtersStr:m,filtersTypes:c}=JSON.parse(n),x=new MxFilters;return x._matrix=new THREE.Matrix4().fromArray(o),x.uniformObj=a,x.filtersStr=m,x.filtersTypes=c,x}}class MxDbShape extends MxDbEntity{constructor(){super(...arguments),this.isLoadMaterialFromPath=!0,this.stroke="#fff",this.strokeLineWidth=2,this.isStrokeDashLine=!1,this.isFill=!1,this._fillImageSrc=null,this.curveSegments=50,this.closed=!0,this.filter=null,this._cornerRadius=[],this._propertyDbKeys=["isFill","stroke","strokeLineWidth","isStrokeDashLine","closed","cornerRadius","fillImageSrc","fillImageParam","curveSegments"]}setStroke(n){return this.stroke=n,this}setStrokeLineWidth(n){return this.strokeLineWidth=n,this}setIsStrokeDashLine(n){return this.isStrokeDashLine=n,this}setIsFill(n){return this.isFill=n,this}get fillImageSrc(){return this._fillImageSrc}set fillImageSrc(n){this._fillImageSrc=n,this.isLoadMaterialFromPath=!0,this.material=null,this.fillImageSrc&&(this.isFill=!0),n!==!1&&n!==null||(this.setNeedUpdateDisplay(),MxFun.updateDisplay())}setFillImageSrc(n){return this.fillImageSrc=n,this}setFillImageParam(n){this.fillImageParam=n===void 0?n:Object.assign(this.fillImageParam,n)}setCurveSegments(n){return this.curveSegments=n,this}setClosed(n){return this.closed=n,this}getFilter(){return this.filter}setFilter(n){this.filter=n,this.isLoadMaterialFromPath=!0,this.material=null}get cornerRadius(){return this._cornerRadius}set cornerRadius(n){this.setCornerRadius(n)}setCornerRadius(n,o=!0){this._cornerRadius=n instanceof Array?n.map(a=>o?MxFun.screenCoordLong2Doc(a):a):o?MxFun.screenCoordLong2Doc(n):n}getTypeName(){return"MxDbShape"}getShapePoints(n){const{curveSegments:o}=this;return this.points=n.getPoints(o).map(a=>a instanceof THREE.Vector2?new THREE.Vector3(a.x,a.y,0):a),this.points}createPaths(n){return this._paths=new THREE.CurvePath,Array.isArray(n)?n.forEach(o=>this._paths.add(o)):this._paths.add(n),this._paths}_draw(n,o){let{isFill:a,closed:m,opacity:c,dLineWidth:x,lineWidthByPixels:A}=this;n.setOpacity(c),n.setLineWidthByPixels(A),n.setLineWidth(x);const H=n.getColor();n.setColor(this.filter?this.filter._getFilterColor(this.color,this.opacity):this.color);const F=this.getCornerRadiusPoints(m||a?this.getClosedPoints(o):o);a?!this.fillImageSrc&&n.drawSolid(F):n.drawLines(F),this._fillImg(n,F),n.setColor(H)}getCornerRadiusPoints(n){const{cornerRadius:o}=this;if(!o)return n;const a=typeof o=="number"?n.map(()=>o):o;return a.length>0?getToGenerateRoundedCorners(n,a):n}_drawStoreLine(n,o,a){const{isFill:m,stroke:c,strokeLineWidth:x}=this,A=n.getLineWidth(),H=n.getColor(),F=n.isDashLineDisplay();c&&m&&(n.setDashLineDisplay(this.isStrokeDashLine),n.setColor(c),n.setLineWidth(x),a?a(n):n.drawLines(this.getCornerRadiusPoints(this.getClosedPoints(o))),n.setColor(H),n.setLineWidth(A),n.setDashLineDisplay(F))}getClosedPoints(n){return[...n,n[0]]}getTotalLength(){if(this.points){let n=0;return this.points.reduce((o,a)=>(n+=o.distanceTo(a),a)),n}if(this._paths)return this._paths.getLength()+(this.closedLine?this.closedLine.getLength():0)}getGetLength(){return this._paths.getLength()}getArea(){return this.points?McGeTool.calcArea(this.closed?this.getClosedPoints(this.points):this.points):0}worldDraw(n){const o=this.createPaths(new THREE.Curve),a=this.getShapePoints(o);this._draw(n,a),this._drawStoreLine(n,a)}_fillImg(n,o){const a={transparent:!0,depthTest:!1,opacity:this.opacity,visible:this.visible};if(!this.isFill||!this.fillImageSrc)return;if(!this.material){let H=this;return void MxFun.loadImageMaterial(this.fillImageSrc,F=>{H.isLoadMaterialFromPath=!1,F&&(H.material=F,H.setNeedUpdateDisplay(),MxFun.updateDisplay())})}const m=o.map(({x:H,y:F})=>new THREE.Vector2(H,F));let c=this.material,x=new THREE.ShapeGeometry(new THREE.Shape(m));if(x=repairGeometryFaceVertexUvs(x),this.filter){const H=c.map,F=this.filter._getFilterShaderData(H);c=new THREE.ShaderMaterial(Object.assign(Object.assign({},F),a))}if(c.depthTest=!1,c.transparent=!0,c.opacity=this.opacity,c.visible=this.visible,this.fillImageParam){const H=this.fillImageParam;for(let F in this.fillImageParam)this.material.map[F]=H[F]}let A=new THREE.Mesh(x,c);n.drawEntity(A)}getGripPoints(){return[]}moveGripPointsAt(n,o){return!0}dwgIn(n){return this.onDwgIn(n),this.dwgInHelp(n,this._propertyDbKeys),this.isLoadMaterialFromPath=!0,this.material=null,n.type===MxType.MxCloneType.kMxFileClone?n.filter&&(this.filter=MxFilters.fromJSON(n.filter)):n.filter&&(this.filter=n.filter),!0}dwgOut(n){var o;return this.onDwgOut(n),this.dwgOutHelp(n,this._propertyDbKeys),n.type===MxType.MxCloneType.kMxFileClone?this.filter&&(n.filter=(o=this.filter)===null||o===void 0?void 0:o.toJSON()):n.filter=this.filter,n}transformBy(n){this.points&&this.points.forEach(o=>{o.applyMatrix4(n)})}}class MxDbEllipseShape extends MxDbShape{constructor(){super(),this.center=new THREE.Vector3,this.xRadius=10,this.yRadius=10,this.startAngle=0,this.endAngle=2*Math.PI,this.clockwise=!1,this.rotation=0,this.isClosedToCenter=!0,this._propertyDbKeys=[...this._propertyDbKeys,"center","xRadius","yRadius","startAngle","endAngle","clockwise","rotation","isClosedToCenter"]}getTypeName(){return"MxDbEllipseShape"}setCenter(n){return this.center=n,this}setXRadius(n){return this.xRadius=n,this}setYRadius(n){return this.yRadius=n,this}setStartAngle(n){return this.startAngle=n,this}setEndAngle(n){return this.endAngle=n,this}setClockwise(n){return this.clockwise=n,this}setRotation(n){return this.rotation=n,this}setIsClosedToCenter(n){return this.isClosedToCenter=n,this}worldDraw(n){this.drawEllipseShape(n)}drawEllipseShape(n){let{startAngle:o,endAngle:a,clockwise:m}=this;const c=this.createEllipseCurve(),x=this.createPaths(c);let A=this.getShapePoints(x);return this._draw(n,A),this._drawStoreLine(n,A),{centralAngle:m?a>o?THREE.MathUtils.radToDeg(c.aEndAngle-c.aStartAngle):360-Math.abs(THREE.MathUtils.radToDeg(c.aEndAngle-c.aStartAngle)):o>a?Math.abs(THREE.MathUtils.radToDeg(c.aEndAngle-c.aStartAngle)):360-THREE.MathUtils.radToDeg(c.aEndAngle-c.aStartAngle),curve:c,points:A}}createEllipseCurve(n=this.center.x,o=this.center.y,a=this.xRadius,m=this.yRadius,c=this.startAngle,x=this.endAngle,A=this.clockwise,H=this.rotation){return new THREE.EllipseCurve(n,o,a,m,c,x,A,H)}getCornerRadiusPoints(n){return n}getClosedPoints(n){try{let o=(this._paths||new THREE.CatmullRomCurve3(n,!1,"catmullrom",0)).getLength();this.closedLine=this.getClosedLine(n);const a=this.closedLine.getLength();let m=this.curveSegments/o,c=2.5*(o>this.curveSegments?a*m:1);if(c>20*this.curveSegments&&(c=20*this.curveSegments),c<=0)return n;const x=this.closedLine.getPoints(c);return[...n,...x]}catch{return[...n,n[0]]}}getClosedLine(n){const{isClosedToCenter:o,center:a}=this;let m=o?[n[n.length-1],a,n[0]]:[n[n.length-1],n[0]];return new THREE.CatmullRomCurve3(m,!1,"catmullrom",.01)}getGripPoints(){return[this.center]}moveGripPointsAt(n,o){return n===0&&this.center.add(o),!0}}addRegisterMxDbEntity(MxDbEllipseShape);class MxDbCircleShape extends MxDbEllipseShape{getTypeName(){return"MxDbCircleShape"}get radius(){return this.xRadius}set radius(n){this.xRadius=n,this.yRadius=n}setRadius(n){return this.radius=n,this}setXRadius(n){return this.setRadius(n),this}setYRadius(n){return this.setRadius(n),this}}function drawMx3PointArc(){const b=new MrxDbgUiPrPoint,n=new McEdGetPointWorldDrawObject,o=new Mx3PointArc;b.setUserDraw(n),b.setMessage(`
确定圆弧开始点:`),b.go(a=>{a===MrxDbgUiPrBaseReturn$1.kOk&&(o.point1=b.value(),n.setDraw(m=>{n.drawLine(o.point1,m)})),b.setMessage(`
确定圆弧结束点:`),b.go(m=>{m===MrxDbgUiPrBaseReturn$1.kOk&&(o.point2=b.value(),n.setDraw(c=>{o.point3=c,n.drawCustomEntity(o)})),b.setMessage(`
确定圆弧上任意一点:`),b.go(c=>{if(c===MrxDbgUiPrBaseReturn$1.kOk){MxFun.getCurrentDraw().addMxEntity(o);const{radius:x,arcLength:A}=createThreePointArc(o.point1,o.point2,o.point3,!0);console.log("半径:",x),console.log("圆弧弧长:",A,o.getTotalLength())}})})})}addRegisterMxDbEntity(MxDbCircleShape);class Mx3PointArc extends MxDbCircleShape{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.autoClockwise=!0,this.closed=!1,this.centralAngle=0,this._propertyDbKeys=[...this._propertyDbKeys,"point1","point2","point3","autoClockwise"]}getTypeName(){return"Mx3PointArc"}create(){return new Mx3PointArc}worldDraw(n){this.updateDataInfo();const{centralAngle:o}=this.drawEllipseShape(n);this.centralAngle=o}getGripPoints(){return[this.point1,this.point2,this.point3,this.center]}compute3PointAngle(n=this.point1,o=this.point2,a=this.point3){const m=calculateArcAngle(n,this.center,this.radius),c=calculateArcAngle(o,this.center,this.radius),x=calculateArcAngle(a,this.center,this.radius);return[m.angle,c.angle,x.angle]}upDateCenter(n=this.point1,o=this.point2,a=this.point3){return this.center=calculateArcOrigin(n,o,a),this.center}upDateRadius(n=this.point1){return this.radius=calculateRadiusArc(n,this.center),this.radius}upDataClockwise(n,o,a){const{autoClockwise:m}=this;m&&(this.clockwise=judgementArcRenderDirection(o,n,a))}updateDataInfo(){this.upDateCenter(this.point1,this.point2,this.point3),this.upDateRadius(this.point1);const[n,o,a]=this.compute3PointAngle();this.startAngle=THREE.MathUtils.degToRad(n),this.endAngle=THREE.MathUtils.degToRad(o),this.upDataClockwise(n,o,a)}getArcMidPoint(){const n=MxFun.getMxFunTHREE();this.updateDataInfo();let{startAngle:o,endAngle:a,center:m,radius:c,clockwise:x}=this;x?o<a&&(o+=2*Math.PI):o>a&&(a+=2*Math.PI);const A=(o+a)/2,H=m.x+c*Math.cos(A),F=m.y+c*Math.sin(A);return new n.Vector3(H,F,0)}moveGripPointsAt(n,o){return n===0?this.point1.add(o):n===1?this.point2.add(o):n===2?this.point3.add(o):n===3&&(this.point1.add(o),this.point2.add(o),this.point3.add(o)),this.upDateCenter(),!0}}Mx3PointArc.cmd="Mx_3PointArc",Mx3PointArc.draw=drawMx3PointArc,Mx3PointArc.isRegister=!1,addRegisterMxDbEntity(Mx3PointArc);const drawMx2PointArc=async()=>{const b=new MrxDbgUiPrPoint,n=new Mx2PointArc,o=await b.go();if(!o)return;n.startPoint=o,b.setUserDraw((m,c)=>{n.endPoint=m,c.drawCustomEntity(n)});const a=await b.go();a&&(n.endPoint=a,MxFun.getCurrentDraw().addMxEntity(n))};class Mx2PointArc extends Mx3PointArc{getTypeName(){return"Mx2PointArc"}create(){return new Mx2PointArc}get startPoint(){return this.point1}set startPoint(n){this.point1=n,this.point3.x,this.point1.x,this.point3.y,this.point2.y}get endPoint(){return this.point2}set endPoint(n){this.point2=n,this.point3=this.getArcMidPoint()}}function drawMxDbCoord(){const b=new MrxDbgUiPrPoint;b.setMessage(`
指定坐标点:`),b.go(n=>{if(n!=0)return;const o=b.value();let a=new MxDbCoord;a.point1=o,a.point2=o.clone(),b.setBasePt(o),b.setUseBasePt(!0),b.setUserDraw((m,c)=>{a.point2=m,c.drawCustomEntity(a)}),b.setMessage(`
指定标注点:`),b.go(m=>{m==0?(a.point2=b.value(),MxFun.addToCurrentSpace(a)):console.log(m)})})}Mx2PointArc.cmd="Mx_2PointArc",Mx2PointArc.draw=drawMx2PointArc,Mx2PointArc.isRegister=!1,addRegisterMxDbEntity(Mx2PointArc);class MxDbCoord extends MxDbEntity{constructor(){super(...arguments),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3}worldDraw(n){let o=n.getMxObject();n.drawLine(this.point1,this.point2);let a=this.point2.clone();var m=o.screenCoordLong2Doc(20),c=6*m;a.x=a.x+c,n.drawLine(this.point2,a);var x=new THREE.Vector3,A=new THREE.Vector3;let H=o.docCoord2Cad(this.point1.x,this.point1.y,this.point1.z),F=H.x.toFixed(3),P=H.y.toFixed(3);x.x=this.point2.x+.3*m+.5*c,x.y=this.point2.y+.1*m+.5*m,n.drawText(F,m,0,x),A.x=this.point2.x+.3*m+.5*c,A.y=this.point2.y-.1*m-.5*m,n.drawText(P,m,0,A)}getGripPoints(){let n=[];return n.push(this.point1),n.push(this.point2),n}moveGripPointsAt(n,o){return n==0?this.point1.add(o):n==1&&this.point2.add(o),!0}dwgIn(n){return this.onDwgIn(n),this.point1.copy(n.point1),this.point2.copy(n.point2),!0}dwgOut(n){return this.onDwgOut(n),n.point1=this.point1,n.point2=this.point2,n}create(){return new MxDbCoord}transformBy(n){this.point1.applyMatrix4(n),this.point2.applyMatrix4(n)}getTypeName(){return"MxDbCoord"}}async function drawMxDbLine(){const b=new MrxDbgUiPrPoint;b.setMessage(`
指定第一点:`);let n=await b.go();if(n==null)return;b.setBasePt(n.clone()),b.setUseBasePt(!0),b.setMessage(`
指定第二点:`);let o=await b.go();if(o==null)return;let a=new MxDbLine;a.pt1=n,a.pt2=o,MxFun.addToCurrentSpace(a)}MxDbCoord.cmd="Mx_Coord",MxDbCoord.draw=drawMxDbCoord,addRegisterMxDbEntity(MxDbCoord);class MxDbLine extends MxDbEntity{constructor(){super(...arguments),this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3}getTypeName(){return"MxDbLine"}worldDraw(n){n.drawLine(this.pt1,this.pt2)}setPoint1(n){this.pt1=n}getPoint1(){return this.pt1}setPoint2(n){this.pt2=n}getPoint2(){return this.pt2}getGripPoints(){let n=[];n.push(this.pt1),n.push(this.pt2);let o=new THREE.Vector3(this.pt1.x+.5*(this.pt2.x-this.pt1.x),this.pt1.y+.5*(this.pt2.y-this.pt1.y),0);return n.push(o),n}moveGripPointsAt(n,o){return n==0?this.pt1.add(o):n==1?this.pt2.add(o):n==2&&(this.pt1.add(o),this.pt2.add(o)),!0}dwgIn(n){return this.onDwgIn(n),this.pt1.copy(n.pt1),this.pt2.copy(n.pt2),!0}dwgOut(n){return this.onDwgOut(n),n.pt1=this.pt1,n.pt2=this.pt2,n}create(){return new MxDbLine}getGeomExtents(){return new THREE.Box3(this.pt1,this.pt2)}getGetLength(){return this.pt1.distanceTo(this.pt2)}}async function drawMxDbRect(){const b=new MrxDbgUiPrPoint;b.setMessage(`
指定第一点:`);let n=await b.go();if(!n)return;let o=new MxDbRect;o.pt1=n;const a=new McEdGetPointWorldDrawObject;a.setDraw(m=>{o.pt2=m,a.drawCustomEntity(o)}),b.setBasePt(n),b.setUseBasePt(!0),b.setUserDraw(a),b.setMessage(`
指定第二点:`),await b.go()&&(o.pt2=b.value(),MxFun.getCurrentDraw().addMxEntity(o))}MxDbLine.cmd="Mx_Line",MxDbLine.draw=drawMxDbLine,addRegisterMxDbEntity(MxDbLine);class MxDbRect extends MxDbEntity{constructor(){super(...arguments),this.cornerRadius=[],this.pt1=new THREE.Vector3,this.pt2=new THREE.Vector3,this.isSolidColorFill=!1,this.isLoadMaterialFromPath=!0,this.material=null}worldDraw(n){let o=computeRectPoints(this.pt1,this.pt2);if(this.cornerRadius.length>0&&(o=getToGenerateRoundedCorners(o,this.cornerRadius)),n.getType()!=McGiWorldDrawType$1.kWorldDraw)return o.push(o[0]),void n.drawLines(o);const a={transparent:!0,depthTest:!1,opacity:this.opacity,visible:this.visible};if(this.isSolidColorFill){let m;o=o.map(({x:A,y:H})=>new THREE.Vector2(A,H)),m=new THREE.ShapeGeometry(new THREE.Shape(o));let c=new THREE.MeshBasicMaterial(Object.assign({color:this.filter?this.filter._getFilterColor(this.color,this.opacity):new THREE.Color(this.color)},a)),x=new THREE.Mesh(m,c);n.drawEntity(x)}else if(this.fillImageSrc){if(this.material){o=o.map(({x:A,y:H})=>new THREE.Vector2(A,H));let m=this.material,c=new THREE.ShapeGeometry(new THREE.Shape(o));if(c=repairGeometryFaceVertexUvs(c),this.filter){const A=m.map;this.fillImageParam&&(this.fillImageParam.center&&(A.center=this.fillImageParam.center),this.fillImageParam.offset&&(A.offset=this.fillImageParam.offset),this.fillImageParam.repeat&&(A.repeat=this.fillImageParam.repeat),this.fillImageParam.rotation&&(A.rotation=this.fillImageParam.rotation));const H=this.filter._getFilterShaderData(A);m=new THREE.ShaderMaterial(Object.assign(Object.assign({},H),a))}m.depthTest=!1,m.transparent=!0,m.opacity=this.opacity,m.visible=this.visible;let x=new THREE.Mesh(c,m);n.drawEntity(x)}else if(this.fillImageSrc.length>0&&this.isLoadMaterialFromPath){let m=this;MxFun.loadImageMaterial(this.fillImageSrc,c=>{this.isLoadMaterialFromPath=!1,c&&(m.material=c,m.setNeedUpdateDisplay(),MxFun.updateDisplay())})}}else n.drawLines([...o,o[0]])}getGripPoints(){let n=[];n.push(this.pt1);const o=new THREE.Line3(this.pt1,this.pt2);let a=new THREE.Vector3;return o.getCenter(a),n.push(a),n.push(this.pt2),n}moveGripPointsAt(n,o){return n==0?this.pt1.add(o):n==1?(this.pt1.add(o),this.pt2.add(o)):n==2&&this.pt2.add(o),!0}dwgIn(n){return this.onDwgIn(n),this.pt1.copy(n.pt1),this.pt2.copy(n.pt2),this.isSolidColorFill=n.isSolidColorFill,this.fillImageSrc=n.fillImageSrc,this.fillImageParam=n.fillImageParam,this.cornerRadius=n.cornerRadius,this.filter=n.filter,this.isLoadMaterialFromPath=!0,this.material=null,!0}dwgOut(n){return this.onDwgOut(n),n.pt1=this.pt1,n.pt2=this.pt2,n.isSolidColorFill=this.isSolidColorFill,n.fillImageSrc=this.fillImageSrc,n.fillImageParam=this.fillImageParam,n.cornerRadius=this.cornerRadius,n.filter=this.filter,n}create(){return new MxDbRect}transformBy(n){this.pt1.applyMatrix4(n),this.pt2.applyMatrix4(n)}setRadius(n,o=!0){this.cornerRadius=n instanceof Array?n.map(a=>o?MxFun.screenCoordLong2Doc(a):a):n>0?o?[MxFun.screenCoordLong2Doc(n),MxFun.screenCoordLong2Doc(n),MxFun.screenCoordLong2Doc(n),MxFun.screenCoordLong2Doc(n)]:[n,n,n,n]:[]}getTypeName(){return"MxDbRect"}getFilter(){return this.filter}setFilter(n){this.filter=n,this.isLoadMaterialFromPath=!0,this.material=null}setFillImagePath(n){this.fillImageSrc=n,this.isLoadMaterialFromPath=!0,this.material=null,this.fillImageSrc&&(this.isSolidColorFill=!1)}getFillImagePath(){return this.fillImageSrc}}function drawMxDbAlignedDimension(){let b=new MxDbAlignedDimension;const n=new MrxDbgUiPrPoint;return n.setMessage(`
指定第一点:`),n.go(o=>{if(o!=0)return;const a=n.value();b.setPoint1(a),b.setColor(65314);const m=new McEdGetPointWorldDrawObject;m.setDraw(c=>{b.setPoint2(c),m.drawCustomEntity(b)}),n.setBasePt(a),n.setUseBasePt(!0),n.setUserDraw(m),n.setMessage(`
指定第二点:`),n.setInputToucheType(MxType.InputToucheType.kGetEnd),n.go(c=>{if(c!=0)return void console.log(c);const x=n.value();b.setPoint2(x),MxFun.getCurrentDraw().addMxEntity(b)})}),b}MxDbRect.cmd="Mx_DrawRect",MxDbRect.draw=drawMxDbRect,addRegisterMxDbEntity(MxDbRect);const propertyDbKeys$5=["point1","point2","fontColor"];class MxDbAlignedDimension extends MxDbEntity{constructor(n){if(super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,n){const{points:o,fontColor:a}=n;o&&this.setPoints(o),a&&(this.fontColor=a)}}setPoints(n){const[o,a]=n;o&&(this.point1=o),a&&(this.point2=a)}getTypeName(){return"MxDbAlignedDimension"}getDirection(n,o,a){const m=new THREE.Vector3(n.x,n.y,0),c=new THREE.Vector3(1,0,0),x=n.angleTo(c);let A=-1;(x<7*Math.PI/18||x>10*Math.PI/18)&&o.x>a.x&&(A=1);const H=new THREE.Matrix4;return H.makeRotationZ(Math.PI/2*A),m.applyMatrix4(H),m}getDimText(){return new THREE.Vector3(this.point1.x-this.point2.x,this.point1.y-this.point2.y,0).length().toFixed(3)}worldDraw(n){if(n.setOpacity(this.opacity),n.getType()==McGiWorldDrawType$1.kWorldDraw||n.getType()==McGiWorldDrawType$1.kDynDragDraw){let T=function(B,D){Array.isArray(B)?B.forEach(N=>{T(N,D)}):B.opacity=D};const o=this.point1,a=this.point2;let m,c,x,A,H,F,P;const g=new THREE.Vector3(o.x-a.x,o.y-a.y,0),E=this.getDirection(g,o,a),_=new THREE.Matrix4;_.makeScale(.01,.01,.01);const k=new THREE.Vector3(E.x,E.y,0);k.applyMatrix4(_);const U=new THREE.Vector3(o.x+k.x,o.y+k.y,0),C=new THREE.Vector3(a.x+k.x,a.y+k.y,0),S=this.getColor();F=MxThreeJS.createPoint(o,S),P=MxThreeJS.createPoint(a,S);const Y=new THREE.Vector3(E.x,E.y,0),G=new THREE.Vector3(E.x,E.y,0);_.identity(),_.makeScale(.2,.2,0),Y.applyMatrix4(_),_.identity(),_.makeScale(.02,.02,0),G.applyMatrix4(_),n.drawLine(U.x+2*G.x,U.y+2*G.y,C.x+2*G.x,C.y+2*G.y),m=MxThreeJS.createLine(new THREE.Vector3(U.x+3*G.x,U.y+3*G.y,0),new THREE.Vector3(o.x+.5*G.x,o.y+.5*G.y,0),S),c=MxThreeJS.createLine(new THREE.Vector3(C.x+3*G.x,C.y+3*G.y,0),new THREE.Vector3(a.x+.5*G.x,a.y+.5*G.y,0),S);{const B=new THREE.Vector3(1,0,0);let D=g.angleTo(B);const N=new THREE.Vector3(E.x,E.y,0);N.normalize();const I=o.distanceTo(a);g.y<0?D=D<Math.PI/2?2*Math.PI-D:Math.PI-D:D>Math.PI/2&&(D=Math.PI+D);const h=n.getMxObject();h&&(D-=h.getViewAngle());const u=this.getDimText();(x=MxThreeJS.creatTextSprite(u,new THREE.Vector3(C.x+g.x/2+N.x*I/15,C.y+g.y/2+N.y*I/15,0),.07*I,D,this.fontColor||S))!=null&&(x.material.opacity=this.opacity,n.drawEntity(x))}{_.identity(),_.makeScale(.08,.08,.08);const B=new THREE.Matrix4;B.makeRotationZ(17*Math.PI/18);let D=new THREE.Vector3(g.x,g.y,0);D.applyMatrix4(_),D.applyMatrix4(B),B.identity(),B.makeRotationZ(17*-Math.PI/18);let N=new THREE.Vector3(g.x,g.y,0);N.applyMatrix4(_),N.applyMatrix4(B);const I=new Array;I.push(new THREE.Vector3(U.x+2*G.x,U.y+2*G.y,0),new THREE.Vector3(U.x+2*G.x+D.x,U.y+D.y+2*G.y,0),new THREE.Vector3(U.x+2*G.x+N.x,U.y+N.y+2*G.y,0)),A=MxThreeJS.createTriangle(I,S),B.identity(),B.makeRotationZ(Math.PI/18),(D=new THREE.Vector3(g.x,g.y,0)).applyMatrix4(_),D.applyMatrix4(B),B.identity(),B.makeRotationZ(-Math.PI/18),(N=new THREE.Vector3(g.x,g.y,0)).applyMatrix4(_),N.applyMatrix4(B);const h=new Array;h.push(new THREE.Vector3(C.x+2*G.x,C.y+2*G.y,0),new THREE.Vector3(C.x+D.x+2*G.x,C.y+D.y+2*G.y,0),new THREE.Vector3(C.x+N.x+2*G.x,C.y+N.y+2*G.y,0)),H=MxThreeJS.createTriangle(h,S)}n.drawEntity(m),n.drawEntity(c),A&&(T(A.material,this.opacity),n.drawEntity(A)),H&&(T(H.material,this.opacity),n.drawEntity(H)),n.drawEntity(F),n.drawEntity(P)}else n.drawLine(this.point1,this.point2)}setPoint1(n){this.point1=n}setPoint2(n){this.point2=n}setColor(n){return lodash.isArray(n)?([this.color=this.color,this.fontColor=this.fontColor||this.color]=n,console.log("this.fontColor : ",this.fontColor)):this.color=n,this}getGripPoints(){let n=[];return n.push(this.point1),n.push(this.point2),n}moveGripPointsAt(n,o){return n==0?this.point1.add(o):(n=1)&&this.point2.add(o),!0}dwgIn(n){return this.onDwgIn(n),this.dwgInHelp(n,propertyDbKeys$5),!0}dwgOut(n){return this.onDwgOut(n),this.dwgOutHelp(n,propertyDbKeys$5),n}create(){return new MxDbAlignedDimension}}MxDbAlignedDimension.cmd="Mx_DimensionMeasurement",MxDbAlignedDimension.draw=drawMxDbAlignedDimension,addRegisterMxDbEntity(MxDbAlignedDimension);class MxDbHatch extends MxDbEntity{constructor(){super(...arguments),this.points=[]}worldDraw(n){n.getType()===McGiWorldDrawType$1.kWorldDraw?n.drawSolid(this.points):n.drawLines([...this.points,this.points[0]])}getTypeName(){return"MxDbHatch"}moveGripPointsAt(n,o){return n===0?this.points.forEach(a=>{a.add(o)}):this.points[n-1]&&this.points[n-1].add(o),!0}setPoints(n){this.points=n.map(o=>o.clone())}getGripPoints(){if(this.points.length>0){const{centerPoint:n}=computeBounding(this.points);return[n,...this.points]}return[]}dwgIn(n){this.onDwgIn(n);const o=n.points;return this.points=o.map(({x:a,y:m,z:c})=>new THREE.Vector3(a,m,c)),!0}dwgOut(n){return this.onDwgOut(n),n.points=this.points,n}}function drawMxDbArea(){const b=new MrxDbgUiPrPoint;b.setMessage(`
指定第一点:`),b.go(n=>{if(n!=0)return;const o=b.value();let a=new MxDbArea;a.addPoint(o);const m=new McEdGetPointWorldDrawObject;m.setDraw((c,x)=>{let A=a.clone();A.addPoint(c),m.drawCustomEntity(A)}),b.setUserDraw(m),b.setMessage(`
指定下一点:`),b.goWhile(c=>{if(c==0){const x=b.value();a.addPoint(x)}},c=>{a.isFill=!0,a.fillOpacity=.7,a.fillColor=6697540,MxFun.getCurrentDraw().addMxEntity(a)})})}addRegisterMxDbEntity(MxDbHatch);class MxDbArea extends MxDbEntity{constructor(){super(...arguments),this.points=[],this.isFill=!1,this.fillColor=6697540,this.fillOpacity=.7}getTypeName(){return"MxDbArea"}create(){return new MxDbArea}getDimText(){return McGeTool.calcArea(this.points).toFixed(2)}worldDraw(n){if(this.points.length<3)return void(this.points.length==2&&n.drawLine(this.points[0],this.points[1]));let o=this.points[0],a=o.clone(),m=o.clone(),c=this.points.length;for(let P=1;P<c;P++){let g=this.points[P];a.x>g.x&&(a.x=g.x),a.y>g.y&&(a.y=g.y),m.x<g.x&&(m.x=g.x),m.y<g.y&&(m.y=g.y),n.drawLine(o,g),o=g}n.drawLine(o,this.points[0]);let x=new THREE.Vector3(a.x+.5*(m.x-a.x),a.y+.5*(m.y-a.y));const A=n.getColor();let H=MxFun.screenCoordLong2Doc(20),F=MxThreeJS.creatTextSprite(this.getDimText(),x,H,0,A);if(F!=null&&n.drawEntity(F),n.getType()==McGiWorldDrawType$1.kWorldDraw&&this.isFill){n.setColor(this.fillColor),n.setOpacity(this.fillOpacity),n.setRenderOrder(n.getRenderOrder()-1);const P=new MxDbHatch;P.points=this.points,P.worldDraw(n)}}getGripPoints(){return this.points}moveGripPointsAt(n,o){return!(n>=this.points.length||(this.points[n].add(o),0))}dwgIn(n){this.onDwgIn(n);let o=n.points;return this.points=[],o.forEach(a=>{this.points.push(new THREE.Vector3(a.x,a.y,a.z))}),this.dwgInHelp(n,["isFill","fillColor","fillOpacity"]),!0}dwgOut(n){return this.onDwgOut(n),n.points=this.points,this.dwgOutHelp(n,["isFill","fillColor","fillOpacity"]),n}addPoint(n){this.points.push(n.clone())}getPoints(){return this.points}clearPoint(){this.points=[]}}async function drawMxDbLeadTag(){let n=await new MrxDbgUiPrPoint().go();if(!n)return;let o=prompt("请输入文字批注","批注");if(!o)return;const a=new MxDbLeadTag;a.point=n,a.text=o,MxFun.addToCurrentSpace(a)}MxDbArea.cmd="Mx_Area",MxDbArea.draw=drawMxDbArea,addRegisterMxDbEntity(MxDbArea);class MxDbLeadTag extends MxDbEntity{constructor(){super(...arguments),this.point=new THREE.Vector3,this.leadLen=88,this.text="",this.textHeight=24}getTypeName(){return"MxDbLeadTag"}createDots(n,o){const{x:a,y:m,z:c}=n,x=new THREE.Shape;x.arc(a,m,o.screenCoordLong2Doc(6),0,2*Math.PI,!0);const A=new THREE.Path;A.arc(a,m,o.screenCoordLong2Doc(3),0,2*Math.PI,!0),x.holes.push(A);const H=new THREE.ShapeGeometry(x),F=new THREE.MeshPhongMaterial({color:"#ff0000",transparent:!0}),P=new THREE.Shape;P.arc(a,m,o.screenCoordLong2Doc(3),0,2*Math.PI,!0);const g=new THREE.ShapeGeometry(P),E=new THREE.MeshPhongMaterial({color:"#e2da8f",transparent:!0}),_=new THREE.Mesh(H,F),k=new THREE.Mesh(g,E);return _.add(k),_}worldDraw(n){let o=n.getMxObject();const a=this.createDots(this.point,o);if(n.drawEntity(a),a.geometry.computeBoundingBox(),n.drawSelectLine(a.geometry.boundingBox.max,a.geometry.boundingBox.min),n.getType()===2)return;let m=n.getMxObject().screenCoordLong2Doc(this.leadLen),c=new THREE.Vector3(this.point.x+2*m,this.point.y+m,0);const x=c.x-m,A=new THREE.Vector3(x,c.y,c.z);n.setLineWidth(4),n.setColor(16770565),n.drawLines([this.point,A,c]);const H=n.getMxObject().screenCoordLong2Doc(this.textHeight),F=c.clone().setX(c.x);n.setColor(16744448);const P=MxThreeJS.creatTextSprite(this.text,F,H,0,n.getColor());if(P){const g=new THREE.Box3,E=new THREE.Vector3;g.expandByObject(P),g.getSize(E),P.position.setX(P.position.x+E.x/2);const _=n.getMxObject().screenCoordLong2Doc(5),k=g.min.clone().setX(g.min.x+E.x/2).setY(g.min.y-_),U=g.max.clone().setX(g.max.x+E.x/2).setY(g.min.y+_);U.setY(g.max.y+_);const C=new THREE.Vector3(k.x,U.y),S=new THREE.Vector3(U.x,k.y);n.setColor(16777215),n.setLineWidth(0),n.drawLine(k,C),n.drawLine(U,S),n.drawLine(k,S),n.drawLine(C,U);const Y=_/2,G=[],T=[];G.push(new THREE.Vector3(C.x+Y,C.y-_,C.z),new THREE.Vector3(C.x+Y,C.y-Y,C.z),new THREE.Vector3(C.x+_,C.y-Y,C.z)),T.push(new THREE.Vector3(S.x-Y,S.y+_,S.z),new THREE.Vector3(S.x-Y,S.y+Y,S.z),new THREE.Vector3(S.x-_,S.y+Y,S.z)),n.drawLines(G),n.drawLines(T),n.setOpacity(.5),n.setColor(6697540),n.setRenderOrder(-100),n.drawSolid([k,C,U,S]),n.setRenderOrder(100),n.drawEntity(P)}}getGripPoints(){return[this.point]}onViewChange(){return this.setNeedUpdateDisplay(),!0}moveGripPointsAt(n,o){return n===0&&this.point.add(o),!0}dwgIn(n){return this.onDwgIn(n),this.dwgInHelp(n,["point","text","textHeight","leadLen"]),!0}dwgOut(n){return this.onDwgOut(n),this.dwgOutHelp(n,["point","text","textHeight","leadLen"]),n}}function drawMxDbAnyLine(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject,a=new MxDbAnyLine;b.setUserDraw(o),b.setMessage(`
点击开始画线:`),b.go(m=>{m===MrxDbgUiPrBaseReturn$1.kOk&&(a.points.push(b.value()),o.setDraw(c=>{a.points.push(c.clone()),o.drawCustomEntity(a)})),b.setMessage(`
再次点击结束画线:`),b.go(c=>{c===MrxDbgUiPrBaseReturn$1.kOk&&n.addMxEntity(a)})})}MxDbLeadTag.cmd="Mx_LeadTag",MxDbLeadTag.draw=drawMxDbLeadTag,addRegisterMxDbEntity(MxDbLeadTag);const propertyDbKeys$4=["points"];class MxDbAnyLine extends MxDbEntity{constructor(){super(...arguments),this.points=[]}getTypeName(){return"MxDbAnyLine"}create(){return new MxDbAnyLine}worldDraw(n){let o=n.getMxObject();const a=new THREE.Box3().setFromPoints(this.points);let m=new THREE.Vector3;if(a.getCenter(m),n.drawLines(this.points),n.getType()===McGiWorldDrawType$1.kSelectDraw){const c=new THREE.Vector3;a.getSize(c),c.addScalar(o.screenCoordLong2Doc(20));const x=c.x/2,A=c.y/2,H={x:m.x-x,y:m.y-A},F={x:m.x+x,y:m.y-A},P={x:m.x+x,y:m.y+A},g={x:m.x-x,y:m.y+A};n.drawLine(F.x,F.y,P.x,P.y),n.drawLine(H.x,H.y,F.x,F.y),n.drawLine(P.x,P.y,g.x,g.y),n.drawLine(g.x,g.y,H.x,H.y)}}setPoints(n){return this.points=n,this}getCenter(){const n=new THREE.Geometry;n.vertices=this.points;const o=new THREE.Vector3;return n.computeBoundingBox(),n.boundingBox.getCenter(o),o}getGripPoints(){return[this.getCenter()]}moveGripPointsAt(n,o){return n===0&&this.points.forEach(a=>{a.add(o)}),!0}dwgIn(n){return this.onDwgIn(n),this.dwgInHelp(n,propertyDbKeys$4),!0}dwgOut(n){return this.onDwgOut(n),this.dwgOutHelp(n,propertyDbKeys$4),n}}function drawMxDbCloudLine(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;b.setMessage(`
点击开启绘制云线:`),b.go(()=>{const a=MxFun.screenCoordLong2Doc(16);let m=b.value();const c=new MxDbCloudLine;c.setRadius(a),c.addPoint(m),o.setDraw(x=>{m.distanceTo(x)>a&&(m=x.clone(),c.addPoint(x,!0)),o.drawCustomEntity(c)}),b.setUserDraw(o),b.setMessage(`
再次点击结束绘制云线:`),b.go(()=>{n.addMxEntity(c)})})}MxDbAnyLine.cmd="Mx_AnyLine",MxDbAnyLine.draw=drawMxDbAnyLine,addRegisterMxDbEntity(MxDbAnyLine);const propertyDbKeys$3=["points","radius"];class MxDbCloudLine extends MxDbEntity{constructor(){super(),this.points=[],this.radius=16,this.cachePoint=null,this.use_smallcoord_display=!0}getTypeName(){return"MxDbCloudLine"}create(){return new MxDbCloudLine}setRadius(n){this.radius=n}getRadius(){return this.radius}getCachePoint(){return this.cachePoint}clacNewArcDiameterPoint(n){if(this.points.length==0)return n;let o=this.points[this.points.length-1];const a=2*this.radius,m=o.distanceTo(n);if(m<a)return null;const c=a*(n.x-o.x)/m+o.x,x=a*(n.y-o.y)/m+o.y;return new THREE.Vector3(c,x,o.z)}createCloudArcCurvePoints(n,o,a){const m=new THREE.Vector3((n.x+o.x)/2,(n.y+o.y)/2,0);a||(a=m.distanceTo(n));const{startAngle:c,endAngle:x}=function(A,H,F){const P=2*Math.PI/360;return{startAngle:180*Math.atan2(H.y-A.y,H.x-A.x)/Math.PI*P,endAngle:180*Math.atan2(F.y-A.y,F.x-A.x)/Math.PI*P}}(m,n,o);return new THREE.ArcCurve(m.x,m.y,a,c,x,!0).getPoints(10)}addPoint(n,o){let a=this.clacNewArcDiameterPoint(n);a&&(this.points.push(a),this.cachePoint=null,o&&(this.cachePoint=this.reCalculateDrawGeometryPoint()))}addLine(n,o){this.addPoint(n);const a=2*this.radius;let m=this.points[this.points.length-1],c=m.distanceTo(o);const x=Math.round(c/a);for(let A=0;A<x;A++){c=m.distanceTo(o);const H=a*(o.x-m.x)/c+m.x,F=a*(o.y-m.y)/c+m.y;let P=new THREE.Vector3(H,F,o.z);this.addPoint(P),m=P}return this.addPoint(o),this.points[this.points.length-1]}reCalculateDrawGeometryPoint(){if(this.points.length<2)return null;let n=this.points[0],o=this.points.length,a=[];for(let m=1;m<o;m++){let c=this.points[m];this.createCloudArcCurvePoints(n,c).forEach(x=>{a.push(new THREE.Vector3(x.x,x.y,0))}),n=c}return a}worldDraw(n){if(this.cachePoint||(this.cachePoint=this.reCalculateDrawGeometryPoint()),!this.cachePoint)return;let o=n.getMxObject();if(n.getType()===McGiWorldDrawType$1.kSelectDraw){let a=new THREE.Geometry;this.cachePoint.forEach(E=>{a.vertices.push(new THREE.Vector3(E.x,E.y,0))}),a.computeBoundingBox();const m=new THREE.Vector3;a.boundingBox.getSize(m);let c=new THREE.Vector3;a.boundingBox.getCenter(c);const x=m.x/2,A=m.y/2,H={x:c.x-x,y:c.y-A},F={x:c.x+x,y:c.y-A},P={x:c.x+x,y:c.y+A},g={x:c.x-x,y:c.y+A};n.drawLine(this.toSmallcoord2(o,H.x,H.y),this.toSmallcoord2(o,F.x,F.y)),n.drawLine(this.toSmallcoord2(o,F.x,F.y),this.toSmallcoord2(o,P.x,P.y)),n.drawLine(this.toSmallcoord2(o,P.x,P.y),this.toSmallcoord2(o,g.x,g.y)),n.drawLine(this.toSmallcoord2(o,g.x,g.y),this.toSmallcoord2(o,H.x,H.y))}else{let a=[];this.cachePoint.forEach(m=>{a.push(this.toSmallcoord(o,m))}),n.drawLines(a)}}getCenter(){const n=new THREE.Geometry;n.vertices=this.points;let o=new THREE.Vector3;return n.computeBoundingBox(),n.boundingBox.getCenter(o),o}getGripPoints(){return[this.getCenter()]}moveGripPointsAt(n,o){return this.points.forEach(a=>{a.add(o)}),this.cachePoint=null,!0}dwgIn(n){return this.onDwgIn(n),this.dwgInHelp(n,propertyDbKeys$3),this.cachePoint=null,!0}dwgOut(n){return this.onDwgOut(n),this.dwgOutHelp(n,propertyDbKeys$3),n.type===MxType.MxCloneType.kSaveDwgClone&&this.dwgOutHelp(n,["cachePoint"]),n}}function drawMxDbRegularPolygon(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject,a=new MxDbRegularPolygon;b.setMessage(`
点击开始绘制多边形:`),b.go(()=>{let m=prompt("请输入多边形的边数","8");m&&(a.sidesNumber=Number(m),a.centerPoint=b.value(),b.setUserDraw(o),o.setDraw(c=>{a.otherPoint=c,o.drawCustomEntity(a)}),b.setMessage(`
再次点击结束绘制多边形:`),b.go(()=>{n.addMxEntity(a)}))})}MxDbCloudLine.isRegister=!1,MxDbCloudLine.cmd="Mx_CloudLine",MxDbCloudLine.draw=drawMxDbCloudLine,addRegisterMxDbEntity(MxDbCloudLine);class MxDbRegularPolygon extends MxDbShape{getTypeName(){return"MxDbRegularPolygon"}constructor(){super(),this.centerPoint=new THREE.Vector3,this.otherPoint=new THREE.Vector3,this.sidesNumber=5,this._propertyDbKeys=[...this._propertyDbKeys,"centerPoint","otherPoint","sidesNumber"]}worldDraw(n){const o=computeRegularPolygonVertices(this.centerPoint,this.otherPoint,this.sidesNumber);this.closed=!1,o.push(o[0]),this._draw(n,o),this._drawStoreLine(n,o)}getGripPoints(){return[this.centerPoint,this.otherPoint]}moveGripPointsAt(n,o){return n===0?(this.centerPoint.add(o),this.otherPoint.add(o)):n===1&&this.otherPoint.add(o),!0}}function drawMxDbLeadComment(){const b=new MrxDbgUiPrPoint;b.setMessage(`
指定第一点:`),b.go(n=>{if(n!=0)return;const o=b.value();let a=new MxDbLeadComment;a.point1=o.clone(),a.textHeight=MxFun.screenCoordLong2Doc(50);let m=prompt("请输入文字批注","批注");if(!m)return;a.text=m,a.textWidth=MxFun.screenCoordLong2Doc(10*m.length),a.fixedSize=!0,a.fixedSize&&(a.textHeight=50,a.textWidth=50*m.length);const c=new McEdGetPointWorldDrawObject;c.setDraw((x,A)=>{a.point2=x,A.drawCustomEntity(a)}),b.setBasePt(o),b.setUseBasePt(!0),b.setUserDraw(c),b.setMessage(`
指定第二点:`),b.go(x=>{if(x!=0)return void console.log(x);const A=b.value();a.point2=A,MxFun.addToCurrentSpace(a)})})}MxDbRegularPolygon.cmd="Mx_RegularPolygon",MxDbRegularPolygon.draw=drawMxDbRegularPolygon,addRegisterMxDbEntity(MxDbRegularPolygon);class MxDbLeadComment extends MxDbEntity{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.text="",this.textHeight=20,this.textWidth=0,this.fixedSize=!1,this.use_smallcoord_display=!0}getTypeName(){return"MxDbLeadComment"}create(){return new MxDbLeadComment}worldDraw(n){let o=n.getMxObject(),a=this.toSmallcoord(o,this.point1),m=this.toSmallcoord(o,this.point2);if(n.drawLine(a,m),this.text.length>0){const c=new THREE.Vector3;let x=this.textHeight,A=this.textWidth;this.fixedSize&&(x=o.screenCoordLong2Doc(x),A=o.screenCoordLong2Doc(A));let H=MxThreeJS.clacTextSpriteSize(this.text,x,A);c.x=m.x+.5*H.textwidth,c.y=m.y+.5*H.allTextHeight,n.drawText(this.text,x,0,c,A);const F=new THREE.Vector3;F.x=m.x+H.textwidth,F.y=m.y,n.drawLine(F,m)}}getGripPoints(){let n=[];return n.push(this.point1),n.push(this.point2),n}moveGripPointsAt(n,o){return n==0?this.point1.add(o):n==1&&this.point2.add(o),!0}dwgIn(n){return this.onDwgIn(n),this.point1.copy(n.point1),this.point2.copy(n.point2),this.text=n.text.substr(0),this.textHeight=n.textHeight,n.textWidth&&(this.textWidth=n.textWidth),this.fixedSize=n.fixedSize,!0}dwgOut(n){return this.onDwgOut(n),n.point1=this.point1,n.point2=this.point2,n.textHeight=this.textHeight,n.text=this.text,n.textWidth=this.textWidth,n.fixedSize=this.fixedSize,n}onViewChange(){return!!this.fixedSize&&(this.setNeedUpdateDisplay(!1),!0)}}function drawMxDbRectBoxLeadComment(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject,a=new MxDbRectBoxLeadComment;a.setLineWidth(3),a.setLineWidthByPixels(!0),b.setMessage(`
云线框起始点:`),b.go(m=>{a.radius=MxFun.screenCoordLong2Doc(8),m==MrxDbgUiPrBaseReturn$1.kOk&&(a.point1=b.value(),o.setDraw(c=>{a.point2=c,o.drawCustomEntity(a)}),b.setUserDraw(o),b.setMessage(`
云线框结束点:`),b.go(c=>{if(c!=MrxDbgUiPrBaseReturn$1.kOk)return;a.point2=b.value(),o.setDraw(A=>{a.point3=A,o.drawCustomEntity(a)});let x=prompt("请输入文字批注","批注");x||(x="默认批注文字"),a.text=x,a.textWidth=MxFun.screenCoordLong2Doc(10*x.length),a.textHeight=MxFun.screenCoordLong2Doc(5*x.length),a.fixedSize=!0,a.fixedSize&&(a.textHeight=20,a.textWidth=20*x.length),b.setMessage(`
审图标注点:`),b.go(A=>{A==MrxDbgUiPrBaseReturn$1.kOk&&(a.point3=b.value(),n.addMxEntity(a))})}))})}MxDbLeadComment.cmd="Mx_Comment",MxDbLeadComment.draw=drawMxDbLeadComment,addRegisterMxDbEntity(MxDbLeadComment);class MxDbRectBoxLeadComment extends MxDbEntity{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.point3=new THREE.Vector3,this.text="",this.textHeight=20,this.radius=16,this.textWidth=0,this.fixedSize=!1,this.use_smallcoord_display=!0}getTypeName(){return"MxDbRectBoxLeadComment"}create(){return new MxDbRectBoxLeadComment}getCloudLine(){let n=new MxDbCloudLine;n.setRadius(this.radius);let o=this.point1.clone(),a=this.point2.clone();if(o.x>a.x){let H=o.x;o.x=a.x,a.x=H}if(o.y>a.y){let H=o.y;o.y=a.y,a.y=H}let m=new THREE.Vector3(o.x,a.y,o.z);m=n.addLine(o,m),a=new THREE.Vector3(a.x,m.y,a.z),a=n.addLine(m,a);let c=new THREE.Vector3(a.x,o.y,o.z);c=n.addLine(a,c);let x=o=n.addLine(c,o),A=o.distanceTo(this.point3);return A>m.distanceTo(this.point3)&&(x=m,A=m.distanceTo(this.point3)),A>a.distanceTo(this.point3)&&(x=a,A=a.distanceTo(this.point3)),A>c.distanceTo(this.point3)&&(x=c,A=c.distanceTo(this.point3)),{cloudLine:n,pt1:o,pt2:m,pt3:a,pt4:c,leadPt:x}}worldDraw(n){let o=this.getCloudLine(),a=o.cloudLine;if(a.setUseSmallcoordDisplay(this.use_smallcoord_display),a.worldDraw(n),this.text.length>0){let m=o.leadPt,c=new MxDbLeadComment;c.setUseSmallcoordDisplay(this.use_smallcoord_display),c.point1=m,c.point2=this.point3,c.text=this.text,c.textHeight=this.textHeight,c.textWidth=this.textWidth,c.fixedSize=this.fixedSize,c.worldDraw(n)}}getGripPoints(){let n=[];return n.push(this.point1),n.push(this.point2),n.push(this.point3),n}moveGripPointsAt(n,o){return n==0?this.point1.add(o):n==1?this.point2.add(o):n==2&&this.point3.add(o),!0}dwgIn(n){return this.onDwgIn(n),this.point1.copy(n.point1),this.point2.copy(n.point2),this.point3.copy(n.point3),this.text=n.text.substr(0),this.textHeight=n.textHeight,this.radius=n.radius,n.textWidth&&(this.textWidth=n.textWidth),this.fixedSize=n.fixedSize,!0}dwgOut(n){if(this.onDwgOut(n),n.point1=this.point1,n.point2=this.point2,n.point3=this.point3,n.textHeight=this.textHeight,n.text=this.text,n.radius=this.radius,n.textWidth=this.textWidth,n.fixedSize=this.fixedSize,n.type===MxType.MxCloneType.kSaveDwgClone){let o=this.getCloudLine(),a=o.cloudLine.reCalculateDrawGeometryPoint();n.cachePoint=a||[],n.leadPt=o.leadPt}return n}onViewChange(){return!!this.fixedSize&&(this.setNeedUpdateDisplay(!1),!0)}}function drawMxDbEllipse(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject,a=new MxDbEllipse;b.setMessage(`
点击开始绘制椭圆:`),b.go(()=>{a.point1=b.value(),o.setDraw(m=>{a.point2=m,o.drawCustomEntity(a)}),b.setUserDraw(o),b.setMessage(`
再次点击结束绘制椭圆:`),b.go(()=>{n.addMxEntity(a)})})}MxDbRectBoxLeadComment.cmd="Mx_CheckDraw",MxDbRectBoxLeadComment.draw=drawMxDbRectBoxLeadComment,addRegisterMxDbEntity(MxDbRectBoxLeadComment);class MxDbEllipse extends MxDbEllipseShape{constructor(){super(),this.point1=new THREE.Vector3,this.point2=new THREE.Vector3,this.isClosedToCenter=!1,this.closed=!1,this._propertyDbKeys=[...this._propertyDbKeys,"point1","point2"]}getTypeName(){return"MxDbEllipse"}create(){return new MxDbEllipse}setPoint1(n){return this.point1=n,this}setPoint2(n){return this.point2=n,this}worldDraw(n){const{point1:o,point2:a}=this,m=o.clone().set(a.x,o.y,a.z),c=a.clone().set(o.x,a.y,o.z);this.xRadius=o.distanceTo(m)/2,this.yRadius=o.distanceTo(c)/2;const x=o.x>a.x,A=o.y>a.y,H=x?o.x-this.xRadius:o.x+this.xRadius,F=A?o.y-this.yRadius:o.y+this.yRadius;this.center=new THREE.Vector3(H,F,0),this.drawEllipseShape(n),n.getType()===McGiWorldDrawType$1.kSelectDraw&&n.drawLines([o,new THREE.Vector3(o.x,a.y),a,new THREE.Vector3(a.x,o.y),o])}getGripPoints(){let n=new THREE.Vector3(.5*(this.point2.x+this.point1.x),.5*(this.point2.y+this.point1.y),0);return[this.point1,this.point2,n]}moveGripPointsAt(n,o){return n===0?this.point1.add(o):n===1?this.point2.add(o):n===2&&(this.point1.add(o),this.point2.add(o)),!0}}async function drawMxDbText(){const b=new MrxDbgUiPrPoint;b.setMessage(`
 点取文字插入点:`);let n=await b.go();if(n==null)return;let o=prompt("请输入文字");if(!o)return;let a=new MxDbText;a.position=n,a.height=MxFun.screenCoordLong2Doc(50),a.text=o,MxFun.addToCurrentSpace(a)}let _SpriteText;function getSpriteTextColor(b){return b?b instanceof THREE.Color?b.getStyle():typeof b=="number"?new THREE.Color(b).getStyle():b:"#fff"}function toCSSFont(b,n,o,a,m){let c=document.createElement("span");return c.style.font="1px serif",c.style.fontFamily=b,c.style.fontSize=`${n}px`,c.style.fontStyle=o,c.style.fontVariant=a,c.style.fontWeight=m,c.style.font}function getSpriteTextClass(){if(!_SpriteText){class b extends THREE.Sprite{constructor(o){super(new THREE.SpriteMaterial);const{text:a,textHeight:m,color:c,backgroundColor:x,padding:A,borderWidth:H,borderRadius:F,borderColor:P,strokeWidth:g,strokeColor:E,fontFace:_,fontSize:k,fontWeight:U,textAlign:C,textShadowBlur:S,textShadowColor:Y,textShadowOffsetX:G,textShadowOffsetY:T,angle:B,scale:D,underline:N,fontStyle:I,fontVariant:h}=o||{};this._text=`${a}`,this._textHeight=m||10,this._color=c,this._backgroundColor=x,this._padding=A||0,this._borderWidth=H||0,this._borderRadius=F||0,this._borderColor=P||"white",this._strokeWidth=g||0,this._strokeColor=E||"white",this._fontFace=_||"Arial",this._fontSize=k||90,this._fontWeight=(U==null?void 0:U.toString())||"normal",this._textAlign=C||"start",this._fontStyle=I||"normal",this._fontVariant=h||"normal",this._textShadowBlur=S||0,this._textShadowColor=Y,this._textShadowOffsetX=G||0,this._textShadowOffsetY=T||0,this._angle=B||0,this._textScale=D||1,this._underline=N||!1,this._canvas=document.createElement("canvas"),this._genCanvas()}get text(){return this._text}set text(o){this._text=o,this._genCanvas()}get textHeight(){return this._textHeight}set textHeight(o){this._textHeight=o,this._genCanvas()}get color(){return this._color}set color(o){this._color=o,this._genCanvas()}get backgroundColor(){return this._backgroundColor}set backgroundColor(o){this._backgroundColor=o,this._genCanvas()}get padding(){return this._padding}set padding(o){this._padding=o,this._genCanvas()}get borderWidth(){return this._borderWidth}set borderWidth(o){this._borderWidth=o,this._genCanvas()}get borderRadius(){return this._borderRadius}set borderRadius(o){this._borderRadius=o,this._genCanvas()}get borderColor(){return this._borderColor}set borderColor(o){this._borderColor=o,this._genCanvas()}get fontFace(){return this._fontFace}set fontFace(o){this._fontFace=o,this._genCanvas()}get fontSize(){return this._fontSize}set fontSize(o){this._fontSize=o,this._genCanvas()}get fontWeight(){return this._fontWeight}set fontWeight(o){this._fontWeight=o,this._genCanvas()}get strokeWidth(){return this._strokeWidth}set strokeWidth(o){this._strokeWidth=o,this._genCanvas()}get strokeColor(){return this._strokeColor}set strokeColor(o){this._strokeColor=o,this._genCanvas()}get textAlign(){return this._textAlign}set textAlign(o){this._textAlign=o,this._genCanvas()}get textShadowBlur(){return this._textShadowBlur}set textShadowBlur(o){this._textShadowBlur=o,this._genCanvas()}get textShadowColor(){return this._textShadowColor}set textShadowColor(o){this._textShadowColor=o,this._genCanvas()}get textShadowOffsetX(){return this._textShadowOffsetX}set textShadowOffsetX(o){this._textShadowOffsetX=o,this._genCanvas()}get textShadowOffsetY(){return this._textShadowOffsetY}set textShadowOffsetY(o){this._textShadowOffsetY=o,this._genCanvas()}get angle(){return this._angle}set angle(o){this._angle=o,this._genCanvas()}get textScale(){return this._textScale}set textScale(o){this._textScale=o,this._genCanvas()}get underline(){return this._underline}set underline(o){this._underline=o,this._genCanvas()}get fontStyle(){return this._fontStyle}set fontStyle(o){this._fontStyle=o,this._genCanvas()}get fontVariant(){return this._fontVariant}set fontVariant(o){this._fontVariant=o,this._genCanvas()}_genCanvas(){const o=this._canvas,a=o.getContext("2d"),m=Array.isArray(this.borderWidth)?this.borderWidth:[this.borderWidth,this.borderWidth],c=m.map(T=>T*this.fontSize*.1),x=(Array.isArray(this.borderRadius)?this.borderRadius:[this.borderRadius,this.borderRadius,this.borderRadius,this.borderRadius]).map(T=>T*this.fontSize*.1),A=Array.isArray(this.padding)?this.padding:[this.padding,this.padding],H=A.map(T=>T*this.fontSize*.1),F=this.text.split(`
`),P=this.font;a.font=P;const g=Math.max(...F.map(T=>a.measureText(T).width)),E=4*this.strokeWidth+(this.underline?this.fontSize/15*4:this.fontSize/15),_=(this.fontSize+E)*F.length;if(o.width=g+2*c[0]+2*H[0],o.height=_+2*c[1]+2*H[1],this.borderWidth){if(a.strokeStyle=getSpriteTextColor(this.borderColor),c[0]){const T=c[0]/2;a.lineWidth=c[0],a.beginPath(),a.moveTo(T,x[0]),a.lineTo(T,o.height-x[3]),a.moveTo(o.width-T,x[1]),a.lineTo(o.width-T,o.height-x[2]),a.stroke()}if(c[1]){const T=c[1]/2;a.lineWidth=c[1],a.beginPath(),a.moveTo(Math.max(c[0],x[0]),T),a.lineTo(o.width-Math.max(c[0],x[1]),T),a.moveTo(Math.max(c[0],x[3]),o.height-T),a.lineTo(o.width-Math.max(c[0],x[2]),o.height-T),a.stroke()}if(this.borderRadius){const T=Math.max(...c),B=T/2;a.lineWidth=T,a.beginPath(),[!!x[0]&&[x[0],B,B,x[0]],!!x[1]&&[o.width-x[1],o.width-B,B,x[1]],!!x[2]&&[o.width-x[2],o.width-B,o.height-B,o.height-x[2]],!!x[3]&&[x[3],B,o.height-B,o.height-x[3]]].filter(D=>D).forEach(D=>{const[N,I,h,u]=D;a.moveTo(N,h),a.quadraticCurveTo(I,h,I,u)}),a.stroke()}}this.backgroundColor&&(a.fillStyle=getSpriteTextColor(this.backgroundColor),this.borderRadius?(a.beginPath(),a.moveTo(c[0],x[0]),[[c[0],x[0],o.width-x[1],c[1],c[1],c[1]],[o.width-c[0],o.width-c[0],o.width-c[0],c[1],x[1],o.height-x[2]],[o.width-c[0],o.width-x[2],x[3],o.height-c[1],o.height-c[1],o.height-c[1]],[c[0],c[0],c[0],o.height-c[1],o.height-x[3],x[0]]].forEach(([T,B,D,N,I,h])=>{a.quadraticCurveTo(T,N,B,I),a.lineTo(D,h)}),a.closePath(),a.fill()):a.fillRect(c[0],c[1],o.width-2*c[0],o.height-2*c[1])),a.translate(c[0],c[1]),a.translate(H[0],H[1]),a.font=P,a.fillStyle=getSpriteTextColor(this.color),a.textBaseline="bottom",a.shadowBlur=this.textShadowBlur,a.shadowColor=new THREE.Color(this.textShadowColor).getStyle(),a.shadowOffsetX=this.textShadowOffsetX,a.shadowOffsetY=this.textShadowOffsetY;const k=this.strokeWidth>0;k&&(a.lineWidth=this.strokeWidth*this.fontSize/10,a.strokeStyle=getSpriteTextColor(this.strokeColor));const U=this.textAlign==="center",C=this.textAlign==="start"||this.textAlign==="left";F.forEach(async(T,B)=>{let D=U?2:1;const N=a.measureText(T).width,I=C?0:(g-N)/D,h=(B+1)*(this.fontSize+E);k&&a.strokeText(T,I,h),a.fillText(T,I,h),this.underline&&a.fillRect(I,o.height-this.fontSize/25,N,this.fontSize/25)}),this.material.map&&this.material.map.dispose();const S=this.material.map=new THREE.Texture(o);S.minFilter=THREE.LinearFilter,S.needsUpdate=!0;const Y=this.textHeight*F.length+2*m[1]+2*A[1],G=Y*o.width/o.height;this.scale.set(G,Y,this.scale.z),this.material.rotation=this.angle,this.scale.applyMatrix4(new THREE.Matrix4().makeScale(this.textScale,this.textScale,1))}clone(){return new this.constructor(this.text,this.textHeight,this.color).copy(THREE.Sprite.prototype.clone.call(this))}copy(o){return THREE.Sprite.prototype.copy.call(this,o),this.color=o.color,this.backgroundColor=o.backgroundColor,this.padding=o.padding,this.borderWidth=o.borderWidth,this.borderColor=o.borderColor,this.fontFace=o.fontFace,this.fontSize=o.fontSize,this.fontWeight=o.fontWeight,this.strokeWidth=o.strokeWidth,this.strokeColor=o.strokeColor,this.textAlign=o.textAlign,this.textShadowBlur=o.textShadowBlur,this.textShadowColor=o.textShadowColor,this.textShadowOffsetX=o.textShadowOffsetX,this.textShadowOffsetY=o.textShadowOffsetY,this.angle=o.angle,this.textScale=o.textScale,this}get font(){return toCSSFont(this.fontFace,this.fontSize,this.fontStyle,this.fontVariant,this.fontWeight)}checkFontFace(){try{const{fontFace:o}=this;return document.fonts.check(o)}catch{}return!0}async loadFontFace(){try{const{fontFace:o}=this;await document.fonts.load(o)}catch{}}dispose(){var o;(o=this.material.map)===null||o===void 0||o.dispose(),this.material.dispose(),this.geometry.dispose(),this.dispatchEvent({type:"dispose"})}}_SpriteText=b}return _SpriteText}MxDbEllipse.cmd="Mx_Ellipse",MxDbEllipse.draw=drawMxDbEllipse,addRegisterMxDbEntity(MxDbEllipse);const propertyDbKeys$2=["text","position","height","backgroundColor","padding","borderWidth","borderRadius","borderColor","fontFace","fontSize","fontWeight","strokeWidth","strokeColor","angle","textAlign","textShadowBlur","textShadowColor","textShadowOffsetX","textShadowOffsetY","scale","underline"];class MxDbText extends MxDbEntity{constructor(){super(...arguments),this.position=new THREE.Vector3,this._text="",this._height=16,this._angle=0,this._scale=1,this._underline=!1}setPosition(n){return this.position=n,this}get text(){return this.spriteText?this.spriteText.text:this._text}set text(n){this.spriteText?this.spriteText.text=n:this._text=n}setText(n){return this.text=n,this}get height(){return this.spriteText?this.spriteText.textHeight:this._height}set height(n){this.spriteText?this.spriteText.textHeight=n:this._height=n}setHeight(n){return this.height=n,this}get backgroundColor(){return this.spriteText?this.spriteText.backgroundColor:this._backgroundColor}set backgroundColor(n){this.spriteText?this.spriteText.backgroundColor=n:this._backgroundColor=n}setBackgroundColor(n){return this.backgroundColor=n,this}get padding(){return this.spriteText?this.spriteText.padding:this._padding}set padding(n){this.spriteText?this.spriteText.padding=n:this._padding=n}setPadding(n){return this.padding=n,this}get borderWidth(){return this.spriteText?this.spriteText.borderWidth:this._borderWidth}set borderWidth(n){this.spriteText?this.spriteText.borderWidth=n:this._borderWidth=n}setBorderWidth(n){return this.borderWidth=n,this}get borderRadius(){return this.spriteText?this.spriteText.borderRadius:this._borderRadius}set borderRadius(n){this.spriteText?this.spriteText.borderRadius=n:this._borderRadius=n}setBorderRadius(n){return this.borderRadius=n,this}get borderColor(){return this.spriteText?this.spriteText.borderColor:this._borderColor}set borderColor(n){this.spriteText?this.spriteText.borderColor=n:this._borderColor=n}setBorderColor(n){return this.borderColor=n,this}get fontFace(){return this.spriteText?this.spriteText.fontFace:this._fontFace}set fontFace(n){this.spriteText?this.spriteText.fontFace=n:this._fontFace=n}setFontFace(n){return this.fontFace=n,this}get fontSize(){return this.spriteText?this.spriteText.fontSize:this._fontSize}set fontSize(n){this.spriteText?this.spriteText.fontSize=n:this._fontSize=n}setFontSize(n){return this.fontSize=n,this}get fontWeight(){return this.spriteText?this.spriteText.fontWeight:this._fontWeight}set fontWeight(n){this.spriteText?this.spriteText.fontWeight=n:this._fontWeight=n}setFontWeight(n){return this.fontWeight=n,this}get strokeWidth(){return this.spriteText?this.spriteText.strokeWidth:this._strokeWidth}set strokeWidth(n){this.spriteText?this.spriteText.strokeWidth=n:this._strokeWidth=n}setStrokeWidth(n){return this.strokeWidth=n,this}get strokeColor(){return this.spriteText?this.spriteText.strokeColor:this._strokeColor}set strokeColor(n){this.spriteText?this.spriteText.strokeColor=n:this._strokeColor=n}setStrokeColor(n){return this.strokeColor=n,this}get textAlign(){return this.spriteText?this.spriteText.textAlign:this._textAlign}set textAlign(n){this.spriteText?this.spriteText.textAlign=n:this._textAlign=n}setTextAlign(n){return this.textAlign=n,this}get textShadowBlur(){return this.spriteText?this.spriteText.textShadowBlur:this._textShadowBlur}set textShadowBlur(n){this.spriteText?this.spriteText.textShadowBlur=n:this._textShadowBlur=n}setTextShadowBlur(n){return this.textShadowBlur=n,this}get textShadowColor(){return this.spriteText?this.spriteText.textShadowColor:this._textShadowColor}set textShadowColor(n){this.spriteText?this.spriteText.textShadowColor=n:this._textShadowColor=n}setTextShadowColor(n){return this.textShadowColor=n,this}get textShadowOffsetX(){return this.spriteText?this.spriteText.textShadowOffsetX:this._textShadowOffsetX}set textShadowOffsetX(n){this.spriteText?this.spriteText.textShadowOffsetX=n:this._textShadowOffsetX=n}setTextShadowOffsetX(n){return this.textShadowOffsetX=n,this}get textShadowOffsetY(){return this.spriteText?this.spriteText.textShadowOffsetY:this._textShadowOffsetY}set textShadowOffsetY(n){this.spriteText?this.spriteText.textShadowOffsetY=n:this._textShadowOffsetY=n}setTextShadowOffsetY(n){return this.textShadowOffsetY=n,this}get angle(){return this.spriteText?this.spriteText.angle:this._angle}set angle(n){this.spriteText?this.spriteText.angle=n:this._angle=n}setAngle(n){return this.angle=n,this}get scale(){return this.spriteText?this.spriteText.textScale:this._scale}set scale(n){this.spriteText?this.spriteText.textScale=n:this._scale=n}setScale(n){return this.scale=n,this}get underline(){return this.spriteText?this.spriteText.underline:this._underline}set underline(n){this.spriteText?this.spriteText.underline=n:this._underline=n}setUnderline(n){this.underline=n}getTypeName(){return"MxDbText"}worldDraw(n){if(this.text.length>0){n.getType()!==McGiWorldDrawType$1.kWorldDraw||this.spriteText||this.createSpriteText(),this.color!==this.spriteText.color&&(this.spriteText.color=this.color),this.spriteText.material.setValues({opacity:this.opacity,visible:this.visible});const{x:o,y:a,z:m}=this.position;this.spriteText.position.set(o,a,m),n.drawEntity(this.spriteText)}}createSpriteText(){const n=getSpriteTextClass(),{text:o,height:a,color:m,backgroundColor:c,padding:x,borderWidth:A,borderRadius:H,borderColor:F,strokeWidth:P,strokeColor:g,fontFace:E,fontSize:_,fontWeight:k,textAlign:U,textShadowBlur:C,textShadowColor:S,textShadowOffsetX:Y,textShadowOffsetY:G,angle:T,scale:B,underline:D}=this;this.spriteText=new n({text:o,textHeight:a,color:m,backgroundColor:c,padding:x,borderWidth:A,borderRadius:H,borderColor:F,strokeWidth:P,strokeColor:g,fontFace:E,fontSize:_,fontWeight:k,textAlign:U,textShadowBlur:C,textShadowColor:S,textShadowOffsetX:Y,textShadowOffsetY:G,angle:T,scale:B,underline:D})}getGripPoints(){return[this.position]}moveGripPointsAt(n,o){return n===0&&this.position.add(o),!0}create(){return new MxDbText}dwgIn(n){var o,a;return this.onDwgIn(n),this.dwgInHelp(n,propertyDbKeys$2),typeof n.path=="string"&&(n.path=JSON.parse(n.path)),((a=(o=n==null?void 0:n.path)===null||o===void 0?void 0:o.metadata)===null||a===void 0?void 0:a.generator)==="Curve.toJSON"&&(n.path=new THREE.Path().fromJSON(n.path)),n.type===MxType.MxCloneType.kMxFileClone||n.type===MxType.MxCloneType.kSaveDwgClone?this.createSpriteText():this.spriteText=n.spriteText,!0}dwgOut(n){return this.onDwgOut(n),this.dwgOutHelp(n,propertyDbKeys$2),n.type===MxType.MxCloneType.kMxFileClone||n.type===MxType.MxCloneType.kSaveDwgClone?n.spriteText=void 0:n.spriteText=this.spriteText,n}getGeomExtents(){return new THREE.Box3().expandByObject(this.spriteText)}erase(){return super.erase(),this.spriteText&&this.spriteText.dispose(),!0}}function createCurvePath(b=!1){const n=new THREE.CurvePath;return n.autoClose=b,n}function createQuadraticBezierCurve3(b){let n=0,o=[];for(let a=0;a<b.length;a++){const m=b[n],c=b[++n]||m,x=b[++n]||c;if(!m||!c||!x)break;o.push(new THREE.QuadraticBezierCurve3(m,c,x))}return o}function createCubicBezierCurve3(b){let n=0,o=[];for(let a=0;a<b.length;a++){const m=b[n],c=b[++n]||m,x=b[++n]||c,A=b[++n]||x;if(!(m&&c&&x&&A))break;o.push(new THREE.CubicBezierCurve3(m,c,x,A))}return o}function getCurveColorGradientData(b,n){let o=0,a=[],m=[];const c=Number((1/n.length).toFixed(2));let x=new THREE.Color(n[o]),A=new THREE.Color(n[o+1]);for(let H=0,F=b.length;H<F;H++){const P=b[H],g=H/b.length;g/o>=c&&(o++,A.set(new THREE.Color(n[o]||n[--o]))),a.push(P.x,P.y,P.z||0),x.lerpHSL(A,g),m.push(x.r,x.g,x.b)}return[a,m]}function getColorGradientData(b,n){let o=[],a=[];for(let m=0,c=b.length;m<c;m++){const x=b[m];o.push(x.x,x.y,x.z||0);const A=new THREE.Color(n[m]);a.push(A.r,A.g,A.b)}return[o,a]}MxDbText.cmd="Mx_Text",MxDbText.draw=drawMxDbText,addRegisterMxDbEntity(MxDbText);const propertyDbKeys$1=["points","colors","linecap","linejoin","closed","curveType","tension","bezierType"];class MxDbGradientLine extends MxDbEntity{constructor(){super(...arguments),this.linecap="round",this.linejoin="round",this.closed=!1,this.curveType="centripetal",this.tension=0,this.bezierType="quadratic"}create(){return new MxDbGradientLine}getTypeName(){return"MxDbGradientLine"}setPoints(n){return this.points=n,this}setColors(n){return this.colors=n,this}addColor(n){return this.colors.push(n),this}setLinecap(n){this.linecap=n}setClosed(n){this.closed=n}setCurveType(n){this.curveType=n}setTension(n){this.tension=n}setBezierType(n){this.bezierType=n}worldDraw(n){const o=n.getType();let a=this.getPoints();const{closed:m,curveType:c,tension:x,bezierType:A}=this,H=new THREE.BufferGeometry;let F=[],P=[];const g=A==="cubic",E=A==="quadratic";x!==0?this.curve=new THREE.CatmullRomCurve3(a,m,c,x):A?(this.curve=createCurvePath(m),g?this.curve.curves=createCubicBezierCurve3(a):E?this.curve.curves=createQuadraticBezierCurve3(a):this.curve=void 0):this.curve=void 0,this.curve&&(a=this.curve.getPoints(50));const{linecap:_,linejoin:k}=this;let U;if(this.colors&&this.colors.length>1){const S=m?[...this.colors,this.colors[0]]:this.colors;[F,P]=this.curve?getCurveColorGradientData(a,S):getColorGradientData(a,S),H.setAttribute("position",new THREE.Float32BufferAttribute(F,3)),H.setAttribute("color",new THREE.Float32BufferAttribute(P,3)),U=new THREE.LineBasicMaterial({vertexColors:THREE.VertexColors,linecap:_,linejoin:k})}else H.setFromPoints(a),U=new THREE.LineBasicMaterial({color:this.color,linecap:_,linejoin:k});const C=m?new THREE.LineLoop(H,U):new THREE.Line(H,U);if(n.drawEntity(C),(o===McGiWorldDrawType$1.kSelectDraw||o===McGiWorldDrawType$1.kDynDragDraw)&&this.curve){let S=this.getPoints();const Y=n.getLineWidth();n.setLineWidth(1),n.drawLines(S),n.setLineWidth(Y)}}getGripPoints(){return this.getPoints()}getPoints(){return this.closed?[...this.points,this.points[0]]:this.points}moveGripPointsAt(n,o){return this.move(n,o),!0}move(n,o){return this.points[n].add(o),this}dwgIn(n){return this.dwgInHelp(n,propertyDbKeys$1),this.curve=n.curve,!0}dwgOut(n){return this.dwgOutHelp(n,propertyDbKeys$1),n.curve=this.curve,n}}function drawMxDbEllipseArc(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;let a=new MxDbEllipseArc;b.setUserDraw(o),b.go(async()=>{a.center=b.value(),o.setDraw((m,c)=>{a.startPoint=m,a.yRadius=a.center.distanceTo(m),c.drawCustomEntity(a)}),a.startPoint=await b.go()||new THREE.Vector3,o.setDraw((m,c)=>{a.endPoint=m,c.drawCustomEntity(a)}),a.endPoint=await b.go()||new THREE.Vector3,n.addMxEntity(a)})}addRegisterMxDbEntity(MxDbGradientLine);class MxDbEllipseArc extends MxDbEllipseShape{getTypeName(){return"MxDbEllipseArc"}constructor(){super(),this._propertyDbKeys=[...this._propertyDbKeys,"startPoint","endPoint"]}setStartPoint(n){return this.startPoint=n,this}setEndPoint(n){return this.endPoint=n,this}worldDraw(n){let{center:o,startPoint:a,endPoint:m}=this;a&&(this.xRadius=o.distanceTo(a),this.startAngle=THREE.MathUtils.degToRad(calculateArcAngle(a,o,this.xRadius).angle)),m&&(this.yRadius=o.distanceTo(m),this.endAngle=THREE.MathUtils.degToRad(calculateArcAngle(m,o,this.yRadius).angle)),this.drawEllipseShape(n)}getGripPoints(){return[this.center,this.startPoint,this.endPoint]}moveGripPointsAt(n,o){return n===0&&(this.center.add(o),this.startPoint.add(o),this.endPoint.add(o)),n===1&&this.startPoint.add(o),n===2&&this.endPoint.add(o),!0}}function drawMxDbCircleArc(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;let a=new MxDbCircleArc;a.stroke="#ff0000",b.setUserDraw(o),b.setMessage(`
确定圆弧中点:`),b.go(async()=>{a.center=b.value(),o.setDraw(m=>{o.drawLine(a.center,m)}),b.setMessage(`
确定圆弧开始点:`),a.startPoint=await b.go()||new THREE.Vector3,o.setDraw(m=>{a.endPoint=m,o.drawCustomEntity(a)}),b.setMessage(`
确定圆弧结束点:`),a.endPoint=await b.go()||new THREE.Vector3,o.setDraw(()=>{}),n.addMxEntity(a)})}MxDbEllipseArc.cmd="Mx_MxDbEllipseArc",MxDbEllipseArc.draw=drawMxDbEllipseArc,addRegisterMxDbEntity(MxDbEllipseArc);class MxDbCircleArc extends MxDbCircleShape{constructor(){super(),this._propertyDbKeys=[...this._propertyDbKeys,"startPoint","endPoint"]}getTypeName(){return"MxDbCircleArc"}setStartPoint(n){return this.startPoint=n,this}setEndPoint(n){return this.endPoint=n,this}worldDraw(n){console.log(1111);let{startPoint:o,endPoint:a}=this;if(o&&(this.startAngle=this.computePointAngle(o)),a&&(this.endAngle=this.computePointAngle(a)),o&&a){const{points:m}=this.drawEllipseShape(n);this.startPoint=m[0]}}computePointAngle(n){return this.radius=this.center.distanceTo(n),THREE.MathUtils.degToRad(calculateArcAngle(n,this.center,this.radius).angle)}getGripPoints(){return[this.center,this.startPoint,this.endPoint]}moveGripPointsAt(n,o){return n===0?(this.center.add(o),this.startPoint.add(o),this.endPoint.add(o)):n===1?this.startPoint.add(o):n===2&&this.endPoint.add(o),!0}}MxDbCircleArc.cmd="Mx_MxDbCircleArc",MxDbCircleArc.draw=drawMxDbCircleArc,addRegisterMxDbEntity(MxDbCircleArc);class MxDbArcShape extends MxDbCircleArc{constructor(){super(),this.center=new THREE.Vector3,this.innerRadius=10,this.outerRadius=20,this._propertyDbKeys=[...this._propertyDbKeys,"center","innerRadius","outerRadius"]}getTypeName(){return"MxDbArcShape"}worldDraw(n){n.getType()===McGiWorldDrawType$1.kDynDragDraw?(n.drawCircle(this.center,this.innerRadius),n.drawCircle(this.center,this.outerRadius)):this.drawArcShape(n)}drawArcShape(n){const{center:o,startAngle:a,endAngle:m,clockwise:c}=this,{x,y:A}=o;this.isClosedToCenter=!1;const H=this.createEllipseCurve(x,A,this.innerRadius,this.innerRadius,a,m,c),F=this.createEllipseCurve(x,A,this.outerRadius,this.outerRadius,m,a,!c),P=this.createPaths([H,F]);let g=this.getShapePoints(P);this._draw(n,g),this._drawStoreLine(n,g)}getGripPoints(){return[this.center]}moveGripPointsAt(n,o){return n===0&&this.center.add(o),!0}}function drawMxDbArcShape(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;let a=new MxDbArcShapeDraw;b.setMessage(`
确定圆弧中点:`),b.setUserDraw(o),b.go(async()=>{b.setMessage(`
确定圆弧开始点:`),a.center=b.value(),o.setDraw(m=>{a.interRadiusPoint=m,o.drawCircle(a.center,m.distanceTo(a.center))}),a.interRadiusPoint=await b.go()||new THREE.Vector3,o.setDraw(m=>{a.outerRadiusPoint=m,o.drawCustomEntity(a)}),a.outerRadiusPoint=await b.go()||new THREE.Vector3,n.addMxEntity(a)})}class MxDbArcShapeDraw extends MxDbArcShape{getTypeName(){return"MxDbArcShapeDraw"}constructor(){super(),this.outerRadiusPoint=new THREE.Vector3,this.interRadiusPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"interRadiusPoint","outerRadiusPoint"]}worldDraw(n){this.innerRadius=this.center.distanceTo(this.interRadiusPoint),this.outerRadius=this.center.distanceTo(this.outerRadiusPoint),this.startAngle=THREE.MathUtils.degToRad(calculateArcAngle(this.interRadiusPoint,this.center,this.innerRadius).angle),this.endAngle=THREE.MathUtils.degToRad(calculateArcAngle(this.outerRadiusPoint,this.center,this.outerRadius).angle),this.drawArcShape(n)}getGripPoints(){return[this.center,this.interRadiusPoint,this.outerRadiusPoint]}moveGripPointsAt(n,o){return n===0&&(this.center.add(o),this.interRadiusPoint.add(o),this.outerRadiusPoint.add(o)),n===1&&this.interRadiusPoint.add(o),n===2&&this.outerRadiusPoint.add(o),!0}}function drawMxDbRingShape(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;b.setUserDraw(o);const a=new McEdGetPointWorldDrawObject,m=new MxDbRingShapeDraw;b.setUserDraw(a),b.setMessage(`
确定圆弧开始点:`),b.go(async c=>{console.log(123),m.center=b.value(),a.setDraw(x=>{a.drawCircle(m.center,m.center.distanceTo(x))}),m.innerPoint=await b.go()||new THREE.Vector3,a.setDraw(x=>{m.outerPoint=x,a.drawCustomEntity(m)}),m.outerPoint=await b.go()||new THREE.Vector3,n.addMxEntity(m)})}MxDbArcShapeDraw.isRegister=!1,MxDbArcShapeDraw.cmd="Mx_MxDbArcShape",MxDbArcShapeDraw.draw=drawMxDbArcShape,addRegisterMxDbEntity(MxDbArcShapeDraw);class MxDbRingShape extends MxDbArcShape{getTypeName(){return"MxDbRingShape"}worldDraw(n){const{center:o,startAngle:a,endAngle:m,clockwise:c}=this,{x,y:A}=o;this.isClosedToCenter=!1;const H=this.createEllipseCurve(x,A,this.innerRadius,this.innerRadius,a,m,c),F=this.createEllipseCurve(x,A,this.outerRadius,this.outerRadius,a,m,!c),P=this.createPaths([H,F]);let g=this.getShapePoints(P);const E=this.createPaths(H);let _=this.getShapePoints(E);const k=this.createPaths(F);let U=this.getShapePoints(k);this.isFill?(this._draw(n,g),this._drawStoreLine(n,_),this._drawStoreLine(n,U)):(this._draw(n,_),this._drawStoreLine(n,_),this._draw(n,U),this._drawStoreLine(n,U))}}MxDbRingShape.isRegister=!1,MxDbRingShape.cmd="Mx_MxDbRingShape",MxDbRingShape.draw=drawMxDbRingShape;class MxDbRingShapeDraw extends MxDbRingShape{constructor(){super(),this.innerPoint=new THREE.Vector3,this.outerPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"innerPoint","outerPoint"]}getGripPoints(){return[this.center,this.innerPoint,this.outerPoint]}moveGripPointsAt(n,o){return n===0&&(this.center.add(o),this.innerPoint.add(o),this.outerPoint.add(o)),n===1&&this.innerPoint.add(o),n===2&&this.outerPoint.add(o),!0}worldDraw(n){this.innerPoint&&(this.innerRadius=this.center.distanceTo(this.innerPoint)),this.outerPoint&&(this.outerRadius=this.center.distanceTo(this.outerPoint)),super.worldDraw(n)}}function drawMxDbStarShape(){const b=new MrxDbgUiPrPoint,n=MxFun.getCurrentDraw(),o=new McEdGetPointWorldDrawObject;b.setUserDraw(o);const a=new McEdGetPointWorldDrawObject,m=new MxDbStarShapeDraw;b.setUserDraw(a),b.setMessage(`
确定圆弧开始点:`),b.go(async c=>{m.center=b.value(),a.setDraw(x=>{m.innerPoint=x,a.drawCircle(m.center,m.center.distanceTo(x))}),m.innerPoint=await b.go()||new THREE.Vector3,a.setDraw(x=>{m.outerPoint=x,a.drawCustomEntity(m)}),m.outerPoint=await b.go()||new THREE.Vector3,n.addMxEntity(m)})}addRegisterMxDbEntity(MxDbRingShape);class MxDbStarShape extends MxDbShape{getTypeName(){return"MxDbStarShape"}constructor(){super(),this.center=new THREE.Vector3,this.numPoints=10,this.innerRadius=10,this.outerRadius=10,this._propertyDbKeys=[...this._propertyDbKeys,"center","numPoints","innerRadius","outerRadius"]}worldDraw(n){const{x:o,y:a}=this.center,m=new THREE.Path;m.moveTo(o,a-this.outerRadius);for(let A=1;A<2*this.numPoints;A++){const H=A%2==0?this.outerRadius:this.innerRadius,F=H*Math.sin(A*Math.PI/this.numPoints)+o,P=-1*H*Math.cos(A*Math.PI/this.numPoints)+a;m.lineTo(F,P)}m.closePath();const c=this.createPaths(m),x=this.getShapePoints(c);this._draw(n,x),this._drawStoreLine(n,x)}getGripPoints(){return[this.center]}moveGripPointsAt(n,o){return n===0&&this.center.add(o),!0}}MxDbStarShape.cmd="Mx_MxDbStarShape",MxDbStarShape.draw=drawMxDbStarShape;class MxDbStarShapeDraw extends MxDbStarShape{constructor(){super(),this.innerPoint=new THREE.Vector3,this.outerPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"innerPoint","outerPoint"]}getGripPoints(){return[this.center,this.innerPoint,this.outerPoint]}moveGripPointsAt(n,o){return n===0&&(this.center.add(o),this.innerPoint.add(o),this.outerPoint.add(o)),n===1&&this.innerPoint.add(o),n===2&&this.outerPoint.add(o),!0}worldDraw(n){this.innerPoint&&(this.innerRadius=this.center.distanceTo(this.innerPoint)),this.outerPoint&&(this.outerRadius=this.center.distanceTo(this.outerPoint)),super.worldDraw(n)}}addRegisterMxDbEntity(MxDbStarShape);class MxDbRegularPolygonShape extends MxDbShape{getTypeName(){return"MxDbRegularPolygonShape"}constructor(){super(),this.center=new THREE.Vector3,this.sidesNumber=6,this.radius=70,this._propertyDbKeys=[...this._propertyDbKeys,"center","sidesNumber","radius"]}worldDraw(n){this._drawPolygonShape(n)}_drawPolygonShape(n){const o=this._getPoints(),a=new THREE.Path;a.moveTo(o[0].x,o[0].y);for(let x=0;x<o.length;x++)a.lineTo(o[x].x,o[x].y);a.closePath();const m=this.createPaths(a),c=this.getShapePoints(m);this._draw(n,c),this._drawStoreLine(n,c)}_getPoints(){const{sidesNumber:n,radius:o}=this,{x:a,y:m}=this.center,c=[];for(let x=0;x<n;x++)c.push({x:o*Math.sin(2*x*Math.PI/n)+a,y:-1*o*Math.cos(2*x*Math.PI/n)+m});return c}getGripPoints(){return[this.center]}moveGripPointsAt(n,o){return n===0&&this.center.add(o),!0}}function getScreenPixel(b,n){let o=MxFun.screenCoordLong2World(b-b/3);return o=MxFun.worldCoordLong2Doc(o)}function drawMxDbArrow(){const b=new McEdGetPointWorldDrawObject,n=new MxDbArrow,o=MxFun.getCurrentDraw(),a=new MrxDbgUiPrPoint;a.setUserDraw(b),n.setLineWidth(10),a.go(()=>{n.innerOffset=getScreenPixel(10),n.outerOffset=getScreenPixel(22),n.topOffset=getScreenPixel(36),n.startPoint=a.value(),b.setDraw(m=>{n.endPoint=m,b.drawCustomEntity(n)}),a.go(async m=>{n.endPoint=a.value(),o.addMxEntity(n)})})}addRegisterMxDbEntity(MxDbRegularPolygonShape);class MxDbArrow extends MxDbShape{constructor(){super(),this.isSharpCorner=!1,this.innerOffset=10,this.outerOffset=22,this.topOffset=36,this.startPoint=new THREE.Vector3,this.endPoint=new THREE.Vector3,this._propertyDbKeys=[...this._propertyDbKeys,"outerOffset","topOffset","innerOffset","isSharpCorner","startPoint","endPoint"]}worldDraw(n){const o=this.getArrowVertex(this.startPoint,this.endPoint);o&&(this._draw(n,o),this._drawStoreLine(n,o))}getArrowVertex(n,o,a=this.isSharpCorner){let{innerOffset:m,topOffset:c,outerOffset:x}=this;const A=[];A[3]=o;const H=Math.sqrt((n.x-o.x)*(n.x-o.x)+(n.y-o.y)*(n.y-o.y));if(H===0)return;const F=-(o.x-n.x)/H,P=(o.y-n.y)/H,g=n.x+m,E=n.y+H-c,_=n.x+x,k=n.y+H-c,U=n.x-m,C=n.y+H-c,S=n.x-x,Y=n.y+H-c;return a?(A[0]=n,A[6]=A[0]):(A[0]=new THREE.Vector3(n.x-(U-n.x)*P,n.y-(U-n.x)*F),A[6]=new THREE.Vector3(n.x+(U-n.x)*P,n.y+(U-n.x)*F),A[7]=A[0]),A[1]=new THREE.Vector3(n.x+(g-n.x)*P-(E-n.y)*F,n.y+(g-n.x)*F+(E-n.y)*P),A[2]=new THREE.Vector3(n.x+(_-n.x)*P-(k-n.y)*F,n.y+(_-n.x)*F+(k-n.y)*P),A[4]=new THREE.Vector3(n.x+(S-n.x)*P-(Y-n.y)*F,n.y+(S-n.x)*F+(Y-n.y)*P),A[5]=new THREE.Vector3(n.x+(U-n.x)*P-(C-n.y)*F,n.y+(U-n.x)*F+(C-n.y)*P),A}getGripPoints(){const n=new THREE.Vector3;return new THREE.Line3(this.startPoint,this.endPoint).getCenter(n),[this.startPoint,n,this.endPoint]}moveGripPointsAt(n,o){return n===0&&this.startPoint.add(o),n===1&&(this.startPoint.add(o),this.endPoint.add(o)),n===2&&this.endPoint.add(o),!0}getCornerRadiusPoints(n){return n}}MxDbArrow.cmd="Mx_MxDbArrow",MxDbArrow.draw=drawMxDbArrow,addRegisterMxDbEntity(MxDbArrow);class MxDbLineShape extends MxDbShape{setPoints(n){return this.points=n,this}addPoint(n){return this.points.push(n),this}removePoint(n){return this.points.splice(n,1),this}constructor(){super(),this.points=[],this._propertyDbKeys=[...this._propertyDbKeys,"points"]}getTypeName(){return"MxDbLineShape"}worldDraw(n){this._draw(n,this.points),this._drawStoreLine(n,this.points)}getGripPoints(){return this.points}moveGripPointsAt(n,o){return this.points[n].add(o),!0}getGeomExtents(){return new THREE.Box3().setFromPoints(this.points)}getGetLength(){let n=0;for(let o=0;o++;o<this.points.length)this.points[o+1]&&(n+=this.points[o].distanceTo(this.points[o+1]));return n}}async function drawMxDbSplineCurve(){const b=new MrxDbgUiPrPoint,n=new MxDbSplineCurve;b.setMessage(`
指定第一个点:`),b.goWhile(async o=>{if(o===MrxDbgUiPrBaseReturn$1.kOk)n.points.push(b.value()),b.setUserDraw((a,m)=>{const c=n.clone();c.points.push(a),m.drawCustomEntity(c),n.points.length===0?b.setMessage(`
指定第一个点:`):(b.setMessage(`
指定下一个点:`),b.setKeyWords("[闭合(C)/ 放弃(U)]"))});else if(o===MrxDbgUiPrBaseReturn$1.kKeyWord){if(b.isKeyWordPicked("C"))return n.closed=!0,{exit:!0};b.isKeyWordPicked("U")&&n.points.pop()}},()=>{MxFun.getCurrentDraw().addMxEntity(n)})}addRegisterMxDbEntity(MxDbLineShape);const propertyDbKeys=["points","closed","tension","curveType"];class MxDbSplineCurve extends MxDbEntity{constructor(){super(...arguments),this.points=[],this.closed=!1,this.tension=.5,this.curveType="centripetal"}worldDraw(n){const o=new THREE.CatmullRomCurve3(this.points,this.closed,"catmullrom",this.tension).getPoints(15*this.points.length),a=new THREE.Geometry().setFromPoints(o),m=new THREE.LineBasicMaterial({color:this.color}),c=new THREE.Line(a,m);n.drawEntity(c)}getGripPoints(){return this.points}moveGripPointsAt(n,o){return this.points[n].add(o),!0}create(){return new MxDbSplineCurve}dwgIn(n){return this.onDwgIn(n),this.dwgInHelp(n,propertyDbKeys),!0}dwgOut(n){return this.onDwgOut(n),this.dwgOutHelp(n,propertyDbKeys),n}getTypeName(){return"MxDbSplineCurve"}}MxDbSplineCurve.draw=drawMxDbSplineCurve,MxDbSplineCurve.cmd="Mx_Spline",addRegisterMxDbEntity(MxDbSplineCurve);class MrxDbgUiPrDist extends MrxDbgUiPrBase{constructor(){var n;super(new((n=store.state.MxFun)===null||n===void 0?void 0:n.getMxJigCmdManager().getMrxDbgUiPrDistClass()))}value(){return this.imp.value()}basePt(){return this.imp.basePt()}setBasePt(n){return this.imp.setBasePt(n)}setUseBasePt(n){return this.imp.setUseBasePt(n)}go(n){let o=this;return n?(o.imp.go(a=>{o.status=a,n(a)}),new Promise((a,m)=>{a(null)})):new Promise((a,m)=>{o.imp.go(c=>{o.status=c,a(c!=0?null:o.imp.value())})})}}class MrxDbgUiPrInt extends MrxDbgUiPrBase{constructor(){var n;super(new((n=store.state.MxFun)===null||n===void 0?void 0:n.getMxJigCmdManager().getMrxDbgUiPrIntClass()))}value(){return this.imp.value()}go(n){let o=this;return n?(o.imp.go(a=>{o.status=a,n(a)}),new Promise((a,m)=>{a(null)})):new Promise((a,m)=>{o.imp.go(c=>{o.status=c,a(c!=0?null:o.imp.value())})})}}class MrxDbgUiPrString extends MrxDbgUiPrBase{constructor(){var n;super(new((n=store.state.MxFun)===null||n===void 0?void 0:n.getMxJigCmdManager().getMrxDbgUiPrStringClass()))}value(){return this.imp.value()}go(n){let o=this;return n?(o.imp.go(a=>{o.status=a,n(a)}),new Promise((a,m)=>{a(null)})):new Promise((a,m)=>{o.imp.go(c=>{o.status=c,a(c!=0?null:o.imp.value())})})}}class MrxDbgUiPrKeyWord extends MrxDbgUiPrBase{constructor(){var n;super(new((n=store.state.MxFun)===null||n===void 0?void 0:n.getMxJigCmdManager().getMrxDbgUiPrKeyWordClass()))}go(n){let o=this;return n?(o.imp.go(a=>{o.status=a,n(a)}),new Promise((a,m)=>{a(null)})):new Promise((a,m)=>{o.imp.go(c=>{o.status=c,a(c!=0?null:o.keyWordPicked())})})}}class MrxDbgUiPrAngle extends MrxDbgUiPrBase{constructor(){var n;super(new((n=store.state.MxFun)===null||n===void 0?void 0:n.getMxJigCmdManager().getMrxDbgUiPrAngleClass()))}value(){return this.imp.value()}basePt(){return this.imp.basePt()}setBasePt(n){return this.imp.setBasePt(n)}setUseBasePt(n){return this.imp.setUseBasePt(n)}go(n){let o=this;return n?(o.imp.go(a=>{o.status=a,n(a)}),new Promise((a,m)=>{a(null)})):new Promise((a,m)=>{o.imp.go(c=>{o.status=c,a(c!=0?null:o.imp.value())})})}}var Mx=Object.freeze({__proto__:null,loadCoreCode,useCanvasResizeListener,store,MxFun,MxThreeJS,MxType,Mxassembly,McGeTool,MrxDbgUtils,MxPaintBrush,MrxDbgUiPrPoint,McEdGetPointWorldDrawObject,MrxDbgUiPrBaseReturn:MrxDbgUiPrBaseReturn$1,MxDbEntity,MxDbImage,MxDbSVG,MxDbSVGText,MxDbPolyline,MxDb2LineAngularDimension,Mx3PointArc,Mx2PointArc,MxDbCoord,MxDbLine,MxDbRect,MxDbAlignedDimension,MxFilters,McGiWorldDrawType:McGiWorldDrawType$1,MxDbArea,MxDbLeadTag,MxDbAnyLine,MxDbCloudLine,MxDbRegularPolygon,MxDbLeadComment,MxDbRectBoxLeadComment,MxDbEllipse,MxDbText,MxDrawObject,MxDbHatch,MxDbDatabase,MxDbGradientLine,MxDbShape,MxDbEllipseShape,MxDbEllipseArc,MxDbCircleShape,MxDbCircleArc,MxDbArcShapeDraw,MxDbRingShape,MxDbStarShape,MxDbRegularPolygonShape,MxDbArrow,MxDbLineShape,Layer,MxDbSplineCurve,MrxDbgUiPrBase,get MxCursorType(){return MxCursorType},get DetailedResult(){return DetailedResult},get DynamicInputType(){return DynamicInputType},get UserInputControls(){return UserInputControls},MrxDbgUiPrDist,MrxDbgUiPrInt,MrxDbgUiPrString,MrxDbgUiPrKeyWord,MrxDbgUiPrAngle,MxTempMarkDraw}),elementResizeEventPolyfill_umd_min=createCommonjsModule(function(b,n){b.exports=function(o){var a={};function m(c){if(a[c])return a[c].exports;var x=a[c]={i:c,l:!1,exports:{}};return o[c].call(x.exports,x,x.exports,m),x.l=!0,x.exports}return m.m=o,m.c=a,m.d=function(c,x,A){m.o(c,x)||Object.defineProperty(c,x,{enumerable:!0,get:A})},m.r=function(c){typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(c,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(c,"__esModule",{value:!0})},m.t=function(c,x){if(1&x&&(c=m(c)),8&x||4&x&&typeof c=="object"&&c&&c.__esModule)return c;var A=Object.create(null);if(m.r(A),Object.defineProperty(A,"default",{enumerable:!0,value:c}),2&x&&typeof c!="string")for(var H in c)m.d(A,H,(function(F){return c[F]}).bind(null,H));return A},m.n=function(c){var x=c&&c.__esModule?function(){return c.default}:function(){return c};return m.d(x,"a",x),x},m.o=function(c,x){return Object.prototype.hasOwnProperty.call(c,x)},m.p="",m(m.s="fae3")}({"6dd8":function(o,a,m){(function(c){var x=function(){if(typeof Map<"u")return Map;function z(J,te){var X=-1;return J.some(function(se,ve){return se[0]===te&&(X=ve,!0)}),X}return function(){function J(){this.__entries__=[]}return Object.defineProperty(J.prototype,"size",{get:function(){return this.__entries__.length},enumerable:!0,configurable:!0}),J.prototype.get=function(te){var X=z(this.__entries__,te),se=this.__entries__[X];return se&&se[1]},J.prototype.set=function(te,X){var se=z(this.__entries__,te);~se?this.__entries__[se][1]=X:this.__entries__.push([te,X])},J.prototype.delete=function(te){var X=this.__entries__,se=z(X,te);~se&&X.splice(se,1)},J.prototype.has=function(te){return!!~z(this.__entries__,te)},J.prototype.clear=function(){this.__entries__.splice(0)},J.prototype.forEach=function(te,X){X===void 0&&(X=null);for(var se=0,ve=this.__entries__;se<ve.length;se++){var Ee=ve[se];te.call(X,Ee[1],Ee[0])}},J}()}(),A=typeof window<"u"&&typeof document<"u"&&window.document===document,H=c!==void 0&&c.Math===Math?c:typeof self<"u"&&self.Math===Math?self:typeof window<"u"&&window.Math===Math?window:Function("return this")(),F=typeof requestAnimationFrame=="function"?requestAnimationFrame.bind(H):function(z){return setTimeout(function(){return z(Date.now())},1e3/60)},P=2,g=20,E=["top","right","bottom","left","width","height","size","weight"],_=typeof MutationObserver<"u",k=function(){function z(){this.connected_=!1,this.mutationEventsAdded_=!1,this.mutationsObserver_=null,this.observers_=[],this.onTransitionEnd_=this.onTransitionEnd_.bind(this),this.refresh=function(J,te){var X=!1,se=!1,ve=0;function Ee(){X&&(X=!1,J()),se&&Be()}function we(){F(Ee)}function Be(){var re=Date.now();if(X){if(re-ve<P)return;se=!0}else X=!0,se=!1,setTimeout(we,te);ve=re}return Be}(this.refresh.bind(this),g)}return z.prototype.addObserver=function(J){~this.observers_.indexOf(J)||this.observers_.push(J),this.connected_||this.connect_()},z.prototype.removeObserver=function(J){var te=this.observers_,X=te.indexOf(J);~X&&te.splice(X,1),!te.length&&this.connected_&&this.disconnect_()},z.prototype.refresh=function(){this.updateObservers_()&&this.refresh()},z.prototype.updateObservers_=function(){var J=this.observers_.filter(function(te){return te.gatherActive(),te.hasActive()});return J.forEach(function(te){return te.broadcastActive()}),J.length>0},z.prototype.connect_=function(){A&&!this.connected_&&(document.addEventListener("transitionend",this.onTransitionEnd_),window.addEventListener("resize",this.refresh),_?(this.mutationsObserver_=new MutationObserver(this.refresh),this.mutationsObserver_.observe(document,{attributes:!0,childList:!0,characterData:!0,subtree:!0})):(document.addEventListener("DOMSubtreeModified",this.refresh),this.mutationEventsAdded_=!0),this.connected_=!0)},z.prototype.disconnect_=function(){A&&this.connected_&&(document.removeEventListener("transitionend",this.onTransitionEnd_),window.removeEventListener("resize",this.refresh),this.mutationsObserver_&&this.mutationsObserver_.disconnect(),this.mutationEventsAdded_&&document.removeEventListener("DOMSubtreeModified",this.refresh),this.mutationsObserver_=null,this.mutationEventsAdded_=!1,this.connected_=!1)},z.prototype.onTransitionEnd_=function(J){var te=J.propertyName,X=te===void 0?"":te;E.some(function(se){return!!~X.indexOf(se)})&&this.refresh()},z.getInstance=function(){return this.instance_||(this.instance_=new z),this.instance_},z.instance_=null,z}(),U=function(z,J){for(var te=0,X=Object.keys(J);te<X.length;te++){var se=X[te];Object.defineProperty(z,se,{value:J[se],enumerable:!1,writable:!1,configurable:!0})}return z},C=function(z){return z&&z.ownerDocument&&z.ownerDocument.defaultView||H},S=N(0,0,0,0);function Y(z){return parseFloat(z)||0}function G(z){for(var J=[],te=1;te<arguments.length;te++)J[te-1]=arguments[te];return J.reduce(function(X,se){return X+Y(z["border-"+se+"-width"])},0)}function T(z){var J=z.clientWidth,te=z.clientHeight;if(!J&&!te)return S;var X=C(z).getComputedStyle(z),se=function(ne){for(var le={},Re=0,at=["top","right","bottom","left"];Re<at.length;Re++){var ze=at[Re],Ie=ne["padding-"+ze];le[ze]=Y(Ie)}return le}(X),ve=se.left+se.right,Ee=se.top+se.bottom,we=Y(X.width),Be=Y(X.height);if(X.boxSizing==="border-box"&&(Math.round(we+ve)!==J&&(we-=G(X,"left","right")+ve),Math.round(Be+Ee)!==te&&(Be-=G(X,"top","bottom")+Ee)),!function(ne){return ne===C(ne).document.documentElement}(z)){var re=Math.round(we+ve)-J,fe=Math.round(Be+Ee)-te;Math.abs(re)!==1&&(we-=re),Math.abs(fe)!==1&&(Be-=fe)}return N(se.left,se.top,we,Be)}var B=typeof SVGGraphicsElement<"u"?function(z){return z instanceof C(z).SVGGraphicsElement}:function(z){return z instanceof C(z).SVGElement&&typeof z.getBBox=="function"};function D(z){return A?B(z)?function(J){var te=J.getBBox();return N(0,0,te.width,te.height)}(z):T(z):S}function N(z,J,te,X){return{x:z,y:J,width:te,height:X}}var I=function(){function z(J){this.broadcastWidth=0,this.broadcastHeight=0,this.contentRect_=N(0,0,0,0),this.target=J}return z.prototype.isActive=function(){var J=D(this.target);return this.contentRect_=J,J.width!==this.broadcastWidth||J.height!==this.broadcastHeight},z.prototype.broadcastRect=function(){var J=this.contentRect_;return this.broadcastWidth=J.width,this.broadcastHeight=J.height,J},z}(),h=function(){return function(z,J){var te=function(X){var se=X.x,ve=X.y,Ee=X.width,we=X.height,Be=typeof DOMRectReadOnly<"u"?DOMRectReadOnly:Object,re=Object.create(Be.prototype);return U(re,{x:se,y:ve,width:Ee,height:we,top:ve,right:se+Ee,bottom:we+ve,left:se}),re}(J);U(this,{target:z,contentRect:te})}}(),u=function(){function z(J,te,X){if(this.activeObservations_=[],this.observations_=new x,typeof J!="function")throw new TypeError("The callback provided as parameter 1 is not a function.");this.callback_=J,this.controller_=te,this.callbackCtx_=X}return z.prototype.observe=function(J){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(J instanceof C(J).Element))throw new TypeError('parameter 1 is not of type "Element".');var te=this.observations_;te.has(J)||(te.set(J,new I(J)),this.controller_.addObserver(this),this.controller_.refresh())}},z.prototype.unobserve=function(J){if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");if(typeof Element<"u"&&Element instanceof Object){if(!(J instanceof C(J).Element))throw new TypeError('parameter 1 is not of type "Element".');var te=this.observations_;te.has(J)&&(te.delete(J),te.size||this.controller_.removeObserver(this))}},z.prototype.disconnect=function(){this.clearActive(),this.observations_.clear(),this.controller_.removeObserver(this)},z.prototype.gatherActive=function(){var J=this;this.clearActive(),this.observations_.forEach(function(te){te.isActive()&&J.activeObservations_.push(te)})},z.prototype.broadcastActive=function(){if(this.hasActive()){var J=this.callbackCtx_,te=this.activeObservations_.map(function(X){return new h(X.target,X.broadcastRect())});this.callback_.call(J,te,J),this.clearActive()}},z.prototype.clearActive=function(){this.activeObservations_.splice(0)},z.prototype.hasActive=function(){return this.activeObservations_.length>0},z}(),v=typeof WeakMap<"u"?new WeakMap:new x,M=function(){return function z(J){if(!(this instanceof z))throw new TypeError("Cannot call a class as a function.");if(!arguments.length)throw new TypeError("1 argument required, but only 0 present.");var te=k.getInstance(),X=new u(J,te,this);v.set(this,X)}}();["observe","unobserve","disconnect"].forEach(function(z){M.prototype[z]=function(){var J;return(J=v.get(this))[z].apply(J,arguments)}});var j=H.ResizeObserver!==void 0?H.ResizeObserver:M;a.a=j}).call(this,m("c8ba"))},c8ba:function(o,a){var m;m=function(){return this}();try{m=m||new Function("return this")()}catch{typeof window=="object"&&(m=window)}o.exports=m},f6fd:function(o,a){(function(m){var c="currentScript",x=m.getElementsByTagName("script");c in m||Object.defineProperty(m,c,{get:function(){try{throw new Error}catch(F){var A,H=(/.*at [^\(]*\((.*):.+:.+\)$/gi.exec(F.stack)||[!1])[1];for(A in x)if(x[A].src==H||x[A].readyState=="interactive")return x[A];return null}}})})(document)},fae3:function(o,a,m){var c;m.r(a),m.d(a,"EventListenerWrapper",function(){return F}),typeof window<"u"&&(m("f6fd"),(c=window.document.currentScript)&&(c=c.src.match(/(.+\/)[^/]+\.js(\?.*)?$/))&&(m.p=c[1]));var x=m("6dd8");const A=EventTarget.prototype.addEventListener,H=function(E){const _=document.createEvent("HTMLEvents");return _.initEvent(E),_},F=function(E){E==="resize"&&g(this),A.apply(this,arguments)};function P(E){const _=P.observer=P.observer||new x.a(E);return _.initialized=!0,_}function g(E){const _=P(k=>{if(_.initialized)_.initialized=!1;else for(let U of k){const C=H("resize");U.target.dispatchEvent(C),U&&U.target&&typeof U.target.onresize=="function"&&U.target.onresize(C)}});_.observe(E)}HTMLElement.prototype.addEventListener=F,Reflect.defineProperty(HTMLElement.prototype,"onresize",{set(E){this._onresize=E,typeof E=="function"&&g(this)},get(){return this._onresize||null}})}})}),elementResizeEventPolyfill_umd_min$1=unwrapExports(elementResizeEventPolyfill_umd_min),elementResizeEventPolyfill_umd_min$2=Object.freeze({__proto__:null,default:elementResizeEventPolyfill_umd_min$1,__moduleExports:elementResizeEventPolyfill_umd_min});export{DetailedResult,DynamicInputType,Layer,McEdGetPointWorldDrawObject,McGeTool,McGiWorldDrawType$1 as McGiWorldDrawType,MrxDbgUiPrAngle,MrxDbgUiPrBase,MrxDbgUiPrBaseReturn$1 as MrxDbgUiPrBaseReturn,MrxDbgUiPrDist,MrxDbgUiPrInt,MrxDbgUiPrKeyWord,MrxDbgUiPrPoint,MrxDbgUiPrString,MrxDbgUtils,Mx2PointArc,Mx3PointArc,MxCursorType,MxDb2LineAngularDimension,MxDbAlignedDimension,MxDbAnyLine,MxDbArcShapeDraw,MxDbArea,MxDbArrow,MxDbCircleArc,MxDbCircleShape,MxDbCloudLine,MxDbCoord,MxDbDatabase,MxDbEllipse,MxDbEllipseArc,MxDbEllipseShape,MxDbEntity,MxDbGradientLine,MxDbHatch,MxDbImage,MxDbLeadComment,MxDbLeadTag,MxDbLine,MxDbLineShape,MxDbPolyline,MxDbRect,MxDbRectBoxLeadComment,MxDbRegularPolygon,MxDbRegularPolygonShape,MxDbRingShape,MxDbSVG,MxDbSVGText,MxDbShape,MxDbSplineCurve,MxDbStarShape,MxDbText,MxDrawObject,MxFilters,MxFun,MxPaintBrush,MxTempMarkDraw,MxThreeJS,MxType,Mxassembly,UserInputControls,Mx as default,loadCoreCode,store,useCanvasResizeListener};
